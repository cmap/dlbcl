if(function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="2.2.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"!==c&&!n.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)}n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],g!==(d=a[b])&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isPlainObject:function(a){var b;if("object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype||{},"isPrototypeOf"))return!1;for(b in a);return void 0===b||k.call(a,b)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;(a=n.trim(a))&&(1===a.indexOf("use strict")?((b=d.createElement("script")).text=a,d.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a))for(c=a.length;c>d&&!1!==b.call(a[d],d,a[d]);d++);else for(d in a)if(!1===b.call(a[d],d,a[d]))break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:h.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var e=[],f=0,g=a.length,h=!c;g>f;f++)!b(a[f],f)!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)null!=(e=b(a[g],g,c))&&h.push(e);else for(g in a)null!=(e=b(a[g],g,c))&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(d=e.call(arguments,2),(f=function(){return a.apply(b||this,d.concat(e.call(arguments)))}).guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){i["[object "+b+"]"]=b.toLowerCase()});var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!=d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){for((k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),h=(r=g(a)).length,l=V.test(k)?"#"+k:"[id='"+k+"']";h--;)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];return function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){for(var c=a.split("|"),e=c.length;e--;)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function la(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&void 0!==a.getElementsByTagName&&a}for(b in c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(o=(n=g).documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(void 0!==b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c=void 0!==a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return void 0!==b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return void 0!==b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ia(function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d||(1&(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);for(c=a;c=c.parentNode;)g.unshift(c);for(c=b;c=c.parentNode;)h.unshift(c);for(;g[d]===h[d];)d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){for(;b=a[f++];)b===a[f]&&(e=d.push(f));for(;e--;)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else for(;b=a[d++];)c+=e(b);return c},(d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||void 0!==a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){for(;p;){for(m=b;m=m[p];)if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(t=(n=(j=(k=(l=(m=q)[u]||(m[u]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]||[])[0]===w&&j[1])&&j[2],m=n&&q.childNodes[n];m=++n&&m&&m[p]||(t=n=0)||o.pop();)if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(t=n=(j=(k=(l=(m=b)[u]||(m[u]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]||[])[0]===w&&j[1]),!1===t)for(;(m=++n&&m&&m[p]||(t=n=0)||o.pop())&&((h?m.nodeName.toLowerCase()!==r:1!==m.nodeType)||!++t||(s&&((k=(l=m[u]||(m[u]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]=[w,t]),m!==b)););return(t-=e)===d||t%d==0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)a[d=J(a,f[g])]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do{if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return(c=c.toLowerCase())===a||0===c.indexOf(a+"-")}while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}}).pseudos.nth=d.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if((h=(i=(j=b[u]||(b[u]={}))[b.uniqueID]||(j[b.uniqueID]={}))[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||function(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d)for(j=ua(r,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l));if(f){if(e||a){if(e){for(j=[],k=r.length;k--;)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}for(k=r.length;k--;)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if((c=d.filter[a[i].type].apply(null,a[i].matches))[u]){for(e=++i;f>e&&!d.relative[a[e].type];e++);return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){for(o=0,g||l.ownerDocument===n||(m(l),h=!p);q=a[o++];)if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){for(o=0;q=b[o++];)q(t,u,g,h);if(f){if(r>0)for(;s--;)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=d.preFilter;h;){for(g in c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length)),d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)},h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){for(b||(b=g(a)),c=b.length;c--;)(f=wa(b[c]))[u]?d.push(f):e.push(f);(f=A(a,xa(e,d))).selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if((j=o[0]=o[0].slice(0)).length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(!(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0]))return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}for(i=W.needsContext.test(a)?0:j.length;i--&&(k=j[i],!d.relative[l=k.type]);)if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),!(a=f.length&&qa(j)))return H.apply(e,f),e;break}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ia(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ja("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ja("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute("disabled")})||ja(K,function(a,b,c){var d;return c?void 0:!0===a[b]?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return h.call(b,a)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return(d=this.pushStack(c>1?n.unique(d):d)).selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(!(e="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:B.exec(a))||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return(f=d.getElementById(e[2]))&&f.parentNode&&(this.length=1,this[0]=f),this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?void 0!==c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))}).prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};function F(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?h.call(n(a),this[0]):h.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||n.uniqueSort(e),D.test(a)&&e.reverse()),this.pushStack(e)}});var I,G=/\S+/g;function J(){d.removeEventListener("DOMContentLoaded",J),a.removeEventListener("load",J),n.ready()}n.Callbacks=function(a){a="string"==typeof a?function(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1)for(c=g.shift();++h<f.length;)!1===f[h].apply(c[0],c[1])&&a.stopOnFalse&&(h=f.length,c=!1);a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){for(var c;(c=n.inArray(b,f,c))>-1;)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=[a,(c=c||[]).slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var i,j,k,b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}};if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}}),n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(!0===a?--n.readyWait:n.isReady)||(n.isReady=!0,!0!==a&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}}),n.ready.promise=function(b){return I||(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(n.ready):(d.addEventListener("DOMContentLoaded",J),a.addEventListener("load",J))),I.promise(b)},n.ready.promise();var K=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c))for(h in e=!0,c)K(a,b,h,c[h],!0,f,g);else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},L=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function M(){this.expando=n.expando+M.uid++}M.uid=1,M.prototype={register:function(a,b){var c=b||{};return a.nodeType?a[this.expando]=c:Object.defineProperty(a,this.expando,{value:c,writable:!0,configurable:!0}),a[this.expando]},cache:function(a){if(!L(a))return{};var b=a[this.expando];return b||(b={},L(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[b]=c;else for(d in b)e[d]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?void 0!==(d=this.get(a,b))?d:this.get(a,n.camelCase(b)):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=a[this.expando];if(void 0!==f){if(void 0===b)this.register(a);else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in f?d=[b,e]:d=(d=e)in f?[d]:d.match(G)||[]),c=d.length;for(;c--;)delete f[d[c]]}(void 0===b||n.isEmptyObject(f))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!n.isEmptyObject(b)}};var N=new M,O=new M,P=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Q=/[A-Z]/g;function R(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Q,"-$&").toLowerCase(),"string"==typeof(c=a.getAttribute(d))){try{c="true"===c||"false"!==c&&("null"===c?null:+c+""===c?+c:P.test(c)?n.parseJSON(c):c)}catch(e){}O.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return O.hasData(a)||N.hasData(a)},data:function(a,b,c){return O.access(a,b,c)},removeData:function(a,b){O.remove(a,b)},_data:function(a,b,c){return N.access(a,b,c)},_removeData:function(a,b){N.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=O.get(f),1===f.nodeType&&!N.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(0===(d=g[c].name).indexOf("data-")&&(d=n.camelCase(d.slice(5)),R(f,d,e[d])));N.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){O.set(this,a)}):K(this,function(b){var c,d;if(f&&void 0===b){if(void 0!==(c=O.get(f,a)||O.get(f,a.replace(Q,"-$&").toLowerCase())))return c;if(d=n.camelCase(a),void 0!==(c=O.get(f,d)))return c;if(void 0!==(c=R(f,d,void 0)))return c}else d=n.camelCase(a),this.each(function(){var c=O.get(this,d);O.set(this,d,b),a.indexOf("-")>-1&&void 0!==c&&O.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){O.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=N.get(a,b),c&&(!d||n.isArray(c)?d=N.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b);"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,function(){n.dequeue(a,b)},f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return N.get(a,c)||N.access(a,c,{empty:n.Callbacks("once memory").add(function(){N.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)(c=N.get(f[g],a+"queueHooks"))&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),U=["Top","Right","Bottom","Left"],V=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function W(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&T.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do{k/=f=f||".5",n.style(a,b,k+j)}while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var X=/^(?:checkbox|radio)$/i,Y=/<([\w:-]+)/,Z=/^$|\/(?:java|ecma)script/i,$={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function _(a,b){var c=void 0!==a.getElementsByTagName?a.getElementsByTagName(b||"*"):void 0!==a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function aa(a,b){for(var c=0,d=a.length;d>c;c++)N.set(a[c],"globalEval",!b||N.get(b[c],"globalEval"))}$.optgroup=$.option,$.tbody=$.tfoot=$.colgroup=$.caption=$.thead,$.th=$.td;var ba=/<|&#?\w+;/;function ca(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],o=0,p=a.length;p>o;o++)if((f=a[o])||0===f)if("object"===n.type(f))n.merge(m,f.nodeType?[f]:f);else if(ba.test(f)){for(g=g||l.appendChild(b.createElement("div")),h=(Y.exec(f)||["",""])[1].toLowerCase(),i=$[h]||$._default,g.innerHTML=i[1]+n.htmlPrefilter(f)+i[2],k=i[0];k--;)g=g.lastChild;n.merge(m,g.childNodes),(g=l.firstChild).textContent=""}else m.push(b.createTextNode(f));for(l.textContent="",o=0;f=m[o++];)if(d&&n.inArray(f,d)>-1)e&&e.push(f);else if(j=n.contains(f.ownerDocument,f),g=_(l.appendChild(f),"script"),j&&aa(g),c)for(k=0;f=g[k++];)Z.test(f.type||"")&&c.push(f);return l}!function(){var b=d.createDocumentFragment().appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var da=/^key/,ea=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,fa=/^([^.]*)(?:\.(.+)|)/;function ga(){return!0}function ha(){return!1}function ia(){try{return d.activeElement}catch(a){}}function ja(a,b,c,d,e,f){var g,h;if("object"==typeof b){for(h in"string"!=typeof c&&(d=d||c,c=void 0),b)ja(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),!1===e)e=ha;else if(!e)return a;return 1===f&&(g=e,(e=function(a){return n().off(a),g.apply(this,arguments)}).guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=N.get(a);if(r)for(c.handler&&(c=(f=c).handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return void 0!==n&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),j=(b=(b||"").match(G)||[""]).length;j--;)o=q=(h=fa.exec(b[j])||[])[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||((m=i[o]=[]).delegateCount=0,l.setup&&!1!==l.setup.call(a,d,p,g)||a.addEventListener&&a.addEventListener(o,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=N.hasData(a)&&N.get(a);if(r&&(i=r.events)){for(j=(b=(b||"").match(G)||[""]).length;j--;)if(o=q=(h=fa.exec(b[j])||[])[1],p=(h[2]||"").split(".").sort(),o){for(l=n.event.special[o]||{},m=i[o=(d?l.delegateType:l.bindType)||o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&!1!==l.teardown.call(a,p,r.handle)||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&N.remove(a,"handle events")}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(N.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||!1!==k.preDispatch.call(this,a)){for(h=n.event.handlers.call(this,a,j),b=0;(f=h[b++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,c=0;(g=f.handlers[c++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,void 0!==(d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i))&&!1===(a.result=d)&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!==this;i=i.parentNode||this)if(1===i.nodeType&&(!0!==i.disabled||"click"!==a.type)){for(d=[],c=0;h>c;c++)void 0===d[e=(f=b[c]).selector+" "]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button;return null==a.pageX&&null!=b.clientX&&(e=(c=a.target.ownerDocument||d).documentElement,f=c.body,a.pageX=b.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];for(h||(this.fixHooks[f]=h=ea.test(f)?this.mouseHooks:da.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;b--;)a[c=e[b]]=g[c];return a.target||(a.target=d),3===a.target.nodeType&&(a.target=a.target.parentNode),h.filter?h.filter(a,g):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==ia()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===ia()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?ga:ha):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:ha,isPropagationStopped:ha,isImmediatePropagationStopped:ha,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ga,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ga,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ga,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,e=a.relatedTarget,f=a.handleObj;return e&&(e===this||n.contains(this,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),n.fn.extend({on:function(a,b,c,d){return ja(this,a,b,c,d)},one:function(a,b,c,d){return ja(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return!1!==b&&"function"!=typeof b||(c=b,b=void 0),!1===c&&(c=ha),this.each(function(){n.event.remove(this,a,c,b)})}});var ka=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,la=/<script|<style|<link/i,ma=/checked\s*(?:[^=]|=\s*.checked.)/i,na=/^true\/(.*)/,oa=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function pa(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function qa(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function ra(a){var b=na.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function sa(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(N.hasData(a)&&(f=N.access(a),g=N.set(b,f),j=f.events))for(e in delete g.handle,g.events={},j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c]);O.hasData(a)&&(h=O.access(a),i=n.extend({},h),O.set(b,i))}}function ta(a,b){var c=b.nodeName.toLowerCase();"input"===c&&X.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function ua(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&ma.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),ua(f,b,c,d)});if(o&&(g=(e=ca(b,a[0].ownerDocument,!1,a,d)).firstChild,1===e.childNodes.length&&(e=g),g||d)){for(i=(h=n.map(_(e,"script"),qa)).length;o>m;m++)j=e,m!==p&&(j=n.clone(j,!0,!0),i&&n.merge(h,_(j,"script"))),c.call(a[m],j,m);if(i)for(k=h[h.length-1].ownerDocument,n.map(h,ra),m=0;i>m;m++)j=h[m],Z.test(j.type||"")&&!N.access(j,"globalEval")&&n.contains(k,j)&&(j.src?n._evalUrl&&n._evalUrl(j.src):n.globalEval(j.textContent.replace(oa,"")))}return a}function va(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(_(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&aa(_(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(ka,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=_(h),d=0,e=(f=_(a)).length;e>d;d++)ta(f[d],g[d]);if(b)if(c)for(f=f||_(a),g=g||_(h),d=0,e=f.length;e>d;d++)sa(f[d],g[d]);else sa(a,h);return(g=_(h,"script")).length>0&&aa(g,!i&&_(a,"script")),h},cleanData:function(a){for(var b,c,d,e=n.event.special,f=0;void 0!==(c=a[f]);f++)if(L(c)){if(b=c[N.expando]){if(b.events)for(d in b.events)e[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);c[N.expando]=void 0}c[O.expando]&&(c[O.expando]=void 0)}}}),n.fn.extend({domManip:ua,detach:function(a){return va(this,a,!0)},remove:function(a){return va(this,a)},text:function(a){return K(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return ua(this,arguments,function(a){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||pa(this,a).appendChild(a)})},prepend:function(){return ua(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=pa(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return ua(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return ua(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(_(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return K(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!la.test(a)&&!$[(Y.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)1===(b=this[c]||{}).nodeType&&(n.cleanData(_(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return ua(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(_(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),f=e.length-1,h=0;f>=h;h++)c=h===f?this:this.clone(!0),n(e[h])[b](c),g.apply(d,c.get());return this.pushStack(d)}});var wa,xa={HTML:"block",BODY:"block"};function ya(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function za(a){var b=d,c=xa[a];return c||("none"!==(c=ya(a,b))&&c||((b=(wa=(wa||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement))[0].contentDocument).write(),b.close(),c=ya(a,b),wa.detach()),xa[a]=c),c}var Aa=/^margin/,Ba=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Ca=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Da=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];for(f in e=c.apply(a,d||[]),b)a.style[f]=g[f];return e},Ea=d.documentElement;function Fa(a,b,c){var d,e,f,g,h=a.style;return""!==(g=(c=c||Ca(a))?c.getPropertyValue(b)||c[b]:void 0)&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Ba.test(g)&&Aa.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0!==g?g+"":g}function Ga(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,e,f,g=d.createElement("div"),h=d.createElement("div");if(h.style){function i(){h.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",h.innerHTML="",Ea.appendChild(g);var d=a.getComputedStyle(h);b="1%"!==d.top,f="2px"===d.marginLeft,c="4px"===d.width,h.style.marginRight="50%",e="4px"===d.marginRight,Ea.removeChild(g)}h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===h.style.backgroundClip,g.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",g.appendChild(h),n.extend(l,{pixelPosition:function(){return i(),b},boxSizingReliable:function(){return null==c&&i(),c},pixelMarginRight:function(){return null==c&&i(),e},reliableMarginLeft:function(){return null==c&&i(),f},reliableMarginRight:function(){var b,c=h.appendChild(d.createElement("div"));return c.style.cssText=h.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",h.style.width="1px",Ea.appendChild(g),b=!parseFloat(a.getComputedStyle(c).marginRight),Ea.removeChild(g),h.removeChild(c),b}})}}();var Ha=/^(none|table(?!-c[ea]).+)/,Ia={position:"absolute",visibility:"hidden",display:"block"},Ja={letterSpacing:"0",fontWeight:"400"},Ka=["Webkit","O","Moz","ms"],La=d.createElement("div").style;function Ma(a){if(a in La)return a;for(var b=a[0].toUpperCase()+a.slice(1),c=Ka.length;c--;)if((a=Ka[c]+b)in La)return a}function Na(a,b,c){var d=T.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Oa(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+U[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+U[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+U[f]+"Width",!0,e))):(g+=n.css(a,"padding"+U[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+U[f]+"Width",!0,e)));return g}function Pa(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ca(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if((0>(e=Fa(a,b,f))||null==e)&&(e=a.style[b]),Ba.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Oa(a,b,c||(g?"border":"content"),d,f)+"px"}function Qa(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)(d=a[g]).style&&(f[g]=N.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&V(d)&&(f[g]=N.access(d,"olddisplay",za(d.nodeName)))):(e=V(d),"none"===c&&e||N.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)(d=a[g]).style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Ra(a,b,c,d,e){return new Ra.prototype.init(a,b,c,d,e)}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Fa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Ma(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:("string"===(f=typeof c)&&(e=T.exec(c))&&e[1]&&(c=W(a,b,e),f="number"),void(null!=c&&c==c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c))))}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Ma(h)||h),(g=n.cssHooks[b]||n.cssHooks[h])&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Fa(a,b,d)),"normal"===e&&b in Ja&&(e=Ja[b]),""===c||c?(f=parseFloat(e),!0===c||isFinite(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Ha.test(n.css(a,"display"))&&0===a.offsetWidth?Da(a,Ia,function(){return Pa(a,b,d)}):Pa(a,b,d):void 0},set:function(a,c,d){var e,f=d&&Ca(a),g=d&&Oa(a,b,d,"border-box"===n.css(a,"boxSizing",!1,f),f);return g&&(e=T.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=n.css(a,b)),Na(0,c,g)}}}),n.cssHooks.marginLeft=Ga(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Fa(a,"marginLeft"))||a.getBoundingClientRect().left-Da(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px":void 0}),n.cssHooks.marginRight=Ga(l.reliableMarginRight,function(a,b){return b?Da(a,{display:"inline-block"},Fa,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+U[d]+b]=f[d]||f[d-2]||f[0];return e}},Aa.test(a)||(n.cssHooks[a+b].set=Na)}),n.fn.extend({css:function(a,b){return K(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ca(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Qa(this,!0)},hide:function(){return Qa(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){V(this)?n(this).show():n(this).hide()})}}),n.Tween=Ra,Ra.prototype={constructor:Ra,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Ra.propHooks[this.prop];return a&&a.get?a.get(this):Ra.propHooks._default.get(this)},run:function(a){var b,c=Ra.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ra.propHooks._default.set(this),this}},Ra.prototype.init.prototype=Ra.prototype,Ra.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""))&&"auto"!==b?b:0},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},Ra.propHooks.scrollTop=Ra.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=Ra.prototype.init,n.fx.step={};var Sa,Ta,Ua=/^(?:toggle|show|hide)$/,Va=/queueHooks$/;function Wa(){return a.setTimeout(function(){Sa=void 0}),Sa=n.now()}function Xa(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)e["margin"+(c=U[d])]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ya(a,b,c){for(var d,e=(_a.tweeners[b]||[]).concat(_a.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function _a(a,b,c){var d,e,f=0,g=_a.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Sa||Wa(),c=Math.max(0,j.startTime+j.duration-b),f=1-(c/j.duration||0),g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:Sa||Wa(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(function(a,b){var c,d,e,f,g;for(c in a)if(e=b[d=n.camelCase(c)],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),(g=n.cssHooks[d])&&"expand"in g)for(c in f=g.expand(f),delete a[d],f)c in a||(a[c]=f[c],b[c]=e);else b[d]=e}(k,j.opts.specialEasing);g>f;f++)if(d=_a.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,Ya,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(_a,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return W(c.elem,a,T.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],_a.tweeners[c]=_a.tweeners[c]||[],_a.tweeners[c].unshift(b)},prefilters:[function(a,b,c){var d,e,f,g,h,i,j,l=this,m={},o=a.style,p=a.nodeType&&V(a),q=N.get(a,"fxshow");for(d in c.queue||(null==(h=n._queueHooks(a,"fx")).unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],"inline"===("none"===(j=n.css(a,"display"))?N.get(a,"olddisplay")||za(a.nodeName):j)&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),b)if(e=b[d],Ua.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?za(a.nodeName):j)&&(o.display=j);else for(d in q?"hidden"in q&&(p=q.hidden):q=N.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;for(b in N.remove(a,"fxshow"),m)n.style(a,b,m[b])}),m)g=Ya(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}],prefilter:function(a,b){b?_a.prefilters.unshift(a):_a.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&!0!==d.queue||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(V).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=_a(this,n.extend({},a),f);(e||N.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||!1===f.queue?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=N.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Va.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var b,c=N.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Xa(b,!0),a,d,e)}}),n.each({slideDown:Xa("show"),slideUp:Xa("hide"),slideToggle:Xa("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Sa=n.now();b<c.length;b++)(a=c[b])()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),Sa=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Ta||(Ta=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(Ta),Ta=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx&&n.fx.speeds[b]||b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),b=d.createElement("select"),c=b.appendChild(d.createElement("option"));a.type="checkbox",l.checkOn=""!==a.value,l.optSelected=c.selected,b.disabled=!0,l.optDisabled=!c.disabled,(a=d.createElement("input")).value="t",a.type="radio",l.radioValue="t"===a.value}();var ab,bb=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return K(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return void 0===a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ab:void 0)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:null==(d=n.find.attr(a,b))?void 0:d)},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)for(;c=f[e++];)d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)}}),ab={set:function(a,b,c){return!1===b?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=bb[b]||n.find.attr;bb[b]=function(a,b,d){var e,f;return d||(f=bb[b],bb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,bb[b]=f),e}});var cb=/^(?:input|select|textarea|button)$/i,db=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return K(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):cb.test(a.nodeName)||db.test(a.nodeName)&&a.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var eb=/[\t\r\n\f]/g;function fb(a){return a.getAttribute&&a.getAttribute("class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,fb(this)))});if("string"==typeof a&&a)for(b=a.match(G)||[];c=this[i++];)if(e=fb(c),d=1===c.nodeType&&(" "+e+" ").replace(eb," ")){for(g=0;f=b[g++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");e!==(h=n.trim(d))&&c.setAttribute("class",h)}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,fb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a)for(b=a.match(G)||[];c=this[i++];)if(e=fb(c),d=1===c.nodeType&&(" "+e+" ").replace(eb," ")){for(g=0;f=b[g++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");e!==(h=n.trim(d))&&c.setAttribute("class",h)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,fb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c)for(d=0,e=n(this),f=a.match(G)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else void 0!==a&&"boolean"!==c||((b=fb(this))&&N.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||!1===a?"":N.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;for(b=" "+a+" ";c=this[d++];)if(1===c.nodeType&&(" "+fb(c)+" ").replace(eb," ").indexOf(b)>-1)return!0;return!1}});var gb=/\r/g,hb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(null==(e=d?a.call(this,c,n(this).val()):a)?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),(b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()])&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))})):e?(b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()])&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:"string"==typeof(c=e.value)?c.replace(gb,""):null==c?"":c:void 0}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(hb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(((c=d[i]).selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=n.makeArray(b),g=e.length;g--;)((d=e[g]).selected=n.inArray(n.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var ib=/^(?:focusinfocus|focusoutblur)$/;n.extend(n.event,{trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!ib.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(q=(r=q.split(".")).shift(),r.sort()),l=q.indexOf(":")<0&&"on"+q,(b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b)).isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},f||!o.trigger||!1!==o.trigger.apply(e,c))){if(!f&&!o.noBubble&&!n.isWindow(e)){for(j=o.delegateType||q,ib.test(j+q)||(h=h.parentNode);h;h=h.parentNode)p.push(h),i=h;i===(e.ownerDocument||d)&&p.push(i.defaultView||i.parentWindow||a)}for(g=0;(h=p[g++])&&!b.isPropagationStopped();)b.type=g>1?j:o.bindType||q,(m=(N.get(h,"events")||{})[b.type]&&N.get(h,"handle"))&&m.apply(h,c),(m=l&&h[l])&&m.apply&&L(h)&&(b.result=m.apply(h,c),!1===b.result&&b.preventDefault());return b.type=q,f||b.isDefaultPrevented()||o._default&&!1!==o._default.apply(p.pop(),c)||!L(e)||l&&n.isFunction(e[q])&&!n.isWindow(e)&&((i=e[l])&&(e[l]=null),n.event.triggered=q,e[q](),n.event.triggered=void 0,i&&(e[l]=i)),b.result}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b)}}),n.fn.extend({trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),l.focusin="onfocusin"in a,l.focusin||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=N.access(d,b);e||d.addEventListener(a,c,!0),N.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=N.access(d,b)-1;e?N.access(d,b,e):(d.removeEventListener(a,c,!0),N.remove(d,b))}}});var jb=a.location,kb=n.now(),lb=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var mb=/#.*$/,nb=/([?&])_=[^&]*/,ob=/^(.*?):[ \t]*([^\r\n]*)$/gm,qb=/^(?:GET|HEAD)$/,rb=/^\/\//,sb={},tb={},ub="*/".concat("*"),vb=d.createElement("a");function wb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function xb(a,b,c,d){var e={},f=a===tb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function yb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}vb.href=jb.href,n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:jb.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(jb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ub,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?yb(yb(a,n.ajaxSettings),b):yb(n.ajaxSettings,a)},ajaxPrefilter:wb(sb),ajaxTransport:wb(tb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m=n.ajaxSetup({},c),o=m.context||m,p=m.context&&(o.nodeType||o.jquery)?n(o):n.event,q=n.Deferred(),r=n.Callbacks("once memory"),s=m.statusCode||{},t={},u={},v=0,w="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(2===v){if(!h)for(h={};b=ob.exec(g);)h[b[1].toLowerCase()]=b[2];b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===v?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return v||(a=u[c]=u[c]||a,t[a]=b),this},overrideMimeType:function(a){return v||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>v)for(b in a)s[b]=[s[b],a[b]];else x.always(a[x.status]);return this},abort:function(a){var b=a||w;return e&&e.abort(b),z(0,b),this}};if(q.promise(x).complete=r.add,x.success=x.done,x.error=x.fail,m.url=((b||m.url||jb.href)+"").replace(mb,"").replace(rb,jb.protocol+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=n.trim(m.dataType||"*").toLowerCase().match(G)||[""],null==m.crossDomain){j=d.createElement("a");try{j.href=m.url,j.href=j.href,m.crossDomain=vb.protocol+"//"+vb.host!=j.protocol+"//"+j.host}catch(y){m.crossDomain=!0}}if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=n.param(m.data,m.traditional)),xb(sb,m,c,x),2===v)return x;for(l in(k=n.event&&m.global)&&0==n.active++&&n.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!qb.test(m.type),f=m.url,m.hasContent||(m.data&&(f=m.url+=(lb.test(f)?"&":"?")+m.data,delete m.data),!1===m.cache&&(m.url=nb.test(f)?f.replace(nb,"$1_="+kb++):f+(lb.test(f)?"&":"?")+"_="+kb++)),m.ifModified&&(n.lastModified[f]&&x.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&x.setRequestHeader("If-None-Match",n.etag[f])),(m.data&&m.hasContent&&!1!==m.contentType||c.contentType)&&x.setRequestHeader("Content-Type",m.contentType),x.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+ub+"; q=0.01":""):m.accepts["*"]),m.headers)x.setRequestHeader(l,m.headers[l]);if(m.beforeSend&&(!1===m.beforeSend.call(o,x,m)||2===v))return x.abort();for(l in w="abort",{success:1,error:1,complete:1})x[l](m[l]);if(e=xb(tb,m,c,x)){if(x.readyState=1,k&&p.trigger("ajaxSend",[x,m]),2===v)return x;m.async&&m.timeout>0&&(i=a.setTimeout(function(){x.abort("timeout")},m.timeout));try{v=1,e.send(t,z)}catch(y){if(!(2>v))throw y;z(-1,y)}}else z(-1,"No Transport");function z(b,c,d,h){var j,l,t,u,w,y=c;2!==v&&(v=2,i&&a.clearTimeout(i),e=void 0,g=h||"",x.readyState=b>0?4:0,j=b>=200&&300>b||304===b,d&&(u=function(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}(m,x,d)),u=function(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(!(g=j[i+" "+f]||j["* "+f]))for(e in j)if((h=e.split(" "))[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){!0===g?g=j[e]:!0!==j[e]&&(f=h[0],k.unshift(h[1]));break}if(!0!==g)if(g&&a.throws)b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}(m,u,x,j),j?(m.ifModified&&((w=x.getResponseHeader("Last-Modified"))&&(n.lastModified[f]=w),(w=x.getResponseHeader("etag"))&&(n.etag[f]=w)),204===b||"HEAD"===m.type?y="nocontent":304===b?y="notmodified":(y=u.state,l=u.data,j=!(t=u.error))):(t=y,!b&&y||(y="error",0>b&&(b=0))),x.status=b,x.statusText=(c||y)+"",j?q.resolveWith(o,[l,y,x]):q.rejectWith(o,[x,y,t]),x.statusCode(s),s=void 0,k&&p.trigger(j?"ajaxSuccess":"ajaxError",[x,m,j?l:t]),r.fireWith(o,[x,y]),k&&(p.trigger("ajaxComplete",[x,m]),--n.active||n.event.trigger("ajaxStop")))}return x},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return!n.expr.filters.visible(a)},n.expr.filters.visible=function(a){return a.offsetWidth>0||a.offsetHeight>0||a.getClientRects().length>0};var Bb=/%20/g,Cb=/\[\]$/,Db=/\r?\n/g,Eb=/^(?:submit|button|image|reset|file)$/i,Fb=/^(?:input|select|textarea|keygen)/i;function Gb(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||Cb.test(a)?d(a,e):Gb(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Gb(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Gb(c,a[c],b,e);return d.join("&").replace(Bb,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Fb.test(this.nodeName)&&!Eb.test(a)&&(this.checked||!X.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(Db,"\r\n")}}):{name:b.name,value:c.replace(Db,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Hb={0:200,1223:204},Ib=n.ajaxSettings.xhr();l.cors=!!Ib&&"withCredentials"in Ib,l.ajax=Ib=!!Ib,n.ajaxTransport(function(b){var c,d;return l.cors||Ib&&!b.crossDomain?{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];for(g in b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Hb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){var b,c;if(a.crossDomain)return{send:function(e,f){b=n("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}});var Jb=[],Kb=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Jb.pop()||n.expando+"_"+kb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=!1!==b.jsonp&&(Kb.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Kb.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Kb,"$1"+e):!1!==b.jsonp&&(b.url+=(lb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Jb.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ca([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var Lb=n.fn.load;function Mb(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.fn.load=function(a,b,c){if("string"!=typeof a&&Lb)return Lb.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length},n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1?(g=(d=l.position()).top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;return f?(b=f.documentElement,n.contains(b,d)?(e=d.getBoundingClientRect(),c=Mb(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e):void 0},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&"static"===n.css(a,"position");)a=a.offsetParent;return a||Ea})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;n.fn[a]=function(d){return K(this,function(a,d,e){var f=Mb(a);return void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Ga(l.pixelPosition,function(a,c){return c?(c=Fa(a,b),Ba.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(!0===d||!0===e?"margin":"border");return K(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},size:function(){return this.length}}),n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Nb=a.jQuery,Ob=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Ob),b&&a.jQuery===n&&(a.jQuery=Nb),n},b||(a.jQuery=a.$=n),n}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){t.ui=t.ui||{},t.ui.version="1.12.1";var i=0,s=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{(s=t._data(n,"events"))&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},l=e.split(".")[0],h=l+"-"+(e=e.split(".")[1]);return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],o=t[l][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),(a=new i).options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?void(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}()):void(r[e]=s)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n&&a.widgetEventPrefix||e},r,{constructor:o,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,n,o=s.call(arguments,1),a=0,r=o.length;r>a;a++)for(i in o[a])n=o[a][i],o[a].hasOwnProperty(i)&&void 0!==n&&(e[i]=t.isPlainObject(n)?t.isPlainObject(e[i])?t.widget.extend({},e[i],n):t.widget.extend({},n):n);return e},t.widget.bridge=function(e,i){var n=i.prototype.widgetFullName||e;t.fn[e]=function(o){var a="string"==typeof o,r=s.call(arguments,1),l=this;return a?this.length||"instance"!==o?this.each(function(){var i,s=t.data(this,n);return"instance"===o?(l=s,!1):s?t.isFunction(s[o])&&"_"!==o.charAt(0)?(i=s[o].apply(s,r))!==s&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0:t.error("no such method '"+o+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+o+"'")}):l=void 0:(r.length&&(o=t.widget.extend.apply(null,[o].concat(r))),this.each(function(){var e=t.data(this,n);e?(e.option(o||{}),e._init&&e._init()):t.data(this,n,new i(o,this))})),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},e=(s=e.split(".")).shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||!0!==o.options.disabled&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+o.eventNamespace,c=l[2];c?n.on(h,c,r):i.on(h,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){var s=this;return setTimeout(function(){return("string"==typeof t?s[t]:t).apply(s,arguments)},e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},(i=t.Event(i)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&!1===a.apply(this.element[0],[i].concat(s))||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?!0===n||"number"==typeof n?i:n.effect||i:e;"number"==typeof(n=n||{})&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}var n,o=Math.max,a=Math.abs,r=/left|center|right/,l=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),e===(i=o.offsetWidth)&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth;return{width:"scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:!s&&!n?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=function(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):l.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=l.test(i[1])?i[1]:"center",t=h.exec(i[0]),e=h.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,l=t(this),h=l.outerWidth(),c=l.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=h+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),T=e(k.my,l.outerWidth(),l.outerHeight());"right"===n.my[0]?D.left-=h:"center"===n.my[0]&&(D.left-=h/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=T[0],D.top+=T[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:h,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+T[0],u[1]+T[1]],my:n.my,at:n.at,within:b,elem:l})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-h,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:l,left:D.left,top:D.top,width:h,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};h>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),l.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,l=n-r,h=r+e.collisionWidth-a-n;e.collisionWidth>a?l>0&&0>=h?(i=t.left+l+e.collisionWidth-a-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+a-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,l=n-r,h=r+e.collisionHeight-a-n;e.collisionHeight>a?l>0&&0>=h?(i=t.top+l+e.collisionHeight-a-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+a-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-l,u=h+e.collisionWidth-r-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(0>(i=t.left+d+p+f+e.collisionWidth-r-o)||a(c)>i)&&(t.left+=d+p+f):u>0&&(((s=t.left-e.collisionPosition.marginLeft+d+p+f-l)>0||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-l,u=h+e.collisionHeight-r-l,p="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(0>(s=t.top+p+f+g+e.collisionHeight-r-o)||a(c)>s)&&(t.top+=p+f+g):u>0&&(((i=t.top-e.collisionPosition.marginTop+p+f+g-l)>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}}),t.ui.focusable=function(i,s){var n,o,a,r,l,h=i.nodeName.toLowerCase();return"area"===h?(o=(n=i.parentNode).name,!(!i.href||!o||"map"!==n.nodeName.toLowerCase())&&((a=t("img[usemap='#"+o+"']")).length>0&&a.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(h)?(r=!i.disabled)&&((l=t(i).closest("fieldset")[0])&&(r=!l.disabled)):r="a"===h&&i.href||s,r&&t(i).is(":visible")&&function(t){for(var e=t.css("visibility");"inherit"===e;)e=(t=t.parent()).css("visibility");return"hidden"!==e}(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),(s=this.attr("id"))&&(o=(e=this.eq(0).parents().last()).add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return(!s||"static"!==e.css("position"))&&n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var n=!1;t(document).on("mouseup",function(){n=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!n){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,o=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&t(e.target).closest(this.options.cancel).length;return!(s&&!o&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),n=!0,!0))}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,n=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.options;return!(this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(e),!!this.handle&&(this._blurActiveElement(e),this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),!0))},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]);t(e.target).closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(!1===this._trigger("drag",e,s))return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||!0===this.options.revert||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",e)&&i._clear()}):!1!==this._trigger("stop",e)&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!t(e.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===n.containment?void(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):n.containment.constructor===Array?void(this.containment=n.containment):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),void((s=(i=t(n.containment))[0])&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),l=t.pageX,h=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(l=this.originalPageX),"x"===a.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),!1!==o&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,l,h,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)h=(l=s.snapElements[d].left-s.margins.left)+s.snapElements[d].width,u=(c=s.snapElements[d].top-s.margins.top)+s.snapElements[d].height,l-g>_||m>h+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(l-_),r=g>=Math.abs(h-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(l-m),r=g>=Math.abs(h-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0||(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)n="ui-resizable-"+(e=t.trim(s[i])),o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;for(i in e=e||this.element,this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)((s=t(this.handles[i])[0])===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1)},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,l,h=this.options,c=this;return this._helper&&(n=(s=(i=this._proportionallyResizeElements).length&&/textarea/i.test(i[0].nodeName))&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,l=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,h.animate||this.element.css(t.extend(a,{top:l,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,h=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&h&&(t.left=r-e.minWidth),s&&h&&(t.left=r-e.maxWidth),a&&c&&(t.top=l-e.minHeight),n&&c&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize;return{left:this.originalPosition.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize;return{top:this.originalPosition.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,l={width:i.size.width-r,height:i.size.height-a},h=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,c&&h?{top:c,left:h}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,l=t(this).resizable("instance"),h=l.options,c=l.element,u=h.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(l.containerElement=t(d),/document/.test(u)||u===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=l._num(e.css("padding"+s))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,a=l._hasScroll(d,"left")?d.scrollWidth:o,r=l._hasScroll(d)?d.scrollHeight:n,l.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,l=a.containerOffset,h=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=l),h.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?l.left:0),h.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?l.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-l.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-l.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),l=a.outerWidth()-e.sizeDiff.width,h=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var i=t(this).resizable("instance").options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),!1!==t.uiBackCompat&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,h=l[0]||1,c=l[1]||1,u=Math.round((n.width-o.width)/h)*h,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=l,_&&(p+=h),v&&(f+=c),g&&(p-=h),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-h)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-h>0?(i.size.width=p,i.position.left=a.left-u):(p=h-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,l=e.pageY;return o>r&&(i=r,r=o,o=i),a>l&&(i=l,l=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:l-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?h=!(c.left>r||o>c.right||c.top>l||a>c.bottom):"fit"===n.tolerance&&(h=c.left>o&&r>c.right&&c.top>a&&l>c.bottom),h?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),!!s&&(!(this.options.handle&&!i&&(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),!n))&&(this.currentItem=s,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),!1!==r&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=(s=this.items[i]).item[0],(o=this._intersectsWithPointer(s))&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"!==this.options.type||!t.contains(this.element[0],n))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,l=r+t.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+h>r&&l>s+h,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width);return!!(s&&n)&&(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],l=[],h=this._connectWith();if(h&&e)for(s=h.length-1;s>=0;s--)for(n=(o=t(h[s],this.document[0])).length-1;n>=0;n--)(a=t.data(o[n],this.widgetFullName))&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=l.length-1;s>=0;s--)l[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,l,h,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(s=(n=t(d[i],this.document[0])).length-1;s>=0;s--)(o=t.data(n[s],this.widgetFullName))&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],s=0,h=(r=u[i][0]).length;h>s;s++)(l=t(r[s])).data(this.widgetName+"-item",a),c.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){var i,s,n,o;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(s=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){var i,s=(e=e||this).options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,l,h,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,a=(c=d.floating||this._isFloating(this.currentItem))?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[a],h=!1,e[u]-l>this.items[s][r]/2&&(h=!0),n>Math.abs(e[u]-l)&&(n=Math.abs(e[u]-l),o=this.items[s],this.direction=h?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===t.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]))&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var i=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),(i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var i,s,n,o,a=this,r=this.options.icons.submenu,l=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=l.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),(i=l.add(this.element).find(this.options.items)).not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),o=(n=i.not(".ui-menu-item, .ui-menu-divider")).children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=e.children(".ui-menu")).length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?void(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return 0>(i=t(this)).offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var i,s,n;return this.active?void(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return(i=t(this)).offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,void(i=!0);e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault());if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)})):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),void((s=i.item.attr("aria-label")||n.value)&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion))))},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):!1!==this._trigger("search",e)?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var o=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a={};return n?"controlgroupLabel"===s?((o=e.element.find(n)).each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(o.get()))):void(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),r=t.widget.extend({},a);if("button"!==s||!n.parent(".ui-spinner").length){o||(o=n[s]()[s]("instance")),o&&(r.classes=e._resolveClassesValues(r.classes,o)),n[s](r);var l=n[s]("widget");t.data(l[0],"ui-controlgroup-data",o||n[s]("instance")),i.push(l[0])}}))):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var s=t(this).data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:!!e&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var a=i.options.classes[n]||"";a=t.trim(a.replace(o,"")),s[n]=(a+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?void this._callChildMethod(e?"disable":"enable"):void this.refresh()},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":s);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),null!=(e=this.element[0].disabled)&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length})).not(this.element):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),void(this.element[0].disabled=e)):void this.refresh()):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),null!=(t=this.element[0].disabled)&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),!1!==t.uiBackCompat&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?void this._super("showLabel",e):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(t=e.parent.children().eq(e.index)).length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&!1!==this._trigger("beforeClose",e)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]);this.uiDialog[0]===e||t.contains(this.uiDialog[0],e)||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(r>=0?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),l=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" top"+(l>=0?"+":"")+l,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var s,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&((s=o.is(":data(ui-draggable)"))&&!i&&o.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((n=o.is(":data(ui-resizable)"))&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||!1===i||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!t(e.target).closest(".ui-dialog").length||!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),!1!==t.uiBackCompat&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog;var a="ui-effects-",r="ui-effects-style",l="ui-effects-animated",h=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=h(),n=s._rgba=[];return i=i.toLowerCase(),f(l,function(t,o){var a,r=o.re.exec(i),l=r&&o.parse(r),h=o.space||"rgba";return l?(a=s[h](l),s[c[h].cache]=a[c[h].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return 1>6*(i=(i+1)%1)?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,r=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],h=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),h.fn=t.extend(h.prototype,{parse:function(n,a,r,l){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,l],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(f(c,n instanceof h?function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}:function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=h(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=h(t),n=s._space(),o=c[n],a=0===this.alpha()?h("transparent"):this,r=a[o.cache]||o.to(a._rgba),l=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],h=s[o],c=u[n.type]||{};null!==h&&(null===a?l[o]=h:(c.mod&&(h-a>c.mod/2?a+=c.mod:a-h>c.mod/2&&(a-=c.mod)),l[o]=i((h-a)*e+a,n)))}),this[n](l)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=h(e)._rgba;return h(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return 1===(t=(t||0).toString(16)).length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),l=Math.min(s,n,o),h=r-l,c=r+l,u=.5*c;return e=l===r?0:s===r?60*(n-o)/h+360:n===r?60*(o-s)/h+120:60*(s-n)/h+240,i=0===h?0:.5>=u?h/c:h/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,l=n.to,c=n.from;h.fn[s]=function(s){if(l&&!this[a]&&(this[a]=l(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?((n=h(c(d)))[a]=d,n):h(d)},f(o,function(e,i){h.fn[e]||(h.fn[e]=function(n){var o,a=t.type(n),l="alpha"===e?this._hsla?"hsla":"rgba":s,h=this[l](),c=h[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&((o=r.exec(n))&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),h[i.idx]=n,this[l](h)))})})}),h.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=h(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(l){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(l){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=h(e.elem,i),e.end=h(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},h.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(h),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)"string"==typeof n[i=n[s]]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(h.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var l=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",h=l.children?a.find("*").addBack():a;h=h.map(function(){return{el:t(this),start:e(this)}}),(o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})})(),h=h.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),h=h.map(function(){var e=this,i=t.Deferred(),s=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,h.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!(e&&"number"!=typeof e&&!t.fx.speeds[e])||("string"==typeof e&&!t.effects.effect[e]||(!!t.isFunction(e)||"object"==typeof e&&!e.effect))}function s(t,e){var i=e.outerWidth(),s=e.outerHeight(),o=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/.exec(t)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(l)||e(i)}}(t.expr.filters.animated)),!1!==t.uiBackCompat&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;s>i;i++)null!==e[i]&&t.data(a+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;n>s;s++)null!==e[s]&&(i=t.data(a+e[s]),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),float:e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();e>1&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(r,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(r)||"",t.removeData(r)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),float:e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(a+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=a+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function a(){t.isFunction(h)&&h.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=u.shift(),!1===t.uiBackCompat||o?"none"===s.mode?(r[c](),a()):n.call(r[0],s,function(){r.removeData(l),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}):(r.is(":hidden")?"hide"===c:"show"===c)?(r[c](),a()):n.call(r[0],s,a)}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",h=s.complete,c=s.mode,u=[],d=function(e){var i=t(this),s=t.effects.mode(i,c)||o;i.data(l,!0),u.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?c?this[c](s.duration,h):this.each(function(){h&&h.call(this)}):!1===a?this.each(d).each(i):this.queue(r,d).queue(r,i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,l=o?a.scrollLeft():0,h=n.offset(),c={top:h.top-r,left:h.left-l,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-l,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}(),t.effects,t.effects.define("size",function(e,i){var s,n,o,a=t(this),r=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=e.mode,u="effect"!==c,d=e.scale||"both",p=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===c&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,l,n.from.y,_),v=t.effects.setTransition(a,l,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,h,n.from.x,_),v=t.effects.setTransition(a,h,n.to.x,v))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),p&&(s=t.effects.getBaseline(p,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),("content"===d||"both"===d)&&(l=l.concat(["marginTop","marginBottom"]).concat(r),h=h.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),s=t.effects.scaledDimensions(i),o={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},a={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,l,n.from.y,o),a=t.effects.setTransition(i,l,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,h,n.from.x,o),a=t.effects.setTransition(i,h,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)})}),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>2)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 3")}(jQuery),function(a){"use strict";a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});return setTimeout(function(){c||a(d).trigger(a.support.transition.end)},b),this},a(function(){a.support.transition=function(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),function(a){"use strict";var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.6",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=(f=e.attr("href"))&&f.replace(/.*(?=#[^\s]*$)/,""));var g=a(f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})},a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.6",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")?(c.prop("checked")&&(a=!1),b.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==c.prop("type")&&(c.prop("checked")!==this.$element.hasClass("active")&&(a=!1),this.$element.toggleClass("active")),c.prop("checked",this.$element.hasClass("active")),a&&c.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target);d.hasClass("btn")||(d=d.closest(".btn")),b.call(d,"toggle"),a(c.target).is('input[type="radio"]')||a(c.target).is('input[type="checkbox"]')||c.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(b){a(b.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(b.type))})}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.6",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b);if(("prev"==a&&0===c||"next"==a&&c==this.$items.length-1)&&!this.options.wrap)return b;var f=(c+("prev"==a?-1:1))%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));return a>this.$items.length-1||0>a?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){return this.sliding?void 0:this.slide("next")},c.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i=this;if(f.hasClass("active"))return this.sliding=!1;var j=f[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&/show|hide/.test(b)&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a('[data-toggle="collapse"][href="#'+b.id+'"],[data-toggle="collapse"][data-target="#'+b.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.6",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0},d.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),h=f.data("bs.collapse")?"toggle":e.data();c.call(f,h)})}(jQuery),function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=(c=b.attr("href"))&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.bs.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",f)))))}))}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.6",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.bs.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var i=e.find(".dropdown-menu li:not(.disabled):visible a");if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",c).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",g.prototype.keydown)}(jQuery),function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.6",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){d.$element.one("mouseup.dismiss.bs.modal",function(b){a(b.target).is(d.$element)&&(d.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in"),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$dialog.one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+e).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.adjustDialog()},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){var a=window.innerWidth;if(!a){var b=document.documentElement.getBoundingClientRect();a=b.right-Math.abs(b.left)}this.bodyIsOverflowing=document.body.clientWidth<a,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),function(a){"use strict";var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",a,b)};c.VERSION="3.3.6",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return(b=a.extend({},this.getDefaults(),this.$element.data(),b)).delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusin"==b.type?"focus":"hover"]=!0),c.tip().hasClass("in")||"in"==c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusout"==b.type?"focus":"hover"]=!1),c.isInStateTrue()?void 0:(clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide())},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h="bottom"==h&&k.bottom+m>o.bottom?"top":"top"==h&&k.top-m<o.top?"bottom":"right"==h&&k.right+l>o.width?"left":"left"==h&&k.left-l<o.left?"right":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);return this.$element.trigger(g),g.isDefaultPrevented()?void 0:(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){var c=(b=b||this.$element)[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var b=this.$element,c=this.options;return b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do{a+=~~(1e6*Math.random())}while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&((c=a(b.currentTarget).data("bs."+this.type))||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null})};var d=a.fn.tooltip;a.fn.tooltip=function(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})},a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),function(a){"use strict";var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.6",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var d=a.fn.popover;a.fn.popover=function(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})},a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.6",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c="position",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.6",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=(d=b.attr("href"))&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),b.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu").length&&b.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',e).on("click.bs.tab.data-api",'[data-toggle="pill"]',e)}(jQuery),function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.6",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return c>e&&"top";if("bottom"==this.affixed)return null!=c?!(e+this.unpin<=f.top)&&"bottom":!(a-d>=e+g)&&"bottom";var h=null==this.affixed,i=h?e:f.top;return null!=c&&c>=e?"top":null!=d&&i+(h?g:b)>=a-d&&"bottom"},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=Math.max(a(document).height(),a(document.body).height());"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery),function(){function n(n){return function(r,e,u,i){e=b(e,i,4);var o=!k(r)&&m.keys(r),a=(o||r).length,c=n>0?0:a-1;return arguments.length<3&&(u=r[o?o[c]:c],c+=n),function(t,r,e,u,i,o){for(;i>=0&&o>i;i+=n){var a=u?u[i]:i;e=r(e,t[a],a,t)}return e}(r,e,u,o,c,a)}}function t(n){return function(t,r,e){r=x(r,e);for(var u=O(t),i=n>0?0:u-1;i>=0&&u>i;i+=n)if(r(t[i],i,t))return i;return-1}}function r(n,t,r){return function(e,u,i){var o=0,a=O(e);if("number"==typeof i)n>0?o=i>=0?i:Math.max(i+a,o):a=i>=0?Math.min(i+1,a):i+a+1;else if(r&&i&&a)return e[i=r(e,u)]===u?i:-1;if(u!=u)return(i=t(l.call(e,o,a),m.isNaN))>=0?i+o:-1;for(i=n>0?o:a-1;i>=0&&a>i;i+=n)if(e[i]===u)return i;return-1}}function e(n,t){var r=I.length,e=n.constructor,u=m.isFunction(e)&&e.prototype||a,i="constructor";for(m.has(n,i)&&!m.contains(t,i)&&t.push(i);r--;)(i=I[r])in n&&n[i]!==u[i]&&!m.contains(t,i)&&t.push(i)}var u=this,i=u._,o=Array.prototype,a=Object.prototype,c=Function.prototype,f=o.push,l=o.slice,s=a.toString,p=a.hasOwnProperty,h=Array.isArray,v=Object.keys,g=c.bind,y=Object.create,d=function(){},m=function(n){return n instanceof m?n:this instanceof m?void(this._wrapped=n):new m(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports._=m):u._=m,m.VERSION="1.8.3";var b=function(n,t,r){if(void 0===t)return n;switch(null==r?3:r){case 1:return function(r){return n.call(t,r)};case 2:return function(r,e){return n.call(t,r,e)};case 3:return function(r,e,u){return n.call(t,r,e,u)};case 4:return function(r,e,u,i){return n.call(t,r,e,u,i)}}return function(){return n.apply(t,arguments)}},x=function(n,t,r){return null==n?m.identity:m.isFunction(n)?b(n,t,r):m.isObject(n)?m.matcher(n):m.property(n)};m.iteratee=function(n,t){return x(n,t,1/0)};var _=function(n,t){return function(r){var e=arguments.length;if(2>e||null==r)return r;for(var u=1;e>u;u++)for(var i=arguments[u],o=n(i),a=o.length,c=0;a>c;c++){var f=o[c];t&&void 0!==r[f]||(r[f]=i[f])}return r}},j=function(n){if(!m.isObject(n))return{};if(y)return y(n);d.prototype=n;var t=new d;return d.prototype=null,t},w=function(n){return function(t){return null==t?void 0:t[n]}},A=Math.pow(2,53)-1,O=w("length"),k=function(n){var t=O(n);return"number"==typeof t&&t>=0&&A>=t};m.each=m.forEach=function(n,t,r){var e,u;if(t=b(t,r),k(n))for(e=0,u=n.length;u>e;e++)t(n[e],e,n);else{var i=m.keys(n);for(e=0,u=i.length;u>e;e++)t(n[i[e]],i[e],n)}return n},m.map=m.collect=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=Array(u),o=0;u>o;o++){var a=e?e[o]:o;i[o]=t(n[a],a,n)}return i},m.reduce=m.foldl=m.inject=n(1),m.reduceRight=m.foldr=n(-1),m.find=m.detect=function(n,t,r){var e;return void 0!==(e=k(n)?m.findIndex(n,t,r):m.findKey(n,t,r))&&-1!==e?n[e]:void 0},m.filter=m.select=function(n,t,r){var e=[];return t=x(t,r),m.each(n,function(n,r,u){t(n,r,u)&&e.push(n)}),e},m.reject=function(n,t,r){return m.filter(n,m.negate(x(t)),r)},m.every=m.all=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;if(!t(n[o],o,n))return!1}return!0},m.some=m.any=function(n,t,r){t=x(t,r);for(var e=!k(n)&&m.keys(n),u=(e||n).length,i=0;u>i;i++){var o=e?e[i]:i;if(t(n[o],o,n))return!0}return!1},m.contains=m.includes=m.include=function(n,t,r,e){return k(n)||(n=m.values(n)),("number"!=typeof r||e)&&(r=0),m.indexOf(n,t,r)>=0},m.invoke=function(n,t){var r=l.call(arguments,2),e=m.isFunction(t);return m.map(n,function(n){var u=e?t:n[t];return null==u?u:u.apply(n,r)})},m.pluck=function(n,t){return m.map(n,m.property(t))},m.where=function(n,t){return m.filter(n,m.matcher(t))},m.findWhere=function(n,t){return m.find(n,m.matcher(t))},m.max=function(n,t,r){var e,u,i=-1/0,o=-1/0;if(null==t&&null!=n)for(var a=0,c=(n=k(n)?n:m.values(n)).length;c>a;a++)(e=n[a])>i&&(i=e);else t=x(t,r),m.each(n,function(n,r,e){((u=t(n,r,e))>o||u===-1/0&&i===-1/0)&&(i=n,o=u)});return i},m.min=function(n,t,r){var e,u,i=1/0,o=1/0;if(null==t&&null!=n)for(var a=0,c=(n=k(n)?n:m.values(n)).length;c>a;a++)e=n[a],i>e&&(i=e);else t=x(t,r),m.each(n,function(n,r,e){u=t(n,r,e),(o>u||1/0===u&&1/0===i)&&(i=n,o=u)});return i},m.shuffle=function(n){for(var t,r=k(n)?n:m.values(n),e=r.length,u=Array(e),i=0;e>i;i++)(t=m.random(0,i))!==i&&(u[i]=u[t]),u[t]=r[i];return u},m.sample=function(n,t,r){return null==t||r?(k(n)||(n=m.values(n)),n[m.random(n.length-1)]):m.shuffle(n).slice(0,Math.max(0,t))},m.sortBy=function(n,t,r){return t=x(t,r),m.pluck(m.map(n,function(n,r,e){return{value:n,index:r,criteria:t(n,r,e)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||void 0===r)return 1;if(e>r||void 0===e)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={};return r=x(r,e),m.each(t,function(e,i){var o=r(e,i,t);n(u,e,o)}),u}};m.groupBy=F(function(n,t,r){m.has(n,r)?n[r].push(t):n[r]=[t]}),m.indexBy=F(function(n,t,r){n[r]=t}),m.countBy=F(function(n,t,r){m.has(n,r)?n[r]++:n[r]=1}),m.toArray=function(n){return n?m.isArray(n)?l.call(n):k(n)?m.map(n,m.identity):m.values(n):[]},m.size=function(n){return null==n?0:k(n)?n.length:m.keys(n).length},m.partition=function(n,t,r){t=x(t,r);var e=[],u=[];return m.each(n,function(n,r,i){(t(n,r,i)?e:u).push(n)}),[e,u]},m.first=m.head=m.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:m.initial(n,n.length-t)},m.initial=function(n,t,r){return l.call(n,0,Math.max(0,n.length-(null==t||r?1:t)))},m.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:m.rest(n,Math.max(0,n.length-t))},m.rest=m.tail=m.drop=function(n,t,r){return l.call(n,null==t||r?1:t)},m.compact=function(n){return m.filter(n,m.identity)};var S=function(n,t,r,e){for(var u=[],i=0,o=e||0,a=O(n);a>o;o++){var c=n[o];if(k(c)&&(m.isArray(c)||m.isArguments(c))){t||(c=S(c,t,r));var f=0,l=c.length;for(u.length+=l;l>f;)u[i++]=c[f++]}else r||(u[i++]=c)}return u};m.flatten=function(n,t){return S(n,t,!1)},m.without=function(n){return m.difference(n,l.call(arguments,1))},m.uniq=m.unique=function(n,t,r,e){m.isBoolean(t)||(e=r,r=t,t=!1),null!=r&&(r=x(r,e));for(var u=[],i=[],o=0,a=O(n);a>o;o++){var c=n[o],f=r?r(c,o,n):c;t?(o&&i===f||u.push(c),i=f):r?m.contains(i,f)||(i.push(f),u.push(c)):m.contains(u,c)||u.push(c)}return u},m.union=function(){return m.uniq(S(arguments,!0,!0))},m.intersection=function(n){for(var t=[],r=arguments.length,e=0,u=O(n);u>e;e++){var i=n[e];if(!m.contains(t,i)){for(var o=1;r>o&&m.contains(arguments[o],i);o++);o===r&&t.push(i)}}return t},m.difference=function(n){var t=S(arguments,!0,!0,1);return m.filter(n,function(n){return!m.contains(t,n)})},m.zip=function(){return m.unzip(arguments)},m.unzip=function(n){for(var t=n&&m.max(n,O).length||0,r=Array(t),e=0;t>e;e++)r[e]=m.pluck(n,e);return r},m.object=function(n,t){for(var r={},e=0,u=O(n);u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},m.findIndex=t(1),m.findLastIndex=t(-1),m.sortedIndex=function(n,t,r,e){for(var u=(r=x(r,e,1))(t),i=0,o=O(n);o>i;){var a=Math.floor((i+o)/2);r(n[a])<u?i=a+1:o=a}return i},m.indexOf=r(1,m.findIndex,m.sortedIndex),m.lastIndexOf=r(-1,m.findLastIndex),m.range=function(n,t,r){null==t&&(t=n||0,n=0),r=r||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=Array(e),i=0;e>i;i++,n+=r)u[i]=n;return u};var E=function(n,t,r,e,u){if(!(e instanceof t))return n.apply(r,u);var i=j(n.prototype),o=n.apply(i,u);return m.isObject(o)?o:i};m.bind=function(n,t){if(g&&n.bind===g)return g.apply(n,l.call(arguments,1));if(!m.isFunction(n))throw new TypeError("Bind must be called on a function");var r=l.call(arguments,2),e=function(){return E(n,e,t,this,r.concat(l.call(arguments)))};return e},m.partial=function(n){var t=l.call(arguments,1),r=function(){for(var e=0,u=t.length,i=Array(u),o=0;u>o;o++)i[o]=t[o]===m?arguments[e++]:t[o];for(;e<arguments.length;)i.push(arguments[e++]);return E(n,r,this,this,i)};return r},m.bindAll=function(n){var t,r,e=arguments.length;if(1>=e)throw new Error("bindAll must be passed function names");for(t=1;e>t;t++)n[r=arguments[t]]=m.bind(n[r],n);return n},m.memoize=function(n,t){var r=function(e){var u=r.cache,i=""+(t?t.apply(this,arguments):e);return m.has(u,i)||(u[i]=n.apply(this,arguments)),u[i]};return r.cache={},r},m.delay=function(n,t){var r=l.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},m.defer=m.partial(m.delay,m,1),m.throttle=function(n,t,r){var e,u,i,o=null,a=0;r||(r={});var c=function(){a=!1===r.leading?0:m.now(),o=null,i=n.apply(e,u),o||(e=u=null)};return function(){var f=m.now();a||!1!==r.leading||(a=f);var l=t-(f-a);return e=this,u=arguments,0>=l||l>t?(o&&(clearTimeout(o),o=null),a=f,i=n.apply(e,u),o||(e=u=null)):o||!1===r.trailing||(o=setTimeout(c,l)),i}},m.debounce=function(n,t,r){var e,u,i,o,a,c=function(){var f=m.now()-o;t>f&&f>=0?e=setTimeout(c,t-f):(e=null,r||(a=n.apply(i,u),e||(i=u=null)))};return function(){i=this,u=arguments,o=m.now();var f=r&&!e;return e||(e=setTimeout(c,t)),f&&(a=n.apply(i,u),i=u=null),a}},m.wrap=function(n,t){return m.partial(t,n)},m.negate=function(n){return function(){return!n.apply(this,arguments)}},m.compose=function(){var n=arguments,t=n.length-1;return function(){for(var r=t,e=n[t].apply(this,arguments);r--;)e=n[r].call(this,e);return e}},m.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},m.before=function(n,t){var r;return function(){return--n>0&&(r=t.apply(this,arguments)),1>=n&&(t=null),r}},m.once=m.partial(m.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];m.keys=function(n){if(!m.isObject(n))return[];if(v)return v(n);var t=[];for(var r in n)m.has(n,r)&&t.push(r);return M&&e(n,t),t},m.allKeys=function(n){if(!m.isObject(n))return[];var t=[];for(var r in n)t.push(r);return M&&e(n,t),t},m.values=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},m.mapObject=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=u.length,o={},a=0;i>a;a++)o[e=u[a]]=t(n[e],e,n);return o},m.pairs=function(n){for(var t=m.keys(n),r=t.length,e=Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},m.invert=function(n){for(var t={},r=m.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},m.functions=m.methods=function(n){var t=[];for(var r in n)m.isFunction(n[r])&&t.push(r);return t.sort()},m.extend=_(m.allKeys),m.extendOwn=m.assign=_(m.keys),m.findKey=function(n,t,r){t=x(t,r);for(var e,u=m.keys(n),i=0,o=u.length;o>i;i++)if(t(n[e=u[i]],e,n))return e},m.pick=function(n,t,r){var e,u,i={},o=n;if(null==o)return i;m.isFunction(t)?(u=m.allKeys(o),e=b(t,r)):(u=S(arguments,!1,!1,1),e=function(n,t,r){return t in r},o=Object(o));for(var a=0,c=u.length;c>a;a++){var f=u[a],l=o[f];e(l,f,o)&&(i[f]=l)}return i},m.omit=function(n,t,r){if(m.isFunction(t))t=m.negate(t);else{var e=m.map(S(arguments,!1,!1,1),String);t=function(n,t){return!m.contains(e,t)}}return m.pick(n,t,r)},m.defaults=_(m.allKeys,!0),m.create=function(n,t){var r=j(n);return t&&m.extendOwn(r,t),r},m.clone=function(n){return m.isObject(n)?m.isArray(n)?n.slice():m.extend({},n):n},m.tap=function(n,t){return t(n),n},m.isMatch=function(n,t){var r=m.keys(t),e=r.length;if(null==n)return!e;for(var u=Object(n),i=0;e>i;i++){var o=r[i];if(t[o]!==u[o]||!(o in u))return!1}return!0};var N=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof m&&(n=n._wrapped),t instanceof m&&(t=t._wrapped);var u=s.call(n);if(u!==s.call(t))return!1;switch(u){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!=+n?+t!=+t:0==+n?1/+n==1/t:+n==+t;case"[object Date]":case"[object Boolean]":return+n==+t}var i="[object Array]"===u;if(!i){if("object"!=typeof n||"object"!=typeof t)return!1;var o=n.constructor,a=t.constructor;if(o!==a&&!(m.isFunction(o)&&o instanceof o&&m.isFunction(a)&&a instanceof a)&&"constructor"in n&&"constructor"in t)return!1}r=r||[],e=e||[];for(var c=r.length;c--;)if(r[c]===n)return e[c]===t;if(r.push(n),e.push(t),i){if((c=n.length)!==t.length)return!1;for(;c--;)if(!N(n[c],t[c],r,e))return!1}else{var f,l=m.keys(n);if(c=l.length,m.keys(t).length!==c)return!1;for(;c--;)if(f=l[c],!m.has(t,f)||!N(n[f],t[f],r,e))return!1}return r.pop(),e.pop(),!0};m.isEqual=function(n,t){return N(n,t)},m.isEmpty=function(n){return null==n||(k(n)&&(m.isArray(n)||m.isString(n)||m.isArguments(n))?0===n.length:0===m.keys(n).length)},m.isElement=function(n){return!(!n||1!==n.nodeType)},m.isArray=h||function(n){return"[object Array]"===s.call(n)},m.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},m.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(n){m["is"+n]=function(t){return s.call(t)==="[object "+n+"]"}}),m.isArguments(arguments)||(m.isArguments=function(n){return m.has(n,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(m.isFunction=function(n){return"function"==typeof n||!1}),m.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},m.isNaN=function(n){return m.isNumber(n)&&n!==+n},m.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"===s.call(n)},m.isNull=function(n){return null===n},m.isUndefined=function(n){return void 0===n},m.has=function(n,t){return null!=n&&p.call(n,t)},m.noConflict=function(){return u._=i,this},m.identity=function(n){return n},m.constant=function(n){return function(){return n}},m.noop=function(){},m.property=w,m.propertyOf=function(n){return null==n?function(){}:function(t){return n[t]}},m.matcher=m.matches=function(n){return n=m.extendOwn({},n),function(t){return m.isMatch(t,n)}},m.times=function(n,t,r){var e=Array(Math.max(0,n));t=b(t,r,1);for(var u=0;n>u;u++)e[u]=t(u);return e},m.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},m.now=Date.now||function(){return(new Date).getTime()};var B={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},T=m.invert(B),R=function(n){var t=function(t){return n[t]},r="(?:"+m.keys(n).join("|")+")",e=RegExp(r),u=RegExp(r,"g");return function(n){return n=null==n?"":""+n,e.test(n)?n.replace(u,t):n}};m.escape=R(B),m.unescape=R(T),m.result=function(n,t,r){var e=null==n?void 0:n[t];return void 0===e&&(e=r),m.isFunction(e)?e.call(n):e};var q=0;m.uniqueId=function(n){var t=++q+"";return n?n+t:t},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\u2028|\u2029/g,L=function(n){return"\\"+z[n]};m.template=function(n,t,r){!t&&r&&(t=r),t=m.defaults({},t,m.templateSettings);var e=RegExp([(t.escape||K).source,(t.interpolate||K).source,(t.evaluate||K).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,o,a){return i+=n.slice(u,a).replace(D,L),u=a+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":e?i+="'+\n((__t=("+e+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var o=new Function(t.variable||"obj","_",i)}catch(a){throw a.source=i,a}var c=function(n){return o.call(this,n,m)},f=t.variable||"obj";return c.source="function("+f+"){\n"+i+"}",c},m.chain=function(n){var t=m(n);return t._chain=!0,t};var P=function(n,t){return n._chain?m(t).chain():t};m.mixin=function(n){m.each(m.functions(n),function(t){var r=m[t]=n[t];m.prototype[t]=function(){var n=[this._wrapped];return f.apply(n,arguments),P(this,r.apply(m,n))}})},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=o[n];m.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==n&&"splice"!==n||0!==r.length||delete r[0],P(this,r)}}),m.each(["concat","join","slice"],function(n){var t=o[n];m.prototype[n]=function(){return P(this,t.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return m})}.call(this),function(exports){exports.parse=function(s){for(var ancestors=[],tree={},tokens=s.split(/\s*(;|\(|\)|,|:)\s*/),i=0;i<tokens.length;i++){var token=$.trim(tokens[i]);switch(token){case"(":var subtree={};tree.children=[subtree],ancestors.push(tree),tree=subtree;break;case",":subtree={};ancestors[ancestors.length-1].children.push(subtree),tree=subtree;break;case")":tree=ancestors.pop();break;case":":break;default:var x=tokens[i-1];")"==x||"("==x||","==x?tree.name=token:":"==x&&(tree.length=parseFloat(token))}}return tree}}("undefined"!=typeof exports?exports:this.Newick={}),function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return!!Array.isArray(a)&&(g(a,c[b],c),!0)}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;(d=a.prototype=Object.create(e)).constructor=a,d._super=e,c&&la(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==oa?a.apply(b&&b[0]||d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ma.length;){if((e=(c=ma[g])?c+f:b)in a)return e;g++}return d}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Ea&&d-e==0,g=b&(Ga|Ha)&&d-e==0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,function(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=ra(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),function(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Ea&&f.eventType!==Ga||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=qa(j.x)>qa(j.y)?j.x:j.y,b.scale=g?function(a,b){return H(b[0],b[1],Ra)/H(a[0],a[1],Ra)}(g.pointers,d):1,b.rotation=g?function(a,b){return I(b[1],b[0],Ra)+I(a[1],a[0],Ra)}(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ha&&(i>Da||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=qa(l.x)>qa(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:pa(a.pointers[c].clientX),clientY:pa(a.pointers[c].clientY)},c++;return{timeStamp:ra(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:pa(a[0].clientX),y:pa(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:pa(c/b),y:pa(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ia:qa(a)>=qa(b)?0>a?Ja:Ka:0>b?La:Ma}function H(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function L(){this.evEl=Ta,this.evWin=Ua,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Xa,this.evWin=Ya,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=$a,this.evWin=_a,this.started=!1,x.apply(this,arguments)}function P(){this.evTarget=bb,this.targetIds={},x.apply(this,arguments)}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a),this.primaryTouch=null,this.lastTouches=[]}function T(a){var b=a.changedPointers[0];if(b.identifier===this.primaryTouch){var c={x:b.clientX,y:b.clientY};this.lastTouches.push(c);var d=this.lastTouches;setTimeout(function(){var a=d.indexOf(c);a>-1&&d.splice(a,1)},cb)}}function V(a,b){this.manager=a,this.set(b)}function Y(a){this.options=la({},this.defaults,a||{}),this.id=ua++,this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=nb,this.simultaneous={},this.requireFail=[]}function Z(a){return a&sb?"cancel":a&qb?"end":a&pb?"move":a&ob?"start":""}function $(a){return a==Ma?"down":a==La?"up":a==Ja?"left":a==Ka?"right":""}function _(a,b){var c=b.manager;return c?c.get(a):a}function aa(){Y.apply(this,arguments)}function ba(){aa.apply(this,arguments),this.pX=null,this.pY=null}function ca(){aa.apply(this,arguments)}function da(){Y.apply(this,arguments),this._timer=null,this._input=null}function ea(){aa.apply(this,arguments)}function fa(){aa.apply(this,arguments)}function ga(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ha(a,b){return(b=b||{}).recognizers=l(b.recognizers,ha.defaults.preset),new ia(a,b)}function ia(a,b){this.options=la({},ha.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=a,this.input=function(a){var c=a.options.inputClass;return new(c||(xa?M:ya?P:wa?R:L))(a,z)}(this),this.touchAction=new V(this,this.options.touchAction),ja(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ja(a,b){var d,c=a.element;c.style&&(g(a.options.cssProps,function(e,f){d=u(c.style,f),b?(a.oldCssProps[d]=c.style[d],c.style[d]=e):c.style[d]=a.oldCssProps[d]||""}),b||(a.oldCssProps={}))}function ka(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var la,ma=["","webkit","Moz","MS","ms","o"],na=b.createElement("div"),oa="function",pa=Math.round,qa=Math.abs,ra=Date.now;la="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var sa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),ta=h(function(a,b){return sa(a,b,!0)},"merge","Use `assign`."),ua=1,wa="ontouchstart"in a,xa=u(a,"PointerEvent")!==d,ya=wa&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),za="touch",Ba="mouse",Da=25,Ea=1,Fa=2,Ga=4,Ha=8,Ia=1,Ja=2,Ka=4,La=8,Ma=16,Na=Ja|Ka,Oa=La|Ma,Pa=Na|Oa,Qa=["x","y"],Ra=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Sa={mousedown:Ea,mousemove:Fa,mouseup:Ga},Ta="mousedown",Ua="mousemove mouseup";i(L,x,{handler:function(a){var b=Sa[a.type];b&Ea&&0===a.button&&(this.pressed=!0),b&Fa&&1!==a.which&&(b=Ga),this.pressed&&(b&Ga&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:Ba,srcEvent:a}))}});var Va={pointerdown:Ea,pointermove:Fa,pointerup:Ga,pointercancel:Ha,pointerout:Ha},Wa={2:za,3:"pen",4:Ba,5:"kinect"},Xa="pointerdown",Ya="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Xa="MSPointerDown",Ya="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Va[d],f=Wa[a.pointerType]||a.pointerType,g=f==za,h=r(b,a.pointerId,"pointerId");e&Ea&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Ga|Ha)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Za={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},$a="touchstart",_a="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Za[a.type];if(b===Ea&&(this.started=!0),this.started){var c=function(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ga|Ha)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}.call(this,a,b);b&(Ga|Ha)&&c[0].length-c[1].length==0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}}});var ab={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},bb="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=ab[a.type],c=function(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Ea|Fa)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Ea)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ga|Ha)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}});var cb=2500,db=25;i(R,x,{handler:function(a,b,c){var d=c.pointerType==za,e=c.pointerType==Ba;if(!(e&&c.sourceCapabilities&&c.sourceCapabilities.firesTouchEvents)){if(d)(function(a,b){a&Ea?(this.primaryTouch=b.changedPointers[0].identifier,T.call(this,b)):a&(Ga|Ha)&&T.call(this,b)}).call(this,b,c);else if(e&&function(a){for(var b=a.srcEvent.clientX,c=a.srcEvent.clientY,d=0;d<this.lastTouches.length;d++){var e=this.lastTouches[d],f=Math.abs(b-e.x),g=Math.abs(c-e.y);if(db>=f&&db>=g)return!0}return!1}.call(this,c))return;this.callback(a,b,c)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var eb=u(na.style,"touchAction"),fb=eb!==d,gb="compute",hb="auto",ib="manipulation",jb="none",kb="pan-x",lb="pan-y",mb=function(){if(!fb)return!1;var b={},c=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(d){b[d]=!c||a.CSS.supports("touch-action",d)}),b}();V.prototype={set:function(a){a==gb&&(a=this.compute()),fb&&this.manager.element.style&&mb[a]&&(this.manager.element.style[eb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),function(a){if(p(a,jb))return jb;var b=p(a,kb),c=p(a,lb);return b&&c?jb:b||c?b?kb:lb:p(a,ib)?ib:hb}(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent,c=a.offsetDirection;if(!this.manager.session.prevented){var d=this.actions,e=p(d,jb)&&!mb[jb],f=p(d,lb)&&!mb[lb],g=p(d,kb)&&!mb[kb];if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}return g&&f?void 0:e||f&&c&Na||g&&c&Oa?this.preventSrc(b):void 0}b.preventDefault()},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var nb=1,ob=2,pb=4,qb=8,rb=qb,sb=16;Y.prototype={defaults:{},set:function(a){return la(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return b[(a=_(a,this)).id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=_(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return-1===r(b,a=_(a,this))&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=_(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;qb>d&&b(c.options.event+Z(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=qb&&b(c.options.event+Z(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=32)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(32|nb)))return!1;a++}return!0},recognize:function(a){var b=la({},a);return k(this.options.enable,[this,b])?(this.state&(rb|sb|32)&&(this.state=nb),this.state=this.process(b),void(this.state&(ob|pb|qb|sb)&&this.tryEmit(b))):(this.reset(),void(this.state=32))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(aa,Y,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(ob|pb),e=this.attrTest(a);return d&&(c&Ha||!e)?b|sb:d||e?c&Ga?b|qb:b&ob?b|pb:ob:32}}),i(ba,aa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Pa},getTouchAction:function(){var a=this.options.direction,b=[];return a&Na&&b.push(lb),a&Oa&&b.push(kb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Na?(e=0===f?Ia:0>f?Ja:Ka,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ia:0>g?La:Ma,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return aa.prototype.attrTest.call(this,a)&&(this.state&ob||!(this.state&ob)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=$(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i(ca,aa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&ob)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(da,Y,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[hb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ga|Ha)&&!f)this.reset();else if(a.eventType&Ea)this.reset(),this._timer=e(function(){this.state=rb,this.tryEmit()},b.time,this);else if(a.eventType&Ga)return rb;return 32},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===rb&&(a&&a.eventType&Ga?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=ra(),this.manager.emit(this.options.event,this._input)))}}),i(ea,aa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&ob)}}),i(fa,aa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Na|Oa,pointers:1},getTouchAction:function(){return ba.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Na|Oa)?b=a.overallVelocity:c&Na?b=a.overallVelocityX:c&Oa&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&qa(b)>this.options.velocity&&a.eventType&Ga},emit:function(a){var b=$(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ga,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ib]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Ea&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ga)return this.failTimeout();var g=!this.pTime||a.timeStamp-this.pTime<b.interval,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;if(this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a,0===this.count%b.taps)return this.hasRequireFailures()?(this._timer=e(function(){this.state=rb,this.tryEmit()},b.interval,this),ob):rb}return 32},failTimeout:function(){return this._timer=e(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==rb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ha.VERSION="2.0.8",ha.defaults={domEvents:!1,touchAction:gb,enable:!0,inputTarget:null,inputClass:null,preset:[[ea,{enable:!1}],[ca,{enable:!1},["rotate"]],[fa,{direction:Na}],[ba,{direction:Na},["swipe"]],[ga],[ga,{event:"doubletap",taps:2},["tap"]],[da]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};ia.prototype={set:function(a){return la(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?2:1},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&rb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],2===b.stopped||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(ob|pb|qb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof Y)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);-1!==c&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){if(a!==d&&b!==d){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this}},off:function(a,b){if(a!==d){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this}},emit:function(a,b){this.options.domEvents&&ka(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ja(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},la(ha,{INPUT_START:Ea,INPUT_MOVE:Fa,INPUT_END:Ga,INPUT_CANCEL:Ha,STATE_POSSIBLE:nb,STATE_BEGAN:ob,STATE_CHANGED:pb,STATE_ENDED:qb,STATE_RECOGNIZED:rb,STATE_CANCELLED:sb,STATE_FAILED:32,DIRECTION_NONE:Ia,DIRECTION_LEFT:Ja,DIRECTION_RIGHT:Ka,DIRECTION_UP:La,DIRECTION_DOWN:Ma,DIRECTION_HORIZONTAL:Na,DIRECTION_VERTICAL:Oa,DIRECTION_ALL:Pa,Manager:ia,Input:x,TouchAction:V,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:Y,AttrRecognizer:aa,Tap:ga,Pan:ba,Swipe:fa,Pinch:ca,Rotate:ea,Press:da,on:m,off:n,each:g,merge:ta,extend:sa,assign:la,inherit:i,bindFn:j,prefixed:u}),(void 0!==a?a:"undefined"!=typeof self?self:{}).Hammer=ha,"function"==typeof define&&define.amd?define(function(){return ha}):"undefined"!=typeof module&&module.exports?module.exports=ha:a.Hammer=ha}(window,document),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if((b=a.event.fix(g)).type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(j=m=-1*g.deltaY),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120==0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(a){return b(a)}):"object"==typeof module&&module.exports?module.exports=b(require("jquery")):b(a.jQuery)}(this,function(a){!function(a){"use strict";function b(b){return a.each([{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}],function(){b=b?b.replace(this.re,this.ch):""}),b}function c(b){var c=arguments,d=b;[].shift.apply(c);var e,f=this.each(function(){var b=a(this);if(b.is("select")){var f=b.data("selectpicker"),g="object"==typeof d&&d;if(f){if(g)for(var h in g)g.hasOwnProperty(h)&&(f.options[h]=g[h])}else{var i=a.extend({},k.DEFAULTS,a.fn.selectpicker.defaults||{},b.data(),g);i.template=a.extend({},k.DEFAULTS.template,a.fn.selectpicker.defaults?a.fn.selectpicker.defaults.template:{},b.data().template,g.template),b.data("selectpicker",f=new k(this,i))}"string"==typeof d&&(e=f[d]instanceof Function?f[d].apply(f,c):f.options[d])}});return void 0!==e?e:f}String.prototype.includes||function(){var a={}.toString,b=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(a){}return c}(),c="".indexOf,d=function(b){if(null==this)throw new TypeError;var d=String(this);if(b&&"[object RegExp]"==a.call(b))throw new TypeError;var e=d.length,f=String(b),g=f.length,h=arguments.length>1?arguments[1]:void 0,i=h?Number(h):0;return i!=i&&(i=0),!(g+Math.min(Math.max(i,0),e)>e)&&-1!=c.call(d,f,i)};b?b(String.prototype,"includes",{value:d,configurable:!0,writable:!0}):String.prototype.includes=d}(),String.prototype.startsWith||function(){var a=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(a){}return c}(),b={}.toString,c=function(a){if(null==this)throw new TypeError;var c=String(this);if(a&&"[object RegExp]"==b.call(a))throw new TypeError;var d=c.length,e=String(a),f=e.length,g=arguments.length>1?arguments[1]:void 0,h=g?Number(g):0;h!=h&&(h=0);var i=Math.min(Math.max(h,0),d);if(f+i>d)return!1;for(var j=-1;++j<f;)if(c.charCodeAt(i+j)!=e.charCodeAt(j))return!1;return!0};a?a(String.prototype,"startsWith",{value:c,configurable:!0,writable:!0}):String.prototype.startsWith=c}(),Object.keys||(Object.keys=function(a,b,c){for(b in c=[],a)c.hasOwnProperty.call(a,b)&&c.push(b);return c});var d={useDefault:!1,_set:a.valHooks.select.set};a.valHooks.select.set=function(b,c){return c&&!d.useDefault&&a(b).data("selected",!0),d._set.apply(this,arguments)};var e=null;a.fn.triggerNative=function(a){var b,c=this[0];c.dispatchEvent?("function"==typeof Event?b=new Event(a,{bubbles:!0}):(b=document.createEvent("Event")).initEvent(a,!0,!1),c.dispatchEvent(b)):c.fireEvent?((b=document.createEventObject()).eventType=a,c.fireEvent("on"+a,b)):this.trigger(a)},a.expr.pseudos.icontains=function(b,c,d){var e=a(b);return(e.data("tokens")||e.text()).toString().toUpperCase().includes(d[3].toUpperCase())},a.expr.pseudos.ibegins=function(b,c,d){var e=a(b);return(e.data("tokens")||e.text()).toString().toUpperCase().startsWith(d[3].toUpperCase())},a.expr.pseudos.aicontains=function(b,c,d){var e=a(b);return(e.data("tokens")||e.data("normalizedText")||e.text()).toString().toUpperCase().includes(d[3].toUpperCase())},a.expr.pseudos.aibegins=function(b,c,d){var e=a(b);return(e.data("tokens")||e.data("normalizedText")||e.text()).toString().toUpperCase().startsWith(d[3].toUpperCase())};var h=function(a){var b=function(b){return a[b]},c="(?:"+Object.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}},i=h({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"}),j=h({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`"}),k=function(b,c){d.useDefault||(a.valHooks.select.set=d._set,d.useDefault=!0),this.$element=a(b),this.$newElement=null,this.$button=null,this.$menu=null,this.$lis=null,this.options=c,null===this.options.title&&(this.options.title=this.$element.attr("title"));var e=this.options.windowPadding;"number"==typeof e&&(this.options.windowPadding=[e,e,e,e]),this.val=k.prototype.val,this.render=k.prototype.render,this.refresh=k.prototype.refresh,this.setStyle=k.prototype.setStyle,this.selectAll=k.prototype.selectAll,this.deselectAll=k.prototype.deselectAll,this.destroy=k.prototype.destroy,this.remove=k.prototype.remove,this.show=k.prototype.show,this.hide=k.prototype.hide,this.init()};k.VERSION="1.12.2",k.DEFAULTS={noneSelectedText:"Nothing selected",noneResultsText:"No results matched {0}",countSelectedText:function(a,b){return 1==a?"{0} item selected":"{0} items selected"},maxOptionsText:function(a,b){return[1==a?"Limit reached ({n} item max)":"Limit reached ({n} items max)",1==b?"Group limit reached ({n} item max)":"Group limit reached ({n} items max)"]},selectAllText:"Select All",deselectAllText:"Deselect All",doneButton:!1,doneButtonText:"Close",multipleSeparator:", ",styleBase:"btn",style:"btn-default",size:"auto",title:null,selectedTextFormat:"values",width:!1,container:!1,hideDisabled:!1,showSubtext:!1,showIcon:!0,showContent:!0,dropupAuto:!0,header:!1,liveSearch:!1,liveSearchPlaceholder:null,liveSearchNormalize:!1,liveSearchStyle:"contains",actionsBox:!1,iconBase:"glyphicon",tickIcon:"glyphicon-ok",showTick:!1,template:{caret:'<span class="caret"></span>'},maxOptions:!1,mobile:!1,selectOnTab:!1,dropdownAlignRight:!1,windowPadding:0},k.prototype={constructor:k,init:function(){var b=this,c=this.$element.attr("id");this.$element.addClass("bs-select-hidden"),this.liObj={},this.multiple=this.$element.prop("multiple"),this.autofocus=this.$element.prop("autofocus"),this.$newElement=this.createView(),this.$element.after(this.$newElement).appendTo(this.$newElement),this.$button=this.$newElement.children("button"),this.$menu=this.$newElement.children(".dropdown-menu"),this.$menuInner=this.$menu.children(".inner"),this.$searchbox=this.$menu.find("input"),this.$element.removeClass("bs-select-hidden"),!0===this.options.dropdownAlignRight&&this.$menu.addClass("dropdown-menu-right"),void 0!==c&&(this.$button.attr("data-id",c),a('label[for="'+c+'"]').click(function(a){a.preventDefault(),b.$button.focus()})),this.checkDisabled(),this.clickListener(),this.options.liveSearch&&this.liveSearchListener(),this.render(),this.setStyle(),this.setWidth(),this.options.container&&this.selectPosition(),this.$menu.data("this",this),this.$newElement.data("this",this),this.options.mobile&&this.mobile(),this.$newElement.on({"hide.bs.dropdown":function(a){b.$menuInner.attr("aria-expanded",!1),b.$element.trigger("hide.bs.select",a)},"hidden.bs.dropdown":function(a){b.$element.trigger("hidden.bs.select",a)},"show.bs.dropdown":function(a){b.$menuInner.attr("aria-expanded",!0),b.$element.trigger("show.bs.select",a)},"shown.bs.dropdown":function(a){b.$element.trigger("shown.bs.select",a)}}),b.$element[0].hasAttribute("required")&&this.$element.on("invalid",function(){b.$button.addClass("bs-invalid").focus(),b.$element.on({"focus.bs.select":function(){b.$button.focus(),b.$element.off("focus.bs.select")},"shown.bs.select":function(){b.$element.val(b.$element.val()).off("shown.bs.select")},"rendered.bs.select":function(){this.validity.valid&&b.$button.removeClass("bs-invalid"),b.$element.off("rendered.bs.select")}})}),setTimeout(function(){b.$element.trigger("loaded.bs.select")})},createDropdown:function(){var b=this.multiple||this.options.showTick?" show-tick":"",c=this.$element.parent().hasClass("input-group")?" input-group-btn":"",d=this.autofocus?" autofocus":"",e=this.options.header?'<div class="popover-title"><button type="button" class="close" aria-hidden="true">&times;</button>'+this.options.header+"</div>":"",f=this.options.liveSearch?'<div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off"'+(null===this.options.liveSearchPlaceholder?"":' placeholder="'+i(this.options.liveSearchPlaceholder)+'"')+' role="textbox" aria-label="Search"></div>':"",g=this.multiple&&this.options.actionsBox?'<div class="bs-actionsbox"><div class="btn-group btn-group-sm btn-block"><button type="button" class="actions-btn bs-select-all btn btn-default">'+this.options.selectAllText+'</button><button type="button" class="actions-btn bs-deselect-all btn btn-default">'+this.options.deselectAllText+"</button></div></div>":"",h=this.multiple&&this.options.doneButton?'<div class="bs-donebutton"><div class="btn-group btn-block"><button type="button" class="btn btn-sm btn-default">'+this.options.doneButtonText+"</button></div></div>":"",j='<div class="btn-group bootstrap-select'+b+c+'"><button type="button" class="'+this.options.styleBase+' dropdown-toggle" data-toggle="dropdown"'+d+' role="button"><span class="filter-option pull-left"></span>&nbsp;<span class="bs-caret">'+this.options.template.caret+'</span></button><div class="dropdown-menu open" role="combobox">'+e+f+g+'<ul class="dropdown-menu inner" role="listbox" aria-expanded="false"></ul>'+h+"</div></div>";return a(j)},createView:function(){var a=this.createDropdown(),b=this.createLi();return a.find("ul")[0].innerHTML=b,a},reloadLi:function(){var a=this.createLi();this.$menuInner[0].innerHTML=a},createLi:function(){var c=this,d=[],e=0,f=document.createElement("option"),g=-1,h=function(a,b,c,d){return"<li"+(void 0!==c&""!==c?' class="'+c+'"':"")+(void 0!==b&null!==b?' data-original-index="'+b+'"':"")+(void 0!==d&null!==d?'data-optgroup="'+d+'"':"")+">"+a+"</li>"},j=function(d,e,f,g){return'<a tabindex="0"'+(void 0!==e?' class="'+e+'"':"")+(f?' style="'+f+'"':"")+(c.options.liveSearchNormalize?' data-normalized-text="'+b(i(a(d).html()))+'"':"")+(void 0!==g||null!==g?' data-tokens="'+g+'"':"")+' role="option">'+d+'<span class="'+c.options.iconBase+" "+c.options.tickIcon+' check-mark"></span></a>'};if(this.options.title&&!this.multiple&&(g--,!this.$element.find(".bs-title-option").length)){var k=this.$element[0];f.className="bs-title-option",f.innerHTML=this.options.title,f.value="",k.insertBefore(f,k.firstChild),void 0===a(k.options[k.selectedIndex]).attr("selected")&&void 0===this.$element.data("selected")&&(f.selected=!0)}return this.$element.find("option").each(function(b){var f=a(this);if(g++,!f.hasClass("bs-title-option")){var k=this.className||"",l=this.style.cssText,m=f.data("content")?f.data("content"):f.html(),n=f.data("tokens")?f.data("tokens"):null,o=void 0!==f.data("subtext")?'<small class="text-muted">'+f.data("subtext")+"</small>":"",p=void 0!==f.data("icon")?'<span class="'+c.options.iconBase+" "+f.data("icon")+'"></span> ':"",q=f.parent(),r="OPTGROUP"===q[0].tagName,s=r&&q[0].disabled,t=this.disabled||s;if(""!==p&&t&&(p="<span>"+p+"</span>"),c.options.hideDisabled&&(t&&!r||s))return void g--;if(f.data("content")||(m=p+'<span class="text">'+m+o+"</span>"),r&&!0!==f.data("divider")){if(c.options.hideDisabled&&t){if(void 0===q.data("allOptionsDisabled")){var u=q.children();q.data("allOptionsDisabled",u.filter(":disabled").length===u.length)}if(q.data("allOptionsDisabled"))return void g--}var v=" "+q[0].className||"";if(0===f.index()){e+=1;var w=q[0].label,x=void 0!==q.data("subtext")?'<small class="text-muted">'+q.data("subtext")+"</small>":"";w=(q.data("icon")?'<span class="'+c.options.iconBase+" "+q.data("icon")+'"></span> ':"")+'<span class="text">'+i(w)+x+"</span>",0!==b&&d.length>0&&(g++,d.push(h("",null,"divider",e+"div"))),g++,d.push(h(w,null,"dropdown-header"+v,e))}if(c.options.hideDisabled&&t)return void g--;d.push(h(j(m,"opt "+k+v,l,n),b,"",e))}else if(!0===f.data("divider"))d.push(h("",b,"divider"));else if(!0===f.data("hidden"))d.push(h(j(m,k,l,n),b,"hidden is-hidden"));else{var z=this.previousElementSibling&&"OPTGROUP"===this.previousElementSibling.tagName;if(!z&&c.options.hideDisabled)for(var A=a(this).prevAll(),B=0;B<A.length;B++)if("OPTGROUP"===A[B].tagName){for(var C=0,D=0;D<B;D++){var E=A[D];(E.disabled||!0===a(E).data("hidden"))&&C++}C===B&&(z=!0);break}z&&(g++,d.push(h("",null,"divider",e+"div"))),d.push(h(j(m,k,l,n),b))}c.liObj[b]=g}}),this.multiple||0!==this.$element.find("option:selected").length||this.options.title||this.$element.find("option").eq(0).prop("selected",!0).attr("selected","selected"),d.join("")},findLis:function(){return null==this.$lis&&(this.$lis=this.$menu.find("li")),this.$lis},render:function(b){var c,d=this;!1!==b&&this.$element.find("option").each(function(a){var b=d.findLis().eq(d.liObj[a]);d.setDisabled(a,this.disabled||"OPTGROUP"===this.parentNode.tagName&&this.parentNode.disabled,b),d.setSelected(a,this.selected,b)}),this.togglePlaceholder(),this.tabIndex();var e=this.$element.find("option").map(function(){if(this.selected){if(d.options.hideDisabled&&(this.disabled||"OPTGROUP"===this.parentNode.tagName&&this.parentNode.disabled))return;var b,c=a(this),e=c.data("icon")&&d.options.showIcon?'<i class="'+d.options.iconBase+" "+c.data("icon")+'"></i> ':"";return b=d.options.showSubtext&&c.data("subtext")&&!d.multiple?' <small class="text-muted">'+c.data("subtext")+"</small>":"",void 0!==c.attr("title")?c.attr("title"):c.data("content")&&d.options.showContent?c.data("content").toString():e+c.html()+b}}).toArray(),f=this.multiple?e.join(this.options.multipleSeparator):e[0];if(this.multiple&&this.options.selectedTextFormat.indexOf("count")>-1){var g=this.options.selectedTextFormat.split(">");if(g.length>1&&e.length>g[1]||1==g.length&&e.length>=2){c=this.options.hideDisabled?", [disabled]":"";var h=this.$element.find("option").not('[data-divider="true"], [data-hidden="true"]'+c).length;f=("function"==typeof this.options.countSelectedText?this.options.countSelectedText(e.length,h):this.options.countSelectedText).replace("{0}",e.length.toString()).replace("{1}",h.toString())}}void 0==this.options.title&&(this.options.title=this.$element.attr("title")),"static"==this.options.selectedTextFormat&&(f=this.options.title),f||(f=void 0!==this.options.title?this.options.title:this.options.noneSelectedText),this.$button.attr("title",j(a.trim(f.replace(/<[^>]*>?/g,"")))),this.$button.children(".filter-option").html(f),this.$element.trigger("rendered.bs.select")},setStyle:function(a,b){this.$element.attr("class")&&this.$newElement.addClass(this.$element.attr("class").replace(/selectpicker|mobile-device|bs-select-hidden|validate\[.*\]/gi,""));var c=a||this.options.style;"add"==b?this.$button.addClass(c):"remove"==b?this.$button.removeClass(c):(this.$button.removeClass(this.options.style),this.$button.addClass(c))},liHeight:function(b){if(b||!1!==this.options.size&&!this.sizeInfo){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("ul"),f=document.createElement("li"),g=document.createElement("li"),h=document.createElement("a"),i=document.createElement("span"),j=this.options.header&&this.$menu.find(".popover-title").length>0?this.$menu.find(".popover-title")[0].cloneNode(!0):null,k=this.options.liveSearch?document.createElement("div"):null,l=this.options.actionsBox&&this.multiple&&this.$menu.find(".bs-actionsbox").length>0?this.$menu.find(".bs-actionsbox")[0].cloneNode(!0):null,m=this.options.doneButton&&this.multiple&&this.$menu.find(".bs-donebutton").length>0?this.$menu.find(".bs-donebutton")[0].cloneNode(!0):null;if(i.className="text",c.className=this.$menu[0].parentNode.className+" open",d.className="dropdown-menu open",e.className="dropdown-menu inner",f.className="divider",i.appendChild(document.createTextNode("Inner text")),h.appendChild(i),g.appendChild(h),e.appendChild(g),e.appendChild(f),j&&d.appendChild(j),k){var n=document.createElement("input");k.className="bs-searchbox",n.className="form-control",k.appendChild(n),d.appendChild(k)}l&&d.appendChild(l),d.appendChild(e),m&&d.appendChild(m),c.appendChild(d),document.body.appendChild(c);var o=h.offsetHeight,p=j?j.offsetHeight:0,q=k?k.offsetHeight:0,r=l?l.offsetHeight:0,s=m?m.offsetHeight:0,t=a(f).outerHeight(!0),u="function"==typeof getComputedStyle&&getComputedStyle(d),v=u?null:a(d),w={vert:parseInt(u?u.paddingTop:v.css("paddingTop"))+parseInt(u?u.paddingBottom:v.css("paddingBottom"))+parseInt(u?u.borderTopWidth:v.css("borderTopWidth"))+parseInt(u?u.borderBottomWidth:v.css("borderBottomWidth")),horiz:parseInt(u?u.paddingLeft:v.css("paddingLeft"))+parseInt(u?u.paddingRight:v.css("paddingRight"))+parseInt(u?u.borderLeftWidth:v.css("borderLeftWidth"))+parseInt(u?u.borderRightWidth:v.css("borderRightWidth"))},x={vert:w.vert+parseInt(u?u.marginTop:v.css("marginTop"))+parseInt(u?u.marginBottom:v.css("marginBottom"))+2,horiz:w.horiz+parseInt(u?u.marginLeft:v.css("marginLeft"))+parseInt(u?u.marginRight:v.css("marginRight"))+2};document.body.removeChild(c),this.sizeInfo={liHeight:o,headerHeight:p,searchHeight:q,actionsHeight:r,doneButtonHeight:s,dividerHeight:t,menuPadding:w,menuExtras:x}}},setSize:function(){if(this.findLis(),this.liHeight(),this.options.header&&this.$menu.css("padding-top",0),!1!==this.options.size){var b,c,d,e,f,g,h,i,j=this,k=this.$menu,l=this.$menuInner,m=a(window),n=this.$newElement[0].offsetHeight,o=this.$newElement[0].offsetWidth,p=this.sizeInfo.liHeight,q=this.sizeInfo.headerHeight,r=this.sizeInfo.searchHeight,s=this.sizeInfo.actionsHeight,t=this.sizeInfo.doneButtonHeight,u=this.sizeInfo.dividerHeight,v=this.sizeInfo.menuPadding,w=this.sizeInfo.menuExtras,x=this.options.hideDisabled?".disabled":"",y=function(){var b,c=j.$newElement.offset(),d=a(j.options.container);j.options.container&&!d.is("body")?((b=d.offset()).top+=parseInt(d.css("borderTopWidth")),b.left+=parseInt(d.css("borderLeftWidth"))):b={top:0,left:0};var e=j.options.windowPadding;f=c.top-b.top-m.scrollTop(),g=m.height()-f-n-b.top-e[2],h=c.left-b.left-m.scrollLeft(),i=m.width()-h-o-b.left-e[1],f-=e[0],h-=e[3]};if(y(),"auto"===this.options.size){var z=function(){var m,n=function(b,c){return function(d){return c?d.classList?d.classList.contains(b):a(d).hasClass(b):!(d.classList?d.classList.contains(b):a(d).hasClass(b))}},u=j.$menuInner[0].getElementsByTagName("li"),x=Array.prototype.filter?Array.prototype.filter.call(u,n("hidden",!1)):j.$lis.not(".hidden"),z=Array.prototype.filter?Array.prototype.filter.call(x,n("dropdown-header",!0)):x.filter(".dropdown-header");y(),b=g-w.vert,c=i-w.horiz,j.options.container?(k.data("height")||k.data("height",k.height()),d=k.data("height"),k.data("width")||k.data("width",k.width()),e=k.data("width")):(d=k.height(),e=k.width()),j.options.dropupAuto&&j.$newElement.toggleClass("dropup",f>g&&b-w.vert<d),j.$newElement.hasClass("dropup")&&(b=f-w.vert),"auto"===j.options.dropdownAlignRight&&k.toggleClass("dropdown-menu-right",h>i&&c-w.horiz<e-o),m=x.length+z.length>3?3*p+w.vert-2:0,k.css({"max-height":b+"px",overflow:"hidden","min-height":m+q+r+s+t+"px"}),l.css({"max-height":b-q-r-s-t-v.vert+"px","overflow-y":"auto","min-height":Math.max(m-v.vert,0)+"px"})};z(),this.$searchbox.off("input.getSize propertychange.getSize").on("input.getSize propertychange.getSize",z),m.off("resize.getSize scroll.getSize").on("resize.getSize scroll.getSize",z)}else if(this.options.size&&"auto"!=this.options.size&&this.$lis.not(x).length>this.options.size){var A=this.$lis.not(".divider").not(x).children().slice(0,this.options.size).last().parent().index(),B=this.$lis.slice(0,A+1).filter(".divider").length;b=p*this.options.size+B*u+v.vert,j.options.container?(k.data("height")||k.data("height",k.height()),d=k.data("height")):d=k.height(),j.options.dropupAuto&&this.$newElement.toggleClass("dropup",f>g&&b-w.vert<d),k.css({"max-height":b+q+r+s+t+"px",overflow:"hidden","min-height":""}),l.css({"max-height":b-v.vert+"px","overflow-y":"auto","min-height":""})}}},setWidth:function(){if("auto"===this.options.width){this.$menu.css("min-width","0");var a=this.$menu.parent().clone().appendTo("body"),b=this.options.container?this.$newElement.clone().appendTo("body"):a,c=a.children(".dropdown-menu").outerWidth(),d=b.css("width","auto").children("button").outerWidth();a.remove(),b.remove(),this.$newElement.css("width",Math.max(c,d)+"px")}else"fit"===this.options.width?(this.$menu.css("min-width",""),this.$newElement.css("width","").addClass("fit-width")):this.options.width?(this.$menu.css("min-width",""),this.$newElement.css("width",this.options.width)):(this.$menu.css("min-width",""),this.$newElement.css("width",""));this.$newElement.hasClass("fit-width")&&"fit"!==this.options.width&&this.$newElement.removeClass("fit-width")},selectPosition:function(){this.$bsContainer=a('<div class="bs-container" />');var b,c,d,e=this,f=a(this.options.container),g=function(a){e.$bsContainer.addClass(a.attr("class").replace(/form-control|fit-width/gi,"")).toggleClass("dropup",a.hasClass("dropup")),b=a.offset(),f.is("body")?c={top:0,left:0}:((c=f.offset()).top+=parseInt(f.css("borderTopWidth"))-f.scrollTop(),c.left+=parseInt(f.css("borderLeftWidth"))-f.scrollLeft()),d=a.hasClass("dropup")?0:a[0].offsetHeight,e.$bsContainer.css({top:b.top-c.top+d,left:b.left-c.left,width:a[0].offsetWidth})};this.$button.on("click",function(){var b=a(this);e.isDisabled()||(g(e.$newElement),e.$bsContainer.appendTo(e.options.container).toggleClass("open",!b.hasClass("open")).append(e.$menu))}),a(window).on("resize scroll",function(){g(e.$newElement)}),this.$element.on("hide.bs.select",function(){e.$menu.data("height",e.$menu.height()),e.$bsContainer.detach()})},setSelected:function(a,b,c){c||(this.togglePlaceholder(),c=this.findLis().eq(this.liObj[a])),c.toggleClass("selected",b).find("a").attr("aria-selected",b)},setDisabled:function(a,b,c){c||(c=this.findLis().eq(this.liObj[a])),b?c.addClass("disabled").children("a").attr("href","#").attr("tabindex",-1).attr("aria-disabled",!0):c.removeClass("disabled").children("a").removeAttr("href").attr("tabindex",0).attr("aria-disabled",!1)},isDisabled:function(){return this.$element[0].disabled},checkDisabled:function(){var a=this;this.isDisabled()?(this.$newElement.addClass("disabled"),this.$button.addClass("disabled").attr("tabindex",-1).attr("aria-disabled",!0)):(this.$button.hasClass("disabled")&&(this.$newElement.removeClass("disabled"),this.$button.removeClass("disabled").attr("aria-disabled",!1)),-1!=this.$button.attr("tabindex")||this.$element.data("tabindex")||this.$button.removeAttr("tabindex")),this.$button.click(function(){return!a.isDisabled()})},togglePlaceholder:function(){var a=this.$element.val();this.$button.toggleClass("bs-placeholder",null===a||""===a||a.constructor===Array&&0===a.length)},tabIndex:function(){this.$element.data("tabindex")!==this.$element.attr("tabindex")&&-98!==this.$element.attr("tabindex")&&"-98"!==this.$element.attr("tabindex")&&(this.$element.data("tabindex",this.$element.attr("tabindex")),this.$button.attr("tabindex",this.$element.data("tabindex"))),this.$element.attr("tabindex",-98)},clickListener:function(){var b=this,c=a(document);c.data("spaceSelect",!1),this.$button.on("keyup",function(a){/(32)/.test(a.keyCode.toString(10))&&c.data("spaceSelect")&&(a.preventDefault(),c.data("spaceSelect",!1))}),this.$button.on("click",function(){b.setSize()}),this.$element.on("shown.bs.select",function(){if(b.options.liveSearch||b.multiple){if(!b.multiple){var a=b.liObj[b.$element[0].selectedIndex];if("number"!=typeof a||!1===b.options.size)return;var c=b.$lis.eq(a)[0].offsetTop-b.$menuInner[0].offsetTop;c=c-b.$menuInner[0].offsetHeight/2+b.sizeInfo.liHeight/2,b.$menuInner[0].scrollTop=c}}else b.$menuInner.find(".selected a").focus()}),this.$menuInner.on("click","li a",function(c){var d=a(this),f=d.parent().data("originalIndex"),g=b.$element.val(),h=b.$element.prop("selectedIndex"),i=!0;if(b.multiple&&1!==b.options.maxOptions&&c.stopPropagation(),c.preventDefault(),!b.isDisabled()&&!d.parent().hasClass("disabled")){var j=b.$element.find("option"),k=j.eq(f),l=k.prop("selected"),m=k.parent("optgroup"),n=b.options.maxOptions,o=m.data("maxOptions")||!1;if(b.multiple){if(k.prop("selected",!l),b.setSelected(f,!l),d.blur(),!1!==n||!1!==o){var p=n<j.filter(":selected").length,q=o<m.find("option:selected").length;if(n&&p||o&&q)if(n&&1==n)j.prop("selected",!1),k.prop("selected",!0),b.$menuInner.find(".selected").removeClass("selected"),b.setSelected(f,!0);else if(o&&1==o){m.find("option:selected").prop("selected",!1),k.prop("selected",!0);var r=d.parent().data("optgroup");b.$menuInner.find('[data-optgroup="'+r+'"]').removeClass("selected"),b.setSelected(f,!0)}else{var s="string"==typeof b.options.maxOptionsText?[b.options.maxOptionsText,b.options.maxOptionsText]:b.options.maxOptionsText,t="function"==typeof s?s(n,o):s,u=t[0].replace("{n}",n),v=t[1].replace("{n}",o),w=a('<div class="notify"></div>');t[2]&&(u=u.replace("{var}",t[2][n>1?0:1]),v=v.replace("{var}",t[2][o>1?0:1])),k.prop("selected",!1),b.$menu.append(w),n&&p&&(w.append(a("<div>"+u+"</div>")),i=!1,b.$element.trigger("maxReached.bs.select")),o&&q&&(w.append(a("<div>"+v+"</div>")),i=!1,b.$element.trigger("maxReachedGrp.bs.select")),setTimeout(function(){b.setSelected(f,!1)},10),w.delay(750).fadeOut(300,function(){a(this).remove()})}}}else j.prop("selected",!1),k.prop("selected",!0),b.$menuInner.find(".selected").removeClass("selected").find("a").attr("aria-selected",!1),b.setSelected(f,!0);!b.multiple||b.multiple&&1===b.options.maxOptions?b.$button.focus():b.options.liveSearch&&b.$searchbox.focus(),i&&(g!=b.$element.val()&&b.multiple||h!=b.$element.prop("selectedIndex")&&!b.multiple)&&(e=[f,k.prop("selected"),l],b.$element.triggerNative("change"))}}),this.$menu.on("click","li.disabled a, .popover-title, .popover-title :not(.close)",function(c){c.currentTarget==this&&(c.preventDefault(),c.stopPropagation(),b.options.liveSearch&&!a(c.target).hasClass("close")?b.$searchbox.focus():b.$button.focus())}),this.$menuInner.on("click",".divider, .dropdown-header",function(a){a.preventDefault(),a.stopPropagation(),b.options.liveSearch?b.$searchbox.focus():b.$button.focus()}),this.$menu.on("click",".popover-title .close",function(){b.$button.click()}),this.$searchbox.on("click",function(a){a.stopPropagation()}),this.$menu.on("click",".actions-btn",function(c){b.options.liveSearch?b.$searchbox.focus():b.$button.focus(),c.preventDefault(),c.stopPropagation(),a(this).hasClass("bs-select-all")?b.selectAll():b.deselectAll()}),this.$element.change(function(){b.render(!1),b.$element.trigger("changed.bs.select",e),e=null})},liveSearchListener:function(){var c=this,d=a('<li class="no-results"></li>');this.$button.on("click.dropdown.data-api",function(){c.$menuInner.find(".active").removeClass("active"),c.$searchbox.val()&&(c.$searchbox.val(""),c.$lis.not(".is-hidden").removeClass("hidden"),d.parent().length&&d.remove()),c.multiple||c.$menuInner.find(".selected").addClass("active"),setTimeout(function(){c.$searchbox.focus()},10)}),this.$searchbox.on("click.dropdown.data-api focus.dropdown.data-api touchend.dropdown.data-api",function(a){a.stopPropagation()}),this.$searchbox.on("input propertychange",function(){if(c.$lis.not(".is-hidden").removeClass("hidden"),c.$lis.filter(".active").removeClass("active"),d.remove(),c.$searchbox.val()){var e,f=c.$lis.not(".is-hidden, .divider, .dropdown-header");if((e=c.options.liveSearchNormalize?f.find("a").not(":a"+c._searchStyle()+'("'+b(c.$searchbox.val())+'")'):f.find("a").not(":"+c._searchStyle()+'("'+c.$searchbox.val()+'")')).length===f.length)d.html(c.options.noneResultsText.replace("{0}",'"'+i(c.$searchbox.val())+'"')),c.$menuInner.append(d),c.$lis.addClass("hidden");else{e.parent().addClass("hidden");var g,h=c.$lis.not(".hidden");h.each(function(b){var c=a(this);c.hasClass("divider")?void 0===g?c.addClass("hidden"):(g&&g.addClass("hidden"),g=c):c.hasClass("dropdown-header")&&h.eq(b+1).data("optgroup")!==c.data("optgroup")?c.addClass("hidden"):g=null}),g&&g.addClass("hidden"),f.not(".hidden").first().addClass("active")}}})},_searchStyle:function(){return{begins:"ibegins",startsWith:"ibegins"}[this.options.liveSearchStyle]||"icontains"},val:function(a){return void 0!==a?(this.$element.val(a),this.render(),this.$element):this.$element.val()},changeAll:function(b){if(this.multiple){void 0===b&&(b=!0),this.findLis();var c=this.$element.find("option"),d=this.$lis.not(".divider, .dropdown-header, .disabled, .hidden"),e=d.length,f=[];if(b){if(d.filter(".selected").length===d.length)return}else if(0===d.filter(".selected").length)return;d.toggleClass("selected",b);for(var g=0;g<e;g++){var h=d[g].getAttribute("data-original-index");f[f.length]=c.eq(h)[0]}a(f).prop("selected",b),this.render(!1),this.togglePlaceholder(),this.$element.triggerNative("change")}},selectAll:function(){return this.changeAll(!0)},deselectAll:function(){return this.changeAll(!1)},toggle:function(a){(a=a||window.event)&&a.stopPropagation(),this.$button.trigger("click")},keydown:function(c){var d,e,f,g,h,i,j,k,l,m=a(this),n=m.is("input")?m.parent().parent():m.parent(),o=n.data("this"),p=":not(.disabled, .hidden, .dropdown-header, .divider)",q={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"};if(o.options.liveSearch&&(n=m.parent().parent()),o.options.container&&(n=o.$menu),d=a('[role="listbox"] li',n),!(l=o.$newElement.hasClass("open"))&&(c.keyCode>=48&&c.keyCode<=57||c.keyCode>=96&&c.keyCode<=105||c.keyCode>=65&&c.keyCode<=90))return o.options.container?o.$button.trigger("click"):(o.setSize(),o.$menu.parent().addClass("open"),l=!0),void o.$searchbox.focus();if(o.options.liveSearch&&(/(^9$|27)/.test(c.keyCode.toString(10))&&l&&(c.preventDefault(),c.stopPropagation(),o.$menuInner.click(),o.$button.focus()),d=a('[role="listbox"] li'+p,n),m.val()||/(38|40)/.test(c.keyCode.toString(10))||0===d.filter(".active").length&&(d=o.$menuInner.find("li"),d=o.options.liveSearchNormalize?d.filter(":a"+o._searchStyle()+"("+b(q[c.keyCode])+")"):d.filter(":"+o._searchStyle()+"("+q[c.keyCode]+")"))),d.length){if(/(38|40)/.test(c.keyCode.toString(10)))e=d.index(d.find("a").filter(":focus").parent()),g=d.filter(p).first().index(),h=d.filter(p).last().index(),f=d.eq(e).nextAll(p).eq(0).index(),i=d.eq(e).prevAll(p).eq(0).index(),j=d.eq(f).prevAll(p).eq(0).index(),o.options.liveSearch&&(d.each(function(b){a(this).hasClass("disabled")||a(this).data("index",b)}),e=d.index(d.filter(".active")),g=d.first().data("index"),h=d.last().data("index"),f=d.eq(e).nextAll().eq(0).data("index"),i=d.eq(e).prevAll().eq(0).data("index"),j=d.eq(f).prevAll().eq(0).data("index")),k=m.data("prevIndex"),38==c.keyCode?(o.options.liveSearch&&e--,e!=j&&e>i&&(e=i),e<g&&(e=g),e==k&&(e=h)):40==c.keyCode&&(o.options.liveSearch&&e++,-1==e&&(e=0),e!=j&&e<f&&(e=f),e>h&&(e=h),e==k&&(e=g)),m.data("prevIndex",e),o.options.liveSearch?(c.preventDefault(),m.hasClass("dropdown-toggle")||(d.removeClass("active").eq(e).addClass("active").children("a").focus(),m.focus())):d.eq(e).children("a").focus();else if(!m.is("input")){var r,t=[];d.each(function(){a(this).hasClass("disabled")||a.trim(a(this).children("a").text().toLowerCase()).substring(0,1)==q[c.keyCode]&&t.push(a(this).index())}),r=a(document).data("keycount"),r++,a(document).data("keycount",r),a.trim(a(":focus").text().toLowerCase()).substring(0,1)!=q[c.keyCode]?(r=1,a(document).data("keycount",r)):r>=t.length&&(a(document).data("keycount",0),r>t.length&&(r=1)),d.eq(t[r-1]).children("a").focus()}if((/(13|32)/.test(c.keyCode.toString(10))||/(^9$)/.test(c.keyCode.toString(10))&&o.options.selectOnTab)&&l){if(/(32)/.test(c.keyCode.toString(10))||c.preventDefault(),o.options.liveSearch)/(32)/.test(c.keyCode.toString(10))||(o.$menuInner.find(".active a").click(),m.focus());else{var u=a(":focus");u.click(),u.focus(),c.preventDefault(),a(document).data("spaceSelect",!0)}a(document).data("keycount",0)}(/(^9$|27)/.test(c.keyCode.toString(10))&&l&&(o.multiple||o.options.liveSearch)||/(27)/.test(c.keyCode.toString(10))&&!l)&&(o.$menu.parent().removeClass("open"),o.options.container&&o.$newElement.removeClass("open"),o.$button.focus())}},mobile:function(){this.$element.addClass("mobile-device")},refresh:function(){this.$lis=null,this.liObj={},this.reloadLi(),this.render(),this.checkDisabled(),this.liHeight(!0),this.setStyle(),this.setWidth(),this.$lis&&this.$searchbox.trigger("propertychange"),this.$element.trigger("refreshed.bs.select")},hide:function(){this.$newElement.hide()},show:function(){this.$newElement.show()},remove:function(){this.$newElement.remove(),this.$element.remove()},destroy:function(){this.$newElement.before(this.$element).remove(),this.$bsContainer?this.$bsContainer.remove():this.$menu.remove(),this.$element.off(".bs.select").removeData("selectpicker").removeClass("bs-select-hidden selectpicker")}};var l=a.fn.selectpicker;a.fn.selectpicker=c,a.fn.selectpicker.Constructor=k,a.fn.selectpicker.noConflict=function(){return a.fn.selectpicker=l,this},a(document).data("keycount",0).on("keydown.bs.select",'.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role="listbox"], .bs-searchbox input',k.prototype.keydown).on("focusin.modal",'.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role="listbox"], .bs-searchbox input',function(a){a.stopPropagation()}),a(window).on("load.bs.select.data-api",function(){a(".selectpicker").each(function(){var b=a(this);c.call(b,b.data())})})}(a)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.JSZip=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n||e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";exports.encode=function(input,utf8){for(var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;i<input.length;)enc1=(chr1=input.charCodeAt(i++))>>2,enc2=(3&chr1)<<4|(chr2=input.charCodeAt(i++))>>4,enc3=(15&chr2)<<2|(chr3=input.charCodeAt(i++))>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+_keyStr.charAt(enc1)+_keyStr.charAt(enc2)+_keyStr.charAt(enc3)+_keyStr.charAt(enc4);return output},exports.decode=function(input,utf8){var chr1,chr2,chr3,enc2,enc3,enc4,output="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)chr1=_keyStr.indexOf(input.charAt(i++))<<2|(enc2=_keyStr.indexOf(input.charAt(i++)))>>4,chr2=(15&enc2)<<4|(enc3=_keyStr.indexOf(input.charAt(i++)))>>2,chr3=(3&enc3)<<6|(enc4=_keyStr.indexOf(input.charAt(i++))),output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3));return output}},{}],2:[function(_dereq_,module,exports){"use strict";function CompressedObject(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}CompressedObject.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},module.exports=CompressedObject},{}],3:[function(_dereq_,module,exports){"use strict";exports.STORE={magic:"\0\0",compress:function(content){return content},uncompress:function(content){return content},compressInputType:null,uncompressInputType:null},exports.DEFLATE=_dereq_("./flate")},{"./flate":8}],4:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils"),table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];module.exports=function(input,crc){if(void 0===input||!input.length)return 0;var isArray="string"!==utils.getTypeOf(input);void 0===crc&&(crc=0);var b=0;crc^=-1;for(var i=0,iTop=input.length;i<iTop;i++)b=isArray?input[i]:input.charCodeAt(i),crc=crc>>>8^table[255&(crc^b)];return-1^crc}},{"./utils":21}],5:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils");function DataReader(data){this.data=null,this.length=0,this.index=0}DataReader.prototype={checkOffset:function(offset){this.checkIndex(this.index+offset)},checkIndex:function(newIndex){if(this.length<newIndex||newIndex<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+newIndex+"). Corrupted zip ?")},setIndex:function(newIndex){this.checkIndex(newIndex),this.index=newIndex},skip:function(n){this.setIndex(this.index+n)},byteAt:function(i){},readInt:function(size){var i,result=0;for(this.checkOffset(size),i=this.index+size-1;i>=this.index;i--)result=(result<<8)+this.byteAt(i);return this.index+=size,result},readString:function(size){return utils.transformTo("string",this.readData(size))},readData:function(size){},lastIndexOfSignature:function(sig){},readDate:function(){var dostime=this.readInt(4);return new Date(1980+(dostime>>25&127),(dostime>>21&15)-1,dostime>>16&31,dostime>>11&31,dostime>>5&63,(31&dostime)<<1)}},module.exports=DataReader},{"./utils":21}],6:[function(_dereq_,module,exports){"use strict";exports.base64=!1,exports.binary=!1,exports.dir=!1,exports.createFolders=!1,exports.date=null,exports.compression=null,exports.comment=null},{}],7:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils");exports.string2binary=function(str){return utils.string2binary(str)},exports.string2Uint8Array=function(str){return utils.transformTo("uint8array",str)},exports.uint8Array2String=function(array){return utils.transformTo("string",array)},exports.string2Blob=function(str){var buffer=utils.transformTo("arraybuffer",str);return utils.arrayBuffer2Blob(buffer)},exports.arrayBuffer2Blob=function(buffer){return utils.arrayBuffer2Blob(buffer)},exports.transformTo=function(outputType,input){return utils.transformTo(outputType,input)},exports.getTypeOf=function(input){return utils.getTypeOf(input)},exports.checkSupport=function(type){return utils.checkSupport(type)},exports.MAX_VALUE_16BITS=utils.MAX_VALUE_16BITS,exports.MAX_VALUE_32BITS=utils.MAX_VALUE_32BITS,exports.pretty=function(str){return utils.pretty(str)},exports.findCompression=function(compressionMethod){return utils.findCompression(compressionMethod)},exports.isRegExp=function(object){return utils.isRegExp(object)}},{"./utils":21}],8:[function(_dereq_,module,exports){"use strict";var USE_TYPEDARRAY="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,pako=_dereq_("pako");exports.uncompressInputType=USE_TYPEDARRAY?"uint8array":"array",exports.compressInputType=USE_TYPEDARRAY?"uint8array":"array",exports.magic="\b\0",exports.compress=function(input){return pako.deflateRaw(input)},exports.uncompress=function(input){return pako.inflateRaw(input)}},{pako:24}],9:[function(_dereq_,module,exports){"use strict";var base64=_dereq_("./base64");function JSZip(data,options){if(!(this instanceof JSZip))return new JSZip(data,options);this.files={},this.comment=null,this.root="",data&&this.load(data,options),this.clone=function(){var newObj=new JSZip;for(var i in this)"function"!=typeof this[i]&&(newObj[i]=this[i]);return newObj}}JSZip.prototype=_dereq_("./object"),JSZip.prototype.load=_dereq_("./load"),JSZip.support=_dereq_("./support"),JSZip.defaults=_dereq_("./defaults"),JSZip.utils=_dereq_("./deprecatedPublicUtils"),JSZip.base64={encode:function(input){return base64.encode(input)},decode:function(input){return base64.decode(input)}},JSZip.compressions=_dereq_("./compressions"),module.exports=JSZip},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(_dereq_,module,exports){"use strict";var base64=_dereq_("./base64"),ZipEntries=_dereq_("./zipEntries");module.exports=function(data,options){var files,zipEntries,i,input;for((options=options||{}).base64&&(data=base64.decode(data)),files=(zipEntries=new ZipEntries(data,options)).files,i=0;i<files.length;i++)input=files[i],this.file(input.fileName,input.decompressed,{binary:!0,optimizedBinaryString:!0,date:input.date,dir:input.dir,comment:input.fileComment.length?input.fileComment:null,createFolders:options.createFolders});return zipEntries.zipComment.length&&(this.comment=zipEntries.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(_dereq_,module,exports){(function(Buffer){"use strict";module.exports=function(data,encoding){return new Buffer(data,encoding)},module.exports.test=function(b){return Buffer.isBuffer(b)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(_dereq_,module,exports){"use strict";var Uint8ArrayReader=_dereq_("./uint8ArrayReader");function NodeBufferReader(data){this.data=data,this.length=this.data.length,this.index=0}NodeBufferReader.prototype=new Uint8ArrayReader,NodeBufferReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.index,this.index+size);return this.index+=size,result},module.exports=NodeBufferReader},{"./uint8ArrayReader":18}],13:[function(_dereq_,module,exports){"use strict";var support=_dereq_("./support"),utils=_dereq_("./utils"),crc32=_dereq_("./crc32"),signature=_dereq_("./signature"),defaults=_dereq_("./defaults"),base64=_dereq_("./base64"),compressions=_dereq_("./compressions"),CompressedObject=_dereq_("./compressedObject"),nodeBuffer=_dereq_("./nodeBuffer"),utf8=_dereq_("./utf8"),StringWriter=_dereq_("./stringWriter"),Uint8ArrayWriter=_dereq_("./uint8ArrayWriter"),getRawData=function(file){if(file._data instanceof CompressedObject&&(file._data=file._data.getContent(),file.options.binary=!0,file.options.base64=!1,"uint8array"===utils.getTypeOf(file._data))){var copy=file._data;file._data=new Uint8Array(copy.length),0!==copy.length&&file._data.set(copy,0)}return file._data},getBinaryData=function(file){var result=getRawData(file);return"string"===utils.getTypeOf(result)?!file.options.binary&&support.nodebuffer?nodeBuffer(result,"utf-8"):file.asBinary():result},dataToString=function(asUTF8){var result=getRawData(this);return null===result||void 0===result?"":(this.options.base64&&(result=base64.decode(result)),result=asUTF8&&this.options.binary?out.utf8decode(result):utils.transformTo("string",result),asUTF8||this.options.binary||(result=utils.transformTo("string",out.utf8encode(result))),result)},ZipObject=function(name,data,options){this.name=name,this.dir=options.dir,this.date=options.date,this.comment=options.comment,this._data=data,this.options=options,this._initialMetadata={dir:options.dir,date:options.date}};ZipObject.prototype={asText:function(){return dataToString.call(this,!0)},asBinary:function(){return dataToString.call(this,!1)},asNodeBuffer:function(){var result=getBinaryData(this);return utils.transformTo("nodebuffer",result)},asUint8Array:function(){var result=getBinaryData(this);return utils.transformTo("uint8array",result)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var decToHex=function(dec,bytes){var i,hex="";for(i=0;i<bytes;i++)hex+=String.fromCharCode(255&dec),dec>>>=8;return hex},extend=function(){var i,attr,result={};for(i=0;i<arguments.length;i++)for(attr in arguments[i])arguments[i].hasOwnProperty(attr)&&void 0===result[attr]&&(result[attr]=arguments[i][attr]);return result},fileAdd=function(name,data,o){var parent,dataType=utils.getTypeOf(data);if((o=function(o){return!0!==(o=o||{}).base64||null!==o.binary&&void 0!==o.binary||(o.binary=!0),(o=extend(o,defaults)).date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),o}(o)).createFolders&&(parent=parentFolder(name))&&folderAdd.call(this,parent,!0),o.dir||null===data||void 0===data)o.base64=!1,o.binary=!1,data=null;else if("string"===dataType)o.binary&&!o.base64&&!0!==o.optimizedBinaryString&&(data=utils.string2binary(data));else{if(o.base64=!1,o.binary=!0,!(dataType||data instanceof CompressedObject))throw new Error("The data of '"+name+"' is in an unsupported format !");"arraybuffer"===dataType&&(data=utils.transformTo("uint8array",data))}var object=new ZipObject(name,data,o);return this.files[name]=object,object},parentFolder=function(path){"/"==path.slice(-1)&&(path=path.substring(0,path.length-1));var lastSlash=path.lastIndexOf("/");return lastSlash>0?path.substring(0,lastSlash):""},folderAdd=function(name,createFolders){return"/"!=name.slice(-1)&&(name+="/"),createFolders=void 0!==createFolders&&createFolders,this.files[name]||fileAdd.call(this,name,null,{dir:!0,createFolders:createFolders}),this.files[name]},generateCompressedObjectFrom=function(file,compression){var content,result=new CompressedObject;return file._data instanceof CompressedObject?(result.uncompressedSize=file._data.uncompressedSize,result.crc32=file._data.crc32,0===result.uncompressedSize||file.dir?(compression=compressions.STORE,result.compressedContent="",result.crc32=0):file._data.compressionMethod===compression.magic?result.compressedContent=file._data.getCompressedContent():(content=file._data.getContent(),result.compressedContent=compression.compress(utils.transformTo(compression.compressInputType,content)))):((content=getBinaryData(file))&&0!==content.length&&!file.dir||(compression=compressions.STORE,content=""),result.uncompressedSize=content.length,result.crc32=crc32(content),result.compressedContent=compression.compress(utils.transformTo(compression.compressInputType,content))),result.compressedSize=result.compressedContent.length,result.compressionMethod=compression.magic,result},generateZipParts=function(name,file,compressedObject,offset){compressedObject.compressedContent;var dosTime,dosDate,dir,date,utfEncodedFileName=utils.transformTo("string",utf8.utf8encode(file.name)),comment=file.comment||"",utfEncodedComment=utils.transformTo("string",utf8.utf8encode(comment)),useUTF8ForFileName=utfEncodedFileName.length!==file.name.length,useUTF8ForComment=utfEncodedComment.length!==comment.length,o=file.options,extraFields="",unicodePathExtraField="",unicodeCommentExtraField="";dir=file._initialMetadata.dir!==file.dir?file.dir:o.dir,dosTime=(date=file._initialMetadata.date!==file.date?file.date:o.date).getHours(),dosTime<<=6,dosTime|=date.getMinutes(),dosTime<<=5,dosTime|=date.getSeconds()/2,dosDate=date.getFullYear()-1980,dosDate<<=4,dosDate|=date.getMonth()+1,dosDate<<=5,dosDate|=date.getDate(),useUTF8ForFileName&&(unicodePathExtraField=decToHex(1,1)+decToHex(crc32(utfEncodedFileName),4)+utfEncodedFileName,extraFields+="up"+decToHex(unicodePathExtraField.length,2)+unicodePathExtraField),useUTF8ForComment&&(unicodeCommentExtraField=decToHex(1,1)+decToHex(this.crc32(utfEncodedComment),4)+utfEncodedComment,extraFields+="uc"+decToHex(unicodeCommentExtraField.length,2)+unicodeCommentExtraField);var header="";return header+="\n\0",header+=useUTF8ForFileName||useUTF8ForComment?"\0\b":"\0\0",header+=compressedObject.compressionMethod,header+=decToHex(dosTime,2),header+=decToHex(dosDate,2),header+=decToHex(compressedObject.crc32,4),header+=decToHex(compressedObject.compressedSize,4),header+=decToHex(compressedObject.uncompressedSize,4),header+=decToHex(utfEncodedFileName.length,2),header+=decToHex(extraFields.length,2),{fileRecord:signature.LOCAL_FILE_HEADER+header+utfEncodedFileName+extraFields,dirRecord:signature.CENTRAL_FILE_HEADER+"\0"+header+decToHex(utfEncodedComment.length,2)+"\0\0\0\0"+(!0===dir?"\0\0\0":"\0\0\0\0")+decToHex(offset,4)+utfEncodedFileName+extraFields+utfEncodedComment,compressedObject:compressedObject}},out={load:function(stream,options){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(search){var filename,relativePath,file,fileClone,result=[];for(filename in this.files)this.files.hasOwnProperty(filename)&&(file=this.files[filename],fileClone=new ZipObject(file.name,file._data,extend(file.options)),relativePath=filename.slice(this.root.length,filename.length),filename.slice(0,this.root.length)===this.root&&search(relativePath,fileClone)&&result.push(fileClone));return result},file:function(name,data,o){if(1===arguments.length){if(utils.isRegExp(name)){var regexp=name;return this.filter(function(relativePath,file){return!file.dir&&regexp.test(relativePath)})}return this.filter(function(relativePath,file){return!file.dir&&relativePath===name})[0]||null}return name=this.root+name,fileAdd.call(this,name,data,o),this},folder:function(arg){if(!arg)return this;if(utils.isRegExp(arg))return this.filter(function(relativePath,file){return file.dir&&arg.test(relativePath)});var name=this.root+arg,newFolder=folderAdd.call(this,name),ret=this.clone();return ret.root=newFolder.name,ret},remove:function(name){name=this.root+name;var file=this.files[name];if(file||("/"!=name.slice(-1)&&(name+="/"),file=this.files[name]),file&&!file.dir)delete this.files[name];else for(var kids=this.filter(function(relativePath,file){return file.name.slice(0,name.length)===name}),i=0;i<kids.length;i++)delete this.files[kids[i].name];return this},generate:function(options){options=extend(options||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),utils.checkSupport(options.type);var writer,i,zipData=[],localDirLength=0,centralDirLength=0,utfEncodedComment=utils.transformTo("string",this.utf8encode(options.comment||this.comment||""));for(var name in this.files)if(this.files.hasOwnProperty(name)){var file=this.files[name],compressionName=file.options.compression||options.compression.toUpperCase(),compression=compressions[compressionName];if(!compression)throw new Error(compressionName+" is not a valid compression method !");var compressedObject=generateCompressedObjectFrom.call(this,file,compression),zipPart=generateZipParts.call(this,name,file,compressedObject,localDirLength);localDirLength+=zipPart.fileRecord.length+compressedObject.compressedSize,centralDirLength+=zipPart.dirRecord.length,zipData.push(zipPart)}var dirEnd;dirEnd=signature.CENTRAL_DIRECTORY_END+"\0\0\0\0"+decToHex(zipData.length,2)+decToHex(zipData.length,2)+decToHex(centralDirLength,4)+decToHex(localDirLength,4)+decToHex(utfEncodedComment.length,2)+utfEncodedComment;var typeName=options.type.toLowerCase();for(writer="uint8array"===typeName||"arraybuffer"===typeName||"blob"===typeName||"nodebuffer"===typeName?new Uint8ArrayWriter(localDirLength+centralDirLength+dirEnd.length):new StringWriter(localDirLength+centralDirLength+dirEnd.length),i=0;i<zipData.length;i++)writer.append(zipData[i].fileRecord),writer.append(zipData[i].compressedObject.compressedContent);for(i=0;i<zipData.length;i++)writer.append(zipData[i].dirRecord);writer.append(dirEnd);var zip=writer.finalize();switch(options.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return utils.transformTo(options.type.toLowerCase(),zip);case"blob":return utils.arrayBuffer2Blob(utils.transformTo("arraybuffer",zip));case"base64":return options.base64?base64.encode(zip):zip;default:return zip}},crc32:function(input,crc){return crc32(input,crc)},utf8encode:function(string){return utils.transformTo("string",utf8.utf8encode(string))},utf8decode:function(input){return utf8.utf8decode(input)}};module.exports=out},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(_dereq_,module,exports){"use strict";exports.LOCAL_FILE_HEADER="PK",exports.CENTRAL_FILE_HEADER="PK",exports.CENTRAL_DIRECTORY_END="PK",exports.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",exports.ZIP64_CENTRAL_DIRECTORY_END="PK",exports.DATA_DESCRIPTOR="PK\b"},{}],15:[function(_dereq_,module,exports){"use strict";var DataReader=_dereq_("./dataReader"),utils=_dereq_("./utils");function StringReader(data,optimizedBinaryString){this.data=data,optimizedBinaryString||(this.data=utils.string2binary(this.data)),this.length=this.data.length,this.index=0}StringReader.prototype=new DataReader,StringReader.prototype.byteAt=function(i){return this.data.charCodeAt(i)},StringReader.prototype.lastIndexOfSignature=function(sig){return this.data.lastIndexOf(sig)},StringReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.index,this.index+size);return this.index+=size,result},module.exports=StringReader},{"./dataReader":5,"./utils":21}],16:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils"),StringWriter=function(){this.data=[]};StringWriter.prototype={append:function(input){input=utils.transformTo("string",input),this.data.push(input)},finalize:function(){return this.data.join("")}},module.exports=StringWriter},{"./utils":21}],17:[function(_dereq_,module,exports){(function(Buffer){"use strict";if(exports.base64=!0,exports.array=!0,exports.string=!0,exports.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,exports.nodebuffer=void 0!==Buffer,exports.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)exports.blob=!1;else{var buffer=new ArrayBuffer(0);try{exports.blob=0===new Blob([buffer],{type:"application/zip"}).size}catch(e){try{var builder=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);builder.append(buffer),exports.blob=0===builder.getBlob("application/zip").size}catch(e){exports.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(_dereq_,module,exports){"use strict";var DataReader=_dereq_("./dataReader");function Uint8ArrayReader(data){data&&(this.data=data,this.length=this.data.length,this.index=0)}Uint8ArrayReader.prototype=new DataReader,Uint8ArrayReader.prototype.byteAt=function(i){return this.data[i]},Uint8ArrayReader.prototype.lastIndexOfSignature=function(sig){for(var sig0=sig.charCodeAt(0),sig1=sig.charCodeAt(1),sig2=sig.charCodeAt(2),sig3=sig.charCodeAt(3),i=this.length-4;i>=0;--i)if(this.data[i]===sig0&&this.data[i+1]===sig1&&this.data[i+2]===sig2&&this.data[i+3]===sig3)return i;return-1},Uint8ArrayReader.prototype.readData=function(size){if(this.checkOffset(size),0===size)return new Uint8Array(0);var result=this.data.subarray(this.index,this.index+size);return this.index+=size,result},module.exports=Uint8ArrayReader},{"./dataReader":5}],19:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./utils"),Uint8ArrayWriter=function(length){this.data=new Uint8Array(length),this.index=0};Uint8ArrayWriter.prototype={append:function(input){0!==input.length&&(input=utils.transformTo("uint8array",input),this.data.set(input,this.index),this.index+=input.length)},finalize:function(){return this.data}},module.exports=Uint8ArrayWriter},{"./utils":21}],20:[function(_dereq_,module,exports){"use strict";for(var utils=_dereq_("./utils"),support=_dereq_("./support"),nodeBuffer=_dereq_("./nodeBuffer"),_utf8len=new Array(256),i=0;i<256;i++)_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;_utf8len[254]=_utf8len[254]=1;var utf8border=function(buf,max){var pos;for((max=max||buf.length)>buf.length&&(max=buf.length),pos=max-1;pos>=0&&128==(192&buf[pos]);)pos--;return pos<0?max:0===pos?max:pos+_utf8len[buf[pos]]>max?pos:max},buf2string=function(buf){var i,out,c,c_len,len=buf.length,utf16buf=new Array(2*len);for(out=0,i=0;i<len;)if((c=buf[i++])<128)utf16buf[out++]=c;else if((c_len=_utf8len[c])>4)utf16buf[out++]=65533,i+=c_len-1;else{for(c&=2===c_len?31:3===c_len?15:7;c_len>1&&i<len;)c=c<<6|63&buf[i++],c_len--;c_len>1?utf16buf[out++]=65533:c<65536?utf16buf[out++]=c:(c-=65536,utf16buf[out++]=55296|c>>10&1023,utf16buf[out++]=56320|1023&c)}return utf16buf.length!==out&&(utf16buf.subarray?utf16buf=utf16buf.subarray(0,out):utf16buf.length=out),utils.applyFromCharCode(utf16buf)};exports.utf8encode=function(str){return support.nodebuffer?nodeBuffer(str,"utf-8"):function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),buf_len+=c<128?1:c<2048?2:c<65536?3:4;for(buf=support.uint8array?new Uint8Array(buf_len):new Array(buf_len),i=0,m_pos=0;i<buf_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),c<128?buf[i++]=c:c<2048?(buf[i++]=192|c>>>6,buf[i++]=128|63&c):c<65536?(buf[i++]=224|c>>>12,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c):(buf[i++]=240|c>>>18,buf[i++]=128|c>>>12&63,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c);return buf}(str)},exports.utf8decode=function(buf){if(support.nodebuffer)return utils.transformTo("nodebuffer",buf).toString("utf-8");for(var result=[],k=0,len=(buf=utils.transformTo(support.uint8array?"uint8array":"array",buf)).length;k<len;){var nextBoundary=utf8border(buf,Math.min(k+65536,len));support.uint8array?result.push(buf2string(buf.subarray(k,nextBoundary))):result.push(buf2string(buf.slice(k,nextBoundary))),k=nextBoundary}return result.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(_dereq_,module,exports){"use strict";var support=_dereq_("./support"),compressions=_dereq_("./compressions"),nodeBuffer=_dereq_("./nodeBuffer");function identity(input){return input}function stringToArrayLike(str,array){for(var i=0;i<str.length;++i)array[i]=255&str.charCodeAt(i);return array}function arrayLikeToString(array){var chunk=65536,result=[],len=array.length,type=exports.getTypeOf(array),k=0,canUseApply=!0;try{switch(type){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,nodeBuffer(0))}}catch(e){canUseApply=!1}if(!canUseApply){for(var resultStr="",i=0;i<array.length;i++)resultStr+=String.fromCharCode(array[i]);return resultStr}for(;k<len&&chunk>1;)try{"array"===type||"nodebuffer"===type?result.push(String.fromCharCode.apply(null,array.slice(k,Math.min(k+chunk,len)))):result.push(String.fromCharCode.apply(null,array.subarray(k,Math.min(k+chunk,len)))),k+=chunk}catch(e){chunk=Math.floor(chunk/2)}return result.join("")}function arrayLikeToArrayLike(arrayFrom,arrayTo){for(var i=0;i<arrayFrom.length;i++)arrayTo[i]=arrayFrom[i];return arrayTo}exports.string2binary=function(str){for(var result="",i=0;i<str.length;i++)result+=String.fromCharCode(255&str.charCodeAt(i));return result},exports.arrayBuffer2Blob=function(buffer){exports.checkSupport("blob");try{return new Blob([buffer],{type:"application/zip"})}catch(e){try{var builder=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return builder.append(buffer),builder.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},exports.applyFromCharCode=arrayLikeToString;var transform={};transform.string={string:identity,array:function(input){return stringToArrayLike(input,new Array(input.length))},arraybuffer:function(input){return transform.string.uint8array(input).buffer},uint8array:function(input){return stringToArrayLike(input,new Uint8Array(input.length))},nodebuffer:function(input){return stringToArrayLike(input,nodeBuffer(input.length))}},transform.array={string:arrayLikeToString,array:identity,arraybuffer:function(input){return new Uint8Array(input).buffer},uint8array:function(input){return new Uint8Array(input)},nodebuffer:function(input){return nodeBuffer(input)}},transform.arraybuffer={string:function(input){return arrayLikeToString(new Uint8Array(input))},array:function(input){return arrayLikeToArrayLike(new Uint8Array(input),new Array(input.byteLength))},arraybuffer:identity,uint8array:function(input){return new Uint8Array(input)},nodebuffer:function(input){return nodeBuffer(new Uint8Array(input))}},transform.uint8array={string:arrayLikeToString,array:function(input){return arrayLikeToArrayLike(input,new Array(input.length))},arraybuffer:function(input){return input.buffer},uint8array:identity,nodebuffer:function(input){return nodeBuffer(input)}},transform.nodebuffer={string:arrayLikeToString,array:function(input){return arrayLikeToArrayLike(input,new Array(input.length))},arraybuffer:function(input){return transform.nodebuffer.uint8array(input).buffer},uint8array:function(input){return arrayLikeToArrayLike(input,new Uint8Array(input.length))},nodebuffer:identity},exports.transformTo=function(outputType,input){if(input||(input=""),!outputType)return input;exports.checkSupport(outputType);var inputType=exports.getTypeOf(input);return transform[inputType][outputType](input)},exports.getTypeOf=function(input){return"string"==typeof input?"string":"[object Array]"===Object.prototype.toString.call(input)?"array":support.nodebuffer&&nodeBuffer.test(input)?"nodebuffer":support.uint8array&&input instanceof Uint8Array?"uint8array":support.arraybuffer&&input instanceof ArrayBuffer?"arraybuffer":void 0},exports.checkSupport=function(type){if(!support[type.toLowerCase()])throw new Error(type+" is not supported by this browser")},exports.MAX_VALUE_16BITS=65535,exports.MAX_VALUE_32BITS=-1,exports.pretty=function(str){var code,i,res="";for(i=0;i<(str||"").length;i++)res+="\\x"+((code=str.charCodeAt(i))<16?"0":"")+code.toString(16).toUpperCase();return res},exports.findCompression=function(compressionMethod){for(var method in compressions)if(compressions.hasOwnProperty(method)&&compressions[method].magic===compressionMethod)return compressions[method];return null},exports.isRegExp=function(object){return"[object RegExp]"===Object.prototype.toString.call(object)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(_dereq_,module,exports){"use strict";var StringReader=_dereq_("./stringReader"),NodeBufferReader=_dereq_("./nodeBufferReader"),Uint8ArrayReader=_dereq_("./uint8ArrayReader"),utils=_dereq_("./utils"),sig=_dereq_("./signature"),ZipEntry=_dereq_("./zipEntry"),support=_dereq_("./support"),jszipProto=_dereq_("./object");function ZipEntries(data,loadOptions){this.files=[],this.loadOptions=loadOptions,data&&this.load(data)}ZipEntries.prototype={checkSignature:function(expectedSignature){var signature=this.reader.readString(4);if(signature!==expectedSignature)throw new Error("Corrupted zip or bug : unexpected signature ("+utils.pretty(signature)+", expected "+utils.pretty(expectedSignature)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=jszipProto.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var extraFieldId,extraFieldLength,extraFieldValue,extraDataSize=this.zip64EndOfCentralSize-44;0<extraDataSize;)extraFieldId=this.reader.readInt(2),extraFieldLength=this.reader.readInt(4),extraFieldValue=this.reader.readString(extraFieldLength),this.zip64ExtensibleData[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var i,file;for(i=0;i<this.files.length;i++)file=this.files[i],this.reader.setIndex(file.localHeaderOffset),this.checkSignature(sig.LOCAL_FILE_HEADER),file.readLocalPart(this.reader),file.handleUTF8()},readCentralDir:function(){var file;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===sig.CENTRAL_FILE_HEADER;)(file=new ZipEntry({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(file)},readEndOfCentral:function(){var offset=this.reader.lastIndexOfSignature(sig.CENTRAL_DIRECTORY_END);if(-1===offset)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(offset),this.checkSignature(sig.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===utils.MAX_VALUE_16BITS||this.diskWithCentralDirStart===utils.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===utils.MAX_VALUE_16BITS||this.centralDirRecords===utils.MAX_VALUE_16BITS||this.centralDirSize===utils.MAX_VALUE_32BITS||this.centralDirOffset===utils.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(offset=this.reader.lastIndexOfSignature(sig.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(offset),this.checkSignature(sig.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(sig.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(data){var type=utils.getTypeOf(data);"string"!==type||support.uint8array?this.reader="nodebuffer"===type?new NodeBufferReader(data):new Uint8ArrayReader(utils.transformTo("uint8array",data)):this.reader=new StringReader(data,this.loadOptions.optimizedBinaryString)},load:function(data){this.prepareReader(data),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},module.exports=ZipEntries},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(_dereq_,module,exports){"use strict";var StringReader=_dereq_("./stringReader"),utils=_dereq_("./utils"),CompressedObject=_dereq_("./compressedObject"),jszipProto=_dereq_("./object");function ZipEntry(options,loadOptions){this.options=options,this.loadOptions=loadOptions}ZipEntry.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(reader,from,length){return function(){var previousIndex=reader.index;reader.setIndex(from);var compressedFileData=reader.readData(length);return reader.setIndex(previousIndex),compressedFileData}},prepareContent:function(reader,from,length,compression,uncompressedSize){return function(){var compressedFileData=utils.transformTo(compression.uncompressInputType,this.getCompressedContent()),uncompressedFileData=compression.uncompress(compressedFileData);if(uncompressedFileData.length!==uncompressedSize)throw new Error("Bug : uncompressed data size mismatch");return uncompressedFileData}},readLocalPart:function(reader){var compression,localExtraFieldsLength;if(reader.skip(22),this.fileNameLength=reader.readInt(2),localExtraFieldsLength=reader.readInt(2),this.fileName=reader.readString(this.fileNameLength),reader.skip(localExtraFieldsLength),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(compression=utils.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+utils.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new CompressedObject,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(reader,reader.index,this.compressedSize,compression),this.decompressed.getContent=this.prepareContent(reader,reader.index,this.compressedSize,compression,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=utils.transformTo("string",this.decompressed.getContent()),jszipProto.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(reader){if(this.versionMadeBy=reader.readString(2),this.versionNeeded=reader.readInt(2),this.bitFlag=reader.readInt(2),this.compressionMethod=reader.readString(2),this.date=reader.readDate(),this.crc32=reader.readInt(4),this.compressedSize=reader.readInt(4),this.uncompressedSize=reader.readInt(4),this.fileNameLength=reader.readInt(2),this.extraFieldsLength=reader.readInt(2),this.fileCommentLength=reader.readInt(2),this.diskNumberStart=reader.readInt(2),this.internalFileAttributes=reader.readInt(2),this.externalFileAttributes=reader.readInt(4),this.localHeaderOffset=reader.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=reader.readString(this.fileNameLength),this.readExtraFields(reader),this.parseZIP64ExtraField(reader),this.fileComment=reader.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(reader){if(this.extraFields[1]){var extraReader=new StringReader(this.extraFields[1].value);this.uncompressedSize===utils.MAX_VALUE_32BITS&&(this.uncompressedSize=extraReader.readInt(8)),this.compressedSize===utils.MAX_VALUE_32BITS&&(this.compressedSize=extraReader.readInt(8)),this.localHeaderOffset===utils.MAX_VALUE_32BITS&&(this.localHeaderOffset=extraReader.readInt(8)),this.diskNumberStart===utils.MAX_VALUE_32BITS&&(this.diskNumberStart=extraReader.readInt(4))}},readExtraFields:function(reader){var extraFieldId,extraFieldLength,extraFieldValue,start=reader.index;for(this.extraFields=this.extraFields||{};reader.index<start+this.extraFieldsLength;)extraFieldId=reader.readInt(2),extraFieldLength=reader.readInt(2),extraFieldValue=reader.readString(extraFieldLength),this.extraFields[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}},handleUTF8:function(){if(this.useUTF8())this.fileName=jszipProto.utf8decode(this.fileName),this.fileComment=jszipProto.utf8decode(this.fileComment);else{var upath=this.findExtraFieldUnicodePath();null!==upath&&(this.fileName=upath);var ucomment=this.findExtraFieldUnicodeComment();null!==ucomment&&(this.fileComment=ucomment)}},findExtraFieldUnicodePath:function(){var upathField=this.extraFields[28789];if(upathField){var extraReader=new StringReader(upathField.value);return 1!==extraReader.readInt(1)?null:jszipProto.crc32(this.fileName)!==extraReader.readInt(4)?null:jszipProto.utf8decode(extraReader.readString(upathField.length-5))}return null},findExtraFieldUnicodeComment:function(){var ucommentField=this.extraFields[25461];if(ucommentField){var extraReader=new StringReader(ucommentField.value);return 1!==extraReader.readInt(1)?null:jszipProto.crc32(this.fileComment)!==extraReader.readInt(4)?null:jszipProto.utf8decode(extraReader.readString(ucommentField.length-5))}return null}},module.exports=ZipEntry},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(_dereq_,module,exports){"use strict";var pako={};(0,_dereq_("./lib/utils/common").assign)(pako,_dereq_("./lib/deflate"),_dereq_("./lib/inflate"),_dereq_("./lib/zlib/constants")),module.exports=pako},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(_dereq_,module,exports){"use strict";var zlib_deflate=_dereq_("./zlib/deflate.js"),utils=_dereq_("./utils/common"),strings=_dereq_("./utils/strings"),msg=_dereq_("./zlib/messages"),zstream=_dereq_("./zlib/zstream"),Deflate=function(options){this.options=utils.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},options||{});var opt=this.options;opt.raw&&opt.windowBits>0?opt.windowBits=-opt.windowBits:opt.gzip&&opt.windowBits>0&&opt.windowBits<16&&(opt.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var status=zlib_deflate.deflateInit2(this.strm,opt.level,opt.method,opt.windowBits,opt.memLevel,opt.strategy);if(0!==status)throw new Error(msg[status]);opt.header&&zlib_deflate.deflateSetHeader(this.strm,opt.header)};function deflate(input,options){var deflator=new Deflate(options);if(deflator.push(input,!0),deflator.err)throw deflator.msg;return deflator.result}Deflate.prototype.push=function(data,mode){var status,_mode,strm=this.strm,chunkSize=this.options.chunkSize;if(this.ended)return!1;_mode=mode===~~mode?mode:!0===mode?4:0,strm.input="string"==typeof data?strings.string2buf(data):data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(0===strm.avail_out&&(strm.output=new utils.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),1!==(status=zlib_deflate.deflate(strm,_mode))&&0!==status)return this.onEnd(status),this.ended=!0,!1;(0===strm.avail_out||0===strm.avail_in&&4===_mode)&&("string"===this.options.to?this.onData(strings.buf2binstring(utils.shrinkBuf(strm.output,strm.next_out))):this.onData(utils.shrinkBuf(strm.output,strm.next_out)))}while((strm.avail_in>0||0===strm.avail_out)&&1!==status);return 4!==_mode||(status=zlib_deflate.deflateEnd(this.strm),this.onEnd(status),this.ended=!0,0===status)},Deflate.prototype.onData=function(chunk){this.chunks.push(chunk)},Deflate.prototype.onEnd=function(status){0===status&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg},exports.Deflate=Deflate,exports.deflate=deflate,exports.deflateRaw=function(input,options){return(options=options||{}).raw=!0,deflate(input,options)},exports.gzip=function(input,options){return(options=options||{}).gzip=!0,deflate(input,options)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(_dereq_,module,exports){"use strict";var zlib_inflate=_dereq_("./zlib/inflate.js"),utils=_dereq_("./utils/common"),strings=_dereq_("./utils/strings"),c=_dereq_("./zlib/constants"),msg=_dereq_("./zlib/messages"),zstream=_dereq_("./zlib/zstream"),gzheader=_dereq_("./zlib/gzheader"),Inflate=function(options){this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;opt.raw&&opt.windowBits>=0&&opt.windowBits<16&&(opt.windowBits=-opt.windowBits,0===opt.windowBits&&(opt.windowBits=-15)),!(opt.windowBits>=0&&opt.windowBits<16)||options&&options.windowBits||(opt.windowBits+=32),opt.windowBits>15&&opt.windowBits<48&&0==(15&opt.windowBits)&&(opt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK)throw new Error(msg[status]);this.header=new gzheader,zlib_inflate.inflateGetHeader(this.strm,this.header)};function inflate(input,options){var inflator=new Inflate(options);if(inflator.push(input,!0),inflator.err)throw inflator.msg;return inflator.result}Inflate.prototype.push=function(data,mode){var status,_mode,next_out_utf8,tail,utf8str,strm=this.strm,chunkSize=this.options.chunkSize;if(this.ended)return!1;_mode=mode===~~mode?mode:!0===mode?c.Z_FINISH:c.Z_NO_FLUSH,strm.input="string"==typeof data?strings.binstring2buf(data):data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(0===strm.avail_out&&(strm.output=new utils.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),(status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH))!==c.Z_STREAM_END&&status!==c.Z_OK)return this.onEnd(status),this.ended=!0,!1;strm.next_out&&(0===strm.avail_out||status===c.Z_STREAM_END||0===strm.avail_in&&_mode===c.Z_FINISH)&&("string"===this.options.to?(next_out_utf8=strings.utf8border(strm.output,strm.next_out),tail=strm.next_out-next_out_utf8,utf8str=strings.buf2string(strm.output,next_out_utf8),strm.next_out=tail,strm.avail_out=chunkSize-tail,tail&&utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0),this.onData(utf8str)):this.onData(utils.shrinkBuf(strm.output,strm.next_out)))}while(strm.avail_in>0&&status!==c.Z_STREAM_END);return status===c.Z_STREAM_END&&(_mode=c.Z_FINISH),_mode!==c.Z_FINISH||(status=zlib_inflate.inflateEnd(this.strm),this.onEnd(status),this.ended=!0,status===c.Z_OK)},Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)},Inflate.prototype.onEnd=function(status){status===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg},exports.Inflate=Inflate,exports.inflate=inflate,exports.inflateRaw=function(input,options){return(options=options||{}).raw=!0,inflate(input,options)},exports.ungzip=inflate},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(_dereq_,module,exports){"use strict";var TYPED_OK="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;exports.assign=function(obj){for(var sources=Array.prototype.slice.call(arguments,1);sources.length;){var source=sources.shift();if(source){if("object"!=typeof source)throw new TypeError(source+"must be non-object");for(var p in source)source.hasOwnProperty(p)&&(obj[p]=source[p])}}return obj},exports.shrinkBuf=function(buf,size){return buf.length===size?buf:buf.subarray?buf.subarray(0,size):(buf.length=size,buf)};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray)dest.set(src.subarray(src_offs,src_offs+len),dest_offs);else for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;for(len=0,i=0,l=chunks.length;i<l;i++)len+=chunks[i].length;for(result=new Uint8Array(len),pos=0,i=0,l=chunks.length;i<l;i++)chunk=chunks[i],result.set(chunk,pos),pos+=chunk.length;return result}},fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){on?(exports.Buf8=Uint8Array,exports.Buf16=Uint16Array,exports.Buf32=Int32Array,exports.assign(exports,fnTyped)):(exports.Buf8=Array,exports.Buf16=Array,exports.Buf32=Array,exports.assign(exports,fnUntyped))},exports.setTyped(TYPED_OK)},{}],28:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./common"),STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=!1}for(var _utf8len=new utils.Buf8(256),i=0;i<256;i++)_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;function buf2binstring(buf,len){if(len<65537&&(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len));for(var result="",i=0;i<len;i++)result+=String.fromCharCode(buf[i]);return result}_utf8len[254]=_utf8len[254]=1,exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),buf_len+=c<128?1:c<2048?2:c<65536?3:4;for(buf=new utils.Buf8(buf_len),i=0,m_pos=0;i<buf_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),c<128?buf[i++]=c:c<2048?(buf[i++]=192|c>>>6,buf[i++]=128|63&c):c<65536?(buf[i++]=224|c>>>12,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c):(buf[i++]=240|c>>>18,buf[i++]=128|c>>>12&63,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c);return buf},exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)},exports.binstring2buf=function(str){for(var buf=new utils.Buf8(str.length),i=0,len=buf.length;i<len;i++)buf[i]=str.charCodeAt(i);return buf},exports.buf2string=function(buf,max){var i,out,c,c_len,len=max||buf.length,utf16buf=new Array(2*len);for(out=0,i=0;i<len;)if((c=buf[i++])<128)utf16buf[out++]=c;else if((c_len=_utf8len[c])>4)utf16buf[out++]=65533,i+=c_len-1;else{for(c&=2===c_len?31:3===c_len?15:7;c_len>1&&i<len;)c=c<<6|63&buf[i++],c_len--;c_len>1?utf16buf[out++]=65533:c<65536?utf16buf[out++]=c:(c-=65536,utf16buf[out++]=55296|c>>10&1023,utf16buf[out++]=56320|1023&c)}return buf2binstring(utf16buf,out)},exports.utf8border=function(buf,max){var pos;for((max=max||buf.length)>buf.length&&(max=buf.length),pos=max-1;pos>=0&&128==(192&buf[pos]);)pos--;return pos<0?max:0===pos?max:pos+_utf8len[buf[pos]]>max?pos:max}},{"./common":27}],29:[function(_dereq_,module,exports){"use strict";module.exports=function(adler,buf,len,pos){for(var s1=65535&adler|0,s2=adler>>>16&65535|0,n=0;0!==len;){len-=n=len>2e3?2e3:len;do{s2=s2+(s1=s1+buf[pos++]|0)|0}while(--n);s1%=65521,s2%=65521}return s1|s2<<16|0}},{}],30:[function(_dereq_,module,exports){module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(_dereq_,module,exports){"use strict";var crcTable=function(){for(var c,table=[],n=0;n<256;n++){c=n;for(var k=0;k<8;k++)c=1&c?3988292384^c>>>1:c>>>1;table[n]=c}return table}();module.exports=function(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++)crc=crc>>>8^t[255&(crc^buf[i])];return-1^crc}},{}],32:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common"),trees=_dereq_("./trees"),adler32=_dereq_("./adler32"),crc32=_dereq_("./crc32"),msg=_dereq_("./messages"),Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH=4,Z_BLOCK=5,Z_OK=0,Z_STREAM_END=1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_BUF_ERROR=-5,Z_DEFAULT_COMPRESSION=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED=4,Z_DEFAULT_STRATEGY=0,Z_UNKNOWN=2,Z_DEFLATED=8,MAX_MEM_LEVEL=9,MAX_WBITS=15,DEF_MEM_LEVEL=8,L_CODES=286,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3;function err(strm,errorCode){return strm.msg=msg[errorCode],errorCode}function rank(f){return(f<<1)-(f>4?9:0)}function zero(buf){for(var len=buf.length;--len>=0;)buf[len]=0}function flush_pending(strm){var s=strm.state,len=s.pending;len>strm.avail_out&&(len=strm.avail_out),0!==len&&(utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out),strm.next_out+=len,s.pending_out+=len,strm.total_out+=len,strm.avail_out-=len,s.pending-=len,0===s.pending&&(s.pending_out=0))}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last),s.block_start=s.strstart,flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255,s.pending_buf[s.pending++]=255&b}function longest_match(s,cur_match){var match,len,chain_length=s.max_chain_length,scan=s.strstart,best_len=s.prev_length,nice_match=s.nice_match,limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0,_win=s.window,wmask=s.w_mask,prev=s.prev,strend=s.strstart+MAX_MATCH,scan_end1=_win[scan+best_len-1],scan_end=_win[scan+best_len];s.prev_length>=s.good_match&&(chain_length>>=2),nice_match>s.lookahead&&(nice_match=s.lookahead);do{if(_win[(match=cur_match)+best_len]===scan_end&&_win[match+best_len-1]===scan_end1&&_win[match]===_win[scan]&&_win[++match]===_win[scan+1]){scan+=2,match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);if(len=MAX_MATCH-(strend-scan),scan=strend-MAX_MATCH,len>best_len){if(s.match_start=cur_match,best_len=len,len>=nice_match)break;scan_end1=_win[scan+best_len-1],scan_end=_win[scan+best_len]}}}while((cur_match=prev[cur_match&wmask])>limit&&0!=--chain_length);return best_len<=s.lookahead?best_len:s.lookahead}function fill_window(s){var p,n,m,more,str,strm,buf,start,size,len,_w_size=s.w_size;do{if(more=s.window_size-s.lookahead-s.strstart,s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0),s.match_start-=_w_size,s.strstart-=_w_size,s.block_start-=_w_size,p=n=s.hash_size;do{m=s.head[--p],s.head[p]=m>=_w_size?m-_w_size:0}while(--n);p=n=_w_size;do{m=s.prev[--p],s.prev[p]=m>=_w_size?m-_w_size:0}while(--n);more+=_w_size}if(0===s.strm.avail_in)break;if(strm=s.strm,buf=s.window,start=s.strstart+s.lookahead,size=more,len=void 0,(len=strm.avail_in)>size&&(len=size),n=0===len?0:(strm.avail_in-=len,utils.arraySet(buf,strm.input,strm.next_in,len,start),1===strm.state.wrap?strm.adler=adler32(strm.adler,buf,len,start):2===strm.state.wrap&&(strm.adler=crc32(strm.adler,buf,len,start)),strm.next_in+=len,strm.total_in+=len,len),s.lookahead+=n,s.lookahead+s.insert>=MIN_MATCH)for(str=s.strstart-s.insert,s.ins_h=s.window[str],s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;s.insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask,s.prev[str&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=str,str++,s.insert--,!(s.lookahead+s.insert<MIN_MATCH)););}while(s.lookahead<MIN_LOOKAHEAD&&0!==s.strm.avail_in)}function deflate_fast(s,flush){for(var hash_head,bflush;;){if(s.lookahead<MIN_LOOKAHEAD){if(fill_window(s),s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(hash_head=0,s.lookahead>=MIN_MATCH&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==hash_head&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD&&(s.match_length=longest_match(s,hash_head)),s.match_length>=MIN_MATCH)if(bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++,s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart}while(0!=--s.match_length);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask;else bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(s,flush){for(var hash_head,bflush,max_insert;;){if(s.lookahead<MIN_LOOKAHEAD){if(fill_window(s),s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(hash_head=0,s.lookahead>=MIN_MATCH&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=MIN_MATCH-1,0!==hash_head&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD&&(s.match_length=longest_match(s,hash_head),s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096)&&(s.match_length=MIN_MATCH-1)),s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH,bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH),s.lookahead-=s.prev_length-1,s.prev_length-=2;do{++s.strstart<=max_insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask,hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart)}while(0!=--s.prev_length);if(s.match_available=0,s.match_length=MIN_MATCH-1,s.strstart++,bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}else if(s.match_available){if((bflush=trees._tr_tally(s,0,s.window[s.strstart-1]))&&flush_block_only(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return BS_NEED_MORE}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(bflush=trees._tr_tally(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}var configuration_table,Config=function(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length,this.max_lazy=max_lazy,this.nice_length=nice_length,this.max_chain=max_chain,this.func=func};function deflateResetKeep(strm){var s;return strm&&strm.state?(strm.total_in=strm.total_out=0,strm.data_type=Z_UNKNOWN,(s=strm.state).pending=0,s.pending_out=0,s.wrap<0&&(s.wrap=-s.wrap),s.status=s.wrap?INIT_STATE:BUSY_STATE,strm.adler=2===s.wrap?0:1,s.last_flush=Z_NO_FLUSH,trees._tr_init(s),Z_OK):err(strm,Z_STREAM_ERROR)}function deflateReset(strm){var s,ret=deflateResetKeep(strm);return ret===Z_OK&&((s=strm.state).window_size=2*s.w_size,zero(s.head),s.max_lazy_match=configuration_table[s.level].max_lazy,s.good_match=configuration_table[s.level].good_length,s.nice_match=configuration_table[s.level].nice_length,s.max_chain_length=configuration_table[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=MIN_MATCH-1,s.match_available=0,s.ins_h=0),ret}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm)return Z_STREAM_ERROR;var wrap=1;if(level===Z_DEFAULT_COMPRESSION&&(level=6),windowBits<0?(wrap=0,windowBits=-windowBits):windowBits>15&&(wrap=2,windowBits-=16),memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED)return err(strm,Z_STREAM_ERROR);8===windowBits&&(windowBits=9);var s=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new utils.Buf16(2*HEAP_SIZE),this.dyn_dtree=new utils.Buf16(2*(2*D_CODES+1)),this.bl_tree=new utils.Buf16(2*(2*BL_CODES+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new utils.Buf16(MAX_BITS+1),this.heap=new utils.Buf16(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new utils.Buf16(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return strm.state=s,s.strm=strm,s.wrap=wrap,s.gzhead=null,s.w_bits=windowBits,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=memLevel+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH),s.window=new utils.Buf8(2*s.w_size),s.head=new utils.Buf16(s.hash_size),s.prev=new utils.Buf16(s.w_size),s.lit_bufsize=1<<memLevel+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new utils.Buf8(s.pending_buf_size),s.d_buf=s.lit_bufsize>>1,s.l_buf=3*s.lit_bufsize,s.level=level,s.strategy=strategy,s.method=method,deflateReset(strm)}configuration_table=[new Config(0,0,0,0,function(s,flush){var max_block_size=65535;for(max_block_size>s.pending_buf_size-5&&(max_block_size=s.pending_buf_size-5);;){if(s.lookahead<=1){if(fill_window(s),0===s.lookahead&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}s.strstart+=s.lookahead,s.lookahead=0;var max_start=s.block_start+max_block_size;if((0===s.strstart||s.strstart>=max_start)&&(s.lookahead=s.strstart-max_start,s.strstart=max_start,flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE;if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(s.strstart>s.block_start&&(flush_block_only(s,!1),s.strm.avail_out),BS_NEED_MORE)}),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],exports.deflateInit=function(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)},exports.deflateInit2=deflateInit2,exports.deflateReset=deflateReset,exports.deflateResetKeep=deflateResetKeep,exports.deflateSetHeader=function(strm,head){return strm&&strm.state?2!==strm.state.wrap?Z_STREAM_ERROR:(strm.state.gzhead=head,Z_OK):Z_STREAM_ERROR},exports.deflate=function(strm,flush){var old_flush,s,beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0)return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR;if(s=strm.state,!strm.output||!strm.input&&0!==strm.avail_in||s.status===FINISH_STATE&&flush!==Z_FINISH)return err(strm,0===strm.avail_out?Z_BUF_ERROR:Z_STREAM_ERROR);if(s.strm=strm,old_flush=s.last_flush,s.last_flush=flush,s.status===INIT_STATE)if(2===s.wrap)strm.adler=0,put_byte(s,31),put_byte(s,139),put_byte(s,8),s.gzhead?(put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),put_byte(s,255&s.gzhead.time),put_byte(s,s.gzhead.time>>8&255),put_byte(s,s.gzhead.time>>16&255),put_byte(s,s.gzhead.time>>24&255),put_byte(s,9===s.level?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(put_byte(s,255&s.gzhead.extra.length),put_byte(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=EXTRA_STATE):(put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,9===s.level?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,OS_CODE),s.status=BUSY_STATE);else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;header|=(s.strategy>=Z_HUFFMAN_ONLY||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(header|=PRESET_DICT),header+=31-header%31,s.status=BUSY_STATE,putShortMSB(s,header),0!==s.strstart&&(putShortMSB(s,strm.adler>>>16),putShortMSB(s,65535&strm.adler)),strm.adler=1}if(s.status===EXTRA_STATE)if(s.gzhead.extra){for(beg=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending!==s.pending_buf_size));)put_byte(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=NAME_STATE)}else s.status=NAME_STATE;if(s.status===NAME_STATE)if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size)){val=1;break}val=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,put_byte(s,val)}while(0!==val);s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),0===val&&(s.gzindex=0,s.status=COMMENT_STATE)}else s.status=COMMENT_STATE;if(s.status===COMMENT_STATE)if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),flush_pending(strm),beg=s.pending,s.pending===s.pending_buf_size)){val=1;break}val=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,put_byte(s,val)}while(0!==val);s.gzhead.hcrc&&s.pending>beg&&(strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)),0===val&&(s.status=HCRC_STATE)}else s.status=HCRC_STATE;if(s.status===HCRC_STATE&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&flush_pending(strm),s.pending+2<=s.pending_buf_size&&(put_byte(s,255&strm.adler),put_byte(s,strm.adler>>8&255),strm.adler=0,s.status=BUSY_STATE)):s.status=BUSY_STATE),0!==s.pending){if(flush_pending(strm),0===strm.avail_out)return s.last_flush=-1,Z_OK}else if(0===strm.avail_in&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH)return err(strm,Z_BUF_ERROR);if(s.status===FINISH_STATE&&0!==strm.avail_in)return err(strm,Z_BUF_ERROR);if(0!==strm.avail_in||0!==s.lookahead||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?function(s,flush){for(var bflush;;){if(0===s.lookahead&&(fill_window(s),0===s.lookahead)){if(flush===Z_NO_FLUSH)return BS_NEED_MORE;break}if(s.match_length=0,bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}(s,flush):s.strategy===Z_RLE?function(s,flush){for(var bflush,prev,scan,strend,_win=s.window;;){if(s.lookahead<=MAX_MATCH){if(fill_window(s),s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(0===s.lookahead)break}if(s.match_length=0,s.lookahead>=MIN_MATCH&&s.strstart>0&&(prev=_win[scan=s.strstart-1])===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=MIN_MATCH?(bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(bflush=trees._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),bflush&&(flush_block_only(s,!1),0===s.strm.avail_out))return BS_NEED_MORE}return s.insert=0,flush===Z_FINISH?(flush_block_only(s,!0),0===s.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):s.last_lit&&(flush_block_only(s,!1),0===s.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}(s,flush):configuration_table[s.level].func(s,flush);if(bstate!==BS_FINISH_STARTED&&bstate!==BS_FINISH_DONE||(s.status=FINISH_STATE),bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED)return 0===strm.avail_out&&(s.last_flush=-1),Z_OK;if(bstate===BS_BLOCK_DONE&&(flush===Z_PARTIAL_FLUSH?trees._tr_align(s):flush!==Z_BLOCK&&(trees._tr_stored_block(s,0,0,!1),flush===Z_FULL_FLUSH&&(zero(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),flush_pending(strm),0===strm.avail_out))return s.last_flush=-1,Z_OK}return flush!==Z_FINISH?Z_OK:s.wrap<=0?Z_STREAM_END:(2===s.wrap?(put_byte(s,255&strm.adler),put_byte(s,strm.adler>>8&255),put_byte(s,strm.adler>>16&255),put_byte(s,strm.adler>>24&255),put_byte(s,255&strm.total_in),put_byte(s,strm.total_in>>8&255),put_byte(s,strm.total_in>>16&255),put_byte(s,strm.total_in>>24&255)):(putShortMSB(s,strm.adler>>>16),putShortMSB(s,65535&strm.adler)),flush_pending(strm),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Z_OK:Z_STREAM_END)},exports.deflateEnd=function(strm){var status;return strm&&strm.state?(status=strm.state.status)!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE?err(strm,Z_STREAM_ERROR):(strm.state=null,status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK):Z_STREAM_ERROR},exports.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(_dereq_,module,exports){"use strict";module.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],34:[function(_dereq_,module,exports){"use strict";module.exports=function(strm,start){var state,_in,last,_out,beg,end,dmax,wsize,whave,wnext,window,hold,bits,lcode,dcode,lmask,dmask,here,op,len,dist,from,from_source,input,output;state=strm.state,_in=strm.next_in,input=strm.input,last=_in+(strm.avail_in-5),_out=strm.next_out,output=strm.output,beg=_out-(start-strm.avail_out),end=_out+(strm.avail_out-257),dmax=state.dmax,wsize=state.wsize,whave=state.whave,wnext=state.wnext,window=state.window,hold=state.hold,bits=state.bits,lcode=state.lencode,dcode=state.distcode,lmask=(1<<state.lenbits)-1,dmask=(1<<state.distbits)-1;top:do{bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=lcode[hold&lmask];dolen:for(;;){if(hold>>>=op=here>>>24,bits-=op,0===(op=here>>>16&255))output[_out++]=65535&here;else{if(!(16&op)){if(0==(64&op)){here=lcode[(65535&here)+(hold&(1<<op)-1)];continue dolen}if(32&op){state.mode=12;break top}strm.msg="invalid literal/length code",state.mode=30;break top}len=65535&here,(op&=15)&&(bits<op&&(hold+=input[_in++]<<bits,bits+=8),len+=hold&(1<<op)-1,hold>>>=op,bits-=op),bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=dcode[hold&dmask];dodist:for(;;){if(hold>>>=op=here>>>24,bits-=op,!(16&(op=here>>>16&255))){if(0==(64&op)){here=dcode[(65535&here)+(hold&(1<<op)-1)];continue dodist}strm.msg="invalid distance code",state.mode=30;break top}if(dist=65535&here,bits<(op&=15)&&(hold+=input[_in++]<<bits,(bits+=8)<op&&(hold+=input[_in++]<<bits,bits+=8)),(dist+=hold&(1<<op)-1)>dmax){strm.msg="invalid distance too far back",state.mode=30;break top}if(hold>>>=op,bits-=op,dist>(op=_out-beg)){if((op=dist-op)>whave&&state.sane){strm.msg="invalid distance too far back",state.mode=30;break top}if(from=0,from_source=window,0===wnext){if(from+=wsize-op,op<len){len-=op;do{output[_out++]=window[from++]}while(--op);from=_out-dist,from_source=output}}else if(wnext<op){if(from+=wsize+wnext-op,(op-=wnext)<len){len-=op;do{output[_out++]=window[from++]}while(--op);if(from=0,wnext<len){len-=op=wnext;do{output[_out++]=window[from++]}while(--op);from=_out-dist,from_source=output}}}else if(from+=wnext-op,op<len){len-=op;do{output[_out++]=window[from++]}while(--op);from=_out-dist,from_source=output}for(;len>2;)output[_out++]=from_source[from++],output[_out++]=from_source[from++],output[_out++]=from_source[from++],len-=3;len&&(output[_out++]=from_source[from++],len>1&&(output[_out++]=from_source[from++]))}else{from=_out-dist;do{output[_out++]=output[from++],output[_out++]=output[from++],output[_out++]=output[from++],len-=3}while(len>2);len&&(output[_out++]=output[from++],len>1&&(output[_out++]=output[from++]))}break}}break}}while(_in<last&&_out<end);_in-=len=bits>>3,hold&=(1<<(bits-=len<<3))-1,strm.next_in=_in,strm.next_out=_out,strm.avail_in=_in<last?last-_in+5:5-(_in-last),strm.avail_out=_out<end?end-_out+257:257-(_out-end),state.hold=hold,state.bits=bits}},{}],35:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common"),adler32=_dereq_("./adler32"),crc32=_dereq_("./crc32"),inflate_fast=_dereq_("./inffast"),inflate_table=_dereq_("./inftrees"),CODES=0,LENS=1,DISTS=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,DEF_WBITS=15;function ZSWAP32(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function inflateResetKeep(strm){var state;return strm&&strm.state?(state=strm.state,strm.total_in=strm.total_out=state.total=0,strm.msg="",state.wrap&&(strm.adler=1&state.wrap),state.mode=HEAD,state.last=0,state.havedict=0,state.dmax=32768,state.head=null,state.hold=0,state.bits=0,state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS),state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS),state.sane=1,state.back=-1,Z_OK):Z_STREAM_ERROR}function inflateReset(strm){var state;return strm&&strm.state?((state=strm.state).wsize=0,state.whave=0,state.wnext=0,inflateResetKeep(strm)):Z_STREAM_ERROR}function inflateReset2(strm,windowBits){var wrap,state;return strm&&strm.state?(state=strm.state,windowBits<0?(wrap=0,windowBits=-windowBits):(wrap=1+(windowBits>>4),windowBits<48&&(windowBits&=15)),windowBits&&(windowBits<8||windowBits>15)?Z_STREAM_ERROR:(null!==state.window&&state.wbits!==windowBits&&(state.window=null),state.wrap=wrap,state.wbits=windowBits,inflateReset(strm))):Z_STREAM_ERROR}function inflateInit2(strm,windowBits){var ret,state;return strm?(state=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new utils.Buf16(320),this.work=new utils.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},strm.state=state,state.window=null,(ret=inflateReset2(strm,windowBits))!==Z_OK&&(strm.state=null),ret):Z_STREAM_ERROR}var lenfix,distfix,virgin=!0;function fixedtables(state){if(virgin){var sym;for(lenfix=new utils.Buf32(512),distfix=new utils.Buf32(32),sym=0;sym<144;)state.lens[sym++]=8;for(;sym<256;)state.lens[sym++]=9;for(;sym<280;)state.lens[sym++]=7;for(;sym<288;)state.lens[sym++]=8;for(inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9}),sym=0;sym<32;)state.lens[sym++]=5;inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5}),virgin=!1}state.lencode=lenfix,state.lenbits=9,state.distcode=distfix,state.distbits=5}exports.inflateReset=inflateReset,exports.inflateReset2=inflateReset2,exports.inflateResetKeep=inflateResetKeep,exports.inflateInit=function(strm){return inflateInit2(strm,DEF_WBITS)},exports.inflateInit2=inflateInit2,exports.inflate=function(strm,flush){var state,input,output,next,put,have,left,hold,bits,_in,_out,copy,from,from_source,here_bits,here_op,here_val,last_bits,last_op,last_val,len,ret,opts,n,here=0,hbuf=new utils.Buf8(4),order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&0!==strm.avail_in)return Z_STREAM_ERROR;(state=strm.state).mode===TYPE&&(state.mode=TYPEDO),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,_in=have,_out=left,ret=Z_OK;inf_leave:for(;;)switch(state.mode){case HEAD:if(0===state.wrap){state.mode=TYPEDO;break}for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(2&state.wrap&&35615===hold){state.check=0,hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0),hold=0,bits=0,state.mode=FLAGS;break}if(state.flags=0,state.head&&(state.head.done=!1),!(1&state.wrap)||(((255&hold)<<8)+(hold>>8))%31){strm.msg="incorrect header check",state.mode=BAD;break}if((15&hold)!==Z_DEFLATED){strm.msg="unknown compression method",state.mode=BAD;break}if(bits-=4,len=8+(15&(hold>>>=4)),0===state.wbits)state.wbits=len;else if(len>state.wbits){strm.msg="invalid window size",state.mode=BAD;break}state.dmax=1<<len,strm.adler=state.check=1,state.mode=512&hold?DICTID:TYPE,hold=0,bits=0;break;case FLAGS:for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.flags=hold,(255&state.flags)!==Z_DEFLATED){strm.msg="unknown compression method",state.mode=BAD;break}if(57344&state.flags){strm.msg="unknown header flags set",state.mode=BAD;break}state.head&&(state.head.text=hold>>8&1),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=TIME;case TIME:for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.time=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,hbuf[2]=hold>>>16&255,hbuf[3]=hold>>>24&255,state.check=crc32(state.check,hbuf,4,0)),hold=0,bits=0,state.mode=OS;case OS:for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.xflags=255&hold,state.head.os=hold>>8),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=EXLEN;case EXLEN:if(1024&state.flags){for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length=hold,state.head&&(state.head.extra_len=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0}else state.head&&(state.head.extra=null);state.mode=EXTRA;case EXTRA:if(1024&state.flags&&((copy=state.length)>have&&(copy=have),copy&&(state.head&&(len=state.head.extra_len-state.length,state.head.extra||(state.head.extra=new Array(state.head.extra_len)),utils.arraySet(state.head.extra,input,next,copy,len)),512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,state.length-=copy),state.length))break inf_leave;state.length=0,state.mode=NAME;case NAME:if(2048&state.flags){if(0===have)break inf_leave;copy=0;do{len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.name+=String.fromCharCode(len))}while(len&&copy<have);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.name=null);state.length=0,state.mode=COMMENT;case COMMENT:if(4096&state.flags){if(0===have)break inf_leave;copy=0;do{len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.comment+=String.fromCharCode(len))}while(len&&copy<have);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.comment=null);state.mode=HCRC;case HCRC:if(512&state.flags){for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(65535&state.check)){strm.msg="header crc mismatch",state.mode=BAD;break}hold=0,bits=0}state.head&&(state.head.hcrc=state.flags>>9&1,state.head.done=!0),strm.adler=state.check=0,state.mode=TYPE;break;case DICTID:for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}strm.adler=state.check=ZSWAP32(hold),hold=0,bits=0,state.mode=DICT;case DICT:if(0===state.havedict)return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,Z_NEED_DICT;strm.adler=state.check=1,state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES)break inf_leave;case TYPEDO:if(state.last){hold>>>=7&bits,bits-=7&bits,state.mode=CHECK;break}for(;bits<3;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}switch(state.last=1&hold,bits-=1,3&(hold>>>=1)){case 0:state.mode=STORED;break;case 1:if(fixedtables(state),state.mode=LEN_,flush===Z_TREES){hold>>>=2,bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type",state.mode=BAD}hold>>>=2,bits-=2;break;case STORED:for(hold>>>=7&bits,bits-=7&bits;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if((65535&hold)!=(hold>>>16^65535)){strm.msg="invalid stored block lengths",state.mode=BAD;break}if(state.length=65535&hold,hold=0,bits=0,state.mode=COPY_,flush===Z_TREES)break inf_leave;case COPY_:state.mode=COPY;case COPY:if(copy=state.length){if(copy>have&&(copy=have),copy>left&&(copy=left),0===copy)break inf_leave;utils.arraySet(output,input,next,copy,put),have-=copy,next+=copy,left-=copy,put+=copy,state.length-=copy;break}state.mode=TYPE;break;case TABLE:for(;bits<14;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.nlen=257+(31&hold),hold>>>=5,bits-=5,state.ndist=1+(31&hold),hold>>>=5,bits-=5,state.ncode=4+(15&hold),hold>>>=4,bits-=4,state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols",state.mode=BAD;break}state.have=0,state.mode=LENLENS;case LENLENS:for(;state.have<state.ncode;){for(;bits<3;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.lens[order[state.have++]]=7&hold,hold>>>=3,bits-=3}for(;state.have<19;)state.lens[order[state.have++]]=0;if(state.lencode=state.lendyn,state.lenbits=7,opts={bits:state.lenbits},ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid code lengths set",state.mode=BAD;break}state.have=0,state.mode=CODELENS;case CODELENS:for(;state.have<state.nlen+state.ndist;){for(;here_op=(here=state.lencode[hold&(1<<state.lenbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_val<16)hold>>>=here_bits,bits-=here_bits,state.lens[state.have++]=here_val;else{if(16===here_val){for(n=here_bits+2;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold>>>=here_bits,bits-=here_bits,0===state.have){strm.msg="invalid bit length repeat",state.mode=BAD;break}len=state.lens[state.have-1],copy=3+(3&hold),hold>>>=2,bits-=2}else if(17===here_val){for(n=here_bits+3;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}bits-=here_bits,len=0,copy=3+(7&(hold>>>=here_bits)),hold>>>=3,bits-=3}else{for(n=here_bits+7;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}bits-=here_bits,len=0,copy=11+(127&(hold>>>=here_bits)),hold>>>=7,bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat",state.mode=BAD;break}for(;copy--;)state.lens[state.have++]=len}}if(state.mode===BAD)break;if(0===state.lens[256]){strm.msg="invalid code -- missing end-of-block",state.mode=BAD;break}if(state.lenbits=9,opts={bits:state.lenbits},ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid literal/lengths set",state.mode=BAD;break}if(state.distbits=6,state.distcode=state.distdyn,opts={bits:state.distbits},ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts),state.distbits=opts.bits,ret){strm.msg="invalid distances set",state.mode=BAD;break}if(state.mode=LEN_,flush===Z_TREES)break inf_leave;case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,inflate_fast(strm,_out),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,state.mode===TYPE&&(state.back=-1);break}for(state.back=0;here_op=(here=state.lencode[hold&(1<<state.lenbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_op&&0==(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here_op=(here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)])>>>16&255,here_val=65535&here,!(last_bits+(here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,state.length=here_val,0===here_op){state.mode=LIT;break}if(32&here_op){state.back=-1,state.mode=TYPE;break}if(64&here_op){strm.msg="invalid literal/length code",state.mode=BAD;break}state.extra=15&here_op,state.mode=LENEXT;case LENEXT:if(state.extra){for(n=state.extra;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}state.was=state.length,state.mode=DIST;case DIST:for(;here_op=(here=state.distcode[hold&(1<<state.distbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(0==(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here_op=(here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)])>>>16&255,here_val=65535&here,!(last_bits+(here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,64&here_op){strm.msg="invalid distance code",state.mode=BAD;break}state.offset=here_val,state.extra=15&here_op,state.mode=DISTEXT;case DISTEXT:if(state.extra){for(n=state.extra;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.offset+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back",state.mode=BAD;break}state.mode=MATCH;case MATCH:if(0===left)break inf_leave;if(copy=_out-left,state.offset>copy){if((copy=state.offset-copy)>state.whave&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break}copy>state.wnext?(copy-=state.wnext,from=state.wsize-copy):from=state.wnext-copy,copy>state.length&&(copy=state.length),from_source=state.window}else from_source=output,from=put-state.offset,copy=state.length;copy>left&&(copy=left),left-=copy,state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);0===state.length&&(state.mode=LEN);break;case LIT:if(0===left)break inf_leave;output[put++]=state.length,left--,state.mode=LEN;break;case CHECK:if(state.wrap){for(;bits<32;){if(0===have)break inf_leave;have--,hold|=input[next++]<<bits,bits+=8}if(_out-=left,strm.total_out+=_out,state.total+=_out,_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)),_out=left,(state.flags?hold:ZSWAP32(hold))!==state.check){strm.msg="incorrect data check",state.mode=BAD;break}hold=0,bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(4294967295&state.total)){strm.msg="incorrect length check",state.mode=BAD;break}hold=0,bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH))&&function(strm,src,end,copy){var dist,state=strm.state;return null===state.window&&(state.wsize=1<<state.wbits,state.wnext=0,state.whave=0,state.window=new utils.Buf8(state.wsize)),copy>=state.wsize?(utils.arraySet(state.window,src,end-state.wsize,state.wsize,0),state.wnext=0,state.whave=state.wsize):((dist=state.wsize-state.wnext)>copy&&(dist=copy),utils.arraySet(state.window,src,end-copy,dist,state.wnext),(copy-=dist)?(utils.arraySet(state.window,src,end-copy,copy,0),state.wnext=copy,state.whave=state.wsize):(state.wnext+=dist,state.wnext===state.wsize&&(state.wnext=0),state.whave<state.wsize&&(state.whave+=dist))),0}(strm,strm.output,strm.next_out,_out-strm.avail_out)?(state.mode=MEM,Z_MEM_ERROR):(_in-=strm.avail_in,_out-=strm.avail_out,strm.total_in+=_in,strm.total_out+=_out,state.total+=_out,state.wrap&&_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)),strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0),(0===_in&&0===_out||flush===Z_FINISH)&&ret===Z_OK&&(ret=Z_BUF_ERROR),ret)},exports.inflateEnd=function(strm){if(!strm||!strm.state)return Z_STREAM_ERROR;var state=strm.state;return state.window&&(state.window=null),strm.state=null,Z_OK},exports.inflateGetHeader=function(strm,head){var state;return strm&&strm.state?0==(2&(state=strm.state).wrap)?Z_STREAM_ERROR:(state.head=head,head.done=!1,Z_OK):Z_STREAM_ERROR},exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common"),lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function(type,lens,lens_index,codes,table,table_index,work,opts){var incr,fill,low,mask,next,end,here_bits,here_op,here_val,bits=opts.bits,len=0,sym=0,min=0,max=0,root=0,curr=0,drop=0,left=0,used=0,huff=0,base=null,base_index=0,count=new utils.Buf16(16),offs=new utils.Buf16(16),extra=null,extra_index=0;for(len=0;len<=15;len++)count[len]=0;for(sym=0;sym<codes;sym++)count[lens[lens_index+sym]]++;for(root=bits,max=15;max>=1&&0===count[max];max--);if(root>max&&(root=max),0===max)return table[table_index++]=20971520,table[table_index++]=20971520,opts.bits=1,0;for(min=1;min<max&&0===count[min];min++);for(root<min&&(root=min),left=1,len=1;len<=15;len++)if(left<<=1,(left-=count[len])<0)return-1;if(left>0&&(0===type||1!==max))return-1;for(offs[1]=0,len=1;len<15;len++)offs[len+1]=offs[len]+count[len];for(sym=0;sym<codes;sym++)0!==lens[lens_index+sym]&&(work[offs[lens[lens_index+sym]]++]=sym);if(0===type?(base=extra=work,end=19):1===type?(base=lbase,base_index-=257,extra=lext,extra_index-=257,end=256):(base=dbase,extra=dext,end=-1),huff=0,sym=0,len=min,next=table_index,curr=root,drop=0,low=-1,mask=(used=1<<root)-1,1===type&&used>852||2===type&&used>592)return 1;for(;;){0,here_bits=len-drop,work[sym]<end?(here_op=0,here_val=work[sym]):work[sym]>end?(here_op=extra[extra_index+work[sym]],here_val=base[base_index+work[sym]]):(here_op=96,here_val=0),incr=1<<len-drop,min=fill=1<<curr;do{table[next+(huff>>drop)+(fill-=incr)]=here_bits<<24|here_op<<16|here_val|0}while(0!==fill);for(incr=1<<len-1;huff&incr;)incr>>=1;if(0!==incr?(huff&=incr-1,huff+=incr):huff=0,sym++,0==--count[len]){if(len===max)break;len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){for(0===drop&&(drop=root),next+=min,left=1<<(curr=len-drop);curr+drop<max&&!((left-=count[curr+drop])<=0);)curr++,left<<=1;if(used+=1<<curr,1===type&&used>852||2===type&&used>592)return 1;table[low=huff&mask]=root<<24|curr<<16|next-table_index|0}}return 0!==huff&&(table[next+huff]=len-drop<<24|64<<16|0),opts.bits=root,0}},{"../utils/common":27}],37:[function(_dereq_,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common"),Z_FIXED=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN=2;function zero(buf){for(var len=buf.length;--len>=0;)buf[len]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],static_ltree=new Array(2*(L_CODES+2));zero(static_ltree);var static_dtree=new Array(2*D_CODES);zero(static_dtree);var _dist_code=new Array(512);zero(_dist_code);var _length_code=new Array(256);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);var static_l_desc,static_d_desc,static_bl_desc,StaticTreeDesc=function(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree,this.extra_bits=extra_bits,this.extra_base=extra_base,this.elems=elems,this.max_length=max_length,this.has_stree=static_tree&&static_tree.length},TreeDesc=function(dyn_tree,stat_desc){this.dyn_tree=dyn_tree,this.max_code=0,this.stat_desc=stat_desc};function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=255&w,s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){s.bi_valid>Buf_size-length?(s.bi_buf|=value<<s.bi_valid&65535,put_short(s,s.bi_buf),s.bi_buf=value>>Buf_size-s.bi_valid,s.bi_valid+=length-Buf_size):(s.bi_buf|=value<<s.bi_valid&65535,s.bi_valid+=length)}function send_code(s,c,tree){send_bits(s,tree[2*c],tree[2*c+1])}function bi_reverse(code,len){var res=0;do{res|=1&code,code>>>=1,res<<=1}while(--len>0);return res>>>1}function gen_codes(tree,max_code,bl_count){var bits,n,next_code=new Array(MAX_BITS+1),code=0;for(bits=1;bits<=MAX_BITS;bits++)next_code[bits]=code=code+bl_count[bits-1]<<1;for(n=0;n<=max_code;n++){var len=tree[2*n+1];0!==len&&(tree[2*n]=bi_reverse(next_code[len]++,len))}}function init_block(s){var n;for(n=0;n<L_CODES;n++)s.dyn_ltree[2*n]=0;for(n=0;n<D_CODES;n++)s.dyn_dtree[2*n]=0;for(n=0;n<BL_CODES;n++)s.bl_tree[2*n]=0;s.dyn_ltree[2*END_BLOCK]=1,s.opt_len=s.static_len=0,s.last_lit=s.matches=0}function bi_windup(s){s.bi_valid>8?put_short(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0}function smaller(tree,n,m,depth){var _n2=2*n,_m2=2*m;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){for(var v=s.heap[k],j=k<<1;j<=s.heap_len&&(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)&&j++,!smaller(tree,v,s.heap[j],s.depth));)s.heap[k]=s.heap[j],k=j,j<<=1;s.heap[k]=v}function compress_block(s,ltree,dtree){var dist,lc,code,extra,lx=0;if(0!==s.last_lit)do{dist=s.pending_buf[s.d_buf+2*lx]<<8|s.pending_buf[s.d_buf+2*lx+1],lc=s.pending_buf[s.l_buf+lx],lx++,0===dist?send_code(s,lc,ltree):(send_code(s,(code=_length_code[lc])+LITERALS+1,ltree),0!==(extra=extra_lbits[code])&&send_bits(s,lc-=base_length[code],extra),send_code(s,code=d_code(--dist),dtree),0!==(extra=extra_dbits[code])&&send_bits(s,dist-=base_dist[code],extra))}while(lx<s.last_lit);send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var n,m,node,tree=desc.dyn_tree,stree=desc.stat_desc.static_tree,has_stree=desc.stat_desc.has_stree,elems=desc.stat_desc.elems,max_code=-1;for(s.heap_len=0,s.heap_max=HEAP_SIZE,n=0;n<elems;n++)0!==tree[2*n]?(s.heap[++s.heap_len]=max_code=n,s.depth[n]=0):tree[2*n+1]=0;for(;s.heap_len<2;)tree[2*(node=s.heap[++s.heap_len]=max_code<2?++max_code:0)]=1,s.depth[node]=0,s.opt_len--,has_stree&&(s.static_len-=stree[2*node+1]);for(desc.max_code=max_code,n=s.heap_len>>1;n>=1;n--)pqdownheap(s,tree,n);node=elems;do{n=s.heap[1],s.heap[1]=s.heap[s.heap_len--],pqdownheap(s,tree,1),m=s.heap[1],s.heap[--s.heap_max]=n,s.heap[--s.heap_max]=m,tree[2*node]=tree[2*n]+tree[2*m],s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1,tree[2*n+1]=tree[2*m+1]=node,s.heap[1]=node++,pqdownheap(s,tree,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],function(s,desc){var h,n,m,bits,xbits,f,tree=desc.dyn_tree,max_code=desc.max_code,stree=desc.stat_desc.static_tree,has_stree=desc.stat_desc.has_stree,extra=desc.stat_desc.extra_bits,base=desc.stat_desc.extra_base,max_length=desc.stat_desc.max_length,overflow=0;for(bits=0;bits<=MAX_BITS;bits++)s.bl_count[bits]=0;for(tree[2*s.heap[s.heap_max]+1]=0,h=s.heap_max+1;h<HEAP_SIZE;h++)(bits=tree[2*tree[2*(n=s.heap[h])+1]+1]+1)>max_length&&(bits=max_length,overflow++),tree[2*n+1]=bits,n>max_code||(s.bl_count[bits]++,xbits=0,n>=base&&(xbits=extra[n-base]),f=tree[2*n],s.opt_len+=f*(bits+xbits),has_stree&&(s.static_len+=f*(stree[2*n+1]+xbits)));if(0!==overflow){do{for(bits=max_length-1;0===s.bl_count[bits];)bits--;s.bl_count[bits]--,s.bl_count[bits+1]+=2,s.bl_count[max_length]--,overflow-=2}while(overflow>0);for(bits=max_length;0!==bits;bits--)for(n=s.bl_count[bits];0!==n;)(m=s.heap[--h])>max_code||(tree[2*m+1]!==bits&&(s.opt_len+=(bits-tree[2*m+1])*tree[2*m],tree[2*m+1]=bits),n--)}}(s,desc),gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n,curlen,prevlen=-1,nextlen=tree[1],count=0,max_count=7,min_count=4;for(0===nextlen&&(max_count=138,min_count=3),tree[2*(max_code+1)+1]=65535,n=0;n<=max_code;n++)curlen=nextlen,nextlen=tree[2*(n+1)+1],++count<max_count&&curlen===nextlen||(count<min_count?s.bl_tree[2*curlen]+=count:0!==curlen?(curlen!==prevlen&&s.bl_tree[2*curlen]++,s.bl_tree[2*REP_3_6]++):count<=10?s.bl_tree[2*REPZ_3_10]++:s.bl_tree[2*REPZ_11_138]++,count=0,prevlen=curlen,0===nextlen?(max_count=138,min_count=3):curlen===nextlen?(max_count=6,min_count=3):(max_count=7,min_count=4))}function send_tree(s,tree,max_code){var n,curlen,prevlen=-1,nextlen=tree[1],count=0,max_count=7,min_count=4;for(0===nextlen&&(max_count=138,min_count=3),n=0;n<=max_code;n++)if(curlen=nextlen,nextlen=tree[2*(n+1)+1],!(++count<max_count&&curlen===nextlen)){if(count<min_count)do{send_code(s,curlen,s.bl_tree)}while(0!=--count);else 0!==curlen?(curlen!==prevlen&&(send_code(s,curlen,s.bl_tree),count--),send_code(s,REP_3_6,s.bl_tree),send_bits(s,count-3,2)):count<=10?(send_code(s,REPZ_3_10,s.bl_tree),send_bits(s,count-3,3)):(send_code(s,REPZ_11_138,s.bl_tree),send_bits(s,count-11,7));count=0,prevlen=curlen,0===nextlen?(max_count=138,min_count=3):curlen===nextlen?(max_count=6,min_count=3):(max_count=7,min_count=4)}}var static_init_done=!1;function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3),function(s,buf,len,header){bi_windup(s),header&&(put_short(s,len),put_short(s,~len)),utils.arraySet(s.pending_buf,s.window,buf,len,s.pending),s.pending+=len}(s,buf,stored_len,!0)}exports._tr_init=function(s){static_init_done||(function(){var n,bits,length,code,dist,bl_count=new Array(MAX_BITS+1);for(length=0,code=0;code<LENGTH_CODES-1;code++)for(base_length[code]=length,n=0;n<1<<extra_lbits[code];n++)_length_code[length++]=code;for(_length_code[length-1]=code,dist=0,code=0;code<16;code++)for(base_dist[code]=dist,n=0;n<1<<extra_dbits[code];n++)_dist_code[dist++]=code;for(dist>>=7;code<D_CODES;code++)for(base_dist[code]=dist<<7,n=0;n<1<<extra_dbits[code]-7;n++)_dist_code[256+dist++]=code;for(bits=0;bits<=MAX_BITS;bits++)bl_count[bits]=0;for(n=0;n<=143;)static_ltree[2*n+1]=8,n++,bl_count[8]++;for(;n<=255;)static_ltree[2*n+1]=9,n++,bl_count[9]++;for(;n<=279;)static_ltree[2*n+1]=7,n++,bl_count[7]++;for(;n<=287;)static_ltree[2*n+1]=8,n++,bl_count[8]++;for(gen_codes(static_ltree,L_CODES+1,bl_count),n=0;n<D_CODES;n++)static_dtree[2*n+1]=5,static_dtree[2*n]=bi_reverse(n,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}(),static_init_done=!0),s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc),s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc),s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc),s.bi_buf=0,s.bi_valid=0,init_block(s)},exports._tr_stored_block=_tr_stored_block,exports._tr_flush_block=function(s,buf,stored_len,last){var opt_lenb,static_lenb,max_blindex=0;s.level>0?(s.strm.data_type===Z_UNKNOWN&&(s.strm.data_type=function(s){var n,black_mask=4093624447;for(n=0;n<=31;n++,black_mask>>>=1)if(1&black_mask&&0!==s.dyn_ltree[2*n])return Z_BINARY;if(0!==s.dyn_ltree[18]||0!==s.dyn_ltree[20]||0!==s.dyn_ltree[26])return Z_TEXT;for(n=32;n<LITERALS;n++)if(0!==s.dyn_ltree[2*n])return Z_TEXT;return Z_BINARY}(s)),build_tree(s,s.l_desc),build_tree(s,s.d_desc),max_blindex=function(s){var max_blindex;for(scan_tree(s,s.dyn_ltree,s.l_desc.max_code),scan_tree(s,s.dyn_dtree,s.d_desc.max_code),build_tree(s,s.bl_desc),max_blindex=BL_CODES-1;max_blindex>=3&&0===s.bl_tree[2*bl_order[max_blindex]+1];max_blindex--);return s.opt_len+=3*(max_blindex+1)+5+5+4,max_blindex}(s),opt_lenb=s.opt_len+3+7>>>3,(static_lenb=s.static_len+3+7>>>3)<=opt_lenb&&(opt_lenb=static_lenb)):opt_lenb=static_lenb=stored_len+5,stored_len+4<=opt_lenb&&-1!==buf?_tr_stored_block(s,buf,stored_len,last):s.strategy===Z_FIXED||static_lenb===opt_lenb?(send_bits(s,(STATIC_TREES<<1)+(last?1:0),3),compress_block(s,static_ltree,static_dtree)):(send_bits(s,(DYN_TREES<<1)+(last?1:0),3),function(s,lcodes,dcodes,blcodes){var rank;for(send_bits(s,lcodes-257,5),send_bits(s,dcodes-1,5),send_bits(s,blcodes-4,4),rank=0;rank<blcodes;rank++)send_bits(s,s.bl_tree[2*bl_order[rank]+1],3);send_tree(s,s.dyn_ltree,lcodes-1),send_tree(s,s.dyn_dtree,dcodes-1)}(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1),compress_block(s,s.dyn_ltree,s.dyn_dtree)),init_block(s),last&&bi_windup(s)},exports._tr_tally=function(s,dist,lc){return s.pending_buf[s.d_buf+2*s.last_lit]=dist>>>8&255,s.pending_buf[s.d_buf+2*s.last_lit+1]=255&dist,s.pending_buf[s.l_buf+s.last_lit]=255&lc,s.last_lit++,0===dist?s.dyn_ltree[2*lc]++:(s.matches++,dist--,s.dyn_ltree[2*(_length_code[lc]+LITERALS+1)]++,s.dyn_dtree[2*d_code(dist)]++),s.last_lit===s.lit_bufsize-1},exports._tr_align=function(s){send_bits(s,STATIC_TREES<<1,3),send_code(s,END_BLOCK,static_ltree),function(s){16===s.bi_valid?(put_short(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):s.bi_valid>=8&&(s.pending_buf[s.pending++]=255&s.bi_buf,s.bi_buf>>=8,s.bi_valid-=8)}(s)}},{"../utils/common":27}],39:[function(_dereq_,module,exports){"use strict";module.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[9])(9)});var cptable={version:"1.3.7"};cptable[874]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[932]=function(){var j,d=[],e={},D=[];for(D[0]="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~".split(""),j=0;j!=D[0].length;++j)65533!==D[0][j].charCodeAt(0)&&(e[D[0][j]]=0+j,d[0+j]=D[0][j]);for(D[129]="".split(""),j=0;j!=D[129].length;++j)65533!==D[129][j].charCodeAt(0)&&(e[D[129][j]]=33024+j,d[33024+j]=D[129][j]);for(D[130]="".split(""),j=0;j!=D[130].length;++j)65533!==D[130][j].charCodeAt(0)&&(e[D[130][j]]=33280+j,d[33280+j]=D[130][j]);for(D[131]="".split(""),j=0;j!=D[131].length;++j)65533!==D[131][j].charCodeAt(0)&&(e[D[131][j]]=33536+j,d[33536+j]=D[131][j]);for(D[132]="".split(""),j=0;j!=D[132].length;++j)65533!==D[132][j].charCodeAt(0)&&(e[D[132][j]]=33792+j,d[33792+j]=D[132][j]);for(D[135]="".split(""),j=0;j!=D[135].length;++j)65533!==D[135][j].charCodeAt(0)&&(e[D[135][j]]=34560+j,d[34560+j]=D[135][j]);for(D[136]="".split(""),j=0;j!=D[136].length;++j)65533!==D[136][j].charCodeAt(0)&&(e[D[136][j]]=34816+j,d[34816+j]=D[136][j]);for(D[137]="".split(""),j=0;j!=D[137].length;++j)65533!==D[137][j].charCodeAt(0)&&(e[D[137][j]]=35072+j,d[35072+j]=D[137][j]);for(D[138]="".split(""),j=0;j!=D[138].length;++j)65533!==D[138][j].charCodeAt(0)&&(e[D[138][j]]=35328+j,d[35328+j]=D[138][j]);for(D[139]="".split(""),j=0;j!=D[139].length;++j)65533!==D[139][j].charCodeAt(0)&&(e[D[139][j]]=35584+j,d[35584+j]=D[139][j]);for(D[140]="".split(""),j=0;j!=D[140].length;++j)65533!==D[140][j].charCodeAt(0)&&(e[D[140][j]]=35840+j,d[35840+j]=D[140][j]);for(D[141]="".split(""),j=0;j!=D[141].length;++j)65533!==D[141][j].charCodeAt(0)&&(e[D[141][j]]=36096+j,d[36096+j]=D[141][j]);for(D[142]="".split(""),j=0;j!=D[142].length;++j)65533!==D[142][j].charCodeAt(0)&&(e[D[142][j]]=36352+j,d[36352+j]=D[142][j]);for(D[143]="".split(""),j=0;j!=D[143].length;++j)65533!==D[143][j].charCodeAt(0)&&(e[D[143][j]]=36608+j,d[36608+j]=D[143][j]);for(D[144]="".split(""),j=0;j!=D[144].length;++j)65533!==D[144][j].charCodeAt(0)&&(e[D[144][j]]=36864+j,d[36864+j]=D[144][j]);for(D[145]="".split(""),j=0;j!=D[145].length;++j)65533!==D[145][j].charCodeAt(0)&&(e[D[145][j]]=37120+j,d[37120+j]=D[145][j]);for(D[146]="".split(""),j=0;j!=D[146].length;++j)65533!==D[146][j].charCodeAt(0)&&(e[D[146][j]]=37376+j,d[37376+j]=D[146][j]);for(D[147]="".split(""),j=0;j!=D[147].length;++j)65533!==D[147][j].charCodeAt(0)&&(e[D[147][j]]=37632+j,d[37632+j]=D[147][j]);for(D[148]="".split(""),j=0;j!=D[148].length;++j)65533!==D[148][j].charCodeAt(0)&&(e[D[148][j]]=37888+j,d[37888+j]=D[148][j]);for(D[149]="".split(""),j=0;j!=D[149].length;++j)65533!==D[149][j].charCodeAt(0)&&(e[D[149][j]]=38144+j,d[38144+j]=D[149][j]);for(D[150]="".split(""),j=0;j!=D[150].length;++j)65533!==D[150][j].charCodeAt(0)&&(e[D[150][j]]=38400+j,d[38400+j]=D[150][j]);for(D[151]="".split(""),j=0;j!=D[151].length;++j)65533!==D[151][j].charCodeAt(0)&&(e[D[151][j]]=38656+j,d[38656+j]=D[151][j]);for(D[152]="".split(""),j=0;j!=D[152].length;++j)65533!==D[152][j].charCodeAt(0)&&(e[D[152][j]]=38912+j,d[38912+j]=D[152][j]);for(D[153]="".split(""),j=0;j!=D[153].length;++j)65533!==D[153][j].charCodeAt(0)&&(e[D[153][j]]=39168+j,d[39168+j]=D[153][j]);for(D[154]="".split(""),j=0;j!=D[154].length;++j)65533!==D[154][j].charCodeAt(0)&&(e[D[154][j]]=39424+j,d[39424+j]=D[154][j]);for(D[155]="".split(""),j=0;j!=D[155].length;++j)65533!==D[155][j].charCodeAt(0)&&(e[D[155][j]]=39680+j,d[39680+j]=D[155][j]);for(D[156]="".split(""),j=0;j!=D[156].length;++j)65533!==D[156][j].charCodeAt(0)&&(e[D[156][j]]=39936+j,d[39936+j]=D[156][j]);for(D[157]="".split(""),j=0;j!=D[157].length;++j)65533!==D[157][j].charCodeAt(0)&&(e[D[157][j]]=40192+j,d[40192+j]=D[157][j]);for(D[158]="".split(""),j=0;j!=D[158].length;++j)65533!==D[158][j].charCodeAt(0)&&(e[D[158][j]]=40448+j,d[40448+j]=D[158][j]);for(D[159]="".split(""),j=0;j!=D[159].length;++j)65533!==D[159][j].charCodeAt(0)&&(e[D[159][j]]=40704+j,d[40704+j]=D[159][j]);for(D[224]="".split(""),j=0;j!=D[224].length;++j)65533!==D[224][j].charCodeAt(0)&&(e[D[224][j]]=57344+j,d[57344+j]=D[224][j]);for(D[225]="".split(""),j=0;j!=D[225].length;++j)65533!==D[225][j].charCodeAt(0)&&(e[D[225][j]]=57600+j,d[57600+j]=D[225][j]);for(D[226]="".split(""),j=0;j!=D[226].length;++j)65533!==D[226][j].charCodeAt(0)&&(e[D[226][j]]=57856+j,d[57856+j]=D[226][j]);for(D[227]="".split(""),j=0;j!=D[227].length;++j)65533!==D[227][j].charCodeAt(0)&&(e[D[227][j]]=58112+j,d[58112+j]=D[227][j]);for(D[228]="".split(""),j=0;j!=D[228].length;++j)65533!==D[228][j].charCodeAt(0)&&(e[D[228][j]]=58368+j,d[58368+j]=D[228][j]);for(D[229]="".split(""),j=0;j!=D[229].length;++j)65533!==D[229][j].charCodeAt(0)&&(e[D[229][j]]=58624+j,d[58624+j]=D[229][j]);for(D[230]="".split(""),j=0;j!=D[230].length;++j)65533!==D[230][j].charCodeAt(0)&&(e[D[230][j]]=58880+j,d[58880+j]=D[230][j]);for(D[231]="".split(""),j=0;j!=D[231].length;++j)65533!==D[231][j].charCodeAt(0)&&(e[D[231][j]]=59136+j,d[59136+j]=D[231][j]);for(D[232]="".split(""),j=0;j!=D[232].length;++j)65533!==D[232][j].charCodeAt(0)&&(e[D[232][j]]=59392+j,d[59392+j]=D[232][j]);for(D[233]="".split(""),j=0;j!=D[233].length;++j)65533!==D[233][j].charCodeAt(0)&&(e[D[233][j]]=59648+j,d[59648+j]=D[233][j]);for(D[234]="".split(""),j=0;j!=D[234].length;++j)65533!==D[234][j].charCodeAt(0)&&(e[D[234][j]]=59904+j,d[59904+j]=D[234][j]);for(D[237]="".split(""),j=0;j!=D[237].length;++j)65533!==D[237][j].charCodeAt(0)&&(e[D[237][j]]=60672+j,d[60672+j]=D[237][j]);for(D[238]="".split(""),j=0;j!=D[238].length;++j)65533!==D[238][j].charCodeAt(0)&&(e[D[238][j]]=60928+j,d[60928+j]=D[238][j]);for(D[250]="".split(""),j=0;j!=D[250].length;++j)65533!==D[250][j].charCodeAt(0)&&(e[D[250][j]]=64e3+j,d[64e3+j]=D[250][j]);for(D[251]="".split(""),j=0;j!=D[251].length;++j)65533!==D[251][j].charCodeAt(0)&&(e[D[251][j]]=64256+j,d[64256+j]=D[251][j]);for(D[252]="".split(""),j=0;j!=D[252].length;++j)65533!==D[252][j].charCodeAt(0)&&(e[D[252][j]]=64512+j,d[64512+j]=D[252][j]);return{enc:e,dec:d}}(),cptable[936]=function(){var j,d=[],e={},D=[];for(D[0]="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~".split(""),j=0;j!=D[0].length;++j)65533!==D[0][j].charCodeAt(0)&&(e[D[0][j]]=0+j,d[0+j]=D[0][j]);for(D[129]="".split(""),j=0;j!=D[129].length;++j)65533!==D[129][j].charCodeAt(0)&&(e[D[129][j]]=33024+j,d[33024+j]=D[129][j]);for(D[130]="".split(""),j=0;j!=D[130].length;++j)65533!==D[130][j].charCodeAt(0)&&(e[D[130][j]]=33280+j,d[33280+j]=D[130][j]);for(D[131]="".split(""),j=0;j!=D[131].length;++j)65533!==D[131][j].charCodeAt(0)&&(e[D[131][j]]=33536+j,d[33536+j]=D[131][j]);for(D[132]="".split(""),j=0;j!=D[132].length;++j)65533!==D[132][j].charCodeAt(0)&&(e[D[132][j]]=33792+j,d[33792+j]=D[132][j]);for(D[133]="".split(""),j=0;j!=D[133].length;++j)65533!==D[133][j].charCodeAt(0)&&(e[D[133][j]]=34048+j,d[34048+j]=D[133][j]);for(D[134]="".split(""),j=0;j!=D[134].length;++j)65533!==D[134][j].charCodeAt(0)&&(e[D[134][j]]=34304+j,d[34304+j]=D[134][j]);for(D[135]="".split(""),j=0;j!=D[135].length;++j)65533!==D[135][j].charCodeAt(0)&&(e[D[135][j]]=34560+j,d[34560+j]=D[135][j]);for(D[136]="".split(""),j=0;j!=D[136].length;++j)65533!==D[136][j].charCodeAt(0)&&(e[D[136][j]]=34816+j,d[34816+j]=D[136][j]);for(D[137]="".split(""),j=0;j!=D[137].length;++j)65533!==D[137][j].charCodeAt(0)&&(e[D[137][j]]=35072+j,d[35072+j]=D[137][j]);for(D[138]="".split(""),j=0;j!=D[138].length;++j)65533!==D[138][j].charCodeAt(0)&&(e[D[138][j]]=35328+j,d[35328+j]=D[138][j]);for(D[139]="".split(""),j=0;j!=D[139].length;++j)65533!==D[139][j].charCodeAt(0)&&(e[D[139][j]]=35584+j,d[35584+j]=D[139][j]);for(D[140]="".split(""),j=0;j!=D[140].length;++j)65533!==D[140][j].charCodeAt(0)&&(e[D[140][j]]=35840+j,d[35840+j]=D[140][j]);for(D[141]="".split(""),j=0;j!=D[141].length;++j)65533!==D[141][j].charCodeAt(0)&&(e[D[141][j]]=36096+j,d[36096+j]=D[141][j]);for(D[142]="".split(""),j=0;j!=D[142].length;++j)65533!==D[142][j].charCodeAt(0)&&(e[D[142][j]]=36352+j,d[36352+j]=D[142][j]);for(D[143]="".split(""),j=0;j!=D[143].length;++j)65533!==D[143][j].charCodeAt(0)&&(e[D[143][j]]=36608+j,d[36608+j]=D[143][j]);for(D[144]="".split(""),j=0;j!=D[144].length;++j)65533!==D[144][j].charCodeAt(0)&&(e[D[144][j]]=36864+j,d[36864+j]=D[144][j]);for(D[145]="".split(""),j=0;j!=D[145].length;++j)65533!==D[145][j].charCodeAt(0)&&(e[D[145][j]]=37120+j,d[37120+j]=D[145][j]);for(D[146]="".split(""),j=0;j!=D[146].length;++j)65533!==D[146][j].charCodeAt(0)&&(e[D[146][j]]=37376+j,d[37376+j]=D[146][j]);for(D[147]="".split(""),j=0;j!=D[147].length;++j)65533!==D[147][j].charCodeAt(0)&&(e[D[147][j]]=37632+j,d[37632+j]=D[147][j]);for(D[148]="".split(""),j=0;j!=D[148].length;++j)65533!==D[148][j].charCodeAt(0)&&(e[D[148][j]]=37888+j,d[37888+j]=D[148][j]);for(D[149]="".split(""),j=0;j!=D[149].length;++j)65533!==D[149][j].charCodeAt(0)&&(e[D[149][j]]=38144+j,d[38144+j]=D[149][j]);for(D[150]="".split(""),j=0;j!=D[150].length;++j)65533!==D[150][j].charCodeAt(0)&&(e[D[150][j]]=38400+j,d[38400+j]=D[150][j]);for(D[151]="".split(""),j=0;j!=D[151].length;++j)65533!==D[151][j].charCodeAt(0)&&(e[D[151][j]]=38656+j,d[38656+j]=D[151][j]);for(D[152]="".split(""),j=0;j!=D[152].length;++j)65533!==D[152][j].charCodeAt(0)&&(e[D[152][j]]=38912+j,d[38912+j]=D[152][j]);for(D[153]="".split(""),j=0;j!=D[153].length;++j)65533!==D[153][j].charCodeAt(0)&&(e[D[153][j]]=39168+j,d[39168+j]=D[153][j]);for(D[154]="".split(""),j=0;j!=D[154].length;++j)65533!==D[154][j].charCodeAt(0)&&(e[D[154][j]]=39424+j,d[39424+j]=D[154][j]);for(D[155]="".split(""),j=0;j!=D[155].length;++j)65533!==D[155][j].charCodeAt(0)&&(e[D[155][j]]=39680+j,d[39680+j]=D[155][j]);for(D[156]="".split(""),j=0;j!=D[156].length;++j)65533!==D[156][j].charCodeAt(0)&&(e[D[156][j]]=39936+j,d[39936+j]=D[156][j]);for(D[157]="".split(""),j=0;j!=D[157].length;++j)65533!==D[157][j].charCodeAt(0)&&(e[D[157][j]]=40192+j,d[40192+j]=D[157][j]);for(D[158]="".split(""),j=0;j!=D[158].length;++j)65533!==D[158][j].charCodeAt(0)&&(e[D[158][j]]=40448+j,d[40448+j]=D[158][j]);for(D[159]="".split(""),j=0;j!=D[159].length;++j)65533!==D[159][j].charCodeAt(0)&&(e[D[159][j]]=40704+j,d[40704+j]=D[159][j]);for(D[160]="".split(""),j=0;j!=D[160].length;++j)65533!==D[160][j].charCodeAt(0)&&(e[D[160][j]]=40960+j,d[40960+j]=D[160][j]);for(D[161]="".split(""),j=0;j!=D[161].length;++j)65533!==D[161][j].charCodeAt(0)&&(e[D[161][j]]=41216+j,d[41216+j]=D[161][j]);for(D[162]="".split(""),j=0;j!=D[162].length;++j)65533!==D[162][j].charCodeAt(0)&&(e[D[162][j]]=41472+j,d[41472+j]=D[162][j]);for(D[163]="".split(""),j=0;j!=D[163].length;++j)65533!==D[163][j].charCodeAt(0)&&(e[D[163][j]]=41728+j,d[41728+j]=D[163][j]);for(D[164]="".split(""),j=0;j!=D[164].length;++j)65533!==D[164][j].charCodeAt(0)&&(e[D[164][j]]=41984+j,d[41984+j]=D[164][j]);for(D[165]="".split(""),j=0;j!=D[165].length;++j)65533!==D[165][j].charCodeAt(0)&&(e[D[165][j]]=42240+j,d[42240+j]=D[165][j]);for(D[166]="".split(""),j=0;j!=D[166].length;++j)65533!==D[166][j].charCodeAt(0)&&(e[D[166][j]]=42496+j,d[42496+j]=D[166][j]);for(D[167]="".split(""),j=0;j!=D[167].length;++j)65533!==D[167][j].charCodeAt(0)&&(e[D[167][j]]=42752+j,d[42752+j]=D[167][j]);for(D[168]="".split(""),j=0;j!=D[168].length;++j)65533!==D[168][j].charCodeAt(0)&&(e[D[168][j]]=43008+j,d[43008+j]=D[168][j]);for(D[169]="".split(""),j=0;j!=D[169].length;++j)65533!==D[169][j].charCodeAt(0)&&(e[D[169][j]]=43264+j,d[43264+j]=D[169][j]);for(D[170]="".split(""),j=0;j!=D[170].length;++j)65533!==D[170][j].charCodeAt(0)&&(e[D[170][j]]=43520+j,d[43520+j]=D[170][j]);for(D[171]="".split(""),j=0;j!=D[171].length;++j)65533!==D[171][j].charCodeAt(0)&&(e[D[171][j]]=43776+j,d[43776+j]=D[171][j]);for(D[172]="".split(""),j=0;j!=D[172].length;++j)65533!==D[172][j].charCodeAt(0)&&(e[D[172][j]]=44032+j,d[44032+j]=D[172][j]);for(D[173]="".split(""),j=0;j!=D[173].length;++j)65533!==D[173][j].charCodeAt(0)&&(e[D[173][j]]=44288+j,d[44288+j]=D[173][j]);for(D[174]="".split(""),j=0;j!=D[174].length;++j)65533!==D[174][j].charCodeAt(0)&&(e[D[174][j]]=44544+j,d[44544+j]=D[174][j]);for(D[175]="".split(""),j=0;j!=D[175].length;++j)65533!==D[175][j].charCodeAt(0)&&(e[D[175][j]]=44800+j,d[44800+j]=D[175][j]);for(D[176]="".split(""),j=0;j!=D[176].length;++j)65533!==D[176][j].charCodeAt(0)&&(e[D[176][j]]=45056+j,d[45056+j]=D[176][j]);for(D[177]="".split(""),j=0;j!=D[177].length;++j)65533!==D[177][j].charCodeAt(0)&&(e[D[177][j]]=45312+j,d[45312+j]=D[177][j]);for(D[178]="".split(""),j=0;j!=D[178].length;++j)65533!==D[178][j].charCodeAt(0)&&(e[D[178][j]]=45568+j,d[45568+j]=D[178][j]);for(D[179]="".split(""),j=0;j!=D[179].length;++j)65533!==D[179][j].charCodeAt(0)&&(e[D[179][j]]=45824+j,d[45824+j]=D[179][j]);for(D[180]="".split(""),j=0;j!=D[180].length;++j)65533!==D[180][j].charCodeAt(0)&&(e[D[180][j]]=46080+j,d[46080+j]=D[180][j]);for(D[181]="".split(""),j=0;j!=D[181].length;++j)65533!==D[181][j].charCodeAt(0)&&(e[D[181][j]]=46336+j,d[46336+j]=D[181][j]);for(D[182]="".split(""),j=0;j!=D[182].length;++j)65533!==D[182][j].charCodeAt(0)&&(e[D[182][j]]=46592+j,d[46592+j]=D[182][j]);for(D[183]="".split(""),j=0;j!=D[183].length;++j)65533!==D[183][j].charCodeAt(0)&&(e[D[183][j]]=46848+j,d[46848+j]=D[183][j]);for(D[184]="".split(""),j=0;j!=D[184].length;++j)65533!==D[184][j].charCodeAt(0)&&(e[D[184][j]]=47104+j,d[47104+j]=D[184][j]);for(D[185]="".split(""),j=0;j!=D[185].length;++j)65533!==D[185][j].charCodeAt(0)&&(e[D[185][j]]=47360+j,d[47360+j]=D[185][j]);for(D[186]="".split(""),j=0;j!=D[186].length;++j)65533!==D[186][j].charCodeAt(0)&&(e[D[186][j]]=47616+j,d[47616+j]=D[186][j]);for(D[187]="".split(""),j=0;j!=D[187].length;++j)65533!==D[187][j].charCodeAt(0)&&(e[D[187][j]]=47872+j,d[47872+j]=D[187][j]);for(D[188]="".split(""),j=0;j!=D[188].length;++j)65533!==D[188][j].charCodeAt(0)&&(e[D[188][j]]=48128+j,d[48128+j]=D[188][j]);for(D[189]="".split(""),j=0;j!=D[189].length;++j)65533!==D[189][j].charCodeAt(0)&&(e[D[189][j]]=48384+j,d[48384+j]=D[189][j]);for(D[190]="".split(""),j=0;j!=D[190].length;++j)65533!==D[190][j].charCodeAt(0)&&(e[D[190][j]]=48640+j,d[48640+j]=D[190][j]);for(D[191]="".split(""),j=0;j!=D[191].length;++j)65533!==D[191][j].charCodeAt(0)&&(e[D[191][j]]=48896+j,d[48896+j]=D[191][j]);for(D[192]="".split(""),j=0;j!=D[192].length;++j)65533!==D[192][j].charCodeAt(0)&&(e[D[192][j]]=49152+j,d[49152+j]=D[192][j]);for(D[193]="".split(""),j=0;j!=D[193].length;++j)65533!==D[193][j].charCodeAt(0)&&(e[D[193][j]]=49408+j,d[49408+j]=D[193][j]);for(D[194]="".split(""),j=0;j!=D[194].length;++j)65533!==D[194][j].charCodeAt(0)&&(e[D[194][j]]=49664+j,d[49664+j]=D[194][j]);for(D[195]="".split(""),j=0;j!=D[195].length;++j)65533!==D[195][j].charCodeAt(0)&&(e[D[195][j]]=49920+j,d[49920+j]=D[195][j]);for(D[196]="".split(""),j=0;j!=D[196].length;++j)65533!==D[196][j].charCodeAt(0)&&(e[D[196][j]]=50176+j,d[50176+j]=D[196][j]);for(D[197]="".split(""),j=0;j!=D[197].length;++j)65533!==D[197][j].charCodeAt(0)&&(e[D[197][j]]=50432+j,d[50432+j]=D[197][j]);for(D[198]="".split(""),j=0;j!=D[198].length;++j)65533!==D[198][j].charCodeAt(0)&&(e[D[198][j]]=50688+j,d[50688+j]=D[198][j]);for(D[199]="".split(""),j=0;j!=D[199].length;++j)65533!==D[199][j].charCodeAt(0)&&(e[D[199][j]]=50944+j,d[50944+j]=D[199][j]);for(D[200]="".split(""),j=0;j!=D[200].length;++j)65533!==D[200][j].charCodeAt(0)&&(e[D[200][j]]=51200+j,d[51200+j]=D[200][j]);for(D[201]="".split(""),j=0;j!=D[201].length;++j)65533!==D[201][j].charCodeAt(0)&&(e[D[201][j]]=51456+j,d[51456+j]=D[201][j]);for(D[202]="".split(""),j=0;j!=D[202].length;++j)65533!==D[202][j].charCodeAt(0)&&(e[D[202][j]]=51712+j,d[51712+j]=D[202][j]);for(D[203]="".split(""),j=0;j!=D[203].length;++j)65533!==D[203][j].charCodeAt(0)&&(e[D[203][j]]=51968+j,d[51968+j]=D[203][j]);for(D[204]="".split(""),j=0;j!=D[204].length;++j)65533!==D[204][j].charCodeAt(0)&&(e[D[204][j]]=52224+j,d[52224+j]=D[204][j]);for(D[205]="".split(""),j=0;j!=D[205].length;++j)65533!==D[205][j].charCodeAt(0)&&(e[D[205][j]]=52480+j,d[52480+j]=D[205][j]);for(D[206]="".split(""),j=0;j!=D[206].length;++j)65533!==D[206][j].charCodeAt(0)&&(e[D[206][j]]=52736+j,d[52736+j]=D[206][j]);for(D[207]="".split(""),j=0;j!=D[207].length;++j)65533!==D[207][j].charCodeAt(0)&&(e[D[207][j]]=52992+j,d[52992+j]=D[207][j]);for(D[208]="".split(""),j=0;j!=D[208].length;++j)65533!==D[208][j].charCodeAt(0)&&(e[D[208][j]]=53248+j,d[53248+j]=D[208][j]);for(D[209]="".split(""),j=0;j!=D[209].length;++j)65533!==D[209][j].charCodeAt(0)&&(e[D[209][j]]=53504+j,d[53504+j]=D[209][j]);for(D[210]="".split(""),j=0;j!=D[210].length;++j)65533!==D[210][j].charCodeAt(0)&&(e[D[210][j]]=53760+j,d[53760+j]=D[210][j]);for(D[211]="".split(""),j=0;j!=D[211].length;++j)65533!==D[211][j].charCodeAt(0)&&(e[D[211][j]]=54016+j,d[54016+j]=D[211][j]);for(D[212]="".split(""),j=0;j!=D[212].length;++j)65533!==D[212][j].charCodeAt(0)&&(e[D[212][j]]=54272+j,d[54272+j]=D[212][j]);for(D[213]="".split(""),j=0;j!=D[213].length;++j)65533!==D[213][j].charCodeAt(0)&&(e[D[213][j]]=54528+j,d[54528+j]=D[213][j]);for(D[214]="".split(""),j=0;j!=D[214].length;++j)65533!==D[214][j].charCodeAt(0)&&(e[D[214][j]]=54784+j,d[54784+j]=D[214][j]);for(D[215]="".split(""),j=0;j!=D[215].length;++j)65533!==D[215][j].charCodeAt(0)&&(e[D[215][j]]=55040+j,d[55040+j]=D[215][j]);for(D[216]="".split(""),j=0;j!=D[216].length;++j)65533!==D[216][j].charCodeAt(0)&&(e[D[216][j]]=55296+j,d[55296+j]=D[216][j]);for(D[217]="".split(""),j=0;j!=D[217].length;++j)65533!==D[217][j].charCodeAt(0)&&(e[D[217][j]]=55552+j,d[55552+j]=D[217][j]);for(D[218]="".split(""),j=0;j!=D[218].length;++j)65533!==D[218][j].charCodeAt(0)&&(e[D[218][j]]=55808+j,d[55808+j]=D[218][j]);for(D[219]="".split(""),j=0;j!=D[219].length;++j)65533!==D[219][j].charCodeAt(0)&&(e[D[219][j]]=56064+j,d[56064+j]=D[219][j]);for(D[220]="".split(""),j=0;j!=D[220].length;++j)65533!==D[220][j].charCodeAt(0)&&(e[D[220][j]]=56320+j,d[56320+j]=D[220][j]);for(D[221]="".split(""),j=0;j!=D[221].length;++j)65533!==D[221][j].charCodeAt(0)&&(e[D[221][j]]=56576+j,d[56576+j]=D[221][j]);for(D[222]="".split(""),j=0;j!=D[222].length;++j)65533!==D[222][j].charCodeAt(0)&&(e[D[222][j]]=56832+j,d[56832+j]=D[222][j]);for(D[223]="".split(""),j=0;j!=D[223].length;++j)65533!==D[223][j].charCodeAt(0)&&(e[D[223][j]]=57088+j,d[57088+j]=D[223][j]);for(D[224]="".split(""),j=0;j!=D[224].length;++j)65533!==D[224][j].charCodeAt(0)&&(e[D[224][j]]=57344+j,d[57344+j]=D[224][j]);for(D[225]="".split(""),j=0;j!=D[225].length;++j)65533!==D[225][j].charCodeAt(0)&&(e[D[225][j]]=57600+j,d[57600+j]=D[225][j]);for(D[226]="".split(""),j=0;j!=D[226].length;++j)65533!==D[226][j].charCodeAt(0)&&(e[D[226][j]]=57856+j,d[57856+j]=D[226][j]);for(D[227]="".split(""),j=0;j!=D[227].length;++j)65533!==D[227][j].charCodeAt(0)&&(e[D[227][j]]=58112+j,d[58112+j]=D[227][j]);for(D[228]="".split(""),j=0;j!=D[228].length;++j)65533!==D[228][j].charCodeAt(0)&&(e[D[228][j]]=58368+j,d[58368+j]=D[228][j]);for(D[229]="".split(""),j=0;j!=D[229].length;++j)65533!==D[229][j].charCodeAt(0)&&(e[D[229][j]]=58624+j,d[58624+j]=D[229][j]);for(D[230]="".split(""),j=0;j!=D[230].length;++j)65533!==D[230][j].charCodeAt(0)&&(e[D[230][j]]=58880+j,d[58880+j]=D[230][j]);for(D[231]="".split(""),j=0;j!=D[231].length;++j)65533!==D[231][j].charCodeAt(0)&&(e[D[231][j]]=59136+j,d[59136+j]=D[231][j]);for(D[232]="".split(""),j=0;j!=D[232].length;++j)65533!==D[232][j].charCodeAt(0)&&(e[D[232][j]]=59392+j,d[59392+j]=D[232][j]);for(D[233]="".split(""),j=0;j!=D[233].length;++j)65533!==D[233][j].charCodeAt(0)&&(e[D[233][j]]=59648+j,d[59648+j]=D[233][j]);for(D[234]="".split(""),j=0;j!=D[234].length;++j)65533!==D[234][j].charCodeAt(0)&&(e[D[234][j]]=59904+j,d[59904+j]=D[234][j]);for(D[235]="".split(""),j=0;j!=D[235].length;++j)65533!==D[235][j].charCodeAt(0)&&(e[D[235][j]]=60160+j,d[60160+j]=D[235][j]);for(D[236]="".split(""),j=0;j!=D[236].length;++j)65533!==D[236][j].charCodeAt(0)&&(e[D[236][j]]=60416+j,d[60416+j]=D[236][j]);for(D[237]="".split(""),j=0;j!=D[237].length;++j)65533!==D[237][j].charCodeAt(0)&&(e[D[237][j]]=60672+j,d[60672+j]=D[237][j]);for(D[238]="".split(""),j=0;j!=D[238].length;++j)65533!==D[238][j].charCodeAt(0)&&(e[D[238][j]]=60928+j,d[60928+j]=D[238][j]);for(D[239]="".split(""),j=0;j!=D[239].length;++j)65533!==D[239][j].charCodeAt(0)&&(e[D[239][j]]=61184+j,d[61184+j]=D[239][j]);for(D[240]="".split(""),j=0;j!=D[240].length;++j)65533!==D[240][j].charCodeAt(0)&&(e[D[240][j]]=61440+j,d[61440+j]=D[240][j]);for(D[241]="".split(""),j=0;j!=D[241].length;++j)65533!==D[241][j].charCodeAt(0)&&(e[D[241][j]]=61696+j,d[61696+j]=D[241][j]);for(D[242]="".split(""),j=0;j!=D[242].length;++j)65533!==D[242][j].charCodeAt(0)&&(e[D[242][j]]=61952+j,d[61952+j]=D[242][j]);for(D[243]="".split(""),j=0;j!=D[243].length;++j)65533!==D[243][j].charCodeAt(0)&&(e[D[243][j]]=62208+j,d[62208+j]=D[243][j]);for(D[244]="".split(""),j=0;j!=D[244].length;++j)65533!==D[244][j].charCodeAt(0)&&(e[D[244][j]]=62464+j,d[62464+j]=D[244][j]);for(D[245]="".split(""),j=0;j!=D[245].length;++j)65533!==D[245][j].charCodeAt(0)&&(e[D[245][j]]=62720+j,d[62720+j]=D[245][j]);for(D[246]="".split(""),j=0;j!=D[246].length;++j)65533!==D[246][j].charCodeAt(0)&&(e[D[246][j]]=62976+j,d[62976+j]=D[246][j]);for(D[247]="".split(""),j=0;j!=D[247].length;++j)65533!==D[247][j].charCodeAt(0)&&(e[D[247][j]]=63232+j,d[63232+j]=D[247][j]);for(D[248]="".split(""),j=0;j!=D[248].length;++j)65533!==D[248][j].charCodeAt(0)&&(e[D[248][j]]=63488+j,d[63488+j]=D[248][j]);for(D[249]="".split(""),j=0;j!=D[249].length;++j)65533!==D[249][j].charCodeAt(0)&&(e[D[249][j]]=63744+j,d[63744+j]=D[249][j]);for(D[250]="".split(""),j=0;j!=D[250].length;++j)65533!==D[250][j].charCodeAt(0)&&(e[D[250][j]]=64e3+j,d[64e3+j]=D[250][j]);for(D[251]="".split(""),j=0;j!=D[251].length;++j)65533!==D[251][j].charCodeAt(0)&&(e[D[251][j]]=64256+j,d[64256+j]=D[251][j]);for(D[252]="".split(""),j=0;j!=D[252].length;++j)65533!==D[252][j].charCodeAt(0)&&(e[D[252][j]]=64512+j,d[64512+j]=D[252][j]);for(D[253]="".split(""),j=0;j!=D[253].length;++j)65533!==D[253][j].charCodeAt(0)&&(e[D[253][j]]=64768+j,d[64768+j]=D[253][j]);for(D[254]="".split(""),j=0;j!=D[254].length;++j)65533!==D[254][j].charCodeAt(0)&&(e[D[254][j]]=65024+j,d[65024+j]=D[254][j]);return{enc:e,dec:d}}(),cptable[949]=function(){var j,d=[],e={},D=[];for(D[0]="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~".split(""),j=0;j!=D[0].length;++j)65533!==D[0][j].charCodeAt(0)&&(e[D[0][j]]=0+j,d[0+j]=D[0][j]);for(D[129]="".split(""),j=0;j!=D[129].length;++j)65533!==D[129][j].charCodeAt(0)&&(e[D[129][j]]=33024+j,d[33024+j]=D[129][j]);for(D[130]="".split(""),j=0;j!=D[130].length;++j)65533!==D[130][j].charCodeAt(0)&&(e[D[130][j]]=33280+j,d[33280+j]=D[130][j]);for(D[131]="".split(""),j=0;j!=D[131].length;++j)65533!==D[131][j].charCodeAt(0)&&(e[D[131][j]]=33536+j,d[33536+j]=D[131][j]);for(D[132]="".split(""),j=0;j!=D[132].length;++j)65533!==D[132][j].charCodeAt(0)&&(e[D[132][j]]=33792+j,d[33792+j]=D[132][j]);for(D[133]="".split(""),j=0;j!=D[133].length;++j)65533!==D[133][j].charCodeAt(0)&&(e[D[133][j]]=34048+j,d[34048+j]=D[133][j]);for(D[134]="".split(""),j=0;j!=D[134].length;++j)65533!==D[134][j].charCodeAt(0)&&(e[D[134][j]]=34304+j,d[34304+j]=D[134][j]);for(D[135]="".split(""),j=0;j!=D[135].length;++j)65533!==D[135][j].charCodeAt(0)&&(e[D[135][j]]=34560+j,d[34560+j]=D[135][j]);for(D[136]="".split(""),j=0;j!=D[136].length;++j)65533!==D[136][j].charCodeAt(0)&&(e[D[136][j]]=34816+j,d[34816+j]=D[136][j]);for(D[137]="".split(""),j=0;j!=D[137].length;++j)65533!==D[137][j].charCodeAt(0)&&(e[D[137][j]]=35072+j,d[35072+j]=D[137][j]);for(D[138]="".split(""),j=0;j!=D[138].length;++j)65533!==D[138][j].charCodeAt(0)&&(e[D[138][j]]=35328+j,d[35328+j]=D[138][j]);for(D[139]="".split(""),j=0;j!=D[139].length;++j)65533!==D[139][j].charCodeAt(0)&&(e[D[139][j]]=35584+j,d[35584+j]=D[139][j]);for(D[140]="".split(""),j=0;j!=D[140].length;++j)65533!==D[140][j].charCodeAt(0)&&(e[D[140][j]]=35840+j,d[35840+j]=D[140][j]);for(D[141]="".split(""),j=0;j!=D[141].length;++j)65533!==D[141][j].charCodeAt(0)&&(e[D[141][j]]=36096+j,d[36096+j]=D[141][j]);for(D[142]="".split(""),j=0;j!=D[142].length;++j)65533!==D[142][j].charCodeAt(0)&&(e[D[142][j]]=36352+j,d[36352+j]=D[142][j]);for(D[143]="".split(""),j=0;j!=D[143].length;++j)65533!==D[143][j].charCodeAt(0)&&(e[D[143][j]]=36608+j,d[36608+j]=D[143][j]);for(D[144]="".split(""),j=0;j!=D[144].length;++j)65533!==D[144][j].charCodeAt(0)&&(e[D[144][j]]=36864+j,d[36864+j]=D[144][j]);for(D[145]="".split(""),j=0;j!=D[145].length;++j)65533!==D[145][j].charCodeAt(0)&&(e[D[145][j]]=37120+j,d[37120+j]=D[145][j]);for(D[146]="".split(""),j=0;j!=D[146].length;++j)65533!==D[146][j].charCodeAt(0)&&(e[D[146][j]]=37376+j,d[37376+j]=D[146][j]);for(D[147]="".split(""),j=0;j!=D[147].length;++j)65533!==D[147][j].charCodeAt(0)&&(e[D[147][j]]=37632+j,d[37632+j]=D[147][j]);for(D[148]="".split(""),j=0;j!=D[148].length;++j)65533!==D[148][j].charCodeAt(0)&&(e[D[148][j]]=37888+j,d[37888+j]=D[148][j]);for(D[149]="".split(""),j=0;j!=D[149].length;++j)65533!==D[149][j].charCodeAt(0)&&(e[D[149][j]]=38144+j,d[38144+j]=D[149][j]);for(D[150]="".split(""),j=0;j!=D[150].length;++j)65533!==D[150][j].charCodeAt(0)&&(e[D[150][j]]=38400+j,d[38400+j]=D[150][j]);for(D[151]="".split(""),j=0;j!=D[151].length;++j)65533!==D[151][j].charCodeAt(0)&&(e[D[151][j]]=38656+j,d[38656+j]=D[151][j]);for(D[152]="".split(""),j=0;j!=D[152].length;++j)65533!==D[152][j].charCodeAt(0)&&(e[D[152][j]]=38912+j,d[38912+j]=D[152][j]);for(D[153]="".split(""),j=0;j!=D[153].length;++j)65533!==D[153][j].charCodeAt(0)&&(e[D[153][j]]=39168+j,d[39168+j]=D[153][j]);for(D[154]="".split(""),j=0;j!=D[154].length;++j)65533!==D[154][j].charCodeAt(0)&&(e[D[154][j]]=39424+j,d[39424+j]=D[154][j]);for(D[155]="".split(""),j=0;j!=D[155].length;++j)65533!==D[155][j].charCodeAt(0)&&(e[D[155][j]]=39680+j,d[39680+j]=D[155][j]);for(D[156]="".split(""),j=0;j!=D[156].length;++j)65533!==D[156][j].charCodeAt(0)&&(e[D[156][j]]=39936+j,d[39936+j]=D[156][j]);for(D[157]="".split(""),j=0;j!=D[157].length;++j)65533!==D[157][j].charCodeAt(0)&&(e[D[157][j]]=40192+j,d[40192+j]=D[157][j]);for(D[158]="".split(""),j=0;j!=D[158].length;++j)65533!==D[158][j].charCodeAt(0)&&(e[D[158][j]]=40448+j,d[40448+j]=D[158][j]);for(D[159]="".split(""),j=0;j!=D[159].length;++j)65533!==D[159][j].charCodeAt(0)&&(e[D[159][j]]=40704+j,d[40704+j]=D[159][j]);for(D[160]="".split(""),j=0;j!=D[160].length;++j)65533!==D[160][j].charCodeAt(0)&&(e[D[160][j]]=40960+j,d[40960+j]=D[160][j]);for(D[161]="".split(""),j=0;j!=D[161].length;++j)65533!==D[161][j].charCodeAt(0)&&(e[D[161][j]]=41216+j,d[41216+j]=D[161][j]);for(D[162]="".split(""),j=0;j!=D[162].length;++j)65533!==D[162][j].charCodeAt(0)&&(e[D[162][j]]=41472+j,d[41472+j]=D[162][j]);for(D[163]="".split(""),j=0;j!=D[163].length;++j)65533!==D[163][j].charCodeAt(0)&&(e[D[163][j]]=41728+j,d[41728+j]=D[163][j]);for(D[164]="".split(""),j=0;j!=D[164].length;++j)65533!==D[164][j].charCodeAt(0)&&(e[D[164][j]]=41984+j,d[41984+j]=D[164][j]);for(D[165]="".split(""),j=0;j!=D[165].length;++j)65533!==D[165][j].charCodeAt(0)&&(e[D[165][j]]=42240+j,d[42240+j]=D[165][j]);for(D[166]="".split(""),j=0;j!=D[166].length;++j)65533!==D[166][j].charCodeAt(0)&&(e[D[166][j]]=42496+j,d[42496+j]=D[166][j]);for(D[167]="".split(""),j=0;j!=D[167].length;++j)65533!==D[167][j].charCodeAt(0)&&(e[D[167][j]]=42752+j,d[42752+j]=D[167][j]);for(D[168]="".split(""),j=0;j!=D[168].length;++j)65533!==D[168][j].charCodeAt(0)&&(e[D[168][j]]=43008+j,d[43008+j]=D[168][j]);for(D[169]="".split(""),j=0;j!=D[169].length;++j)65533!==D[169][j].charCodeAt(0)&&(e[D[169][j]]=43264+j,d[43264+j]=D[169][j]);for(D[170]="".split(""),j=0;j!=D[170].length;++j)65533!==D[170][j].charCodeAt(0)&&(e[D[170][j]]=43520+j,d[43520+j]=D[170][j]);for(D[171]="".split(""),j=0;j!=D[171].length;++j)65533!==D[171][j].charCodeAt(0)&&(e[D[171][j]]=43776+j,d[43776+j]=D[171][j]);for(D[172]="".split(""),j=0;j!=D[172].length;++j)65533!==D[172][j].charCodeAt(0)&&(e[D[172][j]]=44032+j,d[44032+j]=D[172][j]);for(D[173]="".split(""),j=0;j!=D[173].length;++j)65533!==D[173][j].charCodeAt(0)&&(e[D[173][j]]=44288+j,d[44288+j]=D[173][j]);for(D[174]="".split(""),j=0;j!=D[174].length;++j)65533!==D[174][j].charCodeAt(0)&&(e[D[174][j]]=44544+j,d[44544+j]=D[174][j]);for(D[175]="".split(""),j=0;j!=D[175].length;++j)65533!==D[175][j].charCodeAt(0)&&(e[D[175][j]]=44800+j,d[44800+j]=D[175][j]);for(D[176]="".split(""),j=0;j!=D[176].length;++j)65533!==D[176][j].charCodeAt(0)&&(e[D[176][j]]=45056+j,d[45056+j]=D[176][j]);for(D[177]="".split(""),j=0;j!=D[177].length;++j)65533!==D[177][j].charCodeAt(0)&&(e[D[177][j]]=45312+j,d[45312+j]=D[177][j]);for(D[178]="".split(""),j=0;j!=D[178].length;++j)65533!==D[178][j].charCodeAt(0)&&(e[D[178][j]]=45568+j,d[45568+j]=D[178][j]);for(D[179]="".split(""),j=0;j!=D[179].length;++j)65533!==D[179][j].charCodeAt(0)&&(e[D[179][j]]=45824+j,d[45824+j]=D[179][j]);for(D[180]="".split(""),j=0;j!=D[180].length;++j)65533!==D[180][j].charCodeAt(0)&&(e[D[180][j]]=46080+j,d[46080+j]=D[180][j]);for(D[181]="".split(""),j=0;j!=D[181].length;++j)65533!==D[181][j].charCodeAt(0)&&(e[D[181][j]]=46336+j,d[46336+j]=D[181][j]);for(D[182]="".split(""),j=0;j!=D[182].length;++j)65533!==D[182][j].charCodeAt(0)&&(e[D[182][j]]=46592+j,d[46592+j]=D[182][j]);for(D[183]="".split(""),j=0;j!=D[183].length;++j)65533!==D[183][j].charCodeAt(0)&&(e[D[183][j]]=46848+j,d[46848+j]=D[183][j]);for(D[184]="".split(""),j=0;j!=D[184].length;++j)65533!==D[184][j].charCodeAt(0)&&(e[D[184][j]]=47104+j,d[47104+j]=D[184][j]);for(D[185]="".split(""),j=0;j!=D[185].length;++j)65533!==D[185][j].charCodeAt(0)&&(e[D[185][j]]=47360+j,d[47360+j]=D[185][j]);for(D[186]="".split(""),j=0;j!=D[186].length;++j)65533!==D[186][j].charCodeAt(0)&&(e[D[186][j]]=47616+j,d[47616+j]=D[186][j]);for(D[187]="".split(""),j=0;j!=D[187].length;++j)65533!==D[187][j].charCodeAt(0)&&(e[D[187][j]]=47872+j,d[47872+j]=D[187][j]);for(D[188]="".split(""),j=0;j!=D[188].length;++j)65533!==D[188][j].charCodeAt(0)&&(e[D[188][j]]=48128+j,d[48128+j]=D[188][j]);for(D[189]="".split(""),j=0;j!=D[189].length;++j)65533!==D[189][j].charCodeAt(0)&&(e[D[189][j]]=48384+j,d[48384+j]=D[189][j]);for(D[190]="".split(""),j=0;j!=D[190].length;++j)65533!==D[190][j].charCodeAt(0)&&(e[D[190][j]]=48640+j,d[48640+j]=D[190][j]);for(D[191]="".split(""),j=0;j!=D[191].length;++j)65533!==D[191][j].charCodeAt(0)&&(e[D[191][j]]=48896+j,d[48896+j]=D[191][j]);for(D[192]="".split(""),j=0;j!=D[192].length;++j)65533!==D[192][j].charCodeAt(0)&&(e[D[192][j]]=49152+j,d[49152+j]=D[192][j]);for(D[193]="".split(""),j=0;j!=D[193].length;++j)65533!==D[193][j].charCodeAt(0)&&(e[D[193][j]]=49408+j,d[49408+j]=D[193][j]);for(D[194]="".split(""),j=0;j!=D[194].length;++j)65533!==D[194][j].charCodeAt(0)&&(e[D[194][j]]=49664+j,d[49664+j]=D[194][j]);for(D[195]="".split(""),j=0;j!=D[195].length;++j)65533!==D[195][j].charCodeAt(0)&&(e[D[195][j]]=49920+j,d[49920+j]=D[195][j]);for(D[196]="".split(""),j=0;j!=D[196].length;++j)65533!==D[196][j].charCodeAt(0)&&(e[D[196][j]]=50176+j,d[50176+j]=D[196][j]);for(D[197]="".split(""),j=0;j!=D[197].length;++j)65533!==D[197][j].charCodeAt(0)&&(e[D[197][j]]=50432+j,d[50432+j]=D[197][j]);for(D[198]="".split(""),j=0;j!=D[198].length;++j)65533!==D[198][j].charCodeAt(0)&&(e[D[198][j]]=50688+j,d[50688+j]=D[198][j]);for(D[199]="".split(""),j=0;j!=D[199].length;++j)65533!==D[199][j].charCodeAt(0)&&(e[D[199][j]]=50944+j,d[50944+j]=D[199][j]);for(D[200]="".split(""),j=0;j!=D[200].length;++j)65533!==D[200][j].charCodeAt(0)&&(e[D[200][j]]=51200+j,d[51200+j]=D[200][j]);for(D[202]="".split(""),j=0;j!=D[202].length;++j)65533!==D[202][j].charCodeAt(0)&&(e[D[202][j]]=51712+j,d[51712+j]=D[202][j]);for(D[203]="".split(""),j=0;j!=D[203].length;++j)65533!==D[203][j].charCodeAt(0)&&(e[D[203][j]]=51968+j,d[51968+j]=D[203][j]);for(D[204]="".split(""),j=0;j!=D[204].length;++j)65533!==D[204][j].charCodeAt(0)&&(e[D[204][j]]=52224+j,d[52224+j]=D[204][j]);for(D[205]="".split(""),j=0;j!=D[205].length;++j)65533!==D[205][j].charCodeAt(0)&&(e[D[205][j]]=52480+j,d[52480+j]=D[205][j]);for(D[206]="".split(""),j=0;j!=D[206].length;++j)65533!==D[206][j].charCodeAt(0)&&(e[D[206][j]]=52736+j,d[52736+j]=D[206][j]);for(D[207]="".split(""),j=0;j!=D[207].length;++j)65533!==D[207][j].charCodeAt(0)&&(e[D[207][j]]=52992+j,d[52992+j]=D[207][j]);for(D[208]="".split(""),j=0;j!=D[208].length;++j)65533!==D[208][j].charCodeAt(0)&&(e[D[208][j]]=53248+j,d[53248+j]=D[208][j]);for(D[209]="".split(""),j=0;j!=D[209].length;++j)65533!==D[209][j].charCodeAt(0)&&(e[D[209][j]]=53504+j,d[53504+j]=D[209][j]);for(D[210]="".split(""),j=0;j!=D[210].length;++j)65533!==D[210][j].charCodeAt(0)&&(e[D[210][j]]=53760+j,d[53760+j]=D[210][j]);for(D[211]="".split(""),j=0;j!=D[211].length;++j)65533!==D[211][j].charCodeAt(0)&&(e[D[211][j]]=54016+j,d[54016+j]=D[211][j]);for(D[212]="".split(""),j=0;j!=D[212].length;++j)65533!==D[212][j].charCodeAt(0)&&(e[D[212][j]]=54272+j,d[54272+j]=D[212][j]);for(D[213]="".split(""),j=0;j!=D[213].length;++j)65533!==D[213][j].charCodeAt(0)&&(e[D[213][j]]=54528+j,d[54528+j]=D[213][j]);for(D[214]="".split(""),j=0;j!=D[214].length;++j)65533!==D[214][j].charCodeAt(0)&&(e[D[214][j]]=54784+j,d[54784+j]=D[214][j]);for(D[215]="".split(""),j=0;j!=D[215].length;++j)65533!==D[215][j].charCodeAt(0)&&(e[D[215][j]]=55040+j,d[55040+j]=D[215][j]);for(D[216]="".split(""),j=0;j!=D[216].length;++j)65533!==D[216][j].charCodeAt(0)&&(e[D[216][j]]=55296+j,d[55296+j]=D[216][j]);for(D[217]="".split(""),j=0;j!=D[217].length;++j)65533!==D[217][j].charCodeAt(0)&&(e[D[217][j]]=55552+j,d[55552+j]=D[217][j]);for(D[218]="".split(""),j=0;j!=D[218].length;++j)65533!==D[218][j].charCodeAt(0)&&(e[D[218][j]]=55808+j,d[55808+j]=D[218][j]);for(D[219]="".split(""),j=0;j!=D[219].length;++j)65533!==D[219][j].charCodeAt(0)&&(e[D[219][j]]=56064+j,d[56064+j]=D[219][j]);for(D[220]="".split(""),j=0;j!=D[220].length;++j)65533!==D[220][j].charCodeAt(0)&&(e[D[220][j]]=56320+j,d[56320+j]=D[220][j]);for(D[221]="".split(""),j=0;j!=D[221].length;++j)65533!==D[221][j].charCodeAt(0)&&(e[D[221][j]]=56576+j,d[56576+j]=D[221][j]);for(D[222]="".split(""),j=0;j!=D[222].length;++j)65533!==D[222][j].charCodeAt(0)&&(e[D[222][j]]=56832+j,d[56832+j]=D[222][j]);for(D[223]="".split(""),j=0;j!=D[223].length;++j)65533!==D[223][j].charCodeAt(0)&&(e[D[223][j]]=57088+j,d[57088+j]=D[223][j]);for(D[224]="".split(""),j=0;j!=D[224].length;++j)65533!==D[224][j].charCodeAt(0)&&(e[D[224][j]]=57344+j,d[57344+j]=D[224][j]);for(D[225]="".split(""),j=0;j!=D[225].length;++j)65533!==D[225][j].charCodeAt(0)&&(e[D[225][j]]=57600+j,d[57600+j]=D[225][j]);for(D[226]="".split(""),j=0;j!=D[226].length;++j)65533!==D[226][j].charCodeAt(0)&&(e[D[226][j]]=57856+j,d[57856+j]=D[226][j]);for(D[227]="".split(""),j=0;j!=D[227].length;++j)65533!==D[227][j].charCodeAt(0)&&(e[D[227][j]]=58112+j,d[58112+j]=D[227][j]);for(D[228]="".split(""),j=0;j!=D[228].length;++j)65533!==D[228][j].charCodeAt(0)&&(e[D[228][j]]=58368+j,d[58368+j]=D[228][j]);for(D[229]="".split(""),j=0;j!=D[229].length;++j)65533!==D[229][j].charCodeAt(0)&&(e[D[229][j]]=58624+j,d[58624+j]=D[229][j]);for(D[230]="".split(""),j=0;j!=D[230].length;++j)65533!==D[230][j].charCodeAt(0)&&(e[D[230][j]]=58880+j,d[58880+j]=D[230][j]);for(D[231]="".split(""),j=0;j!=D[231].length;++j)65533!==D[231][j].charCodeAt(0)&&(e[D[231][j]]=59136+j,d[59136+j]=D[231][j]);for(D[232]="".split(""),j=0;j!=D[232].length;++j)65533!==D[232][j].charCodeAt(0)&&(e[D[232][j]]=59392+j,d[59392+j]=D[232][j]);for(D[233]="".split(""),j=0;j!=D[233].length;++j)65533!==D[233][j].charCodeAt(0)&&(e[D[233][j]]=59648+j,d[59648+j]=D[233][j]);for(D[234]="".split(""),j=0;j!=D[234].length;++j)65533!==D[234][j].charCodeAt(0)&&(e[D[234][j]]=59904+j,d[59904+j]=D[234][j]);for(D[235]="".split(""),j=0;j!=D[235].length;++j)65533!==D[235][j].charCodeAt(0)&&(e[D[235][j]]=60160+j,d[60160+j]=D[235][j]);for(D[236]="".split(""),j=0;j!=D[236].length;++j)65533!==D[236][j].charCodeAt(0)&&(e[D[236][j]]=60416+j,d[60416+j]=D[236][j]);for(D[237]="".split(""),j=0;j!=D[237].length;++j)65533!==D[237][j].charCodeAt(0)&&(e[D[237][j]]=60672+j,d[60672+j]=D[237][j]);for(D[238]="".split(""),j=0;j!=D[238].length;++j)65533!==D[238][j].charCodeAt(0)&&(e[D[238][j]]=60928+j,d[60928+j]=D[238][j]);for(D[239]="".split(""),j=0;j!=D[239].length;++j)65533!==D[239][j].charCodeAt(0)&&(e[D[239][j]]=61184+j,d[61184+j]=D[239][j]);for(D[240]="".split(""),j=0;j!=D[240].length;++j)65533!==D[240][j].charCodeAt(0)&&(e[D[240][j]]=61440+j,d[61440+j]=D[240][j]);for(D[241]="".split(""),j=0;j!=D[241].length;++j)65533!==D[241][j].charCodeAt(0)&&(e[D[241][j]]=61696+j,d[61696+j]=D[241][j]);for(D[242]="".split(""),j=0;j!=D[242].length;++j)65533!==D[242][j].charCodeAt(0)&&(e[D[242][j]]=61952+j,d[61952+j]=D[242][j]);for(D[243]="".split(""),j=0;j!=D[243].length;++j)65533!==D[243][j].charCodeAt(0)&&(e[D[243][j]]=62208+j,d[62208+j]=D[243][j]);for(D[244]="".split(""),j=0;j!=D[244].length;++j)65533!==D[244][j].charCodeAt(0)&&(e[D[244][j]]=62464+j,d[62464+j]=D[244][j]);for(D[245]="".split(""),j=0;j!=D[245].length;++j)65533!==D[245][j].charCodeAt(0)&&(e[D[245][j]]=62720+j,d[62720+j]=D[245][j]);for(D[246]="".split(""),j=0;j!=D[246].length;++j)65533!==D[246][j].charCodeAt(0)&&(e[D[246][j]]=62976+j,d[62976+j]=D[246][j]);for(D[247]="".split(""),j=0;j!=D[247].length;++j)65533!==D[247][j].charCodeAt(0)&&(e[D[247][j]]=63232+j,d[63232+j]=D[247][j]);for(D[248]="".split(""),j=0;j!=D[248].length;++j)65533!==D[248][j].charCodeAt(0)&&(e[D[248][j]]=63488+j,d[63488+j]=D[248][j]);for(D[249]="".split(""),j=0;j!=D[249].length;++j)65533!==D[249][j].charCodeAt(0)&&(e[D[249][j]]=63744+j,d[63744+j]=D[249][j]);for(D[250]="".split(""),j=0;j!=D[250].length;++j)65533!==D[250][j].charCodeAt(0)&&(e[D[250][j]]=64e3+j,d[64e3+j]=D[250][j]);for(D[251]="".split(""),j=0;j!=D[251].length;++j)65533!==D[251][j].charCodeAt(0)&&(e[D[251][j]]=64256+j,d[64256+j]=D[251][j]);for(D[252]="".split(""),j=0;j!=D[252].length;++j)65533!==D[252][j].charCodeAt(0)&&(e[D[252][j]]=64512+j,d[64512+j]=D[252][j]);for(D[253]="".split(""),j=0;j!=D[253].length;++j)65533!==D[253][j].charCodeAt(0)&&(e[D[253][j]]=64768+j,d[64768+j]=D[253][j]);return{enc:e,dec:d}}(),cptable[950]=function(){var j,d=[],e={},D=[];for(D[0]="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~".split(""),j=0;j!=D[0].length;++j)65533!==D[0][j].charCodeAt(0)&&(e[D[0][j]]=0+j,d[0+j]=D[0][j]);for(D[161]="".split(""),j=0;j!=D[161].length;++j)65533!==D[161][j].charCodeAt(0)&&(e[D[161][j]]=41216+j,d[41216+j]=D[161][j]);for(D[162]="".split(""),j=0;j!=D[162].length;++j)65533!==D[162][j].charCodeAt(0)&&(e[D[162][j]]=41472+j,d[41472+j]=D[162][j]);for(D[163]="".split(""),j=0;j!=D[163].length;++j)65533!==D[163][j].charCodeAt(0)&&(e[D[163][j]]=41728+j,d[41728+j]=D[163][j]);for(D[164]="".split(""),j=0;j!=D[164].length;++j)65533!==D[164][j].charCodeAt(0)&&(e[D[164][j]]=41984+j,d[41984+j]=D[164][j]);for(D[165]="".split(""),j=0;j!=D[165].length;++j)65533!==D[165][j].charCodeAt(0)&&(e[D[165][j]]=42240+j,d[42240+j]=D[165][j]);for(D[166]="".split(""),j=0;j!=D[166].length;++j)65533!==D[166][j].charCodeAt(0)&&(e[D[166][j]]=42496+j,d[42496+j]=D[166][j]);for(D[167]="".split(""),j=0;j!=D[167].length;++j)65533!==D[167][j].charCodeAt(0)&&(e[D[167][j]]=42752+j,d[42752+j]=D[167][j]);for(D[168]="".split(""),j=0;j!=D[168].length;++j)65533!==D[168][j].charCodeAt(0)&&(e[D[168][j]]=43008+j,d[43008+j]=D[168][j]);for(D[169]="".split(""),j=0;j!=D[169].length;++j)65533!==D[169][j].charCodeAt(0)&&(e[D[169][j]]=43264+j,d[43264+j]=D[169][j]);for(D[170]="".split(""),j=0;j!=D[170].length;++j)65533!==D[170][j].charCodeAt(0)&&(e[D[170][j]]=43520+j,d[43520+j]=D[170][j]);for(D[171]="".split(""),j=0;j!=D[171].length;++j)65533!==D[171][j].charCodeAt(0)&&(e[D[171][j]]=43776+j,d[43776+j]=D[171][j]);for(D[172]="".split(""),j=0;j!=D[172].length;++j)65533!==D[172][j].charCodeAt(0)&&(e[D[172][j]]=44032+j,d[44032+j]=D[172][j]);for(D[173]="".split(""),j=0;j!=D[173].length;++j)65533!==D[173][j].charCodeAt(0)&&(e[D[173][j]]=44288+j,d[44288+j]=D[173][j]);for(D[174]="".split(""),j=0;j!=D[174].length;++j)65533!==D[174][j].charCodeAt(0)&&(e[D[174][j]]=44544+j,d[44544+j]=D[174][j]);for(D[175]="".split(""),j=0;j!=D[175].length;++j)65533!==D[175][j].charCodeAt(0)&&(e[D[175][j]]=44800+j,d[44800+j]=D[175][j]);for(D[176]="".split(""),j=0;j!=D[176].length;++j)65533!==D[176][j].charCodeAt(0)&&(e[D[176][j]]=45056+j,d[45056+j]=D[176][j]);for(D[177]="".split(""),j=0;j!=D[177].length;++j)65533!==D[177][j].charCodeAt(0)&&(e[D[177][j]]=45312+j,d[45312+j]=D[177][j]);for(D[178]="".split(""),j=0;j!=D[178].length;++j)65533!==D[178][j].charCodeAt(0)&&(e[D[178][j]]=45568+j,d[45568+j]=D[178][j]);for(D[179]="".split(""),j=0;j!=D[179].length;++j)65533!==D[179][j].charCodeAt(0)&&(e[D[179][j]]=45824+j,d[45824+j]=D[179][j]);for(D[180]="".split(""),j=0;j!=D[180].length;++j)65533!==D[180][j].charCodeAt(0)&&(e[D[180][j]]=46080+j,d[46080+j]=D[180][j]);for(D[181]="".split(""),j=0;j!=D[181].length;++j)65533!==D[181][j].charCodeAt(0)&&(e[D[181][j]]=46336+j,d[46336+j]=D[181][j]);for(D[182]="".split(""),j=0;j!=D[182].length;++j)65533!==D[182][j].charCodeAt(0)&&(e[D[182][j]]=46592+j,d[46592+j]=D[182][j]);for(D[183]="".split(""),j=0;j!=D[183].length;++j)65533!==D[183][j].charCodeAt(0)&&(e[D[183][j]]=46848+j,d[46848+j]=D[183][j]);for(D[184]="".split(""),j=0;j!=D[184].length;++j)65533!==D[184][j].charCodeAt(0)&&(e[D[184][j]]=47104+j,d[47104+j]=D[184][j]);for(D[185]="".split(""),j=0;j!=D[185].length;++j)65533!==D[185][j].charCodeAt(0)&&(e[D[185][j]]=47360+j,d[47360+j]=D[185][j]);for(D[186]="".split(""),j=0;j!=D[186].length;++j)65533!==D[186][j].charCodeAt(0)&&(e[D[186][j]]=47616+j,d[47616+j]=D[186][j]);for(D[187]="".split(""),j=0;j!=D[187].length;++j)65533!==D[187][j].charCodeAt(0)&&(e[D[187][j]]=47872+j,d[47872+j]=D[187][j]);for(D[188]="".split(""),j=0;j!=D[188].length;++j)65533!==D[188][j].charCodeAt(0)&&(e[D[188][j]]=48128+j,d[48128+j]=D[188][j]);for(D[189]="".split(""),j=0;j!=D[189].length;++j)65533!==D[189][j].charCodeAt(0)&&(e[D[189][j]]=48384+j,d[48384+j]=D[189][j]);for(D[190]="".split(""),j=0;j!=D[190].length;++j)65533!==D[190][j].charCodeAt(0)&&(e[D[190][j]]=48640+j,d[48640+j]=D[190][j]);for(D[191]="".split(""),j=0;j!=D[191].length;++j)65533!==D[191][j].charCodeAt(0)&&(e[D[191][j]]=48896+j,d[48896+j]=D[191][j]);for(D[192]="".split(""),j=0;j!=D[192].length;++j)65533!==D[192][j].charCodeAt(0)&&(e[D[192][j]]=49152+j,d[49152+j]=D[192][j]);for(D[193]="".split(""),j=0;j!=D[193].length;++j)65533!==D[193][j].charCodeAt(0)&&(e[D[193][j]]=49408+j,d[49408+j]=D[193][j]);for(D[194]="".split(""),j=0;j!=D[194].length;++j)65533!==D[194][j].charCodeAt(0)&&(e[D[194][j]]=49664+j,d[49664+j]=D[194][j]);for(D[195]="".split(""),j=0;j!=D[195].length;++j)65533!==D[195][j].charCodeAt(0)&&(e[D[195][j]]=49920+j,d[49920+j]=D[195][j]);for(D[196]="".split(""),j=0;j!=D[196].length;++j)65533!==D[196][j].charCodeAt(0)&&(e[D[196][j]]=50176+j,d[50176+j]=D[196][j]);for(D[197]="".split(""),j=0;j!=D[197].length;++j)65533!==D[197][j].charCodeAt(0)&&(e[D[197][j]]=50432+j,d[50432+j]=D[197][j]);for(D[198]="".split(""),j=0;j!=D[198].length;++j)65533!==D[198][j].charCodeAt(0)&&(e[D[198][j]]=50688+j,d[50688+j]=D[198][j]);for(D[201]="".split(""),j=0;j!=D[201].length;++j)65533!==D[201][j].charCodeAt(0)&&(e[D[201][j]]=51456+j,d[51456+j]=D[201][j]);for(D[202]="".split(""),j=0;j!=D[202].length;++j)65533!==D[202][j].charCodeAt(0)&&(e[D[202][j]]=51712+j,d[51712+j]=D[202][j]);for(D[203]="".split(""),j=0;j!=D[203].length;++j)65533!==D[203][j].charCodeAt(0)&&(e[D[203][j]]=51968+j,d[51968+j]=D[203][j]);for(D[204]="".split(""),j=0;j!=D[204].length;++j)65533!==D[204][j].charCodeAt(0)&&(e[D[204][j]]=52224+j,d[52224+j]=D[204][j]);for(D[205]="".split(""),j=0;j!=D[205].length;++j)65533!==D[205][j].charCodeAt(0)&&(e[D[205][j]]=52480+j,d[52480+j]=D[205][j]);for(D[206]="".split(""),j=0;j!=D[206].length;++j)65533!==D[206][j].charCodeAt(0)&&(e[D[206][j]]=52736+j,d[52736+j]=D[206][j]);for(D[207]="".split(""),j=0;j!=D[207].length;++j)65533!==D[207][j].charCodeAt(0)&&(e[D[207][j]]=52992+j,d[52992+j]=D[207][j]);for(D[208]="".split(""),j=0;j!=D[208].length;++j)65533!==D[208][j].charCodeAt(0)&&(e[D[208][j]]=53248+j,d[53248+j]=D[208][j]);for(D[209]="".split(""),j=0;j!=D[209].length;++j)65533!==D[209][j].charCodeAt(0)&&(e[D[209][j]]=53504+j,d[53504+j]=D[209][j]);for(D[210]="".split(""),j=0;j!=D[210].length;++j)65533!==D[210][j].charCodeAt(0)&&(e[D[210][j]]=53760+j,d[53760+j]=D[210][j]);for(D[211]="".split(""),j=0;j!=D[211].length;++j)65533!==D[211][j].charCodeAt(0)&&(e[D[211][j]]=54016+j,d[54016+j]=D[211][j]);for(D[212]="".split(""),j=0;j!=D[212].length;++j)65533!==D[212][j].charCodeAt(0)&&(e[D[212][j]]=54272+j,d[54272+j]=D[212][j]);for(D[213]="".split(""),j=0;j!=D[213].length;++j)65533!==D[213][j].charCodeAt(0)&&(e[D[213][j]]=54528+j,d[54528+j]=D[213][j]);for(D[214]="".split(""),j=0;j!=D[214].length;++j)65533!==D[214][j].charCodeAt(0)&&(e[D[214][j]]=54784+j,d[54784+j]=D[214][j]);for(D[215]="".split(""),j=0;j!=D[215].length;++j)65533!==D[215][j].charCodeAt(0)&&(e[D[215][j]]=55040+j,d[55040+j]=D[215][j]);for(D[216]="".split(""),j=0;j!=D[216].length;++j)65533!==D[216][j].charCodeAt(0)&&(e[D[216][j]]=55296+j,d[55296+j]=D[216][j]);for(D[217]="".split(""),j=0;j!=D[217].length;++j)65533!==D[217][j].charCodeAt(0)&&(e[D[217][j]]=55552+j,d[55552+j]=D[217][j]);for(D[218]="".split(""),j=0;j!=D[218].length;++j)65533!==D[218][j].charCodeAt(0)&&(e[D[218][j]]=55808+j,d[55808+j]=D[218][j]);for(D[219]="".split(""),j=0;j!=D[219].length;++j)65533!==D[219][j].charCodeAt(0)&&(e[D[219][j]]=56064+j,d[56064+j]=D[219][j]);for(D[220]="".split(""),j=0;j!=D[220].length;++j)65533!==D[220][j].charCodeAt(0)&&(e[D[220][j]]=56320+j,d[56320+j]=D[220][j]);for(D[221]="".split(""),j=0;j!=D[221].length;++j)65533!==D[221][j].charCodeAt(0)&&(e[D[221][j]]=56576+j,d[56576+j]=D[221][j]);for(D[222]="".split(""),j=0;j!=D[222].length;++j)65533!==D[222][j].charCodeAt(0)&&(e[D[222][j]]=56832+j,d[56832+j]=D[222][j]);for(D[223]="".split(""),j=0;j!=D[223].length;++j)65533!==D[223][j].charCodeAt(0)&&(e[D[223][j]]=57088+j,d[57088+j]=D[223][j]);for(D[224]="".split(""),j=0;j!=D[224].length;++j)65533!==D[224][j].charCodeAt(0)&&(e[D[224][j]]=57344+j,d[57344+j]=D[224][j]);for(D[225]="".split(""),j=0;j!=D[225].length;++j)65533!==D[225][j].charCodeAt(0)&&(e[D[225][j]]=57600+j,d[57600+j]=D[225][j]);for(D[226]="".split(""),j=0;j!=D[226].length;++j)65533!==D[226][j].charCodeAt(0)&&(e[D[226][j]]=57856+j,d[57856+j]=D[226][j]);for(D[227]="".split(""),j=0;j!=D[227].length;++j)65533!==D[227][j].charCodeAt(0)&&(e[D[227][j]]=58112+j,d[58112+j]=D[227][j]);for(D[228]="".split(""),j=0;j!=D[228].length;++j)65533!==D[228][j].charCodeAt(0)&&(e[D[228][j]]=58368+j,d[58368+j]=D[228][j]);for(D[229]="".split(""),j=0;j!=D[229].length;++j)65533!==D[229][j].charCodeAt(0)&&(e[D[229][j]]=58624+j,d[58624+j]=D[229][j]);for(D[230]="".split(""),j=0;j!=D[230].length;++j)65533!==D[230][j].charCodeAt(0)&&(e[D[230][j]]=58880+j,d[58880+j]=D[230][j]);for(D[231]="".split(""),j=0;j!=D[231].length;++j)65533!==D[231][j].charCodeAt(0)&&(e[D[231][j]]=59136+j,d[59136+j]=D[231][j]);for(D[232]="".split(""),j=0;j!=D[232].length;++j)65533!==D[232][j].charCodeAt(0)&&(e[D[232][j]]=59392+j,d[59392+j]=D[232][j]);for(D[233]="".split(""),j=0;j!=D[233].length;++j)65533!==D[233][j].charCodeAt(0)&&(e[D[233][j]]=59648+j,d[59648+j]=D[233][j]);for(D[234]="".split(""),j=0;j!=D[234].length;++j)65533!==D[234][j].charCodeAt(0)&&(e[D[234][j]]=59904+j,d[59904+j]=D[234][j]);for(D[235]="".split(""),j=0;j!=D[235].length;++j)65533!==D[235][j].charCodeAt(0)&&(e[D[235][j]]=60160+j,d[60160+j]=D[235][j]);for(D[236]="".split(""),j=0;j!=D[236].length;++j)65533!==D[236][j].charCodeAt(0)&&(e[D[236][j]]=60416+j,d[60416+j]=D[236][j]);for(D[237]="".split(""),j=0;j!=D[237].length;++j)65533!==D[237][j].charCodeAt(0)&&(e[D[237][j]]=60672+j,d[60672+j]=D[237][j]);for(D[238]="".split(""),j=0;j!=D[238].length;++j)65533!==D[238][j].charCodeAt(0)&&(e[D[238][j]]=60928+j,d[60928+j]=D[238][j]);for(D[239]="".split(""),j=0;j!=D[239].length;++j)65533!==D[239][j].charCodeAt(0)&&(e[D[239][j]]=61184+j,d[61184+j]=D[239][j]);for(D[240]="".split(""),j=0;j!=D[240].length;++j)65533!==D[240][j].charCodeAt(0)&&(e[D[240][j]]=61440+j,d[61440+j]=D[240][j]);for(D[241]="".split(""),j=0;j!=D[241].length;++j)65533!==D[241][j].charCodeAt(0)&&(e[D[241][j]]=61696+j,d[61696+j]=D[241][j]);for(D[242]="".split(""),j=0;j!=D[242].length;++j)65533!==D[242][j].charCodeAt(0)&&(e[D[242][j]]=61952+j,d[61952+j]=D[242][j]);for(D[243]="".split(""),j=0;j!=D[243].length;++j)65533!==D[243][j].charCodeAt(0)&&(e[D[243][j]]=62208+j,d[62208+j]=D[243][j]);for(D[244]="".split(""),j=0;j!=D[244].length;++j)65533!==D[244][j].charCodeAt(0)&&(e[D[244][j]]=62464+j,d[62464+j]=D[244][j]);for(D[245]="".split(""),j=0;j!=D[245].length;++j)65533!==D[245][j].charCodeAt(0)&&(e[D[245][j]]=62720+j,d[62720+j]=D[245][j]);for(D[246]="".split(""),j=0;j!=D[246].length;++j)65533!==D[246][j].charCodeAt(0)&&(e[D[246][j]]=62976+j,d[62976+j]=D[246][j]);for(D[247]="".split(""),j=0;j!=D[247].length;++j)65533!==D[247][j].charCodeAt(0)&&(e[D[247][j]]=63232+j,d[63232+j]=D[247][j]);for(D[248]="".split(""),j=0;j!=D[248].length;++j)65533!==D[248][j].charCodeAt(0)&&(e[D[248][j]]=63488+j,d[63488+j]=D[248][j]);for(D[249]="".split(""),j=0;j!=D[249].length;++j)65533!==D[249][j].charCodeAt(0)&&(e[D[249][j]]=63744+j,d[63744+j]=D[249][j]);return{enc:e,dec:d}}(),cptable[1250]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1251]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1252]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1253]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1254]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1255]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1256]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1257]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1258]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[1e4]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[10006]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[10007]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[10029]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[10079]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),cptable[10081]=function(){for(var d="\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",D=[],e={},i=0;i!=d.length;++i)65533!==d.charCodeAt(i)&&(e[d[i]]=i),D[i]=d.charAt(i);return{enc:e,dec:D}}(),"undefined"!=typeof module&&module.exports&&(module.exports=cptable),function(root,factory){"use strict";if(void 0===cptable){if("undefined"==typeof require)throw new Error("cptable not found");var cpt=require("./cptable");"undefined"!=typeof module&&module.exports?module.exports=factory(cpt):root.cptable=factory(cpt)}else cptable=factory(cptable)}(this,function(cpt){"use strict";var magic={1200:"utf16le",1201:"utf16be",12000:"utf32le",12001:"utf32be",16969:"utf64le",20127:"ascii",65000:"utf7",65001:"utf8"},sbcs_cache=[874,1250,1251,1252,1253,1254,1255,1256,1e4],dbcs_cache=[932,936,949,950],magic_cache=[65001],magic_decode={},magic_encode={},cpecache={},cpdcache={},sfcc=function(x){return String.fromCharCode(x)},cca=function(x){return x.charCodeAt(0)},has_buf="undefined"!=typeof Buffer;if(has_buf){var mdl=1024,mdb=new Buffer(mdl),sbcs_encode=function(cp){var EE=function(E){for(var EE=new Buffer(65536),i=0;i<65536;++i)EE[i]=0;for(var keys=Object.keys(E),len=keys.length,ee=0,e=keys[ee];ee<len;++ee)(e=keys[ee])&&(EE[e.charCodeAt(0)]=E[e]);return EE}(cpt[cp].enc);return function(data,ofmt){var out,i,j,D,w,len=data.length;if("string"==typeof data)for(out=Buffer(len),i=0;i<len;++i)out[i]=EE[data.charCodeAt(i)];else if(Buffer.isBuffer(data)){for(out=Buffer(2*len),j=0,i=0;i<len;++i)(D=data[i])<128?out[j++]=EE[D]:D<224?(out[j++]=EE[((31&D)<<6)+(63&data[i+1])],++i):D<240?(out[j++]=EE[((15&D)<<12)+((63&data[i+1])<<6)+(63&data[i+2])],i+=2):(w=((7&D)<<18)+((63&data[i+1])<<12)+((63&data[i+2])<<6)+(63&data[i+3]),i+=3,w<65536?out[j++]=EE[w]:(w-=65536,out[j++]=EE[55296+(w>>10&1023)],out[j++]=EE[56320+(1023&w)]));out.length=j,out=out.slice(0,j)}else for(out=Buffer(len),i=0;i<len;++i)out[i]=EE[data[i].charCodeAt(0)];return void 0===ofmt||"buf"===ofmt?out:"arr"!==ofmt?out.toString("binary"):[].slice.call(out)}},sbcs_decode=function(cp){var c,D=cpt[cp].dec,DD=new Buffer(131072),d=0;for(d=0;d<D.length;++d)if(c=D[d]){var w=c.charCodeAt(0);DD[2*d]=255&w,DD[2*d+1]=w>>8}return function(data){var j,len=data.length,i=0;if(2*len>mdl&&(mdl=2*len,mdb=new Buffer(mdl)),Buffer.isBuffer(data))for(i=0;i<len;i++)j=2*data[i],mdb[2*i]=DD[j],mdb[2*i+1]=DD[j+1];else if("string"==typeof data)for(i=0;i<len;i++)j=2*data.charCodeAt(i),mdb[2*i]=DD[j],mdb[2*i+1]=DD[j+1];else for(i=0;i<len;i++)j=2*data[i],mdb[2*i]=DD[j],mdb[2*i+1]=DD[j+1];return mdb.length=2*len,mdb.toString("ucs2")}},dbcs_encode=function(cp){for(var E=cpt[cp].enc,EE=new Buffer(131072),i=0;i<131072;++i)EE[i]=0;for(var keys=Object.keys(E),ee=0,e=keys[ee];ee<keys.length;++ee)if(e=keys[ee]){var f=e.charCodeAt(0);EE[2*f]=255&E[e],EE[2*f+1]=E[e]>>8}return function(data,ofmt){var i,j,jj,k,D,len=data.length,out=new Buffer(2*len);if("string"==typeof data){for(i=k=0;i<len;++i)j=2*data.charCodeAt(i),out[k++]=EE[j+1]||EE[j],EE[j+1]>0&&(out[k++]=EE[j]);out.length=k,out=out.slice(0,k)}else if(Buffer.isBuffer(data)){for(i=k=0;i<len;++i)(D=data[i])<128?j=D:D<224?(j=((31&D)<<6)+(63&data[i+1]),++i):D<240?(j=((15&D)<<12)+((63&data[i+1])<<6)+(63&data[i+2]),i+=2):(j=((7&D)<<18)+((63&data[i+1])<<12)+((63&data[i+2])<<6)+(63&data[i+3]),i+=3),j<65536?(j*=2,out[k++]=EE[j+1]||EE[j],EE[j+1]>0&&(out[k++]=EE[j])):(j=2*(55296+((jj=j-65536)>>10&1023)),out[k++]=EE[j+1]||EE[j],EE[j+1]>0&&(out[k++]=EE[j]),j=2*(56320+(1023&jj)),out[k++]=EE[j+1]||EE[j],EE[j+1]>0&&(out[k++]=EE[j]));out.length=k,out=out.slice(0,k)}else for(i=k=0;i<len;i++)j=2*data[i].charCodeAt(0),out[k++]=EE[j+1]||EE[j],EE[j+1]>0&&(out[k++]=EE[j]);return void 0===ofmt||"buf"===ofmt?out:"arr"!==ofmt?out.toString("binary"):[].slice.call(out)}},dbcs_decode=function(cp){var c,D=cpt[cp].dec,DD=new Buffer(131072),d=0,w=0,j=0,i=0;for(i=0;i<65536;++i)DD[2*i]=255,DD[2*i+1]=253;for(d=0;d<D.length;++d)(c=D[d])&&(w=c.charCodeAt(0),DD[j=2*d]=255&w,DD[j+1]=w>>8);return function(data){var i,j,len=data.length,out=new Buffer(2*len),k=0;if(Buffer.isBuffer(data))for(i=0;i<len;i++)j=2*data[i],255===DD[j]&&253===DD[j+1]&&(j=2*((data[i]<<8)+data[i+1]),++i),out[k++]=DD[j],out[k++]=DD[j+1];else if("string"==typeof data)for(i=0;i<len;i++)j=2*data.charCodeAt(i),255===DD[j]&&253===DD[j+1]&&(j=2*((data.charCodeAt(i)<<8)+data.charCodeAt(i+1)),++i),out[k++]=DD[j],out[k++]=DD[j+1];else for(i=0;i<len;i++)j=2*data[i],255===DD[j]&&253===DD[j+1]&&(j=2*((data[i]<<8)+data[i+1]),++i),out[k++]=DD[j],out[k++]=DD[j+1];return out.length=k,out.toString("ucs2")}};magic_decode[65001]=function(data){var len=data.length,w=0,ww=0;4*len>mdl&&(mdl=4*len,mdb=new Buffer(mdl)),mdb.length=0;var i=0;len>=3&&239==data[0]&&187==data[1]&&191==data[2]&&(i=3);for(var j=1,k=0,D=0;i<len;i+=j)j=1,(D=data[i])<128?w=D:D<224?(w=64*(31&D)+(63&data[i+1]),j=2):D<240?(w=((15&D)<<12)+64*(63&data[i+1])+(63&data[i+2]),j=3):(w=262144*(7&D)+((63&data[i+1])<<12)+64*(63&data[i+2])+(63&data[i+3]),j=4),w<65536?(mdb[k++]=255&w,mdb[k++]=w>>8):(ww=55296+((w-=65536)>>10&1023),w=56320+(1023&w),mdb[k++]=255&ww,mdb[k++]=ww>>>8,mdb[k++]=255&w,mdb[k++]=w>>>8&255);return mdb.length=k,mdb.toString("ucs2")},magic_encode[65001]=function(data,ofmt){var len=data.length,w=0,ww=0,j=0,direct="string"==typeof data;4*len>mdl&&(mdl=4*len,mdb=new Buffer(mdl));for(var i=0;i<len;++i)(w=direct?data.charCodeAt(i):data[i].charCodeAt(0))<=127?mdb[j++]=w:w<=2047?(mdb[j++]=192+(w>>6),mdb[j++]=128+(63&w)):w>=55296&&w<=57343?(w-=55296,++i,ww=(direct?data.charCodeAt(i):data[i].charCodeAt(0))-56320+(w<<10),mdb[j++]=240+(ww>>>18&7),mdb[j++]=144+(ww>>>12&63),mdb[j++]=128+(ww>>>6&63),mdb[j++]=128+(63&ww)):(mdb[j++]=224+(w>>12),mdb[j++]=128+(w>>6&63),mdb[j++]=128+(63&w));return mdb.length=j,void 0===ofmt||"buf"===ofmt?mdb:"arr"!==ofmt?mdb.toString("binary"):[].slice.call(mdb)}}var encache=function(){if(has_buf){if(cpdcache[sbcs_cache[0]])return;var i,s;for(i=0;i<sbcs_cache.length;++i)s=sbcs_cache[i],cpt[s]&&(cpdcache[s]=sbcs_decode(s),cpecache[s]=sbcs_encode(s));for(i=0;i<dbcs_cache.length;++i)s=dbcs_cache[i],cpt[s]&&(cpdcache[s]=dbcs_decode(s),cpecache[s]=dbcs_encode(s));for(i=0;i<magic_cache.length;++i)s=magic_cache[i],magic_decode[s]&&(cpdcache[s]=magic_decode[s]),magic_encode[s]&&(cpecache[s]=magic_encode[s])}},cp_decache=function(cp){cpdcache[cp]=cpecache[cp]=void 0},cache={encache:encache,decache:function(){if(has_buf){if(!cpdcache[sbcs_cache[0]])return;sbcs_cache.forEach(cp_decache),dbcs_cache.forEach(cp_decache),magic_cache.forEach(cp_decache)}last_enc=last_cp=void 0},sbcs:sbcs_cache,dbcs:dbcs_cache};encache();var last_enc,last_cp,BM="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";return cpt.utils={decode:function decode(cp,data){var F;if(F=cpdcache[cp])return F(data);var w,i,ww,D,M,len=data.length,out=new Array(len),j=1,k=0,C=cpt[cp];if(C&&(D=C.dec))for("string"==typeof data&&(data=data.split("").map(cca)),i=0;i<len;i+=j){if(j=2,(w=D[(data[i]<<8)+data[i+1]])||(j=1,w=D[data[i]]),!w)throw new Error("Unrecognized code: "+data[i]+" "+data[i+j-1]+" "+i+" "+j+" "+D[data[i]]);out[k++]=w}else{if(!(M=magic[cp]))throw new Error("Unrecognized CP: "+cp);switch(M){case"utf8":for(i=0,len>=3&&239==data[0]&&187==data[1]&&191==data[2]&&(i=3);i<len;i+=j)j=1,data[i]<128?w=data[i]:data[i]<224?(w=64*(31&data[i])+(63&data[i+1]),j=2):data[i]<240?(w=((15&data[i])<<12)+64*(63&data[i+1])+(63&data[i+2]),j=3):(w=262144*(7&data[i])+((63&data[i+1])<<12)+64*(63&data[i+2])+(63&data[i+3]),j=4),w<65536?out[k++]=String.fromCharCode(w):(ww=55296+((w-=65536)>>10&1023),w=56320+(1023&w),out[k++]=String.fromCharCode(ww),out[k++]=String.fromCharCode(w));break;case"ascii":if(has_buf&&Buffer.isBuffer(data))return data.toString(M);for(i=0;i<len;i++)out[i]=String.fromCharCode(data[i]);k=len;break;case"utf16le":if(i=0,len>=2&&255==data[0]&&254==data[1]&&(i=2),has_buf&&Buffer.isBuffer(data))return data.toString(M);for(j=2;i<len;i+=j)out[k++]=String.fromCharCode((data[i+1]<<8)+data[i]);break;case"utf16be":for(i=0,len>=2&&254==data[0]&&255==data[1]&&(i=2),j=2;i<len;i+=j)out[k++]=String.fromCharCode((data[i]<<8)+data[i+1]);break;case"utf32le":for(i=0,len>=4&&255==data[0]&&254==data[1]&&0==data[2]&&0==data[3]&&(i=4),j=4;i<len;i+=j)(w=(data[i+3]<<24)+(data[i+2]<<16)+(data[i+1]<<8)+data[i])>65535?(w-=65536,out[k++]=String.fromCharCode(55296+(w>>10&1023)),out[k++]=String.fromCharCode(56320+(1023&w))):out[k++]=String.fromCharCode(w);break;case"utf32be":for(i=0,len>=4&&255==data[3]&&254==data[2]&&0==data[1]&&0==data[0]&&(i=4),j=4;i<len;i+=j)(w=(data[i]<<24)+(data[i+1]<<16)+(data[i+2]<<8)+data[i+3])>65535?(w-=65536,out[k++]=String.fromCharCode(55296+(w>>10&1023)),out[k++]=String.fromCharCode(56320+(1023&w))):out[k++]=String.fromCharCode(w);break;case"utf7":for(i=0,len>=4&&43==data[0]&&47==data[1]&&118==data[2]&&(len>=5&&56==data[3]&&45==data[4]?i=5:56!=data[3]&&57!=data[3]&&43!=data[3]&&47!=data[3]||(i=4));i<len;i+=j)if(43===data[i])if(j=1,45!==data[i+1]){for(;String.fromCharCode(data[i+j]).match(/[A-Za-z0-9+\/]/);)j++;var dash=0;45===data[i+j]&&(++j,dash=1);for(var o64,c1,c2,c3,e2,e3,e4,tt=[],l=1;l<j-dash&&(c1=BM.indexOf(String.fromCharCode(data[i+l++]))<<2|(e2=BM.indexOf(String.fromCharCode(data[i+l++])))>>4,tt.push(c1),-1!==(e3=BM.indexOf(String.fromCharCode(data[i+l++]))))&&(c2=(15&e2)<<4|e3>>2,tt.push(c2),-1!==(e4=BM.indexOf(String.fromCharCode(data[i+l++]))));)c3=(3&e3)<<6|e4,e4<64&&tt.push(c3);for(1==(1&tt.length)&&tt.length--,o64=decode(1201,tt),l=0;l<o64.length;++l)out[k++]=o64[l]}else j=2,out[k++]="+";else j=1,out[k++]=String.fromCharCode(data[i]);break;default:throw new Error("Unsupported magic: "+cp+" "+magic[cp])}}return out.length=k,out.join("")},encode:function encode(cp,data,ofmt){if(cp===last_cp)return last_enc(data,ofmt);if(void 0!==cpecache[cp])return(last_enc=cpecache[last_cp=cp])(data,ofmt);has_buf&&Buffer.isBuffer(data)&&(data=data.toString("utf8"));var w,i,c,tt,ww,E,M,len=data.length,out=has_buf?new Buffer(4*len):[],j=0,C=cpt[cp];if(C&&(E=C.enc))for(i=0;i<len;++i,++j)w=E[data[i]],out[j]=255&w,w>255&&(out[j]=w>>8,out[++j]=255&w);else{if(!(M=magic[cp]))throw new Error("Unrecognized CP: "+cp);switch(M){case"utf8":if(has_buf&&"string"==typeof data){j=(out=new Buffer(data,M)).length;break}for(i=0;i<len;++i,++j)(w=data[i].charCodeAt(0))<=127?out[j]=w:w<=2047?(out[j]=192+(w>>6),out[++j]=128+(63&w)):w>=55296&&w<=57343?(w-=55296,ww=data[++i].charCodeAt(0)-56320+(w<<10),out[j]=240+(ww>>>18&7),out[++j]=144+(ww>>>12&63),out[++j]=128+(ww>>>6&63),out[++j]=128+(63&ww)):(out[j]=224+(w>>12),out[++j]=128+(w>>6&63),out[++j]=128+(63&w));break;case"ascii":if(has_buf&&"string"==typeof data){j=(out=new Buffer(data,M)).length;break}for(i=0;i<len;++i,++j){if(!((w=data[i].charCodeAt(0))<=127))throw new Error("bad ascii "+w);out[j]=w}break;case"utf16le":if(has_buf&&"string"==typeof data){j=(out=new Buffer(data,M)).length;break}for(i=0;i<len;++i)w=data[i].charCodeAt(0),out[j++]=255&w,out[j++]=w>>8;break;case"utf16be":for(i=0;i<len;++i)w=data[i].charCodeAt(0),out[j++]=w>>8,out[j++]=255&w;break;case"utf32le":for(i=0;i<len;++i)(w=data[i].charCodeAt(0))>=55296&&w<=57343&&(w=65536+(w-55296<<10)+(data[++i].charCodeAt(0)-56320)),out[j++]=255&w,w>>=8,out[j++]=255&w,w>>=8,out[j++]=255&w,w>>=8,out[j++]=255&w;break;case"utf32be":for(i=0;i<len;++i)(w=data[i].charCodeAt(0))>=55296&&w<=57343&&(w=65536+(w-55296<<10)+(data[++i].charCodeAt(0)-56320)),out[j+3]=255&w,w>>=8,out[j+2]=255&w,w>>=8,out[j+1]=255&w,w>>=8,out[j]=255&w,w>>=8,j+=4;break;case"utf7":for(i=0;i<len;i++)"+"!==(c=data[i])?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'(),-./:?".indexOf(c)>-1?out[j++]=c.charCodeAt(0):(tt=encode(1201,c),out[j++]=43,out[j++]=BM.charCodeAt(tt[0]>>2),out[j++]=BM.charCodeAt(((3&tt[0])<<4)+((tt[1]||0)>>4)),out[j++]=BM.charCodeAt(((15&tt[1])<<2)+((tt[2]||0)>>6)),out[j++]=45):(out[j++]=43,out[j++]=45);break;default:throw new Error("Unsupported magic: "+cp+" "+magic[cp])}}return out.length=j,out=out.slice(0,j),"undefined"==typeof Buffer?"str"==ofmt?out.map(sfcc).join(""):out:void 0===ofmt||"buf"===ofmt?out:"arr"!==ofmt?out.toString("binary"):[].slice.call(out)},hascp:function(cp){return cpt[cp]||magic[cp]},magic:magic,cache:cache},cpt});var XLSX={};!function(XLSX){XLSX.version="0.8.0";var current_codepage=1200;function reset_cp(){set_cp(1200)}"undefined"!=typeof module&&"undefined"!=typeof require&&(void 0===cptable&&(cptable=require("./dist/cpexcel")),cptable[current_codepage]);var set_cp=function(cp){current_codepage=cp};function char_codes(data){for(var o=[],i=0,len=data.length;i<len;++i)o[i]=data.charCodeAt(i);return o}var debom_xml=function(data){return data},_getchar=function(x){return String.fromCharCode(x)};void 0!==cptable&&(set_cp=function(cp){current_codepage=cp,cptable[cp]},debom_xml=function(data){return 255===data.charCodeAt(0)&&254===data.charCodeAt(1)?cptable.utils.decode(1200,char_codes(data.substr(2))):data},_getchar=function(x){return 1200===current_codepage?String.fromCharCode(x):cptable.utils.decode(current_codepage,[255&x,x>>8])[0]});var map,Base64=(map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",{encode:function(input,utf8){for(var c1,c2,c3,e1,e2,e3,e4,o="",i=0;i<input.length;)e1=(c1=input.charCodeAt(i++))>>2,e2=(3&c1)<<4|(c2=input.charCodeAt(i++))>>4,e3=(15&c2)<<2|(c3=input.charCodeAt(i++))>>6,e4=63&c3,isNaN(c2)?e3=e4=64:isNaN(c3)&&(e4=64),o+=map.charAt(e1)+map.charAt(e2)+map.charAt(e3)+map.charAt(e4);return o},decode:function(input,utf8){var c1,c2,c3,e2,e3,e4,o="";input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var i=0;i<input.length;)c1=map.indexOf(input.charAt(i++))<<2|(e2=map.indexOf(input.charAt(i++)))>>4,c2=(15&e2)<<4|(e3=map.indexOf(input.charAt(i++)))>>2,c3=(3&e3)<<6|(e4=map.indexOf(input.charAt(i++))),o+=String.fromCharCode(c1),64!=e3&&(o+=String.fromCharCode(c2)),64!=e4&&(o+=String.fromCharCode(c3));return o}}),has_buf="undefined"!=typeof Buffer;function new_raw_buf(len){return new(has_buf?Buffer:Array)(len)}function s2a(s){return has_buf?new Buffer(s,"binary"):s.split("").map(function(x){return 255&x.charCodeAt(0)})}var bconcat=function(bufs){return[].concat.apply([],bufs)},chr0=/\u0000/g,chr1=/[\u0001-\u0006]/,SSF={},make_ssf=function(SSF){function _strrev(x){for(var o="",i=x.length-1;i>=0;)o+=x.charAt(i--);return o}function fill(c,l){for(var o="";o.length<l;)o+=c;return o}function pad0(v,d){var t=""+v;return t.length>=d?t:fill("0",d-t.length)+t}function pad_(v,d){var t=""+v;return t.length>=d?t:fill(" ",d-t.length)+t}function rpad_(v,d){var t=""+v;return t.length>=d?t:t+fill(" ",d-t.length)}SSF.version="0.8.1";var p2_32=Math.pow(2,32);function pad0r(v,d){return v>p2_32||v<-p2_32?function(v,d){var t=""+Math.round(v);return t.length>=d?t:fill("0",d-t.length)+t}(v,d):function(v,d){var t=""+v;return t.length>=d?t:fill("0",d-t.length)+t}(Math.round(v),d)}function isgeneral(s,i){return s.length>=7+i&&103==(32|s.charCodeAt(i))&&101==(32|s.charCodeAt(i+1))&&110==(32|s.charCodeAt(i+2))&&101==(32|s.charCodeAt(i+3))&&114==(32|s.charCodeAt(i+4))&&97==(32|s.charCodeAt(i+5))&&108==(32|s.charCodeAt(i+6))}var opts_fmt=[["date1904",0],["output",""],["WTF",!1]];function fixopts(o){for(var y=0;y!=opts_fmt.length;++y)void 0===o[opts_fmt[y][0]]&&(o[opts_fmt[y][0]]=opts_fmt[y][1])}SSF.opts=opts_fmt;var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"/ "hh""mm""ss" "',65535:"General"},days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function frac(x,D,mixed){for(var sgn=x<0?-1:1,B=x*sgn,P_2=0,P_1=1,P=0,Q_2=1,Q_1=0,Q=0,A=Math.floor(B);Q_1<D&&(P=(A=Math.floor(B))*P_1+P_2,Q=A*Q_1+Q_2,!(B-A<5e-10));)B=1/(B-A),P_2=P_1,P_1=P,Q_2=Q_1,Q_1=Q;if(Q>D&&(Q=Q_1,P=P_1),Q>D&&(Q=Q_2,P=P_2),!mixed)return[0,sgn*P,Q];if(0===Q)throw"Unexpected state: "+P+" "+P_1+" "+P_2+" "+Q+" "+Q_1+" "+Q_2;var q=Math.floor(sgn*P/Q);return[q,sgn*P-q*Q,Q]}function general_fmt_int(v,opts){return""+v}SSF._general_int=general_fmt_int;var general_fmt_num=function(){var gnr1=/\.(\d*[1-9])0+$/,gnr2=/\.0*$/,gnr4=/\.(\d*[1-9])0+/,gnr5=/\.0*[Ee]/,gnr6=/(E[+-])(\d)$/;function gfn5(o){return o.indexOf(".")>-1?o.replace(gnr2,"").replace(gnr1,".$1"):o}return function(v,opts){var V=Math.floor(Math.log(Math.abs(v))*Math.LOG10E);return gfn5(function(o){for(var i=0;i!=o.length;++i)if(101==(32|o.charCodeAt(i)))return o.replace(gnr4,".$1").replace(gnr5,"E").replace("e","E").replace(gnr6,"$10$2");return o}(V>=-4&&V<=-1?v.toPrecision(10+V):Math.abs(V)<=9?function(v){var w=v<0?12:11,o=gfn5(v.toFixed(12));return o.length<=w?o:(o=v.toPrecision(10)).length<=w?o:v.toExponential(5)}(v):10===V?v.toFixed(10).substr(0,12):function(v){var o=v.toFixed(11).replace(gnr1,".$1");return o.length>(v<0?12:11)&&(o=v.toPrecision(6)),o}(v)))}}();function general_fmt(v,opts){switch(typeof v){case"string":return v;case"boolean":return v?"TRUE":"FALSE";case"number":return(0|v)===v?general_fmt_int(v):general_fmt_num(v,opts)}throw new Error("unsupported value in General format: "+v)}function parse_date_code(v,opts,b2){if(v>2958465||v<0)return null;var date=0|v,time=Math.floor(86400*(v-date)),dow=0,dout=[],out={D:date,T:time,u:86400*(v-date)-time,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(out.u)<1e-6&&(out.u=0),fixopts(null!=opts?opts:opts=[]),opts.date1904&&(date+=1462),out.u>.999&&(out.u=0,86400==++time&&(time=0,++date)),60===date)dout=b2?[1317,10,29]:[1900,2,29],dow=3;else if(0===date)dout=b2?[1317,8,29]:[1900,1,0],dow=6;else{date>60&&--date;var d=new Date(1900,0,1);d.setDate(d.getDate()+date-1),dout=[d.getFullYear(),d.getMonth()+1,d.getDate()],dow=d.getDay(),date<60&&(dow=(dow+6)%7),b2&&(dow=0)}return out.y=dout[0],out.m=dout[1],out.d=dout[2],out.S=time%60,time=Math.floor(time/60),out.M=time%60,time=Math.floor(time/60),out.H=time,out.q=dow,out}function write_date(type,fmt,val,ss0){var out,o="",ss=0,tt=0,y=val.y,outl=0;switch(type){case 98:y=val.y+543;case 121:switch(fmt.length){case 1:case 2:out=y%100,outl=2;break;default:out=y%1e4,outl=4}break;case 109:switch(fmt.length){case 1:case 2:out=val.m,outl=fmt.length;break;case 3:return months[val.m-1][1];case 5:return months[val.m-1][0];default:return months[val.m-1][2]}break;case 100:switch(fmt.length){case 1:case 2:out=val.d,outl=fmt.length;break;case 3:return days[val.q][0];default:return days[val.q][1]}break;case 104:switch(fmt.length){case 1:case 2:out=1+(val.H+11)%12,outl=fmt.length;break;default:throw"bad hour format: "+fmt}break;case 72:switch(fmt.length){case 1:case 2:out=val.H,outl=fmt.length;break;default:throw"bad hour format: "+fmt}break;case 77:switch(fmt.length){case 1:case 2:out=val.M,outl=fmt.length;break;default:throw"bad minute format: "+fmt}break;case 115:if(0===val.u)switch(fmt){case"s":case"ss":return pad0(val.S,fmt.length)}switch(fmt){case"s":case"ss":case".0":case".00":case".000":return tt=ss0>=2?3===ss0?1e3:100:1===ss0?10:1,(ss=Math.round(tt*(val.S+val.u)))>=60*tt&&(ss=0),"s"===fmt?0===ss?"0":""+ss/tt:(o=pad0(ss,2+ss0),"ss"===fmt?o.substr(0,2):"."+o.substr(2,fmt.length-1));default:throw"bad second format: "+fmt}case 90:switch(fmt){case"[h]":case"[hh]":out=24*val.D+val.H;break;case"[m]":case"[mm]":out=60*(24*val.D+val.H)+val.M;break;case"[s]":case"[ss]":out=60*(60*(24*val.D+val.H)+val.M)+Math.round(val.S+val.u);break;default:throw"bad abstime format: "+fmt}outl=3===fmt.length?1:2;break;case 101:out=y,outl=1}return outl>0?pad0(out,outl):""}function commaify(s){if(s.length<=3)return s;for(var j=s.length%3,o=s.substr(0,j);j!=s.length;j+=3)o+=(o.length>0?",":"")+s.substr(j,3);return o}SSF._general_num=general_fmt_num,SSF._general=general_fmt,SSF.parse_date_code=parse_date_code;var write_num=function(){var pct1=/%/g;var frac1=/# (\?+)( ?)\/( ?)(\d+)/;var dec1=/^#*0*\.(0+)/,closeparen=/\).*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(str){for(var cc,o="",i=0;i!=str.length;++i)switch(cc=str.charCodeAt(i)){case 35:break;case 63:o+=" ";break;case 48:o+="0";break;default:o+=String.fromCharCode(cc)}return o}function rnd(val,d){var dd=Math.pow(10,d);return""+Math.round(val*dd)/dd}function dec(val,d){return Math.round((val-Math.floor(val))*Math.pow(10,d))}function write_num_flt(type,fmt,val){if(40===type.charCodeAt(0)&&!fmt.match(closeparen)){var ffmt=fmt.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return val>=0?write_num_flt("n",ffmt,val):"("+write_num_flt("n",ffmt,-val)+")"}if(44===fmt.charCodeAt(fmt.length-1))return function(type,fmt,val){for(var idx=fmt.length-1;44===fmt.charCodeAt(idx-1);)--idx;return write_num(type,fmt.substr(0,idx),val/Math.pow(10,3*(fmt.length-idx)))}(type,fmt,val);if(-1!==fmt.indexOf("%"))return function(type,fmt,val){var sfmt=fmt.replace(pct1,""),mul=fmt.length-sfmt.length;return write_num(type,sfmt,val*Math.pow(10,2*mul))+fill("%",mul)}(type,fmt,val);if(-1!==fmt.indexOf("E"))return function(fmt,val){var o,idx=fmt.indexOf("E")-fmt.indexOf(".")-1;if(fmt.match(/^#+0.0E\+0$/)){var period=fmt.indexOf(".");-1===period&&(period=fmt.indexOf("E"));var ee=Math.floor(Math.log(Math.abs(val))*Math.LOG10E)%period;if(ee<0&&(ee+=period),-1===(o=(val/Math.pow(10,ee)).toPrecision(idx+1+(period+ee)%period)).indexOf("e")){var fakee=Math.floor(Math.log(Math.abs(val))*Math.LOG10E);for(-1===o.indexOf(".")?o=o[0]+"."+o.substr(1)+"E+"+(fakee-o.length+ee):o+="E+"+(fakee-ee);"0."===o.substr(0,2);)o=(o=o[0]+o.substr(2,period)+"."+o.substr(2+period)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");o=o.replace(/\+-/,"-")}o=o.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function($$,$1,$2,$3){return $1+$2+$3.substr(0,(period+ee)%period)+"."+$3.substr(ee)+"E"})}else o=val.toExponential(idx);return fmt.match(/E\+00$/)&&o.match(/e[+-]\d$/)&&(o=o.substr(0,o.length-1)+"0"+o[o.length-1]),fmt.match(/E\-/)&&o.match(/e\+/)&&(o=o.replace(/e\+/,"e")),o.replace("e","E")}(fmt,val);if(36===fmt.charCodeAt(0))return"$"+write_num_flt(type,fmt.substr(" "==fmt[1]?2:1),val);var o,r,ri,ff,aval=Math.abs(val),sign=val<0?"-":"";if(fmt.match(/^00+$/))return sign+pad0r(aval,fmt.length);if(fmt.match(/^[#?]+$/))return"0"===(o=pad0r(val,0))&&(o=""),o.length>fmt.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;if(null!==(r=fmt.match(frac1)))return function(r,aval,sign){var den=parseInt(r[4]),rr=Math.round(aval*den),base=Math.floor(rr/den),myn=rr-base*den,myd=den;return sign+(0===base?"":""+base)+" "+(0===myn?fill(" ",r[1].length+1+r[4].length):pad_(myn,r[1].length)+r[2]+"/"+r[3]+pad0(myd,r[4].length))}(r,aval,sign);if(null!==fmt.match(/^#+0+$/))return sign+pad0r(aval,fmt.length-fmt.indexOf("0"));if(null!==(r=fmt.match(dec1)))return o=rnd(val,r[1].length).replace(/^([^\.]+)$/,"$1."+r[1]).replace(/\.$/,"."+r[1]).replace(/\.(\d*)$/,function($$,$1){return"."+$1+fill("0",r[1].length-$1.length)}),-1!==fmt.indexOf("0.")?o:o.replace(/^0\./,".");if(fmt=fmt.replace(/^#+([0.])/,"$1"),null!==(r=fmt.match(/^(0*)\.(#*)$/)))return sign+rnd(aval,r[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,r[1].length?"0.":".");if(null!==(r=fmt.match(/^#,##0(\.?)$/)))return sign+commaify(pad0r(aval,0));if(null!==(r=fmt.match(/^#,##0\.([#0]*0)$/)))return val<0?"-"+write_num_flt(type,fmt,-val):commaify(""+Math.floor(val))+"."+pad0(dec(val,r[1].length),r[1].length);if(null!==(r=fmt.match(/^#,#*,#0/)))return write_num_flt(type,fmt.replace(/^#,#*,/,""),val);if(null!==(r=fmt.match(/^([0#]+)(\\?-([0#]+))+$/)))return o=_strrev(write_num_flt(type,fmt.replace(/[\\-]/g,""),val)),ri=0,_strrev(_strrev(fmt.replace(/\\/g,"")).replace(/[0#]/g,function(x){return ri<o.length?o[ri++]:"0"===x?"0":""}));if(null!==fmt.match(phone))return"("+(o=write_num_flt(type,"##########",val)).substr(0,3)+") "+o.substr(3,3)+"-"+o.substr(6);var oa="";if(null!==(r=fmt.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/)))return ri=Math.min(r[4].length,7),ff=frac(aval,Math.pow(10,ri)-1,!1),o=""+sign," "==(oa=write_num("n",r[1],ff[1]))[oa.length-1]&&(oa=oa.substr(0,oa.length-1)+"0"),o+=oa+r[2]+"/"+r[3],(oa=rpad_(ff[2],ri)).length<r[4].length&&(oa=hashq(r[4].substr(r[4].length-oa.length))+oa),o+=oa;if(null!==(r=fmt.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/)))return ri=Math.min(Math.max(r[1].length,r[4].length),7),sign+((ff=frac(aval,Math.pow(10,ri)-1,!0))[0]||(ff[1]?"":"0"))+" "+(ff[1]?pad_(ff[1],ri)+r[2]+"/"+r[3]+rpad_(ff[2],ri):fill(" ",2*ri+1+r[2].length+r[3].length));if(null!==(r=fmt.match(/^[#0?]+$/)))return o=pad0r(val,0),fmt.length<=o.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;if(null!==(r=fmt.match(/^([#0?]+)\.([#0]+)$/))){o=""+val.toFixed(Math.min(r[2].length,10)).replace(/([^0])0+$/,"$1"),ri=o.indexOf(".");var lres=fmt.indexOf(".")-ri,rres=fmt.length-o.length-lres;return hashq(fmt.substr(0,lres)+o+fmt.substr(fmt.length-rres))}if(null!==(r=fmt.match(/^00,000\.([#0]*0)$/)))return ri=dec(val,r[1].length),val<0?"-"+write_num_flt(type,fmt,-val):commaify(function(val){return val<2147483647&&val>-2147483648?""+(val>=0?0|val:val-1|0):""+Math.floor(val)}(val)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function($$){return"00,"+($$.length<3?pad0(0,3-$$.length):"")+$$})+"."+pad0(ri,r[1].length);switch(fmt){case"#,###":var x=commaify(pad0r(aval,0));return"0"!==x?sign+x:""}throw new Error("unsupported format |"+fmt+"|")}function write_num_int(type,fmt,val){if(40===type.charCodeAt(0)&&!fmt.match(closeparen)){var ffmt=fmt.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return val>=0?write_num_int("n",ffmt,val):"("+write_num_int("n",ffmt,-val)+")"}if(44===fmt.charCodeAt(fmt.length-1))return function(type,fmt,val){for(var idx=fmt.length-1;44===fmt.charCodeAt(idx-1);)--idx;return write_num(type,fmt.substr(0,idx),val/Math.pow(10,3*(fmt.length-idx)))}(type,fmt,val);if(-1!==fmt.indexOf("%"))return function(type,fmt,val){var sfmt=fmt.replace(pct1,""),mul=fmt.length-sfmt.length;return write_num(type,sfmt,val*Math.pow(10,2*mul))+fill("%",mul)}(type,fmt,val);if(-1!==fmt.indexOf("E"))return function(fmt,val){var o,idx=fmt.indexOf("E")-fmt.indexOf(".")-1;if(fmt.match(/^#+0.0E\+0$/)){var period=fmt.indexOf(".");-1===period&&(period=fmt.indexOf("E"));var ee=Math.floor(Math.log(Math.abs(val))*Math.LOG10E)%period;if(ee<0&&(ee+=period),!(o=(val/Math.pow(10,ee)).toPrecision(idx+1+(period+ee)%period)).match(/[Ee]/)){var fakee=Math.floor(Math.log(Math.abs(val))*Math.LOG10E);-1===o.indexOf(".")?o=o[0]+"."+o.substr(1)+"E+"+(fakee-o.length+ee):o+="E+"+(fakee-ee),o=o.replace(/\+-/,"-")}o=o.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function($$,$1,$2,$3){return $1+$2+$3.substr(0,(period+ee)%period)+"."+$3.substr(ee)+"E"})}else o=val.toExponential(idx);return fmt.match(/E\+00$/)&&o.match(/e[+-]\d$/)&&(o=o.substr(0,o.length-1)+"0"+o[o.length-1]),fmt.match(/E\-/)&&o.match(/e\+/)&&(o=o.replace(/e\+/,"e")),o.replace("e","E")}(fmt,val);if(36===fmt.charCodeAt(0))return"$"+write_num_int(type,fmt.substr(" "==fmt[1]?2:1),val);var o,r,ri,ff,aval=Math.abs(val),sign=val<0?"-":"";if(fmt.match(/^00+$/))return sign+pad0(aval,fmt.length);if(fmt.match(/^[#?]+$/))return o=""+val,0===val&&(o=""),o.length>fmt.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;if(null!==(r=fmt.match(frac1)))return function(r,aval,sign){return sign+(0===aval?"":""+aval)+fill(" ",r[1].length+2+r[4].length)}(r,aval,sign);if(null!==fmt.match(/^#+0+$/))return sign+pad0(aval,fmt.length-fmt.indexOf("0"));if(null!==(r=fmt.match(dec1)))return o=(""+val).replace(/^([^\.]+)$/,"$1."+r[1]).replace(/\.$/,"."+r[1]).replace(/\.(\d*)$/,function($$,$1){return"."+$1+fill("0",r[1].length-$1.length)}),-1!==fmt.indexOf("0.")?o:o.replace(/^0\./,".");if(fmt=fmt.replace(/^#+([0.])/,"$1"),null!==(r=fmt.match(/^(0*)\.(#*)$/)))return sign+(""+aval).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,r[1].length?"0.":".");if(null!==(r=fmt.match(/^#,##0(\.?)$/)))return sign+commaify(""+aval);if(null!==(r=fmt.match(/^#,##0\.([#0]*0)$/)))return val<0?"-"+write_num_int(type,fmt,-val):commaify(""+val)+"."+fill("0",r[1].length);if(null!==(r=fmt.match(/^#,#*,#0/)))return write_num_int(type,fmt.replace(/^#,#*,/,""),val);if(null!==(r=fmt.match(/^([0#]+)(\\?-([0#]+))+$/)))return o=_strrev(write_num_int(type,fmt.replace(/[\\-]/g,""),val)),ri=0,_strrev(_strrev(fmt.replace(/\\/g,"")).replace(/[0#]/g,function(x){return ri<o.length?o[ri++]:"0"===x?"0":""}));if(null!==fmt.match(phone))return"("+(o=write_num_int(type,"##########",val)).substr(0,3)+") "+o.substr(3,3)+"-"+o.substr(6);var oa="";if(null!==(r=fmt.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/)))return ri=Math.min(r[4].length,7),ff=frac(aval,Math.pow(10,ri)-1,!1),o=""+sign," "==(oa=write_num("n",r[1],ff[1]))[oa.length-1]&&(oa=oa.substr(0,oa.length-1)+"0"),o+=oa+r[2]+"/"+r[3],(oa=rpad_(ff[2],ri)).length<r[4].length&&(oa=hashq(r[4].substr(r[4].length-oa.length))+oa),o+=oa;if(null!==(r=fmt.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/)))return ri=Math.min(Math.max(r[1].length,r[4].length),7),sign+((ff=frac(aval,Math.pow(10,ri)-1,!0))[0]||(ff[1]?"":"0"))+" "+(ff[1]?pad_(ff[1],ri)+r[2]+"/"+r[3]+rpad_(ff[2],ri):fill(" ",2*ri+1+r[2].length+r[3].length));if(null!==(r=fmt.match(/^[#0?]+$/)))return o=""+val,fmt.length<=o.length?o:hashq(fmt.substr(0,fmt.length-o.length))+o;if(null!==(r=fmt.match(/^([#0]+)\.([#0]+)$/))){o=""+val.toFixed(Math.min(r[2].length,10)).replace(/([^0])0+$/,"$1"),ri=o.indexOf(".");var lres=fmt.indexOf(".")-ri,rres=fmt.length-o.length-lres;return hashq(fmt.substr(0,lres)+o+fmt.substr(fmt.length-rres))}if(null!==(r=fmt.match(/^00,000\.([#0]*0)$/)))return val<0?"-"+write_num_int(type,fmt,-val):commaify(""+val).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function($$){return"00,"+($$.length<3?pad0(0,3-$$.length):"")+$$})+"."+pad0(0,r[1].length);switch(fmt){case"#,###":var x=commaify(""+aval);return"0"!==x?sign+x:""}throw new Error("unsupported format |"+fmt+"|")}return function(type,fmt,val){return(0|val)===val?write_num_int(type,fmt,val):write_num_flt(type,fmt,val)}}();function split_fmt(fmt){for(var out=[],in_str=!1,i=0,j=0;i<fmt.length;++i)switch(fmt.charCodeAt(i)){case 34:in_str=!in_str;break;case 95:case 42:case 92:++i;break;case 59:out[out.length]=fmt.substr(j,i-j),j=i+1}if(out[out.length]=fmt.substr(j),!0===in_str)throw new Error("Format |"+fmt+"| unterminated string ");return out}SSF._split=split_fmt;var abstime=/\[[HhMmSs]*\]/;function eval_fmt(fmt,v,opts,flen){for(var q,dt,j,cc,out=[],o="",i=0,c="",lst="t",hr="H";i<fmt.length;)switch(c=fmt[i]){case"G":if(!isgeneral(fmt,i))throw new Error("unrecognized character "+c+" in "+fmt);out[out.length]={t:"G",v:"General"},i+=7;break;case'"':for(o="";34!==(cc=fmt.charCodeAt(++i))&&i<fmt.length;)o+=String.fromCharCode(cc);out[out.length]={t:"t",v:o},++i;break;case"\\":var w=fmt[++i],t="("===w||")"===w?w:"t";out[out.length]={t:t,v:w},++i;break;case"_":out[out.length]={t:"t",v:" "},i+=2;break;case"@":out[out.length]={t:"T",v:v},++i;break;case"B":case"b":if("1"===fmt[i+1]||"2"===fmt[i+1]){if(null==dt&&null==(dt=parse_date_code(v,opts,"2"===fmt[i+1])))return"";out[out.length]={t:"X",v:fmt.substr(i,2)},lst=c,i+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":c=c.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(v<0)return"";if(null==dt&&null==(dt=parse_date_code(v,opts)))return"";for(o=c;++i<fmt.length&&fmt[i].toLowerCase()===c;)o+=c;"m"===c&&"h"===lst.toLowerCase()&&(c="M"),"h"===c&&(c=hr),out[out.length]={t:c,v:o},lst=c;break;case"A":if(q={t:c,v:"A"},null==dt&&(dt=parse_date_code(v,opts)),"A/P"===fmt.substr(i,3)?(null!=dt&&(q.v=dt.H>=12?"P":"A"),q.t="T",hr="h",i+=3):"AM/PM"===fmt.substr(i,5)?(null!=dt&&(q.v=dt.H>=12?"PM":"AM"),q.t="T",i+=5,hr="h"):(q.t="t",++i),null==dt&&"T"===q.t)return"";out[out.length]=q,lst=c;break;case"[":for(o=c;"]"!==fmt[i++]&&i<fmt.length;)o+=fmt[i];if("]"!==o.substr(-1))throw'unterminated "[" block: |'+o+"|";if(o.match(abstime)){if(null==dt&&null==(dt=parse_date_code(v,opts)))return"";out[out.length]={t:"Z",v:o.toLowerCase()}}else o="";break;case".":if(null!=dt){for(o=c;"0"===(c=fmt[++i]);)o+=c;out[out.length]={t:"s",v:o};break}case"0":case"#":for(o=c;"0#?.,E+-%".indexOf(c=fmt[++i])>-1||"\\"==c&&"-"==fmt[i+1]&&"0#".indexOf(fmt[i+2])>-1;)o+=c;out[out.length]={t:"n",v:o};break;case"?":for(o=c;fmt[++i]===c;)o+=c;q={t:c,v:o},out[out.length]=q,lst=c;break;case"*":" "!=fmt[++i]&&"*"!=fmt[i]||++i;break;case"(":case")":out[out.length]={t:1===flen?"t":c,v:c},++i;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(o=c;"0123456789".indexOf(fmt[++i])>-1;)o+=fmt[i];out[out.length]={t:"D",v:o};break;case" ":out[out.length]={t:c,v:c},++i;break;default:if(-1===",$-+/():!^&'~{}<>=acfijklopqrtuvwxz".indexOf(c))throw new Error("unrecognized character "+c+" in "+fmt);out[out.length]={t:"t",v:c},++i}var ssm,bt=0,ss0=0;for(i=out.length-1,lst="t";i>=0;--i)switch(out[i].t){case"h":case"H":out[i].t=hr,lst="h",bt<1&&(bt=1);break;case"s":(ssm=out[i].v.match(/\.0+$/))&&(ss0=Math.max(ss0,ssm[0].length-1)),bt<3&&(bt=3);case"d":case"y":case"M":case"e":lst=out[i].t;break;case"m":"s"===lst&&(out[i].t="M",bt<2&&(bt=2));break;case"X":out[i].v;break;case"Z":bt<1&&out[i].v.match(/[Hh]/)&&(bt=1),bt<2&&out[i].v.match(/[Mm]/)&&(bt=2),bt<3&&out[i].v.match(/[Ss]/)&&(bt=3)}switch(bt){case 0:break;case 1:dt.u>=.5&&(dt.u=0,++dt.S),dt.S>=60&&(dt.S=0,++dt.M),dt.M>=60&&(dt.M=0,++dt.H);break;case 2:dt.u>=.5&&(dt.u=0,++dt.S),dt.S>=60&&(dt.S=0,++dt.M)}var jj,nstr="";for(i=0;i<out.length;++i)switch(out[i].t){case"t":case"T":case" ":case"D":break;case"X":out[i]=void 0;break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":out[i].v=write_date(out[i].t.charCodeAt(0),out[i].v,dt,ss0),out[i].t="t";break;case"n":case"(":case"?":for(jj=i+1;null!=out[jj]&&("?"===(c=out[jj].t)||"D"===c||(" "===c||"t"===c)&&null!=out[jj+1]&&("?"===out[jj+1].t||"t"===out[jj+1].t&&"/"===out[jj+1].v)||"("===out[i].t&&(" "===c||"n"===c||")"===c)||"t"===c&&("/"===out[jj].v||"$".indexOf(out[jj].v)>-1||" "===out[jj].v&&null!=out[jj+1]&&"?"==out[jj+1].t));)out[i].v+=out[jj].v,out[jj]=void 0,++jj;nstr+=out[i].v,i=jj-1;break;case"G":out[i].t="t",out[i].v=general_fmt(v,opts)}var myv,ostr,vv="";if(nstr.length>0){myv=v<0&&45===nstr.charCodeAt(0)?-v:v,jj=(ostr=write_num(40===nstr.charCodeAt(0)?"(":"n",nstr,myv)).length-1;var decpt=out.length;for(i=0;i<out.length;++i)if(null!=out[i]&&out[i].v.indexOf(".")>-1){decpt=i;break}var lasti=out.length;if(decpt===out.length&&-1===ostr.indexOf("E")){for(i=out.length-1;i>=0;--i)null!=out[i]&&-1!=="n?(".indexOf(out[i].t)&&(jj>=out[i].v.length-1?(jj-=out[i].v.length,out[i].v=ostr.substr(jj+1,out[i].v.length)):jj<0?out[i].v="":(out[i].v=ostr.substr(0,jj+1),jj=-1),out[i].t="t",lasti=i);jj>=0&&lasti<out.length&&(out[lasti].v=ostr.substr(0,jj+1)+out[lasti].v)}else if(decpt!==out.length&&-1===ostr.indexOf("E")){for(jj=ostr.indexOf(".")-1,i=decpt;i>=0;--i)if(null!=out[i]&&-1!=="n?(".indexOf(out[i].t)){for(j=out[i].v.indexOf(".")>-1&&i===decpt?out[i].v.indexOf(".")-1:out[i].v.length-1,vv=out[i].v.substr(j+1);j>=0;--j)jj>=0&&("0"===out[i].v[j]||"#"===out[i].v[j])&&(vv=ostr[jj--]+vv);out[i].v=vv,out[i].t="t",lasti=i}for(jj>=0&&lasti<out.length&&(out[lasti].v=ostr.substr(0,jj+1)+out[lasti].v),jj=ostr.indexOf(".")+1,i=decpt;i<out.length;++i)if(null!=out[i]&&(-1!=="n?(".indexOf(out[i].t)||i===decpt)){for(j=out[i].v.indexOf(".")>-1&&i===decpt?out[i].v.indexOf(".")+1:0,vv=out[i].v.substr(0,j);j<out[i].v.length;++j)jj<ostr.length&&(vv+=ostr[jj++]);out[i].v=vv,out[i].t="t",lasti=i}}}for(i=0;i<out.length;++i)null!=out[i]&&"n(?".indexOf(out[i].t)>-1&&(myv=flen>1&&v<0&&i>0&&"-"===out[i-1].v?-v:v,out[i].v=write_num(out[i].t,out[i].v,myv),out[i].t="t");var retval="";for(i=0;i!==out.length;++i)null!=out[i]&&(retval+=out[i].v);return retval}SSF._eval=eval_fmt;var cfregex=/\[[=<>]/,cfregex2=/\[([=<>]*)(-?\d+\.?\d*)\]/;function chkcond(v,rr){if(null==rr)return!1;var thresh=parseFloat(rr[2]);switch(rr[1]){case"=":if(v==thresh)return!0;break;case">":if(v>thresh)return!0;break;case"<":if(v<thresh)return!0;break;case"<>":if(v!=thresh)return!0;break;case">=":if(v>=thresh)return!0;break;case"<=":if(v<=thresh)return!0}return!1}SSF._table=table_fmt,SSF.load=function(fmt,idx){table_fmt[idx]=fmt},SSF.format=function(fmt,v,o){fixopts(null!=o?o:o=[]);var sfmt="";switch(typeof fmt){case"string":sfmt=fmt;break;case"number":sfmt=(null!=o.table?o.table:table_fmt)[fmt]}if(isgeneral(sfmt,0))return general_fmt(v,o);var f=function(f,v){var fmt=split_fmt(f),l=fmt.length,lat=fmt[l-1].indexOf("@");if(l<4&&lat>-1&&--l,fmt.length>4)throw"cannot find right format for |"+fmt+"|";if("number"!=typeof v)return[4,4===fmt.length||lat>-1?fmt[fmt.length-1]:"@"];switch(fmt.length){case 1:fmt=lat>-1?["General","General","General",fmt[0]]:[fmt[0],fmt[0],fmt[0],"@"];break;case 2:fmt=lat>-1?[fmt[0],fmt[0],fmt[0],fmt[1]]:[fmt[0],fmt[1],fmt[0],"@"];break;case 3:fmt=lat>-1?[fmt[0],fmt[1],fmt[0],fmt[2]]:[fmt[0],fmt[1],fmt[2],"@"]}var ff=v>0?fmt[0]:v<0?fmt[1]:fmt[2];if(-1===fmt[0].indexOf("[")&&-1===fmt[1].indexOf("["))return[l,ff];if(null!=fmt[0].match(cfregex)||null!=fmt[1].match(cfregex)){var m1=fmt[0].match(cfregex2),m2=fmt[1].match(cfregex2);return chkcond(v,m1)?[l,fmt[0]]:chkcond(v,m2)?[l,fmt[1]]:[l,fmt[null!=m1&&null!=m2?2:1]]}return[l,ff]}(sfmt,v);if(isgeneral(f[1]))return general_fmt(v,o);if(!0===v)v="TRUE";else if(!1===v)v="FALSE";else if(""===v||null==v)return"";return eval_fmt(f[1],v,o,f[0])},SSF.get_table=function(){return table_fmt},SSF.load_table=function(tbl){for(var i=0;392!=i;++i)void 0!==tbl[i]&&SSF.load(tbl[i],i)}};make_ssf(SSF);var _fs,jszip,XLMLFormatMap={"General Number":"General","General Date":SSF._table[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":SSF._table[15],"Short Date":SSF._table[14],"Long Time":SSF._table[19],"Medium Time":SSF._table[18],"Short Time":SSF._table[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:SSF._table[2],Standard:SSF._table[4],Percent:SSF._table[10],Scientific:SSF._table[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'},CFB=function(){var fs,exports={};function parse(file){var mver,nmfs,ndfs,dir_start,minifat_start,difat_start,ssz=512,fat_addrs=[],blob=file.slice(0,512);switch(prep_blob(blob,0),mver=function(blob){blob.chk(HEADER_SIGNATURE,"Header Signature: "),blob.chk(HEADER_CLSID,"CLSID: ");var mver=blob.read_shift(2,"u");return[blob.read_shift(2,"u"),mver]}(blob)[0]){case 3:ssz=512;break;case 4:ssz=4096;break;default:throw"Major Version: Expected 3 or 4 saw "+mver}512!==ssz&&prep_blob(blob=file.slice(0,ssz),28);var header=file.slice(0,ssz);!function(blob,mver){var shift=9;switch(blob.chk("feff","Byte Order: "),shift=blob.read_shift(2)){case 9:if(3!==mver)throw"MajorVersion/SectorShift Mismatch";break;case 12:if(4!==mver)throw"MajorVersion/SectorShift Mismatch";break;default:throw"Sector Shift: Expected 9 or 12 saw "+shift}blob.chk("0600","Mini Sector Shift: "),blob.chk("000000000000","Reserved: ")}(blob,mver);var nds=blob.read_shift(4,"i");if(3===mver&&0!==nds)throw"# Directory Sectors: Expected 0 saw "+nds;blob.l+=4,dir_start=blob.read_shift(4,"i"),blob.l+=4,blob.chk("00100000","Mini Stream Cutoff Size: "),minifat_start=blob.read_shift(4,"i"),nmfs=blob.read_shift(4,"i"),difat_start=blob.read_shift(4,"i"),ndfs=blob.read_shift(4,"i");for(var q,j=0;j<109&&!((q=blob.read_shift(4,"i"))<0);++j)fat_addrs[j]=q;var sectors=function(file,ssz){for(var nsectors=Math.ceil(file.length/ssz)-1,sectors=new Array(nsectors),i=1;i<nsectors;++i)sectors[i-1]=file.slice(i*ssz,(i+1)*ssz);return sectors[nsectors-1]=file.slice(nsectors*ssz),sectors}(file,ssz);!function sleuth_fat(idx,cnt,sectors,ssz,fat_addrs){var q;if(idx===ENDOFCHAIN){if(0!==cnt)throw"DIFAT chain shorter than expected"}else if(-1!==idx){for(var sector=sectors[idx],m=(ssz>>>2)-1,i=0;i<m&&(q=__readInt32LE(sector,4*i))!==ENDOFCHAIN;++i)fat_addrs.push(q);sleuth_fat(__readInt32LE(sector,ssz-4),cnt-1,sectors,ssz,fat_addrs)}}(difat_start,ndfs,sectors,ssz,fat_addrs);var sector_list=function(sectors,dir_start,fat_addrs,ssz){var buf,buf_chain,i,j,k,jj,sl=sectors.length,sector_list=new Array(sl),chkd=new Array(sl),modulus=ssz-1;for(i=0;i<sl;++i)if(buf=[],(k=i+dir_start)>=sl&&(k-=sl),!0!==chkd[k]){for(buf_chain=[],j=k;j>=0;){chkd[j]=!0,buf[buf.length]=j,buf_chain.push(sectors[j]);var addr=fat_addrs[Math.floor(4*j/ssz)];if(ssz<4+(jj=4*j&modulus))throw"FAT boundary crossed: "+j+" 4 "+ssz;j=__readInt32LE(sectors[addr],jj)}sector_list[k]={nodes:buf,data:__toBuffer([buf_chain])}}return sector_list}(sectors,dir_start,fat_addrs,ssz);sector_list[dir_start].name="!Directory",nmfs>0&&minifat_start!==ENDOFCHAIN&&(sector_list[minifat_start].name="!MiniFAT"),sector_list[fat_addrs[0]].name="!FAT",sector_list.fat_addrs=fat_addrs,sector_list.ssz=ssz;var files={},Paths=[],FileIndex=[],FullPaths=[],FullPathDir={};!function(dir_start,sector_list,sectors,Paths,nmfs,files,FileIndex){for(var blob,name,o,ctime,mtime,minifat_store=0,pl=Paths.length?2:0,sector=sector_list[dir_start].data,i=0,namelen=0;i<sector.length;i+=128)prep_blob(blob=sector.slice(i,i+128),64),0!==(namelen=blob.read_shift(2))&&(name=__utf16le(blob,0,namelen-pl),Paths.push(name),o={name:name,type:blob.read_shift(1),color:blob.read_shift(1),L:blob.read_shift(4,"i"),R:blob.read_shift(4,"i"),C:blob.read_shift(4,"i"),clsid:blob.read_shift(16),state:blob.read_shift(4,"i")},0!==(ctime=blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2))&&(o.ctime=ctime,o.ct=read_date(blob,blob.l-8)),0!==(mtime=blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2)+blob.read_shift(2))&&(o.mtime=mtime,o.mt=read_date(blob,blob.l-8)),o.start=blob.read_shift(4,"i"),o.size=blob.read_shift(4,"i"),5===o.type?(minifat_store=o.start,nmfs>0&&minifat_store!==ENDOFCHAIN&&(sector_list[minifat_store].name="!StreamData")):o.size>=4096?(o.storage="fat",void 0===sector_list[o.start]&&(sector_list[o.start]=get_sector_list(sectors,o.start,sector_list.fat_addrs,sector_list.ssz)),sector_list[o.start].name=o.name,o.content=sector_list[o.start].data.slice(0,o.size),prep_blob(o.content,0)):(o.storage="minifat",minifat_store!==ENDOFCHAIN&&o.start!==ENDOFCHAIN&&(o.content=sector_list[minifat_store].data.slice(o.start*MSSZ,o.start*MSSZ+o.size),prep_blob(o.content,0))),files[name]=o,FileIndex.push(o))}(dir_start,sector_list,sectors,Paths,nmfs,files,FileIndex),function(FI,FPD,FP,Paths){for(var i=0,L=0,R=0,C=0,j=0,pl=Paths.length,dad=new Array(pl),q=new Array(pl);i<pl;++i)dad[i]=q[i]=i,FP[i]=Paths[i];for(;j<q.length;++j)i=q[j],L=FI[i].L,R=FI[i].R,C=FI[i].C,dad[i]===i&&(-1!==L&&dad[L]!==L&&(dad[i]=dad[L]),-1!==R&&dad[R]!==R&&(dad[i]=dad[R])),-1!==C&&(dad[C]=i),-1!==L&&(dad[L]=dad[i],q.push(L)),-1!==R&&(dad[R]=dad[i],q.push(R));for(i=1;i!==pl;++i)dad[i]===i&&(-1!==R&&dad[R]!==R?dad[i]=dad[R]:-1!==L&&dad[L]!==L&&(dad[i]=dad[L]));for(i=1;i<pl;++i)if(0!==FI[i].type){if(0===(j=dad[i]))FP[i]=FP[0]+"/"+FP[i];else for(;0!==j;)FP[i]=FP[j]+"/"+FP[i],j=dad[j];dad[i]=0}for(FP[0]+="/",i=1;i<pl;++i)2!==FI[i].type&&(FP[i]+="/"),FPD[FP[i]]=FI[i]}(FileIndex,FullPathDir,FullPaths,Paths);var root_name=Paths.shift();return Paths.root=root_name,{raw:{header:header,sectors:sectors},FileIndex:FileIndex,FullPaths:FullPaths,FullPathDir:FullPathDir,find:function(FullPaths,Paths,FileIndex,files,root_name){var i,UCFullPaths=new Array(FullPaths.length),UCPaths=new Array(Paths.length);for(i=0;i<FullPaths.length;++i)UCFullPaths[i]=FullPaths[i].toUpperCase().replace(chr0,"").replace(chr1,"!");for(i=0;i<Paths.length;++i)UCPaths[i]=Paths[i].toUpperCase().replace(chr0,"").replace(chr1,"!");return function(path){var k;47===path.charCodeAt(0)?(k=!0,path=root_name+path):k=-1!==path.indexOf("/");var UCPath=path.toUpperCase().replace(chr0,"").replace(chr1,"!"),w=!0===k?UCFullPaths.indexOf(UCPath):UCPaths.indexOf(UCPath);return-1===w?null:!0===k?FileIndex[w]:files[Paths[w]]}}(FullPaths,Paths,FileIndex,files,root_name)}}function get_sector_list(sectors,start,fat_addrs,ssz,chkd){var buf,buf_chain,sl=sectors.length;chkd||(chkd=new Array(sl));var j,jj,modulus=ssz-1;for(buf=[],buf_chain=[],j=start;j>=0;){chkd[j]=!0,buf[buf.length]=j,buf_chain.push(sectors[j]);var addr=fat_addrs[Math.floor(4*j/ssz)];if(ssz<4+(jj=4*j&modulus))throw"FAT boundary crossed: "+j+" 4 "+ssz;j=__readInt32LE(sectors[addr],jj)}return{nodes:buf,data:__toBuffer([buf_chain])}}function read_date(blob,offset){return new Date(1e3*(__readUInt32LE(blob,offset+4)/1e7*Math.pow(2,32)+__readUInt32LE(blob,offset)/1e7-11644473600))}exports.version="0.10.2";var MSSZ=64,ENDOFCHAIN=-2,HEADER_SIGNATURE="d0cf11e0a1b11ae1",HEADER_CLSID="00000000000000000000000000000000",consts={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:ENDOFCHAIN,FREESECT:-1,HEADER_SIGNATURE:HEADER_SIGNATURE,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:HEADER_CLSID,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};return exports.read=function(blob,options){switch(void 0!==options&&void 0!==options.type?options.type:"base64"){case"file":return filename=blob,void 0===fs&&(fs=require("fs")),parse(fs.readFileSync(filename));case"base64":return parse(s2a(Base64.decode(blob)));case"binary":return parse(s2a(blob))}var filename;return parse(blob)},exports.parse=parse,exports.utils={ReadShift:ReadShift,CheckField:CheckField,prep_blob:prep_blob,bconcat:bconcat,consts:consts},exports}();function isval(x){return void 0!==x&&null!==x}function keys(o){return Object.keys(o)}function evert_num(obj){for(var o=[],K=keys(obj),i=0;i!==K.length;++i)o[obj[K[i]]]=parseInt(K[i],10);return o}function datenum(v,date1904){return date1904&&(v+=1462),(Date.parse(v)+22091616e5)/864e5}function getdata(data){if(!data)return null;if(".bin"===data.name.substr(-4)){if(data.data)return char_codes(data.data);if(data.asNodeBuffer&&has_buf)return data.asNodeBuffer();if(data._data&&data._data.getContent)return Array.prototype.slice.call(data._data.getContent())}else{if(data.data)return".bin"!==data.name.substr(-4)?debom_xml(data.data):char_codes(data.data);if(data.asNodeBuffer&&has_buf)return debom_xml(data.asNodeBuffer().toString("binary"));if(data.asBinary)return debom_xml(data.asBinary());if(data._data&&data._data.getContent)return debom_xml(function(arr){for(var o="",i=0;i!=arr.length;++i)o+=String.fromCharCode(arr[i]);return o}(Array.prototype.slice.call(data._data.getContent(),0)))}return null}function safegetzipfile(zip,file){var f=file;return zip.files[f]?zip.files[f]:(f=file.toLowerCase(),zip.files[f]?zip.files[f]:(f=f.replace(/\//g,"\\"),zip.files[f]?zip.files[f]:null))}function getzipfile(zip,file){var o=safegetzipfile(zip,file);if(null==o)throw new Error("Cannot find file "+file+" in zip");return o}function getzipdata(zip,file,safe){if(!safe)return getdata(getzipfile(zip,file));if(!file)return null;try{return getzipdata(zip,file)}catch(e){return null}}"undefined"!=typeof JSZip&&(jszip=JSZip),"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(has_buf&&void 0===jszip&&(jszip=require("jszip")),void 0===jszip&&(jszip=require("./jszip").JSZip),_fs=require("fs"));var attregexg=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,tagregex=/<[^>]*>/g,nsregex=/<\w*:/,nsregex2=/<(\/?)\w+:/;function parsexmltag(tag,skip_root){for(var z=[],eq=0,c=0;eq!==tag.length&&(32!==(c=tag.charCodeAt(eq))&&10!==c&&13!==c);++eq);if(skip_root||(z[0]=tag.substr(0,eq)),eq===tag.length)return z;var m=tag.match(attregexg),j=0,v="",i=0,q="",cc="";if(m)for(i=0;i!=m.length;++i){for(cc=m[i],c=0;c!=cc.length&&61!==cc.charCodeAt(c);++c);for(q=cc.substr(0,c),v=cc.substring(c+2,cc.length-1),j=0;j!=q.length&&58!==q.charCodeAt(j);++j);j===q.length?z[q]=v:z[(5===j&&"xmlns"===q.substr(0,5)?"xmlns":"")+q.substr(j+1)]=v}return z}var encregex,coderegex,encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=function(obj){for(var o=[],K=keys(obj),i=0;i!==K.length;++i)o[obj[K[i]]]=K[i];return o}(encodings),unescapexml=("&<>'\"".split(""),encregex=/&[a-z]*;/g,coderegex=/_x([\da-fA-F]+)_/g,function(text){return(text+"").replace(encregex,function($$){return encodings[$$]}).replace(coderegex,function(m,c){return String.fromCharCode(parseInt(c,16))})}),decregex=/[&<>'"]/g,charegex=/[\u0000-\u0008\u000b-\u001f]/g;function escapexml(text){return(text+"").replace(decregex,function(y){return rencoding[y]}).replace(charegex,function(s){return"_x"+("000"+s.charCodeAt(0).toString(16)).substr(-4)+"_"})}var xlml_fixstr=function(){var entregex=/&#(\d+);/g;function entrepl($$,$1){return String.fromCharCode(parseInt($1,10))}return function(str){return str.replace(entregex,entrepl)}}();function parsexmlbool(value,tag){switch(value){case"1":case"true":case"TRUE":return!0;default:return!1}}var utf8read=function(orig){for(var out="",i=0,c=0,d=0,e=0,w=0;i<orig.length;)(c=orig.charCodeAt(i++))<128?out+=String.fromCharCode(c):(d=orig.charCodeAt(i++),c>191&&c<224?out+=String.fromCharCode((31&c)<<6|63&d):(e=orig.charCodeAt(i++),c<240?out+=String.fromCharCode((15&c)<<12|(63&d)<<6|63&e):(w=((7&c)<<18|(63&d)<<12|(63&e)<<6|63&orig.charCodeAt(i++))-65536,out+=String.fromCharCode(55296+(w>>>10&1023)),out+=String.fromCharCode(56320+(1023&w)))));return out};if(has_buf){var utf8readb=function(data){var w,i,c,out=new Buffer(2*data.length),j=1,k=0,ww=0;for(i=0;i<data.length;i+=j)j=1,(c=data.charCodeAt(i))<128?w=c:c<224?(w=64*(31&c)+(63&data.charCodeAt(i+1)),j=2):c<240?(w=4096*(15&c)+64*(63&data.charCodeAt(i+1))+(63&data.charCodeAt(i+2)),j=3):(j=4,w=262144*(7&c)+4096*(63&data.charCodeAt(i+1))+64*(63&data.charCodeAt(i+2))+(63&data.charCodeAt(i+3)),ww=55296+((w-=65536)>>>10&1023),w=56320+(1023&w)),0!==ww&&(out[k++]=255&ww,out[k++]=ww>>>8,ww=0),out[k++]=w%256,out[k++]=w>>>8;return out.length=k,out.toString("ucs2")},corpus="foo bar baz";utf8read(corpus)==utf8readb(corpus)&&(utf8read=utf8readb);var utf8readc=function(data){return Buffer(data,"binary").toString("utf8")};utf8read(corpus)==utf8readc(corpus)&&(utf8read=utf8readc)}var mtcache,vt_cache,matchtag=(mtcache={},function(f,g){var t=f+"|"+g;return void 0!==mtcache[t]?mtcache[t]:mtcache[t]=new RegExp("<(?:\\w+:)?"+f+'(?: xml:space="preserve")?(?:[^>]*)>([^]*)</(?:\\w+:)?'+f+">",g||"")}),vtregex=(vt_cache={},function(bt){return void 0!==vt_cache[bt]?vt_cache[bt]:vt_cache[bt]=new RegExp("<vt:"+bt+">(.*?)</vt:"+bt+">","g")}),vtvregex=/<\/?vt:variant>/g,vtmregex=/<vt:([^>]*)>(.*)</;function parseVector(data){var h=parsexmltag(data),matches=data.match(vtregex(h.baseType))||[];if(matches.length!=h.size)throw"unexpected vector length "+matches.length+" != "+h.size;var res=[];return matches.forEach(function(x){var v=x.replace(vtvregex,"").match(vtmregex);res.push({v:v[2],t:v[1]})}),res}var wtregex=/(^\s|\s$|\n)/;function writetag(f,g){return"<"+f+(g.match(wtregex)?' xml:space="preserve"':"")+">"+g+"</"+f+">"}function writextag(f,g,h){return"<"+f+(isval(h)?function(h){return keys(h).map(function(k){return" "+k+'="'+h[k]+'"'}).join("")}(h):"")+(isval(g)?(g.match(wtregex)?' xml:space="preserve"':"")+">"+g+"</"+f:"/")+">"}function write_w3cdtf(d,t){try{return d.toISOString().replace(/\.\d*/,"")}catch(e){if(t)throw e}}var __toBuffer,___toBuffer,__utf16le,___utf16le,__hexlify,___hexlify,__utf8,__lpstr,___lpstr,__lpwstr,___lpwstr,__double,___double,XML_HEADER='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n',XMLNS={dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"};XMLNS.main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],__toBuffer=___toBuffer=function(bufs){for(var x=[],i=0;i<bufs[0].length;++i)x.push.apply(x,bufs[0][i]);return x},__utf16le=___utf16le=function(b,s,e){for(var ss=[],i=s;i<e;i+=2)ss.push(String.fromCharCode(__readUInt16LE(b,i)));return ss.join("")},__hexlify=___hexlify=function(b,s,l){return b.slice(s,s+l).map(function(x){return(x<16?"0":"")+x.toString(16)}).join("")},__utf8=function(b,s,e){for(var ss=[],i=s;i<e;i++)ss.push(String.fromCharCode(__readUInt8(b,i)));return ss.join("")},__lpstr=___lpstr=function(b,i){var len=__readUInt32LE(b,i);return len>0?__utf8(b,i+4,i+4+len-1):""},__lpwstr=___lpwstr=function(b,i){var len=2*__readUInt32LE(b,i);return len>0?__utf8(b,i+4,i+4+len-1):""},__double=___double=function(b,idx){return function(buf,idx,isLE,nl,ml){void 0===isLE&&(isLE=!0),nl||(nl=8),ml||8!==nl||(ml=52);var e,m,el=8*nl-ml-1,eMax=(1<<el)-1,eBias=eMax>>1,bits=-7,d=isLE?-1:1,i=isLE?nl-1:0,s=buf[idx+i];for(i+=d,e=s&(1<<-bits)-1,s>>>=-bits,bits+=el;bits>0;e=256*e+buf[idx+i],i+=d,bits-=8);for(m=e&(1<<-bits)-1,e>>>=-bits,bits+=ml;bits>0;m=256*m+buf[idx+i],i+=d,bits-=8);return e===eMax?m?NaN:1/0*(s?-1:1):(0===e?e=1-eBias:(m+=Math.pow(2,ml),e-=eBias),(s?-1:1)*m*Math.pow(2,e-ml))}(b,idx)};var is_buf=function(a){return Array.isArray(a)};has_buf&&(__utf16le=function(b,s,e){return Buffer.isBuffer(b)?b.toString("utf16le",s,e):___utf16le(b,s,e)},__hexlify=function(b,s,l){return Buffer.isBuffer(b)?b.toString("hex",s,s+l):___hexlify(b,s,l)},__lpstr=function(b,i){if(!Buffer.isBuffer(b))return ___lpstr(b,i);var len=b.readUInt32LE(i);return len>0?b.toString("utf8",i+4,i+4+len-1):""},__lpwstr=function(b,i){if(!Buffer.isBuffer(b))return ___lpwstr(b,i);var len=2*b.readUInt32LE(i);return b.toString("utf16le",i+4,i+4+len-1)},__utf8=function(s,e){return this.toString("utf8",s,e)},__toBuffer=function(bufs){return bufs[0].length>0&&Buffer.isBuffer(bufs[0][0])?Buffer.concat(bufs[0]):___toBuffer(bufs)},bconcat=function(bufs){return Buffer.isBuffer(bufs[0])?Buffer.concat(bufs):[].concat.apply([],bufs)},__double=function(b,i){return Buffer.isBuffer(b)?b.readDoubleLE(i):___double(b,i)},is_buf=function(a){return Buffer.isBuffer(a)||Array.isArray(a)}),void 0!==cptable&&(__utf16le=function(b,s,e){return cptable.utils.decode(1200,b.slice(s,e))},__utf8=function(b,s,e){return cptable.utils.decode(65001,b.slice(s,e))},__lpstr=function(b,i){var len=__readUInt32LE(b,i);return len>0?cptable.utils.decode(current_codepage,b.slice(i+4,i+4+len-1)):""},__lpwstr=function(b,i){var len=2*__readUInt32LE(b,i);return len>0?cptable.utils.decode(1200,b.slice(i+4,i+4+len-1)):""});var __readUInt8=function(b,idx){return b[idx]},__readUInt16LE=function(b,idx){return 256*b[idx+1]+b[idx]},__readInt16LE=function(b,idx){var u=256*b[idx+1]+b[idx];return u<32768?u:-1*(65535-u+1)},__readUInt32LE=function(b,idx){return b[idx+3]*(1<<24)+(b[idx+2]<<16)+(b[idx+1]<<8)+b[idx]},__readInt32LE=function(b,idx){return b[idx+3]<<24|b[idx+2]<<16|b[idx+1]<<8|b[idx]},___unhexlify=function(s){return s.match(/../g).map(function(x){return parseInt(x,16)})};function ReadShift(size,t){var oI,oR,w,vv,i,loc,o="",oo=[];switch(t){case"dbcs":if(loc=this.l,has_buf&&Buffer.isBuffer(this))o=this.slice(this.l,this.l+2*size).toString("utf16le");else for(i=0;i!=size;++i)o+=String.fromCharCode(__readUInt16LE(this,loc)),loc+=2;size*=2;break;case"utf8":o=__utf8(this,this.l,this.l+size);break;case"utf16le":size*=2,o=__utf16le(this,this.l,this.l+size);break;case"lpstr":size=5+(o=__lpstr(this,this.l)).length;break;case"lpwstr":size=5+(o=__lpwstr(this,this.l)).length,"\0"==o[o.length-1]&&(size+=2);break;case"cstr":for(size=0,o="";0!==(w=__readUInt8(this,this.l+size++));)oo.push(_getchar(w));o=oo.join("");break;case"wstr":for(size=0,o="";0!==(w=__readUInt16LE(this,this.l+size));)oo.push(_getchar(w)),size+=2;size+=2,o=oo.join("");break;case"dbcs-cont":for(o="",loc=this.l,i=0;i!=size;++i){if(this.lens&&-1!==this.lens.indexOf(loc))return w=__readUInt8(this,loc),this.l=loc+1,vv=ReadShift.call(this,size-i,w?"dbcs-cont":"sbcs-cont"),oo.join("")+vv;oo.push(_getchar(__readUInt16LE(this,loc))),loc+=2}o=oo.join(""),size*=2;break;case"sbcs-cont":for(o="",loc=this.l,i=0;i!=size;++i){if(this.lens&&-1!==this.lens.indexOf(loc))return w=__readUInt8(this,loc),this.l=loc+1,vv=ReadShift.call(this,size-i,w?"dbcs-cont":"sbcs-cont"),oo.join("")+vv;oo.push(_getchar(__readUInt8(this,loc))),loc+=1}o=oo.join("");break;default:switch(size){case 1:return oI=__readUInt8(this,this.l),this.l++,oI;case 2:return oI=("i"===t?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,oI;case 4:return"i"===t||0==(128&this[this.l+3])?(oI=__readInt32LE(this,this.l),this.l+=4,oI):(oR=__readUInt32LE(this,this.l),this.l+=4,oR);case 8:if("f"===t)return oR=__double(this,this.l),this.l+=8,oR;case 16:o=__hexlify(this,this.l,size)}}return this.l+=size,o}function WriteShift(t,val,f){var size,i;if("dbcs"===f){for(i=0;i!=val.length;++i)this.writeUInt16LE(val.charCodeAt(i),this.l+2*i);size=2*val.length}else switch(t){case 1:size=1,this[this.l]=255&val;break;case 3:size=3,this[this.l+2]=255&val,val>>>=8,this[this.l+1]=255&val,val>>>=8,this[this.l]=255&val;break;case 4:size=4,this.writeUInt32LE(val,this.l);break;case 8:if(size=8,"f"===f){this.writeDoubleLE(val,this.l);break}case 16:break;case-4:size=4,this.writeInt32LE(val,this.l)}return this.l+=size,this}function CheckField(hexstr,fld){var m=__hexlify(this,this.l,hexstr.length>>1);if(m!==hexstr)throw fld+"Expected "+hexstr+" saw "+m;this.l+=hexstr.length>>1}function prep_blob(blob,pos){blob.l=pos,blob.read_shift=ReadShift,blob.chk=CheckField,blob.write_shift=WriteShift}function parsenoop(blob,length){blob.l+=length}function new_buf(sz){var o=new_raw_buf(sz);return prep_blob(o,0),o}function recordhopper(data,cb,opts){var tmpbyte,cntbyte,length;for(prep_blob(data,data.l||0);data.l<data.length;){var RT=data.read_shift(1);128&RT&&(RT=(127&RT)+((127&data.read_shift(1))<<7));var R=XLSBRecordEnum[RT]||XLSBRecordEnum[65535];for(length=127&(tmpbyte=data.read_shift(1)),cntbyte=1;cntbyte<4&&128&tmpbyte;++cntbyte)length+=(127&(tmpbyte=data.read_shift(1)))<<7*cntbyte;if(cb(R.f(data,length,opts),R,RT))return}}function buf_array(){var bufs=[],newblk=function(sz){var o=new_buf(sz);return prep_blob(o,0),o},curbuf=newblk(2048),endbuf=function(){curbuf.length=curbuf.l,curbuf.length>0&&bufs.push(curbuf),curbuf=null},next=function(sz){return sz<curbuf.length-curbuf.l?curbuf:(endbuf(),curbuf=newblk(Math.max(sz+1,2048)))};return{next:next,push:function(buf){endbuf(),curbuf=buf,next(2048)},end:function(){return endbuf(),__toBuffer([bufs])},_bufs:bufs}}function write_record(ba,type,payload,length){var l,t=evert_RE[type];length||(length=XLSBRecordEnum[t].p||(payload||[]).length||0),l=1+(t>=128?1:0)+1+length,length>=128&&++l,length>=16384&&++l,length>=2097152&&++l;var o=ba.next(l);t<=127?o.write_shift(1,t):(o.write_shift(1,128+(127&t)),o.write_shift(1,t>>7));for(var i=0;4!=i;++i){if(!(length>=128)){o.write_shift(1,length);break}o.write_shift(1,128+(127&length)),length>>=7}length>0&&is_buf(payload)&&ba.push(payload)}function shift_cell_xls(cell,tgt){for(tgt.s?(cell.cRel&&(cell.c+=tgt.s.c),cell.rRel&&(cell.r+=tgt.s.r)):(cell.c+=tgt.c,cell.r+=tgt.r),cell.cRel=cell.rRel=0;cell.c>=256;)cell.c-=256;for(;cell.r>=65536;)cell.r-=65536;return cell}function shift_range_xls(cell,range){return cell.s=shift_cell_xls(cell.s,range.s),cell.e=shift_cell_xls(cell.e,range.s),cell}function parse_StrRun(data,length){return{ich:data.read_shift(2),ifnt:data.read_shift(2)}}function parse_RichStr(data,length){var start=data.l,flags=data.read_shift(1),str=parse_XLWideString(data),rgsStrRun=[],z={t:str,h:str};if(0!=(1&flags)){for(var dwSizeStrRun=data.read_shift(4),i=0;i!=dwSizeStrRun;++i)rgsStrRun.push(parse_StrRun(data));z.r=rgsStrRun}else z.r="<t>"+escapexml(str)+"</t>";return data.l=start+length,z}function parse_XLSBCell(data){var col=data.read_shift(4),iStyleRef=data.read_shift(2);iStyleRef+=data.read_shift(1)<<16;data.read_shift(1);return{c:col,iStyleRef:iStyleRef}}function parse_XLNullableWideString(data){var cchCharacters=data.read_shift(4);return 0===cchCharacters||4294967295===cchCharacters?"":data.read_shift(cchCharacters,"dbcs")}function parse_XLWideString(data){var cchCharacters=data.read_shift(4);return 0===cchCharacters?"":data.read_shift(cchCharacters,"dbcs")}function write_XLWideString(data,o){return null==o&&(o=new_buf(4+2*data.length)),o.write_shift(4,data.length),data.length>0&&o.write_shift(0,data,"dbcs"),o}!function(O,_crypto){var crypto;if(void 0!==_crypto)crypto=_crypto;else if("undefined"!=typeof require)try{crypto=require("crypto")}catch(e){crypto=null}O.rc4=function(key,data){var S=new Array(256),c=0,i=0,j=0,t=0;for(i=0;256!=i;++i)S[i]=i;for(i=0;256!=i;++i)j=j+S[i]+key[i%key.length].charCodeAt(0)&255,t=S[i],S[i]=S[j],S[j]=t;for(i=j=0,out=Buffer(data.length),c=0;c!=data.length;++c)j=(j+S[i=i+1&255])%256,t=S[i],S[i]=S[j],S[j]=t,out[c]=data[c]^S[S[i]+S[j]&255];return out},O.md5=crypto?function(hex){return crypto.createHash("md5").update(hex).digest("hex")}:function(hex){throw"unimplemented"}}({},"undefined"!=typeof crypto?crypto:void 0);var parse_RelID=parse_XLNullableWideString,write_RelID=function(data,o){return o||(o=new_buf(127)),o.write_shift(4,data.length>0?data.length:4294967295),data.length>0&&o.write_shift(0,data,"dbcs"),o};function parse_RkNumber(data){var b=data.slice(data.l,data.l+4),fX100=1&b[0],fInt=2&b[0];data.l+=4,b[0]&=252;var RK=0===fInt?__double([0,0,0,0,b[0],b[1],b[2],b[3]],0):__readInt32LE(b,0)>>2;return fX100?RK/100:RK}function parse_UncheckedRfX(data){var cell={s:{},e:{}};return cell.s.r=data.read_shift(4),cell.e.r=data.read_shift(4),cell.s.c=data.read_shift(4),cell.e.c=data.read_shift(4),cell}function parse_Xnum(data,length){return data.read_shift(8,"f")}var BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},RBErr=evert_num(BErr);var VT_I2=2,VT_I4=3,VT_VARIANT=12,VT_USTR=81,VT_CUSTOM=[80,VT_USTR],DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:80},3:{n:"PresentationFormat",t:80},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"Scale",t:11},12:{n:"HeadingPair",t:4096|VT_VARIANT},13:{n:"DocParts",t:4126},14:{n:"Manager",t:80},15:{n:"Company",t:80},16:{n:"LinksDirty",t:11},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:11},22:{n:"HLinksChanged",t:11},23:{n:"AppVersion",t:VT_I4,p:"version"},26:{n:"ContentType",t:80},27:{n:"ContentStatus",t:80},28:{n:"Language",t:80},29:{n:"Version",t:80},255:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:80},3:{n:"Subject",t:80},4:{n:"Author",t:80},5:{n:"Keywords",t:80},6:{n:"Comments",t:80},7:{n:"Template",t:80},8:{n:"LastAuthor",t:80},9:{n:"RevNumber",t:80},10:{n:"EditTime",t:64},11:{n:"LastPrinted",t:64},12:{n:"CreatedDate",t:64},13:{n:"ModifiedDate",t:64},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:71},18:{n:"ApplicationName",t:30},19:{n:"DocumentSecurity",t:VT_I4},255:{}},SpecialProperties={2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}};!function(){for(var y in SpecialProperties)SpecialProperties.hasOwnProperty(y)&&(DocSummaryPIDDSI[y]=SummaryPIDSI[y]=SpecialProperties[y])}();var CountryEnum={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},XLSFillPattern=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];var o,XLSIcv=[0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0].map(function(x){return[x>>16&255,x>>8&255,255&x]}),ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.ms-excel.chartsheet":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"TODO","application/vnd.ms-excel.dialogsheet":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"TODO","application/vnd.ms-excel.macrosheet":"TODO","application/vnd.ms-excel.macrosheet+xml":"TODO","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.ms-excel.comments":"comments","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"TODO","application/vnd.ms-excel.sheetMetadata":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"TODO","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"vba","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO",sheet:"js"},CT_LIST=(keys(o={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}}).forEach(function(k){o[k].xlsm||(o[k].xlsm=o[k].xlsx)}),keys(o).forEach(function(k){keys(o[k]).forEach(function(v){ct2type[o[k][v]]=k})}),o),type2ct=function(obj){for(var o=[],K=keys(obj),i=0;i!==K.length;++i)null==o[obj[K[i]]]&&(o[obj[K[i]]]=[]),o[obj[K[i]]].push(K[i]);return o}(ct2type);XMLNS.CT="http://schemas.openxmlformats.org/package/2006/content-types";var CTYPE_XML_ROOT=writextag("Types",null,{xmlns:XMLNS.CT,"xmlns:xsd":XMLNS.xsd,"xmlns:xsi":XMLNS.xsi}),CTYPE_DEFAULTS=[["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["rels",type2ct.rels[0]]].map(function(x){return writextag("Default",null,{Extension:x[0],ContentType:x[1]})});var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument"};function parse_rels(data,currentFilePath){if(!data)return data;"/"!==currentFilePath.charAt(0)&&(currentFilePath="/"+currentFilePath);var rels={},hash={};return data.match(tagregex).forEach(function(x){var y=parsexmltag(x);if("<Relationship"===y[0]){var rel={};rel.Type=y.Type,rel.Target=y.Target,rel.Id=y.Id,rel.TargetMode=y.TargetMode;var canonictarget="External"===y.TargetMode?y.Target:function(to){var toksFrom=currentFilePath.split("/");toksFrom.pop();for(var toksTo=to.split("/");0!==toksTo.length;){var tokTo=toksTo.shift();".."===tokTo?toksFrom.pop():"."!==tokTo&&toksFrom.push(tokTo)}return toksFrom.join("/")}(y.Target);rels[canonictarget]=rel,hash[y.Id]=rel}}),rels["!id"]=hash,rels}XMLNS.RELS="http://schemas.openxmlformats.org/package/2006/relationships";var RELS_ROOT=writextag("Relationships",null,{xmlns:XMLNS.RELS});function write_rels(rels){var o=[];return o[o.length]=XML_HEADER,o[o.length]=RELS_ROOT,keys(rels["!id"]).forEach(function(rid){var rel=rels["!id"][rid];o[o.length]=writextag("Relationship",null,rel)}),o.length>2&&(o[o.length]="</Relationships>",o[1]=o[1].replace("/>",">")),o.join("")}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];XMLNS.CORE_PROPS="http://schemas.openxmlformats.org/package/2006/metadata/core-properties",RELS.CORE_PROPS="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties";var CORE_PROPS_REGEX=function(){for(var r=new Array(CORE_PROPS.length),i=0;i<CORE_PROPS.length;++i){var f=CORE_PROPS[i],g="(?:"+f[0].substr(0,f[0].indexOf(":"))+":)"+f[0].substr(f[0].indexOf(":")+1);r[i]=new RegExp("<"+g+"[^>]*>(.*)</"+g+">")}return r}();var CORE_PROPS_XML_ROOT=writextag("cp:coreProperties",null,{"xmlns:cp":XMLNS.CORE_PROPS,"xmlns:dc":XMLNS.dc,"xmlns:dcterms":XMLNS.dcterms,"xmlns:dcmitype":XMLNS.dcmitype,"xmlns:xsi":XMLNS.xsi});function cp_doit(f,g,h,o,p){null==p[f]&&null!=g&&""!==g&&(p[f]=g,o[o.length]=h?writextag(f,g,h):writetag(f,g))}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];XMLNS.EXT_PROPS="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",RELS.EXT_PROPS="http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties";var EXT_PROPS_XML_ROOT=writextag("Properties",null,{xmlns:XMLNS.EXT_PROPS,"xmlns:vt":XMLNS.vt});XMLNS.CUST_PROPS="http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",RELS.CUST_PROPS="http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties";var custregex=/<[^>]+>[^<]*/g;var CUST_PROPS_XML_ROOT=writextag("Properties",null,{xmlns:XMLNS.CUST_PROPS,"xmlns:vt":XMLNS.vt});function write_cust_props(cp,opts){var o=[XML_HEADER,CUST_PROPS_XML_ROOT];if(!cp)return o.join("");var pid=1;return keys(cp).forEach(function(k){++pid,o[o.length]=writextag("property",function(s){switch(typeof s){case"string":return writextag("vt:lpwstr",s);case"number":return writextag((0|s)==s?"vt:i4":"vt:r8",String(s));case"boolean":return writextag("vt:bool",s?"true":"false")}if(s instanceof Date)return writextag("vt:filetime",write_w3cdtf(s));throw new Error("Unable to serialize "+s)}(cp[k]),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:pid,name:k})}),o.length>2&&(o[o.length]="</Properties>",o[1]=o[1].replace("/>",">")),o.join("")}function xlml_set_prop(Props,tag,val){switch(tag){case"Description":tag="Comments"}Props[tag]=val}function parse_FILETIME(blob){var dwLowDateTime=blob.read_shift(4),dwHighDateTime=blob.read_shift(4);return new Date(1e3*(dwHighDateTime/1e7*Math.pow(2,32)+dwLowDateTime/1e7-11644473600)).toISOString().replace(/\.000/,"")}function parse_lpstr(blob,type,pad){var str=blob.read_shift(0,"lpstr");return pad&&(blob.l+=4-(str.length+1&3)&3),str}function parse_lpwstr(blob,type,pad){var str=blob.read_shift(0,"lpwstr");return pad&&(blob.l+=4-(str.length+1&3)&3),str}function parse_VtStringBase(blob,stringType,pad){return 31===stringType?parse_lpwstr(blob):parse_lpstr(blob,0,pad)}function parse_VtString(blob,t,pad){return parse_VtStringBase(blob,t,!1===pad?0:4)}function parse_VtHeadingPair(blob){return[parse_TypedPropertyValue(blob,VT_USTR),parse_TypedPropertyValue(blob,VT_I4)]}function parse_VtVecHeadingPair(blob){return function(blob){for(var cElements=blob.read_shift(4),out=[],i=0;i!=cElements/2;++i)out.push(parse_VtHeadingPair(blob));return out}(blob)}function parse_dictionary(blob,CodePage){for(var cnt=blob.read_shift(4),dict={},j=0;j!=cnt;++j){var pid=blob.read_shift(4),len=blob.read_shift(4);dict[pid]=blob.read_shift(len,1200===CodePage?"utf16le":"utf8").replace(chr0,"").replace(chr1,"!")}return 3&blob.l&&(blob.l=blob.l>>3<<2),dict}function parse_BLOB(blob){var size=blob.read_shift(4),bytes=blob.slice(blob.l,blob.l+size);return!0&size&&(blob.l+=4-(3&size)&3),bytes}function parse_TypedPropertyValue(blob,type,_opts){var ret,t=blob.read_shift(2),opts=_opts||{};if(blob.l+=2,type!==VT_VARIANT&&t!==type&&-1===VT_CUSTOM.indexOf(type))throw new Error("Expected type "+type+" saw "+t);switch(type===VT_VARIANT?t:type){case 2:return ret=blob.read_shift(2,"i"),opts.raw||(blob.l+=2),ret;case 3:return ret=blob.read_shift(4,"i");case 11:return 0!==blob.read_shift(4);case 19:return ret=blob.read_shift(4);case 30:return parse_lpstr(blob,0,4).replace(chr0,"");case 31:return parse_lpwstr(blob);case 64:return parse_FILETIME(blob);case 65:return parse_BLOB(blob);case 71:return function(blob){var o={};return o.Size=blob.read_shift(4),blob.l+=o.Size,o}(blob);case 80:return parse_VtString(blob,t,!opts.raw&&4).replace(chr0,"");case 81:return function(blob,t){if(!t)throw new Error("dafuq?");return parse_VtStringBase(blob,t,0)}(blob,t).replace(chr0,"");case 4108:return parse_VtVecHeadingPair(blob);case 4126:return function(blob){return function(blob){for(var length=blob.read_shift(4),ret=[],i=0;i!=length;++i)ret[i]=blob.read_shift(0,"lpstr");return ret}(blob)}(blob);default:throw new Error("TypedPropertyValue unrecognized type "+type+" "+t)}}function parse_PropertySet(blob,PIDSI){var DictObj,start_addr=blob.l,size=blob.read_shift(4),NumProps=blob.read_shift(4),Props=[],i=0,CodePage=0,Dictionary=-1;for(i=0;i!=NumProps;++i){var PropID=blob.read_shift(4),Offset=blob.read_shift(4);Props[i]=[PropID,Offset+start_addr]}var PropH={};for(i=0;i!=NumProps;++i){if(blob.l!==Props[i][1]){var fail=!0;if(i>0&&PIDSI)switch(PIDSI[Props[i-1][0]].t){case 2:blob.l+2===Props[i][1]&&(blob.l+=2,fail=!1);break;case 80:case 4108:blob.l<=Props[i][1]&&(blob.l=Props[i][1],fail=!1)}if(!PIDSI&&blob.l<=Props[i][1]&&(fail=!1,blob.l=Props[i][1]),fail)throw new Error("Read Error: Expected address "+Props[i][1]+" at "+blob.l+" :"+i)}if(PIDSI){var piddsi=PIDSI[Props[i][0]];if(PropH[piddsi.n]=parse_TypedPropertyValue(blob,piddsi.t,{raw:!0}),"version"===piddsi.p&&(PropH[piddsi.n]=String(PropH[piddsi.n]>>16)+"."+String(65535&PropH[piddsi.n])),"CodePage"==piddsi.n)switch(PropH[piddsi.n]){case 0:PropH[piddsi.n]=1252;case 1e4:case 1252:case 874:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 932:case 936:case 949:case 950:case 1200:case 1201:case 65e3:case-536:case 65001:case-535:set_cp(CodePage=PropH[piddsi.n]);break;default:throw new Error("Unsupported CodePage: "+PropH[piddsi.n])}}else if(1===Props[i][0]){if(CodePage=PropH.CodePage=parse_TypedPropertyValue(blob,VT_I2),set_cp(CodePage),-1!==Dictionary){var oldpos=blob.l;blob.l=Props[Dictionary][1],DictObj=parse_dictionary(blob,CodePage),blob.l=oldpos}}else if(0===Props[i][0]){if(0===CodePage){Dictionary=i,blob.l=Props[i+1][1];continue}DictObj=parse_dictionary(blob,CodePage)}else{var val,name=DictObj[Props[i][0]];switch(blob[blob.l]){case 65:blob.l+=4,val=parse_BLOB(blob);break;case 30:case 31:blob.l+=4,val=parse_VtString(blob,blob[blob.l-4]);break;case 3:blob.l+=4,val=blob.read_shift(4,"i");break;case 19:blob.l+=4,val=blob.read_shift(4);break;case 5:blob.l+=4,val=blob.read_shift(8,"f");break;case 11:blob.l+=4,val=parsebool(blob,4);break;case 64:blob.l+=4,val=new Date(parse_FILETIME(blob));break;default:throw new Error("unparsed value: "+blob[blob.l])}PropH[name]=val}}return blob.l=start_addr+size,PropH}function parse_PropertySetStream(file,PIDSI){var NumSets,FMTID0,FMTID1,Offset0,Offset1,blob=file.content;prep_blob(blob,0),blob.chk("feff","Byte Order: ");blob.read_shift(2);var SystemIdentifier=blob.read_shift(4);if(blob.chk(CFB.utils.consts.HEADER_CLSID,"CLSID: "),1!==(NumSets=blob.read_shift(4))&&2!==NumSets)throw"Unrecognized #Sets: "+NumSets;if(FMTID0=blob.read_shift(16),Offset0=blob.read_shift(4),1===NumSets&&Offset0!==blob.l)throw"Length mismatch";2===NumSets&&(FMTID1=blob.read_shift(16),Offset1=blob.read_shift(4));var PSet1,PSet0=parse_PropertySet(blob,PIDSI),rval={SystemIdentifier:SystemIdentifier};for(var y in PSet0)rval[y]=PSet0[y];if(rval.FMTID=FMTID0,1===NumSets)return rval;if(blob.l!==Offset1)throw"Length mismatch 2: "+blob.l+" !== "+Offset1;try{PSet1=parse_PropertySet(blob,null)}catch(e){}for(y in PSet1)rval[y]=PSet1[y];return rval.FMTID=[FMTID0,FMTID1],rval}function parsenoop2(blob,length){return blob.read_shift(length),null}function parsebool(blob,length){return 1===blob.read_shift(length)}function parseuint16(blob){return blob.read_shift(2,"u")}function parseuint16a(blob,length){return function(blob,length,cb){for(var arr=[],target=blob.l+length;blob.l<target;)arr.push(cb(blob,target-blob.l));if(target!==blob.l)throw new Error("Slurp error");return arr}(blob,length,parseuint16)}function parse_ShortXLUnicodeString(blob,length,opts){var cch=blob.read_shift(1),encoding="sbcs-cont",cp=current_codepage;(opts&&opts.biff>=8&&(current_codepage=1200),void 0===opts||5!==opts.biff)&&(blob.read_shift(1)&&(2,encoding="dbcs-cont"));var o=cch?blob.read_shift(cch,encoding):"";return current_codepage=cp,o}function parse_XLUnicodeRichExtendedString(blob){var cp=current_codepage;current_codepage=1200;var cRun,cbExtRst,cch=blob.read_shift(2),flags=blob.read_shift(1),fExtSt=4&flags,fRichSt=8&flags,z={};fRichSt&&(cRun=blob.read_shift(2)),fExtSt&&(cbExtRst=blob.read_shift(4));var encoding=1&flags?"dbcs-cont":"sbcs-cont",msg=0===cch?"":blob.read_shift(cch,encoding);return fRichSt&&(blob.l+=4*cRun),fExtSt&&(blob.l+=cbExtRst),z.t=msg,fRichSt||(z.raw="<t>"+z.t+"</t>",z.r=z.t),current_codepage=cp,z}function parse_XLUnicodeStringNoCch(blob,cch,opts){return 0===blob.read_shift(1)?blob.read_shift(cch,"sbcs-cont"):blob.read_shift(cch,"dbcs-cont")}function parse_XLUnicodeString(blob,length,opts){var cch=blob.read_shift(void 0!==opts&&opts.biff>0&&opts.biff<8?1:2);return 0===cch?(blob.l++,""):parse_XLUnicodeStringNoCch(blob,cch)}function parse_XLUnicodeString2(blob,length,opts){if(5!==opts.biff&&2!==opts.biff)return parse_XLUnicodeString(blob,0,opts);var cch=blob.read_shift(1);return 0===cch?(blob.l++,""):blob.read_shift(cch,"sbcs-cont")}var parse_ControlInfo=parsenoop,parse_HyperlinkMoniker=function(blob,length){var clsid=blob.read_shift(16);switch(16,clsid){case"e0c9ea79f9bace118c8200aa004ba90b":return function(blob,length){var len=blob.read_shift(4),start=blob.l,extra=!1;len>24&&(blob.l+=len-24,"795881f43b1d7f48af2c825dc4852763"===blob.read_shift(16)&&(extra=!0),blob.l=start);var url=blob.read_shift((extra?len-24:len)>>1,"utf16le").replace(chr0,"");return extra&&(blob.l+=24),url}(blob);case"0303000000000000c000000000000046":return function(blob,length){blob.read_shift(2);var ansiLength=blob.read_shift(4),ansiPath=blob.read_shift(ansiLength,"cstr");blob.read_shift(2),blob.read_shift(2);if(0===blob.read_shift(4))return ansiPath.replace(/\\/g,"/");var cbUnicodePathBytes=blob.read_shift(4);blob.read_shift(2);return blob.read_shift(cbUnicodePathBytes>>1,"utf16le").replace(chr0,"")}(blob);default:throw"unsupported moniker "+clsid}},parse_HyperlinkString=function(blob,length){var len=blob.read_shift(4);return blob.read_shift(len,"utf16le").replace(chr0,"")};function parse_LongRGBA(blob,length){return[blob.read_shift(1),blob.read_shift(1),blob.read_shift(1),blob.read_shift(1)]}function parse_LongRGB(blob,length){var x=parse_LongRGBA(blob);return x[3]=0,x}function parse_XLSCell(blob,length){return{r:blob.read_shift(2),c:blob.read_shift(2),ixfe:blob.read_shift(2)}}function parse_XTI(blob,length){return[blob.read_shift(2),blob.read_shift(2,"i"),blob.read_shift(2,"i")]}function parse_RkRec(blob,length){return[blob.read_shift(2),parse_RkNumber(blob)]}function parse_Ref8U(blob,length){var rwFirst=blob.read_shift(2),rwLast=blob.read_shift(2);return{s:{c:blob.read_shift(2),r:rwFirst},e:{c:blob.read_shift(2),r:rwLast}}}function parse_RefU(blob,length){var rwFirst=blob.read_shift(2),rwLast=blob.read_shift(2);return{s:{c:blob.read_shift(1),r:rwFirst},e:{c:blob.read_shift(1),r:rwLast}}}var parse_Ref=parse_RefU;function parse_FtCmo(blob,length){blob.l+=4;var ot=blob.read_shift(2),id=blob.read_shift(2),flags=blob.read_shift(2);return blob.l+=12,[id,ot,flags]}var FtTab={21:parse_FtCmo,19:parsenoop,18:function(blob,length){blob.l+=12},17:function(blob,length){blob.l+=8},16:parsenoop,15:parsenoop,13:function(blob,length){var out={};return blob.l+=4,blob.l+=16,out.fSharedNote=blob.read_shift(2),blob.l+=4,out},12:function(blob,length){blob.l+=24},11:function(blob,length){blob.l+=10},10:function(blob,length){blob.l+=16},9:parsenoop,8:function(blob,length){blob.l+=6},7:function(blob,length){return blob.l+=4,blob.cf=blob.read_shift(2),{}},6:function(blob,length){blob.l+=6},4:parsenoop,0:function(blob,length){blob.l+=4}};var parse_FontIndex=parseuint16;function parse_BOF(blob,length){var o={};switch(o.BIFFVer=blob.read_shift(2),length-=2,o.BIFFVer){case 1536:case 1280:case 2:case 7:break;default:throw"Unexpected BIFF Ver "+o.BIFFVer}return blob.read_shift(length),o}var parse_CompressPictures=parsenoop2;function parse_Label(blob,length,opts){var cell=parse_XLSCell(blob),str=parse_XLUnicodeString(blob,0,opts);return cell.val=str,cell}function parse_CellStyleXF(blob,length,style){var o={},c=(blob.read_shift(4),blob.read_shift(4),blob.read_shift(4)),d=blob.read_shift(2);return o.patternType=XLSFillPattern[c>>26],o.icvFore=127&d,o.icvBack=d>>7&127,o}var parse_XLHeaderFooter=function(blob,length,opts){return 0===length?"":parse_XLUnicodeString2(blob,0,opts)};function parse_ExternName(blob,length,opts){var body,flags=blob.read_shift(2),o={fBuiltIn:1&flags,fWantAdvise:flags>>>1&1,fWantPict:flags>>>2&1,fOle:flags>>>3&1,fOleLink:flags>>>4&1,cf:flags>>>5&1023,fIcon:flags>>>15&1};return 14849===opts.sbcch&&(body=function(blob,length){blob.l+=4,length-=4;var l=blob.l+length,udfName=parse_ShortXLUnicodeString(blob),cb=blob.read_shift(2);if(cb!==(l-=blob.l))throw"Malformed AddinUdf: padding = "+l+" != "+cb;return blob.l+=cb,udfName}(blob,length-2)),o.body=body||blob.read_shift(length-2),o}var parse_Style=parsenoop,parse_StyleExt=parsenoop,parse_ColInfo=parsenoop,parse_Window2=parsenoop,parse_Backup=parsebool,parse_Blank=parse_XLSCell,parse_BottomMargin=parse_Xnum,parse_BuiltInFnGroupCount=parseuint16,parse_CalcCount=parseuint16,parse_CalcDelta=parse_Xnum,parse_CalcIter=parsebool,parse_CalcMode=parseuint16,parse_CalcPrecision=parsebool,parse_CalcRefMode=parsenoop2,parse_CalcSaveRecalc=parsebool,parse_CodePage=parseuint16,parse_Compat12=parsebool,parse_Date1904=parsebool,parse_DefColWidth=parseuint16,parse_DSF=parsenoop2,parse_EntExU2=parsenoop2,parse_EOF=parsenoop2,parse_Excel9File=parsenoop2,parse_FeatHdr=parsenoop2,parse_FontX=parseuint16,parse_Footer=parse_XLHeaderFooter,parse_GridSet=parseuint16,parse_HCenter=parsebool,parse_Header=parse_XLHeaderFooter,parse_HideObj=parseuint16,parse_InterfaceEnd=parsenoop2,parse_LeftMargin=parse_Xnum,parse_Mms=parsenoop2,parse_ObjProtect=parsebool,parse_Password=parseuint16,parse_PrintGrid=parsebool,parse_PrintRowCol=parsebool,parse_PrintSize=parseuint16,parse_Prot4Rev=parsebool,parse_Prot4RevPass=parseuint16,parse_Protect=parsebool,parse_RefreshAll=parsebool,parse_RightMargin=parse_Xnum,parse_RRTabId=parseuint16a,parse_ScenarioProtect=parsebool,parse_Scl=parseuint16a,parse_String=parse_XLUnicodeString,parse_SxBool=parsebool,parse_TopMargin=parse_Xnum,parse_UsesELFs=parsebool,parse_VCenter=parsebool,parse_WinProtect=parsebool,parse_WriteProtect=parsenoop,parse_VerticalPageBreaks=parsenoop,parse_HorizontalPageBreaks=parsenoop,parse_Selection=parsenoop,parse_Continue=parsenoop,parse_Pane=parsenoop,parse_Pls=parsenoop,parse_DCon=parsenoop,parse_DConRef=parsenoop,parse_DConName=parsenoop,parse_XCT=parsenoop,parse_CRN=parsenoop,parse_FileSharing=parsenoop,parse_Uncalced=parsenoop,parse_Template=parsenoop,parse_Intl=parsenoop,parse_WsBool=parsenoop,parse_Sort=parsenoop,parse_Sync=parsenoop,parse_LPr=parsenoop,parse_DxGCol=parsenoop,parse_FnGroupName=parsenoop,parse_FilterMode=parsenoop,parse_AutoFilterInfo=parsenoop,parse_AutoFilter=parsenoop,parse_Setup=parsenoop,parse_ScenMan=parsenoop,parse_SCENARIO=parsenoop,parse_SxView=parsenoop,parse_Sxvd=parsenoop,parse_SXVI=parsenoop,parse_SxIvd=parsenoop,parse_SXLI=parsenoop,parse_SXPI=parsenoop,parse_DocRoute=parsenoop,parse_RecipName=parsenoop,parse_MulBlank=parsenoop,parse_SXDI=parsenoop,parse_SXDB=parsenoop,parse_SXFDB=parsenoop,parse_SXDBB=parsenoop,parse_SXNum=parsenoop,parse_SxErr=parsenoop,parse_SXInt=parsenoop,parse_SXString=parsenoop,parse_SXDtr=parsenoop,parse_SxNil=parsenoop,parse_SXTbl=parsenoop,parse_SXTBRGIITM=parsenoop,parse_SxTbpg=parsenoop,parse_ObProj=parsenoop,parse_SXStreamID=parsenoop,parse_DBCell=parsenoop,parse_SXRng=parsenoop,parse_SxIsxoper=parsenoop,parse_BookBool=parsenoop,parse_DbOrParamQry=parsenoop,parse_OleObjectSize=parsenoop,parse_SXVS=parsenoop,parse_BkHim=parsenoop,parse_MsoDrawingGroup=parsenoop,parse_MsoDrawing=parsenoop,parse_MsoDrawingSelection=parsenoop,parse_PhoneticInfo=parsenoop,parse_SxRule=parsenoop,parse_SXEx=parsenoop,parse_SxFilt=parsenoop,parse_SxDXF=parsenoop,parse_SxItm=parsenoop,parse_SxName=parsenoop,parse_SxSelect=parsenoop,parse_SXPair=parsenoop,parse_SxFmla=parsenoop,parse_SxFormat=parsenoop,parse_SXVDEx=parsenoop,parse_SXFormula=parsenoop,parse_SXDBEx=parsenoop,parse_RRDInsDel=parsenoop,parse_RRDHead=parsenoop,parse_RRDChgCell=parsenoop,parse_RRDRenSheet=parsenoop,parse_RRSort=parsenoop,parse_RRDMove=parsenoop,parse_RRFormat=parsenoop,parse_RRAutoFmt=parsenoop,parse_RRInsertSh=parsenoop,parse_RRDMoveBegin=parsenoop,parse_RRDMoveEnd=parsenoop,parse_RRDInsDelBegin=parsenoop,parse_RRDInsDelEnd=parsenoop,parse_RRDConflict=parsenoop,parse_RRDDefName=parsenoop,parse_RRDRstEtxp=parsenoop,parse_LRng=parsenoop,parse_CUsr=parsenoop,parse_CbUsr=parsenoop,parse_UsrInfo=parsenoop,parse_UsrExcl=parsenoop,parse_FileLock=parsenoop,parse_RRDInfo=parsenoop,parse_BCUsrs=parsenoop,parse_UsrChk=parsenoop,parse_UserBView=parsenoop,parse_UserSViewBegin=parsenoop,parse_UserSViewEnd=parsenoop,parse_RRDUserView=parsenoop,parse_Qsi=parsenoop,parse_CondFmt=parsenoop,parse_CF=parsenoop,parse_DVal=parsenoop,parse_DConBin=parsenoop,parse_Lel=parsenoop,parse_XLSCodeName=parse_XLUnicodeString,parse_SXFDBType=parsenoop,parse_ObNoMacros=parsenoop,parse_Dv=parsenoop,parse_Index=parsenoop,parse_Table=parsenoop,parse_BigName=parsenoop,parse_ContinueBigName=parsenoop,parse_WebPub=parsenoop,parse_QsiSXTag=parsenoop,parse_DBQueryExt=parsenoop,parse_ExtString=parsenoop,parse_TxtQry=parsenoop,parse_Qsir=parsenoop,parse_Qsif=parsenoop,parse_RRDTQSIF=parsenoop,parse_OleDbConn=parsenoop,parse_WOpt=parsenoop,parse_SXViewEx=parsenoop,parse_SXTH=parsenoop,parse_SXPIEx=parsenoop,parse_SXVDTEx=parsenoop,parse_SXViewEx9=parsenoop,parse_ContinueFrt=parsenoop,parse_RealTimeData=parsenoop,parse_ChartFrtInfo=parsenoop,parse_FrtWrapper=parsenoop,parse_StartBlock=parsenoop,parse_EndBlock=parsenoop,parse_StartObject=parsenoop,parse_EndObject=parsenoop,parse_CatLab=parsenoop,parse_YMult=parsenoop,parse_SXViewLink=parsenoop,parse_PivotChartBits=parsenoop,parse_FrtFontList=parsenoop,parse_SheetExt=parsenoop,parse_BookExt=parsenoop,parse_SXAddl=parsenoop,parse_CrErr=parsenoop,parse_HFPicture=parsenoop,parse_Feat=parsenoop,parse_DataLabExt=parsenoop,parse_DataLabExtContents=parsenoop,parse_CellWatch=parsenoop,parse_FeatHdr11=parsenoop,parse_Feature11=parsenoop,parse_DropDownObjIds=parsenoop,parse_ContinueFrt11=parsenoop,parse_DConn=parsenoop,parse_List12=parsenoop,parse_Feature12=parsenoop,parse_CondFmt12=parsenoop,parse_CF12=parsenoop,parse_CFEx=parsenoop,parse_AutoFilter12=parsenoop,parse_ContinueFrt12=parsenoop,parse_MDTInfo=parsenoop,parse_MDXStr=parsenoop,parse_MDXTuple=parsenoop,parse_MDXSet=parsenoop,parse_MDXProp=parsenoop,parse_MDXKPI=parsenoop,parse_MDB=parsenoop,parse_PLV=parsenoop,parse_DXF=parsenoop,parse_TableStyles=parsenoop,parse_TableStyle=parsenoop,parse_TableStyleElement=parsenoop,parse_NamePublish=parsenoop,parse_NameCmt=parsenoop,parse_SortData=parsenoop,parse_GUIDTypeLib=parsenoop,parse_FnGrp12=parsenoop,parse_NameFnGrp12=parsenoop,parse_HeaderFooter=parsenoop,parse_CrtLayout12=parsenoop,parse_CrtMlFrt=parsenoop,parse_CrtMlFrtContinue=parsenoop,parse_ShapePropsStream=parsenoop,parse_TextPropsStream=parsenoop,parse_RichTextStream=parsenoop,parse_CrtLayout12A=parsenoop,parse_Units=parsenoop,parse_Chart=parsenoop,parse_Series=parsenoop,parse_DataFormat=parsenoop,parse_LineFormat=parsenoop,parse_MarkerFormat=parsenoop,parse_AreaFormat=parsenoop,parse_PieFormat=parsenoop,parse_AttachedLabel=parsenoop,parse_SeriesText=parsenoop,parse_ChartFormat=parsenoop,parse_Legend=parsenoop,parse_SeriesList=parsenoop,parse_Bar=parsenoop,parse_Line=parsenoop,parse_Pie=parsenoop,parse_Area=parsenoop,parse_Scatter=parsenoop,parse_CrtLine=parsenoop,parse_Axis=parsenoop,parse_Tick=parsenoop,parse_ValueRange=parsenoop,parse_CatSerRange=parsenoop,parse_AxisLine=parsenoop,parse_CrtLink=parsenoop,parse_DefaultText=parsenoop,parse_Text=parsenoop,parse_ObjectLink=parsenoop,parse_Frame=parsenoop,parse_Begin=parsenoop,parse_End=parsenoop,parse_PlotArea=parsenoop,parse_Chart3d=parsenoop,parse_PicF=parsenoop,parse_DropBar=parsenoop,parse_Radar=parsenoop,parse_Surf=parsenoop,parse_RadarArea=parsenoop,parse_AxisParent=parsenoop,parse_LegendException=parsenoop,parse_ShtProps=parsenoop,parse_SerToCrt=parsenoop,parse_AxesUsed=parsenoop,parse_SBaseRef=parsenoop,parse_SerParent=parsenoop,parse_SerAuxTrend=parsenoop,parse_IFmtRecord=parsenoop,parse_Pos=parsenoop,parse_AlRuns=parsenoop,parse_BRAI=parsenoop,parse_SerAuxErrBar=parsenoop,parse_SerFmt=parsenoop,parse_Chart3DBarShape=parsenoop,parse_Fbi=parsenoop,parse_BopPop=parsenoop,parse_AxcExt=parsenoop,parse_Dat=parsenoop,parse_PlotGrowth=parsenoop,parse_SIIndex=parsenoop,parse_GelFrame=parsenoop,parse_BopPopCustom=parsenoop,parse_Fbi2=parsenoop;var CS2CP={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},parse_rs=function(){var tregex=matchtag("t"),rpregex=matchtag("rPr"),rregex=/<r>/g,rend=/<\/r>/,nlregex=/\r\n/g,parse_rpr=function(rpr,intro,outro){var font={},cp=65001,m=rpr.match(tagregex),i=0;if(m)for(;i!=m.length;++i){var y=parsexmltag(m[i]);switch(y[0]){case"<condense":case"<extend":break;case"<shadow":case"<shadow/>":break;case"<charset":if("1"==y.val)break;cp=CS2CP[parseInt(y.val,10)];break;case"<outline":case"<outline/>":break;case"<rFont":font.name=y.val;break;case"<sz":font.sz=y.val;break;case"<strike":if(!y.val)break;case"<strike/>":font.strike=1;break;case"</strike>":break;case"<u":if(!y.val)break;case"<u/>":font.u=1;break;case"</u>":break;case"<b":if(!y.val)break;case"<b/>":font.b=1;break;case"</b>":break;case"<i":if(!y.val)break;case"<i/>":font.i=1;break;case"</i>":break;case"<color":y.rgb&&(font.color=y.rgb.substr(2,6));break;case"<family":font.family=y.val;break;case"<vertAlign":case"<scheme":break;default:if(47!==y[0].charCodeAt(1))throw"Unrecognized rich format "+y[0]}}var style=[];return font.b&&style.push("font-weight: bold;"),font.i&&style.push("font-style: italic;"),intro.push('<span style="'+style.join("")+'">'),outro.push("</span>"),cp};function parse_r(r){var terms=[[],"",[]],t=r.match(tregex);if(!isval(t))return"";terms[1]=t[1];var rpr=r.match(rpregex);return isval(rpr)&&parse_rpr(rpr[1],terms[0],terms[2]),terms[0].join("")+terms[1].replace(nlregex,"<br/>")+terms[2].join("")}return function(rs){return rs.replace(rregex,"").split(rend).map(parse_r).join("")}}(),sitregex=/<t[^>]*>([^<]*)<\/t>/g,sirregex=/<r>/;function parse_si(x,opts){var html=!opts||opts.cellHTML,z={};return x?(116===x.charCodeAt(1)?(z.t=utf8read(unescapexml(x.substr(x.indexOf(">")+1).split(/<\/t>/)[0])),z.r=x,html&&(z.h=z.t)):x.match(sirregex)&&(z.r=x,z.t=utf8read(unescapexml(x.match(sitregex).join("").replace(tagregex,""))),html&&(z.h=parse_rs(x))),z):null}var sstr0=/<sst([^>]*)>([\s\S]*)<\/sst>/,sstr1=/<(?:si|sstItem)>/g,sstr2=/<\/(?:si|sstItem)>/;RELS.SST="http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings";var straywsregex=/^\s|\s$|[\t\n\r]/;var write_BrtSSTItem=function(str,o){return null==o&&(o=new_buf(5+2*str.t.length)),o.write_shift(1,0),write_XLWideString(str.t,o),o};function write_sst_bin(sst,opts){var ba=buf_array();write_record(ba,"BrtBeginSst",function(sst,o){return o||(o=new_buf(8)),o.write_shift(4,sst.Count),o.write_shift(4,sst.Unique),o}(sst));for(var i=0;i<sst.length;++i)write_record(ba,"BrtSSTItem",write_BrtSSTItem(sst[i]));return write_record(ba,"BrtEndSst"),ba.end()}function _JS2ANSI(str){return void 0!==cptable?cptable.utils.encode(1252,str):str.split("").map(function(x){return x.charCodeAt(0)})}function parse_Version(blob,length){var o={};return o.Major=blob.read_shift(2),o.Minor=blob.read_shift(2),o}function parse_RC4CryptoHeader(blob,length){var o={},vers=o.EncryptionVersionInfo=parse_Version(blob);if(length-=4,2!=vers.Minor)throw"unrecognized minor version code: "+vers.Minor;if(vers.Major>4||vers.Major<2)throw"unrecognized major version code: "+vers.Major;o.Flags=blob.read_shift(4),length-=4;var sz=blob.read_shift(4);return length-=4,o.EncryptionHeader=function(blob,length){var o={};o.Flags=blob.read_shift(4);var tmp=blob.read_shift(4);if(0!==tmp)throw"Unrecognized SizeExtra: "+tmp;switch(o.AlgID=blob.read_shift(4),o.AlgID){case 0:case 26625:case 26126:case 26127:case 26128:break;default:throw"Unrecognized encryption algorithm: "+o.AlgID}return parsenoop(blob,length-12),o}(blob,sz),length-=sz,o.EncryptionVerifier=function(blob,length){return parsenoop(blob,length)}(blob,length),o}var PadArray,InitialCode,XorMatrix,XorRor,crypto_CreateXorArray_Method1=(PadArray=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],InitialCode=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],XorMatrix=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],XorRor=function(byte1,byte2){return 255&((Byte=byte1^byte2)/2|128*Byte);var Byte},function(password){for(var Temp,PasswordLastChar,PadIndex,Password=_JS2ANSI(password),XorKey=function(Password){for(var XorKey=InitialCode[Password.length-1],CurrentElement=104,i=Password.length-1;i>=0;--i)for(var Char=Password[i],j=0;7!=j;++j)64&Char&&(XorKey^=XorMatrix[CurrentElement]),Char*=2,--CurrentElement;return XorKey}(Password),Index=Password.length,ObfuscationArray=new_raw_buf(16),i=0;16!=i;++i)ObfuscationArray[i]=0;for(1==(1&Index)&&(Temp=XorKey>>8,ObfuscationArray[Index]=XorRor(PadArray[0],Temp),--Index,Temp=255&XorKey,PasswordLastChar=Password[Password.length-1],ObfuscationArray[Index]=XorRor(PasswordLastChar,Temp));Index>0;)Temp=XorKey>>8,ObfuscationArray[--Index]=XorRor(Password[Index],Temp),Temp=255&XorKey,ObfuscationArray[--Index]=XorRor(Password[Index],Temp);for(Index=15,PadIndex=15-Password.length;PadIndex>0;)Temp=XorKey>>8,ObfuscationArray[Index]=XorRor(PadArray[PadIndex],Temp),--PadIndex,Temp=255&XorKey,ObfuscationArray[--Index]=XorRor(Password[Index],Temp),--Index,--PadIndex;return ObfuscationArray}),crypto_MakeXorDecryptor=function(password){var XorArrayIndex=0,XorArray=crypto_CreateXorArray_Method1(password);return function(Data){var O=function(password,Data,XorArrayIndex,XorArray,O){var Index,Value;for(O||(O=Data),XorArray||(XorArray=crypto_CreateXorArray_Method1(password)),Index=0;Index!=Data.length;++Index)Value=Data[Index],Value=255&((Value^=XorArray[XorArrayIndex])>>5|Value<<3),O[Index]=Value,++XorArrayIndex;return[O,XorArrayIndex,XorArray]}(null,Data,XorArrayIndex,XorArray);return XorArrayIndex=O[1],O[0]}};function parse_XORObfuscation(blob,length,opts,out){var o={key:parseuint16(blob),verificationBytes:parseuint16(blob)};return opts.password&&(o.verifier=function(Password){var PasswordArray,i,PasswordByte,Verifier=0,PasswordDecoded=_JS2ANSI(Password),len=PasswordDecoded.length+1;for((PasswordArray=new_raw_buf(len))[0]=PasswordDecoded.length,i=1;i!=len;++i)PasswordArray[i]=PasswordDecoded[i-1];for(i=len-1;i>=0;--i)PasswordByte=PasswordArray[i],Verifier=((0==(16384&Verifier)?0:1)|Verifier<<1&32767)^PasswordByte;return 52811^Verifier}(opts.password)),out.valid=o.verificationBytes===o.verifier,out.valid&&(out.insitu_decrypt=crypto_MakeXorDecryptor(opts.password)),o}function parse_FilePassHeader(blob,length,oo){var o=oo||{};return o.Info=blob.read_shift(2),blob.l-=2,1===o.Info?o.Data=function(blob,length){var o={},vers=o.EncryptionVersionInfo=parse_Version(blob);if(1!=vers.Major||1!=vers.Minor)throw"unrecognized version code "+vers.Major+" : "+vers.Minor;return o.Salt=blob.read_shift(16),o.EncryptedVerifier=blob.read_shift(16),o.EncryptedVerifierHash=blob.read_shift(16),o}(blob):o.Data=parse_RC4CryptoHeader(blob,length),o}function rgb2Hex(rgb){for(var i=0,o=1;3!=i;++i)o=256*o+(rgb[i]>255?255:rgb[i]<0?0:rgb[i]);return o.toString(16).toUpperCase().substr(1)}function rgb_tint(hex,tint){if(0===tint)return hex;var h,o,hsl=function(rgb){var R=rgb[0]/255,G=rgb[1]/255,B=rgb[2]/255,M=Math.max(R,G,B),m=Math.min(R,G,B),C=M-m;if(0===C)return[0,0,R];var S,H6=0,L2=M+m;switch(S=C/(L2>1?2-L2:L2),M){case R:H6=((G-B)/C+6)%6;break;case G:H6=(B-R)/C+2;break;case B:H6=(R-G)/C+4}return[H6/6,S,L2/2]}((o=(h=hex).substr("#"===h[0]?1:0,6),[parseInt(o.substr(0,2),16),parseInt(o.substr(0,2),16),parseInt(o.substr(0,2),16)]));return hsl[2]=tint<0?hsl[2]*(1+tint):1-(1-hsl[2])*(1-tint),rgb2Hex(function(hsl){var X,H=hsl[0],S=hsl[1],L=hsl[2],C=2*S*(L<.5?L:1-L),m=L-C/2,rgb=[m,m,m],h6=6*H;if(0!==S)switch(0|h6){case 0:case 6:X=C*h6,rgb[0]+=C,rgb[1]+=X;break;case 1:X=C*(2-h6),rgb[0]+=X,rgb[1]+=C;break;case 2:X=C*(h6-2),rgb[1]+=C,rgb[2]+=X;break;case 3:X=C*(4-h6),rgb[1]+=X,rgb[2]+=C;break;case 4:X=C*(h6-4),rgb[2]+=C,rgb[0]+=X;break;case 5:X=C*(6-h6),rgb[2]+=X,rgb[0]+=C}for(var i=0;3!=i;++i)rgb[i]=Math.round(255*rgb[i]);return rgb}(hsl))}var DEF_MDW=7,MAX_MDW=15,MIN_MDW=1,MDW=DEF_MDW;function width2px(width){return(width+(128/MDW|0)/256)*MDW|0}function px2char(px){return((px-5)/MDW*100+.5|0)/100}function char2width(chr){return((chr*MDW+5)/MDW*256|0)/256}function cycle_width(collw){return char2width(px2char(width2px(collw)))}function find_mdw(collw,coll){if(cycle_width(collw)!=collw){for(MDW=DEF_MDW;MDW>MIN_MDW&&cycle_width(collw)!==collw;--MDW);if(MDW===MIN_MDW)for(MDW=DEF_MDW+1;MDW<MAX_MDW&&cycle_width(collw)!==collw;++MDW);MDW===MAX_MDW&&(MDW=DEF_MDW)}}var XLMLPatternTypeMap={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"},styles={},themes={};var numFmtRegex,cellXfRegex,fillsRegex,parse_sty_xml=(numFmtRegex=/<numFmts([^>]*)>.*<\/numFmts>/,cellXfRegex=/<cellXfs([^>]*)>.*<\/cellXfs>/,fillsRegex=/<fills([^>]*)>.*<\/fills>/,function(data,opts){var t;return(t=data.match(numFmtRegex))&&function(t,opts){styles.NumberFmt=[];for(var k=keys(SSF._table),i=0;i<k.length;++i)styles.NumberFmt[k[i]]=SSF._table[k[i]];var m=t[0].match(tagregex);for(i=0;i<m.length;++i){var y=parsexmltag(m[i]);switch(y[0]){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":var f=unescapexml(utf8read(y.formatCode)),j=parseInt(y.numFmtId,10);styles.NumberFmt[j]=f,j>0&&SSF.load(f,j);break;default:if(opts.WTF)throw"unrecognized "+y[0]+" in numFmts"}}}(t,opts),(t=data.match(fillsRegex))&&function(t,opts){styles.Fills=[];var fill={};t[0].match(tagregex).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<fills":case"<fills>":case"</fills>":case"<fill>":break;case"</fill>":styles.Fills.push(fill),fill={};break;case"<patternFill":y.patternType&&(fill.patternType=y.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":fill.bgColor||(fill.bgColor={}),y.indexed&&(fill.bgColor.indexed=parseInt(y.indexed,10)),y.theme&&(fill.bgColor.theme=parseInt(y.theme,10)),y.tint&&(fill.bgColor.tint=parseFloat(y.tint)),y.rgb&&(fill.bgColor.rgb=y.rgb.substring(y.rgb.length-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":fill.fgColor||(fill.fgColor={}),y.theme&&(fill.fgColor.theme=parseInt(y.theme,10)),y.tint&&(fill.fgColor.tint=parseFloat(y.tint)),y.rgb&&(fill.fgColor.rgb=y.rgb.substring(y.rgb.length-6));break;case"<fgColor/>":case"</fgColor>":break;default:if(opts.WTF)throw"unrecognized "+y[0]+" in fills"}})}(t,opts),(t=data.match(cellXfRegex))&&function(t,opts){styles.CellXf=[],t[0].match(tagregex).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":delete y[0],y.numFmtId&&(y.numFmtId=parseInt(y.numFmtId,10)),y.fillId&&(y.fillId=parseInt(y.fillId,10)),styles.CellXf.push(y);break;case"</xf>":break;case"<alignment":case"<alignment/>":break;case"<protection":case"</protection>":case"<protection/>":break;case"<extLst":case"</extLst>":case"<ext":break;default:if(opts.WTF)throw"unrecognized "+y[0]+" in cellXfs"}})}(t,opts),styles}),STYLES_XML_ROOT=writextag("styleSheet",null,{xmlns:XMLNS.main[0],"xmlns:vt":XMLNS.vt});function write_sty_xml(wb,opts){var w,o=[XML_HEADER,STYLES_XML_ROOT];return null!=(w=function(NF,opts){var o=["<numFmts>"];return[[5,8],[23,26],[41,44],[63,66],[164,392]].forEach(function(r){for(var i=r[0];i<=r[1];++i)void 0!==NF[i]&&(o[o.length]=writextag("numFmt",null,{numFmtId:i,formatCode:escapexml(NF[i])}))}),1===o.length?"":(o[o.length]="</numFmts>",o[0]=writextag("numFmts",null,{count:o.length-2}).replace("/>",">"),o.join(""))}(wb.SSF))&&(o[o.length]=w),o[o.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',o[o.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',o[o.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',o[o.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(w=function(cellXfs){var o=[];return o[o.length]=writextag("cellXfs",null),cellXfs.forEach(function(c){o[o.length]=writextag("xf",null,c)}),o[o.length]="</cellXfs>",2===o.length?"":(o[0]=writextag("cellXfs",null,{count:o.length-2}).replace("/>",">"),o.join(""))}(opts.cellXfs))&&(o[o.length]=w),o[o.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',o[o.length]='<dxfs count="0"/>',o[o.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',o.length>2&&(o[o.length]="</styleSheet>",o[1]=o[1].replace("/>",">")),o.join("")}RELS.STY="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",RELS.THEME="http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme";var clrsregex=/<a:clrScheme([^>]*)>[^\u2603]*<\/a:clrScheme>/,fntsregex=/<a:fontScheme([^>]*)>[^\u2603]*<\/a:fontScheme>/,fmtsregex=/<a:fmtScheme([^>]*)>[^\u2603]*<\/a:fmtScheme>/;function parse_themeElements(data,opts){var t;themes.themeElements={},[["clrScheme",clrsregex,function(t,opts){themes.themeElements.clrScheme=[];var color={};t[0].match(tagregex).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":color.rgb=y.val;break;case"<a:sysClr":color.rgb=y.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt1>":case"</a:lt1>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":"/"===y[0][1]?(themes.themeElements.clrScheme.push(color),color={}):color.name=y[0].substring(3,y[0].length-1);break;default:if(opts.WTF)throw"unrecognized "+y[0]+" in clrScheme"}})}],["fontScheme",fntsregex,function(t,opts){}],["fmtScheme",fmtsregex,function(t,opts){}]].forEach(function(m){if(!(t=data.match(m[1])))throw m[0]+" not found in themeElements";m[2](t,opts)})}var themeltregex=/<a:themeElements([^>]*)>[^\u2603]*<\/a:themeElements>/;function parse_FullColorExt(blob,length){var o={};switch(o.xclrType=blob.read_shift(2),o.nTintShade=blob.read_shift(2),o.xclrType){case 0:blob.l+=4;break;case 1:o.xclrValue=function(blob,length){return parsenoop(blob,length)}(blob,4);break;case 2:o.xclrValue=parse_LongRGBA(blob);break;case 3:o.xclrValue=function(blob,length){return blob.read_shift(4)}(blob);break;case 4:blob.l+=4}return blob.l+=8,o}function parse_ExtProp(blob,length){var extType=blob.read_shift(2),cb=blob.read_shift(2),o=[extType];switch(extType){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:o[1]=parse_FullColorExt(blob);break;case 6:o[1]=function(blob,length){return parsenoop(blob,length)}(blob,cb);break;case 14:case 15:o[1]=blob.read_shift(5===cb?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+extType+" "+cb)}return o}function insertCommentsIntoSheet(sheetName,sheet,comments){comments.forEach(function(comment){var cell=sheet[comment.ref];if(!cell){cell={},sheet[comment.ref]=cell;var range=safe_decode_range(sheet["!ref"]||"BDWGO1000001:A1"),thisCell=decode_cell(comment.ref);range.s.r>thisCell.r&&(range.s.r=thisCell.r),range.e.r<thisCell.r&&(range.e.r=thisCell.r),range.s.c>thisCell.c&&(range.s.c=thisCell.c),range.e.c<thisCell.c&&(range.e.c=thisCell.c);var encoded=encode_range(range);encoded!==sheet["!ref"]&&(sheet["!ref"]=encoded)}cell.c||(cell.c=[]);var o={a:comment.author,t:comment.t,r:comment.r};comment.h&&(o.h=comment.h),cell.c.push(o)})}var parse_BrtCommentAuthor=parse_XLWideString,parse_BrtCommentText=parse_RichStr;var rc_to_a1=function(){var rcbase,rcregex=/(^|[^A-Za-z])R(\[?)(-?\d+|)\]?C(\[?)(-?\d+|)\]?/g;function rcfunc($$,$1,$2,$3,$4,$5){var R=$3.length>0?0|parseInt($3,10):0,C=$5.length>0?0|parseInt($5,10):0;return C<0&&0===$4.length&&(C=0),$4.length>0&&(C+=rcbase.c),$2.length>0&&(R+=rcbase.r),$1+encode_col(C)+encode_row(R)}return function(fstr,base){return rcbase=base,fstr.replace(rcregex,rcfunc)}}();function parseread1(blob,length){blob.l+=1}function parse_ColRelU(blob,length){var c=blob.read_shift(2);return[16383&c,c>>14&1,c>>15&1]}function parse_RgceArea(blob,length){var r=blob.read_shift(2),R=blob.read_shift(2),c=parse_ColRelU(blob),C=parse_ColRelU(blob);return{s:{r:r,c:c[0],cRel:c[1],rRel:c[2]},e:{r:R,c:C[0],cRel:C[1],rRel:C[2]}}}function parse_RgceLoc(blob,length){var r=blob.read_shift(2),c=parse_ColRelU(blob);return{r:r,c:c[0],cRel:c[1],rRel:c[2]}}function parse_PtgAttrSpaceType(blob,length){return[blob.read_shift(1),blob.read_shift(1)]}var l,parse_PtgAttrSum=(l=4,function(blob,length){blob.l+=l});function parse_SerAr(blob){var val=[];switch(val[0]=blob.read_shift(1)){case 4:val[1]=parsebool(blob,1)?"TRUE":"FALSE",blob.l+=7;break;case 16:val[1]=BErr[blob[blob.l]],blob.l+=8;break;case 0:blob.l+=8;break;case 1:val[1]=parse_Xnum(blob);break;case 2:val[1]=parse_XLUnicodeString(blob)}return val}function parse_PtgExtraMem(blob,cce){for(var count=blob.read_shift(2),out=[],i=0;i!=count;++i)out.push(parse_Ref8U(blob));return out}function parse_PtgExtraArray(blob){for(var cols=1+blob.read_shift(1),rows=1+blob.read_shift(2),i=0,o=[];i!=rows&&(o[i]=[]);++i)for(var j=0;j!=cols;++j)o[i][j]=parse_SerAr(blob);return o}var PtgTypes={1:{n:"PtgExp",f:function(blob,length){return blob.l++,[blob.read_shift(2),blob.read_shift(2)]}},2:{n:"PtgTbl",f:parsenoop},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:function(blob,length){return blob.l++,parse_ShortXLUnicodeString(blob)}},28:{n:"PtgErr",f:function(blob,length){return blob.l++,BErr[blob.read_shift(1)]}},29:{n:"PtgBool",f:function(blob,length){return blob.l++,0!==blob.read_shift(1)}},30:{n:"PtgInt",f:function(blob,length){return blob.l++,blob.read_shift(2)}},31:{n:"PtgNum",f:function(blob,length){return blob.l++,parse_Xnum(blob)}},32:{n:"PtgArray",f:function(blob,length){var type=(96&blob[blob.l++])>>5;return blob.l+=7,[type]}},33:{n:"PtgFunc",f:function(blob,length){blob[blob.l],blob[blob.l],blob.l+=1;var iftab=blob.read_shift(2);return[FtabArgc[iftab],Ftab[iftab]]}},34:{n:"PtgFuncVar",f:function(blob,length){blob.l++;var cparams=blob.read_shift(1),tab=function(blob,length){return[blob[blob.l+1]>>7,32767&blob.read_shift(2)]}(blob);return[cparams,(0===tab[0]?Ftab:Cetab)[tab[1]]]}},35:{n:"PtgName",f:function(blob,length){return[blob.read_shift(1)>>>5&3,0,blob.read_shift(4)]}},36:{n:"PtgRef",f:function(blob,length){blob[blob.l];var type=(96&blob[blob.l])>>5;return blob.l+=1,[type,parse_RgceLoc(blob)]}},37:{n:"PtgArea",f:function(blob,length){return[(96&blob[blob.l++])>>5,parse_RgceArea(blob)]}},38:{n:"PtgMemArea",f:function(blob,length){var type=blob.read_shift(1)>>>5&3;return blob.l+=4,[type,blob.read_shift(2)]}},39:{n:"PtgMemErr",f:parsenoop},40:{n:"PtgMemNoMem",f:parsenoop},41:{n:"PtgMemFunc",f:function(blob,length){return[blob.read_shift(1)>>>5&3,blob.read_shift(2)]}},42:{n:"PtgRefErr",f:function(blob,length){var type=blob.read_shift(1)>>>5&3;return blob.l+=4,[type]}},43:{n:"PtgAreaErr",f:function(blob,length){var type=(96&blob[blob.l++])>>5;return blob.l+=8,[type]}},44:{n:"PtgRefN",f:function(blob,length){blob[blob.l];var type=(96&blob[blob.l])>>5;return blob.l+=1,[type,function(blob,length){var r=blob.read_shift(2),cl=blob.read_shift(2),cRel=(32768&cl)>>15,rRel=(16384&cl)>>14;if(cl&=16383,0!==cRel)for(;cl>=256;)cl-=256;return{r:r,c:cl,cRel:cRel,rRel:rRel}}(blob)]}},45:{n:"PtgAreaN",f:function(blob,length){return[(96&blob[blob.l++])>>5,function(blob,length){var r=blob.read_shift(2),R=blob.read_shift(2),c=parse_ColRelU(blob),C=parse_ColRelU(blob);return{s:{r:r,c:c[0],cRel:c[1],rRel:c[2]},e:{r:R,c:C[0],cRel:C[1],rRel:C[2]}}}(blob)]}},57:{n:"PtgNameX",f:function(blob,length){return[blob.read_shift(1)>>>5&3,blob.read_shift(2),blob.read_shift(4)]}},58:{n:"PtgRef3d",f:function(blob,length){blob[blob.l];var type=(96&blob[blob.l])>>5;return blob.l+=1,[type,blob.read_shift(2),parse_RgceLoc(blob)]}},59:{n:"PtgArea3d",f:function(blob,length){return[(96&blob[blob.l++])>>5,blob.read_shift(2),parse_RgceArea(blob)]}},60:{n:"PtgRefErr3d",f:parsenoop},61:{n:"PtgAreaErr3d",f:function(blob,length){var type=(96&blob[blob.l++])>>5,ixti=blob.read_shift(2);return blob.l+=8,[type,ixti]}},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61};!function(){for(var y in PtgDupes)PtgTypes[y]=PtgTypes[PtgDupes[y]]}();var Ptg18={},Ptg19={1:{n:"PtgAttrSemi",f:function(blob,length){var bitSemi=255&blob[blob.l+1]?1:0;return blob.l+=4,[bitSemi]}},2:{n:"PtgAttrIf",f:function(blob,length){var bitIf=255&blob[blob.l+1]?1:0;return blob.l+=2,[bitIf,blob.read_shift(2)]}},4:{n:"PtgAttrChoose",f:function(blob,length){blob.l+=2;for(var offset=blob.read_shift(2),o=[],i=0;i<=offset;++i)o.push(blob.read_shift(2));return o}},8:{n:"PtgAttrGoto",f:function(blob,length){var bitGoto=255&blob[blob.l+1]?1:0;return blob.l+=2,[bitGoto,blob.read_shift(2)]}},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:function(blob,length){var bitSemi=1&blob[blob.l+1];return blob.l+=4,[bitSemi,1]}},64:{n:"PtgAttrSpace",f:function(blob,length){return blob.read_shift(2),parse_PtgAttrSpaceType(blob)}},65:{n:"PtgAttrSpaceSemi",f:function(blob,length){return blob.read_shift(2),parse_PtgAttrSpaceType(blob)}},255:{}};function parse_Formula(blob,length,opts){var cell=parse_XLSCell(blob),val=function(blob){var b;if(65535!==__readUInt16LE(blob,blob.l+6))return[parse_Xnum(blob),"n"];switch(blob[blob.l]){case 0:return blob.l+=8,["String","s"];case 1:return b=1===blob[blob.l+2],blob.l+=8,[b,"b"];case 2:return b=blob[blob.l+2],blob.l+=8,[b,"e"];case 3:return blob.l+=8,["","s"]}}(blob),flags=blob.read_shift(1);blob.read_shift(1);blob.read_shift(4);var cbf="";return 5===opts.biff?blob.l+=length-20:cbf=function(blob,length,opts){blob.l;var rgcb,cce=blob.read_shift(2);if(65535==cce)return[[],parsenoop(blob,length-2)];var rgce=parse_Rgce(blob,cce);length!==cce+2&&(rgcb=parse_RgbExtra(blob,length-cce-2,rgce,opts));return[rgce,rgcb]}(blob,length-20,opts),{cell:cell,val:val[0],formula:cbf,shared:flags>>3&1,tt:val[1]}}function parse_RgbExtra(blob,length,rgce,opts){if(opts.biff<8)return parsenoop(blob,length);for(var target=blob.l+length,o=[],i=0;i!==rgce.length;++i)switch(rgce[i][0]){case"PtgArray":rgce[i][1]=parse_PtgExtraArray(blob),o.push(rgce[i][1]);break;case"PtgMemArea":rgce[i][2]=parse_PtgExtraMem(blob,rgce[i][1]),o.push(rgce[i][2])}return 0!==(length=target-blob.l)&&o.push(parsenoop(blob,length)),o}function parse_Rgce(blob,length){for(var R,id,target=blob.l+length,ptgs=[];target!=blob.l;)length=target-blob.l,id=blob[blob.l],R=PtgTypes[id],24!==id&&25!==id||(R=(24===(id=blob[blob.l+1])?Ptg18:Ptg19)[id]),R&&R.f?ptgs.push([R.n,R.f(blob,length)]):ptgs.push(parsenoop(blob,length));return ptgs}function mapper(x){return x.map(function(y){return y[1]}).join(",")}function stringify_formula(formula,range,cell,supbooks,opts){if(void 0!==opts&&5===opts.biff)return"BIFF5??";var e1,e2,c,ixti,nameidx,r,_range=void 0!==range?range:{s:{c:0,r:0}},stack=[];if(!formula[0]||!formula[0][0])return"";for(var ff=0,fflen=formula[0].length;ff<fflen;++ff){var f=formula[0][ff];switch(f[0]){case"PtgUminus":stack.push("-"+stack.pop());break;case"PtgUplus":stack.push("+"+stack.pop());break;case"PtgPercent":stack.push(stack.pop()+"%");break;case"PtgAdd":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"+"+e1);break;case"PtgSub":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"-"+e1);break;case"PtgMul":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"*"+e1);break;case"PtgDiv":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"/"+e1);break;case"PtgPower":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"^"+e1);break;case"PtgConcat":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"&"+e1);break;case"PtgLt":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"<"+e1);break;case"PtgLe":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"<="+e1);break;case"PtgEq":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"="+e1);break;case"PtgGe":e1=stack.pop(),e2=stack.pop(),stack.push(e2+">="+e1);break;case"PtgGt":e1=stack.pop(),e2=stack.pop(),stack.push(e2+">"+e1);break;case"PtgNe":e1=stack.pop(),e2=stack.pop(),stack.push(e2+"<>"+e1);break;case"PtgIsect":e1=stack.pop(),e2=stack.pop(),stack.push(e2+" "+e1);break;case"PtgUnion":e1=stack.pop(),e2=stack.pop(),stack.push(e2+","+e1);break;case"PtgRange":case"PtgAttrChoose":case"PtgAttrGoto":case"PtgAttrIf":break;case"PtgRef":f[1][0],c=shift_cell_xls(decode_cell(encode_cell(f[1][1])),_range),stack.push(encode_cell(c));break;case"PtgRefN":f[1][0],c=shift_cell_xls(decode_cell(encode_cell(f[1][1])),cell),stack.push(encode_cell(c));break;case"PtgRef3d":f[1][0],ixti=f[1][1],c=shift_cell_xls(f[1][2],_range),stack.push(supbooks[1][ixti+1]+"!"+encode_cell(c));break;case"PtgFunc":case"PtgFuncVar":var argc=f[1][0],func=f[1][1];argc||(argc=0);var args=stack.slice(-argc);stack.length-=argc,"User"===func&&(func=args.shift()),stack.push(func+"("+args.join(",")+")");break;case"PtgBool":stack.push(f[1]?"TRUE":"FALSE");break;case"PtgInt":stack.push(f[1]);break;case"PtgNum":stack.push(String(f[1]));break;case"PtgStr":stack.push('"'+f[1]+'"');break;case"PtgErr":stack.push(f[1]);break;case"PtgArea":f[1][0],r=shift_range_xls(f[1][1],_range),stack.push(encode_range(r));break;case"PtgArea3d":f[1][0],ixti=f[1][1],r=f[1][2],stack.push(supbooks[1][ixti+1]+"!"+encode_range(r));break;case"PtgAttrSum":stack.push("SUM("+stack.pop()+")");break;case"PtgAttrSemi":break;case"PtgName":nameidx=f[1][2];var name=supbooks[0][nameidx].Name;name in XLSXFutureFunctions&&(name=XLSXFutureFunctions[name]),stack.push(name);break;case"PtgNameX":var externbook,bookidx=f[1][1];nameidx=f[1][2],supbooks[bookidx+1]?externbook=supbooks[bookidx+1][nameidx]:supbooks[bookidx-1]&&(externbook=supbooks[bookidx-1][nameidx]),externbook||(externbook={body:"??NAMEX??"}),stack.push(externbook.body);break;case"PtgParen":stack.push("("+stack.pop()+")");break;case"PtgRefErr":stack.push("#REF!");break;case"PtgExp":c={c:f[1][1],r:f[1][0]};var q={c:cell.c,r:cell.r};if(supbooks.sharedf[encode_cell(c)]){var parsedf=supbooks.sharedf[encode_cell(c)];stack.push(stringify_formula(parsedf,_range,q,supbooks,opts))}else{for(e1=0;e1!=supbooks.arrayf.length;++e1)e2=supbooks.arrayf[e1],c.c<e2[0].s.c||c.c>e2[0].e.c||c.r<e2[0].s.r||c.r>e2[0].e.r||stack.push(stringify_formula(e2[1],_range,q,supbooks,opts));stack.push(f[1])}break;case"PtgArray":stack.push("{"+f[1].map(mapper).join(";")+"}");break;case"PtgMemArea":case"PtgAttrSpace":case"PtgTbl":case"PtgMemErr":break;case"PtgMissArg":stack.push("");break;case"PtgAreaErr":break;case"PtgAreaN":stack.push("");break;case"PtgRefErr3d":case"PtgMemFunc":break;default:throw"Unrecognized Formula Token: "+f}}return stack[0]}function parse_XLSBCellParsedFormula(data,length){data.read_shift(4);return parsenoop(data,length-4)}var Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD"},FtabArgc={2:1,3:1,15:1,16:1,17:1,18:1,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,65:3,66:3,67:1,68:1,69:1,71:1,72:1,73:1,75:1,76:1,77:1,79:2,80:2,83:1,86:1,90:1,97:2,98:1,99:1,105:1,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,189:3,190:1,195:3,196:3,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,65535:0},XLSXFutureFunctions={"_xlfn.ACOT":"ACOT","_xlfn.ACOTH":"ACOTH","_xlfn.AGGREGATE":"AGGREGATE","_xlfn.ARABIC":"ARABIC","_xlfn.AVERAGEIF":"AVERAGEIF","_xlfn.AVERAGEIFS":"AVERAGEIFS","_xlfn.BASE":"BASE","_xlfn.BETA.DIST":"BETA.DIST","_xlfn.BETA.INV":"BETA.INV","_xlfn.BINOM.DIST":"BINOM.DIST","_xlfn.BINOM.DIST.RANGE":"BINOM.DIST.RANGE","_xlfn.BINOM.INV":"BINOM.INV","_xlfn.BITAND":"BITAND","_xlfn.BITLSHIFT":"BITLSHIFT","_xlfn.BITOR":"BITOR","_xlfn.BITRSHIFT":"BITRSHIFT","_xlfn.BITXOR":"BITXOR","_xlfn.CEILING.MATH":"CEILING.MATH","_xlfn.CEILING.PRECISE":"CEILING.PRECISE","_xlfn.CHISQ.DIST":"CHISQ.DIST","_xlfn.CHISQ.DIST.RT":"CHISQ.DIST.RT","_xlfn.CHISQ.INV":"CHISQ.INV","_xlfn.CHISQ.INV.RT":"CHISQ.INV.RT","_xlfn.CHISQ.TEST":"CHISQ.TEST","_xlfn.COMBINA":"COMBINA","_xlfn.CONFIDENCE.NORM":"CONFIDENCE.NORM","_xlfn.CONFIDENCE.T":"CONFIDENCE.T","_xlfn.COT":"COT","_xlfn.COTH":"COTH","_xlfn.COUNTIFS":"COUNTIFS","_xlfn.COVARIANCE.P":"COVARIANCE.P","_xlfn.COVARIANCE.S":"COVARIANCE.S","_xlfn.CSC":"CSC","_xlfn.CSCH":"CSCH","_xlfn.DAYS":"DAYS","_xlfn.DECIMAL":"DECIMAL","_xlfn.ECMA.CEILING":"ECMA.CEILING","_xlfn.ERF.PRECISE":"ERF.PRECISE","_xlfn.ERFC.PRECISE":"ERFC.PRECISE","_xlfn.EXPON.DIST":"EXPON.DIST","_xlfn.F.DIST":"F.DIST","_xlfn.F.DIST.RT":"F.DIST.RT","_xlfn.F.INV":"F.INV","_xlfn.F.INV.RT":"F.INV.RT","_xlfn.F.TEST":"F.TEST","_xlfn.FILTERXML":"FILTERXML","_xlfn.FLOOR.MATH":"FLOOR.MATH","_xlfn.FLOOR.PRECISE":"FLOOR.PRECISE","_xlfn.FORMULATEXT":"FORMULATEXT","_xlfn.GAMMA":"GAMMA","_xlfn.GAMMA.DIST":"GAMMA.DIST","_xlfn.GAMMA.INV":"GAMMA.INV","_xlfn.GAMMALN.PRECISE":"GAMMALN.PRECISE","_xlfn.GAUSS":"GAUSS","_xlfn.HYPGEOM.DIST":"HYPGEOM.DIST","_xlfn.IFNA":"IFNA","_xlfn.IFERROR":"IFERROR","_xlfn.IMCOSH":"IMCOSH","_xlfn.IMCOT":"IMCOT","_xlfn.IMCSC":"IMCSC","_xlfn.IMCSCH":"IMCSCH","_xlfn.IMSEC":"IMSEC","_xlfn.IMSECH":"IMSECH","_xlfn.IMSINH":"IMSINH","_xlfn.IMTAN":"IMTAN","_xlfn.ISFORMULA":"ISFORMULA","_xlfn.ISO.CEILING":"ISO.CEILING","_xlfn.ISOWEEKNUM":"ISOWEEKNUM","_xlfn.LOGNORM.DIST":"LOGNORM.DIST","_xlfn.LOGNORM.INV":"LOGNORM.INV","_xlfn.MODE.MULT":"MODE.MULT","_xlfn.MODE.SNGL":"MODE.SNGL","_xlfn.MUNIT":"MUNIT","_xlfn.NEGBINOM.DIST":"NEGBINOM.DIST","_xlfn.NETWORKDAYS.INTL":"NETWORKDAYS.INTL","_xlfn.NIGBINOM":"NIGBINOM","_xlfn.NORM.DIST":"NORM.DIST","_xlfn.NORM.INV":"NORM.INV","_xlfn.NORM.S.DIST":"NORM.S.DIST","_xlfn.NORM.S.INV":"NORM.S.INV","_xlfn.NUMBERVALUE":"NUMBERVALUE","_xlfn.PDURATION":"PDURATION","_xlfn.PERCENTILE.EXC":"PERCENTILE.EXC","_xlfn.PERCENTILE.INC":"PERCENTILE.INC","_xlfn.PERCENTRANK.EXC":"PERCENTRANK.EXC","_xlfn.PERCENTRANK.INC":"PERCENTRANK.INC","_xlfn.PERMUTATIONA":"PERMUTATIONA","_xlfn.PHI":"PHI","_xlfn.POISSON.DIST":"POISSON.DIST","_xlfn.QUARTILE.EXC":"QUARTILE.EXC","_xlfn.QUARTILE.INC":"QUARTILE.INC","_xlfn.QUERYSTRING":"QUERYSTRING","_xlfn.RANK.AVG":"RANK.AVG","_xlfn.RANK.EQ":"RANK.EQ","_xlfn.RRI":"RRI","_xlfn.SEC":"SEC","_xlfn.SECH":"SECH","_xlfn.SHEET":"SHEET","_xlfn.SHEETS":"SHEETS","_xlfn.SKEW.P":"SKEW.P","_xlfn.STDEV.P":"STDEV.P","_xlfn.STDEV.S":"STDEV.S","_xlfn.SUMIFS":"SUMIFS","_xlfn.T.DIST":"T.DIST","_xlfn.T.DIST.2T":"T.DIST.2T","_xlfn.T.DIST.RT":"T.DIST.RT","_xlfn.T.INV":"T.INV","_xlfn.T.INV.2T":"T.INV.2T","_xlfn.T.TEST":"T.TEST","_xlfn.UNICHAR":"UNICHAR","_xlfn.UNICODE":"UNICODE","_xlfn.VAR.P":"VAR.P","_xlfn.VAR.S":"VAR.S","_xlfn.WEBSERVICE":"WEBSERVICE","_xlfn.WEIBULL.DIST":"WEIBULL.DIST","_xlfn.WORKDAY.INTL":"WORKDAY.INTL","_xlfn.XOR":"XOR","_xlfn.Z.TEST":"Z.TEST"},strs={},_ssfopts={};function get_sst_id(sst,str){for(var i=0,len=sst.length;i<len;++i)if(sst[i].t===str)return sst.Count++,i;return sst[len]={t:str},sst.Count++,sst.Unique++,len}function get_cell_style(styles,cell,opts){for(var z=opts.revssf[null!=cell.z?cell.z:"General"],i=0,len=styles.length;i!=len;++i)if(styles[i].numFmtId===z)return i;return styles[len]={numFmtId:z,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},len}function safe_format(p,fmtid,fillid,opts){try{if("e"===p.t)p.w=p.w||BErr[p.v];else if(0===fmtid)if("n"===p.t)(0|p.v)===p.v?p.w=SSF._general_int(p.v,_ssfopts):p.w=SSF._general_num(p.v,_ssfopts);else if("d"===p.t){var dd=datenum(p.v);p.w=(0|dd)===dd?SSF._general_int(dd,_ssfopts):SSF._general_num(dd,_ssfopts)}else{if(void 0===p.v)return"";p.w=SSF._general(p.v,_ssfopts)}else"d"===p.t?p.w=SSF.format(fmtid,datenum(p.v),_ssfopts):p.w=SSF.format(fmtid,p.v,_ssfopts);opts.cellNF&&(p.z=SSF._table[fmtid])}catch(e){if(opts.WTF)throw e}if(fillid)try{p.s=styles.Fills[fillid],p.s.fgColor&&p.s.fgColor.theme&&(p.s.fgColor.rgb=rgb_tint(themes.themeElements.clrScheme[p.s.fgColor.theme].rgb,p.s.fgColor.tint||0),opts.WTF&&(p.s.fgColor.raw_rgb=themes.themeElements.clrScheme[p.s.fgColor.theme].rgb)),p.s.bgColor&&p.s.bgColor.theme&&(p.s.bgColor.rgb=rgb_tint(themes.themeElements.clrScheme[p.s.bgColor.theme].rgb,p.s.bgColor.tint||0),opts.WTF&&(p.s.bgColor.raw_rgb=themes.themeElements.clrScheme[p.s.bgColor.theme].rgb))}catch(e){if(opts.WTF)throw e}}RELS.WS="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet";var mergecregex=/<mergeCell ref="[A-Z0-9:]+"\s*\/>/g,sheetdataregex=/<(?:\w+:)?sheetData>([^\u2603]*)<\/(?:\w+:)?sheetData>/,hlinkregex=/<hyperlink[^>]*\/>/g,dimregex=/"(\w*:\w*)"/,colregex=/<col[^>]*\/>/g;function parse_ws_xml(data,opts,rels){if(!data)return data;var s={},ridx=data.indexOf("<dimension");if(ridx>0){var ref=data.substr(ridx,50).match(dimregex);null!=ref&&function(ws,s){var d=safe_decode_range(s);d.s.r<=d.e.r&&d.s.c<=d.e.c&&d.s.r>=0&&d.s.c>=0&&(ws["!ref"]=encode_range(d))}(s,ref[1])}var mergecells=[];if(-1!==data.indexOf("</mergeCells>")){var merges=data.match(mergecregex);for(ridx=0;ridx!=merges.length;++ridx)mergecells[ridx]=safe_decode_range(merges[ridx].substr(merges[ridx].indexOf('"')+1))}var columns=[];opts.cellStyles&&-1!==data.indexOf("</cols>")&&function(columns,cols){for(var seencol=!1,coli=0;coli!=cols.length;++coli){var coll=parsexmltag(cols[coli],!0),colm=parseInt(coll.min,10)-1,colM=parseInt(coll.max,10)-1;for(delete coll.min,delete coll.max,!seencol&&coll.width&&(seencol=!0,find_mdw(+coll.width)),coll.width&&(coll.wpx=width2px(+coll.width),coll.wch=px2char(coll.wpx),coll.MDW=MDW);colm<=colM;)columns[colm++]=coll}}(columns,data.match(colregex));var refguess={s:{r:1e6,c:1e6},e:{r:0,c:0}},mtch=data.match(sheetdataregex);if(mtch&&parse_ws_xml_data(mtch[1],s,opts,refguess),-1!==data.indexOf("</hyperlinks>")&&function(s,data,rels){for(var i=0;i!=data.length;++i){var val=parsexmltag(data[i],!0);if(!val.ref)return;var rel=rels?rels["!id"][val.id]:null;rel?(val.Target=rel.Target,val.location&&(val.Target+="#"+val.location),val.Rel=rel):(val.Target=val.location,rel={Target:val.location,TargetMode:"Internal"},val.Rel=rel);for(var rng=safe_decode_range(val.ref),R=rng.s.r;R<=rng.e.r;++R)for(var C=rng.s.c;C<=rng.e.c;++C){var addr=encode_cell({c:C,r:R});s[addr]||(s[addr]={t:"stub",v:void 0}),s[addr].l=val}}}(s,data.match(hlinkregex),rels),!s["!ref"]&&refguess.e.c>=refguess.s.c&&refguess.e.r>=refguess.s.r&&(s["!ref"]=encode_range(refguess)),opts.sheetRows>0&&s["!ref"]){var tmpref=safe_decode_range(s["!ref"]);opts.sheetRows<+tmpref.e.r&&(tmpref.e.r=opts.sheetRows-1,tmpref.e.r>refguess.e.r&&(tmpref.e.r=refguess.e.r),tmpref.e.r<tmpref.s.r&&(tmpref.s.r=tmpref.e.r),tmpref.e.c>refguess.e.c&&(tmpref.e.c=refguess.e.c),tmpref.e.c<tmpref.s.c&&(tmpref.s.c=tmpref.e.c),s["!fullref"]=s["!ref"],s["!ref"]=encode_range(tmpref))}return mergecells.length>0&&(s["!merges"]=mergecells),columns.length>0&&(s["!cols"]=columns),s}function write_ws_xml_cell(cell,ref,ws,opts,idx,wb){if(void 0===cell.v)return"";var vv="",oldt=cell.t,oldv=cell.v;switch(cell.t){case"b":vv=cell.v?"1":"0";break;case"n":vv=""+cell.v;break;case"e":vv=BErr[cell.v];break;case"d":opts.cellDates?vv=new Date(cell.v).toISOString():(cell.t="n",vv=""+(cell.v=datenum(cell.v)),void 0===cell.z&&(cell.z=SSF._table[14]));break;default:vv=cell.v}var v=writetag("v",escapexml(vv)),o={r:ref},os=get_cell_style(opts.cellXfs,cell,opts);switch(0!==os&&(o.s=os),cell.t){case"n":break;case"d":o.t="d";break;case"b":o.t="b";break;case"e":o.t="e";break;default:if(opts.bookSST){v=writetag("v",""+get_sst_id(opts.Strings,cell.v)),o.t="s";break}o.t="str"}return cell.t!=oldt&&(cell.t=oldt,cell.v=oldv),writextag("c",v,o)}var cellregex,rowregex,rregex,isregex,match_v,match_f,parse_ws_xml_data=(cellregex=/<(?:\w+:)?c[ >]/,rowregex=/<\/(?:\w+:)?row>/,rregex=/r=["']([^"']*)["']/,isregex=/<is>([\S\s]*?)<\/is>/,match_v=matchtag("v"),match_f=matchtag("f"),function(sdata,s,opts,guess){for(var p,tag,sstr,cf,ri=0,x="",cells=[],cref=[],idx=0,i=0,cc=0,d="",tagr=0,tagc=0,fmtid=0,fillid=0,do_format=Array.isArray(styles.CellXf),marr=sdata.split(rowregex),mt=0,marrlen=marr.length;mt!=marrlen;++mt){var xlen=(x=marr[mt].trim()).length;if(0!==xlen){for(ri=0;ri<xlen&&62!==x.charCodeAt(ri);++ri);if(++ri,tagr=void 0!==(tag=parsexmltag(x.substr(0,ri),!0)).r?parseInt(tag.r,10):tagr+1,tagc=-1,!(opts.sheetRows&&opts.sheetRows<tagr))for(guess.s.r>tagr-1&&(guess.s.r=tagr-1),guess.e.r<tagr-1&&(guess.e.r=tagr-1),cells=x.substr(ri).split(cellregex),ri=void 0===tag.r?0:1;ri!=cells.length;++ri)if(0!==(x=cells[ri].trim()).length){if(cref=x.match(rregex),idx=ri,i=0,cc=0,x="<c "+("<"==x.substr(0,1)?">":"")+x,null!==cref&&2===cref.length){for(idx=0,d=cref[1],i=0;i!=d.length&&!((cc=d.charCodeAt(i)-64)<1||cc>26);++i)idx=26*idx+cc;tagc=--idx}else++tagc;for(i=0;i!=x.length&&62!==x.charCodeAt(i);++i);if(++i,(tag=parsexmltag(x.substr(0,i),!0)).r||(tag.r=utils.encode_cell({r:tagr-1,c:tagc})),p={t:""},null!==(cref=(d=x.substr(i)).match(match_v))&&""!==cref[1]&&(p.v=unescapexml(cref[1])),opts.cellFormula&&null!==(cref=d.match(match_f))&&(p.f=unescapexml(cref[1])),void 0===tag.t&&void 0===p.v){if(!opts.sheetStubs)continue;p.t="stub"}else p.t=tag.t||"n";switch(guess.s.c>idx&&(guess.s.c=idx),guess.e.c<idx&&(guess.e.c=idx),p.t){case"n":p.v=parseFloat(p.v);break;case"s":sstr=strs[parseInt(p.v,10)],p.v=sstr.t,p.r=sstr.r,opts.cellHTML&&(p.h=sstr.h);break;case"str":p.t="s",p.v=null!=p.v?utf8read(p.v):"",opts.cellHTML&&(p.h=p.v);break;case"inlineStr":cref=d.match(isregex),p.t="s",null!==cref?(sstr=parse_si(cref[1]),p.v=sstr.t):p.v="";break;case"b":p.v=parsexmlbool(p.v);break;case"d":opts.cellDates||(p.v=datenum(p.v),p.t="n");break;case"e":p.w=p.v,p.v=RBErr[p.v]}fmtid=fillid=0,do_format&&void 0!==tag.s&&null!=(cf=styles.CellXf[tag.s])&&(null!=cf.numFmtId&&(fmtid=cf.numFmtId),opts.cellStyles&&null!=cf.fillId&&(fillid=cf.fillId)),safe_format(p,fmtid,fillid,opts),s[tag.r]=p}}}});var WS_XML_ROOT=writextag("worksheet",null,{xmlns:XMLNS.main[0],"xmlns:r":XMLNS.r});function write_ws_xml(idx,opts,wb){var sidx,o=[XML_HEADER,WS_XML_ROOT],s=wb.SheetNames[idx],rdata="",ws=wb.Sheets[s];void 0===ws&&(ws={});var ref=ws["!ref"];return void 0===ref&&(ref="A1"),o[o.length]=writextag("dimension",null,{ref:ref}),void 0!==ws["!cols"]&&ws["!cols"].length>0&&(o[o.length]=function(ws,cols){for(var col,width,o=["<cols>"],i=0;i!=cols.length;++i)if(col=cols[i]){var p={min:i+1,max:i+1};width=-1,col.wpx?width=px2char(col.wpx):col.wch&&(width=col.wch),width>-1&&(p.width=char2width(width),p.customWidth=1),o[o.length]=writextag("col",null,p)}return o[o.length]="</cols>",o.join("")}(0,ws["!cols"])),o[sidx=o.length]="<sheetData/>",void 0!==ws["!ref"]&&(rdata=function(ws,opts,idx,wb){var cell,ref,R,C,o=[],r=[],range=safe_decode_range(ws["!ref"]),rr="",cols=[];for(C=range.s.c;C<=range.e.c;++C)cols[C]=encode_col(C);for(R=range.s.r;R<=range.e.r;++R){for(r=[],rr=encode_row(R),C=range.s.c;C<=range.e.c;++C)void 0!==ws[ref=cols[C]+rr]&&null!=(cell=write_ws_xml_cell(ws[ref],ref,0,opts))&&r.push(cell);r.length>0&&(o[o.length]=writextag("row",r.join(""),{r:rr}))}return o.join("")}(ws,opts)).length>0&&(o[o.length]=rdata),o.length>sidx+1&&(o[o.length]="</sheetData>",o[sidx]=o[sidx].replace("/>",">")),void 0!==ws["!merges"]&&ws["!merges"].length>0&&(o[o.length]=function(merges){if(0==merges.length)return"";for(var o='<mergeCells count="'+merges.length+'">',i=0;i!=merges.length;++i)o+='<mergeCell ref="'+encode_range(merges[i])+'"/>';return o+"</mergeCells>"}(ws["!merges"])),o.length>2&&(o[o.length]="</worksheet>",o[1]=o[1].replace("/>",">")),o.join("")}var parse_BrtWsDim=parse_UncheckedRfX,write_BrtWsDim=function(r,o){return o||(o=new_buf(16)),o.write_shift(4,r.s.r),o.write_shift(4,r.e.r),o.write_shift(4,r.s.c),o.write_shift(4,r.e.c),o};function write_BrtCellBlank(cell,val,o){return null==o&&(o=new_buf(8)),function(cell,o){return null==o&&(o=new_buf(8)),o.write_shift(-4,cell.c),o.write_shift(3,void 0===cell.iStyleRef?cell.iStyleRef:cell.s),o.write_shift(1,0),o}(val,o)}var parse_BrtMergeCell=parse_UncheckedRfX;function write_ws_bin_cell(ba,cell,R,C,opts){if(void 0===cell.v)return"";switch(cell.t){case"b":cell.v?"1":"0";break;case"n":case"e":""+cell.v;break;default:cell.v}var o={r:R,c:C};switch(o.s=get_cell_style(opts.cellXfs,cell,opts),cell.t){case"s":case"str":if(opts.bookSST){get_sst_id(opts.Strings,cell.v),o.t="s";break}o.t="str";break;case"n":break;case"b":o.t="b";break;case"e":o.t="e"}write_record(ba,"BrtCellBlank",write_BrtCellBlank(0,o))}function write_ws_bin(idx,opts,wb){var ba=buf_array(),s=wb.SheetNames[idx],ws=wb.Sheets[s]||{},r=safe_decode_range(ws["!ref"]||"A1");return write_record(ba,"BrtBeginSheet"),write_record(ba,"BrtWsDim",write_BrtWsDim(r)),function(ba,ws,idx,opts,wb){var ref,range=safe_decode_range(ws["!ref"]||"A1"),rr="",cols=[];write_record(ba,"BrtBeginSheetData");for(var R=range.s.r;R<=range.e.r;++R){rr=encode_row(R);for(var C=range.s.c;C<=range.e.c;++C)R===range.s.r&&(cols[C]=encode_col(C)),ws[ref=cols[C]+rr]&&write_ws_bin_cell(ba,ws[ref],R,C,opts)}write_record(ba,"BrtEndSheetData")}(ba,ws,0,opts),write_record(ba,"BrtEndSheet"),ba.end()}var WBPropsDef=[["allowRefreshQuery","0"],["autoCompressPictures","1"],["backupFile","0"],["checkCompatibility","0"],["codeName",""],["date1904","0"],["dateCompatibility","1"],["filterPrivacy","0"],["hidePivotFieldList","0"],["promptedSolutions","0"],["publishItems","0"],["refreshAllConnections",!1],["saveExternalLinkValues","1"],["showBorderUnselectedTables","1"],["showInkAnnotation","1"],["showObjects","all"],["showPivotChartFilter","0"]],WBViewDef=[["activeTab","0"],["autoFilterDateGrouping","1"],["firstSheet","0"],["minimized","0"],["showHorizontalScroll","1"],["showSheetTabs","1"],["showVerticalScroll","1"],["tabRatio","600"],["visibility","visible"]],SheetDef=[["state","visible"]],CalcPrDef=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function push_defaults_array(target,defaults){for(var j=0;j!=target.length;++j)for(var w=target[j],i=0;i!=defaults.length;++i){var z=defaults[i];null==w[z[0]]&&(w[z[0]]=z[1])}}function push_defaults(target,defaults){for(var i=0;i!=defaults.length;++i){var z=defaults[i];null==target[z[0]]&&(target[z[0]]=z[1])}}function parse_wb_defaults(wb){push_defaults(wb.WBProps,WBPropsDef),push_defaults(wb.CalcPr,CalcPrDef),push_defaults_array(wb.WBView,WBViewDef),push_defaults_array(wb.Sheets,SheetDef),_ssfopts.date1904=parsexmlbool(wb.WBProps.date1904)}var wbnsregex=/<\w+:workbook/;function parse_wb_xml(data,opts){var wb={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},pass=!1,xmlns="xmlns";if(data.match(tagregex).forEach(function(x){var y=parsexmltag(x);switch(function(x){return x.replace(nsregex2,"<$1")}(y[0])){case"<?xml":break;case"<workbook":x.match(wbnsregex)&&(xmlns="xmlns"+x.match(/<(\w+):/)[1]),wb.xmlns=y[xmlns];break;case"</workbook>":break;case"<fileVersion":delete y[0],wb.AppVersion=y;break;case"<fileVersion/>":break;case"<fileSharing":case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":delete y[0],wb.WBProps=y;break;case"<workbookProtection":case"<workbookProtection/>":break;case"<bookViews>":case"</bookViews>":break;case"<workbookView":delete y[0],wb.WBView.push(y);break;case"<sheets>":case"</sheets>":break;case"<sheet":delete y[0],y.name=utf8read(y.name),wb.Sheets.push(y);break;case"<functionGroups":case"<functionGroups/>":case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":case"<externalReference":case"<definedNames/>":break;case"<definedNames>":case"<definedNames":pass=!0;break;case"</definedNames>":pass=!1;break;case"<definedName":case"<definedName/>":case"</definedName>":break;case"<calcPr":case"<calcPr/>":delete y[0],wb.CalcPr=y;break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":case"<webPublishObject":break;case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":pass=!0;break;case"</ext>":pass=!1;break;case"<ArchID":break;case"<AlternateContent":pass=!0;break;case"</AlternateContent>":pass=!1;break;default:if(!pass&&opts.WTF)throw"unrecognized "+y[0]+" in workbook"}}),-1===XMLNS.main.indexOf(wb.xmlns))throw new Error("Unknown Namespace: "+wb.xmlns);return parse_wb_defaults(wb),wb}var WB_XML_ROOT=writextag("workbook",null,{xmlns:XMLNS.main[0],"xmlns:r":XMLNS.r});function write_wb_xml(wb,opts){var o=[XML_HEADER];o[o.length]=WB_XML_ROOT,o[o.length]=writextag("workbookPr",null,{date1904:function(wb){try{return parsexmlbool(wb.Workbook.WBProps.date1904)?"true":"false"}catch(e){return"false"}}(wb)}),o[o.length]="<sheets>";for(var i=0;i!=wb.SheetNames.length;++i)o[o.length]=writextag("sheet",null,{name:wb.SheetNames[i].substr(0,31),sheetId:""+(i+1),"r:id":"rId"+(i+1)});return o[o.length]="</sheets>",o.length>2&&(o[o.length]="</workbook>",o[1]=o[1].replace("/>",">")),o.join("")}function write_BrtCalcProp(data,o){return o||(o=new_buf(26)),o.write_shift(4,0),o.write_shift(4,1),o.write_shift(4,0),function(data,o){(o||new_buf(8)).write_shift(8,"f",data)}(0,o),o.write_shift(-4,1023),o.write_shift(1,51),o.write_shift(1,0),o}function write_wb_bin(wb,opts){var o,ba=buf_array();return write_record(ba,"BrtBeginBook"),write_record(ba,"BrtFileVersion",function(data,o){o||(o=new_buf(127));for(var i=0;4!=i;++i)o.write_shift(4,0);return write_XLWideString("SheetJS",o),write_XLWideString(XLSX.version,o),write_XLWideString(XLSX.version,o),write_XLWideString("7262",o),o.length=o.l,o}()),write_record(ba,"BrtWbProp",(o||(o=new_buf(8)),o.write_shift(4,0),o.write_shift(4,0),o)),function(ba,wb,opts){write_record(ba,"BrtBeginBookViews"),write_record(ba,"BrtEndBookViews")}(ba),function(ba,wb,opts){write_record(ba,"BrtBeginBundleShs");for(var idx=0;idx!=wb.SheetNames.length;++idx){var d={hsState:0,iTabID:idx+1,strRelID:"rId"+(idx+1),name:wb.SheetNames[idx]};write_record(ba,"BrtBundleSh",(data=d,(o=void 0)||(o=new_buf(127)),o.write_shift(4,data.hsState),o.write_shift(4,data.iTabID),write_RelID(data.strRelID,o),write_XLWideString(data.name.substr(0,31),o),o))}var data,o;write_record(ba,"BrtEndBundleShs")}(ba,wb),write_record(ba,"BrtCalcProp",write_BrtCalcProp()),write_record(ba,"BrtFileRecover",function(data,o){return o||(o=new_buf(1)),o.write_shift(1,0),o}()),write_record(ba,"BrtEndBook"),ba.end()}function parse_wb(data,name,opts){return(".bin"===name.substr(-4)?function(data,opts){var wb={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},pass=!1;return recordhopper(data,function(val,R){switch(R.n){case"BrtBundleSh":wb.Sheets.push(val);break;case"BrtBeginBook":case"BrtFileVersion":case"BrtWbProp":case"BrtACBegin":case"BrtAbsPath15":case"BrtACEnd":case"BrtWbFactoid":case"BrtBookProtection":case"BrtBeginBookViews":case"BrtBookView":case"BrtEndBookViews":case"BrtBeginBundleShs":case"BrtEndBundleShs":case"BrtBeginFnGroup":case"BrtEndFnGroup":case"BrtBeginExternals":case"BrtSupSelf":case"BrtSupBookSrc":case"BrtExternSheet":case"BrtEndExternals":case"BrtName":case"BrtCalcProp":case"BrtUserBookView":case"BrtBeginPivotCacheIDs":case"BrtBeginPivotCacheID":case"BrtEndPivotCacheID":case"BrtEndPivotCacheIDs":case"BrtWebOpt":case"BrtFileRecover":case"BrtFileSharing":case"BrtBeginSmartTagTypes":case"BrtSmartTagType":case"BrtEndSmartTagTypes":break;case"BrtFRTBegin":pass=!0;break;case"BrtFRTArchID$":case"BrtWorkBookPr15":break;case"BrtFRTEnd":pass=!1;break;case"BrtEndBook":break;default:if(!pass||opts.WTF)throw new Error("Unexpected record "+R.n)}}),parse_wb_defaults(wb),wb}:parse_wb_xml)(data,opts)}function parse_ws(data,name,opts,rels){return(".bin"===name.substr(-4)?function(data,opts,rels){if(!data)return data;rels||(rels={"!id":{}});var ref,row,p,cf,C,addr,sstr,rr,s={},refguess={s:{r:1e6,c:1e6},e:{r:0,c:0}},pass=!1,end=!1,mergecells=[];if(recordhopper(data,function(val,R){if(!end)switch(R.n){case"BrtWsDim":ref=val;break;case"BrtRowHdr":row=val,opts.sheetRows&&opts.sheetRows<=row.r&&(end=!0),rr=encode_row(row.r);break;case"BrtFmlaBool":case"BrtFmlaError":case"BrtFmlaNum":case"BrtFmlaString":case"BrtCellBool":case"BrtCellError":case"BrtCellIsst":case"BrtCellReal":case"BrtCellRk":case"BrtCellSt":switch(p={t:val[2]},val[2]){case"n":p.v=val[1];break;case"s":sstr=strs[val[1]],p.v=sstr.t,p.r=sstr.r;break;case"b":p.v=!!val[1];break;case"e":p.v=val[1],p.w=BErr[p.v];break;case"str":p.t="s",p.v=utf8read(val[1])}opts.cellFormula&&val.length>3&&(p.f=val[3]),(cf=styles.CellXf[val[0].iStyleRef])&&safe_format(p,cf.ifmt,null,opts),s[encode_col(C=val[0].c)+rr]=p,refguess.s.r>row.r&&(refguess.s.r=row.r),refguess.s.c>C&&(refguess.s.c=C),refguess.e.r<row.r&&(refguess.e.r=row.r),refguess.e.c<C&&(refguess.e.c=C);break;case"BrtCellBlank":if(!opts.sheetStubs)break;p={t:"s",v:void 0},s[encode_col(C=val[0].c)+rr]=p,refguess.s.r>row.r&&(refguess.s.r=row.r),refguess.s.c>C&&(refguess.s.c=C),refguess.e.r<row.r&&(refguess.e.r=row.r),refguess.e.c<C&&(refguess.e.c=C);break;case"BrtBeginMergeCells":case"BrtEndMergeCells":break;case"BrtMergeCell":mergecells.push(val);break;case"BrtHLink":var rel=rels["!id"][val.relId];for(rel&&(val.Target=rel.Target,val.loc&&(val.Target+="#"+val.loc),val.Rel=rel),R=val.rfx.s.r;R<=val.rfx.e.r;++R)for(C=val.rfx.s.c;C<=val.rfx.e.c;++C)addr=encode_cell({c:C,r:R}),s[addr]||(s[addr]={t:"s",v:void 0}),s[addr].l=val;break;case"BrtArrFmla":case"BrtShrFmla":case"BrtBeginSheet":case"BrtWsProp":case"BrtSheetCalcProp":case"BrtBeginWsViews":case"BrtBeginWsView":case"BrtPane":case"BrtSel":case"BrtEndWsView":case"BrtEndWsViews":case"BrtACBegin":case"BrtRwDescent":case"BrtACEnd":case"BrtWsFmtInfoEx14":case"BrtWsFmtInfo":case"BrtBeginColInfos":case"BrtColInfo":case"BrtEndColInfos":case"BrtBeginSheetData":case"BrtEndSheetData":case"BrtSheetProtection":case"BrtPrintOptions":case"BrtMargins":case"BrtPageSetup":break;case"BrtFRTBegin":pass=!0;break;case"BrtFRTEnd":pass=!1;break;case"BrtEndSheet":case"BrtDrawing":case"BrtLegacyDrawing":case"BrtLegacyDrawingHF":case"BrtPhoneticInfo":case"BrtBeginHeaderFooter":case"BrtEndHeaderFooter":case"BrtBrk":case"BrtBeginRwBrk":case"BrtEndRwBrk":case"BrtBeginColBrk":case"BrtEndColBrk":case"BrtBeginUserShViews":case"BrtBeginUserShView":case"BrtEndUserShView":case"BrtEndUserShViews":case"BrtBkHim":case"BrtBeginOleObjects":case"BrtOleObject":case"BrtEndOleObjects":case"BrtBeginListParts":case"BrtListPart":case"BrtEndListParts":case"BrtBeginSortState":case"BrtBeginSortCond":case"BrtEndSortCond":case"BrtEndSortState":case"BrtBeginConditionalFormatting":case"BrtEndConditionalFormatting":case"BrtBeginCFRule":case"BrtEndCFRule":case"BrtBeginDVals":case"BrtDVal":case"BrtEndDVals":case"BrtRangeProtection":case"BrtBeginDCon":case"BrtEndDCon":case"BrtBeginDRefs":case"BrtDRef":case"BrtEndDRefs":case"BrtBeginActiveXControls":case"BrtActiveX":case"BrtEndActiveXControls":case"BrtBeginAFilter":case"BrtEndAFilter":case"BrtBeginFilterColumn":case"BrtBeginFilters":case"BrtFilter":case"BrtEndFilters":case"BrtEndFilterColumn":case"BrtDynamicFilter":case"BrtTop10Filter":case"BrtBeginCustomFilters":case"BrtCustomFilter":case"BrtEndCustomFilters":case"BrtBeginSmartTags":case"BrtBeginCellSmartTags":case"BrtBeginCellSmartTag":case"BrtCellSmartTagProperty":case"BrtEndCellSmartTag":case"BrtEndCellSmartTags":case"BrtEndSmartTags":case"BrtBeginCellWatches":case"BrtCellWatch":case"BrtEndCellWatches":case"BrtTable":case"BrtBeginCellIgnoreECs":case"BrtCellIgnoreEC":case"BrtEndCellIgnoreECs":break;default:if(!pass||opts.WTF)throw new Error("Unexpected record "+R.n)}},opts),!s["!ref"]&&(refguess.s.r<1e6||ref.e.r>0||ref.e.c>0||ref.s.r>0||ref.s.c>0)&&(s["!ref"]=encode_range(ref)),opts.sheetRows&&s["!ref"]){var tmpref=safe_decode_range(s["!ref"]);opts.sheetRows<+tmpref.e.r&&(tmpref.e.r=opts.sheetRows-1,tmpref.e.r>refguess.e.r&&(tmpref.e.r=refguess.e.r),tmpref.e.r<tmpref.s.r&&(tmpref.s.r=tmpref.e.r),tmpref.e.c>refguess.e.c&&(tmpref.e.c=refguess.e.c),tmpref.e.c<tmpref.s.c&&(tmpref.s.c=tmpref.e.c),s["!fullref"]=s["!ref"],s["!ref"]=encode_range(tmpref))}return mergecells.length>0&&(s["!merges"]=mergecells),s}:parse_ws_xml)(data,opts,rels)}function parse_sty(data,name,opts){return(".bin"===name.substr(-4)?function(data,opts){for(var y in styles.NumberFmt=[],SSF._table)styles.NumberFmt[y]=SSF._table[y];styles.CellXf=[];var state="",pass=!1;return recordhopper(data,function(val,R,RT){switch(R.n){case"BrtFmt":styles.NumberFmt[val[0]]=val[1],SSF.load(val[1],val[0]);break;case"BrtFont":case"BrtKnownFonts":case"BrtFill":case"BrtBorder":break;case"BrtXF":"CELLXFS"===state&&styles.CellXf.push(val);break;case"BrtStyle":case"BrtDXF":case"BrtMRUColor":case"BrtIndexedColor":case"BrtBeginStyleSheet":case"BrtEndStyleSheet":case"BrtBeginTableStyle":case"BrtTableStyleElement":case"BrtEndTableStyle":break;case"BrtBeginFmts":state="FMTS";break;case"BrtEndFmts":state="";break;case"BrtBeginFonts":state="FONTS";break;case"BrtEndFonts":state="";break;case"BrtACBegin":state="ACFONTS";break;case"BrtACEnd":state="";break;case"BrtBeginFills":state="FILLS";break;case"BrtEndFills":state="";break;case"BrtBeginBorders":state="BORDERS";break;case"BrtEndBorders":state="";break;case"BrtBeginCellStyleXFs":state="CELLSTYLEXFS";break;case"BrtEndCellStyleXFs":state="";break;case"BrtBeginCellXFs":state="CELLXFS";break;case"BrtEndCellXFs":state="";break;case"BrtBeginStyles":state="STYLES";break;case"BrtEndStyles":state="";break;case"BrtBeginDXFs":state="DXFS";break;case"BrtEndDXFs":state="";break;case"BrtBeginTableStyles":state="TABLESTYLES";break;case"BrtEndTableStyles":state="";break;case"BrtBeginColorPalette":state="COLORPALETTE";break;case"BrtEndColorPalette":state="";break;case"BrtBeginIndexedColors":state="INDEXEDCOLORS";break;case"BrtEndIndexedColors":state="";break;case"BrtBeginMRUColors":state="MRUCOLORS";break;case"BrtEndMRUColors":state="";break;case"BrtFRTBegin":pass=!0;break;case"BrtFRTEnd":pass=!1;break;case"BrtBeginStyleSheetExt14":case"BrtBeginSlicerStyles":case"BrtEndSlicerStyles":case"BrtBeginTimelineStylesheetExt15":case"BrtEndTimelineStylesheetExt15":case"BrtBeginTimelineStyles":case"BrtEndTimelineStyles":case"BrtEndStyleSheetExt14":break;default:if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R.n)}}),styles}:parse_sty_xml)(data,opts)}function parse_theme(data,name,opts){return function(data,opts){if(!data||0===data.length)return themes;var t;if(!(t=data.match(themeltregex)))throw"themeElements not found in theme";return parse_themeElements(t[0],opts),themes}(data,opts)}function parse_sst(data,name,opts){return(".bin"===name.substr(-4)?function(data,opts){var s=[],pass=!1;return recordhopper(data,function(val,R,RT){switch(R.n){case"BrtBeginSst":s.Count=val[0],s.Unique=val[1];break;case"BrtSSTItem":s.push(val);break;case"BrtEndSst":return!0;case"BrtFRTBegin":pass=!0;break;case"BrtFRTEnd":pass=!1;break;default:if(!pass||opts.WTF)throw new Error("Unexpected record "+RT+" "+R.n)}}),s}:function(data,opts){var ss,s=[],sst=data.match(sstr0);if(isval(sst)){ss=sst[2].replace(sstr1,"").split(sstr2);for(var i=0;i!=ss.length;++i){var o=parse_si(ss[i],opts);null!=o&&(s[s.length]=o)}sst=parsexmltag(sst[1]),s.Count=sst.count,s.Unique=sst.uniqueCount}return s})(data,opts)}function parse_cmnt(data,name,opts){return(".bin"===name.substr(-4)?function(data,opts){var out=[],authors=[],c={};return recordhopper(data,function(val,R,RT){switch(R.n){case"BrtCommentAuthor":authors.push(val);break;case"BrtBeginComment":c=val;break;case"BrtCommentText":c.t=val.t,c.h=val.h,c.r=val.r;break;case"BrtEndComment":if(c.author=authors[c.iauthor],delete c.iauthor,opts.sheetRows&&opts.sheetRows<=c.rfx.r)break;delete c.rfx,out.push(c);break;case"BrtBeginComments":case"BrtEndComments":case"BrtBeginCommentAuthors":case"BrtEndCommentAuthors":case"BrtBeginCommentList":case"BrtEndCommentList":break;default:throw new Error("Unexpected record "+RT+" "+R.n)}}),out}:function(data,opts){if(data.match(/<(?:\w+:)?comments *\/>/))return[];var authors=[],commentList=[];return data.match(/<(?:\w+:)?authors>([^\u2603]*)<\/(?:\w+:)?authors>/)[1].split(/<\/\w*:?author>/).forEach(function(x){""!==x&&""!==x.trim()&&authors.push(x.match(/<(?:\w+:)?author[^>]*>(.*)/)[1])}),(data.match(/<(?:\w+:)?commentList>([^\u2603]*)<\/(?:\w+:)?commentList>/)||["",""])[1].split(/<\/\w*:?comment>/).forEach(function(x,index){if(""!==x&&""!==x.trim()){var y=parsexmltag(x.match(/<(?:\w+:)?comment[^>]*>/)[0]),comment={author:y.authorId&&authors[y.authorId]?authors[y.authorId]:void 0,ref:y.ref,guid:y.guid},cell=decode_cell(y.ref);if(!(opts.sheetRows&&opts.sheetRows<=cell.r)){var textMatch=x.match(/<text>([^\u2603]*)<\/text>/);if(textMatch&&textMatch[1]){var rt=parse_si(textMatch[1]);comment.r=rt.r,comment.t=rt.t,opts.cellHTML&&(comment.h=rt.h),commentList.push(comment)}}}}),commentList})(data,opts)}function parse_cc(data,name,opts){return(".bin"===name.substr(-4)?function(data,opts){var out=[];return recordhopper(data,function(val,R,RT){switch(R.n){case"BrtCalcChainItem$":out.push(val);break;case"BrtBeginCalcChain$":case"BrtEndCalcChain$":break;default:throw new Error("Unexpected record "+RT+" "+R.n)}}),out}:function(data,opts){var d=[],i=1;return(data.match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(y[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete y[0],y.i?i=y.i:y.i=i,d.push(y)}}),d})(data,opts)}function write_ws(data,name,opts,wb){return(".bin"===name.substr(-4)?write_ws_bin:write_ws_xml)(data,opts,wb)}function write_sty(data,name,opts){return(".bin"===name.substr(-4)?function(data,opts){var ba=buf_array();return write_record(ba,"BrtBeginStyleSheet"),write_record(ba,"BrtEndStyleSheet"),ba.end()}:write_sty_xml)(data,opts)}function write_sst(data,name,opts){return(".bin"===name.substr(-4)?write_sst_bin:function(sst,opts){if(!opts.bookSST)return"";var o=[XML_HEADER];o[o.length]=writextag("sst",null,{xmlns:XMLNS.main[0],count:sst.Count,uniqueCount:sst.Unique});for(var i=0;i!=sst.length;++i)if(null!=sst[i]){var s=sst[i],sitag="<si>";s.r?sitag+=s.r:(sitag+="<t",s.t.match(straywsregex)&&(sitag+=' xml:space="preserve"'),sitag+=">"+escapexml(s.t)+"</t>"),sitag+="</si>",o[o.length]=sitag}return o.length>2&&(o[o.length]="</sst>",o[1]=o[1].replace("/>",">")),o.join("")})(data,opts)}var attregexg2=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,attregex2=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/,_chr=function(c){return String.fromCharCode(c)};function xlml_parsexmltag(tag,skip_root){var words=tag.split(/\s+/),z=[];if(skip_root||(z[0]=words[0]),1===words.length)return z;var y,j,i,m=tag.match(attregexg2);if(m)for(i=0;i!=m.length;++i)-1===(j=(y=m[i].match(attregex2))[1].indexOf(":"))?z[y[1]]=y[2].substr(1,y[2].length-2):z["xmlns:"===y[1].substr(0,6)?"xmlns"+y[1].substr(6):y[1].substr(j+1)]=y[2].substr(1,y[2].length-2);return z}function xlml_parsexmltagobj(tag){var z={};if(1===tag.split(/\s+/).length)return z;var y,j,i,m=tag.match(attregexg2);if(m)for(i=0;i!=m.length;++i)-1===(j=(y=m[i].match(attregex2))[1].indexOf(":"))?z[y[1]]=y[2].substr(1,y[2].length-2):z["xmlns:"===y[1].substr(0,6)?"xmlns"+y[1].substr(6):y[1].substr(j+1)]=y[2].substr(1,y[2].length-2);return z}function xlml_set_custprop(Custprops,Rn,cp,val){switch((cp[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":val=parsexmlbool(val);break;case"i2":case"int":val=parseInt(val,10);break;case"r4":case"float":val=parseFloat(val);break;case"date":case"dateTime.tz":val=new Date(val);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw"bad custprop:"+cp[0]}Custprops[unescapexml(Rn[3])]=val}function safe_format_xlml(cell,nf,o){try{"e"===cell.t?cell.w=cell.w||BErr[cell.v]:"General"===nf?"n"===cell.t?(0|cell.v)===cell.v?cell.w=SSF._general_int(cell.v):cell.w=SSF._general_num(cell.v):cell.w=SSF._general(cell.v):cell.w=(format=nf||"General",value=cell.v,"General"===(fmt=XLMLFormatMap[format]||unescapexml(format))?SSF._general(value):SSF.format(fmt,value)),o.cellNF&&(cell.z=XLMLFormatMap[nf]||nf||"General")}catch(e){if(o.WTF)throw e}var format,value,fmt}function process_style_xlml(styles,stag,opts){if(opts.cellStyles&&stag.Interior){var I=stag.Interior;I.Pattern&&(I.patternType=XLMLPatternTypeMap[I.Pattern]||I.Pattern)}styles[stag.ID]=stag}function parse_xlml_data(xml,ss,data,cell,base,styles,csty,row,o){var nf="General",sid=cell.StyleID,S={};o=o||{};var interiors=[];for(void 0===sid&&row&&(sid=row.StyleID),void 0===sid&&csty&&(sid=csty.StyleID);void 0!==styles[sid]&&(styles[sid].nf&&(nf=styles[sid].nf),styles[sid].Interior&&interiors.push(styles[sid].Interior),styles[sid].Parent);)sid=styles[sid].Parent;switch(data.Type){case"Boolean":cell.t="b",cell.v=parsexmlbool(xml);break;case"String":cell.t="s",cell.r=xlml_fixstr(unescapexml(xml)),cell.v=xml.indexOf("<")>-1?ss:cell.r;break;case"DateTime":cell.v=(Date.parse(xml)-new Date(Date.UTC(1899,11,30)))/864e5,cell.v!=cell.v?cell.v=unescapexml(xml):cell.v>=1&&cell.v<60&&(cell.v=cell.v-1),nf&&"General"!=nf||(nf="yyyy-mm-dd");case"Number":void 0===cell.v&&(cell.v=+xml),cell.t||(cell.t="n");break;case"Error":cell.t="e",cell.v=RBErr[xml],cell.w=xml;break;default:cell.t="s",cell.v=xlml_fixstr(ss)}safe_format_xlml(cell,nf,o),null!=o.cellFormula&&cell.Formula&&(cell.f=rc_to_a1(unescapexml(cell.Formula),base),cell.Formula=void 0),o.cellStyles&&(interiors.forEach(function(x){!S.patternType&&x.patternType&&(S.patternType=x.patternType)}),cell.s=S),cell.ixfe=void 0!==cell.StyleID?cell.StyleID:"Default"}function xlml_clean_comment(comment){comment.t=comment.v,comment.v=comment.w=comment.ixfe=void 0}var xlmlregex=/<(\/?)([a-z0-9]*:|)(\w+)[^>]*>/gm;function parse_xlml_xml(d,opts){var Rn,tmp,dtag,didx,csty,str=function(d){if(has_buf&&Buffer.isBuffer(d))return d.toString("utf8");if("string"==typeof d)return d;throw"badf"}(d),state=[],sheets={},sheetnames=[],cursheet={},sheetname="",cell={},row={},c=0,r=0,refguess={s:{r:1e6,c:1e6},e:{r:0,c:0}},styles={},stag={},ss="",fidx=0,mergecells=[],Props={},Custprops={},pidx=0,cp={},comments=[],comment={},cstys=[];for(xlmlregex.lastIndex=0;Rn=xlmlregex.exec(str);)switch(Rn[3]){case"Data":if(state[state.length-1][1])break;"/"===Rn[1]?parse_xlml_data(str.slice(didx,Rn.index),ss,dtag,"Comment"==state[state.length-1][0]?comment:cell,{c:c,r:r},styles,cstys[c],row,opts):(ss="",dtag=xlml_parsexmltag(Rn[0]),didx=Rn.index+Rn[0].length);break;case"Cell":if("/"===Rn[1]){if(comments.length>0&&(cell.c=comments),(!opts.sheetRows||opts.sheetRows>r)&&void 0!==cell.v&&(cursheet[encode_col(c)+encode_row(r)]=cell),cell.HRef&&(cell.l={Target:cell.HRef,tooltip:cell.HRefScreenTip},cell.HRef=cell.HRefScreenTip=void 0),cell.MergeAcross||cell.MergeDown){var cc=c+(0|parseInt(cell.MergeAcross,10)),rr=r+(0|parseInt(cell.MergeDown,10));mergecells.push({s:{c:c,r:r},e:{c:cc,r:rr}})}++c,cell.MergeAcross&&(c+=+cell.MergeAcross)}else(cell=xlml_parsexmltagobj(Rn[0])).Index&&(c=+cell.Index-1),c<refguess.s.c&&(refguess.s.c=c),c>refguess.e.c&&(refguess.e.c=c),"/>"===Rn[0].substr(-2)&&++c,comments=[];break;case"Row":"/"===Rn[1]||"/>"===Rn[0].substr(-2)?(r<refguess.s.r&&(refguess.s.r=r),r>refguess.e.r&&(refguess.e.r=r),"/>"===Rn[0].substr(-2)&&(row=xlml_parsexmltag(Rn[0])).Index&&(r=+row.Index-1),c=0,++r):(row=xlml_parsexmltag(Rn[0])).Index&&(r=+row.Index-1);break;case"Worksheet":if("/"===Rn[1]){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp;sheetnames.push(sheetname),refguess.s.r<=refguess.e.r&&refguess.s.c<=refguess.e.c&&(cursheet["!ref"]=encode_range(refguess)),mergecells.length&&(cursheet["!merges"]=mergecells),sheets[sheetname]=cursheet}else refguess={s:{r:1e6,c:1e6},e:{r:0,c:0}},r=c=0,state.push([Rn[3],!1]),sheetname=(tmp=xlml_parsexmltag(Rn[0])).Name,cursheet={},mergecells=[];break;case"Table":if("/"===Rn[1]){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else{if("/>"==Rn[0].slice(-2))break;xlml_parsexmltag(Rn[0]),state.push([Rn[3],!1]),cstys=[]}break;case"Style":"/"===Rn[1]?process_style_xlml(styles,stag,opts):stag=xlml_parsexmltag(Rn[0]);break;case"NumberFormat":stag.nf=xlml_parsexmltag(Rn[0]).Format||"General";break;case"Column":if("Table"!==state[state.length-1][0])break;cstys[(csty=xlml_parsexmltag(Rn[0])).Index-1||cstys.length]=csty;for(var i=0;i<+csty.Span;++i)cstys[cstys.length]=csty;break;case"NamedRange":case"NamedCell":case"B":case"I":case"U":case"S":case"Sub":case"Sup":case"Span":case"Border":case"Alignment":case"Borders":break;case"Font":if("/>"===Rn[0].substr(-2))break;"/"===Rn[1]?ss+=str.slice(fidx,Rn.index):fidx=Rn.index+Rn[0].length;break;case"Interior":if(!opts.cellStyles)break;stag.Interior=xlml_parsexmltag(Rn[0]);break;case"Protection":break;case"Author":case"Title":case"Description":case"Created":case"Keywords":case"Subject":case"Category":case"Company":case"LastAuthor":case"LastSaved":case"LastPrinted":case"Version":case"Revision":case"TotalTime":case"HyperlinkBase":case"Manager":if("/>"===Rn[0].substr(-2))break;"/"===Rn[1]?xlml_set_prop(Props,Rn[3],str.slice(pidx,Rn.index)):pidx=Rn.index+Rn[0].length;break;case"Paragraphs":break;case"Styles":case"Workbook":if("/"===Rn[1]){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else state.push([Rn[3],!1]);break;case"Comment":if("/"===Rn[1]){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp;xlml_clean_comment(comment),comments.push(comment)}else state.push([Rn[3],!1]),comment={a:(tmp=xlml_parsexmltag(Rn[0])).Author};break;case"Name":break;case"ComponentOptions":case"DocumentProperties":case"CustomDocumentProperties":case"OfficeDocumentSettings":case"PivotTable":case"PivotCache":case"Names":case"MapInfo":case"PageBreaks":case"QueryTable":case"DataValidation":case"AutoFilter":case"Sorting":case"Schema":case"data":case"ConditionalFormatting":case"SmartTagType":case"SmartTags":case"ExcelWorkbook":case"WorkbookOptions":case"WorksheetOptions":if("/"===Rn[1]){if((tmp=state.pop())[0]!==Rn[3])throw"Bad state: "+tmp}else"/"!==Rn[0].charAt(Rn[0].length-2)&&state.push([Rn[3],!0]);break;default:var seen=!0;switch(state[state.length-1][0]){case"OfficeDocumentSettings":switch(Rn[3]){case"AllowPNG":case"RemovePersonalInformation":case"DownloadComponents":case"LocationOfComponents":case"Colors":case"Color":case"Index":case"RGB":case"PixelsPerInch":case"TargetScreenSize":case"ReadOnlyRecommended":break;default:seen=!1}break;case"ComponentOptions":switch(Rn[3]){case"Toolbar":case"HideOfficeLogo":case"SpreadsheetAutoFit":case"Label":case"Caption":case"MaxHeight":case"MaxWidth":case"NextSheetNumber":break;default:seen=!1}break;case"ExcelWorkbook":switch(Rn[3]){case"WindowHeight":case"WindowWidth":case"WindowTopX":case"WindowTopY":case"TabRatio":case"ProtectStructure":case"ProtectWindows":case"ActiveSheet":case"DisplayInkNotes":case"FirstVisibleSheet":case"SupBook":case"SheetName":case"SheetIndex":case"SheetIndexFirst":case"SheetIndexLast":case"Dll":case"AcceptLabelsInFormulas":case"DoNotSaveLinkValues":case"Date1904":case"Iteration":case"MaxIterations":case"MaxChange":case"Path":case"Xct":case"Count":case"SelectedSheets":case"Calculation":case"Uncalced":case"StartupPrompt":case"Crn":case"ExternName":case"Formula":case"ColFirst":case"ColLast":case"WantAdvise":case"Boolean":case"Error":case"Text":case"OLE":case"NoAutoRecover":case"PublishObjects":case"DoNotCalculateBeforeSave":case"Number":case"RefModeR1C1":case"EmbedSaveSmartTags":break;default:seen=!1}break;case"WorkbookOptions":switch(Rn[3]){case"OWCVersion":case"Height":case"Width":break;default:seen=!1}break;case"WorksheetOptions":switch(Rn[3]){case"Unsynced":case"Visible":case"Print":case"Panes":case"Scale":case"Pane":case"Number":case"Layout":case"Header":case"Footer":case"PageSetup":case"PageMargins":case"Selected":case"ProtectObjects":case"EnableSelection":case"ProtectScenarios":case"ValidPrinterInfo":case"HorizontalResolution":case"VerticalResolution":case"NumberofCopies":case"ActiveRow":case"ActiveCol":case"ActivePane":case"TopRowVisible":case"TopRowBottomPane":case"LeftColumnVisible":case"LeftColumnRightPane":case"FitToPage":case"RangeSelection":case"PaperSizeIndex":case"PageLayoutZoom":case"PageBreakZoom":case"FilterOn":case"DoNotDisplayGridlines":case"SplitHorizontal":case"SplitVertical":case"FreezePanes":case"FrozenNoSplit":case"FitWidth":case"FitHeight":case"CommentsLayout":case"Zoom":case"LeftToRight":case"Gridlines":case"AllowSort":case"AllowFilter":case"AllowInsertRows":case"AllowDeleteRows":case"AllowInsertCols":case"AllowDeleteCols":case"AllowInsertHyperlinks":case"AllowFormatCells":case"AllowSizeCols":case"AllowSizeRows":case"NoSummaryRowsBelowDetail":case"TabColorIndex":case"DoNotDisplayHeadings":case"ShowPageLayoutZoom":case"NoSummaryColumnsRightDetail":case"BlackAndWhite":case"DoNotDisplayZeros":case"DisplayPageBreak":case"RowColHeadings":case"DoNotDisplayOutline":case"NoOrientation":case"AllowUsePivotTables":case"ZeroHeight":case"ViewableRange":case"Selection":case"ProtectContents":break;default:seen=!1}break;case"PivotTable":case"PivotCache":switch(Rn[3]){case"ImmediateItemsOnDrop":case"ShowPageMultipleItemLabel":case"CompactRowIndent":case"Location":case"PivotField":case"Orientation":case"LayoutForm":case"LayoutSubtotalLocation":case"LayoutCompactRow":case"Position":case"PivotItem":case"DataType":case"DataField":case"SourceName":case"ParentField":case"PTLineItems":case"PTLineItem":case"CountOfSameItems":case"Item":case"ItemType":case"PTSource":case"CacheIndex":case"ConsolidationReference":case"FileName":case"Reference":case"NoColumnGrand":case"NoRowGrand":case"BlankLineAfterItems":case"Hidden":case"Subtotal":case"BaseField":case"MapChildItems":case"Function":case"RefreshOnFileOpen":case"PrintSetTitles":case"MergeLabels":case"DefaultVersion":case"RefreshName":case"RefreshDate":case"RefreshDateCopy":case"VersionLastRefresh":case"VersionLastUpdate":case"VersionUpdateableMin":case"VersionRefreshableMin":case"Calculation":break;default:seen=!1}break;case"PageBreaks":switch(Rn[3]){case"ColBreaks":case"ColBreak":case"RowBreaks":case"RowBreak":case"ColStart":case"ColEnd":case"RowEnd":break;default:seen=!1}break;case"AutoFilter":switch(Rn[3]){case"AutoFilterColumn":case"AutoFilterCondition":case"AutoFilterAnd":case"AutoFilterOr":break;default:seen=!1}break;case"QueryTable":switch(Rn[3]){case"Id":case"AutoFormatFont":case"AutoFormatPattern":case"QuerySource":case"QueryType":case"EnableRedirections":case"RefreshedInXl9":case"URLString":case"HTMLTables":case"Connection":case"CommandText":case"RefreshInfo":case"NoTitles":case"NextId":case"ColumnInfo":case"OverwriteCells":case"DoNotPromptForFile":case"TextWizardSettings":case"Source":case"Number":case"Decimal":case"ThousandSeparator":case"TrailingMinusNumbers":case"FormatSettings":case"FieldType":case"Delimiters":case"Tab":case"Comma":case"AutoFormatName":case"VersionLastEdit":case"VersionLastRefresh":break;default:seen=!1}break;case"Sorting":case"ConditionalFormatting":case"DataValidation":switch(Rn[3]){case"Range":case"Type":case"Min":case"Max":case"Sort":case"Descending":case"Order":case"CaseSensitive":case"Value":case"ErrorStyle":case"ErrorMessage":case"ErrorTitle":case"CellRangeList":case"InputMessage":case"InputTitle":case"ComboHide":case"InputHide":case"Condition":case"Qualifier":case"UseBlank":case"Value1":case"Value2":case"Format":break;default:seen=!1}break;case"MapInfo":case"Schema":case"data":switch(Rn[3]){case"Map":case"Entry":case"Range":case"XPath":case"Field":case"XSDType":case"FilterOn":case"Aggregate":case"ElementType":case"AttributeType":break;case"schema":case"element":case"complexType":case"datatype":case"all":case"attribute":case"extends":case"row":break;default:seen=!1}break;case"SmartTags":break;default:seen=!1}if(seen)break;if(!state[state.length-1][1])throw"Unrecognized tag: "+Rn[3]+"|"+state.join("|");if("CustomDocumentProperties"===state[state.length-1][0]){if("/>"===Rn[0].substr(-2))break;"/"===Rn[1]?xlml_set_custprop(Custprops,Rn,cp,str.slice(pidx,Rn.index)):(cp=Rn,pidx=Rn.index+Rn[0].length);break}if(opts.WTF)throw"Unrecognized tag: "+Rn[3]+"|"+state.join("|")}var out={};return opts.bookSheets||opts.bookProps||(out.Sheets=sheets),out.SheetNames=sheetnames,out.SSF=SSF.get_table(),out.Props=Props,out.Custprops=Custprops,out}function slurp(R,blob,length,opts){var l=length,bufs=[],d=blob.slice(blob.l,blob.l+l);if(opts&&opts.enc&&opts.enc.insitu_decrypt)switch(R.n){case"BOF":case"FilePass":case"FileLock":case"InterfaceHdr":case"RRDInfo":case"RRDHead":case"UsrExcl":break;default:if(0===d.length)break;opts.enc.insitu_decrypt(d)}bufs.push(d),blob.l+=l;for(var next=XLSRecordEnum[__readUInt16LE(blob,blob.l)];null!=next&&"Continue"===next.n;)l=__readUInt16LE(blob,blob.l+2),bufs.push(blob.slice(blob.l+4,blob.l+4+l)),blob.l+=4+l,next=XLSRecordEnum[__readUInt16LE(blob,blob.l)];var b=bconcat(bufs);prep_blob(b,0);var ll=0;b.lens=[];for(var j=0;j<bufs.length;++j)b.lens.push(ll),ll+=bufs[j].length;return R.f(b,b.length,opts)}function safe_format_xf(p,opts,date1904){if(p.XF)try{var fmtid=p.XF.ifmt||0;"e"===p.t?p.w=p.w||BErr[p.v]:0===fmtid?"n"===p.t?(0|p.v)===p.v?p.w=SSF._general_int(p.v):p.w=SSF._general_num(p.v):p.w=SSF._general(p.v):p.w=SSF.format(fmtid,p.v,{date1904:date1904||!1}),opts.cellNF&&(p.z=SSF._table[fmtid])}catch(e){if(opts.WTF)throw e}}function make_cell(val,ixfe,t){return{v:val,ixfe:ixfe,t:t}}function parse_workbook(blob,options){var lastcell,last_cell,cc,cmnt,rngC,rngR,temp_val,country,wb={opts:{}},Sheets={},out={},Directory={},range={},last_formula=null,sst=[],cur_sheet="",Preamble={},shared_formulae={},array_formulae=[],cell_valid=!0,XFs=[],palette=[],get_rgb=function(icv){return icv<8?XLSIcv[icv]:icv<64&&palette[icv-8]||XLSIcv[icv]},addcell=function(cell,line,options){cell_valid&&(options.cellStyles&&line.XF&&line.XF.data&&function(cell,line){var t,xfd=line.XF.data;xfd&&xfd.patternType&&(line.s={},line.s.patternType=xfd.patternType,(t=rgb2Hex(get_rgb(xfd.icvFore)))&&(line.s.fgColor={rgb:t}),(t=rgb2Hex(get_rgb(xfd.icvBack)))&&(line.s.bgColor={rgb:t}))}(0,line),lastcell=cell,last_cell=encode_cell(cell),range.s&&(cell.r<range.s.r&&(range.s.r=cell.r),cell.c<range.s.c&&(range.s.c=cell.c)),range.e&&(cell.r+1>range.e.r&&(range.e.r=cell.r+1),cell.c+1>range.e.c&&(range.e.c=cell.c+1)),options.sheetRows&&lastcell.r>=options.sheetRows?cell_valid=!1:out[last_cell]=line)},opts={enc:!1,sbcch:0,snames:[],sharedf:shared_formulae,arrayf:array_formulae,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,wtf:!1};options.password&&(opts.password=options.password);var mergecells=[],objects=[],supbooks=[[]],sbc=0,sbci=0,sbcli=0;supbooks.SheetNames=opts.snames,supbooks.sharedf=opts.sharedf,supbooks.arrayf=opts.arrayf;var last_Rn="",file_depth=0;for(opts.codepage=1200,set_cp(1200);blob.l<blob.length-1;){var s=blob.l,RecordType=blob.read_shift(2);if(0===RecordType&&"EOF"===last_Rn)break;var length=blob.l===blob.length?0:blob.read_shift(2),R=XLSRecordEnum[RecordType];if(R&&R.f){if(options.bookSheets&&"BoundSheet8"===last_Rn&&"BoundSheet8"!==R.n)break;if(last_Rn=R.n,2===R.r||12==R.r){var rt=blob.read_shift(2);if(length-=2,!opts.enc&&rt!==RecordType)throw"rt mismatch";12==R.r&&(blob.l+=10,length-=10)}var val;val="EOF"===R.n?R.f(blob,length,opts):slurp(R,blob,length,opts);var Rn=R.n;if(5===opts.biff||2===opts.biff)switch(Rn){case"Lbl":Rn="Label"}switch(Rn){case"Date1904":wb.opts.Date1904=val;break;case"WriteProtect":wb.opts.WriteProtect=!0;break;case"FilePass":if(opts.enc||(blob.l=0),opts.enc=val,opts.WTF&&console.error(val),!options.password)throw new Error("File is password-protected");if(0!==val.Type)throw new Error("Encryption scheme unsupported");if(!val.valid)throw new Error("Password is incorrect");break;case"WriteAccess":opts.lastuser=val;break;case"FileSharing":break;case"CodePage":21010===val?val=1200:32769===val&&(val=1252),opts.codepage=val,set_cp(val);break;case"RRTabId":opts.rrtabid=val;break;case"WinProtect":opts.winlocked=val;break;case"Template":break;case"RefreshAll":wb.opts.RefreshAll=val;break;case"BookBool":case"UsesELFs":break;case"MTRSettings":if(val[0]&&val[1])throw"Unsupported threads: "+val;break;case"CalcCount":wb.opts.CalcCount=val;break;case"CalcDelta":wb.opts.CalcDelta=val;break;case"CalcIter":wb.opts.CalcIter=val;break;case"CalcMode":wb.opts.CalcMode=val;break;case"CalcPrecision":wb.opts.CalcPrecision=val;break;case"CalcSaveRecalc":wb.opts.CalcSaveRecalc=val;break;case"CalcRefMode":opts.CalcRefMode=val;break;case"Uncalced":break;case"ForceFullCalculation":wb.opts.FullCalc=val;break;case"WsBool":break;case"XF":XFs.push(val);break;case"ExtSST":case"BookExt":case"RichTextStream":case"BkHim":break;case"SupBook":supbooks[++sbc]=[val],sbci=0;break;case"ExternName":supbooks[sbc][++sbci]=val;break;case"Index":break;case"Lbl":supbooks[0][++sbcli]=val;break;case"ExternSheet":supbooks[sbc]=supbooks[sbc].concat(val),sbci+=val.length;break;case"Protect":out["!protect"]=val;break;case"Password":0!==val&&opts.WTF&&console.error("Password verifier: "+val);break;case"Prot4Rev":case"Prot4RevPass":break;case"BoundSheet8":Directory[val.pos]=val,opts.snames.push(val.name);break;case"EOF":if(--file_depth)break;range.e&&(out["!range"]=range,range.e.r>0&&range.e.c>0&&(range.e.r--,range.e.c--,out["!ref"]=encode_range(range),range.e.r++,range.e.c++),mergecells.length>0&&(out["!merges"]=mergecells),objects.length>0&&(out["!objects"]=objects)),""===cur_sheet?Preamble=out:Sheets[cur_sheet]=out,out={};break;case"BOF":if(8!==opts.biff||(1280===val.BIFFVer?opts.biff=5:2===val.BIFFVer?opts.biff=2:7===val.BIFFVer&&(opts.biff=2)),file_depth++)break;cell_valid=!0,out={},2===opts.biff?(""===cur_sheet&&(cur_sheet="Sheet1"),range={s:{r:0,c:0},e:{r:0,c:0}}):cur_sheet=(Directory[s]||{name:""}).name,mergecells=[],objects=[];break;case"Number":case"BIFF2NUM":(temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],v:val.val,t:"n"}).XF&&safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case"BoolErr":(temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],v:val.val,t:val.t}).XF&&safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case"RK":(temp_val={ixfe:val.ixfe,XF:XFs[val.ixfe],v:val.rknum,t:"n"}).XF&&safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case"MulRk":for(var j=val.c;j<=val.C;++j){var ixfe=val.rkrec[j-val.c][0];(temp_val={ixfe:ixfe,XF:XFs[ixfe],v:val.rkrec[j-val.c][1],t:"n"}).XF&&safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:j,r:val.r},temp_val,options)}break;case"Formula":switch(val.val){case"String":last_formula=val;break;case"Array Formula":throw"Array Formula unsupported";default:(temp_val={v:val.val,ixfe:val.cell.ixfe,t:val.tt}).XF=XFs[temp_val.ixfe],options.cellFormula&&(temp_val.f="="+stringify_formula(val.formula,range,val.cell,supbooks,opts)),temp_val.XF&&safe_format_xf(temp_val,options,wb.opts.Date1904),addcell(val.cell,temp_val,options),last_formula=val}break;case"String":last_formula&&(last_formula.val=val,(temp_val={v:last_formula.val,ixfe:last_formula.cell.ixfe,t:"s"}).XF=XFs[temp_val.ixfe],options.cellFormula&&(temp_val.f="="+stringify_formula(last_formula.formula,range,last_formula.cell,supbooks,opts)),temp_val.XF&&safe_format_xf(temp_val,options,wb.opts.Date1904),addcell(last_formula.cell,temp_val,options),last_formula=null);break;case"Array":array_formulae.push(val);break;case"ShrFmla":if(!cell_valid)break;shared_formulae[encode_cell(last_formula.cell)]=val[0];break;case"LabelSst":(temp_val=make_cell(sst[val.isst].t,val.ixfe,"s")).XF=XFs[temp_val.ixfe],temp_val.XF&&safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case"Label":case"BIFF2STR":(temp_val=make_cell(val.val,val.ixfe,"s")).XF=XFs[temp_val.ixfe],temp_val.XF&&safe_format_xf(temp_val,options,wb.opts.Date1904),addcell({c:val.c,r:val.r},temp_val,options);break;case"Dimensions":1===file_depth&&(range=val);break;case"SST":sst=val;break;case"Format":SSF.load(val[1],val[0]);break;case"MergeCells":mergecells=mergecells.concat(val);break;case"Obj":objects[val.cmo[0]]=opts.lastobj=val;break;case"TxO":opts.lastobj.TxO=val;break;case"HLink":for(rngR=val[0].s.r;rngR<=val[0].e.r;++rngR)for(rngC=val[0].s.c;rngC<=val[0].e.c;++rngC)out[encode_cell({c:rngC,r:rngR})]&&(out[encode_cell({c:rngC,r:rngR})].l=val[1]);break;case"HLinkTooltip":for(rngR=val[0].s.r;rngR<=val[0].e.r;++rngR)for(rngC=val[0].s.c;rngC<=val[0].e.c;++rngC)out[encode_cell({c:rngC,r:rngR})]&&(out[encode_cell({c:rngC,r:rngR})].l.tooltip=val[1]);break;case"Note":if(opts.biff<=5&&opts.biff>=2)break;cc=out[encode_cell(val[0])];var noteobj=objects[val[2]];if(!cc)break;cc.c||(cc.c=[]),cmnt={a:val[1],t:noteobj.TxO.t},cc.c.push(cmnt);break;default:switch(R.n){case"ClrtClient":break;case"XFExt":XFs[val.ixfe],val.ext.forEach(function(xfe){switch(xfe[0]){case 4:case 5:break;case 7:case 8:case 9:case 10:case 13:case 14:break;default:throw"bafuq"+xfe[0].toString(16)}});break;case"NameCmt":case"Header":case"Footer":case"HCenter":case"VCenter":case"Pls":case"Setup":case"DefColWidth":case"GCW":case"LHRecord":case"ColInfo":case"Row":case"DBCell":case"MulBlank":case"EntExU2":case"SxView":case"Sxvd":case"SXVI":case"SXVDEx":case"SxIvd":case"SXDI":case"SXLI":case"SXEx":case"QsiSXTag":case"Selection":case"Feat":break;case"FeatHdr":case"FeatHdr11":break;case"Feature11":case"Feature12":case"List12":case"Blank":break;case"Country":country=val;break;case"RecalcId":break;case"DefaultRowHeight":case"DxGCol":break;case"Fbi":case"Fbi2":case"GelFrame":case"Font":case"XFCRC":case"Style":case"StyleExt":break;case"Palette":palette=val;break;case"Theme":case"ScenarioProtect":case"ObjProtect":case"CondFmt12":case"Table":case"TableStyles":case"TableStyle":case"TableStyleElement":case"SXStreamID":case"SXVS":case"DConRef":case"SXAddl":case"DConBin":case"DConName":case"SXPI":case"SxFormat":case"SxSelect":case"SxRule":case"SxFilt":case"SxItm":case"SxDXF":case"ScenMan":case"DCon":case"CellWatch":case"PrintRowCol":case"PrintGrid":case"PrintSize":case"XCT":case"CRN":case"Scl":case"SheetExt":case"SheetExtOptional":case"ObNoMacros":case"ObProj":case"CodeName":case"GUIDTypeLib":case"WOpt":case"PhoneticInfo":case"OleObjectSize":break;case"DXF":case"DXFN":case"DXFN12":case"DXFN12List":case"DXFN12NoCB":break;case"Dv":case"DVal":break;case"BRAI":case"Series":case"SeriesText":case"DConn":case"DbOrParamQry":case"DBQueryExt":case"IFmtRecord":break;case"CondFmt":case"CF":case"CF12":case"CFEx":case"Excel9File":case"Units":break;case"InterfaceHdr":case"Mms":case"InterfaceEnd":case"DSF":case"BuiltInFnGroupCount":case"Window1":case"Window2":case"HideObj":case"GridSet":case"Guts":case"UserBView":case"UserSViewBegin":case"UserSViewEnd":case"Pane":break;default:switch(R.n){case"Dat":case"Begin":case"End":case"StartBlock":case"EndBlock":case"Frame":case"Area":case"Axis":case"AxisLine":case"Tick":break;case"AxesUsed":case"CrtLayout12":case"CrtLayout12A":case"CrtLink":case"CrtLine":case"CrtMlFrt":case"CrtMlFrtContinue":break;case"LineFormat":case"AreaFormat":case"Chart":case"Chart3d":case"Chart3DBarShape":case"ChartFormat":case"ChartFrtInfo":break;case"PlotArea":case"PlotGrowth":break;case"SeriesList":case"SerParent":case"SerAuxTrend":break;case"DataFormat":case"SerToCrt":case"FontX":break;case"CatSerRange":case"AxcExt":case"SerFmt":case"ShtProps":break;case"DefaultText":case"Text":case"CatLab":case"DataLabExtContents":break;case"Legend":case"LegendException":break;case"Pie":case"Scatter":break;case"PieFormat":case"MarkerFormat":break;case"StartObject":case"EndObject":break;case"AlRuns":case"ObjectLink":case"SIIndex":break;case"AttachedLabel":case"YMult":break;case"Line":case"Bar":case"Surf":case"AxisParent":case"Pos":case"ValueRange":case"SXViewEx9":case"SXViewLink":case"PivotChartBits":case"SBaseRef":case"TextPropsStream":case"LnExt":case"MkrExt":case"CrtCoopt":break;case"Qsi":case"Qsif":case"Qsir":case"QsiSXTag":case"TxtQry":case"FilterMode":break;case"AutoFilter":case"AutoFilterInfo":case"AutoFilter12":case"DropDownObjIds":case"Sort":case"SortData":case"ShapePropsStream":break;case"MsoDrawing":case"MsoDrawingGroup":case"MsoDrawingSelection":case"ImData":break;case"WebPub":case"AutoWebPub":case"RightMargin":case"LeftMargin":case"TopMargin":case"BottomMargin":case"HeaderFooter":case"HFPicture":case"PLV":case"HorizontalPageBreaks":case"VerticalPageBreaks":case"Backup":case"CompressPictures":case"Compat12":break;case"Continue":case"ContinueFrt12":break;case"FrtFontList":case"FrtWrapper":case"ExternCount":case"RString":break;case"TabIdConf":case"Radar":case"RadarArea":case"DropBar":case"Intl":case"CoordList":case"SerAuxErrBar":break;default:switch(R.n){case"SCENARIO":case"DConBin":case"PicF":case"DataLabExt":case"Lel":case"BopPop":case"BopPopCustom":case"RealTimeData":case"Name":break;default:if(options.WTF)throw"Unrecognized Record "+R.n}}}}}else blob.l+=length}var sheetnamesraw=2===opts.biff?["Sheet1"]:Object.keys(Directory).sort(function(a,b){return Number(a)-Number(b)}).map(function(x){return Directory[x].name});sheetnamesraw.slice();return wb.Directory=sheetnamesraw,wb.SheetNames=sheetnamesraw,options.bookSheets||(wb.Sheets=Sheets),wb.Preamble=Preamble,wb.Strings=sst,wb.SSF=SSF.get_table(),opts.enc&&(wb.Encryption=opts.enc),wb.Metadata={},void 0!==country&&(wb.Metadata.Country=country),wb}function parse_xlscfb(cfb,options){var CompObj,Workbook,CompObjP,WorkbookP;if(options||(options={}),fix_read_opts(options),reset_cp(),cfb.find?(CompObj=cfb.find("!CompObj"),cfb.find("!SummaryInformation"),Workbook=cfb.find("/Workbook")):(prep_blob(cfb,0),Workbook={content:cfb}),Workbook||(Workbook=cfb.find("/Book")),CompObj&&(CompObjP=function(obj){var m,v={},o=obj.content,l=28;switch(m=__lpstr(o,l),l+=4+__readUInt32LE(o,l),v.UserType=m,m=__readUInt32LE(o,l),l+=4,m){case 0:break;case 4294967295:case 4294967294:l+=4;break;default:if(m>400)throw new Error("Unsupported Clipboard: "+m.toString(16));l+=m}if(l+=0===(m=__lpstr(o,l)).length?0:5+m.length,v.Reserved1=m,1907550708!==(m=__readUInt32LE(o,l)))return v;throw"Unsupported Unicode Extension"}(CompObj)),options.bookProps&&!options.bookSheets)WorkbookP={};else{if(!Workbook)throw new Error("Cannot find Workbook stream");WorkbookP=parse_workbook(Workbook.content,options,Workbook.find)}cfb.find&&function(cfb){var DSI=cfb.find("!DocumentSummaryInformation");if(DSI)try{cfb.DocSummary=parse_PropertySetStream(DSI,DocSummaryPIDDSI)}catch(e){}var SI=cfb.find("!SummaryInformation");if(SI)try{cfb.Summary=parse_PropertySetStream(SI,SummaryPIDSI)}catch(e){}}(cfb);var props={};for(var y in cfb.Summary)props[y]=cfb.Summary[y];for(y in cfb.DocSummary)props[y]=cfb.DocSummary[y];return WorkbookP.Props=WorkbookP.Custprops=props,options.bookFiles&&(WorkbookP.cfb=cfb),WorkbookP.CompObjP=CompObjP,WorkbookP}var XLSBRecordEnum={0:{n:"BrtRowHdr",f:function(data,length){var z=[];return z.r=data.read_shift(4),data.l+=length-4,z}},1:{n:"BrtCellBlank",f:function(data,length){return[parse_XLSBCell(data)]}},2:{n:"BrtCellRk",f:function(data,length){return[parse_XLSBCell(data),parse_RkNumber(data),"n"]}},3:{n:"BrtCellError",f:function(data,length){return[parse_XLSBCell(data),data.read_shift(1),"e"]}},4:{n:"BrtCellBool",f:function(data,length){return[parse_XLSBCell(data),data.read_shift(1),"b"]}},5:{n:"BrtCellReal",f:function(data,length){return[parse_XLSBCell(data),parse_Xnum(data),"n"]}},6:{n:"BrtCellSt",f:function(data,length){return[parse_XLSBCell(data),parse_XLWideString(data),"str"]}},7:{n:"BrtCellIsst",f:function(data,length){return[parse_XLSBCell(data),data.read_shift(4),"s"]}},8:{n:"BrtFmlaString",f:function(data,length,opts){var start=data.l,o=[parse_XLSBCell(data),parse_XLWideString(data),"str"];opts.cellFormula?parse_XLSBCellParsedFormula(data,start+length-data.l):data.l=start+length;return o}},9:{n:"BrtFmlaNum",f:function(data,length,opts){var o=[parse_XLSBCell(data),parse_Xnum(data),"n"];opts.cellFormula?(parse_XLSBCellParsedFormula(data,length-16),o[3]=""):data.l+=length-16;return o}},10:{n:"BrtFmlaBool",f:function(data,length,opts){var o=[parse_XLSBCell(data),data.read_shift(1),"b"];opts.cellFormula?(parse_XLSBCellParsedFormula(data,length-9),o[3]=""):data.l+=length-9;return o}},11:{n:"BrtFmlaError",f:function(data,length,opts){var o=[parse_XLSBCell(data),data.read_shift(1),"e"];opts.cellFormula?(parse_XLSBCellParsedFormula(data,length-9),o[3]=""):data.l+=length-9;return o}},16:{n:"BrtFRTArchID$",f:function(data,length){var o={};return data.read_shift(4),o.ArchID=data.read_shift(4),data.l+=length-8,o}},19:{n:"BrtSSTItem",f:parse_RichStr},20:{n:"BrtPCDIMissing",f:parsenoop},21:{n:"BrtPCDINumber",f:parsenoop},22:{n:"BrtPCDIBoolean",f:parsenoop},23:{n:"BrtPCDIError",f:parsenoop},24:{n:"BrtPCDIString",f:parsenoop},25:{n:"BrtPCDIDatetime",f:parsenoop},26:{n:"BrtPCDIIndex",f:parsenoop},27:{n:"BrtPCDIAMissing",f:parsenoop},28:{n:"BrtPCDIANumber",f:parsenoop},29:{n:"BrtPCDIABoolean",f:parsenoop},30:{n:"BrtPCDIAError",f:parsenoop},31:{n:"BrtPCDIAString",f:parsenoop},32:{n:"BrtPCDIADatetime",f:parsenoop},33:{n:"BrtPCRRecord",f:parsenoop},34:{n:"BrtPCRRecordDt",f:parsenoop},35:{n:"BrtFRTBegin",f:parsenoop},36:{n:"BrtFRTEnd",f:parsenoop},37:{n:"BrtACBegin",f:parsenoop},38:{n:"BrtACEnd",f:parsenoop},39:{n:"BrtName",f:parsenoop},40:{n:"BrtIndexRowBlock",f:parsenoop},42:{n:"BrtIndexBlock",f:parsenoop},43:{n:"BrtFont",f:function(data,length){var out={flags:{}};return out.dyHeight=data.read_shift(2),out.grbit=function(data,length){var d=data.read_shift(1);return data.l++,{fItalic:2&d,fStrikeout:8&d,fOutline:16&d,fShadow:32&d,fCondense:64&d,fExtend:128&d}}(data),out.bls=data.read_shift(2),out.sss=data.read_shift(2),out.uls=data.read_shift(1),out.bFamily=data.read_shift(1),out.bCharSet=data.read_shift(1),data.l++,out.brtColor=function(data,length){var out={},d=data.read_shift(1);out.fValidRGB=1&d,out.xColorType=d>>>1,out.index=data.read_shift(1),out.nTintAndShade=data.read_shift(2,"i"),out.bRed=data.read_shift(1),out.bGreen=data.read_shift(1),out.bBlue=data.read_shift(1),out.bAlpha=data.read_shift(1)}(data),out.bFontScheme=data.read_shift(1),out.name=parse_XLWideString(data),out.flags.Bold=700===out.bls,out.flags.Italic=out.grbit.fItalic,out.flags.Strikeout=out.grbit.fStrikeout,out.flags.Outline=out.grbit.fOutline,out.flags.Shadow=out.grbit.fShadow,out.flags.Condense=out.grbit.fCondense,out.flags.Extend=out.grbit.fExtend,out.flags.Sub=2&out.sss,out.flags.Sup=1&out.sss,out}},44:{n:"BrtFmt",f:function(data,length){return[data.read_shift(2),parse_XLWideString(data)]}},45:{n:"BrtFill",f:parsenoop},46:{n:"BrtBorder",f:parsenoop},47:{n:"BrtXF",f:function(data,length){var ixfeParent=data.read_shift(2),ifmt=data.read_shift(2);return parsenoop(data,length-4),{ixfe:ixfeParent,ifmt:ifmt}}},48:{n:"BrtStyle",f:parsenoop},49:{n:"BrtCellMeta",f:parsenoop},50:{n:"BrtValueMeta",f:parsenoop},51:{n:"BrtMdb",f:parsenoop},52:{n:"BrtBeginFmd",f:parsenoop},53:{n:"BrtEndFmd",f:parsenoop},54:{n:"BrtBeginMdx",f:parsenoop},55:{n:"BrtEndMdx",f:parsenoop},56:{n:"BrtBeginMdxTuple",f:parsenoop},57:{n:"BrtEndMdxTuple",f:parsenoop},58:{n:"BrtMdxMbrIstr",f:parsenoop},59:{n:"BrtStr",f:parsenoop},60:{n:"BrtColInfo",f:parsenoop},62:{n:"BrtCellRString",f:parsenoop},63:{n:"BrtCalcChainItem$",f:function(data,length){var out={};out.i=data.read_shift(4);var cell={};cell.r=data.read_shift(4),cell.c=data.read_shift(4),out.r=encode_cell(cell);var flags=data.read_shift(1);return 2&flags&&(out.l="1"),8&flags&&(out.a="1"),out}},64:{n:"BrtDVal",f:parsenoop},65:{n:"BrtSxvcellNum",f:parsenoop},66:{n:"BrtSxvcellStr",f:parsenoop},67:{n:"BrtSxvcellBool",f:parsenoop},68:{n:"BrtSxvcellErr",f:parsenoop},69:{n:"BrtSxvcellDate",f:parsenoop},70:{n:"BrtSxvcellNil",f:parsenoop},128:{n:"BrtFileVersion",f:parsenoop},129:{n:"BrtBeginSheet",f:parsenoop},130:{n:"BrtEndSheet",f:parsenoop},131:{n:"BrtBeginBook",f:parsenoop,p:0},132:{n:"BrtEndBook",f:parsenoop},133:{n:"BrtBeginWsViews",f:parsenoop},134:{n:"BrtEndWsViews",f:parsenoop},135:{n:"BrtBeginBookViews",f:parsenoop},136:{n:"BrtEndBookViews",f:parsenoop},137:{n:"BrtBeginWsView",f:parsenoop},138:{n:"BrtEndWsView",f:parsenoop},139:{n:"BrtBeginCsViews",f:parsenoop},140:{n:"BrtEndCsViews",f:parsenoop},141:{n:"BrtBeginCsView",f:parsenoop},142:{n:"BrtEndCsView",f:parsenoop},143:{n:"BrtBeginBundleShs",f:parsenoop},144:{n:"BrtEndBundleShs",f:parsenoop},145:{n:"BrtBeginSheetData",f:parsenoop},146:{n:"BrtEndSheetData",f:parsenoop},147:{n:"BrtWsProp",f:function(data,length){var z={};return data.l+=19,z.name=function(data,length){return parse_XLWideString(data)}(data),z}},148:{n:"BrtWsDim",f:parse_BrtWsDim,p:16},151:{n:"BrtPane",f:parsenoop},152:{n:"BrtSel",f:parsenoop},153:{n:"BrtWbProp",f:function(data,length){return data.read_shift(4),[data.read_shift(4),length>8?parse_XLWideString(data):""]}},154:{n:"BrtWbFactoid",f:parsenoop},155:{n:"BrtFileRecover",f:parsenoop},156:{n:"BrtBundleSh",f:function(data,length){var z={};return z.hsState=data.read_shift(4),z.iTabID=data.read_shift(4),z.strRelID=parse_RelID(data,length-8),z.name=parse_XLWideString(data),z}},157:{n:"BrtCalcProp",f:parsenoop},158:{n:"BrtBookView",f:parsenoop},159:{n:"BrtBeginSst",f:function(data,length){return[data.read_shift(4),data.read_shift(4)]}},160:{n:"BrtEndSst",f:parsenoop},161:{n:"BrtBeginAFilter",f:parsenoop},162:{n:"BrtEndAFilter",f:parsenoop},163:{n:"BrtBeginFilterColumn",f:parsenoop},164:{n:"BrtEndFilterColumn",f:parsenoop},165:{n:"BrtBeginFilters",f:parsenoop},166:{n:"BrtEndFilters",f:parsenoop},167:{n:"BrtFilter",f:parsenoop},168:{n:"BrtColorFilter",f:parsenoop},169:{n:"BrtIconFilter",f:parsenoop},170:{n:"BrtTop10Filter",f:parsenoop},171:{n:"BrtDynamicFilter",f:parsenoop},172:{n:"BrtBeginCustomFilters",f:parsenoop},173:{n:"BrtEndCustomFilters",f:parsenoop},174:{n:"BrtCustomFilter",f:parsenoop},175:{n:"BrtAFilterDateGroupItem",f:parsenoop},176:{n:"BrtMergeCell",f:parse_BrtMergeCell},177:{n:"BrtBeginMergeCells",f:parsenoop},178:{n:"BrtEndMergeCells",f:parsenoop},179:{n:"BrtBeginPivotCacheDef",f:parsenoop},180:{n:"BrtEndPivotCacheDef",f:parsenoop},181:{n:"BrtBeginPCDFields",f:parsenoop},182:{n:"BrtEndPCDFields",f:parsenoop},183:{n:"BrtBeginPCDField",f:parsenoop},184:{n:"BrtEndPCDField",f:parsenoop},185:{n:"BrtBeginPCDSource",f:parsenoop},186:{n:"BrtEndPCDSource",f:parsenoop},187:{n:"BrtBeginPCDSRange",f:parsenoop},188:{n:"BrtEndPCDSRange",f:parsenoop},189:{n:"BrtBeginPCDFAtbl",f:parsenoop},190:{n:"BrtEndPCDFAtbl",f:parsenoop},191:{n:"BrtBeginPCDIRun",f:parsenoop},192:{n:"BrtEndPCDIRun",f:parsenoop},193:{n:"BrtBeginPivotCacheRecords",f:parsenoop},194:{n:"BrtEndPivotCacheRecords",f:parsenoop},195:{n:"BrtBeginPCDHierarchies",f:parsenoop},196:{n:"BrtEndPCDHierarchies",f:parsenoop},197:{n:"BrtBeginPCDHierarchy",f:parsenoop},198:{n:"BrtEndPCDHierarchy",f:parsenoop},199:{n:"BrtBeginPCDHFieldsUsage",f:parsenoop},200:{n:"BrtEndPCDHFieldsUsage",f:parsenoop},201:{n:"BrtBeginExtConnection",f:parsenoop},202:{n:"BrtEndExtConnection",f:parsenoop},203:{n:"BrtBeginECDbProps",f:parsenoop},204:{n:"BrtEndECDbProps",f:parsenoop},205:{n:"BrtBeginECOlapProps",f:parsenoop},206:{n:"BrtEndECOlapProps",f:parsenoop},207:{n:"BrtBeginPCDSConsol",f:parsenoop},208:{n:"BrtEndPCDSConsol",f:parsenoop},209:{n:"BrtBeginPCDSCPages",f:parsenoop},210:{n:"BrtEndPCDSCPages",f:parsenoop},211:{n:"BrtBeginPCDSCPage",f:parsenoop},212:{n:"BrtEndPCDSCPage",f:parsenoop},213:{n:"BrtBeginPCDSCPItem",f:parsenoop},214:{n:"BrtEndPCDSCPItem",f:parsenoop},215:{n:"BrtBeginPCDSCSets",f:parsenoop},216:{n:"BrtEndPCDSCSets",f:parsenoop},217:{n:"BrtBeginPCDSCSet",f:parsenoop},218:{n:"BrtEndPCDSCSet",f:parsenoop},219:{n:"BrtBeginPCDFGroup",f:parsenoop},220:{n:"BrtEndPCDFGroup",f:parsenoop},221:{n:"BrtBeginPCDFGItems",f:parsenoop},222:{n:"BrtEndPCDFGItems",f:parsenoop},223:{n:"BrtBeginPCDFGRange",f:parsenoop},224:{n:"BrtEndPCDFGRange",f:parsenoop},225:{n:"BrtBeginPCDFGDiscrete",f:parsenoop},226:{n:"BrtEndPCDFGDiscrete",f:parsenoop},227:{n:"BrtBeginPCDSDTupleCache",f:parsenoop},228:{n:"BrtEndPCDSDTupleCache",f:parsenoop},229:{n:"BrtBeginPCDSDTCEntries",f:parsenoop},230:{n:"BrtEndPCDSDTCEntries",f:parsenoop},231:{n:"BrtBeginPCDSDTCEMembers",f:parsenoop},232:{n:"BrtEndPCDSDTCEMembers",f:parsenoop},233:{n:"BrtBeginPCDSDTCEMember",f:parsenoop},234:{n:"BrtEndPCDSDTCEMember",f:parsenoop},235:{n:"BrtBeginPCDSDTCQueries",f:parsenoop},236:{n:"BrtEndPCDSDTCQueries",f:parsenoop},237:{n:"BrtBeginPCDSDTCQuery",f:parsenoop},238:{n:"BrtEndPCDSDTCQuery",f:parsenoop},239:{n:"BrtBeginPCDSDTCSets",f:parsenoop},240:{n:"BrtEndPCDSDTCSets",f:parsenoop},241:{n:"BrtBeginPCDSDTCSet",f:parsenoop},242:{n:"BrtEndPCDSDTCSet",f:parsenoop},243:{n:"BrtBeginPCDCalcItems",f:parsenoop},244:{n:"BrtEndPCDCalcItems",f:parsenoop},245:{n:"BrtBeginPCDCalcItem",f:parsenoop},246:{n:"BrtEndPCDCalcItem",f:parsenoop},247:{n:"BrtBeginPRule",f:parsenoop},248:{n:"BrtEndPRule",f:parsenoop},249:{n:"BrtBeginPRFilters",f:parsenoop},250:{n:"BrtEndPRFilters",f:parsenoop},251:{n:"BrtBeginPRFilter",f:parsenoop},252:{n:"BrtEndPRFilter",f:parsenoop},253:{n:"BrtBeginPNames",f:parsenoop},254:{n:"BrtEndPNames",f:parsenoop},255:{n:"BrtBeginPName",f:parsenoop},256:{n:"BrtEndPName",f:parsenoop},257:{n:"BrtBeginPNPairs",f:parsenoop},258:{n:"BrtEndPNPairs",f:parsenoop},259:{n:"BrtBeginPNPair",f:parsenoop},260:{n:"BrtEndPNPair",f:parsenoop},261:{n:"BrtBeginECWebProps",f:parsenoop},262:{n:"BrtEndECWebProps",f:parsenoop},263:{n:"BrtBeginEcWpTables",f:parsenoop},264:{n:"BrtEndECWPTables",f:parsenoop},265:{n:"BrtBeginECParams",f:parsenoop},266:{n:"BrtEndECParams",f:parsenoop},267:{n:"BrtBeginECParam",f:parsenoop},268:{n:"BrtEndECParam",f:parsenoop},269:{n:"BrtBeginPCDKPIs",f:parsenoop},270:{n:"BrtEndPCDKPIs",f:parsenoop},271:{n:"BrtBeginPCDKPI",f:parsenoop},272:{n:"BrtEndPCDKPI",f:parsenoop},273:{n:"BrtBeginDims",f:parsenoop},274:{n:"BrtEndDims",f:parsenoop},275:{n:"BrtBeginDim",f:parsenoop},276:{n:"BrtEndDim",f:parsenoop},277:{n:"BrtIndexPartEnd",f:parsenoop},278:{n:"BrtBeginStyleSheet",f:parsenoop},279:{n:"BrtEndStyleSheet",f:parsenoop},280:{n:"BrtBeginSXView",f:parsenoop},281:{n:"BrtEndSXVI",f:parsenoop},282:{n:"BrtBeginSXVI",f:parsenoop},283:{n:"BrtBeginSXVIs",f:parsenoop},284:{n:"BrtEndSXVIs",f:parsenoop},285:{n:"BrtBeginSXVD",f:parsenoop},286:{n:"BrtEndSXVD",f:parsenoop},287:{n:"BrtBeginSXVDs",f:parsenoop},288:{n:"BrtEndSXVDs",f:parsenoop},289:{n:"BrtBeginSXPI",f:parsenoop},290:{n:"BrtEndSXPI",f:parsenoop},291:{n:"BrtBeginSXPIs",f:parsenoop},292:{n:"BrtEndSXPIs",f:parsenoop},293:{n:"BrtBeginSXDI",f:parsenoop},294:{n:"BrtEndSXDI",f:parsenoop},295:{n:"BrtBeginSXDIs",f:parsenoop},296:{n:"BrtEndSXDIs",f:parsenoop},297:{n:"BrtBeginSXLI",f:parsenoop},298:{n:"BrtEndSXLI",f:parsenoop},299:{n:"BrtBeginSXLIRws",f:parsenoop},300:{n:"BrtEndSXLIRws",f:parsenoop},301:{n:"BrtBeginSXLICols",f:parsenoop},302:{n:"BrtEndSXLICols",f:parsenoop},303:{n:"BrtBeginSXFormat",f:parsenoop},304:{n:"BrtEndSXFormat",f:parsenoop},305:{n:"BrtBeginSXFormats",f:parsenoop},306:{n:"BrtEndSxFormats",f:parsenoop},307:{n:"BrtBeginSxSelect",f:parsenoop},308:{n:"BrtEndSxSelect",f:parsenoop},309:{n:"BrtBeginISXVDRws",f:parsenoop},310:{n:"BrtEndISXVDRws",f:parsenoop},311:{n:"BrtBeginISXVDCols",f:parsenoop},312:{n:"BrtEndISXVDCols",f:parsenoop},313:{n:"BrtEndSXLocation",f:parsenoop},314:{n:"BrtBeginSXLocation",f:parsenoop},315:{n:"BrtEndSXView",f:parsenoop},316:{n:"BrtBeginSXTHs",f:parsenoop},317:{n:"BrtEndSXTHs",f:parsenoop},318:{n:"BrtBeginSXTH",f:parsenoop},319:{n:"BrtEndSXTH",f:parsenoop},320:{n:"BrtBeginISXTHRws",f:parsenoop},321:{n:"BrtEndISXTHRws",f:parsenoop},322:{n:"BrtBeginISXTHCols",f:parsenoop},323:{n:"BrtEndISXTHCols",f:parsenoop},324:{n:"BrtBeginSXTDMPS",f:parsenoop},325:{n:"BrtEndSXTDMPs",f:parsenoop},326:{n:"BrtBeginSXTDMP",f:parsenoop},327:{n:"BrtEndSXTDMP",f:parsenoop},328:{n:"BrtBeginSXTHItems",f:parsenoop},329:{n:"BrtEndSXTHItems",f:parsenoop},330:{n:"BrtBeginSXTHItem",f:parsenoop},331:{n:"BrtEndSXTHItem",f:parsenoop},332:{n:"BrtBeginMetadata",f:parsenoop},333:{n:"BrtEndMetadata",f:parsenoop},334:{n:"BrtBeginEsmdtinfo",f:parsenoop},335:{n:"BrtMdtinfo",f:parsenoop},336:{n:"BrtEndEsmdtinfo",f:parsenoop},337:{n:"BrtBeginEsmdb",f:parsenoop},338:{n:"BrtEndEsmdb",f:parsenoop},339:{n:"BrtBeginEsfmd",f:parsenoop},340:{n:"BrtEndEsfmd",f:parsenoop},341:{n:"BrtBeginSingleCells",f:parsenoop},342:{n:"BrtEndSingleCells",f:parsenoop},343:{n:"BrtBeginList",f:parsenoop},344:{n:"BrtEndList",f:parsenoop},345:{n:"BrtBeginListCols",f:parsenoop},346:{n:"BrtEndListCols",f:parsenoop},347:{n:"BrtBeginListCol",f:parsenoop},348:{n:"BrtEndListCol",f:parsenoop},349:{n:"BrtBeginListXmlCPr",f:parsenoop},350:{n:"BrtEndListXmlCPr",f:parsenoop},351:{n:"BrtListCCFmla",f:parsenoop},352:{n:"BrtListTrFmla",f:parsenoop},353:{n:"BrtBeginExternals",f:parsenoop},354:{n:"BrtEndExternals",f:parsenoop},355:{n:"BrtSupBookSrc",f:parsenoop},357:{n:"BrtSupSelf",f:parsenoop},358:{n:"BrtSupSame",f:parsenoop},359:{n:"BrtSupTabs",f:parsenoop},360:{n:"BrtBeginSupBook",f:parsenoop},361:{n:"BrtPlaceholderName",f:parsenoop},362:{n:"BrtExternSheet",f:parsenoop},363:{n:"BrtExternTableStart",f:parsenoop},364:{n:"BrtExternTableEnd",f:parsenoop},366:{n:"BrtExternRowHdr",f:parsenoop},367:{n:"BrtExternCellBlank",f:parsenoop},368:{n:"BrtExternCellReal",f:parsenoop},369:{n:"BrtExternCellBool",f:parsenoop},370:{n:"BrtExternCellError",f:parsenoop},371:{n:"BrtExternCellString",f:parsenoop},372:{n:"BrtBeginEsmdx",f:parsenoop},373:{n:"BrtEndEsmdx",f:parsenoop},374:{n:"BrtBeginMdxSet",f:parsenoop},375:{n:"BrtEndMdxSet",f:parsenoop},376:{n:"BrtBeginMdxMbrProp",f:parsenoop},377:{n:"BrtEndMdxMbrProp",f:parsenoop},378:{n:"BrtBeginMdxKPI",f:parsenoop},379:{n:"BrtEndMdxKPI",f:parsenoop},380:{n:"BrtBeginEsstr",f:parsenoop},381:{n:"BrtEndEsstr",f:parsenoop},382:{n:"BrtBeginPRFItem",f:parsenoop},383:{n:"BrtEndPRFItem",f:parsenoop},384:{n:"BrtBeginPivotCacheIDs",f:parsenoop},385:{n:"BrtEndPivotCacheIDs",f:parsenoop},386:{n:"BrtBeginPivotCacheID",f:parsenoop},387:{n:"BrtEndPivotCacheID",f:parsenoop},388:{n:"BrtBeginISXVIs",f:parsenoop},389:{n:"BrtEndISXVIs",f:parsenoop},390:{n:"BrtBeginColInfos",f:parsenoop},391:{n:"BrtEndColInfos",f:parsenoop},392:{n:"BrtBeginRwBrk",f:parsenoop},393:{n:"BrtEndRwBrk",f:parsenoop},394:{n:"BrtBeginColBrk",f:parsenoop},395:{n:"BrtEndColBrk",f:parsenoop},396:{n:"BrtBrk",f:parsenoop},397:{n:"BrtUserBookView",f:parsenoop},398:{n:"BrtInfo",f:parsenoop},399:{n:"BrtCUsr",f:parsenoop},400:{n:"BrtUsr",f:parsenoop},401:{n:"BrtBeginUsers",f:parsenoop},403:{n:"BrtEOF",f:parsenoop},404:{n:"BrtUCR",f:parsenoop},405:{n:"BrtRRInsDel",f:parsenoop},406:{n:"BrtRREndInsDel",f:parsenoop},407:{n:"BrtRRMove",f:parsenoop},408:{n:"BrtRREndMove",f:parsenoop},409:{n:"BrtRRChgCell",f:parsenoop},410:{n:"BrtRREndChgCell",f:parsenoop},411:{n:"BrtRRHeader",f:parsenoop},412:{n:"BrtRRUserView",f:parsenoop},413:{n:"BrtRRRenSheet",f:parsenoop},414:{n:"BrtRRInsertSh",f:parsenoop},415:{n:"BrtRRDefName",f:parsenoop},416:{n:"BrtRRNote",f:parsenoop},417:{n:"BrtRRConflict",f:parsenoop},418:{n:"BrtRRTQSIF",f:parsenoop},419:{n:"BrtRRFormat",f:parsenoop},420:{n:"BrtRREndFormat",f:parsenoop},421:{n:"BrtRRAutoFmt",f:parsenoop},422:{n:"BrtBeginUserShViews",f:parsenoop},423:{n:"BrtBeginUserShView",f:parsenoop},424:{n:"BrtEndUserShView",f:parsenoop},425:{n:"BrtEndUserShViews",f:parsenoop},426:{n:"BrtArrFmla",f:parsenoop},427:{n:"BrtShrFmla",f:parsenoop},428:{n:"BrtTable",f:parsenoop},429:{n:"BrtBeginExtConnections",f:parsenoop},430:{n:"BrtEndExtConnections",f:parsenoop},431:{n:"BrtBeginPCDCalcMems",f:parsenoop},432:{n:"BrtEndPCDCalcMems",f:parsenoop},433:{n:"BrtBeginPCDCalcMem",f:parsenoop},434:{n:"BrtEndPCDCalcMem",f:parsenoop},435:{n:"BrtBeginPCDHGLevels",f:parsenoop},436:{n:"BrtEndPCDHGLevels",f:parsenoop},437:{n:"BrtBeginPCDHGLevel",f:parsenoop},438:{n:"BrtEndPCDHGLevel",f:parsenoop},439:{n:"BrtBeginPCDHGLGroups",f:parsenoop},440:{n:"BrtEndPCDHGLGroups",f:parsenoop},441:{n:"BrtBeginPCDHGLGroup",f:parsenoop},442:{n:"BrtEndPCDHGLGroup",f:parsenoop},443:{n:"BrtBeginPCDHGLGMembers",f:parsenoop},444:{n:"BrtEndPCDHGLGMembers",f:parsenoop},445:{n:"BrtBeginPCDHGLGMember",f:parsenoop},446:{n:"BrtEndPCDHGLGMember",f:parsenoop},447:{n:"BrtBeginQSI",f:parsenoop},448:{n:"BrtEndQSI",f:parsenoop},449:{n:"BrtBeginQSIR",f:parsenoop},450:{n:"BrtEndQSIR",f:parsenoop},451:{n:"BrtBeginDeletedNames",f:parsenoop},452:{n:"BrtEndDeletedNames",f:parsenoop},453:{n:"BrtBeginDeletedName",f:parsenoop},454:{n:"BrtEndDeletedName",f:parsenoop},455:{n:"BrtBeginQSIFs",f:parsenoop},456:{n:"BrtEndQSIFs",f:parsenoop},457:{n:"BrtBeginQSIF",f:parsenoop},458:{n:"BrtEndQSIF",f:parsenoop},459:{n:"BrtBeginAutoSortScope",f:parsenoop},460:{n:"BrtEndAutoSortScope",f:parsenoop},461:{n:"BrtBeginConditionalFormatting",f:parsenoop},462:{n:"BrtEndConditionalFormatting",f:parsenoop},463:{n:"BrtBeginCFRule",f:parsenoop},464:{n:"BrtEndCFRule",f:parsenoop},465:{n:"BrtBeginIconSet",f:parsenoop},466:{n:"BrtEndIconSet",f:parsenoop},467:{n:"BrtBeginDatabar",f:parsenoop},468:{n:"BrtEndDatabar",f:parsenoop},469:{n:"BrtBeginColorScale",f:parsenoop},470:{n:"BrtEndColorScale",f:parsenoop},471:{n:"BrtCFVO",f:parsenoop},472:{n:"BrtExternValueMeta",f:parsenoop},473:{n:"BrtBeginColorPalette",f:parsenoop},474:{n:"BrtEndColorPalette",f:parsenoop},475:{n:"BrtIndexedColor",f:parsenoop},476:{n:"BrtMargins",f:parsenoop},477:{n:"BrtPrintOptions",f:parsenoop},478:{n:"BrtPageSetup",f:parsenoop},479:{n:"BrtBeginHeaderFooter",f:parsenoop},480:{n:"BrtEndHeaderFooter",f:parsenoop},481:{n:"BrtBeginSXCrtFormat",f:parsenoop},482:{n:"BrtEndSXCrtFormat",f:parsenoop},483:{n:"BrtBeginSXCrtFormats",f:parsenoop},484:{n:"BrtEndSXCrtFormats",f:parsenoop},485:{n:"BrtWsFmtInfo",f:parsenoop},486:{n:"BrtBeginMgs",f:parsenoop},487:{n:"BrtEndMGs",f:parsenoop},488:{n:"BrtBeginMGMaps",f:parsenoop},489:{n:"BrtEndMGMaps",f:parsenoop},490:{n:"BrtBeginMG",f:parsenoop},491:{n:"BrtEndMG",f:parsenoop},492:{n:"BrtBeginMap",f:parsenoop},493:{n:"BrtEndMap",f:parsenoop},494:{n:"BrtHLink",f:function(data,length,opts){var end=data.l+length,rfx=parse_UncheckedRfX(data),relId=parse_XLNullableWideString(data),loc=parse_XLWideString(data),tooltip=parse_XLWideString(data),display=parse_XLWideString(data);return data.l=end,{rfx:rfx,relId:relId,loc:loc,tooltip:tooltip,display:display}}},495:{n:"BrtBeginDCon",f:parsenoop},496:{n:"BrtEndDCon",f:parsenoop},497:{n:"BrtBeginDRefs",f:parsenoop},498:{n:"BrtEndDRefs",f:parsenoop},499:{n:"BrtDRef",f:parsenoop},500:{n:"BrtBeginScenMan",f:parsenoop},501:{n:"BrtEndScenMan",f:parsenoop},502:{n:"BrtBeginSct",f:parsenoop},503:{n:"BrtEndSct",f:parsenoop},504:{n:"BrtSlc",f:parsenoop},505:{n:"BrtBeginDXFs",f:parsenoop},506:{n:"BrtEndDXFs",f:parsenoop},507:{n:"BrtDXF",f:parsenoop},508:{n:"BrtBeginTableStyles",f:parsenoop},509:{n:"BrtEndTableStyles",f:parsenoop},510:{n:"BrtBeginTableStyle",f:parsenoop},511:{n:"BrtEndTableStyle",f:parsenoop},512:{n:"BrtTableStyleElement",f:parsenoop},513:{n:"BrtTableStyleClient",f:parsenoop},514:{n:"BrtBeginVolDeps",f:parsenoop},515:{n:"BrtEndVolDeps",f:parsenoop},516:{n:"BrtBeginVolType",f:parsenoop},517:{n:"BrtEndVolType",f:parsenoop},518:{n:"BrtBeginVolMain",f:parsenoop},519:{n:"BrtEndVolMain",f:parsenoop},520:{n:"BrtBeginVolTopic",f:parsenoop},521:{n:"BrtEndVolTopic",f:parsenoop},522:{n:"BrtVolSubtopic",f:parsenoop},523:{n:"BrtVolRef",f:parsenoop},524:{n:"BrtVolNum",f:parsenoop},525:{n:"BrtVolErr",f:parsenoop},526:{n:"BrtVolStr",f:parsenoop},527:{n:"BrtVolBool",f:parsenoop},528:{n:"BrtBeginCalcChain$",f:parsenoop},529:{n:"BrtEndCalcChain$",f:parsenoop},530:{n:"BrtBeginSortState",f:parsenoop},531:{n:"BrtEndSortState",f:parsenoop},532:{n:"BrtBeginSortCond",f:parsenoop},533:{n:"BrtEndSortCond",f:parsenoop},534:{n:"BrtBookProtection",f:parsenoop},535:{n:"BrtSheetProtection",f:parsenoop},536:{n:"BrtRangeProtection",f:parsenoop},537:{n:"BrtPhoneticInfo",f:parsenoop},538:{n:"BrtBeginECTxtWiz",f:parsenoop},539:{n:"BrtEndECTxtWiz",f:parsenoop},540:{n:"BrtBeginECTWFldInfoLst",f:parsenoop},541:{n:"BrtEndECTWFldInfoLst",f:parsenoop},542:{n:"BrtBeginECTwFldInfo",f:parsenoop},548:{n:"BrtFileSharing",f:parsenoop},549:{n:"BrtOleSize",f:parsenoop},550:{n:"BrtDrawing",f:parsenoop},551:{n:"BrtLegacyDrawing",f:parsenoop},552:{n:"BrtLegacyDrawingHF",f:parsenoop},553:{n:"BrtWebOpt",f:parsenoop},554:{n:"BrtBeginWebPubItems",f:parsenoop},555:{n:"BrtEndWebPubItems",f:parsenoop},556:{n:"BrtBeginWebPubItem",f:parsenoop},557:{n:"BrtEndWebPubItem",f:parsenoop},558:{n:"BrtBeginSXCondFmt",f:parsenoop},559:{n:"BrtEndSXCondFmt",f:parsenoop},560:{n:"BrtBeginSXCondFmts",f:parsenoop},561:{n:"BrtEndSXCondFmts",f:parsenoop},562:{n:"BrtBkHim",f:parsenoop},564:{n:"BrtColor",f:parsenoop},565:{n:"BrtBeginIndexedColors",f:parsenoop},566:{n:"BrtEndIndexedColors",f:parsenoop},569:{n:"BrtBeginMRUColors",f:parsenoop},570:{n:"BrtEndMRUColors",f:parsenoop},572:{n:"BrtMRUColor",f:parsenoop},573:{n:"BrtBeginDVals",f:parsenoop},574:{n:"BrtEndDVals",f:parsenoop},577:{n:"BrtSupNameStart",f:parsenoop},578:{n:"BrtSupNameValueStart",f:parsenoop},579:{n:"BrtSupNameValueEnd",f:parsenoop},580:{n:"BrtSupNameNum",f:parsenoop},581:{n:"BrtSupNameErr",f:parsenoop},582:{n:"BrtSupNameSt",f:parsenoop},583:{n:"BrtSupNameNil",f:parsenoop},584:{n:"BrtSupNameBool",f:parsenoop},585:{n:"BrtSupNameFmla",f:parsenoop},586:{n:"BrtSupNameBits",f:parsenoop},587:{n:"BrtSupNameEnd",f:parsenoop},588:{n:"BrtEndSupBook",f:parsenoop},589:{n:"BrtCellSmartTagProperty",f:parsenoop},590:{n:"BrtBeginCellSmartTag",f:parsenoop},591:{n:"BrtEndCellSmartTag",f:parsenoop},592:{n:"BrtBeginCellSmartTags",f:parsenoop},593:{n:"BrtEndCellSmartTags",f:parsenoop},594:{n:"BrtBeginSmartTags",f:parsenoop},595:{n:"BrtEndSmartTags",f:parsenoop},596:{n:"BrtSmartTagType",f:parsenoop},597:{n:"BrtBeginSmartTagTypes",f:parsenoop},598:{n:"BrtEndSmartTagTypes",f:parsenoop},599:{n:"BrtBeginSXFilters",f:parsenoop},600:{n:"BrtEndSXFilters",f:parsenoop},601:{n:"BrtBeginSXFILTER",f:parsenoop},602:{n:"BrtEndSXFilter",f:parsenoop},603:{n:"BrtBeginFills",f:parsenoop},604:{n:"BrtEndFills",f:parsenoop},605:{n:"BrtBeginCellWatches",f:parsenoop},606:{n:"BrtEndCellWatches",f:parsenoop},607:{n:"BrtCellWatch",f:parsenoop},608:{n:"BrtBeginCRErrs",f:parsenoop},609:{n:"BrtEndCRErrs",f:parsenoop},610:{n:"BrtCrashRecErr",f:parsenoop},611:{n:"BrtBeginFonts",f:parsenoop},612:{n:"BrtEndFonts",f:parsenoop},613:{n:"BrtBeginBorders",f:parsenoop},614:{n:"BrtEndBorders",f:parsenoop},615:{n:"BrtBeginFmts",f:parsenoop},616:{n:"BrtEndFmts",f:parsenoop},617:{n:"BrtBeginCellXFs",f:parsenoop},618:{n:"BrtEndCellXFs",f:parsenoop},619:{n:"BrtBeginStyles",f:parsenoop},620:{n:"BrtEndStyles",f:parsenoop},625:{n:"BrtBigName",f:parsenoop},626:{n:"BrtBeginCellStyleXFs",f:parsenoop},627:{n:"BrtEndCellStyleXFs",f:parsenoop},628:{n:"BrtBeginComments",f:parsenoop},629:{n:"BrtEndComments",f:parsenoop},630:{n:"BrtBeginCommentAuthors",f:parsenoop},631:{n:"BrtEndCommentAuthors",f:parsenoop},632:{n:"BrtCommentAuthor",f:parse_BrtCommentAuthor},633:{n:"BrtBeginCommentList",f:parsenoop},634:{n:"BrtEndCommentList",f:parsenoop},635:{n:"BrtBeginComment",f:function(data,length){var out={};out.iauthor=data.read_shift(4);var rfx=parse_UncheckedRfX(data);return out.rfx=rfx.s,out.ref=encode_cell(rfx.s),data.l+=16,out}},636:{n:"BrtEndComment",f:parsenoop},637:{n:"BrtCommentText",f:parse_BrtCommentText},638:{n:"BrtBeginOleObjects",f:parsenoop},639:{n:"BrtOleObject",f:parsenoop},640:{n:"BrtEndOleObjects",f:parsenoop},641:{n:"BrtBeginSxrules",f:parsenoop},642:{n:"BrtEndSxRules",f:parsenoop},643:{n:"BrtBeginActiveXControls",f:parsenoop},644:{n:"BrtActiveX",f:parsenoop},645:{n:"BrtEndActiveXControls",f:parsenoop},646:{n:"BrtBeginPCDSDTCEMembersSortBy",f:parsenoop},648:{n:"BrtBeginCellIgnoreECs",f:parsenoop},649:{n:"BrtCellIgnoreEC",f:parsenoop},650:{n:"BrtEndCellIgnoreECs",f:parsenoop},651:{n:"BrtCsProp",f:parsenoop},652:{n:"BrtCsPageSetup",f:parsenoop},653:{n:"BrtBeginUserCsViews",f:parsenoop},654:{n:"BrtEndUserCsViews",f:parsenoop},655:{n:"BrtBeginUserCsView",f:parsenoop},656:{n:"BrtEndUserCsView",f:parsenoop},657:{n:"BrtBeginPcdSFCIEntries",f:parsenoop},658:{n:"BrtEndPCDSFCIEntries",f:parsenoop},659:{n:"BrtPCDSFCIEntry",f:parsenoop},660:{n:"BrtBeginListParts",f:parsenoop},661:{n:"BrtListPart",f:parsenoop},662:{n:"BrtEndListParts",f:parsenoop},663:{n:"BrtSheetCalcProp",f:parsenoop},664:{n:"BrtBeginFnGroup",f:parsenoop},665:{n:"BrtFnGroup",f:parsenoop},666:{n:"BrtEndFnGroup",f:parsenoop},667:{n:"BrtSupAddin",f:parsenoop},668:{n:"BrtSXTDMPOrder",f:parsenoop},669:{n:"BrtCsProtection",f:parsenoop},671:{n:"BrtBeginWsSortMap",f:parsenoop},672:{n:"BrtEndWsSortMap",f:parsenoop},673:{n:"BrtBeginRRSort",f:parsenoop},674:{n:"BrtEndRRSort",f:parsenoop},675:{n:"BrtRRSortItem",f:parsenoop},676:{n:"BrtFileSharingIso",f:parsenoop},677:{n:"BrtBookProtectionIso",f:parsenoop},678:{n:"BrtSheetProtectionIso",f:parsenoop},679:{n:"BrtCsProtectionIso",f:parsenoop},680:{n:"BrtRangeProtectionIso",f:parsenoop},1024:{n:"BrtRwDescent",f:parsenoop},1025:{n:"BrtKnownFonts",f:parsenoop},1026:{n:"BrtBeginSXTupleSet",f:parsenoop},1027:{n:"BrtEndSXTupleSet",f:parsenoop},1028:{n:"BrtBeginSXTupleSetHeader",f:parsenoop},1029:{n:"BrtEndSXTupleSetHeader",f:parsenoop},1030:{n:"BrtSXTupleSetHeaderItem",f:parsenoop},1031:{n:"BrtBeginSXTupleSetData",f:parsenoop},1032:{n:"BrtEndSXTupleSetData",f:parsenoop},1033:{n:"BrtBeginSXTupleSetRow",f:parsenoop},1034:{n:"BrtEndSXTupleSetRow",f:parsenoop},1035:{n:"BrtSXTupleSetRowItem",f:parsenoop},1036:{n:"BrtNameExt",f:parsenoop},1037:{n:"BrtPCDH14",f:parsenoop},1038:{n:"BrtBeginPCDCalcMem14",f:parsenoop},1039:{n:"BrtEndPCDCalcMem14",f:parsenoop},1040:{n:"BrtSXTH14",f:parsenoop},1041:{n:"BrtBeginSparklineGroup",f:parsenoop},1042:{n:"BrtEndSparklineGroup",f:parsenoop},1043:{n:"BrtSparkline",f:parsenoop},1044:{n:"BrtSXDI14",f:parsenoop},1045:{n:"BrtWsFmtInfoEx14",f:parsenoop},1046:{n:"BrtBeginConditionalFormatting14",f:parsenoop},1047:{n:"BrtEndConditionalFormatting14",f:parsenoop},1048:{n:"BrtBeginCFRule14",f:parsenoop},1049:{n:"BrtEndCFRule14",f:parsenoop},1050:{n:"BrtCFVO14",f:parsenoop},1051:{n:"BrtBeginDatabar14",f:parsenoop},1052:{n:"BrtBeginIconSet14",f:parsenoop},1053:{n:"BrtDVal14",f:parsenoop},1054:{n:"BrtBeginDVals14",f:parsenoop},1055:{n:"BrtColor14",f:parsenoop},1056:{n:"BrtBeginSparklines",f:parsenoop},1057:{n:"BrtEndSparklines",f:parsenoop},1058:{n:"BrtBeginSparklineGroups",f:parsenoop},1059:{n:"BrtEndSparklineGroups",f:parsenoop},1061:{n:"BrtSXVD14",f:parsenoop},1062:{n:"BrtBeginSxview14",f:parsenoop},1063:{n:"BrtEndSxview14",f:parsenoop},1066:{n:"BrtBeginPCD14",f:parsenoop},1067:{n:"BrtEndPCD14",f:parsenoop},1068:{n:"BrtBeginExtConn14",f:parsenoop},1069:{n:"BrtEndExtConn14",f:parsenoop},1070:{n:"BrtBeginSlicerCacheIDs",f:parsenoop},1071:{n:"BrtEndSlicerCacheIDs",f:parsenoop},1072:{n:"BrtBeginSlicerCacheID",f:parsenoop},1073:{n:"BrtEndSlicerCacheID",f:parsenoop},1075:{n:"BrtBeginSlicerCache",f:parsenoop},1076:{n:"BrtEndSlicerCache",f:parsenoop},1077:{n:"BrtBeginSlicerCacheDef",f:parsenoop},1078:{n:"BrtEndSlicerCacheDef",f:parsenoop},1079:{n:"BrtBeginSlicersEx",f:parsenoop},1080:{n:"BrtEndSlicersEx",f:parsenoop},1081:{n:"BrtBeginSlicerEx",f:parsenoop},1082:{n:"BrtEndSlicerEx",f:parsenoop},1083:{n:"BrtBeginSlicer",f:parsenoop},1084:{n:"BrtEndSlicer",f:parsenoop},1085:{n:"BrtSlicerCachePivotTables",f:parsenoop},1086:{n:"BrtBeginSlicerCacheOlapImpl",f:parsenoop},1087:{n:"BrtEndSlicerCacheOlapImpl",f:parsenoop},1088:{n:"BrtBeginSlicerCacheLevelsData",f:parsenoop},1089:{n:"BrtEndSlicerCacheLevelsData",f:parsenoop},1090:{n:"BrtBeginSlicerCacheLevelData",f:parsenoop},1091:{n:"BrtEndSlicerCacheLevelData",f:parsenoop},1092:{n:"BrtBeginSlicerCacheSiRanges",f:parsenoop},1093:{n:"BrtEndSlicerCacheSiRanges",f:parsenoop},1094:{n:"BrtBeginSlicerCacheSiRange",f:parsenoop},1095:{n:"BrtEndSlicerCacheSiRange",f:parsenoop},1096:{n:"BrtSlicerCacheOlapItem",f:parsenoop},1097:{n:"BrtBeginSlicerCacheSelections",f:parsenoop},1098:{n:"BrtSlicerCacheSelection",f:parsenoop},1099:{n:"BrtEndSlicerCacheSelections",f:parsenoop},1100:{n:"BrtBeginSlicerCacheNative",f:parsenoop},1101:{n:"BrtEndSlicerCacheNative",f:parsenoop},1102:{n:"BrtSlicerCacheNativeItem",f:parsenoop},1103:{n:"BrtRangeProtection14",f:parsenoop},1104:{n:"BrtRangeProtectionIso14",f:parsenoop},1105:{n:"BrtCellIgnoreEC14",f:parsenoop},1111:{n:"BrtList14",f:parsenoop},1112:{n:"BrtCFIcon",f:parsenoop},1113:{n:"BrtBeginSlicerCachesPivotCacheIDs",f:parsenoop},1114:{n:"BrtEndSlicerCachesPivotCacheIDs",f:parsenoop},1115:{n:"BrtBeginSlicers",f:parsenoop},1116:{n:"BrtEndSlicers",f:parsenoop},1117:{n:"BrtWbProp14",f:parsenoop},1118:{n:"BrtBeginSXEdit",f:parsenoop},1119:{n:"BrtEndSXEdit",f:parsenoop},1120:{n:"BrtBeginSXEdits",f:parsenoop},1121:{n:"BrtEndSXEdits",f:parsenoop},1122:{n:"BrtBeginSXChange",f:parsenoop},1123:{n:"BrtEndSXChange",f:parsenoop},1124:{n:"BrtBeginSXChanges",f:parsenoop},1125:{n:"BrtEndSXChanges",f:parsenoop},1126:{n:"BrtSXTupleItems",f:parsenoop},1128:{n:"BrtBeginSlicerStyle",f:parsenoop},1129:{n:"BrtEndSlicerStyle",f:parsenoop},1130:{n:"BrtSlicerStyleElement",f:parsenoop},1131:{n:"BrtBeginStyleSheetExt14",f:parsenoop},1132:{n:"BrtEndStyleSheetExt14",f:parsenoop},1133:{n:"BrtBeginSlicerCachesPivotCacheID",f:parsenoop},1134:{n:"BrtEndSlicerCachesPivotCacheID",f:parsenoop},1135:{n:"BrtBeginConditionalFormattings",f:parsenoop},1136:{n:"BrtEndConditionalFormattings",f:parsenoop},1137:{n:"BrtBeginPCDCalcMemExt",f:parsenoop},1138:{n:"BrtEndPCDCalcMemExt",f:parsenoop},1139:{n:"BrtBeginPCDCalcMemsExt",f:parsenoop},1140:{n:"BrtEndPCDCalcMemsExt",f:parsenoop},1141:{n:"BrtPCDField14",f:parsenoop},1142:{n:"BrtBeginSlicerStyles",f:parsenoop},1143:{n:"BrtEndSlicerStyles",f:parsenoop},1144:{n:"BrtBeginSlicerStyleElements",f:parsenoop},1145:{n:"BrtEndSlicerStyleElements",f:parsenoop},1146:{n:"BrtCFRuleExt",f:parsenoop},1147:{n:"BrtBeginSXCondFmt14",f:parsenoop},1148:{n:"BrtEndSXCondFmt14",f:parsenoop},1149:{n:"BrtBeginSXCondFmts14",f:parsenoop},1150:{n:"BrtEndSXCondFmts14",f:parsenoop},1152:{n:"BrtBeginSortCond14",f:parsenoop},1153:{n:"BrtEndSortCond14",f:parsenoop},1154:{n:"BrtEndDVals14",f:parsenoop},1155:{n:"BrtEndIconSet14",f:parsenoop},1156:{n:"BrtEndDatabar14",f:parsenoop},1157:{n:"BrtBeginColorScale14",f:parsenoop},1158:{n:"BrtEndColorScale14",f:parsenoop},1159:{n:"BrtBeginSxrules14",f:parsenoop},1160:{n:"BrtEndSxrules14",f:parsenoop},1161:{n:"BrtBeginPRule14",f:parsenoop},1162:{n:"BrtEndPRule14",f:parsenoop},1163:{n:"BrtBeginPRFilters14",f:parsenoop},1164:{n:"BrtEndPRFilters14",f:parsenoop},1165:{n:"BrtBeginPRFilter14",f:parsenoop},1166:{n:"BrtEndPRFilter14",f:parsenoop},1167:{n:"BrtBeginPRFItem14",f:parsenoop},1168:{n:"BrtEndPRFItem14",f:parsenoop},1169:{n:"BrtBeginCellIgnoreECs14",f:parsenoop},1170:{n:"BrtEndCellIgnoreECs14",f:parsenoop},1171:{n:"BrtDxf14",f:parsenoop},1172:{n:"BrtBeginDxF14s",f:parsenoop},1173:{n:"BrtEndDxf14s",f:parsenoop},1177:{n:"BrtFilter14",f:parsenoop},1178:{n:"BrtBeginCustomFilters14",f:parsenoop},1180:{n:"BrtCustomFilter14",f:parsenoop},1181:{n:"BrtIconFilter14",f:parsenoop},1182:{n:"BrtPivotCacheConnectionName",f:parsenoop},2048:{n:"BrtBeginDecoupledPivotCacheIDs",f:parsenoop},2049:{n:"BrtEndDecoupledPivotCacheIDs",f:parsenoop},2050:{n:"BrtDecoupledPivotCacheID",f:parsenoop},2051:{n:"BrtBeginPivotTableRefs",f:parsenoop},2052:{n:"BrtEndPivotTableRefs",f:parsenoop},2053:{n:"BrtPivotTableRef",f:parsenoop},2054:{n:"BrtSlicerCacheBookPivotTables",f:parsenoop},2055:{n:"BrtBeginSxvcells",f:parsenoop},2056:{n:"BrtEndSxvcells",f:parsenoop},2057:{n:"BrtBeginSxRow",f:parsenoop},2058:{n:"BrtEndSxRow",f:parsenoop},2060:{n:"BrtPcdCalcMem15",f:parsenoop},2067:{n:"BrtQsi15",f:parsenoop},2068:{n:"BrtBeginWebExtensions",f:parsenoop},2069:{n:"BrtEndWebExtensions",f:parsenoop},2070:{n:"BrtWebExtension",f:parsenoop},2071:{n:"BrtAbsPath15",f:parsenoop},2072:{n:"BrtBeginPivotTableUISettings",f:parsenoop},2073:{n:"BrtEndPivotTableUISettings",f:parsenoop},2075:{n:"BrtTableSlicerCacheIDs",f:parsenoop},2076:{n:"BrtTableSlicerCacheID",f:parsenoop},2077:{n:"BrtBeginTableSlicerCache",f:parsenoop},2078:{n:"BrtEndTableSlicerCache",f:parsenoop},2079:{n:"BrtSxFilter15",f:parsenoop},2080:{n:"BrtBeginTimelineCachePivotCacheIDs",f:parsenoop},2081:{n:"BrtEndTimelineCachePivotCacheIDs",f:parsenoop},2082:{n:"BrtTimelineCachePivotCacheID",f:parsenoop},2083:{n:"BrtBeginTimelineCacheIDs",f:parsenoop},2084:{n:"BrtEndTimelineCacheIDs",f:parsenoop},2085:{n:"BrtBeginTimelineCacheID",f:parsenoop},2086:{n:"BrtEndTimelineCacheID",f:parsenoop},2087:{n:"BrtBeginTimelinesEx",f:parsenoop},2088:{n:"BrtEndTimelinesEx",f:parsenoop},2089:{n:"BrtBeginTimelineEx",f:parsenoop},2090:{n:"BrtEndTimelineEx",f:parsenoop},2091:{n:"BrtWorkBookPr15",f:parsenoop},2092:{n:"BrtPCDH15",f:parsenoop},2093:{n:"BrtBeginTimelineStyle",f:parsenoop},2094:{n:"BrtEndTimelineStyle",f:parsenoop},2095:{n:"BrtTimelineStyleElement",f:parsenoop},2096:{n:"BrtBeginTimelineStylesheetExt15",f:parsenoop},2097:{n:"BrtEndTimelineStylesheetExt15",f:parsenoop},2098:{n:"BrtBeginTimelineStyles",f:parsenoop},2099:{n:"BrtEndTimelineStyles",f:parsenoop},2100:{n:"BrtBeginTimelineStyleElements",f:parsenoop},2101:{n:"BrtEndTimelineStyleElements",f:parsenoop},2102:{n:"BrtDxf15",f:parsenoop},2103:{n:"BrtBeginDxfs15",f:parsenoop},2104:{n:"brtEndDxfs15",f:parsenoop},2105:{n:"BrtSlicerCacheHideItemsWithNoData",f:parsenoop},2106:{n:"BrtBeginItemUniqueNames",f:parsenoop},2107:{n:"BrtEndItemUniqueNames",f:parsenoop},2108:{n:"BrtItemUniqueName",f:parsenoop},2109:{n:"BrtBeginExtConn15",f:parsenoop},2110:{n:"BrtEndExtConn15",f:parsenoop},2111:{n:"BrtBeginOledbPr15",f:parsenoop},2112:{n:"BrtEndOledbPr15",f:parsenoop},2113:{n:"BrtBeginDataFeedPr15",f:parsenoop},2114:{n:"BrtEndDataFeedPr15",f:parsenoop},2115:{n:"BrtTextPr15",f:parsenoop},2116:{n:"BrtRangePr15",f:parsenoop},2117:{n:"BrtDbCommand15",f:parsenoop},2118:{n:"BrtBeginDbTables15",f:parsenoop},2119:{n:"BrtEndDbTables15",f:parsenoop},2120:{n:"BrtDbTable15",f:parsenoop},2121:{n:"BrtBeginDataModel",f:parsenoop},2122:{n:"BrtEndDataModel",f:parsenoop},2123:{n:"BrtBeginModelTables",f:parsenoop},2124:{n:"BrtEndModelTables",f:parsenoop},2125:{n:"BrtModelTable",f:parsenoop},2126:{n:"BrtBeginModelRelationships",f:parsenoop},2127:{n:"BrtEndModelRelationships",f:parsenoop},2128:{n:"BrtModelRelationship",f:parsenoop},2129:{n:"BrtBeginECTxtWiz15",f:parsenoop},2130:{n:"BrtEndECTxtWiz15",f:parsenoop},2131:{n:"BrtBeginECTWFldInfoLst15",f:parsenoop},2132:{n:"BrtEndECTWFldInfoLst15",f:parsenoop},2133:{n:"BrtBeginECTWFldInfo15",f:parsenoop},2134:{n:"BrtFieldListActiveItem",f:parsenoop},2135:{n:"BrtPivotCacheIdVersion",f:parsenoop},2136:{n:"BrtSXDI15",f:parsenoop},65535:{n:"",f:parsenoop}},evert_RE=function(obj,key){for(var o=[],K=keys(obj),i=0;i!==K.length;++i)o[obj[K[i]][key]]=K[i];return o}(XLSBRecordEnum,"n"),XLSRecordEnum={3:{n:"BIFF2NUM",f:function(blob,length,opts){var cell=parse_XLSCell(blob);++blob.l;var num=parse_Xnum(blob);return cell.val=num,cell}},4:{n:"BIFF2STR",f:function(blob,length,opts){var cell=parse_XLSCell(blob);++blob.l;var str=parse_XLUnicodeString2(blob,0,opts);return cell.val=str,cell}},6:{n:"Formula",f:parse_Formula},9:{n:"BOF",f:parse_BOF},10:{n:"EOF",f:parse_EOF},12:{n:"CalcCount",f:parse_CalcCount},13:{n:"CalcMode",f:parse_CalcMode},14:{n:"CalcPrecision",f:parse_CalcPrecision},15:{n:"CalcRefMode",f:parse_CalcRefMode},16:{n:"CalcDelta",f:parse_CalcDelta},17:{n:"CalcIter",f:parse_CalcIter},18:{n:"Protect",f:parse_Protect},19:{n:"Password",f:parse_Password},20:{n:"Header",f:parse_Header},21:{n:"Footer",f:parse_Footer},23:{n:"ExternSheet",f:function(blob,length,opts){if(opts.biff<8)return parse_ShortXLUnicodeString(blob,0,opts);var o=function(blob,length,cb){for(var arr=[],target=blob.l+length,len=blob.read_shift(2);0!=len--;)arr.push(cb(blob,target-blob.l));if(target!==blob.l)throw new Error("Slurp error");return arr}(blob,length,parse_XTI),oo=[];if(1025===opts.sbcch){for(var i=0;i!=o.length;++i)oo.push(opts.snames[o[i][1]]);return oo}return o}},24:{n:"Lbl",f:function(blob,length,opts){if(opts.biff<8)return parse_Label(blob,0,opts);var target=blob.l+length,chKey=(blob.read_shift(2),blob.read_shift(1)),cch=blob.read_shift(1),cce=blob.read_shift(2);return blob.l+=2,blob.read_shift(2),blob.l+=4,{chKey:chKey,Name:parse_XLUnicodeStringNoCch(blob,cch),rgce:function(blob,length,opts,cce){var rgcb,target=blob.l+length,rgce=parse_Rgce(blob,cce);return target!==blob.l&&(rgcb=parse_RgbExtra(blob,target-blob.l,rgce,opts)),[rgce,rgcb]}(blob,target-blob.l,opts,cce)}}},25:{n:"WinProtect",f:parse_WinProtect},26:{n:"VerticalPageBreaks",f:parse_VerticalPageBreaks},27:{n:"HorizontalPageBreaks",f:parse_HorizontalPageBreaks},28:{n:"Note",f:function(blob,length,opts){return function(blob,length,opts){if(!(opts.biff<8)){var row=blob.read_shift(2),col=blob.read_shift(2),flags=blob.read_shift(2),idObj=blob.read_shift(2),stAuthor=parse_XLUnicodeString2(blob,0,opts);return opts.biff<8&&blob.read_shift(1),[{r:row,c:col},stAuthor,idObj,flags]}}(blob,0,opts)}},29:{n:"Selection",f:parse_Selection},34:{n:"Date1904",f:parse_Date1904},35:{n:"ExternName",f:parse_ExternName},38:{n:"LeftMargin",f:parse_LeftMargin},39:{n:"RightMargin",f:parse_RightMargin},40:{n:"TopMargin",f:parse_TopMargin},41:{n:"BottomMargin",f:parse_BottomMargin},42:{n:"PrintRowCol",f:parse_PrintRowCol},43:{n:"PrintGrid",f:parse_PrintGrid},47:{n:"FilePass",f:function(blob,length,opts){var o={Type:blob.read_shift(2)};return o.Type?parse_FilePassHeader(blob,length-2,o):parse_XORObfuscation(blob,0,opts,o),o}},49:{n:"Font",f:function(blob,length,opts){return blob.l+=14,parse_ShortXLUnicodeString(blob,0,opts)}},51:{n:"PrintSize",f:parse_PrintSize},60:{n:"Continue",f:parse_Continue},61:{n:"Window1",f:function(blob,length){return{Pos:[blob.read_shift(2),blob.read_shift(2)],Dim:[blob.read_shift(2),blob.read_shift(2)],Flags:blob.read_shift(2),CurTab:blob.read_shift(2),FirstTab:blob.read_shift(2),Selected:blob.read_shift(2),TabRatio:blob.read_shift(2)}}},64:{n:"Backup",f:parse_Backup},65:{n:"Pane",f:parse_Pane},66:{n:"CodePage",f:parse_CodePage},77:{n:"Pls",f:parse_Pls},80:{n:"DCon",f:parse_DCon},81:{n:"DConRef",f:parse_DConRef},82:{n:"DConName",f:parse_DConName},85:{n:"DefColWidth",f:parse_DefColWidth},89:{n:"XCT",f:parse_XCT},90:{n:"CRN",f:parse_CRN},91:{n:"FileSharing",f:parse_FileSharing},92:{n:"WriteAccess",f:function(blob,length,opts){if(opts.enc)return blob.l+=length,"";var l=blob.l,UserName=parse_XLUnicodeString(blob,0,opts);return blob.read_shift(length+l-blob.l),UserName}},93:{n:"Obj",f:function(blob,length){var cmo=parse_FtCmo(blob);return{cmo:cmo,ft:function(blob,length,ot){for(var s=blob.l,fts=[];blob.l<s+length;){var ft=blob.read_shift(2);blob.l-=2;try{fts.push(FtTab[ft](blob,s+length-blob.l))}catch(e){return blob.l=s+length,fts}}return blob.l!=s+length&&(blob.l=s+length),fts}(blob,length-22,cmo[1])}}},94:{n:"Uncalced",f:parse_Uncalced},95:{n:"CalcSaveRecalc",f:parse_CalcSaveRecalc},96:{n:"Template",f:parse_Template},97:{n:"Intl",f:parse_Intl},99:{n:"ObjProtect",f:parse_ObjProtect},125:{n:"ColInfo",f:parse_ColInfo},128:{n:"Guts",f:function(blob,length){blob.l+=4;var out=[blob.read_shift(2),blob.read_shift(2)];if(0!==out[0]&&out[0]--,0!==out[1]&&out[1]--,out[0]>7||out[1]>7)throw"Bad Gutters: "+out;return out}},129:{n:"WsBool",f:parse_WsBool},130:{n:"GridSet",f:parse_GridSet},131:{n:"HCenter",f:parse_HCenter},132:{n:"VCenter",f:parse_VCenter},133:{n:"BoundSheet8",f:function(blob,length,opts){var pos=blob.read_shift(4),hidden=blob.read_shift(1)>>6,dt=blob.read_shift(1);switch(dt){case 0:dt="Worksheet";break;case 1:dt="Macrosheet";break;case 2:dt="Chartsheet";break;case 6:dt="VBAModule"}var name=parse_ShortXLUnicodeString(blob,0,opts);return 0===name.length&&(name="Sheet1"),{pos:pos,hs:hidden,dt:dt,name:name}}},134:{n:"WriteProtect",f:parse_WriteProtect},140:{n:"Country",f:function(blob,length){var d,o=[];return d=blob.read_shift(2),o[0]=CountryEnum[d]||d,d=blob.read_shift(2),o[1]=CountryEnum[d]||d,o}},141:{n:"HideObj",f:parse_HideObj},144:{n:"Sort",f:parse_Sort},146:{n:"Palette",f:function(blob,length){for(var ccv=blob.read_shift(2),o=[];ccv-- >0;)o.push(parse_LongRGB(blob));return o}},151:{n:"Sync",f:parse_Sync},152:{n:"LPr",f:parse_LPr},153:{n:"DxGCol",f:parse_DxGCol},154:{n:"FnGroupName",f:parse_FnGroupName},155:{n:"FilterMode",f:parse_FilterMode},156:{n:"BuiltInFnGroupCount",f:parse_BuiltInFnGroupCount},157:{n:"AutoFilterInfo",f:parse_AutoFilterInfo},158:{n:"AutoFilter",f:parse_AutoFilter},160:{n:"Scl",f:parse_Scl},161:{n:"Setup",f:parse_Setup},174:{n:"ScenMan",f:parse_ScenMan},175:{n:"SCENARIO",f:parse_SCENARIO},176:{n:"SxView",f:parse_SxView},177:{n:"Sxvd",f:parse_Sxvd},178:{n:"SXVI",f:parse_SXVI},180:{n:"SxIvd",f:parse_SxIvd},181:{n:"SXLI",f:parse_SXLI},182:{n:"SXPI",f:parse_SXPI},184:{n:"DocRoute",f:parse_DocRoute},185:{n:"RecipName",f:parse_RecipName},189:{n:"MulRk",f:function(blob,length){for(var target=blob.l+length-2,rw=blob.read_shift(2),col=blob.read_shift(2),rkrecs=[];blob.l<target;)rkrecs.push(parse_RkRec(blob));if(blob.l!==target)throw"MulRK read error";var lastcol=blob.read_shift(2);if(rkrecs.length!=lastcol-col+1)throw"MulRK length mismatch";return{r:rw,c:col,C:lastcol,rkrec:rkrecs}}},190:{n:"MulBlank",f:parse_MulBlank},193:{n:"Mms",f:parse_Mms},197:{n:"SXDI",f:parse_SXDI},198:{n:"SXDB",f:parse_SXDB},199:{n:"SXFDB",f:parse_SXFDB},200:{n:"SXDBB",f:parse_SXDBB},201:{n:"SXNum",f:parse_SXNum},202:{n:"SxBool",f:parse_SxBool},203:{n:"SxErr",f:parse_SxErr},204:{n:"SXInt",f:parse_SXInt},205:{n:"SXString",f:parse_SXString},206:{n:"SXDtr",f:parse_SXDtr},207:{n:"SxNil",f:parse_SxNil},208:{n:"SXTbl",f:parse_SXTbl},209:{n:"SXTBRGIITM",f:parse_SXTBRGIITM},210:{n:"SxTbpg",f:parse_SxTbpg},211:{n:"ObProj",f:parse_ObProj},213:{n:"SXStreamID",f:parse_SXStreamID},215:{n:"DBCell",f:parse_DBCell},216:{n:"SXRng",f:parse_SXRng},217:{n:"SxIsxoper",f:parse_SxIsxoper},218:{n:"BookBool",f:parse_BookBool},220:{n:"DbOrParamQry",f:parse_DbOrParamQry},221:{n:"ScenarioProtect",f:parse_ScenarioProtect},222:{n:"OleObjectSize",f:parse_OleObjectSize},224:{n:"XF",f:function(blob,length){var o={};return o.ifnt=blob.read_shift(2),o.ifmt=blob.read_shift(2),o.flags=blob.read_shift(2),o.fStyle=o.flags>>2&1,o.data=parse_CellStyleXF(blob,0,o.fStyle),o}},225:{n:"InterfaceHdr",f:function(blob,length){if(0===length)return 1200;var q;if(1200!==(q=blob.read_shift(2)))throw"InterfaceHdr codePage "+q;return 1200}},226:{n:"InterfaceEnd",f:parse_InterfaceEnd},227:{n:"SXVS",f:parse_SXVS},229:{n:"MergeCells",f:function(blob,length){for(var merges=[],cmcs=blob.read_shift(2);cmcs--;)merges.push(parse_Ref8U(blob));return merges}},233:{n:"BkHim",f:parse_BkHim},235:{n:"MsoDrawingGroup",f:parse_MsoDrawingGroup},236:{n:"MsoDrawing",f:parse_MsoDrawing},237:{n:"MsoDrawingSelection",f:parse_MsoDrawingSelection},239:{n:"PhoneticInfo",f:parse_PhoneticInfo},240:{n:"SxRule",f:parse_SxRule},241:{n:"SXEx",f:parse_SXEx},242:{n:"SxFilt",f:parse_SxFilt},244:{n:"SxDXF",f:parse_SxDXF},245:{n:"SxItm",f:parse_SxItm},246:{n:"SxName",f:parse_SxName},247:{n:"SxSelect",f:parse_SxSelect},248:{n:"SXPair",f:parse_SXPair},249:{n:"SxFmla",f:parse_SxFmla},251:{n:"SxFormat",f:parse_SxFormat},252:{n:"SST",f:function(blob,length){for(var cnt=blob.read_shift(4),ucnt=blob.read_shift(4),strs=[],i=0;i!=ucnt;++i)strs.push(parse_XLUnicodeRichExtendedString(blob));return strs.Count=cnt,strs.Unique=ucnt,strs}},253:{n:"LabelSst",f:function(blob,length){var cell=parse_XLSCell(blob);return cell.isst=blob.read_shift(4),cell}},255:{n:"ExtSST",f:function(blob,length){var extsst={};return extsst.dsst=blob.read_shift(2),blob.l+=length-2,extsst}},256:{n:"SXVDEx",f:parse_SXVDEx},259:{n:"SXFormula",f:parse_SXFormula},290:{n:"SXDBEx",f:parse_SXDBEx},311:{n:"RRDInsDel",f:parse_RRDInsDel},312:{n:"RRDHead",f:parse_RRDHead},315:{n:"RRDChgCell",f:parse_RRDChgCell},317:{n:"RRTabId",f:parse_RRTabId},318:{n:"RRDRenSheet",f:parse_RRDRenSheet},319:{n:"RRSort",f:parse_RRSort},320:{n:"RRDMove",f:parse_RRDMove},330:{n:"RRFormat",f:parse_RRFormat},331:{n:"RRAutoFmt",f:parse_RRAutoFmt},333:{n:"RRInsertSh",f:parse_RRInsertSh},334:{n:"RRDMoveBegin",f:parse_RRDMoveBegin},335:{n:"RRDMoveEnd",f:parse_RRDMoveEnd},336:{n:"RRDInsDelBegin",f:parse_RRDInsDelBegin},337:{n:"RRDInsDelEnd",f:parse_RRDInsDelEnd},338:{n:"RRDConflict",f:parse_RRDConflict},339:{n:"RRDDefName",f:parse_RRDDefName},340:{n:"RRDRstEtxp",f:parse_RRDRstEtxp},351:{n:"LRng",f:parse_LRng},352:{n:"UsesELFs",f:parse_UsesELFs},353:{n:"DSF",f:parse_DSF},401:{n:"CUsr",f:parse_CUsr},402:{n:"CbUsr",f:parse_CbUsr},403:{n:"UsrInfo",f:parse_UsrInfo},404:{n:"UsrExcl",f:parse_UsrExcl},405:{n:"FileLock",f:parse_FileLock},406:{n:"RRDInfo",f:parse_RRDInfo},407:{n:"BCUsrs",f:parse_BCUsrs},408:{n:"UsrChk",f:parse_UsrChk},425:{n:"UserBView",f:parse_UserBView},426:{n:"UserSViewBegin",f:parse_UserSViewBegin},427:{n:"UserSViewEnd",f:parse_UserSViewEnd},428:{n:"RRDUserView",f:parse_RRDUserView},429:{n:"Qsi",f:parse_Qsi},430:{n:"SupBook",f:function(blob,length,opts){var virtPath,end=blob.l+length,ctab=blob.read_shift(2),cch=blob.read_shift(2);cch>=1&&cch<=255&&(virtPath=parse_XLUnicodeStringNoCch(blob,cch));var rgst=blob.read_shift(end-blob.l);return opts.sbcch=cch,[cch,ctab,virtPath,rgst]}},431:{n:"Prot4Rev",f:parse_Prot4Rev},432:{n:"CondFmt",f:parse_CondFmt},433:{n:"CF",f:parse_CF},434:{n:"DVal",f:parse_DVal},437:{n:"DConBin",f:parse_DConBin},438:{n:"TxO",f:function(blob,length,opts){var s=blob.l;try{blob.l+=4;var ot=(opts.lastobj||{cmo:[0,0]}).cmo[1];-1==[0,5,7,11,12,14].indexOf(ot)?blob.l+=6:parse_ControlInfo(blob,6,opts);var cchText=blob.read_shift(2),len=(blob.read_shift(2),parse_FontIndex(blob,2),blob.read_shift(2));blob.l+=len;for(var texts="",i=1;i<blob.lens.length-1;++i){if(blob.l-s!=blob.lens[i])throw"TxO: bad continue record";var hdr=blob[blob.l];if((texts+=parse_XLUnicodeStringNoCch(blob,blob.lens[i+1]-blob.lens[i]-1)).length>=(hdr?cchText:2*cchText))break}if(texts.length!==cchText&&texts.length!==2*cchText)throw"cchText: "+cchText+" != "+texts.length;return blob.l=s+length,{t:texts}}catch(e){return blob.l=s+length,{t:texts||""}}}},439:{n:"RefreshAll",f:parse_RefreshAll},440:{n:"HLink",f:function(blob,length){var ref=parse_Ref8U(blob);return blob.l+=16,[ref,function(blob,length){var end=blob.l+length,sVer=blob.read_shift(4);if(2!==sVer)throw new Error("Unrecognized streamVersion: "+sVer);var targetFrameName,moniker,oleMoniker,location,flags=blob.read_shift(2);blob.l+=2,16&flags&&parse_HyperlinkString(blob,blob.l),128&flags&&(targetFrameName=parse_HyperlinkString(blob,blob.l)),257==(257&flags)&&(moniker=parse_HyperlinkString(blob,blob.l)),1==(257&flags)&&(oleMoniker=parse_HyperlinkMoniker(blob,blob.l)),8&flags&&(location=parse_HyperlinkString(blob,blob.l)),32&flags&&blob.read_shift(16),64&flags&&parse_FILETIME(blob),blob.l=end;var target=targetFrameName||moniker||oleMoniker;return location&&(target+="#"+location),{Target:target}}(blob,length-24)]}},441:{n:"Lel",f:parse_Lel},442:{n:"CodeName",f:parse_XLSCodeName},443:{n:"SXFDBType",f:parse_SXFDBType},444:{n:"Prot4RevPass",f:parse_Prot4RevPass},445:{n:"ObNoMacros",f:parse_ObNoMacros},446:{n:"Dv",f:parse_Dv},448:{n:"Excel9File",f:parse_Excel9File},449:{n:"RecalcId",f:function(blob,length){return blob.read_shift(2),blob.read_shift(4)},r:2},450:{n:"EntExU2",f:parse_EntExU2},512:{n:"Dimensions",f:function(blob,length){var w=10===length?2:4,r=blob.read_shift(w),R=blob.read_shift(w),c=blob.read_shift(2),C=blob.read_shift(2);return blob.l+=2,{s:{r:r,c:c},e:{r:R,c:C}}}},513:{n:"Blank",f:parse_Blank},515:{n:"Number",f:function(blob,length){var cell=parse_XLSCell(blob),xnum=parse_Xnum(blob);return cell.val=xnum,cell}},516:{n:"Label",f:parse_Label},517:{n:"BoolErr",f:function(blob,length){var cell=parse_XLSCell(blob),val=function(blob){var v=blob.read_shift(1);return 1===blob.read_shift(1)?v:1===v}(blob);return cell.val=val,cell.t=!0===val||!1===val?"b":"e",cell}},519:{n:"String",f:parse_String},520:{n:"Row",f:function(blob,length){var rw=blob.read_shift(2),col=blob.read_shift(2),Col=blob.read_shift(2);return blob.read_shift(2),blob.read_shift(4),blob.read_shift(1),blob.read_shift(1),blob.read_shift(2),{r:rw,c:col,cnt:Col-col}}},523:{n:"Index",f:parse_Index},545:{n:"Array",f:function(blob,length,opts){var ref=parse_Ref(blob,6);return blob.l+=6,[ref,function(blob,length,opts,ref){var rgcb,target=blob.l+length,cce=blob.read_shift(2);if(65535==cce)return[[],parsenoop(blob,length-2)];var rgce=parse_Rgce(blob,cce);return length!==cce+2&&(rgcb=parse_RgbExtra(blob,target-cce-2,rgce,opts)),[rgce,rgcb]}(blob,length-=12,opts)]}},549:{n:"DefaultRowHeight",f:function(blob,length){var f=blob.read_shift(2);return[{Unsynced:1&f,DyZero:(2&f)>>1,ExAsc:(4&f)>>2,ExDsc:(8&f)>>3},blob.read_shift(2)]}},566:{n:"Table",f:parse_Table},574:{n:"Window2",f:parse_Window2},638:{n:"RK",f:function(blob,length){var rw=blob.read_shift(2),col=blob.read_shift(2),rkrec=parse_RkRec(blob);return{r:rw,c:col,ixfe:rkrec[0],rknum:rkrec[1]}}},659:{n:"Style",f:parse_Style},1048:{n:"BigName",f:parse_BigName},1054:{n:"Format",f:function(blob,length,opts){return[blob.read_shift(2),parse_XLUnicodeString2(blob,0,opts)]}},1084:{n:"ContinueBigName",f:parse_ContinueBigName},1212:{n:"ShrFmla",f:function(blob,length,opts){parse_RefU(blob),blob.l++;var cUse=blob.read_shift(1);return[function(blob,length,opts){var rgcb,target=blob.l+length,cce=blob.read_shift(2),rgce=parse_Rgce(blob,cce);return 65535==cce?[[],parsenoop(blob,length-2)]:(length!==cce+2&&(rgcb=parse_RgbExtra(blob,target-cce-2,rgce,opts)),[rgce,rgcb])}(blob,length-=8,opts),cUse]}},2048:{n:"HLinkTooltip",f:function(blob,length){blob.l;blob.read_shift(2);var ref=parse_Ref8U(blob),wzTooltip=blob.read_shift((length-10)/2,"dbcs-cont");return[ref,wzTooltip=wzTooltip.replace(chr0,"")]}},2049:{n:"WebPub",f:parse_WebPub},2050:{n:"QsiSXTag",f:parse_QsiSXTag},2051:{n:"DBQueryExt",f:parse_DBQueryExt},2052:{n:"ExtString",f:parse_ExtString},2053:{n:"TxtQry",f:parse_TxtQry},2054:{n:"Qsir",f:parse_Qsir},2055:{n:"Qsif",f:parse_Qsif},2056:{n:"RRDTQSIF",f:parse_RRDTQSIF},2057:{n:"BOF",f:parse_BOF},2058:{n:"OleDbConn",f:parse_OleDbConn},2059:{n:"WOpt",f:parse_WOpt},2060:{n:"SXViewEx",f:parse_SXViewEx},2061:{n:"SXTH",f:parse_SXTH},2062:{n:"SXPIEx",f:parse_SXPIEx},2063:{n:"SXVDTEx",f:parse_SXVDTEx},2064:{n:"SXViewEx9",f:parse_SXViewEx9},2066:{n:"ContinueFrt",f:parse_ContinueFrt},2067:{n:"RealTimeData",f:parse_RealTimeData},2128:{n:"ChartFrtInfo",f:parse_ChartFrtInfo},2129:{n:"FrtWrapper",f:parse_FrtWrapper},2130:{n:"StartBlock",f:parse_StartBlock},2131:{n:"EndBlock",f:parse_EndBlock},2132:{n:"StartObject",f:parse_StartObject},2133:{n:"EndObject",f:parse_EndObject},2134:{n:"CatLab",f:parse_CatLab},2135:{n:"YMult",f:parse_YMult},2136:{n:"SXViewLink",f:parse_SXViewLink},2137:{n:"PivotChartBits",f:parse_PivotChartBits},2138:{n:"FrtFontList",f:parse_FrtFontList},2146:{n:"SheetExt",f:parse_SheetExt},2147:{n:"BookExt",f:parse_BookExt,r:12},2148:{n:"SXAddl",f:parse_SXAddl},2149:{n:"CrErr",f:parse_CrErr},2150:{n:"HFPicture",f:parse_HFPicture},2151:{n:"FeatHdr",f:parse_FeatHdr},2152:{n:"Feat",f:parse_Feat},2154:{n:"DataLabExt",f:parse_DataLabExt},2155:{n:"DataLabExtContents",f:parse_DataLabExtContents},2156:{n:"CellWatch",f:parse_CellWatch},2161:{n:"FeatHdr11",f:parse_FeatHdr11},2162:{n:"Feature11",f:parse_Feature11},2164:{n:"DropDownObjIds",f:parse_DropDownObjIds},2165:{n:"ContinueFrt11",f:parse_ContinueFrt11},2166:{n:"DConn",f:parse_DConn},2167:{n:"List12",f:parse_List12},2168:{n:"Feature12",f:parse_Feature12},2169:{n:"CondFmt12",f:parse_CondFmt12},2170:{n:"CF12",f:parse_CF12},2171:{n:"CFEx",f:parse_CFEx},2172:{n:"XFCRC",f:function(blob,length){blob.l+=2;var o={cxfs:0,crc:0};return o.cxfs=blob.read_shift(2),o.crc=blob.read_shift(4),o},r:12},2173:{n:"XFExt",f:function(blob,length){blob.l,blob.l+=2;var ixfe=blob.read_shift(2);blob.l+=2;for(var cexts=blob.read_shift(2),ext=[];cexts-- >0;)ext.push(parse_ExtProp(blob,blob.l));return{ixfe:ixfe,ext:ext}},r:12},2174:{n:"AutoFilter12",f:parse_AutoFilter12},2175:{n:"ContinueFrt12",f:parse_ContinueFrt12},2180:{n:"MDTInfo",f:parse_MDTInfo},2181:{n:"MDXStr",f:parse_MDXStr},2182:{n:"MDXTuple",f:parse_MDXTuple},2183:{n:"MDXSet",f:parse_MDXSet},2184:{n:"MDXProp",f:parse_MDXProp},2185:{n:"MDXKPI",f:parse_MDXKPI},2186:{n:"MDB",f:parse_MDB},2187:{n:"PLV",f:parse_PLV},2188:{n:"Compat12",f:parse_Compat12,r:12},2189:{n:"DXF",f:parse_DXF},2190:{n:"TableStyles",f:parse_TableStyles,r:12},2191:{n:"TableStyle",f:parse_TableStyle},2192:{n:"TableStyleElement",f:parse_TableStyleElement},2194:{n:"StyleExt",f:parse_StyleExt},2195:{n:"NamePublish",f:parse_NamePublish},2196:{n:"NameCmt",f:parse_NameCmt},2197:{n:"SortData",f:parse_SortData},2198:{n:"Theme",f:function(blob,length){124226!==blob.read_shift(4)&&(blob.l+=length-4)},r:12},2199:{n:"GUIDTypeLib",f:parse_GUIDTypeLib},2200:{n:"FnGrp12",f:parse_FnGrp12},2201:{n:"NameFnGrp12",f:parse_NameFnGrp12},2202:{n:"MTRSettings",f:function(blob,length){return[0!==blob.read_shift(4),0!==blob.read_shift(4),blob.read_shift(4)]},r:12},2203:{n:"CompressPictures",f:parse_CompressPictures},2204:{n:"HeaderFooter",f:parse_HeaderFooter},2205:{n:"CrtLayout12",f:parse_CrtLayout12},2206:{n:"CrtMlFrt",f:parse_CrtMlFrt},2207:{n:"CrtMlFrtContinue",f:parse_CrtMlFrtContinue},2211:{n:"ForceFullCalculation",f:function(blob,length){var header=function(blob){var rt=blob.read_shift(2),flags=blob.read_shift(2);return blob.l+=8,{type:rt,flags:flags}}(blob);if(2211!=header.type)throw"Invalid Future Record "+header.type;return 0!==blob.read_shift(4)}},2212:{n:"ShapePropsStream",f:parse_ShapePropsStream},2213:{n:"TextPropsStream",f:parse_TextPropsStream},2214:{n:"RichTextStream",f:parse_RichTextStream},2215:{n:"CrtLayout12A",f:parse_CrtLayout12A},4097:{n:"Units",f:parse_Units},4098:{n:"Chart",f:parse_Chart},4099:{n:"Series",f:parse_Series},4102:{n:"DataFormat",f:parse_DataFormat},4103:{n:"LineFormat",f:parse_LineFormat},4105:{n:"MarkerFormat",f:parse_MarkerFormat},4106:{n:"AreaFormat",f:parse_AreaFormat},4107:{n:"PieFormat",f:parse_PieFormat},4108:{n:"AttachedLabel",f:parse_AttachedLabel},4109:{n:"SeriesText",f:parse_SeriesText},4116:{n:"ChartFormat",f:parse_ChartFormat},4117:{n:"Legend",f:parse_Legend},4118:{n:"SeriesList",f:parse_SeriesList},4119:{n:"Bar",f:parse_Bar},4120:{n:"Line",f:parse_Line},4121:{n:"Pie",f:parse_Pie},4122:{n:"Area",f:parse_Area},4123:{n:"Scatter",f:parse_Scatter},4124:{n:"CrtLine",f:parse_CrtLine},4125:{n:"Axis",f:parse_Axis},4126:{n:"Tick",f:parse_Tick},4127:{n:"ValueRange",f:parse_ValueRange},4128:{n:"CatSerRange",f:parse_CatSerRange},4129:{n:"AxisLine",f:parse_AxisLine},4130:{n:"CrtLink",f:parse_CrtLink},4132:{n:"DefaultText",f:parse_DefaultText},4133:{n:"Text",f:parse_Text},4134:{n:"FontX",f:parse_FontX},4135:{n:"ObjectLink",f:parse_ObjectLink},4146:{n:"Frame",f:parse_Frame},4147:{n:"Begin",f:parse_Begin},4148:{n:"End",f:parse_End},4149:{n:"PlotArea",f:parse_PlotArea},4154:{n:"Chart3d",f:parse_Chart3d},4156:{n:"PicF",f:parse_PicF},4157:{n:"DropBar",f:parse_DropBar},4158:{n:"Radar",f:parse_Radar},4159:{n:"Surf",f:parse_Surf},4160:{n:"RadarArea",f:parse_RadarArea},4161:{n:"AxisParent",f:parse_AxisParent},4163:{n:"LegendException",f:parse_LegendException},4164:{n:"ShtProps",f:parse_ShtProps},4165:{n:"SerToCrt",f:parse_SerToCrt},4166:{n:"AxesUsed",f:parse_AxesUsed},4168:{n:"SBaseRef",f:parse_SBaseRef},4170:{n:"SerParent",f:parse_SerParent},4171:{n:"SerAuxTrend",f:parse_SerAuxTrend},4174:{n:"IFmtRecord",f:parse_IFmtRecord},4175:{n:"Pos",f:parse_Pos},4176:{n:"AlRuns",f:parse_AlRuns},4177:{n:"BRAI",f:parse_BRAI},4187:{n:"SerAuxErrBar",f:parse_SerAuxErrBar},4188:{n:"ClrtClient",f:function(blob,length){for(var ccv=blob.read_shift(2),o=[];ccv-- >0;)o.push(parse_LongRGB(blob));return o}},4189:{n:"SerFmt",f:parse_SerFmt},4191:{n:"Chart3DBarShape",f:parse_Chart3DBarShape},4192:{n:"Fbi",f:parse_Fbi},4193:{n:"BopPop",f:parse_BopPop},4194:{n:"AxcExt",f:parse_AxcExt},4195:{n:"Dat",f:parse_Dat},4196:{n:"PlotGrowth",f:parse_PlotGrowth},4197:{n:"SIIndex",f:parse_SIIndex},4198:{n:"GelFrame",f:parse_GelFrame},4199:{n:"BopPopCustom",f:parse_BopPopCustom},4200:{n:"Fbi2",f:parse_Fbi2},22:{n:"ExternCount",f:parsenoop},126:{n:"RK",f:parsenoop},127:{n:"ImData",f:parsenoop},135:{n:"Addin",f:parsenoop},136:{n:"Edg",f:parsenoop},137:{n:"Pub",f:parsenoop},145:{n:"Sub",f:parsenoop},148:{n:"LHRecord",f:parsenoop},149:{n:"LHNGraph",f:parsenoop},150:{n:"Sound",f:parsenoop},169:{n:"CoordList",f:parsenoop},171:{n:"GCW",f:parsenoop},188:{n:"ShrFmla",f:parsenoop},194:{n:"AddMenu",f:parsenoop},195:{n:"DelMenu",f:parsenoop},214:{n:"RString",f:parsenoop},223:{n:"UDDesc",f:parsenoop},234:{n:"TabIdConf",f:parsenoop},354:{n:"XL5Modify",f:parsenoop},421:{n:"FileSharing2",f:parsenoop},536:{n:"Name",f:parsenoop},547:{n:"ExternName",f:parse_ExternName},561:{n:"Font",f:parsenoop},1030:{n:"Formula",f:parse_Formula},2157:{n:"FeatInfo",f:parsenoop},2163:{n:"FeatInfo11",f:parsenoop},2177:{n:"SXAddl12",f:parsenoop},2240:{n:"AutoWebPub",f:parsenoop},2241:{n:"ListObj",f:parsenoop},2242:{n:"ListField",f:parsenoop},2243:{n:"ListDV",f:parsenoop},2244:{n:"ListCondFmt",f:parsenoop},2245:{n:"ListCF",f:parsenoop},2246:{n:"FMQry",f:parsenoop},2247:{n:"FMSQry",f:parsenoop},2248:{n:"PLV",f:parsenoop},2249:{n:"LnExt",f:parsenoop},2250:{n:"MkrExt",f:parsenoop},2251:{n:"CrtCoopt",f:parsenoop},0:{}};function fix_opts_func(defaults){return function(opts){for(var i=0;i!=defaults.length;++i){var d=defaults[i];void 0===opts[d[0]]&&(opts[d[0]]=d[1]),"n"===d[2]&&(opts[d[0]]=Number(opts[d[0]]))}}}var fix_read_opts=fix_opts_func([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]]),fix_write_opts=fix_opts_func([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["WTF",!1]]);function safe_parse_ws(zip,path,relsPath,sheet,sheetRels,sheets,opts){try{sheetRels[sheet]=parse_rels(getzipdata(zip,relsPath,!0),path),sheets[sheet]=parse_ws(getzipdata(zip,path),path,opts,sheetRels[sheet])}catch(e){if(opts.WTF)throw e}}var nodirs=function(x){return"/"!=x.substr(-1)};function parse_zip(zip,opts){if(make_ssf(SSF),fix_read_opts(opts=opts||{}),reset_cp(),safegetzipfile(zip,"META-INF/manifest.xml"))return function(zip,opts){if("undefined"!=typeof module&&"undefined"!=typeof require&&"undefined"==typeof ODS&&(ODS=require("./ods")),"undefined"==typeof ODS||!ODS.parse_ods)throw new Error("Unsupported ODS");return ODS.parse_ods(zip,opts)}(zip,opts);var sheets,binname,entries=keys(zip.files).filter(nodirs).sort(),dir=function(data,opts){var ctext={};if(!data||!data.match)return data;var ct={workbooks:[],sheets:[],calcchains:[],themes:[],styles:[],coreprops:[],extprops:[],custprops:[],strs:[],comments:[],vba:[],TODO:[],rels:[],xmlns:""};if((data.match(tagregex)||[]).forEach(function(x){var y=parsexmltag(x);switch(y[0].replace(nsregex,"<")){case"<?xml":break;case"<Types":ct.xmlns=y["xmlns"+(y[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":ctext[y.Extension]=y.ContentType;break;case"<Override":void 0!==ct[ct2type[y.ContentType]]?ct[ct2type[y.ContentType]].push(y.PartName):opts.WTF&&console.error(y)}}),ct.xmlns!==XMLNS.CT)throw new Error("Unknown Namespace: "+ct.xmlns);return ct.calcchain=ct.calcchains.length>0?ct.calcchains[0]:"",ct.sst=ct.strs.length>0?ct.strs[0]:"",ct.style=ct.styles.length>0?ct.styles[0]:"",ct.defaults=ctext,delete ct.calcchains,ct}(getzipdata(zip,"[Content_Types].xml"),opts),xlsb=!1;if(0===dir.workbooks.length&&getzipdata(zip,binname="xl/workbook.xml",!0)&&dir.workbooks.push(binname),0===dir.workbooks.length){if(!getzipfile(zip,binname="xl/workbook.bin"))throw new Error("Could not find workbook");dir.workbooks.push(binname),xlsb=!0}"bin"==dir.workbooks[0].substr(-3)&&(xlsb=!0),xlsb&&set_cp(1200),opts.bookSheets||opts.bookProps||(strs=[],dir.sst&&(strs=parse_sst(getzipdata(zip,dir.sst.replace(/^\//,"")),dir.sst,opts)),styles={},dir.style&&(styles=parse_sty(getzipdata(zip,dir.style.replace(/^\//,"")),dir.style,opts)),themes={},opts.cellStyles&&dir.themes.length&&(themes=parse_theme(getzipdata(zip,dir.themes[0].replace(/^\//,""),!0),dir.themes[0],opts)));var wb=parse_wb(getzipdata(zip,dir.workbooks[0].replace(/^\//,"")),dir.workbooks[0],opts),props={},propdata="";0!==dir.coreprops.length&&((propdata=getzipdata(zip,dir.coreprops[0].replace(/^\//,""),!0))&&(props=function(data){for(var p={},i=0;i<CORE_PROPS.length;++i){var f=CORE_PROPS[i],cur=data.match(CORE_PROPS_REGEX[i]);null!=cur&&cur.length>0&&(p[f[1]]=cur[1]),"date"===f[2]&&p[f[1]]&&(p[f[1]]=new Date(p[f[1]]))}return p}(propdata)),0!==dir.extprops.length&&(propdata=getzipdata(zip,dir.extprops[0].replace(/^\//,""),!0))&&function(data,p){var q={};if(p||(p={}),EXT_PROPS.forEach(function(f){switch(f[2]){case"string":p[f[1]]=(data.match(matchtag(f[0]))||[])[1];break;case"bool":p[f[1]]="true"===(data.match(matchtag(f[0]))||[])[1];break;case"raw":var cur=data.match(new RegExp("<"+f[0]+"[^>]*>(.*)</"+f[0]+">"));cur&&cur.length>0&&(q[f[1]]=cur[1])}}),q.HeadingPairs&&q.TitlesOfParts){for(var v=parseVector(q.HeadingPairs),widx=0,i=0;i!==v.length;++i)switch(v[i].v){case"Worksheets":widx=0,p.Worksheets=+v[++i].v;break;case"Named Ranges":++i}var parts=parseVector(q.TitlesOfParts).map(function(x){return utf8read(x.v)});p.SheetNames=parts.slice(widx,widx+p.Worksheets)}}(propdata,props));var custprops={};opts.bookSheets&&!opts.bookProps||0!==dir.custprops.length&&(propdata=getzipdata(zip,dir.custprops[0].replace(/^\//,""),!0))&&(custprops=function(data,opts){var name,p={},m=data.match(custregex);if(m)for(var i=0;i!=m.length;++i){var x=m[i],y=parsexmltag(x);switch(y[0]){case"<?xml":break;case"<Properties":if(y.xmlns!==XMLNS.CUST_PROPS)throw"unrecognized xmlns "+y.xmlns;if(y.xmlnsvt&&y.xmlnsvt!==XMLNS.vt)throw"unrecognized vt "+y.xmlnsvt;break;case"<property":name=y.name;break;case"</property>":name=null;break;default:if(0===x.indexOf("<vt:")){var toks=x.split(">"),type=toks[0].substring(4),text=toks[1];switch(type){case"lpstr":case"lpwstr":case"bstr":case"lpwstr":p[name]=unescapexml(text);break;case"bool":p[name]=parsexmlbool(text);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":p[name]=parseInt(text,10);break;case"r4":case"r8":case"decimal":p[name]=parseFloat(text);break;case"filetime":case"date":p[name]=new Date(text);break;case"cy":case"error":p[name]=unescapexml(text);break;default:"undefined"!=typeof console&&console.warn("Unexpected",x,type,toks)}}else if("</"===x.substr(0,2));else if(opts.WTF)throw new Error(x)}}return p}(propdata,opts));var out={};if((opts.bookSheets||opts.bookProps)&&(props.Worksheets&&props.SheetNames.length>0?sheets=props.SheetNames:wb.Sheets&&(sheets=wb.Sheets.map(function(x){return x.name})),opts.bookProps&&(out.Props=props,out.Custprops=custprops),void 0!==sheets&&(out.SheetNames=sheets),opts.bookSheets?out.SheetNames:opts.bookProps))return out;sheets={};var deps={};opts.bookDeps&&dir.calcchain&&(deps=parse_cc(getzipdata(zip,dir.calcchain.replace(/^\//,"")),dir.calcchain,opts));var path,i=0,sheetRels={};if(!props.Worksheets){var wbsheets=wb.Sheets;props.Worksheets=wbsheets.length,props.SheetNames=[];for(var j=0;j!=wbsheets.length;++j)props.SheetNames[j]=wbsheets[j].name}var wbext=xlsb?"bin":"xml",wbrelsfile="xl/_rels/workbook."+wbext+".rels",wbrels=parse_rels(getzipdata(zip,wbrelsfile,!0),wbrelsfile);wbrels&&(wbrels=function(wbrels,sheets){if(!wbrels)return 0;try{wbrels=sheets.map(function(w){return[w.name,wbrels["!id"][w.id].Target]})}catch(e){return null}return wbrels&&0!==wbrels.length?wbrels:null}(wbrels,wb.Sheets));var nmode=getzipdata(zip,"xl/worksheets/sheet.xml",!0)?1:0;for(i=0;i!=props.Worksheets;++i)safe_parse_ws(zip,path=wbrels?"xl/"+wbrels[i][1].replace(/[\/]?xl\//,""):(path="xl/worksheets/sheet"+(i+1-nmode)+"."+wbext).replace(/sheet0\./,"sheet."),path.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),props.SheetNames[i],sheetRels,sheets,opts);return dir.comments&&function(zip,dirComments,sheets,sheetRels,opts){for(var i=0;i!=dirComments.length;++i){var canonicalpath=dirComments[i],comments=parse_cmnt(getzipdata(zip,canonicalpath.replace(/^\//,""),!0),canonicalpath,opts);if(comments&&comments.length)for(var sheetNames=keys(sheets),j=0;j!=sheetNames.length;++j){var sheetName=sheetNames[j],rels=sheetRels[sheetName];rels&&rels[canonicalpath]&&insertCommentsIntoSheet(0,sheets[sheetName],comments)}}}(zip,dir.comments,sheets,sheetRels,opts),out={Directory:dir,Workbook:wb,Props:props,Custprops:custprops,Deps:deps,Sheets:sheets,SheetNames:props.SheetNames,Strings:strs,Styles:styles,Themes:themes,SSF:SSF.get_table()},opts.bookFiles&&(out.keys=entries,out.files=zip.files),opts.bookVBA&&(dir.vba.length>0?out.vbaraw=getzipdata(zip,dir.vba[0],!0):"application/vnd.ms-office.vbaProject"===dir.defaults.bin&&(out.vbaraw=getzipdata(zip,"xl/vbaProject.bin",!0))),out}function add_rels(rels,rId,f,type,relobj){if(relobj||(relobj={}),rels["!id"]||(rels["!id"]={}),relobj.Id="rId"+rId,relobj.Type=type,relobj.Target=f,rels["!id"][relobj.Id])throw new Error("Cannot rewrite rId "+rId);rels["!id"][relobj.Id]=relobj,rels[("/"+relobj.Target).replace("//","/")]=relobj}function write_zip(wb,opts){wb&&!wb.SSF&&(wb.SSF=SSF.get_table()),wb&&wb.SSF&&(make_ssf(SSF),SSF.load_table(wb.SSF),opts.revssf=evert_num(wb.SSF),opts.revssf[wb.SSF[65535]]=0),opts.rels={},opts.wbrels={},opts.Strings=[],opts.Strings.Count=0,opts.Strings.Unique=0;var wbext="xlsb"==opts.bookType?"bin":"xml",ct={workbooks:[],sheets:[],calcchains:[],themes:[],styles:[],coreprops:[],extprops:[],custprops:[],strs:[],comments:[],vba:[],TODO:[],rels:[],xmlns:""};fix_write_opts(opts=opts||{});var cp,o,W,zip=new jszip,f="",rId=0;for(opts.cellXfs=[],get_cell_style(opts.cellXfs,{},{revssf:{General:0}}),f="docProps/core.xml",zip.file(f,function(cp,opts){var o=[XML_HEADER,CORE_PROPS_XML_ROOT],p={};if(!cp)return o.join("");null!=cp.CreatedDate&&cp_doit("dcterms:created","string"==typeof cp.CreatedDate?cp.CreatedDate:write_w3cdtf(cp.CreatedDate,opts.WTF),{"xsi:type":"dcterms:W3CDTF"},o,p),null!=cp.ModifiedDate&&cp_doit("dcterms:modified","string"==typeof cp.ModifiedDate?cp.ModifiedDate:write_w3cdtf(cp.ModifiedDate,opts.WTF),{"xsi:type":"dcterms:W3CDTF"},o,p);for(var i=0;i!=CORE_PROPS.length;++i){var f=CORE_PROPS[i];cp_doit(f[0],cp[f[1]],null,o,p)}return o.length>2&&(o[o.length]="</cp:coreProperties>",o[1]=o[1].replace("/>",">")),o.join("")}(wb.Props,opts)),ct.coreprops.push(f),add_rels(opts.rels,2,f,RELS.CORE_PROPS),f="docProps/app.xml",wb.Props||(wb.Props={}),wb.Props.SheetNames=wb.SheetNames,wb.Props.Worksheets=wb.SheetNames.length,zip.file(f,(cp=wb.Props,o=[],W=writextag,cp||(cp={}),cp.Application="SheetJS",o[o.length]=XML_HEADER,o[o.length]=EXT_PROPS_XML_ROOT,EXT_PROPS.forEach(function(f){if(void 0!==cp[f[1]]){var v;switch(f[2]){case"string":v=cp[f[1]];break;case"bool":v=cp[f[1]]?"true":"false"}void 0!==v&&(o[o.length]=W(f[0],v))}}),o[o.length]=W("HeadingPairs",W("vt:vector",W("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+W("vt:variant",W("vt:i4",String(cp.Worksheets))),{size:2,baseType:"variant"})),o[o.length]=W("TitlesOfParts",W("vt:vector",cp.SheetNames.map(function(s){return"<vt:lpstr>"+s+"</vt:lpstr>"}).join(""),{size:cp.Worksheets,baseType:"lpstr"})),o.length>2&&(o[o.length]="</Properties>",o[1]=o[1].replace("/>",">")),o.join(""))),ct.extprops.push(f),add_rels(opts.rels,3,f,RELS.EXT_PROPS),wb.Custprops!==wb.Props&&keys(wb.Custprops||{}).length>0&&(f="docProps/custom.xml",zip.file(f,write_cust_props(wb.Custprops)),ct.custprops.push(f),add_rels(opts.rels,4,f,RELS.CUST_PROPS)),f="xl/workbook."+wbext,zip.file(f,function(wb,name,opts){return(".bin"===name.substr(-4)?write_wb_bin:write_wb_xml)(wb,opts)}(wb,f,opts)),ct.workbooks.push(f),add_rels(opts.rels,1,f,RELS.WB),rId=1;rId<=wb.SheetNames.length;++rId)f="xl/worksheets/sheet"+rId+"."+wbext,zip.file(f,write_ws(rId-1,f,opts,wb)),ct.sheets.push(f),add_rels(opts.wbrels,rId,"worksheets/sheet"+rId+"."+wbext,RELS.WS);return null!=opts.Strings&&opts.Strings.length>0&&(f="xl/sharedStrings."+wbext,zip.file(f,write_sst(opts.Strings,f,opts)),ct.strs.push(f),add_rels(opts.wbrels,++rId,"sharedStrings."+wbext,RELS.SST)),f="xl/theme/theme1.xml",zip.file(f,'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme"><a:themeElements><a:clrScheme name="Office"><a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1><a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1><a:dk2><a:srgbClr val="1F497D"/></a:dk2><a:lt2><a:srgbClr val="EEECE1"/></a:lt2><a:accent1><a:srgbClr val="4F81BD"/></a:accent1><a:accent2><a:srgbClr val="C0504D"/></a:accent2><a:accent3><a:srgbClr val="9BBB59"/></a:accent3><a:accent4><a:srgbClr val="8064A2"/></a:accent4><a:accent5><a:srgbClr val="4BACC6"/></a:accent5><a:accent6><a:srgbClr val="F79646"/></a:accent6><a:hlink><a:srgbClr val="0000FF"/></a:hlink><a:folHlink><a:srgbClr val="800080"/></a:folHlink></a:clrScheme><a:fontScheme name="Office"><a:majorFont><a:latin typeface="Cambria"/><a:ea typeface=""/><a:cs typeface=""/><a:font script="Jpan" typeface=" "/><a:font script="Hang" typeface=" "/><a:font script="Hans" typeface=""/><a:font script="Hant" typeface=""/><a:font script="Arab" typeface="Times New Roman"/><a:font script="Hebr" typeface="Times New Roman"/><a:font script="Thai" typeface="Tahoma"/><a:font script="Ethi" typeface="Nyala"/><a:font script="Beng" typeface="Vrinda"/><a:font script="Gujr" typeface="Shruti"/><a:font script="Khmr" typeface="MoolBoran"/><a:font script="Knda" typeface="Tunga"/><a:font script="Guru" typeface="Raavi"/><a:font script="Cans" typeface="Euphemia"/><a:font script="Cher" typeface="Plantagenet Cherokee"/><a:font script="Yiii" typeface="Microsoft Yi Baiti"/><a:font script="Tibt" typeface="Microsoft Himalaya"/><a:font script="Thaa" typeface="MV Boli"/><a:font script="Deva" typeface="Mangal"/><a:font script="Telu" typeface="Gautami"/><a:font script="Taml" typeface="Latha"/><a:font script="Syrc" typeface="Estrangelo Edessa"/><a:font script="Orya" typeface="Kalinga"/><a:font script="Mlym" typeface="Kartika"/><a:font script="Laoo" typeface="DokChampa"/><a:font script="Sinh" typeface="Iskoola Pota"/><a:font script="Mong" typeface="Mongolian Baiti"/><a:font script="Viet" typeface="Times New Roman"/><a:font script="Uigh" typeface="Microsoft Uighur"/><a:font script="Geor" typeface="Sylfaen"/></a:majorFont><a:minorFont><a:latin typeface="Calibri"/><a:ea typeface=""/><a:cs typeface=""/><a:font script="Jpan" typeface=" "/><a:font script="Hang" typeface=" "/><a:font script="Hans" typeface=""/><a:font script="Hant" typeface=""/><a:font script="Arab" typeface="Arial"/><a:font script="Hebr" typeface="Arial"/><a:font script="Thai" typeface="Tahoma"/><a:font script="Ethi" typeface="Nyala"/><a:font script="Beng" typeface="Vrinda"/><a:font script="Gujr" typeface="Shruti"/><a:font script="Khmr" typeface="DaunPenh"/><a:font script="Knda" typeface="Tunga"/><a:font script="Guru" typeface="Raavi"/><a:font script="Cans" typeface="Euphemia"/><a:font script="Cher" typeface="Plantagenet Cherokee"/><a:font script="Yiii" typeface="Microsoft Yi Baiti"/><a:font script="Tibt" typeface="Microsoft Himalaya"/><a:font script="Thaa" typeface="MV Boli"/><a:font script="Deva" typeface="Mangal"/><a:font script="Telu" typeface="Gautami"/><a:font script="Taml" typeface="Latha"/><a:font script="Syrc" typeface="Estrangelo Edessa"/><a:font script="Orya" typeface="Kalinga"/><a:font script="Mlym" typeface="Kartika"/><a:font script="Laoo" typeface="DokChampa"/><a:font script="Sinh" typeface="Iskoola Pota"/><a:font script="Mong" typeface="Mongolian Baiti"/><a:font script="Viet" typeface="Arial"/><a:font script="Uigh" typeface="Microsoft Uighur"/><a:font script="Geor" typeface="Sylfaen"/></a:minorFont></a:fontScheme><a:fmtScheme name="Office"><a:fillStyleLst><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:gradFill rotWithShape="1"><a:gsLst><a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs><a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs><a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs></a:gsLst><a:lin ang="16200000" scaled="1"/></a:gradFill><a:gradFill rotWithShape="1"><a:gsLst><a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs><a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs></a:gsLst><a:lin ang="16200000" scaled="0"/></a:gradFill></a:fillStyleLst><a:lnStyleLst><a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln><a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln><a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln></a:lnStyleLst><a:effectStyleLst><a:effectStyle><a:effectLst><a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw></a:effectLst></a:effectStyle><a:effectStyle><a:effectLst><a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw></a:effectLst></a:effectStyle><a:effectStyle><a:effectLst><a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw></a:effectLst><a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d><a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d></a:effectStyle></a:effectStyleLst><a:bgFillStyleLst><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:gradFill rotWithShape="1"><a:gsLst><a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs><a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs><a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs></a:gsLst><a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path></a:gradFill><a:gradFill rotWithShape="1"><a:gsLst><a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs><a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs></a:gsLst><a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path></a:gradFill></a:bgFillStyleLst></a:fmtScheme></a:themeElements><a:objectDefaults><a:spDef><a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style></a:spDef><a:lnDef><a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style></a:lnDef></a:objectDefaults><a:extraClrSchemeLst/></a:theme>'),ct.themes.push(f),add_rels(opts.wbrels,++rId,"theme/theme1.xml",RELS.THEME),f="xl/styles."+wbext,zip.file(f,write_sty(wb,f,opts)),ct.styles.push(f),add_rels(opts.wbrels,++rId,"styles."+wbext,RELS.STY),zip.file("[Content_Types].xml",function(ct,opts){var v,o=[];o[o.length]=XML_HEADER,o[o.length]=CTYPE_XML_ROOT,o=o.concat(CTYPE_DEFAULTS);var w,f1=function(w){ct[w]&&ct[w].length>0&&(v=ct[w][0],o[o.length]=writextag("Override",null,{PartName:("/"==v[0]?"":"/")+v,ContentType:CT_LIST[w][opts.bookType||"xlsx"]}))},f3=function(t){(ct[t]||[]).forEach(function(v){o[o.length]=writextag("Override",null,{PartName:("/"==v[0]?"":"/")+v,ContentType:type2ct[t][0]})})};return f1("workbooks"),ct[w="sheets"].forEach(function(v){o[o.length]=writextag("Override",null,{PartName:("/"==v[0]?"":"/")+v,ContentType:CT_LIST[w][opts.bookType||"xlsx"]})}),f3("themes"),["strs","styles"].forEach(f1),["coreprops","extprops","custprops"].forEach(f3),o.length>2&&(o[o.length]="</Types>",o[1]=o[1].replace("/>",">")),o.join("")}(ct,opts)),zip.file("_rels/.rels",write_rels(opts.rels)),zip.file("xl/_rels/workbook."+wbext+".rels",write_rels(opts.wbrels)),zip}function readSync(data,opts){var n,d=data,isfile=!1,o=opts||{};switch(o.type||(o.type=has_buf&&Buffer.isBuffer(data)?"buffer":"base64"),"file"==o.type&&(isfile=!0,o.type="buffer",d=_fs.readFileSync(data)),n=function(f,o){switch((o||{}).type||"base64"){case"buffer":return f[0];case"base64":return Base64.decode(f.substr(0,12)).charCodeAt(0);case"binary":return f.charCodeAt(0);case"array":return f[0];default:throw new Error("Unrecognized type "+o.type)}}(d,o)){case 208:return isfile&&(o.type="file"),parse_xlscfb(CFB.read(data,o),o);case 9:return parse_xlscfb(s2a("base64"===o.type?Base64.decode(data):data),o);case 60:return function(data,opts){switch(fix_read_opts(opts=opts||{}),opts.type||"base64"){case"base64":return parse_xlml_xml(Base64.decode(data),opts);case"binary":case"buffer":case"file":return parse_xlml_xml(data,opts);case"array":return parse_xlml_xml(data.map(_chr).join(""),opts)}}(d,o);case 80:return isfile&&(o.type="file"),function(data,opts){var zip,d=data,o=opts||{};switch(o.type||(o.type=has_buf&&Buffer.isBuffer(data)?"buffer":"base64"),o.type){case"base64":zip=new jszip(d,{base64:!0});break;case"binary":case"array":zip=new jszip(d,{base64:!1});break;case"buffer":zip=new jszip(d);break;case"file":zip=new jszip(d=_fs.readFileSync(data));break;default:throw new Error("Unrecognized type "+o.type)}return parse_zip(zip,o)}(data,opts);default:throw new Error("Unsupported file "+n)}}function readFileSync(data,opts){var o=opts||{};return o.type="file",readSync(data,o)}function writeSync(wb,opts){var o=opts||{};switch(o.bookType){case"xml":return;default:return function(wb,opts){var o=opts||{},z=write_zip(wb,o);switch(o.type){case"base64":return z.generate({type:"base64"});case"binary":return z.generate({type:"string"});case"buffer":return z.generate({type:"nodebuffer"});case"file":return _fs.writeFileSync(o.file,z.generate({type:"nodebuffer"}));default:throw new Error("Unrecognized type "+o.type)}}(wb,o)}}function writeFileSync(wb,filename,opts){var o=opts||{};switch(o.type="file",o.file=filename,o.file.substr(-5).toLowerCase()){case".xlsx":o.bookType="xlsx";break;case".xlsm":o.bookType="xlsm";break;case".xlsb":o.bookType="xlsb";break;default:switch(o.file.substr(-4).toLowerCase()){case".xls":o.bookType="xls";break;case".xml":o.bookType="xml"}}return writeSync(wb,o)}function decode_row(rowstr){return parseInt(unfix_row(rowstr),10)-1}function encode_row(row){return""+(row+1)}function unfix_row(cstr){return cstr.replace(/\$(\d+)$/,"$1")}function decode_col(colstr){for(var c=unfix_col(colstr),d=0,i=0;i!==c.length;++i)d=26*d+c.charCodeAt(i)-64;return d-1}function encode_col(col){var s="";for(++col;col;col=Math.floor((col-1)/26))s=String.fromCharCode((col-1)%26+65)+s;return s}function unfix_col(cstr){return cstr.replace(/^\$([A-Z])/,"$1")}function split_cell(cstr){return cstr.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(cstr){var splt=split_cell(cstr);return{c:decode_col(splt[0]),r:decode_row(splt[1])}}function encode_cell(cell){return encode_col(cell.c)+encode_row(cell.r)}function encode_range(cs,ce){return void 0===ce||"number"==typeof ce?encode_range(cs.s,cs.e):("string"!=typeof cs&&(cs=encode_cell(cs)),"string"!=typeof ce&&(ce=encode_cell(ce)),cs==ce?cs:cs+":"+ce)}function safe_decode_range(range){var o={s:{c:0,r:0},e:{c:0,r:0}},idx=0,i=0,cc=0,len=range.length;for(idx=0;i<len&&!((cc=range.charCodeAt(i)-64)<1||cc>26);++i)idx=26*idx+cc;for(o.s.c=--idx,idx=0;i<len&&!((cc=range.charCodeAt(i)-48)<0||cc>9);++i)idx=10*idx+cc;if(o.s.r=--idx,i===len||58===range.charCodeAt(++i))return o.e.c=o.s.c,o.e.r=o.s.r,o;for(idx=0;i!=len&&!((cc=range.charCodeAt(i)-64)<1||cc>26);++i)idx=26*idx+cc;for(o.e.c=--idx,idx=0;i!=len&&!((cc=range.charCodeAt(i)-48)<0||cc>9);++i)idx=10*idx+cc;return o.e.r=--idx,o}function safe_format_cell(cell,v){if(void 0!==cell.z)try{return cell.w=SSF.format(cell.z,v)}catch(e){}if(!cell.XF)return v;try{return cell.w=SSF.format(cell.XF.ifmt||0,v)}catch(e){return""+v}}function format_cell(cell,v){return null==cell||null==cell.t?"":void 0!==cell.w?cell.w:safe_format_cell(cell,void 0===v?cell.v:v)}function sheet_to_json(sheet,opts){var val,row,range,r,isempty,R,C,v,header=0,offset=1,hdr=[],o=null!=opts?opts:{},raw=o.raw;if(null==sheet||null==sheet["!ref"])return[];switch(range=void 0!==o.range?o.range:sheet["!ref"],1===o.header?header=1:"A"===o.header?header=2:Array.isArray(o.header)&&(header=3),typeof range){case"string":r=safe_decode_range(range);break;case"number":(r=safe_decode_range(sheet["!ref"])).s.r=range;break;default:r=range}header>0&&(offset=0);var rr=encode_row(r.s.r),cols=new Array(r.e.c-r.s.c+1),out=new Array(r.e.r-r.s.r-offset+1),outi=0;for(C=r.s.c;C<=r.e.c;++C)switch(cols[C]=encode_col(C),val=sheet[cols[C]+rr],header){case 1:hdr[C]=C;break;case 2:hdr[C]=cols[C];break;case 3:hdr[C]=o.header[C-r.s.c];break;default:if(void 0===val)continue;hdr[C]=format_cell(val)}for(R=r.s.r+offset;R<=r.e.r;++R){for(rr=encode_row(R),isempty=!0,1===header?row=[]:(row={},Object.defineProperty?Object.defineProperty(row,"__rowNum__",{value:R,enumerable:!1}):row.__rowNum__=R),C=r.s.c;C<=r.e.c;++C)if(void 0!==(val=sheet[cols[C]+rr])&&void 0!==val.t){switch(v=val.v,val.t){case"e":continue;case"s":break;case"b":case"n":break;default:throw"unrecognized type "+val.t}void 0!==v&&(row[hdr[C]]=raw?v:format_cell(val,v),isempty=!1)}!1!==isempty&&1!==header||(out[outi++]=row)}return out.length=outi,out}function sheet_to_csv(sheet,opts){var out="",txt="",qreg=/"/g,o=null==opts?{}:opts;if(null==sheet||null==sheet["!ref"])return"";var val,r=safe_decode_range(sheet["!ref"]),FS=void 0!==o.FS?o.FS:",",fs=FS.charCodeAt(0),RS=void 0!==o.RS?o.RS:"\n",rs=RS.charCodeAt(0),row="",rr="",cols=[],i=0,cc=0,R=0,C=0;for(C=r.s.c;C<=r.e.c;++C)cols[C]=encode_col(C);for(R=r.s.r;R<=r.e.r;++R){for(row="",rr=encode_row(R),C=r.s.c;C<=r.e.c;++C){for(txt=void 0!==(val=sheet[cols[C]+rr])?""+format_cell(val):"",i=0,cc=0;i!==txt.length;++i)if((cc=txt.charCodeAt(i))===fs||cc===rs||34===cc){txt='"'+txt.replace(qreg,'""')+'"';break}row+=(C===r.s.c?"":FS)+txt}out+=row+RS}return out}function sheet_to_formulae(sheet){var cmds,x,y="",val="";if(null==sheet||null==sheet["!ref"])return"";var C,r=safe_decode_range(sheet["!ref"]),rr="",cols=[];cmds=new Array((r.e.r-r.s.r+1)*(r.e.c-r.s.c+1));var i=0;for(C=r.s.c;C<=r.e.c;++C)cols[C]=encode_col(C);for(var R=r.s.r;R<=r.e.r;++R)for(rr=encode_row(R),C=r.s.c;C<=r.e.c;++C)if(val="",void 0!==(x=sheet[y=cols[C]+rr])){if(null!=x.f)val=x.f;else if(void 0!==x.w)val="'"+x.w;else{if(void 0===x.v)continue;val=""+x.v}cmds[i++]=y+"="+val}return cmds.length=i,cmds}var utils={encode_col:encode_col,encode_row:encode_row,encode_cell:encode_cell,encode_range:encode_range,decode_col:decode_col,decode_row:decode_row,split_cell:split_cell,decode_cell:decode_cell,decode_range:function(range){var x=range.split(":").map(decode_cell);return{s:x[0],e:x[x.length-1]}},format_cell:format_cell,get_formulae:sheet_to_formulae,make_csv:sheet_to_csv,make_json:sheet_to_json,make_formulae:sheet_to_formulae,sheet_to_csv:sheet_to_csv,sheet_to_json:sheet_to_json,sheet_to_formulae:sheet_to_formulae,sheet_to_row_object_array:function(sheet,opts){return sheet_to_json(sheet,null!=opts?opts:{})}};XLSX.parse_xlscfb=parse_xlscfb,XLSX.parse_zip=parse_zip,XLSX.read=readSync,XLSX.readFile=readFileSync,XLSX.readFileSync=readFileSync,XLSX.write=writeSync,XLSX.writeFile=writeFileSync,XLSX.writeFileSync=writeFileSync,XLSX.utils=utils,XLSX.CFB=CFB,XLSX.SSF=SSF}("undefined"!=typeof exports?exports:XLSX);var XLS=XLSX;function RGBColor(color_string){this.ok=!1,"#"==color_string.charAt(0)&&(color_string=color_string.substr(1,6)),color_string=(color_string=color_string.replace(/ /g,"")).toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors)color_string==key&&(color_string=simple_colors[key]);for(var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}],i=0;i<color_defs.length;i++){var re=color_defs[i].re,processor=color_defs[i].process,bits=re.exec(color_string);bits&&(channels=processor(bits),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return 1==r.length&&(r="0"+r),1==g.length&&(g="0"+g),1==b.length&&(b="0"+b),"#"+r+g+b},this.getHelpXML=function(){for(var examples=new Array,i=0;i<color_defs.length;i++)for(var example=color_defs[i].example,j=0;j<example.length;j++)examples[examples.length]=example[j];for(var sc in simple_colors)examples[examples.length]=sc;var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(i=0;i<examples.length;i++)try{var list_item=document.createElement("li"),list_color=new RGBColor(examples[i]),example_div=document.createElement("div");example_div.style.cssText="margin: 3px; border: 1px solid black; background:"+list_color.toHex()+"; color:"+list_color.toHex(),example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div),list_item.appendChild(list_item_value),xml.appendChild(list_item)}catch(e){}return xml}}!function(){"use strict";var STYLES,ctx,CanvasGradient,CanvasPattern,namedEntities;function format(str,args){var i,keys=Object.keys(args);for(i=0;i<keys.length;i++)str=str.replace(new RegExp("\\{"+keys[i]+"\\}","gi"),args[keys[i]]);return str}function randomString(holder){var chars,randomstring,i;if(!holder)throw new Error("cannot create a random attribute name for an undefined object");chars="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",randomstring="";do{for(randomstring="",i=0;i<12;i++)randomstring+=chars[Math.floor(Math.random()*chars.length)]}while(holder[randomstring]);return randomstring}namedEntities=function(items,radix){var i,entity,base10,lookup={};for(items=items.split(","),radix=radix||10,i=0;i<items.length;i+=2)entity="&"+items[i+1]+";",base10=parseInt(items[i],radix),lookup[entity]="&#"+base10+";";return lookup["\\xa0"]="&#160;",lookup}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),STYLES={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},(CanvasGradient=function(gradientNode,ctx){this.__root=gradientNode,this.__ctx=ctx}).prototype.addColorStop=function(offset,color){var matches,stop=this.__ctx.__createElement("stop");stop.setAttribute("offset",offset),-1!==color.indexOf("rgba")?(matches=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(color),stop.setAttribute("stop-color",format("rgb({r},{g},{b})",{r:matches[1],g:matches[2],b:matches[3]})),stop.setAttribute("stop-opacity",matches[4])):stop.setAttribute("stop-color",color),this.__root.appendChild(stop)},CanvasPattern=function(pattern,ctx){this.__root=pattern,this.__ctx=ctx},(ctx=function(o){var options,defaultOptions={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((options=defaultOptions).width=arguments[0],options.height=arguments[1]):options=o||defaultOptions,!(this instanceof ctx))return new ctx(options);this.width=options.width||defaultOptions.width,this.height=options.height||defaultOptions.height,this.enableMirroring=void 0!==options.enableMirroring?options.enableMirroring:defaultOptions.enableMirroring,this.canvas=this,this.__document=options.document||document,this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d"),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}).prototype.__createElement=function(elementName,properties,resetFill){void 0===properties&&(properties={});var i,key,element=this.__document.createElementNS("http://www.w3.org/2000/svg",elementName),keys=Object.keys(properties);for(resetFill&&(element.setAttribute("fill","none"),element.setAttribute("stroke","none")),i=0;i<keys.length;i++)key=keys[i],element.setAttribute(key,properties[key]);return element},ctx.prototype.__setDefaultStyles=function(){var i,key,keys=Object.keys(STYLES);for(i=0;i<keys.length;i++)this[key=keys[i]]=STYLES[key].canvas},ctx.prototype.__applyStyleState=function(styleState){var i,key,keys=Object.keys(styleState);for(i=0;i<keys.length;i++)this[key=keys[i]]=styleState[key]},ctx.prototype.__getStyleState=function(){var i,key,styleState={},keys=Object.keys(STYLES);for(i=0;i<keys.length;i++)styleState[key=keys[i]]=this[key];return styleState},ctx.prototype.__applyStyleToCurrentElement=function(type){var i,style,value,id,matches,keys=Object.keys(STYLES);for(i=0;i<keys.length;i++)if(style=STYLES[keys[i]],value=this[keys[i]],style.apply)if(-1!==style.apply.indexOf("fill")&&value instanceof CanvasPattern){if(value.__ctx)for(;value.__ctx.__defs.childNodes.length;)id=value.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[id]=id,this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);this.__currentElement.setAttribute("fill",format("url(#{id})",{id:value.__root.getAttribute("id")}))}else if(-1!==style.apply.indexOf("fill")&&value instanceof CanvasGradient)this.__currentElement.setAttribute("fill",format("url(#{id})",{id:value.__root.getAttribute("id")}));else if(-1!==style.apply.indexOf(type)&&style.svg!==value)if("stroke"!==style.svgAttr&&"fill"!==style.svgAttr||-1===value.indexOf("rgba")){var attr=style.svgAttr;if("globalAlpha"===keys[i]&&(attr=type+"-"+style.svgAttr,this.__currentElement.getAttribute(attr)))continue;this.__currentElement.setAttribute(attr,value)}else{matches=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(value),this.__currentElement.setAttribute(style.svgAttr,format("rgb({r},{g},{b})",{r:matches[1],g:matches[2],b:matches[3]}));var opacity=matches[4],globalAlpha=this.globalAlpha;null!=globalAlpha&&(opacity*=globalAlpha),this.__currentElement.setAttribute(style.svgAttr+"-opacity",opacity)}},ctx.prototype.__closestGroupOrSvg=function(node){return"g"===(node=node||this.__currentElement).nodeName||"svg"===node.nodeName?node:this.__closestGroupOrSvg(node.parentNode)},ctx.prototype.getSerializedSvg=function(fixNamedEntities){var keys,i,key,value,regexp,serialized=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(serialized)&&(serialized=serialized.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),fixNamedEntities)for(keys=Object.keys(namedEntities),i=0;i<keys.length;i++)key=keys[i],value=namedEntities[key],(regexp=new RegExp(key,"gi")).test(serialized)&&(serialized=serialized.replace(regexp,value));return serialized},ctx.prototype.getSvg=function(){return this.__root},ctx.prototype.save=function(){var group=this.__createElement("g"),parent=this.__closestGroupOrSvg();this.__groupStack.push(parent),parent.appendChild(group),this.__currentElement=group,this.__stack.push(this.__getStyleState())},ctx.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var state=this.__stack.pop();this.__applyStyleState(state)},ctx.prototype.__addTransform=function(t){var parent=this.__closestGroupOrSvg();if(parent.childNodes.length>0){var group=this.__createElement("g");parent.appendChild(group),this.__currentElement=group}var transform=this.__currentElement.getAttribute("transform");transform?transform+=" ":transform="",transform+=t,this.__currentElement.setAttribute("transform",transform)},ctx.prototype.scale=function(x,y){void 0===y&&(y=x),this.__addTransform(format("scale({x},{y})",{x:x,y:y}))},ctx.prototype.rotate=function(angle){var degrees=180*angle/Math.PI;this.__addTransform(format("rotate({angle},{cx},{cy})",{angle:degrees,cx:0,cy:0}))},ctx.prototype.translate=function(x,y){this.__addTransform(format("translate({x},{y})",{x:x,y:y}))},ctx.prototype.transform=function(a,b,c,d,e,f){this.__addTransform(format("matrix({a},{b},{c},{d},{e},{f})",{a:a,b:b,c:c,d:d,e:e,f:f}))},ctx.prototype.beginPath=function(){var path;this.__currentDefaultPath="",this.__currentPosition={},path=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(path),this.__currentElement=path},ctx.prototype.__applyCurrentDefaultPath=function(){if("path"!==this.__currentElement.nodeName)throw new Error("Attempted to apply path command to node "+this.__currentElement.nodeName);var d=this.__currentDefaultPath;this.__currentElement.setAttribute("d",d)},ctx.prototype.__addPathCommand=function(command){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=command},ctx.prototype.moveTo=function(x,y){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:x,y:y},this.__addPathCommand(format("M {x} {y}",{x:x,y:y}))},ctx.prototype.closePath=function(){this.__addPathCommand("Z")},ctx.prototype.lineTo=function(x,y){this.__currentPosition={x:x,y:y},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(format("L {x} {y}",{x:x,y:y})):this.__addPathCommand(format("M {x} {y}",{x:x,y:y}))},ctx.prototype.bezierCurveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){this.__currentPosition={x:x,y:y},this.__addPathCommand(format("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:cp1x,cp1y:cp1y,cp2x:cp2x,cp2y:cp2y,x:x,y:y}))},ctx.prototype.quadraticCurveTo=function(cpx,cpy,x,y){this.__currentPosition={x:x,y:y},this.__addPathCommand(format("Q {cpx} {cpy} {x} {y}",{cpx:cpx,cpy:cpy,x:x,y:y}))};var normalize=function(vector){var len=Math.sqrt(vector[0]*vector[0]+vector[1]*vector[1]);return[vector[0]/len,vector[1]/len]};ctx.prototype.arcTo=function(x1,y1,x2,y2,radius){var x0=this.__currentPosition&&this.__currentPosition.x,y0=this.__currentPosition&&this.__currentPosition.y;if(void 0!==x0&&void 0!==y0){if(radius<0)throw new Error("IndexSizeError: The radius provided ("+radius+") is negative.");if(x0===x1&&y0===y1||x1===x2&&y1===y2||0===radius)this.lineTo(x1,y1);else{var unit_vec_p1_p0=normalize([x0-x1,y0-y1]),unit_vec_p1_p2=normalize([x2-x1,y2-y1]);if(unit_vec_p1_p0[0]*unit_vec_p1_p2[1]!=unit_vec_p1_p0[1]*unit_vec_p1_p2[0]){var cos=unit_vec_p1_p0[0]*unit_vec_p1_p2[0]+unit_vec_p1_p0[1]*unit_vec_p1_p2[1],theta=Math.acos(Math.abs(cos)),unit_vec_p1_origin=normalize([unit_vec_p1_p0[0]+unit_vec_p1_p2[0],unit_vec_p1_p0[1]+unit_vec_p1_p2[1]]),len_p1_origin=radius/Math.sin(theta/2),x=x1+len_p1_origin*unit_vec_p1_origin[0],y=y1+len_p1_origin*unit_vec_p1_origin[1],unit_vec_origin_start_tangent=[-unit_vec_p1_p0[1],unit_vec_p1_p0[0]],unit_vec_origin_end_tangent=[unit_vec_p1_p2[1],-unit_vec_p1_p2[0]],getAngle=function(vector){var x=vector[0];return vector[1]>=0?Math.acos(x):-Math.acos(x)},startAngle=getAngle(unit_vec_origin_start_tangent),endAngle=getAngle(unit_vec_origin_end_tangent);this.lineTo(x+unit_vec_origin_start_tangent[0]*radius,y+unit_vec_origin_start_tangent[1]*radius),this.arc(x,y,radius,startAngle,endAngle)}else this.lineTo(x1,y1)}}},ctx.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},ctx.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},ctx.prototype.rect=function(x,y,width,height){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(x,y),this.lineTo(x+width,y),this.lineTo(x+width,y+height),this.lineTo(x,y+height),this.lineTo(x,y),this.closePath()},ctx.prototype.fillRect=function(x,y,width,height){var rect;rect=this.__createElement("rect",{x:x,y:y,width:width,height:height},!0),this.__closestGroupOrSvg().appendChild(rect),this.__currentElement=rect,this.__applyStyleToCurrentElement("fill")},ctx.prototype.strokeRect=function(x,y,width,height){var rect;rect=this.__createElement("rect",{x:x,y:y,width:width,height:height},!0),this.__closestGroupOrSvg().appendChild(rect),this.__currentElement=rect,this.__applyStyleToCurrentElement("stroke")},ctx.prototype.__clearCanvas=function(){for(var transform=this.__closestGroupOrSvg().getAttribute("transform"),rootGroup=this.__root.childNodes[1],childNodes=rootGroup.childNodes,i=childNodes.length-1;i>=0;i--)childNodes[i]&&rootGroup.removeChild(childNodes[i]);this.__currentElement=rootGroup,this.__groupStack=[],transform&&this.__addTransform(transform)},ctx.prototype.clearRect=function(x,y,width,height){if(0!==x||0!==y||width!==this.width||height!==this.height){var rect,parent=this.__closestGroupOrSvg();rect=this.__createElement("rect",{x:x,y:y,width:width,height:height,fill:"#FFFFFF"},!0),parent.appendChild(rect)}else this.__clearCanvas()},ctx.prototype.createLinearGradient=function(x1,y1,x2,y2){var grad=this.__createElement("linearGradient",{id:randomString(this.__ids),x1:x1+"px",x2:x2+"px",y1:y1+"px",y2:y2+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(grad),new CanvasGradient(grad,this)},ctx.prototype.createRadialGradient=function(x0,y0,r0,x1,y1,r1){var grad=this.__createElement("radialGradient",{id:randomString(this.__ids),cx:x1+"px",cy:y1+"px",r:r1+"px",fx:x0+"px",fy:y0+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(grad),new CanvasGradient(grad,this)},ctx.prototype.__parseFont=function(){var fontPart=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\"\sa-z]+?)\s*$/i.exec(this.font),data={style:fontPart[1]||"normal",size:fontPart[4]||"10px",family:fontPart[6]||"sans-serif",weight:fontPart[3]||"normal",decoration:fontPart[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(data.decoration="underline"),this.__fontHref&&(data.href=this.__fontHref),data},ctx.prototype.__wrapTextLink=function(font,element){if(font.href){var a=this.__createElement("a");return a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",font.href),a.appendChild(element),a}return element},ctx.prototype.__applyText=function(text,x,y,action){var textAlign,mapping,font=this.__parseFont(),parent=this.__closestGroupOrSvg(),textElement=this.__createElement("text",{"font-family":font.family,"font-size":font.size,"font-style":font.style,"font-weight":font.weight,"text-decoration":font.decoration,x:x,y:y,"text-anchor":(textAlign=this.textAlign,mapping={left:"start",right:"end",center:"middle",start:"start",end:"end"},mapping[textAlign]||mapping.start),"dominant-baseline":function(textBaseline){var mapping={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return mapping[textBaseline]||mapping.alphabetic}(this.textBaseline)},!0);textElement.appendChild(this.__document.createTextNode(text)),this.__currentElement=textElement,this.__applyStyleToCurrentElement(action),parent.appendChild(this.__wrapTextLink(font,textElement))},ctx.prototype.fillText=function(text,x,y){this.__applyText(text,x,y,"fill")},ctx.prototype.strokeText=function(text,x,y){this.__applyText(text,x,y,"stroke")},ctx.prototype.measureText=function(text){return this.__ctx.font=this.font,this.__ctx.measureText(text)},ctx.prototype.arc=function(x,y,radius,startAngle,endAngle,counterClockwise){if(startAngle!==endAngle){(startAngle%=2*Math.PI)===(endAngle%=2*Math.PI)&&(endAngle=(endAngle+2*Math.PI-.001*(counterClockwise?-1:1))%(2*Math.PI));var endX=x+radius*Math.cos(endAngle),endY=y+radius*Math.sin(endAngle),startX=x+radius*Math.cos(startAngle),startY=y+radius*Math.sin(startAngle),sweepFlag=counterClockwise?0:1,largeArcFlag=0,diff=endAngle-startAngle;diff<0&&(diff+=2*Math.PI),largeArcFlag=counterClockwise?diff>Math.PI?0:1:diff>Math.PI?1:0,this.lineTo(startX,startY),this.__addPathCommand(format("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:radius,ry:radius,xAxisRotation:0,largeArcFlag:largeArcFlag,sweepFlag:sweepFlag,endX:endX,endY:endY})),this.__currentPosition={x:endX,y:endY}}},ctx.prototype.clip=function(){var group=this.__closestGroupOrSvg(),clipPath=this.__createElement("clipPath"),id=randomString(this.__ids),newGroup=this.__createElement("g");group.removeChild(this.__currentElement),clipPath.setAttribute("id",id),clipPath.appendChild(this.__currentElement),this.__defs.appendChild(clipPath),group.setAttribute("clip-path",format("url(#{id})",{id:id})),group.appendChild(newGroup),this.__currentElement=newGroup},ctx.prototype.drawImage=function(){var dx,dy,dw,dh,sw,sh,parent,svg,defs,group,svgImage,canvas,id,args=Array.prototype.slice.call(arguments),image=args[0],sx=0,sy=0;if(3===args.length)dx=args[1],dy=args[2],dw=sw=image.width,dh=sh=image.height;else if(5===args.length)dx=args[1],dy=args[2],dw=args[3],dh=args[4],sw=image.width,sh=image.height;else{if(9!==args.length)throw new Error("Inavlid number of arguments passed to drawImage: "+arguments.length);sx=args[1],sy=args[2],sw=args[3],sh=args[4],dx=args[5],dy=args[6],dw=args[7],dh=args[8]}parent=this.__closestGroupOrSvg(),this.__currentElement;var translateDirective="translate("+dx+", "+dy+")";if(image instanceof ctx){if((svg=image.getSvg().cloneNode(!0)).childNodes&&svg.childNodes.length>1){for(defs=svg.childNodes[0];defs.childNodes.length;)id=defs.childNodes[0].getAttribute("id"),this.__ids[id]=id,this.__defs.appendChild(defs.childNodes[0]);if(group=svg.childNodes[1]){var transformDirective,originTransform=group.getAttribute("transform");transformDirective=originTransform?originTransform+" "+translateDirective:translateDirective,group.setAttribute("transform",transformDirective),parent.appendChild(group)}}}else"CANVAS"!==image.nodeName&&"IMG"!==image.nodeName||((svgImage=this.__createElement("image")).setAttribute("width",dw),svgImage.setAttribute("height",dh),svgImage.setAttribute("preserveAspectRatio","none"),(sx||sy||sw!==image.width||sh!==image.height)&&((canvas=this.__document.createElement("canvas")).width=dw,canvas.height=dh,canvas.getContext("2d").drawImage(image,sx,sy,sw,sh,0,0,dw,dh),image=canvas),svgImage.setAttribute("transform",translateDirective),svgImage.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===image.nodeName?image.toDataURL():image.getAttribute("src")),parent.appendChild(svgImage))},ctx.prototype.createPattern=function(image,repetition){var img,pattern=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),id=randomString(this.__ids);return pattern.setAttribute("id",id),pattern.setAttribute("width",image.width),pattern.setAttribute("height",image.height),"CANVAS"===image.nodeName||"IMG"===image.nodeName?((img=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",image.width),img.setAttribute("height",image.height),img.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===image.nodeName?image.toDataURL():image.getAttribute("src")),pattern.appendChild(img),this.__defs.appendChild(pattern)):image instanceof ctx&&(pattern.appendChild(image.__root.childNodes[1]),this.__defs.appendChild(pattern)),new CanvasPattern(pattern,this)},ctx.prototype.setLineDash=function(dashArray){dashArray&&dashArray.length>0?this.lineDash=dashArray.join(","):this.lineDash=null},ctx.prototype.drawFocusRing=function(){},ctx.prototype.createImageData=function(){},ctx.prototype.getImageData=function(){},ctx.prototype.putImageData=function(){},ctx.prototype.globalCompositeOperation=function(){},ctx.prototype.setTransform=function(){},"object"==typeof window&&(window.C2S=ctx),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=ctx)}(),function(global,factory){"use strict";"undefined"!=typeof define&&define.amd?define("canvgModule",["rgbcolor","stackblur"],factory):"undefined"!=typeof module&&module.exports&&(module.exports=factory(require("rgbcolor"),require("stackblur"))),global.canvg=factory(global.RGBColor,global.stackBlur)}("undefined"!=typeof window?window:this,function(RGBColor,stackBlur){var matchesSelector,canvg=function(target,s,opts){if(null!=target||null!=s||null!=opts){"string"==typeof target&&(target=document.getElementById(target)),null!=target.svg&&target.svg.stop();var svg=build(opts||{});1==target.childNodes.length&&"OBJECT"==target.childNodes[0].nodeName||(target.svg=svg);var ctx=target.getContext("2d");void 0!==s.documentElement?svg.loadXmlDoc(ctx,s):"<"==s.substr(0,1)?svg.loadXml(ctx,s):svg.load(ctx,s)}else for(var svgTags=document.querySelectorAll("svg"),i=0;i<svgTags.length;i++){var svgTag=svgTags[i],c=document.createElement("canvas");c.width=svgTag.clientWidth,c.height=svgTag.clientHeight,svgTag.parentNode.insertBefore(c,svgTag),svgTag.parentNode.removeChild(svgTag);var div=document.createElement("div");div.appendChild(svgTag),canvg(c,div.innerHTML)}};void 0!==Element.prototype.matches?matchesSelector=function(node,selector){return node.matches(selector)}:void 0!==Element.prototype.webkitMatchesSelector?matchesSelector=function(node,selector){return node.webkitMatchesSelector(selector)}:void 0!==Element.prototype.mozMatchesSelector?matchesSelector=function(node,selector){return node.mozMatchesSelector(selector)}:void 0!==Element.prototype.msMatchesSelector?matchesSelector=function(node,selector){return node.msMatchesSelector(selector)}:void 0!==Element.prototype.oMatchesSelector?matchesSelector=function(node,selector){return node.oMatchesSelector(selector)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(matchesSelector=function(node,selector){return $(node).is(selector)}),void 0===matchesSelector&&(matchesSelector=Sizzle.matchesSelector));var attributeRegex=/(\[[^\]]+\])/g,idRegex=/(#[^\s\+>~\.\[:]+)/g,classRegex=/(\.[^\s\+>~\.\[:]+)/g,pseudoElementRegex=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,pseudoClassWithBracketsRegex=/(:[\w-]+\([^\)]*\))/gi,pseudoClassRegex=/(:[^\s\+>~\.\[:]+)/g,elementRegex=/([^\s\+>~\.\[:]+)/g;function getSelectorSpecificity(selector){var typeCount=[0,0,0],findMatch=function(regex,type){var matches=selector.match(regex);null!=matches&&(typeCount[type]+=matches.length,selector=selector.replace(regex," "))};return selector=(selector=selector.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[^]*/gm," "),findMatch(attributeRegex,1),findMatch(idRegex,0),findMatch(classRegex,1),findMatch(pseudoElementRegex,2),findMatch(pseudoClassWithBracketsRegex,1),findMatch(pseudoClassRegex,1),selector=(selector=selector.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),findMatch(elementRegex,2),typeCount.join("")}function build(opts){var svg={opts:opts,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,log:function(msg){}};1==svg.opts.log&&"undefined"!=typeof console&&(svg.log=function(msg){console.log(msg)}),svg.init=function(ctx){var uniqueId=0;svg.UniqueId=function(){return"canvg"+ ++uniqueId},svg.Definitions={},svg.Styles={},svg.StylesSpecificity={},svg.Animations=[],svg.Images=[],svg.ctx=ctx,svg.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(width,height){this.viewPorts.push({width:width,height:height})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(d){return null!=d&&"number"==typeof d?d:"x"==d?this.width():"y"==d?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},svg.init(),svg.ImagesLoaded=function(){for(var i=0;i<svg.Images.length;i++)if(!svg.Images[i].loaded)return!1;return!0},svg.trim=function(s){return s.replace(/^\s+|\s+$/g,"")},svg.compressSpaces=function(s){return s.replace(/[\s\r\t\n]+/gm," ")},svg.ajax=function(url){var AJAX;return(AJAX=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(AJAX.open("GET",url,!1),AJAX.send(null),AJAX.responseText):null},svg.parseXml=function(xml){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var xmlDoc=new Windows.Data.Xml.Dom.XmlDocument,settings=new Windows.Data.Xml.Dom.XmlLoadSettings;return settings.prohibitDtd=!1,xmlDoc.loadXml(xml,settings),xmlDoc}return window.DOMParser?(new DOMParser).parseFromString(xml,"text/xml"):(xml=xml.replace(/<!DOCTYPE svg[^>]*>/,""),(xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async="false",xmlDoc.loadXML(xml),xmlDoc)},svg.Property=function(name,value){this.name=name,this.value=value},svg.Property.prototype.getValue=function(){return this.value},svg.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},svg.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var n=parseFloat(this.value);return(this.value+"").match(/%$/)&&(n/=100),n},svg.Property.prototype.valueOrDefault=function(def){return this.hasValue()?this.value:def},svg.Property.prototype.numValueOrDefault=function(def){return this.hasValue()?this.numValue():def},svg.Property.prototype.addOpacity=function(opacityProp){var newValue=this.value;if(null!=opacityProp.value&&""!=opacityProp.value&&"string"==typeof this.value){var color=new RGBColor(this.value);color.ok&&(newValue="rgba("+color.r+", "+color.g+", "+color.b+", "+opacityProp.numValue()+")")}return new svg.Property(this.name,newValue)},svg.Property.prototype.getDefinition=function(){var name=this.value.match(/#([^\)'"]+)/);return name&&(name=name[1]),name||(name=this.value),svg.Definitions[name]},svg.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},svg.Property.prototype.getFillStyleDefinition=function(e,opacityProp){var def=this.getDefinition();if(null!=def&&def.createGradient)return def.createGradient(svg.ctx,e,opacityProp);if(null!=def&&def.createPattern){if(def.getHrefAttribute().hasValue()){var pt=def.attribute("patternTransform");def=def.getHrefAttribute().getDefinition(),pt.hasValue()&&(def.attribute("patternTransform",!0).value=pt.value)}return def.createPattern(svg.ctx,e)}return null},svg.Property.prototype.getDPI=function(viewPort){return 96},svg.Property.prototype.getEM=function(viewPort){var em=12,fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);return fontSize.hasValue()&&(em=fontSize.toPixels(viewPort)),em},svg.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},svg.Property.prototype.toPixels=function(viewPort,processPercent){if(!this.hasValue())return 0;var s=this.value+"";if(s.match(/em$/))return this.numValue()*this.getEM(viewPort);if(s.match(/ex$/))return this.numValue()*this.getEM(viewPort)/2;if(s.match(/px$/))return this.numValue();if(s.match(/pt$/))return this.numValue()*this.getDPI(viewPort)*(1/72);if(s.match(/pc$/))return 15*this.numValue();if(s.match(/cm$/))return this.numValue()*this.getDPI(viewPort)/2.54;if(s.match(/mm$/))return this.numValue()*this.getDPI(viewPort)/25.4;if(s.match(/in$/))return this.numValue()*this.getDPI(viewPort);if(s.match(/%$/))return this.numValue()*svg.ViewPort.ComputeSize(viewPort);var n=this.numValue();return processPercent&&n<1?n*svg.ViewPort.ComputeSize(viewPort):n},svg.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/s$/)?1e3*this.numValue():(s.match(/ms$/),this.numValue())},svg.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/deg$/)?this.numValue()*(Math.PI/180):s.match(/grad$/)?this.numValue()*(Math.PI/200):s.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return svg.Property.prototype.toTextBaseline=function(){return this.hasValue()?textBaselineMapping[this.value]:null},svg.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(fontStyle,fontVariant,fontWeight,fontSize,fontFamily,inherit){var f=null!=inherit?this.Parse(inherit):this.CreateFont("","","","","",svg.ctx.font);return{fontFamily:fontFamily||f.fontFamily,fontSize:fontSize||f.fontSize,fontStyle:fontStyle||f.fontStyle,fontWeight:fontWeight||f.fontWeight,fontVariant:fontVariant||f.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var that=this;this.Parse=function(s){for(var f={},d=svg.trim(svg.compressSpaces(s||"")).split(" "),set={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},ff="",i=0;i<d.length;i++)set.fontStyle||-1==that.Styles.indexOf(d[i])?set.fontVariant||-1==that.Variants.indexOf(d[i])?set.fontWeight||-1==that.Weights.indexOf(d[i])?set.fontSize?"inherit"!=d[i]&&(ff+=d[i]):("inherit"!=d[i]&&(f.fontSize=d[i].split("/")[0]),set.fontStyle=set.fontVariant=set.fontWeight=set.fontSize=!0):("inherit"!=d[i]&&(f.fontWeight=d[i]),set.fontStyle=set.fontVariant=set.fontWeight=!0):("inherit"!=d[i]&&(f.fontVariant=d[i]),set.fontStyle=set.fontVariant=!0):("inherit"!=d[i]&&(f.fontStyle=d[i]),set.fontStyle=!0);return""!=ff&&(f.fontFamily=ff),f}},svg.ToNumberArray=function(s){for(var a=svg.trim(svg.compressSpaces((s||"").replace(/,/g," "))).split(" "),i=0;i<a.length;i++)a[i]=parseFloat(a[i]);return a},svg.Point=function(x,y){this.x=x,this.y=y},svg.Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x)},svg.Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4],yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp,this.y=yp},svg.CreatePoint=function(s){var a=svg.ToNumberArray(s);return new svg.Point(a[0],a[1])},svg.CreatePath=function(s){for(var a=svg.ToNumberArray(s),path=[],i=0;i<a.length;i+=2)path.push(new svg.Point(a[i],a[i+1]));return path},svg.BoundingBox=function(x1,y1,x2,y2){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(x,y){null!=x&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=x,this.x2=x),x<this.x1&&(this.x1=x),x>this.x2&&(this.x2=x)),null!=y&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=y,this.y2=y),y<this.y1&&(this.y1=y),y>this.y2&&(this.y2=y))},this.addX=function(x){this.addPoint(x,null)},this.addY=function(y){this.addPoint(null,y)},this.addBoundingBox=function(bb){this.addPoint(bb.x1,bb.y1),this.addPoint(bb.x2,bb.y2)},this.addQuadraticCurve=function(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x),cp1y=p0y+2/3*(p1y-p0y),cp2x=cp1x+1/3*(p2x-p0x),cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y)},this.addBezierCurve=function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];for(this.addPoint(p0[0],p0[1]),this.addPoint(p3[0],p3[1]),i=0;i<=1;i++){var f=function(t){return Math.pow(1-t,3)*p0[i]+3*Math.pow(1-t,2)*t*p1[i]+3*(1-t)*Math.pow(t,2)*p2[i]+Math.pow(t,3)*p3[i]},b=6*p0[i]-12*p1[i]+6*p2[i],a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i],c=3*p1[i]-3*p0[i];if(0!=a){var b2ac=Math.pow(b,2)-4*c*a;if(!(b2ac<0)){var t1=(-b+Math.sqrt(b2ac))/(2*a);0<t1&&t1<1&&(0==i&&this.addX(f(t1)),1==i&&this.addY(f(t1)));var t2=(-b-Math.sqrt(b2ac))/(2*a);0<t2&&t2<1&&(0==i&&this.addX(f(t2)),1==i&&this.addY(f(t2)))}}else{if(0==b)continue;var t=-c/b;0<t&&t<1&&(0==i&&this.addX(f(t)),1==i&&this.addY(f(t)))}}},this.isPointInBox=function(x,y){return this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2},this.addPoint(x1,y1),this.addPoint(x2,y2)},svg.Transform=function(v){var that=this;this.Type={},this.Type.translate=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.translate(this.p.x||0,this.p.y||0)},this.unapply=function(ctx){ctx.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(p){p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(s){var a=svg.ToNumberArray(s);this.angle=new svg.Property("angle",a[0]),this.cx=a[1]||0,this.cy=a[2]||0,this.apply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.unapply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(-1*this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.applyToPoint=function(p){var a=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),p.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]),p.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(ctx){ctx.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(p){p.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(s){this.m=svg.ToNumberArray(s),this.apply=function(ctx){ctx.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(ctx){var a=this.m[0],b=this.m[2],c=this.m[4],d=this.m[1],e=this.m[3],f=this.m[5],det=1/(a*(1*e-0*f)-b*(1*d-0*f)+c*(0*d-0*e));ctx.transform(det*(1*e-0*f),det*(0*f-1*d),det*(0*c-1*b),det*(1*a-0*c),det*(b*f-c*e),det*(c*d-a*f))},this.applyToPoint=function(p){p.applyTransform(this.m)}},this.Type.SkewBase=function(s){this.base=that.Type.matrix,this.base(s),this.angle=new svg.Property("angle",s)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(ctx){for(var i=0;i<this.transforms.length;i++)this.transforms[i].apply(ctx)},this.unapply=function(ctx){for(var i=this.transforms.length-1;i>=0;i--)this.transforms[i].unapply(ctx)},this.applyToPoint=function(p){for(var i=0;i<this.transforms.length;i++)this.transforms[i].applyToPoint(p)};for(var data=svg.trim(svg.compressSpaces(v)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<data.length;i++){var type=svg.trim(data[i].split("(")[0]),s=data[i].split("(")[1].replace(")",""),transform=new this.Type[type](s);transform.type=type,this.transforms.push(transform)}},svg.AspectRatio=function(ctx,aspectRatio,width,desiredWidth,height,desiredHeight,minX,minY,refX,refY){var align=(aspectRatio=(aspectRatio=svg.compressSpaces(aspectRatio)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",meetOrSlice=aspectRatio.split(" ")[1]||"meet",scaleX=width/desiredWidth,scaleY=height/desiredHeight,scaleMin=Math.min(scaleX,scaleY),scaleMax=Math.max(scaleX,scaleY);"meet"==meetOrSlice&&(desiredWidth*=scaleMin,desiredHeight*=scaleMin),"slice"==meetOrSlice&&(desiredWidth*=scaleMax,desiredHeight*=scaleMax),refX=new svg.Property("refX",refX),refY=new svg.Property("refY",refY),refX.hasValue()&&refY.hasValue()?ctx.translate(-scaleMin*refX.toPixels("x"),-scaleMin*refY.toPixels("y")):(align.match(/^xMid/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width/2-desiredWidth/2,0),align.match(/YMid$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height/2-desiredHeight/2),align.match(/^xMax/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width-desiredWidth,0),align.match(/YMax$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height-desiredHeight)),"none"==align?ctx.scale(scaleX,scaleY):"meet"==meetOrSlice?ctx.scale(scaleMin,scaleMin):"slice"==meetOrSlice&&ctx.scale(scaleMax,scaleMax),ctx.translate(null==minX?0:-minX,null==minY?0:-minY)},svg.Element={},svg.EmptyProperty=new svg.Property("EMPTY",""),svg.Element.ElementBase=function(node){if(this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(name,createIfNotExists){var a=this.attributes[name];return null!=a?a:(1==createIfNotExists&&(a=new svg.Property(name,""),this.attributes[name]=a),a||svg.EmptyProperty)},this.getHrefAttribute=function(){for(var a in this.attributes)if("href"==a||a.match(/:href$/))return this.attributes[a];return svg.EmptyProperty},this.style=function(name,createIfNotExists,skipAncestors){var s=this.styles[name];if(null!=s)return s;var a=this.attribute(name);if(null!=a&&a.hasValue())return this.styles[name]=a,a;if(1!=skipAncestors){var p=this.parent;if(null!=p){var ps=p.style(name);if(null!=ps&&ps.hasValue())return ps}}return 1==createIfNotExists&&(s=new svg.Property(name,""),this.styles[name]=s),s||svg.EmptyProperty},this.render=function(ctx){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(ctx.save(),this.style("mask").hasValue()){var mask=this.style("mask").getDefinition();null!=mask&&mask.apply(ctx,this)}else if(this.style("filter").hasValue()){var filter=this.style("filter").getDefinition();null!=filter&&filter.apply(ctx,this)}else this.setContext(ctx),this.renderChildren(ctx),this.clearContext(ctx);ctx.restore()}},this.setContext=function(ctx){},this.clearContext=function(ctx){},this.renderChildren=function(ctx){for(var i=0;i<this.children.length;i++)this.children[i].render(ctx)},this.addChild=function(childNode,create){var child=childNode;create&&(child=svg.CreateElement(childNode)),child.parent=this,"title"!=child.type&&this.children.push(child)},this.addStylesFromStyleDefinition=function(){for(var selector in svg.Styles)if("@"!=selector[0]&&matchesSelector(node,selector)){var styles=svg.Styles[selector],specificity=svg.StylesSpecificity[selector];if(null!=styles)for(var name in styles){var existingSpecificity=this.stylesSpecificity[name];void 0===existingSpecificity&&(existingSpecificity="000"),specificity>existingSpecificity&&(this.styles[name]=styles[name],this.stylesSpecificity[name]=specificity)}}},null!=node&&1==node.nodeType){for(var i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];this.attributes[attribute.nodeName]=new svg.Property(attribute.nodeName,attribute.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){var styles=this.attribute("style").value.split(";");for(i=0;i<styles.length;i++)if(""!=svg.trim(styles[i])){var style=styles[i].split(":"),name=svg.trim(style[0]),value=svg.trim(style[1]);this.styles[name]=new svg.Property(name,value)}}this.attribute("id").hasValue()&&null==svg.Definitions[this.attribute("id").value]&&(svg.Definitions[this.attribute("id").value]=this);for(i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];if(1==childNode.nodeType&&this.addChild(childNode,!0),this.captureTextNodes&&(3==childNode.nodeType||4==childNode.nodeType)){var text=childNode.value||childNode.text||childNode.textContent||"";""!=svg.compressSpaces(text)&&this.addChild(new svg.Element.tspan(childNode),!1)}}}},svg.Element.RenderedElementBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.setContext=function(ctx){var fs;if(this.style("fill").isUrlDefinition())null!=(fs=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(ctx.fillStyle=fs);else if(this.style("fill").hasValue()){var fillStyle;"currentColor"==(fillStyle=this.style("fill")).value&&(fillStyle.value=this.style("color").value),"inherit"!=fillStyle.value&&(ctx.fillStyle="none"==fillStyle.value?"rgba(0,0,0,0)":fillStyle.value)}this.style("fill-opacity").hasValue()&&(fillStyle=(fillStyle=new svg.Property("fill",ctx.fillStyle)).addOpacity(this.style("fill-opacity")),ctx.fillStyle=fillStyle.value);if(this.style("stroke").isUrlDefinition())null!=(fs=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(ctx.strokeStyle=fs);else if(this.style("stroke").hasValue()){var strokeStyle;"currentColor"==(strokeStyle=this.style("stroke")).value&&(strokeStyle.value=this.style("color").value),"inherit"!=strokeStyle.value&&(ctx.strokeStyle="none"==strokeStyle.value?"rgba(0,0,0,0)":strokeStyle.value)}this.style("stroke-opacity").hasValue()&&(strokeStyle=(strokeStyle=new svg.Property("stroke",ctx.strokeStyle)).addOpacity(this.style("stroke-opacity")),ctx.strokeStyle=strokeStyle.value);if(this.style("stroke-width").hasValue()){var newLineWidth=this.style("stroke-width").toPixels();ctx.lineWidth=0==newLineWidth?.001:newLineWidth}if(this.style("stroke-linecap").hasValue()&&(ctx.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(ctx.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(ctx.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var gaps=svg.ToNumberArray(this.style("stroke-dasharray").value);void 0!==ctx.setLineDash?ctx.setLineDash(gaps):void 0!==ctx.webkitLineDash?ctx.webkitLineDash=gaps:void 0===ctx.mozDash||1==gaps.length&&0==gaps[0]||(ctx.mozDash=gaps);var offset=this.style("stroke-dashoffset").numValueOrDefault(1);void 0!==ctx.lineDashOffset?ctx.lineDashOffset=offset:void 0!==ctx.webkitLineDashOffset?ctx.webkitLineDashOffset=offset:void 0!==ctx.mozDashOffset&&(ctx.mozDashOffset=offset)}(void 0!==ctx.font&&(ctx.font=svg.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue())&&new svg.Transform(this.style("transform",!1,!0).value).apply(ctx);if(this.style("clip-path",!1,!0).hasValue()){var clip=this.style("clip-path",!1,!0).getDefinition();null!=clip&&clip.apply(ctx)}this.style("opacity").hasValue()&&(ctx.globalAlpha=this.style("opacity").numValue())}},svg.Element.RenderedElementBase.prototype=new svg.Element.ElementBase,svg.Element.PathElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.path=function(ctx){return null!=ctx&&ctx.beginPath(),new svg.BoundingBox},this.renderChildren=function(ctx){this.path(ctx),svg.Mouse.checkPath(this,ctx),""!=ctx.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?ctx.fill(this.style("fill-rule").value):ctx.fill()),""!=ctx.strokeStyle&&ctx.stroke();var markers=this.getMarkers();if(null!=markers){if(this.style("marker-start").isUrlDefinition())(marker=this.style("marker-start").getDefinition()).render(ctx,markers[0][0],markers[0][1]);if(this.style("marker-mid").isUrlDefinition())for(var marker=this.style("marker-mid").getDefinition(),i=1;i<markers.length-1;i++)marker.render(ctx,markers[i][0],markers[i][1]);if(this.style("marker-end").isUrlDefinition())(marker=this.style("marker-end").getDefinition()).render(ctx,markers[markers.length-1][0],markers[markers.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},svg.Element.PathElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.svg=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseClearContext=this.clearContext,this.clearContext=function(ctx){this.baseClearContext(ctx),svg.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(ctx){ctx.strokeStyle="rgba(0,0,0,0)",ctx.lineCap="butt",ctx.lineJoin="miter",ctx.miterLimit=4,void 0!==ctx.font&&void 0!==window.getComputedStyle&&(ctx.font=window.getComputedStyle(ctx.canvas).getPropertyValue("font")),this.baseSetContext(ctx),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),ctx.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var width=svg.ViewPort.width(),height=svg.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");var x=0,y=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(x=-this.attribute("refX").toPixels("x"),y=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(ctx.beginPath(),ctx.moveTo(x,y),ctx.lineTo(width,y),ctx.lineTo(width,height),ctx.lineTo(x,height),ctx.closePath(),ctx.clip())}if(svg.ViewPort.SetCurrent(width,height),this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value),minX=viewBox[0],minY=viewBox[1];width=viewBox[2],height=viewBox[3],svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,svg.ViewPort.width(),width,svg.ViewPort.height(),height,minX,minY,this.attribute("refX").value,this.attribute("refY").value),svg.ViewPort.RemoveCurrent(),svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}},svg.Element.svg.prototype=new svg.Element.RenderedElementBase,svg.Element.rect=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y"),rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(ry=rx),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(rx=ry),rx=Math.min(rx,width/2),ry=Math.min(ry,height/2),null!=ctx&&(ctx.beginPath(),ctx.moveTo(x+rx,y),ctx.lineTo(x+width-rx,y),ctx.quadraticCurveTo(x+width,y,x+width,y+ry),ctx.lineTo(x+width,y+height-ry),ctx.quadraticCurveTo(x+width,y+height,x+width-rx,y+height),ctx.lineTo(x+rx,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-ry),ctx.lineTo(x,y+ry),ctx.quadraticCurveTo(x,y,x+rx,y),ctx.closePath()),new svg.BoundingBox(x,y,x+width,y+height)}},svg.Element.rect.prototype=new svg.Element.PathElementBase,svg.Element.circle=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=ctx&&(ctx.beginPath(),ctx.arc(cx,cy,r,0,2*Math.PI,!0),ctx.closePath()),new svg.BoundingBox(cx-r,cy-r,cx+r,cy+r)}},svg.Element.circle.prototype=new svg.Element.PathElementBase,svg.Element.ellipse=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var KAPPA=(Math.sqrt(2)-1)/3*4,rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y"),cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y");return null!=ctx&&(ctx.beginPath(),ctx.moveTo(cx,cy-ry),ctx.bezierCurveTo(cx+KAPPA*rx,cy-ry,cx+rx,cy-KAPPA*ry,cx+rx,cy),ctx.bezierCurveTo(cx+rx,cy+KAPPA*ry,cx+KAPPA*rx,cy+ry,cx,cy+ry),ctx.bezierCurveTo(cx-KAPPA*rx,cy+ry,cx-rx,cy+KAPPA*ry,cx-rx,cy),ctx.bezierCurveTo(cx-rx,cy-KAPPA*ry,cx-KAPPA*rx,cy-ry,cx,cy-ry),ctx.closePath()),new svg.BoundingBox(cx-rx,cy-ry,cx+rx,cy+ry)}},svg.Element.ellipse.prototype=new svg.Element.PathElementBase,svg.Element.line=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.getPoints=function(){return[new svg.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new svg.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(ctx){var points=this.getPoints();return null!=ctx&&(ctx.beginPath(),ctx.moveTo(points[0].x,points[0].y),ctx.lineTo(points[1].x,points[1].y)),new svg.BoundingBox(points[0].x,points[0].y,points[1].x,points[1].y)},this.getMarkers=function(){var points=this.getPoints(),a=points[0].angleTo(points[1]);return[[points[0],a],[points[1],a]]}},svg.Element.line.prototype=new svg.Element.PathElementBase,svg.Element.polyline=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.points=svg.CreatePath(this.attribute("points").value),this.path=function(ctx){var bb=new svg.BoundingBox(this.points[0].x,this.points[0].y);null!=ctx&&(ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)bb.addPoint(this.points[i].x,this.points[i].y),null!=ctx&&ctx.lineTo(this.points[i].x,this.points[i].y);return bb},this.getMarkers=function(){for(var markers=[],i=0;i<this.points.length-1;i++)markers.push([this.points[i],this.points[i].angleTo(this.points[i+1])]);return markers.push([this.points[this.points.length-1],markers[markers.length-1][1]]),markers}},svg.Element.polyline.prototype=new svg.Element.PathElementBase,svg.Element.polygon=function(node){this.base=svg.Element.polyline,this.base(node),this.basePath=this.path,this.path=function(ctx){var bb=this.basePath(ctx);return null!=ctx&&(ctx.lineTo(this.points[0].x,this.points[0].y),ctx.closePath()),bb}},svg.Element.polygon.prototype=new svg.Element.polyline,svg.Element.path=function(node){this.base=svg.Element.PathElementBase,this.base(node);var d=this.attribute("d").value;d=d.replace(/,/gm," ");for(var i=0;i<2;i++)d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");d=(d=d.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2");for(i=0;i<2;i++)d=d.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");d=d.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),d=svg.compressSpaces(d),d=svg.trim(d),this.PathParser=new function(d){this.tokens=d.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new svg.Point(0,0),this.control=new svg.Point(0,0),this.current=new svg.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var p=new svg.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p)},this.getAsControlPoint=function(){var p=this.getPoint();return this.control=p,p},this.getAsCurrentPoint=function(){var p=this.getPoint();return this.current=p,p},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new svg.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(p){return this.isRelativeCommand()&&(p.x+=this.current.x,p.y+=this.current.y),p},this.addMarker=function(p,from,priorTo){null!=priorTo&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo)),this.addMarkerAngle(p,null==from?null:from.angleTo(p))},this.addMarkerAngle=function(p,a){this.points.push(p),this.angles.push(a)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++)if(null==this.angles[i])for(var j=i+1;j<this.angles.length;j++)if(null!=this.angles[j]){this.angles[i]=this.angles[j];break}return this.angles}}(d),this.path=function(ctx){var pp=this.PathParser;pp.reset();var bb=new svg.BoundingBox;for(null!=ctx&&ctx.beginPath();!pp.isEnd();)switch(pp.nextCommand(),pp.command){case"M":case"m":var p=pp.getAsCurrentPoint();for(pp.addMarker(p),bb.addPoint(p.x,p.y),null!=ctx&&ctx.moveTo(p.x,p.y),pp.start=pp.current;!pp.isCommandOrEnd();){p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"L":case"l":for(;!pp.isCommandOrEnd();){var c=pp.current;p=pp.getAsCurrentPoint();pp.addMarker(p,c),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"H":case"h":for(;!pp.isCommandOrEnd();){var newP=new svg.Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"V":case"v":for(;!pp.isCommandOrEnd();){newP=new svg.Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"C":case"c":for(;!pp.isCommandOrEnd();){var curr=pp.current,p1=pp.getPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"S":case"s":for(;!pp.isCommandOrEnd();){curr=pp.current,p1=pp.getReflectedControlPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"Q":case"q":for(;!pp.isCommandOrEnd();){curr=pp.current,cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"T":case"t":for(;!pp.isCommandOrEnd();){curr=pp.current,cntrl=pp.getReflectedControlPoint();pp.control=cntrl;cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"A":case"a":for(;!pp.isCommandOrEnd();){curr=pp.current;var rx=pp.getScalar(),ry=pp.getScalar(),xAxisRotation=pp.getScalar()*(Math.PI/180),largeArcFlag=pp.getScalar(),sweepFlag=pp.getScalar(),currp=(cp=pp.getAsCurrentPoint(),new svg.Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2)),l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);l>1&&(rx*=Math.sqrt(l),ry*=Math.sqrt(l));var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt((Math.pow(rx,2)*Math.pow(ry,2)-Math.pow(rx,2)*Math.pow(currp.y,2)-Math.pow(ry,2)*Math.pow(currp.x,2))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));isNaN(s)&&(s=0);var cpp=new svg.Point(s*rx*currp.y/ry,s*-ry*currp.x/rx),centp=new svg.Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y),m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))},r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))},a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v))},a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]),u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry],v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry],ad=a(u,v);r(u,v)<=-1&&(ad=Math.PI),r(u,v)>=1&&(ad=0);var dir=1-sweepFlag?1:-1,ah=a1+dir*(ad/2),halfWay=new svg.Point(centp.x+rx*Math.cos(ah),centp.y+ry*Math.sin(ah));if(pp.addMarkerAngle(halfWay,ah-dir*Math.PI/2),pp.addMarkerAngle(cp,ah-dir*Math.PI),bb.addPoint(cp.x,cp.y),null!=ctx){r=rx>ry?rx:ry;var sx=rx>ry?1:rx/ry,sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y),ctx.rotate(xAxisRotation),ctx.scale(sx,sy),ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag),ctx.scale(1/sx,1/sy),ctx.rotate(-xAxisRotation),ctx.translate(-centp.x,-centp.y)}}break;case"Z":case"z":null!=ctx&&ctx.closePath(),pp.current=pp.start}return bb},this.getMarkers=function(){for(var points=this.PathParser.getMarkerPoints(),angles=this.PathParser.getMarkerAngles(),markers=[],i=0;i<points.length;i++)markers.push([points[i],angles[i]]);return markers}},svg.Element.path.prototype=new svg.Element.PathElementBase,svg.Element.pattern=function(node){this.base=svg.Element.ElementBase,this.base(node),this.createPattern=function(ctx,element){var width=this.attribute("width").toPixels("x",!0),height=this.attribute("height").toPixels("y",!0),tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.width=new svg.Property("width",width+"px"),tempSvg.attributes.height=new svg.Property("height",height+"px"),tempSvg.attributes.transform=new svg.Property("transform",this.attribute("patternTransform").value),tempSvg.children=this.children;var c=document.createElement("canvas");c.width=width,c.height=height;var cctx=c.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&cctx.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var x=-1;x<=1;x++)for(var y=-1;y<=1;y++)cctx.save(),tempSvg.attributes.x=new svg.Property("x",x*c.width),tempSvg.attributes.y=new svg.Property("y",y*c.height),tempSvg.render(cctx),cctx.restore();return ctx.createPattern(c,"repeat")}},svg.Element.pattern.prototype=new svg.Element.ElementBase,svg.Element.marker=function(node){this.base=svg.Element.ElementBase,this.base(node),this.baseRender=this.render,this.render=function(ctx,point,angle){ctx.translate(point.x,point.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(angle),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(ctx.lineWidth,ctx.lineWidth),ctx.save();var tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.refX=new svg.Property("refX",this.attribute("refX").value),tempSvg.attributes.refY=new svg.Property("refY",this.attribute("refY").value),tempSvg.attributes.width=new svg.Property("width",this.attribute("markerWidth").value),tempSvg.attributes.height=new svg.Property("height",this.attribute("markerHeight").value),tempSvg.attributes.fill=new svg.Property("fill",this.attribute("fill").valueOrDefault("black")),tempSvg.attributes.stroke=new svg.Property("stroke",this.attribute("stroke").valueOrDefault("none")),tempSvg.children=this.children,tempSvg.render(ctx),ctx.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(1/ctx.lineWidth,1/ctx.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(-angle),ctx.translate(-point.x,-point.y)}},svg.Element.marker.prototype=new svg.Element.ElementBase,svg.Element.defs=function(node){this.base=svg.Element.ElementBase,this.base(node),this.render=function(ctx){}},svg.Element.defs.prototype=new svg.Element.ElementBase,svg.Element.GradientBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.stops=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"stop"==child.type&&this.stops.push(child)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(stopsContainer){for(var i=0;i<this.attributesToInherit.length;i++){var attributeToInherit=this.attributesToInherit[i];!this.attribute(attributeToInherit).hasValue()&&stopsContainer.attribute(attributeToInherit).hasValue()&&(this.attribute(attributeToInherit,!0).value=stopsContainer.attribute(attributeToInherit).value)}},this.createGradient=function(ctx,element,parentOpacityProp){var stopsContainer=this;this.getHrefAttribute().hasValue()&&(stopsContainer=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(stopsContainer));var addParentOpacity=function(color){return parentOpacityProp.hasValue()?new svg.Property("color",color).addOpacity(parentOpacityProp).value:color},g=this.getGradient(ctx,element);if(null==g)return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length-1].color);for(var i=0;i<stopsContainer.stops.length;i++)g.addColorStop(stopsContainer.stops[i].offset,addParentOpacity(stopsContainer.stops[i].color));if(this.attribute("gradientTransform").hasValue()){var rootView=svg.ViewPort.viewPorts[0],rect=new svg.Element.rect;rect.attributes.x=new svg.Property("x",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.y=new svg.Property("y",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.width=new svg.Property("width",svg.MAX_VIRTUAL_PIXELS),rect.attributes.height=new svg.Property("height",svg.MAX_VIRTUAL_PIXELS);var group=new svg.Element.g;group.attributes.transform=new svg.Property("transform",this.attribute("gradientTransform").value),group.children=[rect];var tempSvg=new svg.Element.svg;tempSvg.attributes.x=new svg.Property("x",0),tempSvg.attributes.y=new svg.Property("y",0),tempSvg.attributes.width=new svg.Property("width",rootView.width),tempSvg.attributes.height=new svg.Property("height",rootView.height),tempSvg.children=[group];var c=document.createElement("canvas");c.width=rootView.width,c.height=rootView.height;var tempCtx=c.getContext("2d");return tempCtx.fillStyle=g,tempSvg.render(tempCtx),tempCtx.createPattern(c,"no-repeat")}return g}},svg.Element.GradientBase.prototype=new svg.Element.ElementBase,svg.Element.linearGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(ctx,element){var bb="objectBoundingBox"==this.gradientUnits()?element.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var x1="objectBoundingBox"==this.gradientUnits()?bb.x()+bb.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),y1="objectBoundingBox"==this.gradientUnits()?bb.y()+bb.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),x2="objectBoundingBox"==this.gradientUnits()?bb.x()+bb.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),y2="objectBoundingBox"==this.gradientUnits()?bb.y()+bb.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return x1==x2&&y1==y2?null:ctx.createLinearGradient(x1,y1,x2,y2)}},svg.Element.linearGradient.prototype=new svg.Element.GradientBase,svg.Element.radialGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(ctx,element){var bb=element.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var cx="objectBoundingBox"==this.gradientUnits()?bb.x()+bb.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),cy="objectBoundingBox"==this.gradientUnits()?bb.y()+bb.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),fx=cx,fy=cy;this.attribute("fx").hasValue()&&(fx="objectBoundingBox"==this.gradientUnits()?bb.x()+bb.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(fy="objectBoundingBox"==this.gradientUnits()?bb.y()+bb.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var r="objectBoundingBox"==this.gradientUnits()?(bb.width()+bb.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return ctx.createRadialGradient(fx,fy,0,cx,cy,r)}},svg.Element.radialGradient.prototype=new svg.Element.GradientBase,svg.Element.stop=function(node){this.base=svg.Element.ElementBase,this.base(node),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var stopColor=this.style("stop-color",!0);""===stopColor.value&&(stopColor.value="#000"),this.style("stop-opacity").hasValue()&&(stopColor=stopColor.addOpacity(this.style("stop-opacity"))),this.color=stopColor.value},svg.Element.stop.prototype=new svg.Element.ElementBase,svg.Element.AnimateBase=function(node){this.base=svg.Element.ElementBase,this.base(node),svg.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var attributeType=this.attribute("attributeType").value,attributeName=this.attribute("attributeName").value;return"CSS"==attributeType?this.parent.style(attributeName,!0):this.parent.attribute(attributeName,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(delta){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+delta;var updated=!1;if(this.begin<this.duration){var newValue=this.calcValue();if(this.attribute("type").hasValue())newValue=this.attribute("type").value+"("+newValue+")";this.getProperty().value=newValue,updated=!0}return updated},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var ret={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var p=ret.progress*(this.values.value.length-1),lb=Math.floor(p),ub=Math.ceil(p);ret.from=new svg.Property("from",parseFloat(this.values.value[lb])),ret.to=new svg.Property("to",parseFloat(this.values.value[ub])),ret.progress=(p-lb)/(ub-lb)}else ret.from=this.from,ret.to=this.to;return ret}},svg.Element.AnimateBase.prototype=new svg.Element.ElementBase,svg.Element.animate=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress();return p.from.numValue()+(p.to.numValue()-p.from.numValue())*p.progress+this.initialUnits}},svg.Element.animate.prototype=new svg.Element.AnimateBase,svg.Element.animateColor=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress(),from=new RGBColor(p.from.value),to=new RGBColor(p.to.value);if(from.ok&&to.ok){var r=from.r+(to.r-from.r)*p.progress,g=from.g+(to.g-from.g)*p.progress,b=from.b+(to.b-from.b)*p.progress;return"rgb("+parseInt(r,10)+","+parseInt(g,10)+","+parseInt(b,10)+")"}return this.attribute("from").value}},svg.Element.animateColor.prototype=new svg.Element.AnimateBase,svg.Element.animateTransform=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){for(var p=this.progress(),from=svg.ToNumberArray(p.from.value),to=svg.ToNumberArray(p.to.value),newValue="",i=0;i<from.length;i++)newValue+=from[i]+(to[i]-from[i])*p.progress+" ";return newValue}},svg.Element.animateTransform.prototype=new svg.Element.animate,svg.Element.font=function(node){this.base=svg.Element.ElementBase,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"font-face"==child.type?(this.fontFace=child,child.style("font-family").hasValue()&&(svg.Definitions[child.style("font-family").value]=this)):"missing-glyph"==child.type?this.missingGlyph=child:"glyph"==child.type&&(""!=child.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[child.unicode]&&(this.glyphs[child.unicode]=[]),this.glyphs[child.unicode][child.arabicForm]=child):this.glyphs[child.unicode]=child)}},svg.Element.font.prototype=new svg.Element.ElementBase,svg.Element.fontface=function(node){this.base=svg.Element.ElementBase,this.base(node),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},svg.Element.fontface.prototype=new svg.Element.ElementBase,svg.Element.missingglyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=0},svg.Element.missingglyph.prototype=new svg.Element.path,svg.Element.glyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},svg.Element.glyph.prototype=new svg.Element.path,svg.Element.text=function(node){this.captureTextNodes=!0,this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx);var textBaseline=this.style("dominant-baseline").toTextBaseline();null==textBaseline&&(textBaseline=this.style("alignment-baseline").toTextBaseline()),null!=textBaseline&&(ctx.textBaseline=textBaseline)},this.getBoundingBox=function(){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);return new svg.BoundingBox(x,y-fontSize,x+Math.floor(2*fontSize/3)*this.children[0].getText().length,y)},this.renderChildren=function(ctx){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(ctx,this,0);for(var i=0;i<this.children.length;i++)this.renderChild(ctx,this,i)},this.getAnchorDelta=function(ctx,parent,startI){var textAnchor=this.style("text-anchor").valueOrDefault("start");if("start"!=textAnchor){for(var width=0,i=startI;i<parent.children.length;i++){var child=parent.children[i];if(i>startI&&child.attribute("x").hasValue())break;width+=child.measureTextRecursive(ctx)}return-1*("end"==textAnchor?width:width/2)}return 0},this.renderChild=function(ctx,parent,i){var child=parent.children[i];child.attribute("x").hasValue()?(child.x=child.attribute("x").toPixels("x")+parent.getAnchorDelta(ctx,parent,i),child.attribute("dx").hasValue()&&(child.x+=child.attribute("dx").toPixels("x"))):(child.attribute("dx").hasValue()&&(parent.x+=child.attribute("dx").toPixels("x")),child.x=parent.x),parent.x=child.x+child.measureText(ctx),child.attribute("y").hasValue()?(child.y=child.attribute("y").toPixels("y"),child.attribute("dy").hasValue()&&(child.y+=child.attribute("dy").toPixels("y"))):(child.attribute("dy").hasValue()&&(parent.y+=child.attribute("dy").toPixels("y")),child.y=parent.y),parent.y=child.y,child.render(ctx);for(i=0;i<child.children.length;i++)parent.renderChild(ctx,child,i)}},svg.Element.text.prototype=new svg.Element.RenderedElementBase,svg.Element.TextElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getGlyph=function(font,text,i){var c=text[i],glyph=null;if(font.isArabic){var arabicForm="isolated";(0==i||" "==text[i-1])&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="terminal"),i>0&&" "!=text[i-1]&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="medial"),i>0&&" "!=text[i-1]&&(i==text.length-1||" "==text[i+1])&&(arabicForm="initial"),void 0!==font.glyphs[c]&&null==(glyph=font.glyphs[c][arabicForm])&&"glyph"==font.glyphs[c].type&&(glyph=font.glyphs[c])}else glyph=font.glyphs[c];return null==glyph&&(glyph=font.missingGlyph),glyph},this.renderChildren=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null==customFont)""!=ctx.fillStyle&&ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y),""!=ctx.strokeStyle&&ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y);else{var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),fontStyle=this.parent.style("font-style").valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle),text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i),scale=fontSize/customFont.fontFace.unitsPerEm;ctx.translate(this.x,this.y),ctx.scale(scale,-scale);var lw=ctx.lineWidth;ctx.lineWidth=ctx.lineWidth*customFont.fontFace.unitsPerEm/fontSize,"italic"==fontStyle&&ctx.transform(1,0,.4,1,0,0),glyph.render(ctx),"italic"==fontStyle&&ctx.transform(1,0,-.4,1,0,0),ctx.lineWidth=lw,ctx.scale(1/scale,-1/scale),ctx.translate(-this.x,-this.y),this.x+=fontSize*(glyph.horizAdvX||customFont.horizAdvX)/customFont.fontFace.unitsPerEm,void 0===dx[i]||isNaN(dx[i])||(this.x+=dx[i])}}},this.getText=function(){},this.measureTextRecursive=function(ctx){for(var width=this.measureText(ctx),i=0;i<this.children.length;i++)width+=this.children[i].measureTextRecursive(ctx);return width},this.measureText=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null!=customFont){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),measure=0,text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){measure+=(this.getGlyph(customFont,text,i).horizAdvX||customFont.horizAdvX)*fontSize/customFont.fontFace.unitsPerEm,void 0===dx[i]||isNaN(dx[i])||(measure+=dx[i])}return measure}var textToMeasure=svg.compressSpaces(this.getText());if(!ctx.measureText)return 10*textToMeasure.length;ctx.save(),this.setContext(ctx);var width=ctx.measureText(textToMeasure).width;return ctx.restore(),width}},svg.Element.TextElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.tspan=function(node){this.captureTextNodes=!0,this.base=svg.Element.TextElementBase,this.base(node),this.text=svg.compressSpaces(node.value||node.text||node.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},svg.Element.tspan.prototype=new svg.Element.TextElementBase,svg.Element.tref=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.getText=function(){var element=this.getHrefAttribute().getDefinition();if(null!=element)return element.children[0].getText()}},svg.Element.tref.prototype=new svg.Element.TextElementBase,svg.Element.a=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.hasText=node.childNodes.length>0;for(var i=0;i<node.childNodes.length;i++)3!=node.childNodes[i].nodeType&&(this.hasText=!1);this.text=this.hasText?node.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(ctx){if(this.hasText){this.baseRenderChildren(ctx);var fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);svg.Mouse.checkBoundingBox(this,new svg.BoundingBox(this.x,this.y-fontSize.toPixels("y"),this.x+this.measureText(ctx),this.y))}else if(this.children.length>0){var g=new svg.Element.g;g.children=this.children,g.parent=this,g.render(ctx)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){svg.ctx.canvas.style.cursor="pointer"}},svg.Element.a.prototype=new svg.Element.TextElementBase,svg.Element.image=function(node){this.base=svg.Element.RenderedElementBase,this.base(node);var href=this.getHrefAttribute().value;if(""!=href){var isSvg=href.match(/\.svg$/);if(svg.Images.push(this),this.loaded=!1,isSvg)this.img=svg.ajax(href),this.loaded=!0;else{this.img=document.createElement("img"),1==svg.opts.useCORS&&(this.img.crossOrigin="Anonymous");var self=this;this.img.onload=function(){self.loaded=!0},this.img.onerror=function(){svg.log('ERROR: image "'+href+'" not found'),self.loaded=!0},this.img.src=href}this.renderChildren=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");0!=width&&0!=height&&(ctx.save(),isSvg?ctx.drawSvg(this.img,x,y,width,height):(ctx.translate(x,y),svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,width,this.img.width,height,this.img.height,0,0),ctx.drawImage(this.img,0,0)),ctx.restore())},this.getBoundingBox=function(){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");return new svg.BoundingBox(x,y,x+width,y+height)}}},svg.Element.image.prototype=new svg.Element.RenderedElementBase,svg.Element.g=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getBoundingBox=function(){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());return bb}},svg.Element.g.prototype=new svg.Element.RenderedElementBase,svg.Element.symbol=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.render=function(ctx){}},svg.Element.symbol.prototype=new svg.Element.RenderedElementBase,svg.Element.style=function(node){this.base=svg.Element.ElementBase,this.base(node);for(var css="",i=0;i<node.childNodes.length;i++)css+=node.childNodes[i].data;css=css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var cssDefs=(css=svg.compressSpaces(css)).split("}");for(i=0;i<cssDefs.length;i++)if(""!=svg.trim(cssDefs[i]))for(var cssDef=cssDefs[i].split("{"),cssClasses=cssDef[0].split(","),cssProps=cssDef[1].split(";"),j=0;j<cssClasses.length;j++){var cssClass=svg.trim(cssClasses[j]);if(""!=cssClass){for(var props=svg.Styles[cssClass]||{},k=0;k<cssProps.length;k++){var prop=cssProps[k].indexOf(":"),name=cssProps[k].substr(0,prop),value=cssProps[k].substr(prop+1,cssProps[k].length-prop);null!=name&&null!=value&&(props[svg.trim(name)]=new svg.Property(svg.trim(name),svg.trim(value)))}if(svg.Styles[cssClass]=props,svg.StylesSpecificity[cssClass]=getSelectorSpecificity(cssClass),"@font-face"==cssClass)for(var fontFamily=props["font-family"].value.replace(/"/g,""),srcs=props.src.value.split(","),s=0;s<srcs.length;s++)if(srcs[s].indexOf('format("svg")')>0)for(var urlStart=srcs[s].indexOf("url"),urlEnd=srcs[s].indexOf(")",urlStart),url=srcs[s].substr(urlStart+5,urlEnd-urlStart-6),fonts=svg.parseXml(svg.ajax(url)).getElementsByTagName("font"),f=0;f<fonts.length;f++){var font=svg.CreateElement(fonts[f]);svg.Definitions[fontFamily]=font}}}},svg.Element.style.prototype=new svg.Element.ElementBase,svg.Element.use=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx),this.attribute("x").hasValue()&&ctx.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&ctx.translate(0,this.attribute("y").toPixels("y"))};var element=this.getHrefAttribute().getDefinition();this.path=function(ctx){null!=element&&element.path(ctx)},this.getBoundingBox=function(){if(null!=element)return element.getBoundingBox()},this.renderChildren=function(ctx){if(null!=element){var tempSvg=element;"symbol"==element.type&&((tempSvg=new svg.Element.svg).type="svg",tempSvg.attributes.viewBox=new svg.Property("viewBox",element.attribute("viewBox").value),tempSvg.attributes.preserveAspectRatio=new svg.Property("preserveAspectRatio",element.attribute("preserveAspectRatio").value),tempSvg.attributes.overflow=new svg.Property("overflow",element.attribute("overflow").value),tempSvg.children=element.children),"svg"==tempSvg.type&&(this.attribute("width").hasValue()&&(tempSvg.attributes.width=new svg.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(tempSvg.attributes.height=new svg.Property("height",this.attribute("height").value)));var oldParent=tempSvg.parent;tempSvg.parent=null,tempSvg.render(ctx),tempSvg.parent=oldParent}}},svg.Element.use.prototype=new svg.Element.RenderedElementBase,svg.Element.mask=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");if(0==width&&0==height){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());x=Math.floor(bb.x1),y=Math.floor(bb.y1),width=Math.floor(bb.width()),height=Math.floor(bb.height())}var mask=element.attribute("mask").value;element.attribute("mask").value="";var cMask=document.createElement("canvas");cMask.width=x+width,cMask.height=y+height;var maskCtx=cMask.getContext("2d");this.renderChildren(maskCtx);var c=document.createElement("canvas");c.width=x+width,c.height=y+height;var tempCtx=c.getContext("2d");element.render(tempCtx),tempCtx.globalCompositeOperation="destination-in",tempCtx.fillStyle=maskCtx.createPattern(cMask,"no-repeat"),tempCtx.fillRect(0,0,x+width,y+height),ctx.fillStyle=tempCtx.createPattern(c,"no-repeat"),ctx.fillRect(0,0,x+width,y+height),element.attribute("mask").value=mask},this.render=function(ctx){}},svg.Element.mask.prototype=new svg.Element.ElementBase,svg.Element.clipPath=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx){var oldBeginPath=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var oldClosePath=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},oldBeginPath.call(ctx);for(var i=0;i<this.children.length;i++){var child=this.children[i];if(void 0!==child.path){var transform=null;child.style("transform",!1,!0).hasValue()&&(transform=new svg.Transform(child.style("transform",!1,!0).value)).apply(ctx),child.path(ctx),CanvasRenderingContext2D.prototype.closePath=oldClosePath,transform&&transform.unapply(ctx)}}oldClosePath.call(ctx),ctx.clip(),CanvasRenderingContext2D.prototype.beginPath=oldBeginPath,CanvasRenderingContext2D.prototype.closePath=oldClosePath},this.render=function(ctx){}},svg.Element.clipPath.prototype=new svg.Element.ElementBase,svg.Element.filter=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var bb=element.getBoundingBox(),x=Math.floor(bb.x1),y=Math.floor(bb.y1),width=Math.floor(bb.width()),height=Math.floor(bb.height()),filter=element.style("filter").value;element.style("filter").value="";for(var px=0,py=0,i=0;i<this.children.length;i++){var efd=this.children[i].extraFilterDistance||0;px=Math.max(px,efd),py=Math.max(py,efd)}var c=document.createElement("canvas");c.width=width+2*px,c.height=height+2*py;var tempCtx=c.getContext("2d");tempCtx.translate(-x+px,-y+py),element.render(tempCtx);for(i=0;i<this.children.length;i++)"function"==typeof this.children[i].apply&&this.children[i].apply(tempCtx,0,0,width+2*px,height+2*py);ctx.drawImage(c,0,0,width+2*px,height+2*py,x-px,y-py,width+2*px,height+2*py),element.style("filter",!0).value=filter},this.render=function(ctx){}},svg.Element.filter.prototype=new svg.Element.ElementBase,svg.Element.feMorphology=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,x,y,width,height){}},svg.Element.feMorphology.prototype=new svg.Element.ElementBase,svg.Element.feComposite=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,x,y,width,height){}},svg.Element.feComposite.prototype=new svg.Element.ElementBase,svg.Element.feColorMatrix=function(node){this.base=svg.Element.ElementBase,this.base(node);var matrix=svg.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var s=matrix[0];matrix=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var a=matrix[0]*Math.PI/180,c=function(m1,m2,m3){return m1+Math.cos(a)*m2+Math.sin(a)*m3};matrix=[c(.213,.787,-.213),c(.715,-.715,-.715),c(.072,-.072,.928),0,0,c(.213,-.213,.143),c(.715,.285,.14),c(.072,-.072,-.283),0,0,c(.213,-.213,-.787),c(.715,-.715,.715),c(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":matrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function imGet(img,x,y,width,height,rgba){return img[y*width*4+4*x+rgba]}function imSet(img,x,y,width,height,rgba,val){img[y*width*4+4*x+rgba]=val}function m(i,v){var mi=matrix[i];return mi*(mi<0?v-255:v)}this.apply=function(ctx,x,y,width,height){var srcData=ctx.getImageData(0,0,width,height);for(y=0;y<height;y++)for(x=0;x<width;x++){var r=imGet(srcData.data,x,y,width,0,0),g=imGet(srcData.data,x,y,width,0,1),b=imGet(srcData.data,x,y,width,0,2),a=imGet(srcData.data,x,y,width,0,3);imSet(srcData.data,x,y,width,0,0,m(0,r)+m(1,g)+m(2,b)+m(3,a)+m(4,1)),imSet(srcData.data,x,y,width,0,1,m(5,r)+m(6,g)+m(7,b)+m(8,a)+m(9,1)),imSet(srcData.data,x,y,width,0,2,m(10,r)+m(11,g)+m(12,b)+m(13,a)+m(14,1)),imSet(srcData.data,x,y,width,0,3,m(15,r)+m(16,g)+m(17,b)+m(18,a)+m(19,1))}ctx.clearRect(0,0,width,height),ctx.putImageData(srcData,0,0)}},svg.Element.feColorMatrix.prototype=new svg.Element.ElementBase,svg.Element.feGaussianBlur=function(node){this.base=svg.Element.ElementBase,this.base(node),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(ctx,x,y,width,height){void 0!==stackBlur.canvasRGBA?(ctx.canvas.id=svg.UniqueId(),ctx.canvas.style.display="none",document.body.appendChild(ctx.canvas),stackBlur.canvasRGBA(ctx.canvas.id,x,y,width,height,this.blurRadius),document.body.removeChild(ctx.canvas)):svg.log("ERROR: StackBlur.js must be included for blur to work")}},svg.Element.feGaussianBlur.prototype=new svg.Element.ElementBase,svg.Element.title=function(node){},svg.Element.title.prototype=new svg.Element.ElementBase,svg.Element.desc=function(node){},svg.Element.desc.prototype=new svg.Element.ElementBase,svg.Element.MISSING=function(node){svg.log("ERROR: Element '"+node.nodeName+"' not yet implemented.")},svg.Element.MISSING.prototype=new svg.Element.ElementBase,svg.CreateElement=function(node){var className=node.nodeName.replace(/^[^:]+:/,"");className=className.replace(/\-/g,"");var e=null;return(e=void 0!==svg.Element[className]?new svg.Element[className](node):new svg.Element.MISSING(node)).type=node.nodeName,e},svg.load=function(ctx,url){svg.loadXml(ctx,svg.ajax(url))},svg.loadXml=function(ctx,xml){svg.loadXmlDoc(ctx,svg.parseXml(xml))},svg.loadXmlDoc=function(ctx,dom){svg.init(ctx);var mapXY=function(p){for(var e=ctx.canvas;e;)p.x-=e.offsetLeft,p.y-=e.offsetTop,e=e.offsetParent;return window.scrollX&&(p.x+=window.scrollX),window.scrollY&&(p.y+=window.scrollY),p};1!=svg.opts.ignoreMouse&&(ctx.canvas.onclick=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onclick(p.x,p.y)},ctx.canvas.onmousemove=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onmousemove(p.x,p.y)});var e=svg.CreateElement(dom.documentElement);e.root=!0,e.addStylesFromStyleDefinition();var isFirstRender=!0,draw=function(){svg.ViewPort.Clear(),ctx.canvas.parentNode&&svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth,ctx.canvas.parentNode.clientHeight),1!=svg.opts.ignoreDimensions&&(e.style("width").hasValue()&&(ctx.canvas.width=e.style("width").toPixels("x"),ctx.canvas.style.width=ctx.canvas.width+"px"),e.style("height").hasValue()&&(ctx.canvas.height=e.style("height").toPixels("y"),ctx.canvas.style.height=ctx.canvas.height+"px"));var cWidth=ctx.canvas.clientWidth||ctx.canvas.width,cHeight=ctx.canvas.clientHeight||ctx.canvas.height;if(1==svg.opts.ignoreDimensions&&e.style("width").hasValue()&&e.style("height").hasValue()&&(cWidth=e.style("width").toPixels("x"),cHeight=e.style("height").toPixels("y")),svg.ViewPort.SetCurrent(cWidth,cHeight),null!=svg.opts.offsetX&&(e.attribute("x",!0).value=svg.opts.offsetX),null!=svg.opts.offsetY&&(e.attribute("y",!0).value=svg.opts.offsetY),null!=svg.opts.scaleWidth||null!=svg.opts.scaleHeight){var xRatio=null,yRatio=null,viewBox=svg.ToNumberArray(e.attribute("viewBox").value);null!=svg.opts.scaleWidth&&(e.attribute("width").hasValue()?xRatio=e.attribute("width").toPixels("x")/svg.opts.scaleWidth:isNaN(viewBox[2])||(xRatio=viewBox[2]/svg.opts.scaleWidth)),null!=svg.opts.scaleHeight&&(e.attribute("height").hasValue()?yRatio=e.attribute("height").toPixels("y")/svg.opts.scaleHeight:isNaN(viewBox[3])||(yRatio=viewBox[3]/svg.opts.scaleHeight)),null==xRatio&&(xRatio=yRatio),null==yRatio&&(yRatio=xRatio),e.attribute("width",!0).value=svg.opts.scaleWidth,e.attribute("height",!0).value=svg.opts.scaleHeight,e.style("transform",!0,!0).value+=" scale("+1/xRatio+","+1/yRatio+")"}1!=svg.opts.ignoreClear&&ctx.clearRect(0,0,cWidth,cHeight),e.render(ctx),isFirstRender&&(isFirstRender=!1,"function"==typeof svg.opts.renderCallback&&svg.opts.renderCallback(dom))},waitingForImages=!0;svg.ImagesLoaded()&&(waitingForImages=!1,draw()),svg.intervalID=setInterval(function(){var needUpdate=!1;if(waitingForImages&&svg.ImagesLoaded()&&(waitingForImages=!1,needUpdate=!0),1!=svg.opts.ignoreMouse&&(needUpdate|=svg.Mouse.hasEvents()),1!=svg.opts.ignoreAnimation)for(var i=0;i<svg.Animations.length;i++)needUpdate|=svg.Animations[i].update(1e3/svg.FRAMERATE);"function"==typeof svg.opts.forceRedraw&&1==svg.opts.forceRedraw()&&(needUpdate=!0),needUpdate&&(draw(),svg.Mouse.runEvents())},1e3/svg.FRAMERATE)},svg.stop=function(){svg.intervalID&&clearInterval(svg.intervalID)},svg.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(x,y){this.events.push({type:"onclick",x:x,y:y,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(x,y){this.events.push({type:"onmousemove",x:x,y:y,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(element,ctx){for(var i=0;i<this.events.length;i++){var e=this.events[i];ctx.isPointInPath&&ctx.isPointInPath(e.x,e.y)&&(this.eventElements[i]=element)}},this.checkBoundingBox=function(element,bb){for(var i=0;i<this.events.length;i++){var e=this.events[i];bb.isPointInBox(e.x,e.y)&&(this.eventElements[i]=element)}},this.runEvents=function(){svg.ctx.canvas.style.cursor="";for(var i=0;i<this.events.length;i++)for(var e=this.events[i],element=this.eventElements[i];element;)e.run(element),element=element.parent;this.events=[],this.eventElements=[]}},svg}return"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(s,dx,dy,dw,dh){canvg(this.canvas,s,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:dx,offsetY:dy,scaleWidth:dw,scaleHeight:dh})}),canvg}),Array.indexOf||(Array.prototype.indexOf=function(obj,start){for(var i=start||0;i<this.length;i++)if(this[i]===obj)return i;return-1});var Parser=function(scope){function object(o){function F(){}return F.prototype=o,new F}var TNUMBER=0,TOP1=1,TOP2=2,TVAR=3,TFUNCALL=4;function Token(type_,index_,prio_,number_){this.type_=type_,this.index_=index_||0,this.prio_=prio_||0,this.number_=void 0!==number_&&null!==number_?number_:0,this.toString=function(){switch(this.type_){case TNUMBER:return this.number_;case TOP1:case TOP2:case TVAR:return this.index_;case TFUNCALL:return"CALL";default:return"Invalid Token"}}}function Expression(tokens,ops1,ops2,functions){this.tokens=tokens,this.ops1=ops1,this.ops2=ops2,this.functions=functions}var escapable=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function add(a,b){return Number(a)+Number(b)}function sub(a,b){return a-b}function mul(a,b){return a*b}function div(a,b){return a/b}function mod(a,b){return a%b}function concat(a,b){return""+a+b}function neg(a){return-a}function random(a){return Math.random()*(a||1)}function fac(a){for(var b=a=Math.floor(a);a>1;)b*=--a;return b}function pyt(a,b){return Math.sqrt(a*a+b*b)}function append(a,b){return"[object Array]"!=Object.prototype.toString.call(a)?[a,b]:((a=a.slice()).push(b),a)}function Parser(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":neg,exp:Math.exp},this.ops2={"+":add,"-":sub,"*":mul,"/":div,"%":mod,"^":Math.pow,",":append,"||":concat},this.functions={random:random,fac:fac,min:Math.min,max:Math.max,pyt:pyt,pow:Math.pow,atan2:Math.atan2},this.consts={E:Math.E,PI:Math.PI}}Expression.prototype={simplify:function(values){values=values||{};var n1,n2,f,item,nstack=[],newexpression=[],L=this.tokens.length,i=0;for(i=0;i<L;i++){var type_=(item=this.tokens[i]).type_;if(type_===TNUMBER)nstack.push(item);else if(type_===TVAR&&item.index_ in values)item=new Token(TNUMBER,0,0,values[item.index_]),nstack.push(item);else if(type_===TOP2&&nstack.length>1)n2=nstack.pop(),n1=nstack.pop(),f=this.ops2[item.index_],item=new Token(TNUMBER,0,0,f(n1.number_,n2.number_)),nstack.push(item);else if(type_===TOP1&&nstack.length>0)n1=nstack.pop(),f=this.ops1[item.index_],item=new Token(TNUMBER,0,0,f(n1.number_)),nstack.push(item);else{for(;nstack.length>0;)newexpression.push(nstack.shift());newexpression.push(item)}}for(;nstack.length>0;)newexpression.push(nstack.shift());return new Expression(newexpression,object(this.ops1),object(this.ops2),object(this.functions))},substitute:function(variable,expr){expr instanceof Expression||(expr=(new Parser).parse(String(expr)));var item,newexpression=[],L=this.tokens.length,i=0;for(i=0;i<L;i++){if((item=this.tokens[i]).type_===TVAR&&item.index_===variable)for(var j=0;j<expr.tokens.length;j++){var expritem=expr.tokens[j],replitem=new Token(expritem.type_,expritem.index_,expritem.prio_,expritem.number_);newexpression.push(replitem)}else newexpression.push(item)}return new Expression(newexpression,object(this.ops1),object(this.ops2),object(this.functions))},evaluate:function(values){values=values||{};var n1,n2,f,item,nstack=[],L=this.tokens.length,i=0;for(i=0;i<L;i++){var type_=(item=this.tokens[i]).type_;if(type_===TNUMBER)nstack.push(item.number_);else if(type_===TOP2)n2=nstack.pop(),n1=nstack.pop(),f=this.ops2[item.index_],nstack.push(f(n1,n2));else if(type_===TVAR)if(item.index_ in values)nstack.push(values[item.index_]);else{if(!(item.index_ in this.functions))throw new Error("undefined variable: "+item.index_);nstack.push(this.functions[item.index_])}else if(type_===TOP1)n1=nstack.pop(),f=this.ops1[item.index_],nstack.push(f(n1));else{if(type_!==TFUNCALL)throw new Error("invalid Expression");if(n1=nstack.pop(),!(f=nstack.pop()).apply||!f.call)throw new Error(f+" is not a function");"[object Array]"==Object.prototype.toString.call(n1)?nstack.push(f.apply(void 0,n1)):nstack.push(f.call(void 0,n1))}}if(nstack.length>1)throw new Error("invalid Expression (parity)");return nstack[0]},toString:function(toJS){var n1,n2,f,item,v,nstack=[],L=this.tokens.length,i=0;for(i=0;i<L;i++){var type_=(item=this.tokens[i]).type_;if(type_===TNUMBER)nstack.push("string"==typeof(v=item.number_)?(escapable.lastIndex=0,escapable.test(v)?"'"+v.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+v+"'"):v);else if(type_===TOP2)n2=nstack.pop(),n1=nstack.pop(),f=item.index_,toJS&&"^"==f?nstack.push("Math.pow("+n1+","+n2+")"):nstack.push("("+n1+f+n2+")");else if(type_===TVAR)nstack.push(item.index_);else if(type_===TOP1)n1=nstack.pop(),"-"===(f=item.index_)?nstack.push("("+f+n1+")"):nstack.push(f+"("+n1+")");else{if(type_!==TFUNCALL)throw new Error("invalid Expression");n1=nstack.pop(),f=nstack.pop(),nstack.push(f+"("+n1+")")}}if(nstack.length>1)throw new Error("invalid Expression (parity)");return nstack[0]},variables:function(){for(var L=this.tokens.length,vars=[],i=0;i<L;i++){var item=this.tokens[i];item.type_===TVAR&&-1==vars.indexOf(item.index_)&&vars.push(item.index_)}return vars},toJSFunction:function(param,variables){return new Function(param,"with(Parser.values) { return "+this.simplify(variables).toString(!0)+"; }")}},Parser.parse=function(expr){return(new Parser).parse(expr)},Parser.evaluate=function(expr,variables){return Parser.parse(expr).evaluate(variables)},Parser.Expression=Expression,Parser.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:random,fac:fac,exp:Math.exp,min:Math.min,max:Math.max,pyt:pyt,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI};return Parser.prototype={parse:function(expr){this.errormsg="",this.success=!0;var operstack=[],tokenstack=[];this.tmpprio=0;var expected=77,noperators=0;for(this.expression=expr,this.pos=0;this.pos<this.expression.length;)if(this.isOperator())this.isSign()&&64&expected?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",noperators++,this.addfunc(tokenstack,operstack,TOP1)),expected=77):this.isComment()||(0==(2&expected)&&this.error_parsing(this.pos,"unexpected operator"),noperators+=2,this.addfunc(tokenstack,operstack,TOP2),expected=77);else if(this.isNumber()){0==(1&expected)&&this.error_parsing(this.pos,"unexpected number");var token=new Token(TNUMBER,0,0,this.tokennumber);tokenstack.push(token),expected=50}else if(this.isString()){0==(1&expected)&&this.error_parsing(this.pos,"unexpected string");token=new Token(TNUMBER,0,0,this.tokennumber);tokenstack.push(token),expected=50}else if(this.isLeftParenth())0==(8&expected)&&this.error_parsing(this.pos,'unexpected "("'),128&expected&&(noperators+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(tokenstack,operstack,TFUNCALL)),expected=333;else if(this.isRightParenth()){if(256&expected){token=new Token(TNUMBER,0,0,[]);tokenstack.push(token)}else 0==(16&expected)&&this.error_parsing(this.pos,'unexpected ")"');expected=186}else if(this.isComma())0==(32&expected)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(tokenstack,operstack,TOP2),noperators+=2,expected=77;else if(this.isConst()){0==(1&expected)&&this.error_parsing(this.pos,"unexpected constant");var consttoken=new Token(TNUMBER,0,0,this.tokennumber);tokenstack.push(consttoken),expected=50}else if(this.isOp2())0==(4&expected)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(tokenstack,operstack,TOP2),noperators+=2,expected=8;else if(this.isOp1())0==(4&expected)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(tokenstack,operstack,TOP1),noperators++,expected=8;else if(this.isVar()){0==(1&expected)&&this.error_parsing(this.pos,"unexpected variable");var vartoken=new Token(TVAR,this.tokenindex,0,0);tokenstack.push(vartoken),expected=186}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');operstack.length>0;){var tmp=operstack.pop();tokenstack.push(tmp)}return noperators+1!==tokenstack.length&&this.error_parsing(this.pos,"parity"),new Expression(tokenstack,object(this.ops1),object(this.ops2),object(this.functions))},evaluate:function(expr,variables){return this.parse(expr).evaluate(variables)},error_parsing:function(column,msg){throw this.success=!1,this.errormsg="parse error [column "+column+"]: "+msg,new Error(this.errormsg)},addfunc:function(tokenstack,operstack,type_){for(var operator=new Token(type_,this.tokenindex,this.tokenprio+this.tmpprio,0);operstack.length>0&&operator.prio_<=operstack[operstack.length-1].prio_;)tokenstack.push(operstack.pop());operstack.push(operator)},isNumber:function(){for(var r=!1,str="";this.pos<this.expression.length;){var code=this.expression.charCodeAt(this.pos);if(!(code>=48&&code<=57||46===code))break;str+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(str),r=!0}return r},unescape:function(v,pos){for(var buffer=[],escaping=!1,i=0;i<v.length;i++){var c=v.charAt(i);if(escaping){switch(c){case"'":buffer.push("'");break;case"\\":buffer.push("\\");break;case"/":buffer.push("/");break;case"b":buffer.push("\b");break;case"f":buffer.push("\f");break;case"n":buffer.push("\n");break;case"r":buffer.push("\r");break;case"t":buffer.push("\t");break;case"u":var codePoint=parseInt(v.substring(i+1,i+5),16);buffer.push(String.fromCharCode(codePoint)),i+=4;break;default:throw this.error_parsing(pos+i,"Illegal escape sequence: '\\"+c+"'")}escaping=!1}else"\\"==c?escaping=!0:buffer.push(c)}return buffer.join("")},isString:function(){var r=!1,str="",startpos=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){if("'"==this.expression.charAt(this.pos)&&"\\"!=str.slice(-1)){this.pos++,this.tokennumber=this.unescape(str,startpos),r=!0;break}str+=this.expression.charAt(this.pos),this.pos++}return r},isConst:function(){for(var i in this.consts){var L=i.length;if(i===this.expression.substr(this.pos,L))return this.tokennumber=this.consts[i],this.pos+=L,!0}return!1},isOperator:function(){var code=this.expression.charCodeAt(this.pos);if(43===code)this.tokenprio=0,this.tokenindex="+";else if(45===code)this.tokenprio=0,this.tokenindex="-";else if(124===code){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(42===code)this.tokenprio=1,this.tokenindex="*";else if(47===code)this.tokenprio=2,this.tokenindex="/";else if(37===code)this.tokenprio=2,this.tokenindex="%";else{if(94!==code)return!1;this.tokenprio=3,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var code=this.expression.charCodeAt(this.pos-1);return 45===code||43===code},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var code=this.expression.charCodeAt(this.pos);return(32===code||9===code||10===code||13===code)&&(this.pos++,!0)},isOp1:function(){for(var str="",i=this.pos;i<this.expression.length;i++){var c=this.expression.charAt(i);if(c.toUpperCase()===c.toLowerCase()&&(i===this.pos||"_"!=c&&(c<"0"||c>"9")))break;str+=c}return str.length>0&&str in this.ops1&&(this.tokenindex=str,this.tokenprio=5,this.pos+=str.length,!0)},isOp2:function(){for(var str="",i=this.pos;i<this.expression.length;i++){var c=this.expression.charAt(i);if(c.toUpperCase()===c.toLowerCase()&&(i===this.pos||"_"!=c&&(c<"0"||c>"9")))break;str+=c}return str.length>0&&str in this.ops2&&(this.tokenindex=str,this.tokenprio=5,this.pos+=str.length,!0)},isVar:function(){for(var str="",i=this.pos;i<this.expression.length;i++){var c=this.expression.charAt(i);if(c.toUpperCase()===c.toLowerCase()&&(i===this.pos||"_"!=c&&(c<"0"||c>"9")))break;str+=c}return str.length>0&&(this.tokenindex=str,this.tokenprio=4,this.pos+=str.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},scope.Parser=Parser,Parser}("undefined"==typeof exports?{}:exports),saveAs=saveAs||function(view){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var get_URL=function(){return view.URL||view.webkitURL||view},save_link=view.document.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link="download"in save_link,is_safari=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex},0)},fs_min_size=0,revoke=function(file){var revoker=function(){"string"==typeof file?get_URL().revokeObjectURL(file):file.remove()};view.chrome?revoker():setTimeout(revoker,500)},dispatch=function(filesaver,event_types,event){for(var i=(event_types=[].concat(event_types)).length;i--;){var listener=filesaver["on"+event_types[i]];if("function"==typeof listener)try{listener.call(filesaver,event||filesaver)}catch(ex){throw_outside(ex)}}},auto_bom=function(blob){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)?new Blob(["\ufeff",blob],{type:blob.type}):blob},FileSaver=function(blob,name,no_auto_bom){no_auto_bom||(blob=auto_bom(blob));var object_url,target_view,slice,filesaver=this,type=blob.type,blob_changed=!1,dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "))},fs_error=function(){if(target_view&&is_safari&&"undefined"!=typeof FileReader){var reader=new FileReader;return reader.onloadend=function(){var base64Data=reader.result;target_view.location.href="data:attachment/file"+base64Data.slice(base64Data.search(/[,;]/)),filesaver.readyState=filesaver.DONE,dispatch_all()},reader.readAsDataURL(blob),void(filesaver.readyState=filesaver.INIT)}(!blob_changed&&object_url||(object_url=get_URL().createObjectURL(blob)),target_view)?target_view.location.href=object_url:void 0==view.open(object_url,"_blank")&&is_safari&&(view.location.href=object_url);filesaver.readyState=filesaver.DONE,dispatch_all(),revoke(object_url)},abortable=function(func){return function(){if(filesaver.readyState!==filesaver.DONE)return func.apply(this,arguments)}},create_if_not_found={create:!0,exclusive:!1};if(filesaver.readyState=filesaver.INIT,name||(name="download"),can_use_save_link)return object_url=get_URL().createObjectURL(blob),void setTimeout(function(){var node,event;save_link.href=object_url,save_link.download=name,node=save_link,event=new MouseEvent("click"),node.dispatchEvent(event),dispatch_all(),revoke(object_url),filesaver.readyState=filesaver.DONE});view.chrome&&type&&"application/octet-stream"!==type&&(slice=blob.slice||blob.webkitSlice,blob=slice.call(blob,0,blob.size,"application/octet-stream"),blob_changed=!0),webkit_req_fs&&"download"!==name&&(name+=".download"),("application/octet-stream"===type||webkit_req_fs)&&(target_view=view),req_fs?(fs_min_size+=blob.size,req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL(),filesaver.readyState=filesaver.DONE,dispatch(filesaver,"writeend",event),revoke(file)},writer.onerror=function(){var error=writer.error;error.code!==error.ABORT_ERR&&fs_error()},"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event]}),writer.write(blob),filesaver.abort=function(){writer.abort(),filesaver.readyState=filesaver.DONE},filesaver.readyState=filesaver.WRITING}),fs_error)}),fs_error)};dir.getFile(name,{create:!1},abortable(function(file){file.remove(),save()}),abortable(function(ex){ex.code===ex.NOT_FOUND_ERR?save():fs_error()}))}),fs_error)}),fs_error)):fs_error()},FS_proto=FileSaver.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(blob,name,no_auto_bom){return no_auto_bom||(blob=auto_bom(blob)),navigator.msSaveOrOpenBlob(blob,name||"download")}:(FS_proto.abort=function(){this.readyState=this.DONE,dispatch(this,"abort")},FS_proto.readyState=FS_proto.INIT=0,FS_proto.WRITING=1,FS_proto.DONE=2,FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null,function(blob,name,no_auto_bom){return new FileSaver(blob,name,no_auto_bom)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),function(view){"use strict";if(view.URL=view.URL||view.webkitURL,view.Blob&&view.URL)try{return void new Blob}catch(e){}var BlobBuilder=view.BlobBuilder||view.WebKitBlobBuilder||view.MozBlobBuilder||function(view){var get_class=function(object){return Object.prototype.toString.call(object).match(/^\[object\s(.*)\]$/)[1]},FakeBlobBuilder=function(){this.data=[]},FakeBlob=function(data,type,encoding){this.data=data,this.size=data.length,this.type=type,this.encoding=encoding},FBB_proto=FakeBlobBuilder.prototype,FB_proto=FakeBlob.prototype,FileReaderSync=view.FileReaderSync,FileException=function(type){this.code=this[this.name=type]},file_ex_codes="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),file_ex_code=file_ex_codes.length,real_URL=view.URL||view.webkitURL||view,real_create_object_URL=real_URL.createObjectURL,real_revoke_object_URL=real_URL.revokeObjectURL,URL=real_URL,btoa=view.btoa,atob=view.atob,ArrayBuffer=view.ArrayBuffer,Uint8Array=view.Uint8Array,origin=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(FakeBlob.fake=FB_proto.fake=!0;file_ex_code--;)FileException.prototype[file_ex_codes[file_ex_code]]=file_ex_code+1;return real_URL.createObjectURL||(URL=view.URL=function(uri){var uri_origin,uri_info=document.createElementNS("http://www.w3.org/1999/xhtml","a");return uri_info.href=uri,"origin"in uri_info||("data:"===uri_info.protocol.toLowerCase()?uri_info.origin=null:(uri_origin=uri.match(origin),uri_info.origin=uri_origin&&uri_origin[1])),uri_info}),URL.createObjectURL=function(blob){var data_URI_header,type=blob.type;return null===type&&(type="application/octet-stream"),blob instanceof FakeBlob?(data_URI_header="data:"+type,"base64"===blob.encoding?data_URI_header+";base64,"+blob.data:"URI"===blob.encoding?data_URI_header+","+decodeURIComponent(blob.data):btoa?data_URI_header+";base64,"+btoa(blob.data):data_URI_header+","+encodeURIComponent(blob.data)):real_create_object_URL?real_create_object_URL.call(real_URL,blob):void 0},URL.revokeObjectURL=function(object_URL){"data:"!==object_URL.substring(0,5)&&real_revoke_object_URL&&real_revoke_object_URL.call(real_URL,object_URL)},FBB_proto.append=function(data){var bb=this.data;if(Uint8Array&&(data instanceof ArrayBuffer||data instanceof Uint8Array)){for(var str="",buf=new Uint8Array(data),i=0,buf_len=buf.length;i<buf_len;i++)str+=String.fromCharCode(buf[i]);bb.push(str)}else if("Blob"===get_class(data)||"File"===get_class(data)){if(!FileReaderSync)throw new FileException("NOT_READABLE_ERR");var fr=new FileReaderSync;bb.push(fr.readAsBinaryString(data))}else data instanceof FakeBlob?"base64"===data.encoding&&atob?bb.push(atob(data.data)):"URI"===data.encoding?bb.push(decodeURIComponent(data.data)):"raw"===data.encoding&&bb.push(data.data):("string"!=typeof data&&(data+=""),bb.push(unescape(encodeURIComponent(data))))},FBB_proto.getBlob=function(type){return arguments.length||(type=null),new FakeBlob(this.data.join(""),type,"raw")},FBB_proto.toString=function(){return"[object BlobBuilder]"},FB_proto.slice=function(start,end,type){var args=arguments.length;return args<3&&(type=null),new FakeBlob(this.data.slice(start,args>1?end:this.data.length),type,this.encoding)},FB_proto.toString=function(){return"[object Blob]"},FB_proto.close=function(){this.size=0,delete this.data},FakeBlobBuilder}(view);view.Blob=function(blobParts,options){var type=options&&options.type||"",builder=new BlobBuilder;if(blobParts)for(var i=0,len=blobParts.length;i<len;i++)Uint8Array&&blobParts[i]instanceof Uint8Array?builder.append(blobParts[i].buffer):builder.append(blobParts[i]);var blob=builder.getBlob(type);return!blob.slice&&blob.webkitSlice&&(blob.slice=blob.webkitSlice),blob};var getPrototypeOf=Object.getPrototypeOf||function(object){return object.__proto__};view.Blob.prototype=getPrototypeOf(new view.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),function(view){"use strict";var base64_ranks,Uint8Array=view.Uint8Array,HTMLCanvasElement=view.HTMLCanvasElement,canvas_proto=HTMLCanvasElement&&HTMLCanvasElement.prototype,is_base64_regex=/\s*;\s*base64\s*(?:;|$)/i,to_data_url="toDataURL";Uint8Array&&(base64_ranks=new Uint8Array([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),HTMLCanvasElement&&!canvas_proto.toBlob&&(canvas_proto.toBlob=function(callback,type){if(type||(type="image/png"),this.mozGetAsFile)callback(this.mozGetAsFile("canvas",type));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(type))callback(this.msToBlob());else{var blob,args=Array.prototype.slice.call(arguments,1),dataURI=this[to_data_url].apply(this,args),header_end=dataURI.indexOf(","),data=dataURI.substring(header_end+1),is_base64=is_base64_regex.test(dataURI.substring(0,header_end));Blob.fake?((blob=new Blob).encoding=is_base64?"base64":"URI",blob.data=data,blob.size=data.length):Uint8Array&&(blob=is_base64?new Blob([function(base64){for(var rank,code,len=base64.length,buffer=new Uint8Array(len/4*3|0),i=0,outptr=0,last=[0,0],state=0,save=0;len--;)code=base64.charCodeAt(i++),255!==(rank=base64_ranks[code-43])&&void 0!==rank&&(last[1]=last[0],last[0]=code,save=save<<6|rank,4==++state&&(buffer[outptr++]=save>>>16,61!==last[1]&&(buffer[outptr++]=save>>>8),61!==last[0]&&(buffer[outptr++]=save),state=0));return buffer}(data)],{type:type}):new Blob([decodeURIComponent(data)],{type:type})),callback(blob)}},canvas_proto.toDataURLHD?canvas_proto.toBlobHD=function(){to_data_url="toDataURLHD";var blob=this.toBlob();return to_data_url="toDataURL",blob}:canvas_proto.toBlobHD=canvas_proto.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var colorbrewer={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}};if(function($){$.fn.drag=function(str,arg,opts){var type="string"==typeof str?str:"",fn=$.isFunction(str)?str:$.isFunction(arg)?arg:null;return 0!==type.indexOf("drag")&&(type="drag"+type),opts=(str==fn?arg:opts)||{},fn?this.bind(type,opts,fn):this.trigger(type)};var $event=$.event,$special=$event.special,drag=$special.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(obj){var data=$.data(this,drag.datakey),opts=obj.data||{};data.related+=1,$.each(drag.defaults,function(key,def){void 0!==opts[key]&&(data[key]=opts[key])})},remove:function(){$.data(this,drag.datakey).related-=1},setup:function(){if(!$.data(this,drag.datakey)){var data=$.extend({related:0},drag.defaults);$.data(this,drag.datakey,data),$event.add(this,"touchstart mousedown",drag.init,data),this.attachEvent&&this.attachEvent("ondragstart",drag.dontstart)}},teardown:function(){($.data(this,drag.datakey)||{}).related||($.removeData(this,drag.datakey),$event.remove(this,"touchstart mousedown",drag.init),drag.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",drag.dontstart))},init:function(event){if(!drag.touched){var results,dd=event.data;if(!(0!=event.which&&dd.which>0&&event.which!=dd.which)&&!$(event.target).is(dd.not)&&(!dd.handle||$(event.target).closest(dd.handle,event.currentTarget).length)&&(drag.touched="touchstart"==event.type?this:null,dd.propagates=1,dd.mousedown=this,dd.interactions=[drag.interaction(this,dd)],dd.target=event.target,dd.pageX=event.pageX,dd.pageY=event.pageY,dd.dragging=null,results=drag.hijack(event,"draginit",dd),dd.propagates))return(results=drag.flatten(results))&&results.length&&(dd.interactions=[],$.each(results,function(){dd.interactions.push(drag.interaction(this,dd))})),dd.propagates=dd.interactions.length,!1!==dd.drop&&$special.drop&&$special.drop.handler(event,dd),drag.textselect(!1),drag.touched?$event.add(drag.touched,"touchmove touchend",drag.handler,dd):$event.add(document,"mousemove mouseup",drag.handler,dd),!(!drag.touched||dd.live)&&void 0}},interaction:function(elem,dd){var offset=$(elem)[dd.relative?"position":"offset"]()||{top:0,left:0};return{drag:elem,callback:new drag.callback,droppable:[],offset:offset}},handler:function(event){var dd=event.data;switch(event.type){case!dd.dragging&&"touchmove":event.preventDefault();case!dd.dragging&&"mousemove":if(Math.pow(event.pageX-dd.pageX,2)+Math.pow(event.pageY-dd.pageY,2)<Math.pow(dd.distance,2))break;event.target=dd.target,drag.hijack(event,"dragstart",dd),dd.propagates&&(dd.dragging=!0);case"touchmove":event.preventDefault();case"mousemove":if(dd.dragging){if(drag.hijack(event,"drag",dd),dd.propagates){!1!==dd.drop&&$special.drop&&$special.drop.handler(event,dd);break}event.type="mouseup"}case"touchend":case"mouseup":default:drag.touched?$event.remove(drag.touched,"touchmove touchend",drag.handler):$event.remove(document,"mousemove mouseup",drag.handler),dd.dragging&&(!1!==dd.drop&&$special.drop&&$special.drop.handler(event,dd),drag.hijack(event,"dragend",dd)),drag.textselect(!0),!1===dd.click&&dd.dragging&&$.data(dd.mousedown,"suppress.click",(new Date).getTime()+5),dd.dragging=drag.touched=!1}},hijack:function(event,type,dd,x,elem){if(dd){var result,ia,callback,orig={event:event.originalEvent,type:event.type},mode=type.indexOf("drop")?"drag":"drop",i=x||0,len=isNaN(x)?dd.interactions.length:x;event.type=type,event.originalEvent=null,dd.results=[];do{if(ia=dd.interactions[i]){if("dragend"!==type&&ia.cancelled)continue;callback=drag.properties(event,dd,ia),ia.results=[],$(elem||ia[mode]||dd.droppable).each(function(p,subject){if(callback.target=subject,event.isPropagationStopped=function(){return!1},!1===(result=subject?$event.dispatch.call(subject,event,callback):null)?("drag"==mode&&(ia.cancelled=!0,dd.propagates-=1),"drop"==type&&(ia[mode][p]=null)):"dropinit"==type&&ia.droppable.push(drag.element(result)||subject),"dragstart"==type&&(ia.proxy=$(drag.element(result)||ia.drag)[0]),ia.results.push(result),delete event.result,"dropinit"!==type)return result}),dd.results[i]=drag.flatten(ia.results),"dropinit"==type&&(ia.droppable=drag.flatten(ia.droppable)),"dragstart"!=type||ia.cancelled||callback.update()}}while(++i<len);return event.type=orig.type,event.originalEvent=orig.event,drag.flatten(dd.results)}},properties:function(event,dd,ia){var obj=ia.callback;return obj.drag=ia.drag,obj.proxy=ia.proxy||ia.drag,obj.startX=dd.pageX,obj.startY=dd.pageY,obj.deltaX=event.pageX-dd.pageX,obj.deltaY=event.pageY-dd.pageY,obj.originalX=ia.offset.left,obj.originalY=ia.offset.top,obj.offsetX=obj.originalX+obj.deltaX,obj.offsetY=obj.originalY+obj.deltaY,obj.drop=drag.flatten((ia.drop||[]).slice()),obj.available=drag.flatten((ia.droppable||[]).slice()),obj},element:function(arg){if(arg&&(arg.jquery||1==arg.nodeType))return arg},flatten:function(arr){return $.map(arr,function(member){return member&&member.jquery?$.makeArray(member):member&&member.length?drag.flatten(member):member})},textselect:function(bool){$(document)[bool?"unbind":"bind"]("selectstart",drag.dontstart).css("MozUserSelect",bool?"":"none"),document.unselectable=bool?"off":"on"},dontstart:function(){return!1},callback:function(){}};drag.callback.prototype={update:function(){$special.drop&&this.available.length&&$.each(this.available,function(i){$special.drop.locate(this,i)})}};var $dispatch=$event.dispatch;$event.dispatch=function(event){if(!($.data(this,"suppress."+event.type)-(new Date).getTime()>0))return $dispatch.apply(this,arguments);$.removeData(this,"suppress."+event.type)};var touchHooks=$event.fixHooks.touchstart=$event.fixHooks.touchmove=$event.fixHooks.touchend=$event.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(event,orig){if(orig){var touched=orig.touches&&orig.touches[0]||orig.changedTouches&&orig.changedTouches[0]||null;touched&&$.each(touchHooks.props,function(i,prop){event[prop]=touched[prop]})}return event}};$special.draginit=$special.dragstart=$special.dragend=drag}(jQuery),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Clipboard=t()}}(function(){return function t(e,n,o){function i(c,a){if(!n[c]){if(!e[c]){var s="function"==typeof require&&require;if(!a&&s)return s(c,!0);if(r)return r(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[c]={exports:{}};e[c][0].call(u.exports,function(t){var n=e[c][1][t];return i(n||t)},u,u.exports,t,e,n,o)}return n[c].exports}for(var r="function"==typeof require&&require,c=0;c<o.length;c++)i(o[c]);return i}({1:[function(t,e,n){var o=t("matches-selector");e.exports=function(t,e,n){for(var i=n?t:t.parentNode;i&&i!==document;){if(o(i,e))return i;i=i.parentNode}}},{"matches-selector":5}],2:[function(t,e,n){function i(t,e,n,o){return function(n){n.delegateTarget=r(n.target,e,!0),n.delegateTarget&&o.call(t,n)}}var r=t("closest");e.exports=function(t,e,n,o,r){var c=i.apply(this,arguments);return t.addEventListener(n,c,r),{destroy:function(){t.removeEventListener(n,c,r)}}}},{closest:1}],3:[function(t,e,n){n.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},n.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===e||"[object HTMLCollection]"===e)&&"length"in t&&(0===t.length||n.node(t[0]))},n.string=function(t){return"string"==typeof t||t instanceof String},n.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},{}],4:[function(t,e,n){var a=t("./is"),s=t("delegate");e.exports=function(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!a.string(e))throw new TypeError("Second argument must be a String");if(!a.fn(n))throw new TypeError("Third argument must be a Function");if(a.node(t))return function(t,e,n){return t.addEventListener(e,n),{destroy:function(){t.removeEventListener(e,n)}}}(t,e,n);if(a.nodeList(t))return function(t,e,n){return Array.prototype.forEach.call(t,function(t){t.addEventListener(e,n)}),{destroy:function(){Array.prototype.forEach.call(t,function(t){t.removeEventListener(e,n)})}}}(t,e,n);if(a.string(t))return function(t,e,n){return s(document.body,t,e,n)}(t,e,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},{"./is":3,delegate:2}],5:[function(t,e,n){var i=Element.prototype,r=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;e.exports=function(t,e){if(r)return r.call(t,e);for(var n=t.parentNode.querySelectorAll(e),o=0;o<n.length;++o)if(n[o]==t)return!0;return!1}},{}],6:[function(t,e,n){e.exports=function(t){var e;if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName)t.focus(),t.setSelectionRange(0,t.value.length),e=t.value;else{t.hasAttribute("contenteditable")&&t.focus();var n=window.getSelection(),o=document.createRange();o.selectNodeContents(t),n.removeAllRanges(),n.addRange(o),e=n.toString()}return e}},{}],7:[function(t,e,n){function o(){}o.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function o(){i.off(t,o),e.apply(n,arguments)}var i=this;return o._=e,this.on(t,o,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,i=n.length;i>o;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],i=[];if(o&&e)for(var r=0,c=o.length;c>r;r++)o[r].fn!==e&&o[r].fn._!==e&&i.push(o[r]);return i.length?n[t]=i:delete n[t],this}},e.exports=o},{}],8:[function(e,n,o){!function(i,r){if(void 0!==o)r(n,e("select"));else{var c={exports:{}};r(c,i.select),i.clipboardAction=c.exports}}(this,function(t,e){"use strict";var i=function(t){return t&&t.__esModule?t:{default:t}}(e),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),a=function(){function t(e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.resolveOptions(e),this.initSelection()}return t.prototype.resolveOptions=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""},t.prototype.initSelection=function(){this.text?this.selectFake():this.target&&this.selectTarget()},t.prototype.selectFake=function(){var e=this,n="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return e.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="fixed",this.fakeElem.style[n?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()},t.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},t.prototype.selectTarget=function(){this.selectedText=(0,i.default)(this.target),this.copyText()},t.prototype.copyText=function(){var e=void 0;try{e=document.execCommand(this.action)}catch(n){e=!1}this.handleResult(e)},t.prototype.handleResult=function(e){e?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},t.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},t.prototype.destroy=function(){this.removeFake()},c(t,[{key:"action",set:function(){var e=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":r(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),t}();t.exports=a})},{select:6}],9:[function(e,n,o){!function(i,r){if(void 0!==o)r(n,e("./clipboard-action"),e("tiny-emitter"),e("good-listener"));else{var c={exports:{}};r(c,i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=c.exports}}(this,function(t,e,n,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function s(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}var l=i(e),u=i(n),f=i(o),d=function(t){function e(n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return i.resolveOptions(o),i.listenClick(n),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.resolveOptions=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText},e.prototype.listenClick=function(e){var n=this;this.listener=(0,f.default)(e,"click",function(t){return n.onClick(t)})},e.prototype.onClick=function(e){var n=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new l.default({action:this.action(n),target:this.target(n),text:this.text(n),trigger:n,emitter:this})},e.prototype.defaultAction=function(e){return s("action",e)},e.prototype.defaultTarget=function(e){var n=s("target",e);return n?document.querySelector(n):void 0},e.prototype.defaultText=function(e){return s("text",e)},e.prototype.destroy=function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},e}(u.default);t.exports=d})},{"./clipboard-action":8,"good-listener":4,"tiny-emitter":7}]},{},[9])(9)}),function(global){"use strict";var morpheus=void 0!==morpheus?morpheus:{};"undefined"!=typeof module&&module.exports?module.exports=morpheus:"function"==typeof define&&define.amd?define(function(){return morpheus}):global.morpheus=morpheus,morpheus.Util=function(){},morpheus.Util.isNode=function(){return!1},morpheus.Util.RIGHT_ARROW=String.fromCharCode(8594),morpheus.Util.extend=function(c1,c2){for(var key in c2.prototype)key in c1.prototype||(c1.prototype[key]=c2.prototype[key])},morpheus.Util.isFetchStreamingSupported=function(){return"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Chrome")},morpheus.Util.viewPortSize=function(){return window.getComputedStyle(document.body,":before").content.replace(/"/g,"")},morpheus.Util.TRACKING_ENABLED=!0,morpheus.Util.TRACKING_CODE_LOADED=!1,morpheus.Util.loadTrackingCode=function(){if(morpheus.Util.TRACKING_ENABLED&&"undefined"!=typeof window&&"undefined"!=typeof navigator&&navigator.onLine){if(morpheus.Util.TRACKING_CODE_LOADED)return;"undefined"==typeof ga&&(morpheus.Util.TRACKING_CODE_LOADED=!0,i=window,s=document,o="script",r="ga",i.GoogleAnalyticsObject=r,i.ga=i.ga||function(){(i.ga.q=i.ga.q||[]).push(arguments)},i.ga.l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src="https://www.google-analytics.com/analytics.js",m.parentNode.insertBefore(a,m)),"undefined"!=typeof ga&&(ga("create","UA-53973555-1","auto","morpheus"),ga("morpheus.send","pageview")),morpheus.Util.TRACKING_CODE_LOADED=!0}var i,s,o,r,a,m},morpheus.Util.measureScrollbar=function(){var $c=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),dim={width:Math.max(0,$c.width()-$c[0].clientWidth),height:$c.height()-$c[0].clientHeight};return $c.remove(),dim},morpheus.Util.trackEvent=function(options){"undefined"!=typeof window&&(morpheus.Util.TRACKING_CODE_LOADED||morpheus.Util.loadTrackingCode(),morpheus.Util.TRACKING_CODE_LOADED&&"undefined"!=typeof ga&&ga("morpheus.send",{hitType:"event",eventCategory:options.eventCategory,eventAction:options.eventAction,eventLabel:options.eventLabel}))},morpheus.Util.isString=function(value){return"string"==typeof value||value instanceof String},morpheus.Util.getDataType=function(val){var dataType,isArray=morpheus.Util.isArray(val);return isArray&&val.length>0&&(val=val[0]),dataType=morpheus.Util.isString(val)?"string":_.isNumber(val)?"number":"object",isArray&&(dataType="["+dataType+"]"),dataType},morpheus.Util.isArray=function(array){for(var types=[Array,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],i=0,length=types.length;i<length;i++)if(array instanceof types[i])return!0;return!1},morpheus.Util.getWindowSearchObject=function(){var searchObject={},hashObject={};return window.location.search.length>0&&(searchObject=morpheus.Util.getQueryParams(window.location.search.substring(1))),window.location.hash.length>0&&(hashObject=morpheus.Util.getQueryParams(window.location.hash.substring(1))),_.extend(hashObject,searchObject)},morpheus.Util.copyString=function(s){return(" "+s).substr(1)},morpheus.Util.getQueryParams=function(s){var params={};if(!s)return params;for(var keyValuePairs=decodeURIComponent(s).split("&"),i=0;i<keyValuePairs.length;i++){var pair=keyValuePairs[i].split("=");if(null!=pair[1]&&""!==pair[1]){var array=params[pair[0]];void 0===array&&(array=[],params[pair[0]]=array),array.push(pair[1])}}return params},morpheus.Util.getScriptPath=function(name){name||(name="morpheus-latest.min.js");for(var scripts=document.getElementsByTagName("script"),i=scripts.length-1;i>=0;i--){var src=scripts[i].src,index=src.lastIndexOf("/");if(-1!==index&&(src=src.substring(index+1)),src===name)return scripts[i].src}return"morpheus-latest.min.js"===name?morpheus.Util.getScriptPath("morpheus.js"):scripts.length>0?scripts[0].src:""},morpheus.Util.forceDelete=function(obj){try{(ef=URL.createObjectURL(new Blob([""],{type:"text/javascript"})),w=new Worker(ef),URL.revokeObjectURL(ef),w).postMessage(obj,[obj])}catch(x){console.log("Unable to delete")}var ef,w},morpheus.Util.getFileName=function(fileOrUrl){if(morpheus.Util.isFile(fileOrUrl))return fileOrUrl.name;if(void 0!==fileOrUrl.name)return fileOrUrl.name;var name=""+fileOrUrl,question=name.indexOf("?");if(-1!==question)for(var params=name.substring(question+1),keyValuePairs=decodeURIComponent(params).split("&"),i=0;i<keyValuePairs.length;i++){var pair=keyValuePairs[i].split("=");if("file"===pair[0]||"name"===pair[0]){name=pair[1];break}}else{var slash=name.lastIndexOf("/");slash===name.length-1&&(slash=(name=name.substring(0,name.length-1)).lastIndexOf("/")),-1!==slash&&(name=name.substring(slash+1))}return name},morpheus.Util.prefixWithZero=function(value){return value<10?"0"+value:value},morpheus.Util.detectSeparator=function(line){for(var separators=["\t",","," "],separator=separators[0],headerLine=line.replace(/\s+$/,""),i=0;i<separators.length;i++){var sep=separators[i];if(headerLine.split(new RegExp(sep)).length>1){separator=sep;break}}return separator},morpheus.Util.getExtension=function(name){var dotIndex=(name=""+name).lastIndexOf(".");if(dotIndex>0){var suffix=name.substring(dotIndex+1).toLowerCase();if("txt"===suffix||"gz"===suffix||"tsv"===suffix||"csv"===suffix){var newPath=name.substring(0,dotIndex),secondDotIndex=newPath.lastIndexOf(".");if(secondDotIndex>0){var secondSuffix=newPath.substring(secondDotIndex+1,newPath.length).toLowerCase();if("segtab"===secondSuffix||"seg"===secondSuffix||"maf"===secondSuffix||"gct"===secondSuffix||"txt"===secondSuffix||"gmt"===secondSuffix)return secondSuffix}}return suffix}return""},morpheus.Util.getBaseFileName=function(name){var dotIndex=name.lastIndexOf(".");if(dotIndex>0){var suffix=name.substring(dotIndex+1,name.length);return"gz"===suffix||"zip"===suffix||"bz2"===suffix?morpheus.Util.getBaseFileName(name.substring(0,dotIndex)):name.substring(0,dotIndex)}return name},morpheus.Util.seq=function(length){for(var array=[],i=0;i<length;i++)array.push(i);return array},morpheus.Util.sequ32=function(length){for(var array=new Uint32Array(length),i=0;i<length;i++)array[i]=i;return array},morpheus.Util.paramsToObject=function(hash){var search=hash?window.location.hash:window.location.search;if(search.length<=1)return{};for(var keyValuePairs=(search=decodeURIComponent(search)).substring(1).split("&"),result={},i=0,length=keyValuePairs.length;i<length;i++){var pair=keyValuePairs[i].split("="),values=result[pair[0]];void 0===values&&(values=[],result[pair[0]]=values),values.push(pair[1])}return result},morpheus.Util.isHeadless=function(){return void 0===$.ui},morpheus.Util.isFile=function(f){return"undefined"!=typeof File&&f instanceof File},morpheus.Util.endsWith=function(string,suffix){return string.length>=suffix.length&&string.substr(string.length-suffix.length)===suffix},morpheus.Util.measureSvgText=function(text,classname){if(!text||0===text.length)return{height:0,width:0};var container=d3.select("body").append("svg");classname&&container.attr("class",classname),container.append("text").attr({x:-1e3,y:-1e3}).text(text);var bbox=container.node().getBBox();return container.remove(),{height:bbox.height,width:bbox.width}},morpheus.Util.IS_MAC=!1,"undefined"!=typeof navigator&&(morpheus.Util.IS_MAC=!!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)),morpheus.Util.COMMAND_KEY=morpheus.Util.IS_MAC?"&#8984;":"Ctrl+",morpheus.Util.SHIFT_KEY=morpheus.Util.IS_MAC?"&#8679;":"Shift+",morpheus.Util.hammer=function(el,recognizers){if("undefined"!=typeof Hammer){var hammer=new Hammer(el,{recognizers:[]});return-1!==_.indexOf(recognizers,"pan")?hammer.add(new Hammer.Pan({threshold:1,direction:Hammer.DIRECTION_ALL})):-1!==_.indexOf(recognizers,"panh")?hammer.add(new Hammer.Pan({threshold:1,direction:Hammer.DIRECTION_HORIZONTAL})):-1!==_.indexOf(recognizers,"panv")&&hammer.add(new Hammer.Pan({threshold:1,direction:Hammer.DIRECTION_VERTICAL})),-1!==_.indexOf(recognizers,"tap")&&hammer.add(new Hammer.Tap),-1!==_.indexOf(recognizers,"pinch")&&hammer.add(new Hammer.Pinch),-1!==_.indexOf(recognizers,"longpress")&&hammer.add(new Hammer.Press({event:"longpress",time:1e3})),-1!==_.indexOf(recognizers,"press")&&hammer.add(new Hammer.Press),-1!==_.indexOf(recognizers,"swipe")&&hammer.add(new Hammer.Swipe),hammer}return $()},morpheus.Util.createTextDecoder=function(){if("undefined"!=typeof TextDecoder){var textDecoder=new TextDecoder;return function(buf,start,end){return textDecoder.decode(buf.subarray(start,end))}}return function(buf,start,end){for(var s=[],i=start;i<end;i++)s.push(String.fromCharCode(buf[i]));return s.join("")}},morpheus.Util.autocompleteArrayMatcher=function(token,cb,array,fields,max){var filteredSet=new morpheus.Set,regex=new RegExp(morpheus.Util.escapeRegex(token),"i"),regexMatch=new RegExp("("+morpheus.Util.escapeRegex(token)+")","i");if(fields)for(var nfields=fields.length,i=0,n=array.length;i<n;i++){for(var item=array[i],j=0;j<nfields;j++){var value=item[fields[j]];if(regex.test(value)){filteredSet.add(value);break}}if(filteredSet.size()===max)break}else for(i=0,n=array.length;i<n;i++){value=array[i];if(regex.test(value)&&(filteredSet.add(value),filteredSet.size()===max))break}var matches=[];filteredSet.forEach(function(value){var quotedValue=value;-1!==quotedValue.indexOf(" ")&&(quotedValue='"'+quotedValue+'"'),matches.push({value:quotedValue,label:"<span>"+value.replace(regexMatch,"<b>$1</b>")+"</span>"})}),cb(matches)},morpheus.Util.setClipboardData=function(clipboardData,delay){var isRTL="rtl"==document.documentElement.getAttribute("dir"),fakeElem=document.createElement("div");fakeElem.contentEditable=!0,fakeElem.style.fontSize="12pt",fakeElem.style.border="0",fakeElem.style.padding="0",fakeElem.style.margin="0",fakeElem.style.position="absolute",fakeElem.style[isRTL?"right":"left"]="-999999px",fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",fakeElem.setAttribute("readonly","");var f=function(e){clipboardData.forEach(function(elem){e.clipboardData.setData(elem.format,elem.data)}),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),fakeElem.removeEventListener("copy",f)};fakeElem.addEventListener("copy",f),document.body.appendChild(fakeElem),fakeElem.focus();var selection=window.getSelection(),range=document.createRange();range.selectNodeContents(fakeElem),selection.removeAllRanges(),selection.addRange(range),delay?setTimeout(function(){document.execCommand("copy")||console.log("copy failed"),document.body.removeChild(fakeElem)},20):(document.execCommand("copy")||console.log("copy failed"),document.body.removeChild(fakeElem))},morpheus.Util.autosuggest=function(options){var searching=!1;function _select(event,ui,isKey){if(ui.item.skip)return!1;if(options.multi){var terms=morpheus.Util.getAutocompleteTokens(options.$el[0].value,{trim:!1,selectionStart:options.$el[0].selectionStart}),field=event.toElement&&event.toElement.dataset?event.toElement.dataset.autocomplete:null,value=field?ui.item[field]:ui.item.value,show=ui.item.show;return 0===terms.length?terms.push(value):ui.item.clear?terms=[value]:terms[-1===terms.selectionStartIndex||void 0===terms.selectionStartIndex?terms.length-1:terms.selectionStartIndex]=value,options.$el[0].value=terms.join(" "),(show&&!isKey||isKey&&13===event.which)&&(searching=!0,setTimeout(function(){options.$el.autocomplete("search",options.$el.val())},20),setTimeout(function(){searching=!1},100)),!isKey&&options.select&&options.select(),!1}!isKey&&options.select&&options.select(),isKey||13!==event.which||event.stopImmediatePropagation()}(options=$.extend({},{multi:!0,delay:500,minLength:0,suggestWhenEmpty:!0},options)).$el.on("keydown",function(event){event.keyCode===$.ui.keyCode.TAB&&$(this).data("ui-autocomplete").menu.active&&event.preventDefault()}).autocomplete({minLength:options.minLength,delay:options.delay,source:function(request,response){if(request.term.history&&options.history)return options.history(response);var terms=morpheus.Util.getAutocompleteTokens(request.term,{trim:!1,selectionStart:options.$el[0].selectionStart});void 0!==terms.selectionStartIndex&&-1!==terms.selectionStartIndex||(terms.selectionStartIndex=terms.length-1),(options.suggestWhenEmpty||terms.length>0)&&options.filter(terms,response)},focus:function(event,ui){for(var original=event.originalEvent;null!=original.originalEvent;)original=original.originalEvent;return!(!original||!/^key/.test(original.type))&&_select(original,ui,!0)},select:function(event,ui){return _select(event,ui,!1)}});var instance=options.$el.autocomplete("instance");null!=instance&&(instance._renderItem=function(ul,item){return null==item.value?$('<li class="'+(item.class?" "+item.class:"")+' search-category">').append($("<div>").html(item.label)).appendTo(ul):$('<li class="'+(item.class?" "+item.class:"")+' search-item">').append($("<div>").html(item.label)).appendTo(ul)},instance._normalize=function(items){return items},instance._resizeMenu=function(){this.menu.element.outerWidth(instance.element.outerWidth())});var menu=options.$el.autocomplete("widget");menu.menu("option","items","> :not(.search-category)"),menu&&menu.addClass("search-menu"),options.suggestWhenEmpty&&options.$el.on("focus",function(){options.$el.autocomplete("search",options.$el.val())}),options.$el.on("keyup",function(e){13!==e.which||searching?38===e.which&&options.history?options.$el.autocomplete("search",{history:!0}):options.suggestWhenEmpty&&""===options.$el.val()&&options.$el.autocomplete("search",""):options.$el.autocomplete("close")})},morpheus.Util.getAutocompleteTokens=function(text,options){if((options=$.extend({},{trim:!0},options)).trim&&(text=$.trim(text)),""===text)return[];for(var inQuote=!1,inParen=!1,tokens=[],currentToken=[],i=0,n=text.length;i<n;i++){var c=text[i];'"'===c?(inQuote=!inQuote,currentToken.push(c)):"("===c||")"===c?(inParen="("===c,currentToken.push(c)):" "!==c&&"\t"!==c||inQuote||inParen?currentToken.push(c):(tokens.push({s:currentToken.join(""),inSelectionStart:currentToken.inSelectionStart}),currentToken=[]),i===options.selectionStart-1&&(currentToken.inSelectionStart=!0)}tokens.push({s:currentToken.join(""),inSelectionStart:currentToken.inSelectionStart}),options.trim||inQuote||" "!==text[text.length-1]||tokens.push({s:" ",inSelectionStart:!1});for(var filteredTokens=[],selectionStartIndex=-1,ntokens=(i=0,tokens.length);i<ntokens;i++){var token=tokens[i],s=token.s;(options.trim||i<ntokens-1)&&(s=$.trim(s)),""!==s&&(token.inSelectionStart&&(selectionStartIndex=filteredTokens.length),filteredTokens.push(s))}return filteredTokens.selectionStartIndex=selectionStartIndex,filteredTokens},morpheus.Util.showDialog=function($el,title,options){var $dialog=$("<div></div>");$el.appendTo($dialog),$dialog.appendTo($(document.body)),options||(options={}),$dialog.dialog({width:670,height:590,title:title,close:function(event,ui){$dialog.remove(),options.close&&options.close()}})},morpheus.Util.sheetToArray=function(sheet,delim){for(var r=XLSX.utils.decode_range(sheet["!ref"]),rows=[],colors=[],header=[],C=r.s.c;C<=r.e.c;++C){var val=sheet[XLSX.utils.encode_cell({c:C,r:r.s.r})],txt=String(XLSX.utils.format_cell(val));header.push(txt)}for(var R=r.s.r;R<=r.e.r;++R){var row=[],isRowEmpty=!0;for(C=r.s.c;C<=r.e.c;++C){if(val=sheet[XLSX.utils.encode_cell({c:C,r:R})]){isRowEmpty=!1;txt=String(XLSX.utils.format_cell(val));if(null!=val.s&&null!=val.s.fgColor){var color="#"+val.s.fgColor.rgb;colors.push({header:header[row.length],color:color,value:txt})}row.push(txt)}else row.push("")}isRowEmpty||rows.push(delim?row.join(delim):row)}return rows.colors=colors,rows},morpheus.Util.linesToObjects=function(lines){for(var header=lines[0],array=[],nfields=header.length,i=1,length=lines.length;i<length;i++){for(var line=lines[i],obj={},f=0;f<nfields;f++){var value=line[f];obj[header[f]]=value}array.push(obj)}return array},morpheus.Util.xlsxTo2dArray=function(options,callback){var workbook=XLSX.read(options.data,{type:"binary",cellFormula:!1,cellHTML:!1,cellStyles:!0}),sheetNames=workbook.SheetNames;if(options.prompt&&sheetNames.length>1){var formBuilder=new morpheus.FormBuilder;formBuilder.append({name:"sheet",type:"bootstrap-select",options:sheetNames,required:!0,style:"max-width:100px;"}),morpheus.FormBuilder.showInModal({title:"Choose Sheet",html:formBuilder.$form,focus:document.activeElement,onClose:function(){var worksheet=workbook.Sheets[formBuilder.getValue("sheet")],lines=morpheus.Util.sheetToArray(worksheet);callback(null,lines)}})}else{var worksheet=workbook.Sheets[sheetNames[0]],lines=morpheus.Util.sheetToArray(worksheet);callback(null,lines)}},morpheus.Util.xlsxTo1dArray=function(options,callback){var workbook=XLSX.read(options.data,{type:"binary",cellFormula:!1,cellHTML:!1,cellStyles:!0}),sheetNames=workbook.SheetNames;if(options.prompt&&sheetNames.length>1){var formBuilder=new morpheus.FormBuilder;formBuilder.append({name:"sheet",type:"bootstrap-select",options:sheetNames,required:!0,style:"max-width:100px;"}),morpheus.FormBuilder.showOkCancel({title:"Choose Sheet",cancel:!1,focus:document.activeElement,content:formBuilder.$form,okCallback:function(){var worksheet=workbook.Sheets[formBuilder.getValue("sheet")];callback(null,morpheus.Util.sheetToArray(worksheet,"\t"))}})}else{var worksheet=workbook.Sheets[sheetNames[0]];callback(null,morpheus.Util.sheetToArray(worksheet,"\t"))}},morpheus.Util.getText=function(fileOrUrl){return new Promise(function(resolve,reject){if(morpheus.Util.isString(fileOrUrl))fetch(fileOrUrl).then(function(response){if(response.ok)return response.text();reject(response.status+" "+response.statusText)}).then(function(text){resolve(text)}).catch(function(err){reject(err)});else if(morpheus.Util.isFile(fileOrUrl)){var reader=new FileReader;reader.onload=function(event){resolve(event.target.result)},reader.readAsText(fileOrUrl)}else resolve(fileOrUrl)})},morpheus.Util.createOptions=function(values,none){var html=[];return none&&html.push('<option value="">(None)</option>'),_.each(values,function(val){html.push('<option value="'),html.push(val),html.push('">'),html.push(val),html.push("</option>")}),html.join("")},morpheus.Util.rankIndexArray=function(index){for(var rank=[],n=index.length,j=0;j<n;j++)rank[index[j]]=j+1;return rank},morpheus.Util.indexSort=function(array,ascending){for(var pairs=[],i=0,length=array.length;i<length;i++)pairs.push({value:array[i],index:i});return morpheus.Util.indexSortPairs(pairs,ascending)},morpheus.Util.indexSortPairs=function(array,ascending){ascending?array.sort(function(a,b){return a.value<b.value?-1:a.value===b.value&&a.index<b.index?-1:1}):array.sort(function(a,b){return a.value<b.value?1:a.value===b.value&&a.index<b.index?1:-1});var indices=[];return array.forEach(function(item){indices.push(item.index)}),indices},morpheus.Util.arrayEquals=function(array1,array2,comparator){if(array1==array2)return!0;if(null==array1||null==array2)return!1;comparator||(comparator=function(a,b){return a===b});var length=array1.length;if(array2.length!==length)return!1;for(var i=0;i<length;i++)if(!comparator(array1[i],array2[i]))return!1;return!0},morpheus.Util._intFormat="undefined"!=typeof d3?d3.format(",i"):function(d){return""+Math.round(d)},morpheus.Util.intFormat=function(n){return morpheus.Util._intFormat(n)},morpheus.Util._nf="undefined"!=typeof d3?d3.format(".2f"):function(d){return""+d},morpheus.Util.getNumberFormatPatternFractionDigits=function(pattern){return parseInt(pattern.substring(1,pattern.length-1))||0},morpheus.Util.nf=function(n){return morpheus.Util._nf(n)},morpheus.Util.createNumberFormat=function(pattern){var f=d3.format(pattern);return f.toJSON=function(){return{pattern:pattern}},f},morpheus.Util.wrapNumber=function(value,object){var n=new Number(value);return n.toObject=function(){return object},n},morpheus.Util.toString=function(value){return null==value?"":_.isNumber(value)?morpheus.Util.nf(value):morpheus.Util.isArray(value)?morpheus.Util.arrayToString(value,", "):""+value},morpheus.Util.arrayToString=function(value,sep){for(var s=[],i=0,length=value.length;i<length;i++){var val_i=value[i];_.isNumber(val_i)?s.push(morpheus.Util.nf(val_i)):s.push(""+val_i)}return s.join(sep)},morpheus.Util.removeTrailingZerosInFraction=function(str){var index=str.lastIndexOf(".");if(-1!==index){for(var len=str.length,zeros=len,i=len-1;i>index&&"0"==str[i];i--,zeros--);if(zeros===index+1)return str.substring(0,index);if(zeros<len)return str.substring(0,index)+str.substring(index,zeros)}return str},morpheus.Util.s=function(n){return 1===n?"":"s"},morpheus.Util.create2dArray=function(rows,columns){for(var array2d=[],i=0;i<rows;i++){for(var array=[],j=0;j<columns;j++)array[j]=NaN;array2d.push(array)}return array2d},morpheus.Util.escapeRegex=function(value){return value.replace(/[*]/g,".*").replace(/[-[\]{}()+?,\\^$|#\s]/g,"\\$&")},morpheus.Util.createSearchPredicates=function(options){var tokens=(options=$.extend({},{validateFieldNames:!0,caseSensitive:!0},options)).tokens;if(null==tokens)return[];var availableFields=options.fields;if(!options.caseSensitive&&null!=availableFields)for(var i=0;i<availableFields.length;i++)availableFields[i]=availableFields[i].toLowerCase();var validateFieldNames=options.validateFieldNames,fieldSearchEnabled=!validateFieldNames||null!=availableFields&&availableFields.length>0,fieldRegExp=/\\:/g,predicates=[],defaultIsExactMatch="exact"===options.defaultMatchMode;return tokens.forEach(function(token){var isNot=!1;"-"===token[0]&&(token=token.substring(1),isNot=!0);var predicate,field=null,semi=token.indexOf(":");if(semi>0)if(fieldSearchEnabled&&92!==token.charCodeAt(semi-1)){var possibleToken=$.trim(token.substring(semi+1)),possibleField=$.trim(token.substring(0,semi));possibleField.length>0&&'"'===possibleField[0]&&'"'===possibleField[possibleField.length-1]?possibleField=possibleField.substring(1,possibleField.length-1):possibleField.length>0&&'"'===possibleField[0]&&'"'===possibleToken[possibleToken.length-1]&&'"'!==possibleToken[0]&&(possibleField=possibleField.substring(1,possibleField.length),possibleToken='"'+possibleToken),validateFieldNames&&-1===availableFields.indexOf(options.caseSensitive?possibleField:possibleField.toLowerCase())||(token=possibleToken,field=possibleField)}else token=token.replace(fieldRegExp,":");for(var rangeIndex=-1,rangeToken=null,rangeIndicators=["..",">=",">","<=","<","="],i=0;i<rangeIndicators.length;i++)if(-1!==(rangeIndex=token.indexOf(rangeIndicators[i]))){rangeToken=rangeIndicators[i];break}if(-1!==rangeIndex)if(".."===rangeToken){var start=parseFloat(token.substring(0,rangeIndex)),end=parseFloat(token.substring(rangeIndex+2));isNaN(start)||isNaN(end)||(predicate=new morpheus.Util.NumberRangePredicate(field,start,end))}else if(">"===rangeToken){var val=parseFloat(token.substring(rangeIndex+1));isNaN(val)||(predicate=new morpheus.Util.GreaterThanPredicate(field,val))}else if(">="===rangeToken){val=parseFloat(token.substring(rangeIndex+2));isNaN(val)||(predicate=new morpheus.Util.GreaterThanOrEqualPredicate(field,val))}else if("<"===rangeToken){val=parseFloat(token.substring(rangeIndex+1));isNaN(val)||(predicate=new morpheus.Util.LessThanPredicate(field,val))}else if("<="===rangeToken){val=parseFloat(token.substring(rangeIndex+2));isNaN(val)||(predicate=new morpheus.Util.LessThanOrEqualPredicate(field,val))}else if("="===rangeToken){val=parseFloat(token.substring(rangeIndex+1));predicate=new morpheus.Util.EqualsPredicate(field,val)}else console.log("Unknown range token:"+rangeToken);else if('"'===token[0]&&'"'===token[token.length-1])token=token.substring(1,token.length-1),predicate=new morpheus.Util.ExactTermPredicate(field,token);else if("("===token[0]&&")"===token[token.length-1]){token=token.substring(1,token.length-1);var values=morpheus.Util.getAutocompleteTokens(token);values.length>0&&(predicate=new morpheus.Util.ExactTermsPredicate(field,values.map(function(val){return'"'===val[0]&&'"'===val[val.length-1]&&(val=val.substring(1,val.length-1)),val.toLowerCase()})))}else predicate=-1!==token.indexOf("*")?new morpheus.Util.RegexPredicate(field,token):defaultIsExactMatch?new morpheus.Util.ExactTermPredicate(field,token):new morpheus.Util.RegexPredicate(field,token);null!=predicate&&predicates.push(isNot?new morpheus.Util.NotPredicate(predicate):predicate)}),predicates},morpheus.Util.createRegExpStringToMatchText=function(text){var tokens=morpheus.Util.getAutocompleteTokens(text);if(0===tokens.length)return null;var regex=[];return _.each(tokens,function(token){'"'===token[0]&&'"'===token[token.length-1]?(token=token.substring(1,token.length-1),regex.push("^"+morpheus.Util.escapeRegex(token)+"$")):regex.push(morpheus.Util.escapeRegex(token))}),"("+regex.join("|")+")"},morpheus.Util.createRegExpToMatchText=function(text){var s=morpheus.Util.createRegExpStringToMatchText(text);return null==s?null:new RegExp(s,"i")},morpheus.Util.reorderArray=function(array,index){for(var newArray=[],i=0;i<index.length;i++)newArray.push(array[index[i]]);return newArray},morpheus.Util.getSearchString=function(){var s=window.location.search;return s.length>1?s.substring(1):""},morpheus.Util.splitLines=function(lines){for(var tab=/\t/,tokens=[],i=0,nlines=lines.length;i<nlines;i++){var line=lines[i];""!==line&&tokens.push(line.split(tab))}return tokens},morpheus.Util.readLines=function(fileOrUrl,interactive){return new Promise(function(resolve,reject){var isFile=morpheus.Util.isFile(fileOrUrl),isString=morpheus.Util.isString(fileOrUrl),name=morpheus.Util.getFileName(fileOrUrl),ext=morpheus.Util.getExtension(name);if(isString)if("xlsx"===ext){var fetchOptions={};if(fileOrUrl.headers)for(var header in fetchOptions.headers=new Headers,fileOrUrl.headers)fetchOptions.headers.append(header,fileOrUrl.headers[header]);fetch(fileOrUrl,fetchOptions).then(function(response){if(response.ok)return response.arrayBuffer();deferred.reject(response)}).then(function(arrayBuffer){if(arrayBuffer){for(var data=new Uint8Array(arrayBuffer),arr=[],i=0;i!=data.length;++i)arr[i]=String.fromCharCode(data[i]);var bstr=arr.join("");morpheus.Util.xlsxTo1dArray({data:bstr,prompt:interactive},function(err,lines){deferred.resolve(lines)})}else deferred.reject()})}else fetch(fileOrUrl,fetchOptions).then(function(response){if(response.ok)return response.text();reject()}).then(function(text){resolve(morpheus.Util.splitOnNewLine(text))}).catch(function(err){reject(err)});else if(isFile){var reader=new FileReader;reader.onerror=function(){console.log("Unable to read file"),reject("Unable to read file")},reader.onload=function(event){var arrayBuffer=event.target.result,data=new Uint8Array(arrayBuffer);if("xlsx"===ext||"xls"===ext){for(var arr=[],i=0;i!=data.length;++i)arr[i]=String.fromCharCode(data[i]);var bstr=arr.join("");morpheus.Util.xlsxTo1dArray({data:bstr,prompt:interactive},function(err,lines){resolve(lines)})}else{for(var s,br=new morpheus.ArrayBufferReader(data),lines=[],rtrim=/\s+$/;null!==(s=br.readLine());){var line=s.replace(rtrim,"");""!==line&&lines.push(line)}resolve(lines)}},reader.readAsArrayBuffer(fileOrUrl)}else resolve(fileOrUrl)})},morpheus.Util.createValueToIndices=function(array,field){var map=new morpheus.Map;return _.each(array,function(item){var key=item[field],values=map.get(key);void 0===values&&(values=[],map.set(key,values)),values.push(item)}),map},morpheus.Util.createMorpheusHeader=function(cb){var html=[];html.push('<div style="display:inline-block; vertical-align:top;font-size:24px;font-family:sans-serif;">'),html.push("<span>M</span>"),html.push("<span>O</span>"),html.push("<span>R</span>"),html.push("<span>P</span>"),html.push("<span>H</span>"),html.push("<span>E</span>"),html.push("<span>U</span>"),html.push("<span>S</span>"),html.push("</span>"),html.push("</div>");var start,$div=$(html.join("")),colorScale=d3.scale.linear().domain([0,4,7]).range(["#ca0020","#999999","#0571b0"]).clamp(!0),brands=$div.find("span");return window.requestAnimationFrame(function step(timestamp){start||(start=timestamp);var progress=timestamp-start,f=progress/2e3,index=Math.min(brands.length-1,Math.floor(f*brands.length));brands[index].style.color=colorScale(index),cb&&cb(Math.min(1,f)),progress<2e3&&window.requestAnimationFrame(step)}),$div},morpheus.Util.createLoadingEl=function(){return $('<div style="overflow:hidden;text-align:center;"><i class="fa fa-spinner fa-spin fa-3x"></i><span style="padding-left:4px;vertical-align:middle;font-weight:bold;">Loading...</span></div>')},morpheus.Util.splitOnNewLine=function(text,commentChar){var commentCharCode=void 0!==commentChar?commentChar.charCodeAt(0):void 0,lines=text.split(/\n/);if(1===lines.length){var tmp=text.split(/\r/);tmp.length>1&&(lines=tmp)}for(var rows=[],rtrim=/\s+$/,i=0,nlines=lines.length;i<nlines;i++){var line=lines[i].replace(rtrim,"");""!==line&&(void 0!==commentCharCode?line.charCodeAt(0)!==commentCharCode&&rows.push(line):rows.push(line))}return rows},morpheus.Util.ContainsPredicate=function(field,text){this.field=field,text=text.toLowerCase(),this.text=text},morpheus.Util.ContainsPredicate.prototype={accept:function(value){return null!=value&&-1!==(value=(""+value).toLowerCase()).indexOf(this.text)},getField:function(){return this.field},getText:function(){return this.text},isNumber:function(){return!1},toString:function(){return"ContainsPredicate "+this.field+":"+this.text}},morpheus.Util.ExactTermsPredicate=function(field,values){this.field=field,this.values=new morpheus.Set;for(var i=0,nvalues=values.length;i<nvalues;i++)this.values.add(values[i])},morpheus.Util.ExactTermsPredicate.prototype={accept:function(value){return null!=value&&(value=(""+value).toLowerCase(),this.values.has(value))},getField:function(){return this.field},getValues:function(){return this.values},isNumber:function(){return!1},toString:function(){return"ExactTermsPredicate "+this.field+":"+this.text}},morpheus.Util.ExactTermPredicate=function(field,term){this.field=field,term=term.toLowerCase(),this.text=term},morpheus.Util.ExactTermPredicate.prototype={accept:function(value){return null!=value&&(value=(""+value).toLowerCase())===this.text},getField:function(){return this.field},getText:function(){return this.text},isNumber:function(){return!1},toString:function(){return"ExactTermPredicate "+this.field+":"+this.text}},morpheus.Util.RegexPredicate=function(field,text){this.field=field,this.text=text,this.regex=new RegExp(morpheus.Util.escapeRegex(text),"i")},morpheus.Util.RegexPredicate.prototype={accept:function(value){return this.regex.test(""+value)},getField:function(){return this.field},getText:function(){return this.text},isNumber:function(){return!1},toString:function(){return"RegexPredicate "+this.field+":"+this.regex}},morpheus.Util.NumberRangePredicate=function(field,min,max){this.field=field,this.min=min,this.max=max},morpheus.Util.NumberRangePredicate.prototype={accept:function(value){return value>=this.min&&value<=this.max},getField:function(){return this.field},isNumber:function(){return!0},toString:function(){return"NumberRangePredicate "+this.field+":"+this.min+"..."+this.max}},morpheus.Util.GreaterThanPredicate=function(field,val){this.field=field,this.val=val},morpheus.Util.GreaterThanPredicate.prototype={accept:function(value){return value>this.val},getField:function(){return this.field},isNumber:function(){return!0}},morpheus.Util.GreaterThanOrEqualPredicate=function(field,val){this.field=field,this.val=val},morpheus.Util.GreaterThanOrEqualPredicate.prototype={accept:function(value){return value>=this.val},getField:function(){return this.field},isNumber:function(){return!0}},morpheus.Util.LessThanPredicate=function(field,val){this.field=field,this.val=val},morpheus.Util.LessThanPredicate.prototype={accept:function(value){return value<this.val},getField:function(){return this.field},isNumber:function(){return!0}},morpheus.Util.LessThanOrEqualPredicate=function(field,val){this.field=field,this.val=val},morpheus.Util.LessThanOrEqualPredicate.prototype={accept:function(value){return value<=this.val},getField:function(){return this.field},isNumber:function(){return!0}},morpheus.Util.EqualsPredicate=function(field,val){this.field=field,this.val=val},morpheus.Util.EqualsPredicate.prototype={accept:function(value){return value===this.val},getField:function(){return this.field},isNumber:function(){return!0}},morpheus.Util.NotPredicate=function(p){this.p=p},morpheus.Util.NotPredicate.prototype={accept:function(value){return!this.p.accept(value)},getField:function(){return this.p.getField()},isNumber:function(){return this.p.isNumber()},toString:function(){return"NotPredicate "+this.p}},morpheus.Events=function(){},morpheus.Events.prototype={on:function(evtStr,handler){if(!handler)throw Error("Handler not specified");this.eventListeners||(this.eventListeners={});var n,parts,baseEvent,name,events=evtStr.split(" "),len=events.length;for(n=0;n<len;n++)baseEvent=(parts=events[n].split("."))[0],name=parts[1]||"",this.eventListeners[baseEvent]||(this.eventListeners[baseEvent]=[]),this.eventListeners[baseEvent].push({name:name,handler:handler});return this},getListeners:function(){return this.eventListeners||(this.eventListeners={}),this.eventListeners},setListeners:function(eventListeners){this.eventListeners=eventListeners},trigger:function(eventType,evt){this.eventListeners||(this.eventListeners={}),evt||(evt={}),evt.type=eventType,evt.source||(evt.source=this);var events=this.eventListeners[eventType];if(events)for(var len=events.length,i=0;i<len;i++)events[i].handler.apply(this,[evt]);return this},off:function(evtStr,handler){this.eventListeners||(this.eventListeners={});var n,t,parts,baseEvent,name,events=(evtStr||"").split(" "),len=events.length;if(!evtStr)for(t in this.eventListeners)this._off(t,null,handler);for(n=0;n<len;n++)if(baseEvent=(parts=events[n].split("."))[0],name=parts[1],baseEvent)this.eventListeners[baseEvent]&&this._off(baseEvent,name,handler);else for(t in this.eventListeners)this._off(t,name,handler);return this},_off:function(type,name,handler){var i,evtName,evtListeners=this.eventListeners[type];for(i=0;i<evtListeners.length;i++)if(evtName=evtListeners[i].name,!(name&&evtName!==name||null!=handler&&handler!=evtListeners[i].handler)){if(evtListeners.splice(i,1),0===evtListeners.length){delete this.eventListeners[type];break}i--}}},morpheus.Identifier=function(array){this.array=array},morpheus.Identifier.prototype={toString:function(){return this.array.join(",")},equals:function(otherId){var other=otherId.getArray(),length=this.array.length;if(other.length!==length)return!1;for(var i=0;i<length;i++)if(this.array[i]!==other[i])return!1;return!0},getArray:function(){return this.array}},morpheus.Map=function(){this.map={},this.n=0},morpheus.Map.prototype={toJSON:function(){var json={};return this.forEach(function(value,key){json[key]=value}),json},toString:function(){var s=[];return this.forEach(function(value,key){s.length>0&&s.push(", "),s.push(key),s.push("="),s.push(value)}),s.join("")},keys:function(){var keys=[];for(var key in this.map){var pair=this.map[key];keys.push(pair.key)}return keys},size:function(){return this.n},equals:function(m){if(m.size()!==this.size())return!1;var ret=!0;try{this.forEach(function(value,key){if(value!==m.get(key))throw ret=!1,"break"})}catch(e){}return ret},setAll:function(map){var _this=this;map.forEach(function(value,key){_this.set(key,value)})},set:function(key,value){var skey="\0"+key;void 0===this.map[skey]&&this.n++,this.map[skey]={key:key,value:value}},forEach:function(callback){for(var key in this.map){var pair=this.map[key];callback(pair.value,pair.key)}},entries:function(){var array=[];return this.forEach(function(value,key){array.push({value:value,key:key})}),array},values:function(){var values=[];for(var key in this.map){var pair=this.map[key];values.push(pair.value)}return values},get:function(key){var skey="\0"+key,pair=this.map[skey];return void 0!==pair?pair.value:void 0},clear:function(){this.map={},this.n=0},remove:function(key){var skey="\0"+key,pair=this.map[skey];if(void 0!==pair)return delete this.map[skey],this.n--,pair.value},has:function(key){var skey="\0"+key;return void 0!==this.map[skey]}},morpheus.Map.fromJSON=function(json){var map=new morpheus.Map;for(var key in json)map.set(key,json[key]);return map},morpheus.Set=function(){this._map=new morpheus.Map},morpheus.Set.prototype={toJSON:function(){var json=[];return this.forEach(function(value){json.push(value)}),json},toString:function(){var s=[];return this.forEach(function(key){s.length>0&&s.push(", "),s.push(key)}),s.join("")},size:function(){return this._map.size()},equals:function(m){return this._map.equals(m)},forEach:function(callback){this._map.forEach(function(value,key){callback(key)})},add:function(value){this._map.set(value,!0)},values:function(){var values=[];return this._map.forEach(function(value,key){values.push(key)}),values},clear:function(){this._map.clear()},remove:function(key){this._map.remove(key)},has:function(key){return this._map.has(key)}},morpheus.Set.fromJSON=function(json){for(var set=new morpheus.Set,i=0,length=json.length;i<length;i++)set.add(json[i]);return set},morpheus.ArrayBufferReader=function(buffer){this.buffer=buffer,this.bufferLength=buffer.length,this.index=0,this.decoder=morpheus.Util.createTextDecoder()},morpheus.ArrayBufferReader.prototype={reset:function(){this.index=0},readLine:function(){var index=this.index,bufferLength=this.bufferLength;if(index>=bufferLength)return null;for(var buffer=this.buffer,start=index,end=start;index<bufferLength;index++){var c=buffer[index];if(10===c||13===c){end=index,index!==bufferLength-1&&10===buffer[index+1]&&index++,index++;break}}return this.index=index,start===end&&index===bufferLength?this.decoder(this.buffer,start,bufferLength):this.decoder(this.buffer,start,end)}},morpheus.ArrayBufferReader.getArrayBuffer=function(fileOrUrl,callback){if("string"==typeof fileOrUrl||fileOrUrl instanceof String){var fetchOptions={};if(fileOrUrl.headers)for(var header in fetchOptions.headers=new Headers,fileOrUrl.headers)fetchOptions.headers.append(header,fileOrUrl.headers[header]);fetch(fileOrUrl,fetchOptions).then(function(response){if(response.ok)return response.arrayBuffer();callback(new Error(fileOrUrl+" status: "+response.status))}).then(function(buf){callback(null,buf)}).catch(function(error){console.log("Fetch error",error),callback(error)})}else{var reader=new FileReader;reader.onload=function(event){callback(null,event.target.result)},reader.onerror=function(event){callback(event)},reader.readAsArrayBuffer(fileOrUrl)}},morpheus.Array2dReaderInteractive=function(){},morpheus.Array2dReaderInteractive.prototype={_getReader:function(fileOrUrl,callback){var name=morpheus.Util.getFileName(fileOrUrl),ext=morpheus.Util.getExtension(name);morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){if(err)return console.log(err),callback(err);var dataArray=new Uint8Array(arrayBuffer);if("xls"===ext||"xlsx"===ext){for(var arr=[],i=0;i!=dataArray.length;++i)arr[i]=String.fromCharCode(dataArray[i]);var bstr=arr.join("");morpheus.Util.xlsxTo1dArray({data:bstr,prompt:!0},function(err,lines){callback(err,new morpheus.LineReader(lines))})}else callback(null,new morpheus.ArrayBufferReader(dataArray))})},read:function(fileOrUrl,callback){var _this=this,name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl)),html=[];html.push("<div>"),html.push("<label>Click the table cell containing the first data row and column.</label><br />"),html.push('<div style="display:inline-block;width:10px;height:10px;background-color:#b3cde3;"></div><span> Data Matrix</span>'),html.push('<br /><div style="display:inline-block;width:10px;height:10px;background-color:#fbb4ae;"></div><span> Column Annotations</span>'),html.push('<br /><div style="display:inline-block; width:10px;height:10px;background-color:#ccebc5;"></div><span> Row Annotations</span>'),html.push('<div class="slick-bordered-table" style="width:550px;height:300px;"></div>'),html.push("</div>");var $el=$(html.join(""));this._getReader(fileOrUrl,function(err,br){if(err)return console.log(err),callback(err);for(var s,lines=[],separator=/\t/,testLine=br.readLine(),separators=["\t",","," "],i=0;i<separators.length;i++){var sep=separators[i],tokens=testLine.split(new RegExp(sep));if(tokens.length>1){separator=sep,lines.push(tokens);break}}for(;null!==(s=br.readLine())&&lines.length<100;)lines.push(s.split(separator));if("#1.3"===lines[0][0])return br.reset(),void callback(null,(new morpheus.GctReader)._read(name,br));for(var columns=[],j=0,ncols=lines[0].length;j<ncols;j++)columns.push({id:j,field:j});var transposedLines,transposedColumns,dataRowStart=1,dataColumnStart=1,_lines=lines,grid=new Slick.Grid($el.find(".slick-bordered-table")[0],lines,columns,{enableCellNavigation:!0,headerRowHeight:0,showHeaderRow:!1,multiColumnSort:!1,multiSelect:!1,topPanelHeight:0,enableColumnReorder:!1,enableTextSelectionOnCells:!0,forceFitColumns:!1,defaultFormatter:function(row,cell,value,columnDef,dataContext){var color="white";cell>=dataColumnStart&&row>=dataRowStart?color="#b3cde3":row<=dataRowStart-1&&cell>=dataColumnStart?color="#fbb4ae":cell<dataColumnStart&&row>=dataRowStart&&(color="#ccebc5");var html=['<div style="width:100%;height:100%;background-color:'+color+'">'];if(_.isNumber(value))html.push(morpheus.Util.nf(value));else if(morpheus.Util.isArray(value)){for(var s=[],i=0,length=value.length;i<length;i++){i>0&&s.push(", ");value[i];s.push(value[i])}html.push(s.join(""))}else html.push(value);return html.push("</div>"),html.join("")}});$el.find("[name=transpose]").on("click",function(e){if($(this).prop("checked")){if(null==transposedLines){transposedLines=[];for(var j=0,ncols=lines[0].length;j<ncols;j++){var row=[];transposedLines.push(row);for(var i=0,nrows=lines.length;i<nrows;i++)row.push(lines[i][j])}transposedColumns=[];for(j=0,ncols=transposedLines[0].length;j<ncols;j++)transposedColumns.push({id:j,field:j})}lines=transposedLines,grid.setData(transposedLines),grid.setColumns(transposedColumns),grid.resizeCanvas(),grid.invalidate()}else grid.setData(_lines),grid.setColumns(columns),grid.resizeCanvas(),grid.invalidate(),lines=_lines}),grid.onClick.subscribe(function(e,args){dataRowStart=args.row,dataColumnStart=args.cell,grid.invalidate()}),$el.find(".slick-header").remove();var footer=[];footer.push('<button name="ok" type="button" class="btn btn-default">OK</button>'),footer.push('<button name="cancel" type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>');$(footer.join(""));morpheus.FormBuilder.showOkCancel({title:"Open",content:$el,close:!1,focus:document.activeElement,cancelCallback:function(){callback(new Error("Cancel"),null)},okCallback:function(){br.reset(),_this._read(name,br,dataColumnStart,dataRowStart,separator,callback)}}),grid.resizeCanvas()})},_read:function(datasetName,bufferedReader,dataColumnStart,dataRowStart,separator,cb){cb(null,new morpheus.TxtReader({separator:separator,columnMetadata:!0,dataRowStart:dataRowStart,dataColumnStart:dataColumnStart})._read(datasetName,bufferedReader))}},morpheus.BufferedReader=function(reader,callback,doneCallback){var textDecoder=morpheus.Util.createTextDecoder(),skipLF=!1,text="";reader.read().then(function processResult(result){for(var start=0,i=0,length=(text+=result.done?"":textDecoder(result.value,0,result.value.length)).length;i<length;i++){var c=text[i];if(skipLF&&"\n"===c)start++,skipLF=!1;else if("\n"===c||"\r"===c){skipLF="\r"===c;var s=morpheus.Util.copyString(text.substring(start,i));callback(s),start=i+1}else skipLF=!1}if(text=start<text.length?text.substring(start):"",!result.done)return reader.read().then(processResult);""!==text&&"\r"!==text&&callback(text),doneCallback()})},morpheus.BufferedReader.parse=function(url,options){var delim=options.delimiter,regex=new RegExp(delim),handleTokens=options.handleTokens,complete=options.complete,fetchOptions={};if(url.headers)for(var header in fetchOptions.headers=new Headers,url.headers)fetchOptions.headers.append(header,url.headers[header]);fetch(url,fetchOptions).then(function(response){if(response.ok){var reader=response.body.getReader();new morpheus.BufferedReader(reader,function(line){handleTokens(line.split(regex))},function(){complete()})}else options.error("Network error")}).catch(function(error){options.error(error)})},morpheus.ClsReader=function(){},morpheus.ClsReader.prototype={read:function(lines){var regex=/[ ,]+/,header=lines[0].split(regex);if(header.length<3)throw new Error("Header line needs three numbers");var headerNumbers=[];try{for(var i=0;i<3;i++)headerNumbers[i]=parseInt($.trim(header[i]))}catch(e){throw new Error("Header line element "+i+" is not a number")}if(headerNumbers[0]<=0)throw new Error("Header line missing first number, number of data points");if(headerNumbers[1]<=0)throw new Error("Header line missing second number, number of classes");var numClasses=headerNumbers[1],classDefinitionLine=(headerNumbers[0],lines[1]);classDefinitionLine=classDefinitionLine.substring(classDefinitionLine.indexOf("#")+1);var classNames=$.trim(classDefinitionLine).split(regex);if(classNames.length<numClasses)throw new Error("First line specifies "+numClasses+" classes, but found "+classNames.length+".");var assignments=lines[2].split(regex);for(i=0;i<assignments.length;i++){var assignment=$.trim(assignments[i]),tmp=classNames[parseInt(assignment)];void 0!==tmp&&(assignments[i]=tmp)}return assignments}},morpheus.ClsWriter=function(){},morpheus.ClsWriter.prototype={write:function(vector){var pw=[],size=vector.size();pw.push(size),pw.push(" ");var set=morpheus.VectorUtil.getSet(vector);pw.push(set.size()),pw.push(" "),pw.push("1\n"),pw.push("#");var valueToIndex=new morpheus.Map,index=0;set.forEach(function(name){pw.push(" "),pw.push(name),valueToIndex.set(name,index++)}),pw.push("\n");for(var i=0;i<size;i++)i>0&&pw.push(" "),pw.push(valueToIndex.get(vector.getValue(i)));return pw.push("\n"),pw.join("")}},morpheus.GctReader=function(){},morpheus.GctReader.prototype={getFormatName:function(){return"gct"},read:function(fileOrUrl,callback){morpheus.Util.isFile(fileOrUrl)?this._readChunking(fileOrUrl,callback,!1):morpheus.Util.isFetchStreamingSupported()?this._readChunking(fileOrUrl,callback,!0):this._readNoChunking(fileOrUrl,callback)},_readChunking:function(fileOrUrl,callback,useFetch){var dataColumnStart,dataMatrixLineNumberStart,columnNamesArray,lineNumber=0,numRowAnnotations=1,numColumnAnnotations=0,nrows=-1,ncols=-1,version=2,rowMetadataNames=[],columnMetadataNames=[],rowMetadata=[[]],columnMetadata=[[]],matrix=[],columnIdFieldName="id",rowIdFieldName="id",isSparse=!1,percentSparse=null,handleTokens=function(tokens){if(0===lineNumber){var text=tokens[0].trim();"#1.2"===text?version=2:"#1.3"===text?version=3:console.log("Unknown version: assuming version 2")}else if(1===lineNumber){var dimensions=tokens;3===version?dimensions.length>=4?(nrows=parseInt(dimensions[0]),ncols=parseInt(dimensions[1]),numRowAnnotations=parseInt(dimensions[2]),numColumnAnnotations=parseInt(dimensions[3])):(numRowAnnotations=parseInt(dimensions[0]),numColumnAnnotations=parseInt(dimensions[1])):(nrows=parseInt(dimensions[0]),ncols=parseInt(dimensions[1]),(nrows<=0||ncols<=0)&&callback("Number of rows and columns must be greater than 0.")),dataColumnStart=numRowAnnotations+1}else if(2===lineNumber){columnNamesArray=tokens;for(var i=0;i<columnNamesArray.length;i++)columnNamesArray[i]=morpheus.Util.copyString(columnNamesArray[i]);if(-1===ncols&&(ncols=columnNamesArray.length-numRowAnnotations-1),2==version){var expectedColumns=ncols+2;if(columnNamesArray.length!==expectedColumns){if(columnNamesArray.length>expectedColumns){var skip=columnNamesArray.length-1;for(i=columnNamesArray.length-1;i>=0&&""===columnNamesArray[i];i--,skip--);skip!==columnNamesArray.length-1&&(columnNamesArray=columnNamesArray.slice(0,skip+1))}if(columnNamesArray.length!==expectedColumns)return callback("Expected "+(expectedColumns-2)+" column names, but read "+(columnNamesArray.length-2)+" column names.")}}var name=columnNamesArray[0],slashIndex=name.lastIndexOf("/");-1!=slashIndex&&slashIndex<name.length-1&&(rowIdFieldName=name.substring(0,slashIndex),columnIdFieldName=name.substring(slashIndex+1)),rowMetadataNames.push(rowIdFieldName),columnMetadataNames.push(columnIdFieldName);for(var j=0;j<ncols;j++){var index=j+numRowAnnotations+1,columnName=index<columnNamesArray.length?columnNamesArray[index]:null;columnMetadata[0].push(morpheus.Util.copyString(columnName))}for(j=0;j<numRowAnnotations;j++){var rowMetadataName=""===columnNamesArray[1]?"description":columnNamesArray[j+1];rowMetadataNames.push(rowMetadataName),rowMetadata.push([])}dataMatrixLineNumberStart=3+numColumnAnnotations}else if(lineNumber<dataMatrixLineNumberStart){var metadataName=morpheus.Util.copyString(tokens[0]),v=[];columnMetadata.push(v),columnMetadataNames.push(metadataName);for(j=0;j<ncols;j++)v.push(morpheus.Util.copyString(tokens[j+dataColumnStart]))}else if(""!==tokens[0]){for(var array=new Float32Array(ncols),rowAnnotationIndex=0;rowAnnotationIndex<=numRowAnnotations;rowAnnotationIndex++){var rowMetadataValue=tokens[rowAnnotationIndex];rowMetadata[rowAnnotationIndex].push(morpheus.Util.copyString(rowMetadataValue))}for(var columnIndex=0;columnIndex<ncols;columnIndex++){var token=tokens[columnIndex+dataColumnStart];array[columnIndex]=parseFloat(token)}if(null==percentSparse){var nzero=0;for(j=0;j<ncols;j++)0===array[0]&&nzero++;percentSparse=nzero/array.length,isSparse=percentSparse>.3}if(isSparse){var count=0;for(j=0;j<ncols;j++)0!==array[j]&&count++;for(var obj={values:new Float32Array(count),indices:new Uint32Array(count)},k=(j=0,0);j<ncols;j++)0!==array[j]&&(obj.values[k]=array[j],obj.indices[k]=j,k++);matrix.push(obj)}else matrix.push(array)}lineNumber++};(useFetch?morpheus.BufferedReader:Papa).parse(fileOrUrl,{delimiter:"\t",newline:"",header:!1,dynamicTyping:!1,preview:0,encoding:"",worker:!1,comments:!1,handleTokens:handleTokens,step:function(result){handleTokens(result.data[0])},complete:function(){for(var dataset=new morpheus.Dataset({name:morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl)),rows:matrix.length,columns:ncols,array:matrix,dataType:"Float32",defaultValue:isSparse?0:void 0}),i=0;i<rowMetadataNames.length;i++)dataset.getRowMetadata().add(rowMetadataNames[i]).array=rowMetadata[i];for(i=0;i<columnMetadataNames.length;i++)dataset.getColumnMetadata().add(columnMetadataNames[i]).array=columnMetadata[i];morpheus.MetadataUtil.maybeConvertStrings(dataset.getRowMetadata(),1),morpheus.MetadataUtil.maybeConvertStrings(dataset.getColumnMetadata(),1),callback(null,dataset)},error:function(err){callback(err)},download:!morpheus.Util.isFile(fileOrUrl),skipEmptyLines:!1,chunk:void 0,fastMode:!0,beforeFirstChunk:void 0,withCredentials:void 0})},_read:function(datasetName,reader){var tab=/\t/,versionLine=morpheus.Util.copyString(reader.readLine().trim());if(""===versionLine)throw new Error("Missing version line");var version=2;"#1.2"===versionLine?version=2:"#1.3"===versionLine?version=3:console.log("Unknown version: assuming version 2");var dimensionsLine=morpheus.Util.copyString(reader.readLine());if(null==dimensionsLine)throw new Error("No dimensions specified");var dimensions=dimensionsLine.split(/[ \t]/),numRowAnnotations=1,numColumnAnnotations=0,nrows=-1,ncols=-1;if(3===version)dimensions.length>=4?(nrows=parseInt(dimensions[0]),ncols=parseInt(dimensions[1]),numRowAnnotations=parseInt(dimensions[2]),numColumnAnnotations=parseInt(dimensions[3])):(numRowAnnotations=parseInt(dimensions[0]),numColumnAnnotations=parseInt(dimensions[1]));else if(nrows=parseInt(dimensions[0]),ncols=parseInt(dimensions[1]),nrows<=0||ncols<=0)throw new Error("Number of rows and columns must be greater than 0.");var columnNamesLine=morpheus.Util.copyString(reader.readLine());if(null==columnNamesLine)throw new Error("No column annotations");var columnNamesArray=columnNamesLine.split(tab);if(-1===ncols&&(ncols=columnNamesArray.length-numRowAnnotations-1),2==version){var expectedColumns=ncols+2;if(columnNamesArray.length!==expectedColumns)throw new Error("Expected "+(expectedColumns-2)+" column names, but read "+(columnNamesArray.length-2)+" column names.")}var name=columnNamesArray[0],slashIndex=name.lastIndexOf("/"),columnIdFieldName="id",rowIdFieldName="id";if(-1!=slashIndex&&slashIndex<name.length-1&&(rowIdFieldName=name.substring(0,slashIndex),columnIdFieldName=name.substring(slashIndex+1)),-1===nrows){for(var matrix=[],rowMetadataNames=[rowIdFieldName],columnMetadataNames=[columnIdFieldName],rowMetadata=[[]],columnMetadata=[[]],j=0;j<ncols;j++){var columnName=(index=j+numRowAnnotations+1)<columnNamesArray.length?columnNamesArray[index]:null;columnMetadata[0].push(morpheus.Util.copyString(columnName))}for(j=0;j<numRowAnnotations;j++){var rowMetadataName=""===columnNamesArray[1]?"description":columnNamesArray[j+1];rowMetadataNames.push(rowMetadataName),rowMetadata.push([])}var dataColumnStart=numRowAnnotations+1;if(numColumnAnnotations>0)for(var columnAnnotationIndex=0;columnAnnotationIndex<numColumnAnnotations;columnAnnotationIndex++){var metadataName=(tokens=reader.readLine().split(tab))[0],v=[];columnMetadata.push(v),columnMetadataNames.push(metadataName);for(j=0;j<ncols;j++)v.push(morpheus.Util.copyString(tokens[j+dataColumnStart]))}for(var nonEmptyDescriptionFound=!1,numRowAnnotationsPlusOne=numRowAnnotations+1;null!==(s=reader.readLine());)if(""!==s){var array=new Float32Array(ncols);matrix.push(array);for(var tokens=s.split(tab),rowAnnotationIndex=0;rowAnnotationIndex<numRowAnnotationsPlusOne;rowAnnotationIndex++){var rowMetadataValue=tokens[rowAnnotationIndex];rowMetadata[rowAnnotationIndex].push(morpheus.Util.copyString(rowMetadataValue))}for(var columnIndex=0;columnIndex<ncols;columnIndex++){var token=tokens[columnIndex+dataColumnStart];array[columnIndex]=parseFloat(token)}}for(var dataset=new morpheus.Dataset({name:datasetName,rows:matrix.length,columns:ncols,array:matrix,dataType:"Float32"}),i=0;i<rowMetadataNames.length;i++)dataset.getRowMetadata().add(rowMetadataNames[i]).array=rowMetadata[i];for(i=0;i<columnMetadataNames.length;i++)dataset.getColumnMetadata().add(columnMetadataNames[i]).array=columnMetadata[i];return morpheus.MetadataUtil.maybeConvertStrings(dataset.getRowMetadata(),1),morpheus.MetadataUtil.maybeConvertStrings(dataset.getColumnMetadata(),1),dataset}var columnIds=(dataset=new morpheus.Dataset({dataType:"Float32",name:datasetName,rows:nrows,columns:ncols})).getColumnMetadata().add(columnIdFieldName);if(3==version)for(j=0;j<ncols;j++){var index;columnName=(index=j+numRowAnnotations+1)<columnNamesArray.length?columnNamesArray[index]:null;columnIds.setValue(j,morpheus.Util.copyString(columnName))}else for(j=0;j<ncols;j++){columnName=columnNamesArray[j+numRowAnnotations+1];columnIds.setValue(j,morpheus.Util.copyString(columnName))}var rowAnnotationVectors=[dataset.getRowMetadata().add(rowIdFieldName)];if(3===version)for(j=0;j<numRowAnnotations;j++){rowMetadataName=""===columnNamesArray[1]?"description":columnNamesArray[j+1];rowAnnotationVectors.push(dataset.getRowMetadata().add(rowMetadataName))}else rowAnnotationVectors.push(dataset.getRowMetadata().add(columnNamesArray[1]));dataColumnStart=numRowAnnotations+1;if(numColumnAnnotations>0)for(columnAnnotationIndex=0;columnAnnotationIndex<numColumnAnnotations;columnAnnotationIndex++)for(metadataName=(tokens=reader.readLine().split(tab))[0],v=dataset.getColumnMetadata().add(metadataName),j=0;j<ncols;j++)v.setValue(j,morpheus.Util.copyString(tokens[j+dataColumnStart]));nonEmptyDescriptionFound=!1,numRowAnnotationsPlusOne=numRowAnnotations+1;var rowIndex=0;for(nrows=dataset.getRowCount();rowIndex<nrows;rowIndex++){var s;if(null===(s=reader.readLine()))throw new Error("Missing data rows.");tokens=s.split(tab);if(2===version){rowAnnotationVectors[0].setValue(rowIndex,morpheus.Util.copyString(tokens[0]));var desc=tokens[1];nonEmptyDescriptionFound||(nonEmptyDescriptionFound=""!==desc),rowAnnotationVectors[1].setValue(rowIndex,morpheus.Util.copyString(desc))}else for(rowAnnotationIndex=0;rowAnnotationIndex<numRowAnnotationsPlusOne;rowAnnotationIndex++){rowMetadataValue=tokens[rowAnnotationIndex];rowAnnotationVectors[rowAnnotationIndex].setValue(rowIndex,morpheus.Util.copyString(rowMetadataValue))}for(columnIndex=0;columnIndex<ncols;columnIndex++){token=tokens[columnIndex+dataColumnStart];dataset.setValue(rowIndex,columnIndex,parseFloat(token))}}if(2!==version||nonEmptyDescriptionFound||dataset.getRowMetadata().remove(1),rowIndex!==nrows)throw new Error("Missing data rows");return morpheus.MetadataUtil.maybeConvertStrings(dataset.getRowMetadata(),1),morpheus.MetadataUtil.maybeConvertStrings(dataset.getColumnMetadata(),1),dataset},_readNoChunking:function(fileOrUrl,callback){var _this=this,name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl));morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){err?callback(err):callback(null,_this._read(name,new morpheus.ArrayBufferReader(new Uint8Array(arrayBuffer))))})}},morpheus.GctWriter=function(){this.nf=morpheus.Util.createNumberFormat(".2f")},morpheus.GctWriter.idFirst=function(model){for(var fields=["id","Id","pr_id"],idIndex=-1,i=0;i<fields.length&&-1===(idIndex=morpheus.MetadataUtil.indexOf(model,fields[i]));i++);if(-1!==idIndex){var order=[];order[0]=idIndex;i=0;for(var j=1,count=model.getMetadataCount();i<count;i++)i!==idIndex&&(order[j++]=i);return new morpheus.MetadataModelColumnView(model,order)}return model},morpheus.GctWriter.prototype={setNumberFormat:function(nf){this.nf=nf},getExtension:function(){return"gct"},write:function(dataset,pw){null==pw&&(pw=[]);var rowMetadata=morpheus.GctWriter.idFirst(dataset.getRowMetadata()),columnMetadata=morpheus.GctWriter.idFirst(dataset.getColumnMetadata());return this.writeHeader(rowMetadata,columnMetadata,pw),this.writeData(dataset,rowMetadata,pw),pw.join("")},writeData:function(dataset,rowMetadata,pw){for(var ncols=dataset.getColumnCount(),rowMetadataCount=rowMetadata.getMetadataCount(),nf=this.nf,i=0,rows=dataset.getRowCount();i<rows;i++){for(var rowMetadataIndex=0;rowMetadataIndex<rowMetadataCount;rowMetadataIndex++){rowMetadataIndex>0&&pw.push("\t");var vector=rowMetadata.get(rowMetadataIndex);if(null!==(value=vector.getValue(i))){var toString=morpheus.VectorTrack.vectorToString(vector);pw.push(toString(value))}}for(var j=0;j<ncols;j++){pw.push("\t");var value=dataset.getValue(i,j);pw.push(nf(value))}pw.push("\n")}},writeHeader:function(rowMetadata,columnMetadata,pw){var rows=rowMetadata.getItemCount(),ncols=columnMetadata.getItemCount();pw.push("#1.3\n");var rowMetadataCount=rowMetadata.getMetadataCount();pw.push(rows+"\t"+ncols+"\t"+(rowMetadataCount-1)+"\t"+(columnMetadata.getMetadataCount()-1)),pw.push("\n");for(var i=0;i<rowMetadataCount;i++){i>0&&pw.push("\t");var name=rowMetadata.get(i).getName();0===i&&name!==columnMetadata.get(0).getName()&&(name=name+"/"+columnMetadata.get(0).getName()),pw.push(name)}for(var columnIdToString=morpheus.VectorTrack.vectorToString(columnMetadata.get(0)),j=0;j<ncols;j++)pw.push("\t"),pw.push(columnIdToString(columnMetadata.get(0).getValue(j)));pw.push("\n");for(var columnMetadataIndex=1,metadataSize=columnMetadata.getMetadataCount();columnMetadataIndex<metadataSize;columnMetadataIndex++){var vector=columnMetadata.get(columnMetadataIndex);pw.push(vector.getName());for(i=1;i<rowMetadataCount;i++)pw.push("\t"),pw.push("na");for(j=0;j<ncols;j++){pw.push("\t");var value=vector.getValue(j);if(null!=value){var toString=morpheus.VectorTrack.vectorToString(vector);pw.push(toString(value))}}pw.push("\n")}}},morpheus.GctWriter12=function(){this.options={rowDescription:"Description",rowId:"id",columnId:"id"},this.nf=morpheus.Util.createNumberFormat(".2f")},morpheus.GctWriter12.prototype={setNumberFormat:function(nf){this.nf=nf},getExtension:function(){return"gct"},write:function(dataset,pw){null==pw&&(pw=[]);var rows=dataset.getRowCount(),columns=dataset.getColumnCount();pw.push("#1.2"),pw.push("\n"),pw.push(rows+"\t"+columns),pw.push("\n");var rowMetadata=morpheus.GctWriter.idFirst(dataset.getRowMetadata()),columnMetadata=morpheus.GctWriter.idFirst(dataset.getColumnMetadata());pw.push("Name"),pw.push("\t"),pw.push("Description");var columnIds=columnMetadata.getByName(this.options.columnId);columnIds||(columnIds=columnMetadata.get(0));for(var columnIdToString=morpheus.VectorTrack.vectorToString(columnIds),j=0;j<columns;j++)pw.push("\t"),pw.push(columnIdToString(columnIds.getValue(j)));var rowIds=rowMetadata.get(this.options.rowId);rowIds||(rowIds=rowMetadata.get(0));var rowDescriptions=rowMetadata.getByName(this.options.rowDescription);null==rowDescriptions&&rowMetadata.getMetadataCount()>1&&(rowDescriptions=rowMetadata.get(1));for(var rowIdToString=morpheus.VectorTrack.vectorToString(rowIds),rowDescriptionToString=null!=rowDescriptions?morpheus.VectorTrack.vectorToString(rowDescriptions):null,nf=this.nf,i=0;i<rows;i++){pw.push("\n"),pw.push(rowIdToString(rowIds.getValue(i))),pw.push("\t");var rowDescription=null!=rowDescriptions?rowDescriptions.getValue(i):null;null!=rowDescription&&pw.push(rowDescriptionToString(rowDescription));for(j=0;j<columns;j++)pw.push("\t"),pw.push(nf(dataset.getValue(i,j)))}return pw.push("\n"),pw.join("")}},morpheus.GisticReader=function(){},morpheus.GisticReader.prototype={read:function(fileOrUrl,callback){var _this=this,name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl));morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){if(err)callback(err);else try{callback(null,_this._read(name,new morpheus.ArrayBufferReader(new Uint8Array(arrayBuffer))))}catch(x){x.stack&&console.log(x.stack),callback(x)}})},_read:function(datasetName,reader){for(var s,tab=/\t/,header=reader.readLine().trim().split(tab),ncols=header.length-9,matrix=[],rowIds=[],qValues=[];null!==(s=reader.readLine());)if(""!==(s=s.trim())){var tokens=s.split(tab);if("Actual Copy Change Given"===tokens[8]){var array=new Float32Array(ncols);matrix.push(array),rowIds.push(String($.trim(tokens[1]))),qValues.push(parseFloat(tokens[5]));for(var j=9;j<=ncols;j++){var token=tokens[j];array[j-9]=parseFloat(token)}}}var dataset=new morpheus.Dataset({name:datasetName,rows:matrix.length,columns:ncols,array:matrix,dataType:"Float32"}),columnIds=dataset.getColumnMetadata().add("id");for(j=0;j<ncols;j++)columnIds.setValue(j,String(header[j+9]));return dataset.getRowMetadata().add("id").array=rowIds,dataset.getRowMetadata().add("q_value").array=qValues,dataset}},morpheus.GmtDatasetReader=function(){},morpheus.GmtDatasetReader.prototype={getFormatName:function(){return"gmt"},read:function(fileOrUrl,callback){var name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl));morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){if(err)callback(err);else try{callback(null,morpheus.DatasetUtil.geneSetsToDataset(name,(new morpheus.GmtReader).read(new morpheus.ArrayBufferReader(new Uint8Array(arrayBuffer)))))}catch(x){callback(x)}})}},morpheus.GmxReader=function(){},morpheus.GmxReader.prototype={read:function(reader){for(var s,sets=[],tab=/\t/,payload=[];null!=(s=reader.readLine());)if(""!==s&&"#"!==s[0]){var tokens=s.split(tab);payload.push(tokens)}var transposedPayload=_.zip.apply(_,payload);sets=[];return _.each(transposedPayload,function(datum,annotationIndex){var name=datum[0],desc="na";datum.length>2&&datum[1]&&(desc=datum[1]),datum[0]=void 0,datum[1]=void 0;var set={name:name,description:desc,ids:datum.filter(function(e){return e}),toString:function(){return this.name}};sets.push(set)}),sets}},morpheus.GmtReader=function(){},morpheus.GmtReader.prototype={read:function(reader){for(var s,sets=[],tab=/\t/;null!=(s=reader.readLine());)if(""!==s&&"#"!==s[0]){var tokens=s.split(tab),name=tokens[0].trim(),description=tokens.length>1?tokens[1].trim():"";"BLANK"===description&&(description="");for(var ids=[],i=2;i<tokens.length;i++){var geneName=tokens[i].trim();""!==geneName&&ids.push(geneName)}var set={name:name,description:description,ids:ids,toString:function(){return this.name}};sets.push(set)}return sets}},morpheus.Hdf5Reader=function(options){null==options&&(options={}),this.options=options},morpheus.Hdf5Reader.prototype={read:function(fileOrUrl,callback){}},morpheus.Hdf5Reader.getGctxInstance=function(){return new morpheus.Hdf5Reader({dataset:"0/DATA/0/matrix",rowMeta:"0/META/ROW/",colMeta:"0/META/COL/",columnMajorOrder:!0})},morpheus.Hdf5Reader.getLoomInstance=function(){return new morpheus.Hdf5Reader({dataset:"matrix",rowMeta:"row_attrs",colMeta:"col_attrs",transpose:!1})},morpheus.Hdf5Reader.getH5adInstance=function(){return new morpheus.Hdf5Reader({dataset:"X",rowMeta:"obs",colMeta:"var",transpose:!1})},morpheus.JsonDatasetReader=function(){},morpheus.JsonDatasetReader.prototype={read:function(fileOrUrl,callback){morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl));if("string"==typeof fileOrUrl||fileOrUrl instanceof String)fetch(fileOrUrl).then(function(response){if(response.ok)return response.text();callback(response.status+" "+response.statusText)}).then(function(text){callback(null,morpheus.Dataset.fromJSON(JSON.parse(text.trim())))}).catch(function(err){callback(err)});else{var reader=new FileReader;reader.onload=function(event){callback(null,morpheus.Dataset.fromJSON(JSON.parse(event.target.result)))},reader.onerror=function(event){callback(event)},reader.readAsText(fileOrUrl)}}},morpheus.LineReader=function(lines){this.lines=lines,this.index=0},morpheus.LineReader.prototype={reset:function(){this.index=0},readLine:function(){var index=this.index;return index>=this.lines.length?null:(this.index++,this.lines[index])}},morpheus.MafFileReader=function(){this.geneFilter=null},morpheus.MafFileReader.summarizeMutations=function(options){var dataset=options.dataset,fields=options.fields,count=fields.length,vector=dataset.getRowMetadata().add("mutation_summary");vector.getProperties().set(morpheus.VectorKeys.FIELDS,fields),vector.getProperties().set(morpheus.VectorKeys.DATA_TYPE,"[number]");for(var i=0,nrows=dataset.getRowCount();i<nrows;i++){for(var bins=new Int32Array(count),j=0,ncols=dataset.getColumnCount();j<ncols;j++){var value=dataset.getValue(i,j);value>0&&bins[value-1]++}vector.setValue(i,bins)}},morpheus.MafFileReader.getField=function(fieldNames,headerToIndex){for(var name,index,i=0;i<fieldNames.length;i++){if(void 0!==(index=headerToIndex[(name=fieldNames[i]).toLowerCase()]))break}if(void 0!==index)return{name:name,index:index}},morpheus.MafFileReader.VARIANT_MAP=new morpheus.Map,morpheus.MafFileReader.VARIANT_MAP.set("Silent",1),morpheus.MafFileReader.VARIANT_MAP.set("In_Frame_Del",2),morpheus.MafFileReader.VARIANT_MAP.set("In_Frame_Ins",2),morpheus.MafFileReader.VARIANT_MAP.set("Inframe_Del",2),morpheus.MafFileReader.VARIANT_MAP.set("Inframe_Ins",2),morpheus.MafFileReader.VARIANT_MAP.set("Translation_Start_Site",3),morpheus.MafFileReader.VARIANT_MAP.set("Nonstop_Mutation",3),morpheus.MafFileReader.VARIANT_MAP.set("3'UTR",3),morpheus.MafFileReader.VARIANT_MAP.set("3'Flank",3),morpheus.MafFileReader.VARIANT_MAP.set("5'UTR",3),morpheus.MafFileReader.VARIANT_MAP.set("5'Flank",3),morpheus.MafFileReader.VARIANT_MAP.set("IGR",3),morpheus.MafFileReader.VARIANT_MAP.set("Intron",3),morpheus.MafFileReader.VARIANT_MAP.set("RNA",3),morpheus.MafFileReader.VARIANT_MAP.set("Targeted_Region",3),morpheus.MafFileReader.VARIANT_MAP.set("Unknown",3),morpheus.MafFileReader.VARIANT_MAP.set("1DEL",3),morpheus.MafFileReader.VARIANT_MAP.set("HA",3),morpheus.MafFileReader.VARIANT_MAP.set("Missense_Mutation",4),morpheus.MafFileReader.VARIANT_MAP.set("Missense",4),morpheus.MafFileReader.VARIANT_MAP.set("Splice_Site",5),morpheus.MafFileReader.VARIANT_MAP.set("Splice_Acceptor",5),morpheus.MafFileReader.VARIANT_MAP.set("Splice_Region",5),morpheus.MafFileReader.VARIANT_MAP.set("Frame_Shift_Del",6),morpheus.MafFileReader.VARIANT_MAP.set("Frame_Shift_Ins",6),morpheus.MafFileReader.VARIANT_MAP.set("Frameshift",6),morpheus.MafFileReader.VARIANT_MAP.set("Nonsense_Mutation",7),morpheus.MafFileReader.VARIANT_MAP.set("Nonsense",7),morpheus.MafFileReader.VARIANT_MAP.set("2DEL",7),morpheus.MafFileReader.FIELD_NAMES=["Synonymous","In Frame Indel","Other Non-Synonymous","Missense","Splice Site","Frame Shift","Nonsense"],morpheus.MafFileReader.prototype={setGeneFilter:function(geneFilter){this.geneFilter=geneFilter},getFormatName:function(){return"maf"},_getGeneLevelDataset:function(datasetName,reader){for(var headerLine=reader.readLine(),separator=morpheus.Util.detectSeparator(headerLine),header=headerLine.split(separator),headerToIndex={},i=0,length=header.length;i<length;i++)headerToIndex[header[i].toLowerCase()]=i;var sampleField=morpheus.MafFileReader.getField(["Tumor_Sample_Barcode","tumor_name","Tumor_Sample_UUID","cell_line_name"],headerToIndex),encodingField=morpheus.MafFileReader.getField(["encoding"],headerToIndex);if(null==sampleField)throw new Error("Sample id column not found.");var ccfColumnIndex,encodingColumnIndex=null==encodingField?-1:encodingField.index,sampleIdColumnIndex=(sampleField.name,sampleField.index),tumorFractionField=morpheus.MafFileReader.getField(["ccf_hat","tumor_f","i_tumor_f"],headerToIndex);void 0!==tumorFractionField&&(tumorFractionField.name,ccfColumnIndex=tumorFractionField.index);var chromosomeColumn=headerToIndex["Chromosome".toLowerCase()],startPositionColumn=headerToIndex["Start_position".toLowerCase()],refAlleleColumn=headerToIndex["Reference_Allele".toLowerCase()],tumorAllelColumn=headerToIndex["Tumor_Seq_Allele2".toLowerCase()],proteinChangeColumn=headerToIndex["Protein_Change".toLowerCase()];null==proteinChangeColumn&&(proteinChangeColumn=headerToIndex["Protein".toLowerCase()]);var geneSymbolColumn=headerToIndex["Hugo_Symbol".toLowerCase()];if(null==geneSymbolColumn&&(geneSymbolColumn=headerToIndex.gene),null==geneSymbolColumn)throw new Error("Gene symbol column not found.");var variantColumnIndex=headerToIndex["Variant_Classification".toLowerCase()];if(null==variantColumnIndex&&(variantColumnIndex=headerToIndex["variant".toLowerCase()]),null==variantColumnIndex)throw new Error("Variant_Classification not found");for(var s,geneSymbolToIndex=new morpheus.Map,sampleIdToIndex=new morpheus.Map,variantMatrix=[],ccfMatrix=[],customNumberToValueMap=new morpheus.Map,hasMutationInfo=void 0!==chromosomeColumn&&void 0!==startPositionColumn&&void 0!==refAlleleColumn&&void 0!==tumorAllelColumn;null!==(s=reader.readLine());){var tokens=s.split(separator),sample=String(tokens[sampleIdColumnIndex]),columnIndex=sampleIdToIndex.get(sample);if(void 0===columnIndex&&(columnIndex=sampleIdToIndex.size(),sampleIdToIndex.set(sample,columnIndex)),"Unknown"!==(gene=String(tokens[geneSymbolColumn]))&&(null==this.geneFilter||this.geneFilter.has(tokens[geneSymbolColumn]))){var rowIndex=geneSymbolToIndex.get(gene);void 0===rowIndex&&(rowIndex=geneSymbolToIndex.size(),geneSymbolToIndex.set(gene,rowIndex));var variantCode,value=String(tokens[variantColumnIndex]);-1===encodingColumnIndex?void 0===(variantCode=morpheus.MafFileReader.VARIANT_MAP.get(value))&&(variantCode=3):(variantCode=parseInt(tokens[encodingColumnIndex]),customNumberToValueMap.set(variantCode,value));var variantObject={},Protein_Change=tokens[proteinChangeColumn];Protein_Change&&(variantObject.Protein=String(Protein_Change)),variantObject.__v=variantCode,variantObject.Variant=value,hasMutationInfo&&(variantObject.Mutation=String(tokens[chromosomeColumn])+":"+String(tokens[startPositionColumn])+" "+String(tokens[refAlleleColumn])+" > "+String(tokens[tumorAllelColumn]));var wrappedVariant=morpheus.Util.wrapNumber(variantCode,variantObject),variantRow=variantMatrix[rowIndex];void 0===variantRow&&(variantRow=[],variantMatrix[rowIndex]=variantRow);var ccf=-1,priorCcf=-1;if(void 0!==ccfColumnIndex){var ccfRow=ccfMatrix[rowIndex];void 0===ccfRow&&(ccfRow=[],ccfMatrix[rowIndex]=ccfRow),ccf=parseFloat(tokens[ccfColumnIndex]),priorCcf=ccfRow[columnIndex]||-1}var priorValue=variantRow[columnIndex]||-1;variantCode>priorValue?(variantRow[columnIndex]=wrappedVariant,void 0!==ccfColumnIndex&&(ccfRow[columnIndex]=ccf)):variantCode===priorValue&&ccf>priorCcf&&(variantRow[columnIndex]=wrappedVariant,ccfRow[columnIndex]=ccf)}}var dataset=new morpheus.Dataset({name:datasetName,array:variantMatrix,dataType:"Number",rows:geneSymbolToIndex.size(),columns:sampleIdToIndex.size()}),columnIds=dataset.getColumnMetadata().add("id");sampleIdToIndex.forEach(function(index,id){columnIds.setValue(index,id)});var rowIds=dataset.getRowMetadata().add("id");geneSymbolToIndex.forEach(function(index,id){rowIds.setValue(index,id)});i=0;for(var nrows=dataset.getRowCount(),ncols=dataset.getColumnCount();i<nrows;i++)for(var j=0;j<ncols;j++)void 0===variantMatrix[i][j]&&(variantMatrix[i][j]=0);if(void 0!==ccfColumnIndex&&dataset.addSeries({dataType:"Float32",name:"allelic_fraction",array:ccfMatrix}),this.geneFilter){for(var orderVector=dataset.getRowMetadata().add("order"),size=(i=0,orderVector.size());i<size;i++){var gene=rowIds.getValue(i),order=this.geneFilter.get(gene);orderVector.setValue(i,order)}var project=new morpheus.Project(dataset);project.setRowSortKeys([new morpheus.SortKey("order",morpheus.SortKey.SortOrder.ASCENDING)],!0);var tmp=project.getSortedFilteredDataset();project=new morpheus.Project(tmp);var columnIndices=morpheus.Util.seq(tmp.getColumnCount());columnIndices.sort(function(a,b){for(var i=0,nrows=tmp.getRowCount();i<nrows;i++)for(var seriesIndex=0,nseries=tmp.getSeriesCount();seriesIndex<nseries;seriesIndex++){var f1=tmp.getValue(i,a,seriesIndex);isNaN(f1)&&(f1=Number.NEGATIVE_INFINITY),f1=f1.valueOf();var f2=tmp.getValue(i,b,seriesIndex);isNaN(f2)&&(f2=Number.NEGATIVE_INFINITY);var returnVal=f1===(f2=f2.valueOf())?0:f1<f2?1:-1;if(0!==returnVal)return returnVal}return 0}),dataset=new morpheus.SlicedDatasetView(dataset,null,columnIndices)}var fieldNames=morpheus.MafFileReader.FIELD_NAMES;if(customNumberToValueMap.size()>0){var pairs=[];customNumberToValueMap.forEach(function(value,key){pairs.push({key:key,value:value})}),pairs.sort(function(a,b){return a.key===b.key?0:a.key<b.key?-1:1}),fieldNames=pairs.map(function(p){return p.value})}fieldNames.length;morpheus.MafFileReader.summarizeMutations({dataset:dataset,fields:fieldNames}),morpheus.MafFileReader.summarizeMutations({dataset:new morpheus.TransposedDatasetView(dataset),fields:fieldNames});var mutationSummarySelectionVector=dataset.getColumnMetadata().add("mutation_summary_selection");mutationSummarySelectionVector.getProperties().set(morpheus.VectorKeys.FIELDS,fieldNames),mutationSummarySelectionVector.getProperties().set(morpheus.VectorKeys.DATA_TYPE,"[number]"),mutationSummarySelectionVector.getProperties().set(morpheus.VectorKeys.RECOMPUTE_FUNCTION_SELECTION,!0);datasetName=dataset.getName();return mutationSummarySelectionVector.getProperties().set(morpheus.VectorKeys.FUNCTION,{binSize:1,domain:[1,8],cumulative:!1}),dataset},read:function(fileOrUrl,callback){var _this=this,name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl));morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){if(err)callback(err);else try{callback(null,_this._getGeneLevelDataset(name,new morpheus.ArrayBufferReader(new Uint8Array(arrayBuffer))))}catch(err){callback(err)}})}},morpheus.MtxReader=function(){},morpheus.MtxReader.prototype={getFormatName:function(){return"mtx"},read:function(fileOrUrl,callback){morpheus.Util.isFile(fileOrUrl)?this._read(fileOrUrl,callback,!1,!0):morpheus.Util.isFetchStreamingSupported()?this._read(fileOrUrl,callback,!0,!0):this._read(fileOrUrl,callback,!1,!1)},_read:function(fileOrUrl,callback,useFetch,chunk){var dataset,nrows,ncols,isHeader=!0,matrix=[],lastRowIndex=-1,lastColumnIndex=-1,_complete=function(){for(var rowCounts=new Uint32Array(nrows),columnCounts=new Uint32Array(ncols),i=0;i<nrows;i++){var obj=matrix[i];if(null!=obj.values){var values=new Uint16Array(obj.length),indices=new Uint32Array(obj.length);values.set(obj.values.slice(0,obj.length)),indices.set(obj.indices.slice(0,obj.length)),matrix[i]={values:values,indices:indices},rowCounts[i]=values.length;for(var j=0;j<obj.length;j++)columnCounts[indices[j]]+=1}}(dataset=new morpheus.Dataset({rows:nrows,columns:ncols,name:morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl)),array:matrix,dataType:"Int16",defaultValue:0})).getRowMetadata().add("count>0").array=rowCounts,dataset.getColumnMetadata().add("count>0").array=columnCounts},handleTokens=function(tokens){if("%"!==tokens[0][0]&&1!==tokens.length)if(isHeader){isHeader=!1,nrows=parseInt(tokens[0]),ncols=parseInt(tokens[1]);for(var i=0;i<nrows;i++)matrix.push({})}else{var rowIndex=parseInt(tokens[0])-1,columnIndex=parseInt(tokens[1])-1,value=parseInt(tokens[2]),obj=matrix[rowIndex];if(null==obj.values){var initalCapacity=Math.max(1,Math.min(100,Math.floor(.01*ncols)));obj.values=new Uint16Array(initalCapacity),obj.indices=new Uint32Array(initalCapacity),obj.length=0}if(obj.length>=obj.values.length){var newCapacity=Math.min(ncols,Math.floor(1.1*obj.values.length)),values=new Uint16Array(newCapacity),indices=new Uint32Array(newCapacity);values.set(obj.values),indices.set(obj.indices),obj.values=values,obj.indices=indices}obj.values[obj.length]=value,obj.indices[obj.length]=columnIndex,obj.length++,rowIndex!==lastRowIndex&&(lastColumnIndex=-1,lastRowIndex=rowIndex),columnIndex<lastColumnIndex&&callback(new Error("Column indices are not sorted"))}};chunk?(useFetch?morpheus.BufferedReader:Papa).parse(fileOrUrl,{delimiter:" ",newline:"",header:!1,dynamicTyping:!1,preview:0,encoding:"",worker:!1,comments:!1,handleTokens:handleTokens,step:function(result){handleTokens(result.data[0])},complete:function(){_complete(),callback(null,dataset)},error:function(err){callback(err)},download:!morpheus.Util.isFile(fileOrUrl),skipEmptyLines:!1,chunk:void 0,fastMode:!0,beforeFirstChunk:void 0,withCredentials:void 0}):morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){if(err)callback(err);else{for(var s,reader=new morpheus.ArrayBufferReader(new Uint8Array(arrayBuffer)),delim=/ /;null!==(s=reader.readLine());)if("%"!==s[0]){var tokens=s.split(delim);handleTokens(tokens)}_complete(),callback(null,dataset)}})}},morpheus.SegTabReader=function(){this.regions=null},morpheus.SegTabReader.binByRegion=function(dataset,regions){var chromosomeVector=dataset.getRowMetadata().getByName("Chromosome"),startVector=dataset.getRowMetadata().getByName("Start_bp"),endVector=dataset.getRowMetadata().getByName("End_bp"),collapsedDataset=new morpheus.Dataset({name:dataset.getName(),rows:regions.length,columns:dataset.getColumnCount(),dataType:"Float32"});morpheus.DatasetUtil.fill(collapsedDataset,NaN);for(var regionIdVector=collapsedDataset.getRowMetadata().add("id"),newChromosomeVector=collapsedDataset.getRowMetadata().add("chromosome"),newStartVector=collapsedDataset.getRowMetadata().add("start"),newEndVector=collapsedDataset.getRowMetadata().add("end"),nsegmentsVector=collapsedDataset.getRowMetadata().add("nsegments"),nseries=dataset.getSeriesCount(),series=1;series<nseries;series++)collapsedDataset.addSeries({name:dataset.getName(series),dataType:"Float32"});var summarizeFunction=morpheus.Mean;collapsedDataset.setColumnMetadata(dataset.getColumnMetadata());for(var regionIndex=0;regionIndex<regions.length;regionIndex++){for(var region=regions[regionIndex],rowIndices=[],i=0,nrows=dataset.getRowCount();i<nrows;i++){var chromosome=chromosomeVector.getValue(i),start=startVector.getValue(i),end=endVector.getValue(i);region.chromosome==chromosome&&start>=region.start&&end<=region.end&&rowIndices.push(i)}if(rowIndices.length>0)for(var slice=new morpheus.SlicedDatasetView(dataset,rowIndices,null),columnView=new morpheus.DatasetColumnView(slice),j=0;j<dataset.getColumnCount();j++){columnView.setIndex(j);for(series=0;series<nseries;series++)columnView.setSeriesIndex(series),collapsedDataset.setValue(regionIndex,j,summarizeFunction(columnView),series)}nsegmentsVector.setValue(regionIndex,rowIndices.length),regionIdVector.setValue(regionIndex,region.id),newChromosomeVector.setValue(regionIndex,region.chromosome),newStartVector.setValue(regionIndex,region.start),newEndVector.setValue(regionIndex,region.end)}return collapsedDataset},morpheus.SegTabReader.prototype={getFormatName:function(){return"seg"},setRegions:function(regions){this.regions=regions},_read:function(datasetName,reader){for(var tab=/\t/,header=reader.readLine().split(tab),fieldNameToIndex={},i=0,length=header.length;i<length;i++){fieldNameToIndex[header[i].toLowerCase()]=i}var ccfColumnIndex,sampleField=morpheus.MafFileReader.getField(["pair_id","Tumor_Sample_Barcode","tumor_name","Tumor_Sample_UUID","Sample"],fieldNameToIndex),sampleIdColumnIndex=(sampleField.name,sampleField.index),tumorFractionField=morpheus.MafFileReader.getField(["ccf_hat","tumor_f","i_tumor_f"],fieldNameToIndex);void 0!==tumorFractionField&&(tumorFractionField.name,ccfColumnIndex=tumorFractionField.index);for(var s,chromosomeColumn=fieldNameToIndex.Chromosome,startPositionColumn=morpheus.MafFileReader.getField(["Start_bp","Start"],fieldNameToIndex).index,endPositionColumn=morpheus.MafFileReader.getField(["End_bp","End"],fieldNameToIndex,{remove:!1,lc:!0}).index,valueField=morpheus.MafFileReader.getField(["tau","Segment_Mean"]).index,matrix=[],ccfMatrix=[],sampleIdToIndex=new morpheus.Map,chromosomeStartEndToIndex=new morpheus.Map;null!==(s=reader.readLine());)if(""!==s){var tokens=s.split(tab),sample=String(tokens[sampleIdColumnIndex]),columnIndex=sampleIdToIndex.get(sample);void 0===columnIndex&&(columnIndex=sampleIdToIndex.size(),sampleIdToIndex.set(sample,columnIndex));var rowId=new morpheus.Identifier([String(tokens[chromosomeColumn]),String(tokens[startPositionColumn]),String(tokens[endPositionColumn])]),rowIndex=chromosomeStartEndToIndex.get(rowId);void 0===rowIndex&&(rowIndex=chromosomeStartEndToIndex.size(),chromosomeStartEndToIndex.set(rowId,rowIndex));var value=parseFloat(String(tokens[valueField]));value=isNaN(value)?value:morpheus.Log2(value)-1;var matrixRow=matrix[rowIndex];void 0===matrixRow&&(matrixRow=[],matrix[rowIndex]=matrixRow,void 0!==ccfColumnIndex&&(ccfMatrix[rowIndex]=[])),matrixRow[columnIndex]=value,void 0!==ccfColumnIndex&&(ccfMatrix[rowIndex][columnIndex]=parseFloat(tokens[ccfColumnIndex]))}var dataset=new morpheus.Dataset({name:datasetName,array:matrix,dataType:"number",rows:chromosomeStartEndToIndex.size(),columns:sampleIdToIndex.size()}),columnIds=dataset.getColumnMetadata().add("id");sampleIdToIndex.forEach(function(index,id){columnIds.setValue(index,id)});var chromosomeVector=dataset.getRowMetadata().add("Chromosome"),startVector=dataset.getRowMetadata().add("Start_bp"),endVector=dataset.getRowMetadata().add("End_bp");return chromosomeStartEndToIndex.forEach(function(index,id){chromosomeVector.setValue(index,id.getArray()[0]),startVector.setValue(index,id.getArray()[1]),endVector.setValue(index,id.getArray()[2])}),void 0!==ccfColumnIndex&&dataset.addSeries({dataType:"number",name:"ccf",array:ccfMatrix}),null!=this.regions&&this.regions.length>0&&(dataset=morpheus.SegTabReader.binByRegion(dataset,this.regions)),dataset},read:function(fileOrUrl,callback){var _this=this,name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl));morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){err?callback(err):callback(null,_this._read(name,new morpheus.ArrayBufferReader(new Uint8Array(arrayBuffer))))})}},morpheus.TcgaUtil=function(){},morpheus.TcgaUtil.DISEASE_STUDIES={ACC:"Adrenocortical carcinoma",BLCA:"Bladder Urothelial Carcinoma",BRCA:"Breast invasive carcinoma",CESC:"Cervical squamous cell carcinoma and endocervical adenocarcinoma",CHOL:"Cholangiocarcinoma",COAD:"Colon adenocarcinoma",COADREAD:"Colonrectal adenocarcinoma",DLBC:"Lymphoid Neoplasm Diffuse Large B-cell Lymphoma",ESCA:"Esophageal carcinoma ",GBM:"Glioblastoma multiforme",GBMLGG:"Glioma",HNSC:"Head and Neck squamous cell carcinoma",KICH:"Kidney Chromophobe",KIPAN:"Pan-Kidney Cohort",KIRC:"Kidney renal clear cell carcinoma",KIRP:"Kidney renal papillary cell carcinoma",LAML:"Acute Myeloid Leukemia",LCML:"Chronic Myelogenous Leukemia",LGG:"Brain Lower Grade Glioma",LIHC:"Liver hepatocellular carcinoma",LUAD:"Lung adenocarcinoma",LUSC:"Lung squamous cell carcinoma",MESO:"Mesothelioma",OV:"Ovarian serous cystadenocarcinoma",PAAD:"Pancreatic adenocarcinoma",PCPG:"Pheochromocytoma and Paraganglioma",PRAD:"Prostate adenocarcinoma",READ:"Rectum adenocarcinoma",SARC:"Sarcoma",SKCM:"Skin Cutaneous Melanoma",STAD:"Stomach adenocarcinoma",STES:"Stomach and Esophageal Carcinoma",TGCT:"Testicular Germ Cell Tumors",THCA:"Thyroid carcinoma",THYM:"Thymoma",UCEC:"Uterine Corpus Endometrial Carcinoma",UCS:"Uterine Carcinosarcoma",UVM:"Uveal Melanoma"},morpheus.TcgaUtil.SAMPLE_TYPES={"01":"Primary solid Tumor","02":"Recurrent Solid Tumor","03":"Primary Blood Derived Cancer - Peripheral Blood","04":"Recurrent Blood Derived Cancer - Bone Marrow","05":"Additional - New Primary","06":"Metastatic","07":"Additional Metastatic","08":"Human Tumor Original Cells","09":"Primary Blood Derived Cancer - Bone Marrow",10:"Blood Derived Normal",11:"Solid Tissue Normal",12:"Buccal Cell Normal",13:"EBV Immortalized Normal",14:"Bone Marrow Normal",20:"Control Analyte",40:"Recurrent Blood Derived Cancer - Peripheral Blood",50:"Cell Lines",60:"Primary Xenograft Tissue",61:"Cell Line Derived Xenograft Tissue"},morpheus.TcgaUtil.barcode=function(s){var sampleType,tokens=s.split("-"),id=tokens[2];return tokens.length>3?((sampleType=tokens[3]).length>2&&(sampleType=sampleType.substring(0,2)),sampleType=morpheus.TcgaUtil.SAMPLE_TYPES[sampleType]):sampleType=morpheus.TcgaUtil.SAMPLE_TYPES["01"],{id:id.toLowerCase(),sampleType:sampleType}},morpheus.TcgaUtil.setIdAndSampleType=function(dataset){for(var idVector=dataset.getColumnMetadata().get(0),participantId=dataset.getColumnMetadata().add("participant_id"),sampleType=dataset.getColumnMetadata().add("sample_type"),i=0,size=idVector.size();i<size;i++){var barcode=morpheus.TcgaUtil.barcode(idVector.getValue(i));idVector.setValue(i,barcode.id+"-"+barcode.sampleType),sampleType.setValue(i,barcode.sampleType),participantId.setValue(i,barcode.id)}},morpheus.TcgaUtil.getDataset=function(options){var sigGenesLines,promises=[],datasets=[];if(options.mrna&&promises.push(new Promise(function(resolve,reject){(new morpheus.TxtReader).read(options.mrna,function(err,dataset){err?console.log("Error reading file:"+err):(datasets.push(dataset),morpheus.TcgaUtil.setIdAndSampleType(dataset)),resolve()})})),options.mutation){promises.push(new Promise(function(resolve,reject){(new morpheus.MafFileReader).read(options.mutation,function(err,dataset){err?console.log("Error reading file:"+err):(datasets.push(dataset),morpheus.TcgaUtil.setIdAndSampleType(dataset)),resolve()})}));var sigGenesAnnotation=morpheus.Util.readLines(options.sigGenes);sigGenesAnnotation.then(function(lines){sigGenesLines=lines}),promises.push(sigGenesAnnotation)}options.gistic&&promises.push(new Promise(function(resolve,reject){(new morpheus.GisticReader).read(options.gistic,function(err,dataset){err?console.log("Error reading file:"+err):(datasets.push(dataset),morpheus.TcgaUtil.setIdAndSampleType(dataset)),resolve()})})),options.gisticGene&&promises.push(new Promise(function(resolve,reject){new morpheus.TxtReader({dataColumnStart:3}).read(options.gisticGene,function(err,dataset){err?console.log("Error reading file:"+err):(datasets.push(dataset),morpheus.TcgaUtil.setIdAndSampleType(dataset)),resolve()})})),options.seg&&promises.push(new Promise(function(resolve,reject){(new morpheus.SegTabReader).read(options.seg,function(err,dataset){err?console.log("Error reading file:"+err):(datasets.push(dataset),morpheus.TcgaUtil.setIdAndSampleType(dataset)),resolve()})})),options.rppa&&promises.push(new Promise(function(resolve,reject){new morpheus.TxtReader({dataColumnStart:2}).read(options.rppa,function(err,dataset){err?console.log("Error reading file:"+err):(datasets.push(dataset),morpheus.TcgaUtil.setIdAndSampleType(dataset)),resolve()})})),options.methylation&&promises.push(new Promise(function(resolve,reject){new morpheus.TxtReader({}).read(options.methylation,function(err,dataset){err?console.log("Error reading file:"+err):(datasets.push(dataset),morpheus.TcgaUtil.setIdAndSampleType(dataset)),resolve()})}));var sampleIdToClusterId,mrnaClustPromise=morpheus.Util.readLines(options.mrnaClust);promises.push(mrnaClustPromise),mrnaClustPromise.then(function(lines){sampleIdToClusterId=new morpheus.Map;for(var lineNumber=0;-1!==lines[lineNumber].indexOf("SampleName");)lineNumber++;for(var tab=/\t/;lineNumber<lines.length;lineNumber++){var tokens=lines[lineNumber].split(tab),barcode=morpheus.TcgaUtil.barcode(tokens[0]);sampleIdToClusterId.set(barcode.id+"-"+barcode.sampleType,tokens[1])}});var annotationCallbacks=[],annotationDef=null;return options.columnAnnotations&&(annotationDef=morpheus.DatasetUtil.annotate({annotations:options.columnAnnotations,isColumns:!0}),promises.push(annotationDef),annotationDef.then(function(array){annotationCallbacks=array})),Promise.all(promises).then(function(){var datasetToReturn=null;if(1===datasets.length){for(var sourceName=datasets[0].getName(),sourceVector=datasets[0].getRowMetadata().add("Source"),i=0;i<sourceVector.size();i++)sourceVector.setValue(i,sourceName);datasetToReturn=datasets[0]}else{var maxIndex=0,maxColumns=datasets[0].getColumnCount();for(i=1;i<datasets.length;i++)datasets[i].getColumnCount()>maxColumns&&(maxColumns=datasets[i].getColumnCount(),maxIndex=i),"mutations_merged.maf"===datasets[i].getName()&&(maxColumns=Number.MAX_VALUE,maxIndex=i);var datasetIndices=[];datasetIndices.push(maxIndex);for(i=0;i<datasets.length;i++)i!==maxIndex&&datasetIndices.push(i);var joined=new morpheus.JoinedDataset(datasets[datasetIndices[0]],datasets[datasetIndices[1]],"id","id");for(i=2;i<datasetIndices.length;i++)joined=new morpheus.JoinedDataset(joined,datasets[datasetIndices[i]],"id","id");datasetToReturn=joined}for(var clusterIdVector=datasetToReturn.getColumnMetadata().add("mRNAseq_cluster"),idVector=datasetToReturn.getColumnMetadata().getByName("id"),j=0,size=idVector.size();j<size;j++)clusterIdVector.setValue(j,sampleIdToClusterId.get(idVector.getValue(j)));if(options.mutation){var sourceToIndices=morpheus.VectorUtil.createValueToIndicesMap(datasetToReturn.getRowMetadata().getByName("Source")),mutationDataset=new morpheus.SlicedDatasetView(datasetToReturn,sourceToIndices.get("mutations_merged.maf"));(new morpheus.OpenFileTool).annotate({lines:sigGenesLines,dataset:mutationDataset,isColumns:!1,metadataName:"id",fileColumnName:"gene",fileColumnNamesToInclude:["q"]});var qVector=mutationDataset.getRowMetadata().getByName("q"),qValueVector=mutationDataset.getRowMetadata().getByName("q_value");null==qValueVector&&(qValueVector=mutationDataset.getRowMetadata().add("q_value"));for(i=0,size=qValueVector.size();i<size;i++)qValueVector.setValue(i,qVector.getValue(i));mutationDataset.getRowMetadata().remove(morpheus.MetadataUtil.indexOf(mutationDataset.getRowMetadata(),"q"))}return annotationDef&&annotationCallbacks.forEach(function(f){f(datasetToReturn)}),Promise.resolve(datasetToReturn)})},morpheus.TxtReader=function(options){null==options&&(options={}),this.options=options},morpheus.TxtReader.prototype={read:function(fileOrUrl,callback){var _this=this,name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl));morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){if(err)callback(err);else try{callback(null,_this._read(name,new morpheus.ArrayBufferReader(new Uint8Array(arrayBuffer))))}catch(x){callback(x)}})},_read:function(datasetName,reader){var dataColumnStart=this.options.dataColumnStart,dataRowStart=this.options.dataRowStart;null==dataRowStart&&(dataRowStart=1);var headerLine=reader.readLine(),separator=morpheus.Util.detectSeparator(headerLine),testLine=null,rtrim=/\s+$/,header=headerLine.split(separator);if(null==dataColumnStart){for(var tokens=(testLine=reader.readLine().replace(rtrim,"")).split(separator),i=1;i<tokens.length;i++){if(""===(token=tokens[i])||"NA"===token||"NaN"===token||$.isNumeric(token)){dataColumnStart=i;break}}null==dataColumnStart&&(dataColumnStart=1)}var columnVectors=[],ncols=header.length-dataColumnStart;if(dataRowStart>1)if(this.options.columnMetadata)for(var row=1;row<dataRowStart;row++){var columnTokens=reader.readLine().split(separator),name=columnTokens[0];null!=name&&""!==name&&"na"!==name||(name="id");for(var v=new morpheus.Vector(name,ncols),j=(i=0,dataColumnStart);i<ncols;i++,j++)v.setValue(i,morpheus.Util.copyString(columnTokens[j]));columnVectors.push(v)}else for(i=1;i<dataRowStart;i++)reader.readLine();var s,matrix=[],arrayOfRowArrays=[];for(i=0;i<dataColumnStart;i++)arrayOfRowArrays.push([]);var isSparse=!1;if(null==testLine&&(testLine=reader.readLine()),null!=testLine){var tmp=new Float32Array(ncols);for(tokens=testLine.split(separator),j=0;j<dataColumnStart;j++)arrayOfRowArrays[j].push(morpheus.Util.copyString(tokens[j]));for(var nzero=0,k=(j=dataColumnStart,0);k<ncols;j++,k++){var token=tokens[j];0===(value=parseFloat(token))&&nzero++,tmp[j-dataColumnStart]=value}if(nzero/tmp.length>.3){isSparse=!0;var obj={values:new Float32Array(tmp.length-nzero),indices:new Uint32Array(tmp.length-nzero)};for(j=0,k=0;j<tmp.length;j++)0!==tmp[j]&&(obj.values[k]=tmp[j],obj.indices[k]=j,k++);tmp=obj}matrix.push(tmp)}for(;null!==(s=reader.readLine());)if(""!==(s=s.replace(rtrim,""))){for(tokens=s.split(separator),j=0;j<dataColumnStart;j++)arrayOfRowArrays[j].push(morpheus.Util.copyString(tokens[j]));var values=new Float32Array(ncols);for(j=dataColumnStart,k=0;k<ncols;j++,k++){token=tokens[j];var value=parseFloat(token);values[j-dataColumnStart]=value}if(isSparse){var count=0;for(j=0,k=0;j<ncols;j++)0!==values[j]&&count++;for(obj={values:new Float32Array(count),indices:new Uint32Array(count)},j=0,k=0;j<ncols;j++)0!==values[j]&&(obj.values[k]=values[j],obj.indices[k]=j,k++);matrix.push(obj)}else matrix.push(values)}var dataset=new morpheus.Dataset({name:datasetName,rows:matrix.length,columns:ncols,array:matrix,dataType:"Float32",defaultValue:isSparse?0:void 0}),columnIds=dataset.getColumnMetadata().add("id");for(i=0,j=dataColumnStart;i<ncols;i++,j++)columnIds.setValue(i,morpheus.Util.copyString(header[j]));columnVectors.forEach(function(v){for(var unique=1,name=v.getName();null!=dataset.getColumnMetadata().getByName(name);)name=name+"-"+unique,unique++;dataset.getColumnMetadata().add(name).array=v.array}),dataset.getRowMetadata().add("id").array=arrayOfRowArrays[0];for(i=1;i<dataColumnStart;i++){(v=dataset.getRowMetadata().add(header[i])).array=arrayOfRowArrays[i]}for(i=0;i<dataset.getRowMetadata().getMetadataCount();i++)morpheus.VectorUtil.maybeConvertStringToNumber(dataset.getRowMetadata().get(i));for(i=0;i<dataset.getColumnMetadata().getMetadataCount();i++)morpheus.VectorUtil.maybeConvertStringToNumber(dataset.getColumnMetadata().get(i));return dataset}},morpheus.XlsxDatasetReader=function(){},morpheus.XlsxDatasetReader.prototype={read:function(fileOrUrl,callback){var _this=this,name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl));morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,arrayBuffer){if(err)callback(err);else try{for(var data=new Uint8Array(arrayBuffer),arr=[],i=0;i!=data.length;++i)arr[i]=String.fromCharCode(data[i]);var bstr=arr.join("");_this._read(name,bstr,callback)}catch(x){callback(x)}})},_read:function(datasetName,bstr,callback){morpheus.Util.xlsxTo2dArray({data:bstr},function(err,lines){for(var nrows=lines.length-1,header=lines[0],ncols=header.length-1,dataset=new morpheus.Dataset({name:datasetName,rows:nrows,columns:ncols}),columnIds=dataset.getColumnMetadata().add("id"),j=1;j<=ncols;j++)columnIds.setValue(j-1,header[j]);for(var rowIds=dataset.getRowMetadata().add("id"),i=1;i<lines.length;i++){var tokens=lines[i];rowIds.setValue(i-1,tokens[0]);for(j=1;j<=ncols;j++){var token=tokens[j],value=parseFloat(token);dataset.setValue(i-1,j-1,value)}}callback(null,dataset)})}},morpheus.VectorAdapter=function(v){if(null==v)throw"vector is null";this.v=v},morpheus.VectorAdapter.prototype={setValue:function(i,value){this.v.setValue(i,value)},getValue:function(i){return this.v.getValue(i)},getProperties:function(){return this.v.getProperties()},size:function(){return this.v.size()},getName:function(){return this.v.getName()},setName:function(name){this.v.setName(name)}},morpheus.AbstractDataset=function(rows,columns){this.seriesNames=[],this.seriesArrays=[],this.seriesDataTypes=[],this.rows=rows,this.columns=columns,this.rowMetadataModel=new morpheus.MetadataModel(rows),this.columnMetadataModel=new morpheus.MetadataModel(columns)},morpheus.AbstractDataset.prototype={setRowMetadata:function(metadata){this.rowMetadataModel=metadata},setColumnMetadata:function(metadata){this.columnMetadataModel=metadata},getName:function(seriesIndex){return this.seriesNames[seriesIndex||0]},setName:function(seriesIndex,name){this.seriesNames[seriesIndex||0]=name},getRowMetadata:function(){return this.rowMetadataModel},getColumnMetadata:function(){return this.columnMetadataModel},getRowCount:function(){return this.rows},getColumnCount:function(){return this.columns},getValue:function(rowIndex,columnIndex,seriesIndex){},setValue:function(rowIndex,columnIndex,value,seriesIndex){},addSeries:function(options){},removeSeries:function(seriesIndex){this.seriesArrays.splice(seriesIndex,1),this.seriesNames.splice(seriesIndex,1),this.seriesDataTypes.splice(seriesIndex,1)},getSeriesCount:function(){return this.seriesArrays.length},getDataType:function(seriesIndex){return this.seriesDataTypes[seriesIndex||0]},toString:function(){return this.getName()}},morpheus.AbstractVector=function(name,size){this.name=name,this.n=size,this.properties=new morpheus.Map},morpheus.AbstractVector.prototype={getValue:function(index){throw new Error("Not implemented")},getProperties:function(){return this.properties},size:function(){return this.n},getName:function(){return this.name}},morpheus.SignalToNoise=function(list1,list2){var m1=morpheus.Mean(list1),m2=morpheus.Mean(list2);return(m1-m2)/(Math.sqrt(morpheus.Variance(list1,m1))+Math.sqrt(morpheus.Variance(list2,m2)))},morpheus.SignalToNoise.toString=function(){return"Signal to noise"},morpheus.createSignalToNoiseAdjust=function(percent){percent=percent||.2;var f=function(list1,list2){var m1=morpheus.Mean(list1),m2=morpheus.Mean(list2),s1=Math.sqrt(morpheus.Variance(list1,m1)),s2=Math.sqrt(morpheus.Variance(list2,m2));return(m1-m2)/((s1=morpheus.SignalToNoise.thresholdStandardDeviation(m1,s1,percent))+(s2=morpheus.SignalToNoise.thresholdStandardDeviation(m2,s2,percent)))};return f.toString=function(){return"Signal to noise (adjust standard deviation)"},f},morpheus.SignalToNoise.thresholdStandardDeviation=function(mean,standardDeviation,percent){var returnValue=standardDeviation,minStdev=percent*Math.abs(mean);return minStdev>standardDeviation&&(returnValue=minStdev),returnValue<percent&&(returnValue=percent),returnValue},morpheus.createContingencyTable=function(listOne,listTwo,groupingValue){(null==groupingValue||isNaN(groupingValue))&&(groupingValue=1);for(var aHit=0,aMiss=0,j=0,size=listOne.size();j<size;j++){var val=listOne.getValue(j);isNaN(val)||(val>=groupingValue?aHit++:aMiss++)}var bHit=0,bMiss=0;for(j=0,size=listTwo.size();j<size;j++){val=listTwo.getValue(j);isNaN(val)||(val>=groupingValue?bHit++:bMiss++)}var K=aHit+bHit,n=aHit+aMiss;return[aHit,K-aHit,n-aHit,aHit+aMiss+bHit+bMiss+aHit-n-K]},morpheus.FisherExact=function(listOne,listTwo){var abcd=morpheus.createContingencyTable(listOne,listTwo,1);return morpheus.FisherExact.fisherTest(abcd[0],abcd[1],abcd[2],abcd[3])},morpheus.createFisherExact=function(groupingValue){return function(listOne,listTwo){var abcd=morpheus.createContingencyTable(listOne,listTwo,groupingValue);return morpheus.FisherExact.fisherTest(abcd[0],abcd[1],abcd[2],abcd[3])}},morpheus.FisherExact.phyper=function(a,b,c,d){return Math.exp(morpheus.FisherExact.logFactorial(a+b)+morpheus.FisherExact.logFactorial(c+d)+morpheus.FisherExact.logFactorial(a+c)+morpheus.FisherExact.logFactorial(b+d)-(morpheus.FisherExact.logFactorial(a)+morpheus.FisherExact.logFactorial(b)+morpheus.FisherExact.logFactorial(c)+morpheus.FisherExact.logFactorial(d)+morpheus.FisherExact.logFactorial(a+b+c+d)))},morpheus.FisherExact.logFactorials=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469,15.104412573075516,17.502307845873887,19.987214495661885,22.552163853123425,25.19122118273868,27.89927138384089,30.671860106080672,33.50507345013689,36.39544520803305,39.339884187199495,42.335616460753485,45.38013889847691,48.47118135183523,51.60667556776438,54.78472939811232,58.00360522298052,61.261701761002,64.55753862700634,67.88974313718154,71.25703896716801],morpheus.FisherExact.logFactorial=function(k){if(k>=30){var r=1/k,rr=r*r;return(k+.5)*Math.log(k)-k+.9189385332046728+r*(.08333333333333333+rr*(rr*(.0007936507936507937+-.0005952380952380953*rr)-.002777777777777778))}return morpheus.FisherExact.logFactorials[k]},morpheus.FisherExact.fisherTest=function(a,b,c,d){for(var p=morpheus.FisherExact.phyper(a,b,c,d),sum=p,_a=0,n=a+b+c+d;_a<=n;_a++){var _b=a+b-_a,_c=a+c-_a,_d=b+d-_b;if(_a!==a&&_b>=0&&_c>=0&&_d>=0){var _p=morpheus.FisherExact.phyper(_a,_b,_c,_d);_p<=p&&(sum+=_p)}}return Math.min(1,sum)},morpheus.FisherExact.toString=function(){return"Fisher Exact Test"},morpheus.FoldChange=function(list1,list2){return morpheus.Mean(list1)/morpheus.Mean(list2)},morpheus.FoldChange.toString=function(){return"Fold Change"},morpheus.MeanDifference=function(list1,list2){return morpheus.Mean(list1)-morpheus.Mean(list2)},morpheus.MeanDifference.toString=function(){return"Mean Difference"},morpheus.TTest=function(list1,list2){var m1=morpheus.Mean(list1),m2=morpheus.Mean(list2),s1=Math.sqrt(morpheus.Variance(list1,m1)),s2=Math.sqrt(morpheus.Variance(list2,m2)),n1=morpheus.CountNonNaN(list1),n2=morpheus.CountNonNaN(list2);return(m1-m2)/Math.sqrt(s1*s1/n1+s2*s2/n2)},morpheus.TTest.toString=function(){return"T-Test"},morpheus.DegreesOfFreedom=function(v1,v2,n1,n2){return(v1/n1+v2/n2)*(v1/n1+v2/n2)/(v1*v1/(n1*n1*(n1-1))+v2*v2/(n2*n2*(n2-1)))},morpheus.Spearman=function(list1,list2){for(var flist1=[],flist2=[],i=0,n=list1.size();i<n;i++){var v1=list1.getValue(i),v2=list2.getValue(i);isNaN(v1)||isNaN(v2)||(flist1.push(v1),flist2.push(v2))}var rank1=morpheus.Ranking(flist1),rank2=morpheus.Ranking(flist2);return morpheus.Pearson(new morpheus.Vector("",rank1.length).setArray(rank1),new morpheus.Vector("",rank2.length).setArray(rank2))},morpheus.Spearman.toString=function(){return"Spearman rank correlation"},morpheus.WeightedMean=function(weights,values){for(var numerator=0,denom=0,i=0,size=values.size();i<size;i++){var value=values.getValue(i);if(!isNaN(value)){var weight=Math.abs(weights.getValue(i));isNaN(weight)||(numerator+=weight*value,denom+=weight)}}return 0===denom?NaN:numerator/denom},morpheus.WeightedMean.toString=function(){return"Weighted average"},morpheus.createOneMinusMatrixValues=function(dataset){var f=function(listOne,listTwo){return 1-dataset.getValue(listOne.getIndex(),listTwo.getIndex())};return f.toString=function(){return"One minus matrix values (for a precomputed similarity matrix)"},f},morpheus.Pearson=function(listOne,listTwo){for(var sumx=0,sumxx=0,sumy=0,sumyy=0,sumxy=0,N=0,i=0,size=listOne.size();i<size;i++){var x=listOne.getValue(i),y=listTwo.getValue(i);isNaN(x)||isNaN(y)||(sumx+=x,sumxx+=x*x,sumy+=y,sumyy+=y*y,sumxy+=x*y,N++)}var numr=sumxy-sumx*sumy/N,denr=Math.sqrt((sumxx-sumx*sumx/N)*(sumyy-sumy*sumy/N));return 0==denr?1:numr/denr},morpheus.Pearson.toString=function(){return"Pearson correlation"},morpheus.Jaccard=function(listOne,listTwo){for(var orCount=0,andCount=0,i=0,size=listOne.size();i<size;i++){var xval=listOne.getValue(i),yval=listTwo.getValue(i);if(!isNaN(xval)&&!isNaN(yval)){var x=xval>0,y=yval>0;x&&y?andCount++:(x||y)&&orCount++}}return 0===orCount?1:1-andCount/orCount},morpheus.Jaccard.toString=function(){return"Jaccard distance"},morpheus.Cosine=function(listOne,listTwo){for(var sumX2=0,sumY2=0,sumXY=0,i=0,size=listOne.size();i<size;i++){var x=listOne.getValue(i),y=listTwo.getValue(i);isNaN(x)||isNaN(y)||(sumX2+=x*x,sumY2+=y*y,sumXY+=x*y)}return sumXY/Math.sqrt(sumX2*sumY2)},morpheus.Cosine.toString=function(){return"Cosine similarity"},morpheus.Euclidean=function(x,y){for(var dist=0,i=0,size=x.size();i<size;++i){var x_i=x.getValue(i),y_i=y.getValue(i);isNaN(x_i)||isNaN(y_i)||(dist+=(x_i-y_i)*(x_i-y_i))}return Math.sqrt(dist)},morpheus.Euclidean.toString=function(){return"Euclidean distance"},morpheus.OneMinusFunction=function(f){var dist=function(x,y){return 1-f(x,y)};return dist.toString=function(){var s=f.toString();return"One minus "+s[0].toLowerCase()+s.substring(1)},dist},morpheus.LinearRegression=function(xVector,yVector){for(var sumX=0,sumY=0,sumXX=0,sumXY=0,count=0,i=0,size=xVector.size();i<size;i++){var x=xVector.getValue(i),y=yVector.getValue(i);isNaN(x)||isNaN(y)||(sumX+=x,sumY+=y,sumXX+=x*x,sumXY+=x*y,count++)}var m=(count*sumXY-sumX*sumY)/(count*sumXX-sumX*sumX);return{m:m,b:sumY/count-m*sumX/count}},morpheus.KendallsCorrelation=function(x,y){function sum(n){return n*(n+1)/2}for(var xArray=[],yArray=[],i=0,size=x.size();i<size;++i){var x_i=x.getValue(i),y_i=y.getValue(i);isNaN(x_i)||isNaN(y_i)||(xArray.push(x_i),yArray.push(y_i))}var n=xArray.length,numPairs=sum(n-1),pairs=[];for(i=0;i<n;i++)pairs[i]=[xArray[i],yArray[i]];pairs.sort(function(pair1,pair2){var a=pair1[0],b=pair2[0],compareFirst=a===b?0:a<b?-1:1;return 0!==compareFirst?compareFirst:(a=pair1[1])===(b=pair2[1])?0:a<b?-1:1});var tiedXPairs=0,tiedXYPairs=0,consecutiveXTies=1,consecutiveXYTies=1,prev=pairs[0];for(i=1;i<n;i++){(curr=pairs[i])[0]===prev[0]?(consecutiveXTies++,curr[1]===prev[1]?consecutiveXYTies++:(tiedXYPairs+=sum(consecutiveXYTies-1),consecutiveXYTies=1)):(tiedXPairs+=sum(consecutiveXTies-1),consecutiveXTies=1,tiedXYPairs+=sum(consecutiveXYTies-1),consecutiveXYTies=1),prev=curr}tiedXPairs+=sum(consecutiveXTies-1),tiedXYPairs+=sum(consecutiveXYTies-1);for(var swaps=0,pairsDestination=[],segmentSize=1;segmentSize<n;segmentSize<<=1){for(var offset=0;offset<n;offset+=2*segmentSize){i=offset;for(var iEnd=Math.min(i+segmentSize,n),j=iEnd,jEnd=Math.min(j+segmentSize,n),copyLocation=offset;i<iEnd||j<jEnd;){if(i<iEnd)if(j<jEnd)(pairs[i][1]===pairs[j][1]?0:pairs[i][1]<pairs[j][1]?-1:1)<=0?(pairsDestination[copyLocation]=pairs[i],i++):(pairsDestination[copyLocation]=pairs[j],j++,swaps+=iEnd-i);else pairsDestination[copyLocation]=pairs[i],i++;else pairsDestination[copyLocation]=pairs[j],j++;copyLocation++}}var pairsTemp=pairs;pairs=pairsDestination,pairsDestination=pairsTemp}var tiedYPairs=0,consecutiveYTies=1;prev=pairs[0];for(i=1;i<n;i++){var curr;(curr=pairs[i])[1]===prev[1]?consecutiveYTies++:(tiedYPairs+=sum(consecutiveYTies-1),consecutiveYTies=1),prev=curr}var nonTiedPairsMultiplied=(numPairs-tiedXPairs)*(numPairs-(tiedYPairs+=sum(consecutiveYTies-1)));return(numPairs-tiedXPairs-tiedYPairs+tiedXYPairs-2*swaps)/Math.sqrt(nonTiedPairsMultiplied)},morpheus.KendallsCorrelation.toString=function(){return"Kendall's correlation"},morpheus.ComputedVector=function(name,size,callback){morpheus.AbstractVector.call(this,name,size),this.callback=callback},morpheus.ComputedVector.prototype={getValue:function(index){return this.callback(index)}},morpheus.Util.extend(morpheus.ComputedVector,morpheus.AbstractVector),morpheus.DatasetAdapter=function(dataset,rowMetadata,columnMetadata){if(null==dataset)throw"dataset is null";this.dataset=dataset,this.rowMetadata=rowMetadata||dataset.getRowMetadata(),this.columnMetadata=columnMetadata||dataset.getColumnMetadata()},morpheus.DatasetAdapter.prototype={getDataset:function(){return this.dataset},getName:function(seriesIndex){return this.dataset.getName(seriesIndex)},setName:function(seriesIndex,name){this.dataset.setName(seriesIndex,name)},getRowMetadata:function(){return this.rowMetadata},getColumnMetadata:function(){return this.columnMetadata},getRowCount:function(){return this.dataset.getRowCount()},getColumnCount:function(){return this.dataset.getColumnCount()},getValue:function(rowIndex,columnIndex,seriesIndex){return this.dataset.getValue(rowIndex,columnIndex,seriesIndex)},setValue:function(rowIndex,columnIndex,value,seriesIndex){this.dataset.setValue(rowIndex,columnIndex,value,seriesIndex)},addSeries:function(options){return this.dataset.addSeries(options)},removeSeries:function(seriesIndex){this.dataset.removeSeries(seriesIndex)},getSeriesCount:function(){return this.dataset.getSeriesCount()},getDataType:function(seriesIndex){return this.dataset.getDataType(seriesIndex)},toString:function(){return this.dataset.toString()}},morpheus.DatasetColumnView=function(dataset){this.dataset=dataset,this.columnIndex=0,this.seriesIndex=0},morpheus.DatasetColumnView.prototype={columnIndex:-1,size:function(){return this.dataset.getRowCount()},getValue:function(rowIndex){return this.dataset.getValue(rowIndex,this.columnIndex,this.seriesIndex)},setIndex:function(newColumnIndex){return this.columnIndex=newColumnIndex,this},setSeriesIndex:function(seriesIndex){return this.seriesIndex=seriesIndex,this}},morpheus.DatasetRowView=function(dataset){this.dataset=dataset,this.index=0,this.seriesIndex=0},morpheus.DatasetRowView.prototype={size:function(){return this.dataset.getColumnCount()},getIndex:function(){return this.index},getValue:function(columnIndex){return this.dataset.getValue(this.index,columnIndex,this.seriesIndex)},setIndex:function(newRowIndex){return this.index=newRowIndex,this},setSeriesIndex:function(seriesIndex){return this.seriesIndex=seriesIndex,this},setDataset:function(dataset){return this.dataset=dataset,this}},morpheus.DatasetSeriesView=function(dataset,seriesIndices){morpheus.DatasetAdapter.call(this,dataset),this.seriesIndices=seriesIndices},morpheus.DatasetSeriesView.prototype={getValue:function(i,j,seriesIndex){return seriesIndex=seriesIndex||0,this.dataset.getValue(i,j,this.seriesIndices[seriesIndex])},setValue:function(i,j,value,seriesIndex){seriesIndex=seriesIndex||0,this.dataset.setValue(i,j,value,this.seriesIndices[seriesIndex])},getName:function(seriesIndex){return seriesIndex=seriesIndex||0,this.dataset.getName(this.seriesIndices[seriesIndex])},setName:function(seriesIndex,name){seriesIndex=seriesIndex||0,this.dataset.setName(this.seriesIndices[seriesIndex],name)},addSeries:function(options){var index=this.dataset.addSeries(options);return this.seriesIndices.push(index),index},getSeriesCount:function(){return this.seriesIndices.length},toString:function(){return this.getName()}},morpheus.Util.extend(morpheus.DatasetSeriesView,morpheus.DatasetAdapter),morpheus.DatasetUtil=function(){},morpheus.DatasetUtil.min=function(dataset,seriesIndex){seriesIndex=seriesIndex||0;for(var min=Number.MAX_VALUE,i=0,rows=dataset.getRowCount();i<rows;i++)for(var j=0,columns=dataset.getColumnCount();j<columns;j++){var d=dataset.getValue(i,j,seriesIndex);isNaN(d)||(min=Math.min(min,d))}return min},morpheus.DatasetUtil.max=function(dataset,seriesIndex){seriesIndex=seriesIndex||0;for(var max=-Number.MAX_VALUE,i=0,rows=dataset.getRowCount();i<rows;i++)for(var j=0,columns=dataset.getColumnCount();j<columns;j++){var d=dataset.getValue(i,j,seriesIndex);isNaN(d)||(max=Math.max(max,d))}return max},morpheus.DatasetUtil.extensionToReader=new morpheus.Map,morpheus.DatasetUtil.registerDatasetReader=function(ext,f){if(morpheus.Util.isArray(ext))for(var i=0;i<ext.length;i++)morpheus.DatasetUtil.extensionToReader.set(ext[i],f);else morpheus.DatasetUtil.extensionToReader.set(ext,f)},morpheus.DatasetUtil.registerDatasetReader("maf",function(options){var datasetReader=new morpheus.MafFileReader;return options&&options.mafGeneFilter&&datasetReader.setGeneFilter(options.mafGeneFilter),datasetReader}),morpheus.Util.isNode()&&(morpheus.DatasetUtil.registerDatasetReader("gctx",function(options){return morpheus.Hdf5Reader.getGctxInstance()}),morpheus.DatasetUtil.registerDatasetReader("loom",function(options){return morpheus.Hdf5Reader.getLoomInstance()}),morpheus.DatasetUtil.registerDatasetReader("h5ad",function(options){return morpheus.Hdf5Reader.getH5adInstance()})),morpheus.DatasetUtil.registerDatasetReader("gct",function(options){return new morpheus.GctReader}),morpheus.DatasetUtil.registerDatasetReader("gmt",function(options){return new morpheus.GmtDatasetReader}),morpheus.DatasetUtil.registerDatasetReader(["xlsx","xls"],function(options){return options.interactive?new morpheus.Array2dReaderInteractive:new morpheus.XlsxDatasetReader}),morpheus.DatasetUtil.registerDatasetReader(["segtab","seg"],function(options){return new morpheus.SegTabReader}),morpheus.DatasetUtil.registerDatasetReader(["txt","tsv","csv"],function(options){return options.interactive?new morpheus.Array2dReaderInteractive:new morpheus.TxtReader}),morpheus.DatasetUtil.registerDatasetReader("json",function(options){return new morpheus.JsonDatasetReader}),morpheus.DatasetUtil.registerDatasetReader("mtx",function(options){return new morpheus.MtxReader}),morpheus.DatasetUtil.getDatasetReader=function(ext,options){null==options&&(options={});var f=morpheus.DatasetUtil.extensionToReader.get(ext);if(null!=f)return f(options)},morpheus.DatasetUtil.readDatasetArray=function(urls){var loadedDatasets=[],promises=[];return urls.forEach(function(url,i){var p=morpheus.DatasetUtil.read(url);promises.push(p),p.then(function(dataset){loadedDatasets[i]=dataset}).catch(function(err){var message=["Error opening "+morpheus.Util.getFileName(url)+"."];return err.message&&(message.push("<br />Cause: "),message.push(err.message)),Promise.reject(message.join(""))})}),0===promises.length?Promise.reject("No datasets specified"):Promise.all(promises).then(function(){return Promise.resolve(morpheus.DatasetUtil.join(loadedDatasets,"id"))})},morpheus.DatasetUtil.annotate=function(options){var promises=[],functions=[],isColumns=options.isColumns;return _.each(options.annotations,function(ann,annotationIndex){if(morpheus.Util.isArray(ann.file))functions[annotationIndex]=function(dataset){(new morpheus.OpenFileTool).annotate({lines:ann.file,dataset:dataset,isColumns:isColumns,metadataName:ann.datasetField,fileColumnName:ann.fileField,fileColumnNamesToInclude:ann.include})};else{var result=morpheus.Util.readLines(ann.file);promises.push(result);var fileName=morpheus.Util.getFileName(ann.file);result.then(function(lines){if(morpheus.Util.endsWith(fileName,".gmt")){var sets=(new morpheus.GmtReader).parseLines(lines);functions[annotationIndex]=function(dataset){(new morpheus.OpenFileTool).annotate(null,dataset,isColumns,sets,ann.datasetField,ann.fileField)}}else morpheus.Util.endsWith(fileName,".cls")?functions[annotationIndex]=function(dataset){(new morpheus.OpenFileTool).annotateCls(null,dataset,fileName,isColumns,lines)}:functions[annotationIndex]=function(dataset){(new morpheus.OpenFileTool).annotate({lines:lines,dataset:dataset,isColumns:isColumns,metadataName:ann.datasetField,fileColumnName:ann.fileField,fileColumnNamesToInclude:ann.include,transposed:ann.transposed})}})}}),Promise.all(promises).then(function(){return functions})},morpheus.DatasetUtil.read=function(fileOrUrl,options){return new Promise(function(resolve,reject){null==fileOrUrl&&reject("File is null"),null==options&&(options={});var datasetReader,isFile=morpheus.Util.isFile(fileOrUrl),isString=morpheus.Util.isString(fileOrUrl),ext=options.extension?options.extension:morpheus.Util.getExtension(morpheus.Util.getFileName(fileOrUrl)),str=fileOrUrl.toString();if(""===ext&&null!=str&&0===str.indexOf("blob:")||options.clipboard?datasetReader=options.interactive?new morpheus.Array2dReaderInteractive:new morpheus.TxtReader:null==(datasetReader=morpheus.DatasetUtil.getDatasetReader(ext,options))&&(datasetReader=isFile?options.interactive?new morpheus.Array2dReaderInteractive:new morpheus.TxtReader:new morpheus.GctReader),isString||isFile)if(options.background){var path=morpheus.Util.getScriptPath(),blob=new Blob(["self.onmessage = function(e) {importScripts(e.data.path);var ext = morpheus.Util.getExtension(morpheus.Util.getFileName(e.data.fileOrUrl));var datasetReader = morpheus.DatasetUtil.getDatasetReader(ext,\te.data.options);datasetReader.read(e.data.fileOrUrl, function(err,dataset) {\tself.postMessage(dataset);\t});}"]),blobURL=window.URL.createObjectURL(blob),worker=new Worker(blobURL);worker.addEventListener("message",function(e){resolve(morpheus.Dataset.fromJSON(e.data)),window.URL.revokeObjectURL(blobURL)},!1),worker.postMessage({path:path,fileOrUrl:fileOrUrl,options:options})}else datasetReader.read(fileOrUrl,function(err,dataset){err?reject(err):resolve(dataset)});else{if("function"==typeof fileOrUrl.then)return resolve(fileOrUrl);fileOrUrl.getRowCount?resolve(fileOrUrl):resolve(morpheus.Dataset.fromJSON(fileOrUrl))}})},morpheus.DatasetUtil.toObjectArray=function(dataset,options){var columns=options.columns||[0],columnFields=options.columnFields||["value"];if(columnFields.length!==columns.length)throw"columns.length !== columnFields.length";var metadataFields=options.metadataFields,rowMetadata=dataset.getRowMetadata();metadataFields||(metadataFields=morpheus.MetadataUtil.getMetadataNames(rowMetadata));for(var vectors=morpheus.MetadataUtil.getVectors(rowMetadata,metadataFields),array=[],i=0;i<dataset.getRowCount();i++){for(var obj={},j=0;j<columns.length;j++)obj[columnFields[j]]=dataset.getValue(i,columns[j]);for(j=0;j<vectors.length;j++)obj[vectors[j].getName()]=vectors[j].getValue(i);array.push(obj)}return array},morpheus.DatasetUtil.geneSetsToDataset=function(name,sets){for(var uniqueIds=new morpheus.Map,i=0,length=sets.length;i<length;i++)for(var j=0,nIds=(ids=sets[i].ids).length;j<nIds;j++)uniqueIds.set(ids[j],1);var uniqueIdsArray=uniqueIds.keys(),dataset=new morpheus.Dataset({name:name,rows:uniqueIdsArray.length,columns:sets.length}),columnIds=dataset.getColumnMetadata().add("id");for(i=0,length=sets.length;i<length;i++)columnIds.setValue(i,sets[i].name);for(var rowIds=dataset.getRowMetadata().add("id"),size=(i=0,uniqueIdsArray.length);i<size;i++)rowIds.setValue(i,uniqueIdsArray[i]);var rowIdToIndex=morpheus.VectorUtil.createValueToIndexMap(rowIds);for(i=0,length=sets.length;i<length;i++){var ids;for(j=0,nIds=(ids=sets[i].ids).length;j<nIds;j++)dataset.setValue(rowIdToIndex.get(ids[j]),i,1)}return dataset},morpheus.DatasetUtil.getRootDataset=function(dataset){for(;dataset.getDataset;)dataset=dataset.getDataset();return dataset},morpheus.DatasetUtil.getSeriesIndex=function(dataset,name){for(var i=0,nseries=dataset.getSeriesCount();i<nseries;i++)if(name===dataset.getName(i))return i;return-1},morpheus.DatasetUtil.getSeriesNames=function(dataset){for(var names=[],i=0,nseries=dataset.getSeriesCount();i<nseries;i++)names.push(dataset.getName(i));return names},morpheus.DatasetUtil.searchValues=function(options){if(""!==text){var dataset=options.dataset,text=options.text,tokens=morpheus.Util.getAutocompleteTokens(text);if(0!=tokens.length){for(var predicates=morpheus.Util.createSearchPredicates({tokens:tokens,defaultMatchMode:options.defaultMatchMode}),matchAllPredicates=!0===options.matchAllPredicates,npredicates=predicates.length,viewIndices=new morpheus.Set,i=0,nrows=dataset.getRowCount();i<nrows;i++)for(var j=0,ncols=dataset.getColumnCount();j<ncols;j++){var matches=!1;itemSearch:if(matchAllPredicates){matches=!0;for(var p=0;p<npredicates;p++){for(var predicate=predicates[p],pmatch=!1,k=0,nseries=dataset.getSeriesCount();k<nseries;k++){if((isObject=null!=(element=dataset.getValue(i,j,k))&&null!=element.toObject)&&(element=element.toObject()),isMatch(element,isObject,predicate)){pmatch=!0;break}}if(!pmatch){matches=!1;break itemSearch}}}else for(k=0,nseries=dataset.getSeriesCount();k<nseries;k++){var element,isObject;(isObject=null!=(element=dataset.getValue(i,j,k))&&null!=element.toObject)&&(element=element.toObject());for(p=0;p<npredicates;p++){if(isMatch(element,isObject,predicate=predicates[p])){matches=!0;break itemSearch}}}matches&&viewIndices.add(new morpheus.Identifier([i,j]))}return viewIndices}}function isMatch(object,toObject,predicate){if(null!=object)if(toObject){if(null!=(filterColumnName=predicate.getField())){var value=object[filterColumnName];return predicate.accept(value)}for(var name in object){value=object[name];return predicate.accept(value)}}else{var filterColumnName;if(null==(filterColumnName=predicate.getField())||filterColumnName===dataset.getName(k))return predicate.accept(object)}}},morpheus.DatasetUtil.autocompleteValues=function(dataset){return function(tokens,cb){var token=null!=tokens&&tokens.length>0?tokens[tokens.selectionStartIndex]:"";token=$.trim(token);for(var _val,seriesIndices=[],i=0,nrows=dataset.getRowCount();i<nrows;i++)for(var k=0,nseries=dataset.getSeriesCount();k<nseries;k++)"Number"===dataset.getDataType(i,k)&&seriesIndices.push([i,k]);if(0===seriesIndices.length)return cb();elementSearch:for(k=0,nseries=seriesIndices.length;k<nseries;k++)for(var pair=seriesIndices[k],j=0,ncols=dataset.getColumnCount();j<ncols;j++){if(null!=(element=dataset.getValue(pair[0],j,pair[1]))&&element.toObject){_val=element.toObject();break elementSearch}}var matches=[],fields=null==_val?[]:_.keys(_val);if(""===token)return fields.sort(function(a,b){return a===b?0:a<b?-1:1}),fields.forEach(function(field){matches.push({value:field+":",label:'<span style="font-weight:300;">'+field+":</span>",show:!0})}),cb(matches);var field=null,semi=token.indexOf(":");if(semi>0&&92!==token.charCodeAt(semi-1)){var possibleField=$.trim(token.substring(0,semi));possibleField.length>0&&'"'===possibleField[0]&&'"'===possibleField[token.length-1]&&(possibleField=possibleField.substring(1,possibleField.length-1)),-1!==fields.indexOf(possibleField)&&(token=$.trim(token.substring(semi+1)),field=possibleField)}var set=new morpheus.Set,regex=new RegExp("^"+morpheus.Util.escapeRegex(token),"i");loop:for(k=0,nseries=seriesIndices.length;k<nseries;k++)for(pair=seriesIndices[k],j=0,ncols=dataset.getColumnCount();j<ncols;j++){var element;if((element=dataset.getValue(pair[0],j,pair[1]))&&element.toObject){var object=element.toObject();if(null!==field){if(null!=(val=object[field])){var id=new morpheus.Identifier([val,field]);if(!set.has(id)&&regex.test(val)&&(set.add(id),10===set.size()))break loop}}else for(var name in object){var val=object[name];id=new morpheus.Identifier([val,name]);if(!set.has(id)&&regex.test(val)&&(set.add(id),10===set.size()))break loop}}}set.forEach(function(id){var array=id.getArray(),field=array[1],val=array[0];matches.push({value:field+":"+val,label:'<span style="font-weight:300;">'+field+':</span><span style="font-weight:900;">'+val+"</span>"})}),null==field&&fields.forEach(function(field){regex.test(field)&&matches.push({value:field+":",label:'<span style="font-weight:300;">'+field+":</span>",show:!0})}),cb(matches)}},morpheus.DatasetUtil.fill=function(dataset,value,seriesIndex){seriesIndex=seriesIndex||0;for(var i=0,nrows=dataset.getRowCount(),ncols=dataset.getColumnCount();i<nrows;i++)for(var j=0;j<ncols;j++)dataset.setValue(i,j,value,seriesIndex)},morpheus.DatasetUtil.overlay=function(options){for(var dataset=options.dataset,newDataset=options.newDataset,current_dataset_row_annotation_name=options.rowAnnotationName,current_dataset_column_annotation_name=options.columnAnnotationName,new_dataset_row_annotation_name=options.newRowAnnotationName,new_dataset_column_annotation_name=options.newColumnAnnotationName,rowValueToIndexMap=morpheus.VectorUtil.createValueToIndexMap(dataset.getRowMetadata().getByName(current_dataset_row_annotation_name)),columnValueToIndexMap=morpheus.VectorUtil.createValueToIndexMap(dataset.getColumnMetadata().getByName(current_dataset_column_annotation_name)),seriesIndex=dataset.addSeries({name:newDataset.getName(),dataType:newDataset.getDataType(0)}),rowVector=newDataset.getRowMetadata().getByName(new_dataset_row_annotation_name),rowIndices=[],newDatasetRowIndicesSubset=[],i=0,size=rowVector.size();i<size;i++){void 0!==(index=rowValueToIndexMap.get(rowVector.getValue(i)))&&(rowIndices.push(index),newDatasetRowIndicesSubset.push(i))}var columnVector=newDataset.getColumnMetadata().getByName(new_dataset_column_annotation_name),columnIndices=[],newDatasetColumnIndicesSubset=[];for(i=0,size=columnVector.size();i<size;i++){var index;void 0!==(index=columnValueToIndexMap.get(columnVector.getValue(i)))&&(columnIndices.push(index),newDatasetColumnIndicesSubset.push(i))}i=0;for(var nrows=(newDataset=new morpheus.SlicedDatasetView(newDataset,newDatasetRowIndicesSubset,newDatasetColumnIndicesSubset)).getRowCount();i<nrows;i++)for(var j=0,ncols=newDataset.getColumnCount();j<ncols;j++)dataset.setValue(rowIndices[i],columnIndices[j],newDataset.getValue(i,j),seriesIndex)},morpheus.DatasetUtil.join=function(datasets,field){if(0===datasets.length)throw"No datasets";if(1===datasets.length){for(var name=datasets[0].getName(),sourceVector=datasets[0].getRowMetadata().add("Source"),i=0,size=sourceVector.size();i<size;i++)sourceVector.setValue(i,name);return datasets[0]}var ids=new morpheus.Set;for(i=0;i<datasets.length;i++){var idVector=datasets[i].getColumnMetadata().getByName(field),j=0;for(size=idVector.size();j<size;j++)ids.add(idVector.getValue(j))}var dummyDataset=new morpheus.Dataset({rows:0,columns:ids.size(),name:datasets[0].getName()}),dummyIdVector=dummyDataset.getColumnMetadata().add(field),counter=0;ids.forEach(function(id){dummyIdVector.setValue(counter++,id)});var dataset=new morpheus.JoinedDataset(dummyDataset,datasets[0],field,field);for(i=1;i<datasets.length;i++)dataset=new morpheus.JoinedDataset(dataset,datasets[i],field,field);return dataset},morpheus.DatasetUtil.shallowCopy=function(dataset){var rowMetadataModel=morpheus.MetadataUtil.shallowCopy(dataset.getRowMetadata()),columnMetadataModel=morpheus.MetadataUtil.shallowCopy(dataset.getColumnMetadata());return dataset.getRowMetadata=function(){return rowMetadataModel},dataset.getColumnMetadata=function(){return columnMetadataModel},dataset},morpheus.DatasetUtil.copy=function(dataset){for(var newDataset=new morpheus.Dataset({name:dataset.getName(),rows:dataset.getRowCount(),columns:dataset.getColumnCount(),dataType:dataset.getDataType(0)}),seriesIndex=0,nseries=dataset.getSeriesCount();seriesIndex<nseries;seriesIndex++){seriesIndex>0&&newDataset.addSeries({name:dataset.getName(seriesIndex),rows:dataset.getRowCount(),columns:dataset.getColumnCount(),dataType:dataset.getDataType(seriesIndex)});for(var i=0,nrows=dataset.getRowCount(),ncols=dataset.getColumnCount();i<nrows;i++)for(var j=0;j<ncols;j++)newDataset.setValue(i,j,dataset.getValue(i,j,seriesIndex),seriesIndex)}var rowMetadataModel=morpheus.MetadataUtil.shallowCopy(dataset.getRowMetadata()),columnMetadataModel=morpheus.MetadataUtil.shallowCopy(dataset.getColumnMetadata());return newDataset.getRowMetadata=function(){return rowMetadataModel},newDataset.getColumnMetadata=function(){return columnMetadataModel},newDataset},morpheus.DatasetUtil.toString=function(dataset,value,seriesIndex){seriesIndex=seriesIndex||0;for(var s=[],i=0,nrows=dataset.getRowCount(),ncols=dataset.getColumnCount();i<nrows;i++){for(var j=0;j<ncols;j++)j>0&&s.push(", "),s.push(morpheus.Util.nf(dataset.getValue(i,j,seriesIndex)));s.push("\n")}return s.join("")},morpheus.DatasetUtil.getNonEmptyRows=function(dataset){for(var rowsToKeep=[],i=0,nrows=dataset.getRowCount();i<nrows;i++){for(var keep=!1,j=0,ncols=dataset.getColumnCount();j<ncols;j++){var value=dataset.getValue(i,j);if(!isNaN(value)){keep=!0;break}}keep&&rowsToKeep.push(i)}return rowsToKeep},morpheus.Dataset=function(options){morpheus.AbstractDataset.call(this,options.rows,options.columns),null==options.dataType&&(options.dataType="Float32"),this.seriesNames.push(options.name),this.seriesArrays.push(morpheus.Dataset.createMatrix(options)),this.seriesDataTypes.push(options.dataType)},morpheus.Dataset.toJSON=function(dataset,options){var seriesArrays=[],seriesDataTypes=[],seriesNames=[],seriesIndices=(options=options||{}).seriesIndices;null==seriesIndices&&(seriesIndices=morpheus.Util.sequ32(dataset.getSeriesCount()));for(var series=0;series<seriesIndices.length;series++){var seriesIndex=seriesIndices[series];seriesNames.push(dataset.getName(seriesIndex)),seriesDataTypes.push(dataset.getDataType(seriesIndex));var data=[];seriesArrays.push(data);for(var i=0,nrows=dataset.getRowCount();i<nrows;i++){var row=[];data.push(row);for(var j=0,ncols=dataset.getColumnCount();j<ncols;j++)row[j]=dataset.getValue(i,j,seriesIndex)}}var vectorToJSON=function(vector){for(var array=[],i=0,size=vector.size();i<size;i++)array[i]=vector.getValue(i);var properties=new morpheus.Map;return vector.getProperties().forEach(function(value,key){morpheus.VectorKeys.JSON_WHITELIST.has(key)&&properties.set(key,value)}),{properties:properties,name:vector.getName(),array:array}},metadatatoJSON=function(metadata,fields){var filter,vectors=[];fields&&(filter=new morpheus.Set,fields.forEach(function(field){filter.add(field)}));for(var i=0,count=metadata.getMetadataCount();i<count;i++){var v=metadata.get(i);v.getProperties().has(morpheus.VectorKeys.IS_INDEX)||(filter?filter.has(v.getName())&&vectors.push(vectorToJSON(v)):vectors.push(vectorToJSON(v)))}return vectors};return{rows:dataset.getRowCount(),columns:dataset.getColumnCount(),seriesArrays:seriesArrays,seriesDataTypes:seriesDataTypes,seriesNames:seriesNames,rowMetadataModel:{vectors:metadatatoJSON(dataset.getRowMetadata(),options.rowFields)},columnMetadataModel:{vectors:metadatatoJSON(dataset.getColumnMetadata(),options.columnFields)}}},morpheus.Dataset.fromJSON=function(options){for(var seriesIndex=0;seriesIndex<options.seriesArrays.length;seriesIndex++)for(var array=options.seriesArrays[seriesIndex],i=0;i<options.rows;i++)for(var j=0;j<options.columns;j++){null==array[i][j]&&(array[i][j]=NaN)}var dataset=new morpheus.Dataset({name:options.seriesNames[0],dataType:options.seriesDataTypes[0],array:options.seriesArrays[0],rows:options.rows,columns:options.columns});options.rowMetadataModel&&options.rowMetadataModel.vectors.forEach(function(v){var vector=new morpheus.Vector(v.name,dataset.getRowCount());vector.array=v.array,vector.properties=morpheus.Map.fromJSON(v.properties),dataset.rowMetadataModel.vectors.push(vector)}),options.columnMetadataModel&&options.columnMetadataModel.vectors.forEach(function(v){var vector=new morpheus.Vector(v.name,dataset.getColumnCount());vector.array=v.array,vector.properties=morpheus.Map.fromJSON(v.properties),dataset.columnMetadataModel.vectors.push(vector)});for(i=1;i<options.seriesArrays.length;i++)dataset.addSeries({name:options.seriesNames[i],dataType:options.seriesDataTypes[i],array:options.seriesArrays[i]});return dataset},morpheus.Matrix1DFileBacked=function(options){},morpheus.Matrix1DFileBacked.prototype={setValue:function(i,j,value){throw new Error("Unsupported operation.")},toJSON:function(){for(var data=[],nrows=this.options.rows,ncols=this.options.columns,i=(this.options.array,0);i<nrows;i++){var row=[];data.push(row);for(var j=0;j<ncols;j++)row[j]=this.getValue(i,j)}return data}},morpheus.ColumnMajorMatrix1D=function(options){this.options=options},morpheus.ColumnMajorMatrix1D.prototype={getValue:function(i,j){return this.options.array[j*this.options.rows+i]},setValue:function(i,j,value){this.options.array[j*this.options.rows+i]=value},toJSON:function(){for(var data=[],nrows=this.options.rows,ncols=this.options.columns,i=(this.options.array,0);i<nrows;i++){var row=[];data.push(row);for(var j=0;j<ncols;j++)row[j]=this.getValue(i,j)}return data}},morpheus.RowMajorMatrix1D=function(options){this.options=options},morpheus.RowMajorMatrix1D.prototype={getValue:function(i,j){return this.options.array[i*this.options.columns+j]},setValue:function(i,j,value){this.options.array[i*this.options.columns+j]=value},toJSON:function(){for(var data=[],nrows=this.options.rows,ncols=this.options.columns,i=(this.options.array,0);i<nrows;i++){var row=[];data.push(row);for(var j=0;j<ncols;j++)row[j]=this.getValue(i,j)}return data}},morpheus.RowMajorMatrix=function(options){this.options=options},morpheus.RowMajorMatrix.prototype={getValue:function(i,j){return this.options.array[i][j]},setValue:function(i,j,value){this.options.array[i][j]=value},toJSON:function(){for(var data=[],nrows=this.options.rows,ncols=this.options.columns,array=this.options.array,i=0;i<nrows;i++){var row=[];data.push(row);for(var j=0;j<ncols;j++)row[j]=array[i][j]}return data}},morpheus.SparseMatrix=function(options){this.options=options},morpheus.SparseMatrix.binarySearch=function(array,value,minIndex,maxIndex){for(var index,v;minIndex<=maxIndex;)if((v=array[index=(minIndex+maxIndex)/2|0])<value)minIndex=index+1;else{if(!(v>value))return index;maxIndex=index-1}return-1},morpheus.SparseMatrix.prototype={getValue:function(i,j){var obj=this.options.array[i];if(void 0===obj.values)return this.options.defaultValue;var k=morpheus.SparseMatrix.binarySearch(obj.indices,j,0,obj.values.length-1);return k>=0?obj.values[k]:this.options.defaultValue},setValue:function(i,j,value){var obj=this.options.array[i];if(void 0===obj.values)throw"Invalid index";var k=morpheus.SparseMatrix.binarySearch(obj.indices,j,0,obj.values.length-1);if(k<0)throw"Invalid index";obj.values[k]=value}},morpheus.Dataset.createMatrix=function(options){if(options.array)return null!=options.defaultValue?new morpheus.SparseMatrix(options):"1d_backed"===options.type?new morpheus.Matrix1DFileBacked(options):"1d"===options.type?options.columnMajorOrder?new morpheus.ColumnMajorMatrix1D(options):new morpheus.RowMajorMatrix1D(options):new morpheus.RowMajorMatrix(options);var array=[];if(null==options.dataType||"Float32"===options.dataType)for(var i=0;i<options.rows;i++)array.push(new Float32Array(options.columns));else if("Int8"===options.dataType)for(i=0;i<options.rows;i++)array.push(new Int8Array(options.columns));else if("Int16"===options.dataType)for(i=0;i<options.rows;i++)array.push(new Int16Array(options.columns));else for(i=0;i<options.rows;i++)array.push([]);return options.array=array,new morpheus.RowMajorMatrix(options)},morpheus.Dataset.prototype={getValue:function(i,j,seriesIndex){return seriesIndex=seriesIndex||0,this.seriesArrays[seriesIndex].getValue(i,j)},toString:function(){return this.getName()},setValue:function(i,j,value,seriesIndex){seriesIndex=seriesIndex||0,this.seriesArrays[seriesIndex].setValue(i,j,value)},addSeries:function(options){return options=$.extend({},{rows:this.getRowCount(),columns:this.getColumnCount(),dataType:"Float32"},options),this.seriesDataTypes.push(options.dataType),this.seriesNames.push(options.name),this.seriesArrays.push(morpheus.Dataset.createMatrix(options)),this.seriesNames.length-1}},morpheus.Util.extend(morpheus.Dataset,morpheus.AbstractDataset),morpheus.ElementSelectionModel=function(project){this.viewIndices=new morpheus.Set,this.project=project},morpheus.ElementSelectionModel.prototype={click:function(rowIndex,columnIndex,add){var id=new morpheus.Identifier([rowIndex,columnIndex]),isSelected=this.viewIndices.has(id);add?isSelected?this.viewIndices.remove(id):this.viewIndices.add(id):(this.viewIndices.clear(),isSelected||this.viewIndices.add(id)),this.trigger("selectionChanged")},getProject:function(){return this.project},setViewIndices:function(indices){this.viewIndices=indices,this.trigger("selectionChanged")},clear:function(){this.viewIndices=new morpheus.Set},getViewIndices:function(){return this.viewIndices},count:function(){return this.viewIndices.size()},toModelIndices:function(){var project=this.project,modelIndices=[];return this.viewIndices.forEach(function(id){modelIndices.push(project.convertViewRowIndexToModel(id.getArray()[0]),project.convertViewColumnIndexToModel(id.getArray()[1]))}),modelIndices},save:function(){this.modelIndices=this.toModelIndices()},restore:function(){var project=this.project;this.viewIndices=new morpheus.Set;for(var i=0,length=this.modelIndices.length;i<length;i++){var rowIndex=project.convertModelRowIndexToView(this.modelIndices[i][0]),columnIndex=project.convertModelColumnIndexToView(this.modelIndices[i][1]);-1!==rowIndex&&-1!==columnIndex&&this.viewIndices.add(new morpheus.Identifier([rowIndex,columnIndex]))}}},morpheus.Util.extend(morpheus.ElementSelectionModel,morpheus.Events),morpheus.CombinedFilter=function(isAndFilter){this.filters=[],this.isAndFilter=isAndFilter,this.enabledFilters=[],this.name="combined filter"},morpheus.CombinedFilter.prototype={shallowClone:function(){var f=new morpheus.CombinedFilter(this.isAndFilter);return f.filters=this.filters.slice(0),f},isColumns:function(){return this.filters[0].isColumns()},toString:function(){return this.name},setAnd:function(isAndFilter,notify){this.isAndFilter=isAndFilter,notify&&this.trigger("and",{})},isAnd:function(){return this.isAndFilter},equals:function(f){if(!(f instanceof morpheus.CombinedFilter))return!1;if(this.isAndFilter!==f.isAndFilter)return!1;if(this.filters.length!==f.filters.length)return!1;for(var i=0,length=this.filters.length;i<length;i++)if(!this.filters[i].equals(f.filters[i]))return!1;return!0},add:function(filter,notify){null!=filter&&(this.filters.push(filter),notify&&this.trigger("add",{filter:filter}))},getFilters:function(){return this.filters},get:function(index){return this.filters[index]},indexOf:function(name,type){for(var i=0,length=this.filters.length;i<length;i++)if(this.filters[i].toString()===name&&(null==type||this.filters[i]instanceof type))return i;return-1},remove:function(index,notify){this.filters.splice(index,1),notify&&this.trigger("remove",{index:index})},set:function(index,filter){this.filters[index]=filter},insert:function(index,filter){this.filters.splice(index,0,filter)},clear:function(){this.filters=[]},init:function(dataset){for(var i=0,nfilters=this.filters.length;i<nfilters;i++)this.filters[i].isColumns()?this.filters[i].init(new morpheus.TransposedDatasetView(dataset)):this.filters[i].init(dataset);this.enabledFilters=this.filters.filter(function(filter){return filter.isEnabled()})},accept:function(index){var filters=this.enabledFilters;if(this.isAndFilter){for(var i=0,nfilters=filters.length;i<nfilters;i++)if(!1===filters[i].accept(index))return!1;return!0}for(i=0,nfilters=filters.length;i<nfilters;i++)if(filters[i].accept(index))return!0;return!1},isEnabled:function(){return this.enabledFilters.length>0}},morpheus.Util.extend(morpheus.CombinedFilter,morpheus.Events),morpheus.IndexFilter=function(acceptIndicesSet,name,isColumns){this.acceptIndicesSet=acceptIndicesSet,this.name=name,this.columns=isColumns},morpheus.IndexFilter.prototype={enabled:!0,isColumns:function(){return this.columns},isEnabled:function(){return this.enabled},setAcceptIndicesSet:function(acceptIndicesSet){this.acceptIndicesSet=acceptIndicesSet},setEnabled:function(enabled){this.enabled=enabled},equals:function(filter){return filter instanceof morpheus.IndexFilter&&this.acceptIndicesSet.equals(filter.acceptIndicesSet)},init:function(dataset){},toString:function(){return this.name},accept:function(index){return this.acceptIndicesSet.has(index)}},morpheus.VectorFilter=function(set,maxSetSize,name,isColumns){this.set=set,this.name=name,this.maxSetSize=maxSetSize,this.columns=isColumns},morpheus.VectorFilter.prototype={enabled:!0,isColumns:function(){return this.columns},isEnabled:function(){return this.enabled&&this.set.size()>0&&this.set.size()!==this.maxSetSize&&null!=this.vector},setEnabled:function(enabled){this.enabled=enabled},equals:function(filter){return filter instanceof morpheus.VectorFilter&&this.name===filter.name},init:function(dataset){this.vector=dataset.getRowMetadata().getByName(this.name)},toString:function(){return this.name},accept:function(index){return this.set.has(this.vector.getValue(index))}},morpheus.NotNullFilter=function(name,isColumns){this.name=name,this.columns=isColumns},morpheus.NotNullFilter.prototype={enabled:!0,isColumns:function(){return this.columns},isEnabled:function(){return this.enabled&&null!=this.vector},setEnabled:function(enabled){this.enabled=enabled},equals:function(filter){return filter instanceof morpheus.NotNullFilter&&this.name===filter.name},init:function(dataset){this.vector=dataset.getRowMetadata().getByName(this.name)},toString:function(){return this.name},accept:function(index){return null!=this.vector.getValue(index)}},morpheus.RangeFilter=function(min,max,name,isColumns){this.min=min,this.max=max,this.name=name,this.columns=isColumns},morpheus.RangeFilter.prototype={enabled:!0,isColumns:function(){return this.columns},isEnabled:function(){return this.enabled&&(!isNaN(this.min)||!isNaN(this.max))&&this.vector},setEnabled:function(enabled){this.enabled=enabled},setMin:function(value){this.min=isNaN(value)?-Number.MAX_VALUE:value},setMax:function(value){this.max=isNaN(value)?Number.MAX_VALUE:value},equals:function(filter){return filter instanceof morpheus.RangeFilter&&this.name===filter.name},init:function(dataset){this.vector=dataset.getRowMetadata().getByName(this.name)},toString:function(){return this.name},accept:function(index){var value=this.vector.getValue(index);return value>=this.min&&value<=this.max}},morpheus.TopNFilter=function(n,direction,name,isColumns){this.n=n,this.direction=direction,this.name=name,this.columns=isColumns},morpheus.TopNFilter.TOP=0,morpheus.TopNFilter.BOTTOM=1,morpheus.TopNFilter.TOP_BOTTOM=2,morpheus.TopNFilter.prototype={enabled:!0,isColumns:function(){return this.columns},isEnabled:function(){return this.enabled&&this.n>0&&this.vector},setEnabled:function(enabled){this.enabled=enabled},setN:function(value){this.n=value},setDirection:function(direction){this.direction=direction},equals:function(filter){return filter instanceof morpheus.TopNFilter&&this.name===filter.name&&this.n===filter.n&&this.direction===filter.direction},init:function(dataset){if(!this.vector||this.vector!==dataset.getRowMetadata().getByName(this.name)){var vector=dataset.getRowMetadata().getByName(this.name);null==vector&&(vector={getValue:function(){},size:function(){return 0}}),this.vector=vector;for(var set=new morpheus.Set,i=0,size=vector.size();i<size;i++){var value=vector.getValue(i);isNaN(value)||set.add(value)}var values=set.values();values.sort(function(a,b){return a===b?0:a<b?-1:1}),this.sortedValues=values}var topAndBottomIndices=[this.sortedValues.length-this.n,this.n-1];for(i=0;i<topAndBottomIndices.length;i++)topAndBottomIndices[i]=Math.max(0,topAndBottomIndices[i]),topAndBottomIndices[i]=Math.min(this.sortedValues.length-1,topAndBottomIndices[i]);var topAndBottomValues=[this.sortedValues[topAndBottomIndices[0]],this.sortedValues[topAndBottomIndices[1]]];this.direction===morpheus.TopNFilter.TOP?this.f=function(val){return!isNaN(val)&&val>=topAndBottomValues[0]}:this.direction===morpheus.TopNFilter.BOTTOM?this.f=function(val){return!isNaN(val)&&val<=topAndBottomValues[1]}:this.f=function(val){return!isNaN(val)&&(val>=topAndBottomValues[0]||val<=topAndBottomValues[1])}},accept:function(index){return this.f(this.vector.getValue(index))},toString:function(){return this.name}},morpheus.AlwaysTrueFilter=function(isColumns){this.isColumns=isColumns},morpheus.AlwaysTrueFilter.prototype={isEnabled:function(){return!1},isColumns:function(){return this.isColumns},setEnabled:function(enabled){},equals:function(filter){return filter instanceof morpheus.AlwaysTrueFilter},init:function(dataset){},toString:function(){return"AlwaysTrue"},accept:function(index){return!0}},morpheus.CombinedFilter.fromJSON=function(combinedFilter,json){combinedFilter.setAnd(json.isAnd),json.filters.forEach(function(filter){var name=null!=filter.name?filter.name:filter.field;if("set"===filter.type){var set=new morpheus.Set;filter.values.forEach(function(value){set.add(value)}),combinedFilter.add(new morpheus.VectorFilter(set,filter.maxSetSize,name,filter.isColumns))}else if("range"===filter.type)combinedFilter.add(new morpheus.RangeFilter(filter.min,filter.max,name,filter.isColumns));else if("top"===filter.type)_.isString(filter.direction)&&("top"===filter.direction?filter.direction=morpheus.TopNFilter.TOP:"bottom"===filter.direction?filter.direction=morpheus.TopNFilter.BOTTOM:"topAndBottom"===filter.direction&&(filter.direction=morpheus.TopNFilter.TOP_BOTTOM)),combinedFilter.add(new morpheus.TopNFilter(filter.n,filter.direction,name,filter.isColumns));else if("index"===filter.type){set=new morpheus.Set;filter.indices.forEach(function(value){set.add(value)}),combinedFilter.add(new morpheus.IndexFilter(set,name,filter.isColumns))}else console.log("Unknown filter type")})},morpheus.CombinedFilter.toJSON=function(filter){var json={isAnd:filter.isAnd(),filters:[]};return filter.getFilters().forEach(function(filter){filter.isEnabled()&&(filter instanceof morpheus.VectorFilter?json.filters.push({name:filter.name,isColumns:filter.isColumns(),values:filter.set.values(),maxSetSize:filter.maxSetSize,type:"set"}):filter instanceof morpheus.RangeFilter?json.filters.push({name:filter.name,isColumns:filter.isColumns(),min:filter.min,max:filter.max,type:"range"}):filter instanceof morpheus.TopNFilter?json.filters.push({name:filter.name,isColumns:filter.isColumns(),n:filter.n,direction:filter.direction,type:"top"}):filter instanceof morpheus.IndexFilter&&json.filters.push({name:filter.name,isColumns:filter.isColumns(),indices:filter.acceptIndicesSet.values(),type:"index"}))}),json},morpheus.IndexMapper=function(project,isRows){this.project=project,this.isRows=isRows,this.sortKeys=[],this.modelToView=null,this.filteredModelIndices=null,this.filteredSortedModelIndices=null,this.filter=new morpheus.CombinedFilter(!0),this._filter(),this._sort()},morpheus.IndexMapper.prototype={convertModelIndexToView:function(modelIndex){var index=this.modelToView.get(modelIndex);return void 0!==index?index:-1},convertViewIndexToModel:function(viewIndex){return viewIndex<this.filteredSortedModelIndices.length&&viewIndex>=0?this.filteredSortedModelIndices[viewIndex]:-1},convertToView:function(){return this.filteredSortedModelIndices},setFilter:function(filter){this.filter=filter,this._filter(),this._sort()},_filter:function(){var filteredModelIndices,filter=this.filter,dataset=this.project.getFullDataset(),count=this.isRows?dataset.getRowCount():dataset.getColumnCount();if(null!=filter&&(filter.init(dataset),filter.isEnabled())){filteredModelIndices=[];for(var i=0;i<count;i++)filter.accept(i)&&filteredModelIndices.push(i)}this.filteredModelIndices=null!=filteredModelIndices?filteredModelIndices:morpheus.Util.seq(count)},_sort:function(){var sortKeys=this.sortKeys;if(sortKeys.length>0){for(var dataset=this.project.getFullDataset(),nkeys=sortKeys.length,i=0;i<nkeys;i++)sortKeys[i].init(sortKeys[i].isColumns()?new morpheus.TransposedDatasetView(dataset):dataset,this.filteredSortedModelIndices);this.filteredSortedModelIndices=this.filteredModelIndices.slice(0),this.filteredSortedModelIndices.sort(function(a,b){for(var i=0;i<nkeys;i++){var key=sortKeys[i],c=key.getComparator()(key.getValue(a),key.getValue(b));if(0!==c)return c}return 0})}else this.filteredSortedModelIndices=this.filteredModelIndices;for(var modelToView=new morpheus.Map,length=(i=0,this.filteredSortedModelIndices.length);i<length;i++)modelToView.set(this.filteredSortedModelIndices[i],i);this.modelToView=modelToView},getFilter:function(){return this.filter},getViewCount:function(){return null==this.project.getFullDataset()?0:this.filteredSortedModelIndices.length},setSelectedModelIndices:function(selectedModelIndices){this.selectionModel.setSelectedModelIndices(selectedModelIndices)},setSortKeys:function(sortKeys){null==sortKeys&&(sortKeys=[]),this.sortKeys=sortKeys,this._sort()}},morpheus.JoinedDataset=function(dataset1,dataset2,dataset1Field,dataset2Field,sourceFieldName){if(sourceFieldName=sourceFieldName||"Source",this.dataset1Field=dataset1Field,this.dataset2Field=dataset2Field,null==dataset1)throw"dataset1 is null";if(null==dataset2)throw"dataset2 is null";if(dataset1Field){for(var v1=dataset1.getColumnMetadata().getByName(dataset1Field),dataset2ValueToIndex=morpheus.VectorUtil.createValueToIndexMap(dataset2.getColumnMetadata().getByName(dataset2Field)),dataset2ColumnIndices=[],i=0;i<v1.size();i++)dataset2ColumnIndices[i]=dataset2ValueToIndex.get(v1.getValue(i));dataset2=new morpheus.SlicedDatasetWithNulls(dataset2,dataset2ColumnIndices,dataset1.getColumnCount(),dataset1.getColumnMetadata())}if(!dataset1.getRowMetadata().getByName(sourceFieldName))for(var sourceVector=dataset1.getRowMetadata().add(sourceFieldName),name=dataset1.getName(),nrows=(i=0,sourceVector.size());i<nrows;i++)sourceVector.setValue(i,name);if(!dataset2.getRowMetadata().getByName(sourceFieldName))for(sourceVector=dataset2.getRowMetadata().add(sourceFieldName),name=dataset2.getName(),i=0,nrows=sourceVector.size();i<nrows;i++)sourceVector.setValue(i,name);i=0;for(var count=dataset1.getRowMetadata().getMetadataCount();i<count;i++){name=dataset1.getRowMetadata().get(i).getName();null==dataset2.getRowMetadata().getByName(name)&&dataset2.getRowMetadata().add(name)}for(i=0,count=dataset2.getRowMetadata().getMetadataCount();i<count;i++){name=dataset2.getRowMetadata().get(i).getName();null==dataset1.getRowMetadata().getByName(name)&&dataset1.getRowMetadata().add(name)}var dataset2RowMetadataOrder=[],metadataInDifferentOrder=!1;for(i=0,count=dataset1.getRowMetadata().getMetadataCount();i<count;i++){name=dataset1.getRowMetadata().get(i).getName();var index=morpheus.MetadataUtil.indexOf(dataset2.getRowMetadata(),name);dataset2RowMetadataOrder.push(index),index!==i&&(metadataInDifferentOrder=!0)}this.dataset1=dataset1,this.dataset2=dataset2;var maxSeriesCount=Math.max(this.dataset1.getSeriesCount(),this.dataset2.getSeriesCount());for(i=this.dataset1.getSeriesCount();i<maxSeriesCount;i++)this.dataset1.addSeries({name:this.dataset2.getName(i)});for(i=this.dataset2.getSeriesCount();i<maxSeriesCount;i++)this.dataset2.addSeries({name:this.dataset1.getName(i)});this.rowMetadata=new morpheus.JoinedMetadataModel(this.dataset1.getRowMetadata(),metadataInDifferentOrder?new morpheus.MetadataModelColumnView(this.dataset2.getRowMetadata(),dataset2RowMetadataOrder):this.dataset2.getRowMetadata())},morpheus.JoinedDataset.prototype={getName:function(seriesIndex){return this.dataset1.getName(seriesIndex)},setName:function(seriesIndex,name){this.dataset1.setName(seriesIndex,name)},getDataType:function(seriesIndex){return this.dataset1.getDataType(seriesIndex)},getDatasets:function(){return[this.dataset1,this.dataset2]},getDataset1:function(){return this.dataset1},getRowMetadata:function(){return this.rowMetadata},getColumnMetadata:function(){return this.dataset1.getColumnMetadata()},getRowCount:function(){return this.dataset1.getRowCount()+this.dataset2.getRowCount()},getColumnCount:function(){return this.dataset1.getColumnCount()},getValue:function(i,j,seriesIndex){return i<this.dataset1.getRowCount()?this.dataset1.getValue(i,j,seriesIndex):this.dataset2.getValue(i-this.dataset1.getRowCount(),j,seriesIndex)},setValue:function(i,j,value,seriesIndex){i<this.dataset1.getRowCount()?this.dataset1.setValue(i,j,value,seriesIndex):this.dataset2.setValue(i-this.dataset1.getRowCount(),j,value,seriesIndex)},getSeriesCount:function(){return this.dataset1.getSeriesCount()},addSeries:function(options){return this.dataset1.addSeries(options),this.dataset2.addSeries(options)},removeSeries:function(seriesIndex){this.dataset1.removeSeries(seriesIndex),this.dataset2.removeSeries(seriesIndex)},toString:function(){return this.getName()}},morpheus.SlicedDatasetWithNulls=function(dataset,columnIndices,columnCount,columnMetadata){morpheus.DatasetAdapter.call(this,dataset),this.columnIndices=columnIndices,this.columnCount=columnCount,this.columnMetadata=columnMetadata},morpheus.SlicedDatasetWithNulls.prototype={getColumnMetadata:function(){return this.columnMetadata},getColumnCount:function(){return this.columnCount},getValue:function(i,j,seriesIndex){var index=this.columnIndices[j];return void 0===index?void 0:this.dataset.getValue(i,index,seriesIndex)},setValue:function(i,j,value,seriesIndex){var index=this.columnIndices[j];void 0!==index?this.dataset.setValue(i,index,value,seriesIndex):console.log(j+" out of range")}},morpheus.Util.extend(morpheus.SlicedDatasetWithNulls,morpheus.DatasetAdapter),morpheus.JoinedVector=function(v1,v2){this.v1=v1,this.v2=v2,morpheus.VectorAdapter.call(this,v1),this.properties=new morpheus.Map},morpheus.JoinedVector.prototype={setValue:function(i,value){i<this.v1.size()?this.v1.setValue(i,value):this.v2.setValue(i-this.v1.size(),value)},getValue:function(i){return i<this.v1.size()?this.v1.getValue(i):this.v2.getValue(i-this.v1.size())},size:function(){return this.v1.size()+this.v2.size()},getProperties:function(){return this.properties}},morpheus.Util.extend(morpheus.JoinedVector,morpheus.VectorAdapter),morpheus.JoinedMetadataModel=function(m1,m2){this.m1=m1,this.m2=m2,this.vectors=[];for(var i=0,count=m1.getMetadataCount();i<count;i++){var v1=this.m1.get(i),v2=this.m2.get(i),v=new morpheus.JoinedVector(v1,v2);v1.getProperties().forEach(function(val,key){morpheus.VectorKeys.COPY_IGNORE.has(key)||v.properties.set(key,val)}),v2.getProperties().forEach(function(val,key){morpheus.VectorKeys.COPY_IGNORE.has(key)||v.properties.set(key,val)}),this.vectors.push(v)}},morpheus.JoinedMetadataModel.prototype={add:function(name){var oldVector,index=morpheus.MetadataUtil.indexOf(this,name);-1!==index&&(oldVector=this.remove(index));var v=new morpheus.Vector(name,this.getItemCount());if(null!=oldVector){oldVector.getProperties().forEach(function(val,key){v.getProperties().set(key,val)});for(var i=0,size=oldVector.size();i<size;i++)v.setValue(i,oldVector.getValue(i))}return this.vectors.push(v),v},getItemCount:function(){return this.m1.getItemCount()+this.m2.getItemCount()},get:function(index){return this.vectors[index]},remove:function(index){return this.vectors.splice(index,1)[0]},getByName:function(name){for(var i=0,length=this.vectors.length;i<length;i++)if(name===this.vectors[i].getName())return this.vectors[i]},getMetadataCount:function(){return this.vectors.length}},morpheus.MetadataModelAdapter=function(model){this.model=model},morpheus.MetadataModelAdapter.prototype={add:function(name){return this.model.add(name)},getItemCount:function(){return this.model.getItemCount()},get:function(index){return this.model.get(index)},remove:function(index){return this.model.remove(index)},getByName:function(name){return this.model.getByName(name)},getMetadataCount:function(){return this.model.getMetadataCount()}},morpheus.MetadataModelColumnView=function(model,indices){this.model=model,this.indices=indices},morpheus.MetadataModelColumnView.prototype={add:function(name){var vector=this.model.add(name),index=morpheus.MetadataUtil.indexOf(this.model,name);return this.indices.push(index),vector},getMetadataCount:function(){return this.indices.length},get:function(index){if(index<0||index>=this.indices.length)throw"index out of bounds";return this.model.get(this.indices[index])},remove:function(index){if(index<0||index>=this.indices.length)throw"index out of bounds";var v=this.model.remove(this.indices[index]);return this.indices.splice(index,1),v},getByName:function(name){var index=morpheus.MetadataUtil.indexOf(this,name);return-1!==index?this.get(index):void 0}},morpheus.Util.extend(morpheus.MetadataModelColumnView,morpheus.MetadataModelAdapter),morpheus.MetadataModelItemView=function(model,indices){this.model=model,this.indices=indices},morpheus.MetadataModelItemView.prototype={add:function(name){var v=this.model.add(name);return new morpheus.SlicedVector(v,this.indices)},getItemCount:function(){return this.indices.length},get:function(index){var v=this.model.get(index);if(void 0!==v)return new morpheus.SlicedVector(v,this.indices)},getByName:function(name){var v=this.model.getByName(name);if(void 0!==v)return new morpheus.SlicedVector(v,this.indices)},getMetadataCount:function(){return this.model.getMetadataCount()}},morpheus.Util.extend(morpheus.MetadataModelItemView,morpheus.MetadataModelAdapter),morpheus.MetadataModel=function(itemCount){this.itemCount=itemCount,this.vectors=[]},morpheus.MetadataModel.prototype={add:function(name,options){var oldVector,index=morpheus.MetadataUtil.indexOf(this,name);-1!==index&&(oldVector=this.get(index));var v=new morpheus.Vector(name,this.getItemCount());if(null!=oldVector)for(var i=0,size=oldVector.size();i<size;i++){var val=oldVector.getValue(i);v.setValue(i,val)}return-1!==index?this.vectors.splice(index,1,v):this.vectors.push(v),v},getItemCount:function(){return this.itemCount},get:function(index){return this.vectors[index]},remove:function(index){return this.vectors.splice(index,1)[0]},getByName:function(name){var index=morpheus.MetadataUtil.indexOf(this,name);return-1!==index?this.get(index):void 0},getMetadataCount:function(){return this.vectors.length}},morpheus.MetadataUtil=function(){},morpheus.MetadataUtil.renameFields=function(dataset,options){_.each(options.rows,function(item){if(item.renameTo){var v=dataset.getRowMetadata().getByName(item.field);v&&v.setName(item.renameTo)}}),_.each(options.columns,function(item){if(item.renameTo){var v=dataset.getColumnMetadata().getByName(item.field);v&&v.setName(item.renameTo)}})},morpheus.MetadataUtil.search=function(options){var model=options.model,fullModel=options.fullModel;fullModel||(fullModel=model);var text=options.text;options.isColumns;if(""===(text=$.trim(text)))return null;var tokens=morpheus.Util.getAutocompleteTokens(text);if(0==tokens.length)return null;var indexField="#",fieldNames=morpheus.MetadataUtil.getMetadataNames(fullModel);fieldNames.push(indexField);for(var predicates=morpheus.Util.createSearchPredicates({tokens:tokens,fields:fieldNames,defaultMatchMode:options.defaultMatchMode}),vectors=[],nameToVector=new morpheus.Map,j=0;j<fullModel.getMetadataCount();j++){var v=fullModel.get(j),dataType=morpheus.VectorUtil.getDataType(v),wrapper={vector:v,dataType:dataType,isArray:0===dataType.indexOf("[")};nameToVector.set(v.getName(),wrapper),null!=model.getByName(v.getName())&&vectors.push(wrapper)}for(var indices=[],npredicates=predicates.length,p=0;p<npredicates;p++){var filterColumnName=(predicate=predicates[p]).getField();if(null!=filterColumnName&&!predicate.isNumber())if((wrapper=nameToVector.get(filterColumnName))&&("number"===wrapper.dataType||"[number]"===wrapper.dataType))if(predicate.getText)predicates[p]=new morpheus.Util.EqualsPredicate(filterColumnName,parseFloat(predicate.getText()));else if(predicate.getValues){var values=[];predicate.getValues().forEach(function(val){values.push(parseFloat(val))}),predicate[p]=new morpheus.Util.ExactTermsPredicate(filterColumnName,values)}}var matchAllPredicates=!0===options.matchAllPredicates;function isPredicateMatch(predicate){var filterColumnName=predicate.getField();if(null!=filterColumnName){var value=null;if(filterColumnName===indexField){if(value=i+1,predicate.accept(value))return!0}else if(wrapper=nameToVector.get(filterColumnName))if(value=wrapper.vector.getValue(i),wrapper.isArray){if(null!=value)for(var k=0;k<value.length;k++)if(predicate.accept(value[k]))return!0}else if(predicate.accept(value))return!0}else for(var j=0;j<nfields;j++){var wrapper;value=(wrapper=vectors[j]).vector.getValue(i);if(wrapper.isArray){if(null!=value)for(k=0;k<value.length;k++)if(predicate.accept(value[k]))return!0}else if(predicate.accept(value))return!0}}for(var nfields=vectors.length,i=0,nitems=model.getItemCount();i<nitems;i++)if(matchAllPredicates){var matches=!0;for(p=0;p<npredicates;p++){if(!isPredicateMatch(predicate=predicates[p])){matches=!1;break}}matches&&indices.push(i)}else for(var p=0;p<npredicates;p++){var predicate;if(isPredicateMatch(predicate=predicates[p])){indices.push(i);break}}return indices},morpheus.MetadataUtil.shallowCopy=function(model){for(var copy=new morpheus.MetadataModel(model.getItemCount()),i=0;i<model.getMetadataCount();i++){var v=model.get(i),newVector=new morpheus.VectorAdapter(v);newVector.properties=new morpheus.Map,newVector.getProperties=function(){return this.properties},v.getProperties().forEach(function(val,key){morpheus.VectorKeys.COPY_IGNORE.has(key)||newVector.properties.set(key,val)}),copy.vectors.push(newVector)}return copy},morpheus.MetadataUtil.autocomplete=function(model){return function(tokens,cb){var matches=[],regex=null,regexMatch=null,searchModel=model,token=null!=tokens&&tokens.length>0?tokens[tokens.selectionStartIndex]:"",fieldSearchFieldName=null;if(""!==(token=$.trim(token))){var semi=token.indexOf(":");if(semi>0&&92!==token.charCodeAt(semi-1)){var possibleField=$.trim(token.substring(0,semi));possibleField.length>0&&'"'===possibleField[0]&&'"'===possibleField[token.length-1]&&(possibleField=possibleField.substring(1,possibleField.length-1));var index=morpheus.MetadataUtil.indexOf(searchModel,possibleField);-1!==index&&(fieldSearchFieldName=possibleField,token=$.trim(token.substring(semi+1)),searchModel=new morpheus.MetadataModelColumnView(model,[index]))}var set=new morpheus.Set;regex=new RegExp(morpheus.Util.escapeRegex(token),"i"),regexMatch=new RegExp("("+morpheus.Util.escapeRegex(token)+")","i");for(var vectors=[],isArray=[],j=0;j<searchModel.getMetadataCount();j++){var v=searchModel.get(j);"string"!==(dataType=morpheus.VectorUtil.getDataType(v))&&"[string]"!==dataType||(vectors.push(v),isArray.push("[string]"===dataType))}var nfields=vectors.length;loop:for(var i=0,nitems=searchModel.getItemCount();i<nitems;i++)for(j=0;j<nfields;j++){var val=(v=vectors[j]).getValue(i);if(null!=val)if(isArray[j])for(var k=0;k<val.length;k++){var id=new morpheus.Identifier([val[k],v.getName()]);if(!set.has(id)&&regex.test(val[k])&&(set.add(id),10===set.size()))break loop}else{id=new morpheus.Identifier([val,v.getName()]);if(!set.has(id)&&regex.test(val)&&(set.add(id),10===set.size()))break loop}}set.forEach(function(id){var array=id.getArray(),field=array[1],val=array[0],quotedField=field;-1!==quotedField.indexOf(" ")&&(quotedField='"'+quotedField+'"');var quotedValue=val;-1!==quotedValue.indexOf(" ")&&(quotedValue='"'+quotedValue+'"'),matches.push({value:quotedField+":"+quotedValue,label:'<span style="font-weight:300;">'+field+":</span><span>"+val.replace(regexMatch,"<b>$1</b>")+"</span>"})})}null==regex&&(regex=new RegExp(".*","i"));for(j=0;j<searchModel.getMetadataCount();j++){v=searchModel.get(j);var dataType=morpheus.VectorUtil.getDataType(v),field=v.getName();if(("number"===dataType||"string"===dataType||"[string]"===dataType)&&regex.test(field)&&field!==fieldSearchFieldName){var quotedField=field;-1!==quotedField.indexOf(" ")&&(quotedField='"'+quotedField+'"'),matches.push({value:quotedField+":",label:'<span style="font-weight:300;">'+(null==regexMatch?field:field.replace(regexMatch,"<b>$1</b>"))+":</span>"+("number"===dataType?'<span style="font-weight:300;font-size:85%;">.., >, <, >=, <=, =</span>':""),show:!0})}}cb(matches)}},morpheus.MetadataUtil.getMetadataNames=function(metadataModel){for(var names=[],i=0,count=metadataModel.getMetadataCount();i<count;i++)names.push(metadataModel.get(i).getName(i));return names.sort(function(a,b){return(a=a.toLowerCase())<(b=b.toLowerCase())?-1:a===b?0:1}),names},morpheus.MetadataUtil.getVectors=function(metadataModel,names){var vectors=[];return names.forEach(function(name){var v=metadataModel.getByName(name);if(!v)throw name+" not found. Available fields are "+morpheus.MetadataUtil.getMetadataNames(metadataModel);vectors.push(v)}),vectors},morpheus.MetadataUtil.indexOf=function(metadataModel,name){for(var i=0,length=metadataModel.getMetadataCount();i<length;i++)if(name===metadataModel.get(i).getName())return i;return-1},morpheus.MetadataUtil.maybeConvertStrings=function(metadata,metadataStartIndex){for(var i=metadataStartIndex,count=metadata.getMetadataCount();i<count;i++)morpheus.VectorUtil.maybeConvertStringToNumber(metadata.get(i))},morpheus.MetadataUtil.copy=function(src,dest){if(src.getItemCount()!=dest.getItemCount())throw"Item count not equal in source and destination. "+src.getItemCount()+" != "+dest.getItemCount();for(var itemCount=src.getItemCount(),metadataColumns=src.getMetadataCount(),j=0;j<metadataColumns;j++){var srcVector=src.get(j),destVector=dest.getByName(srcVector.getName());null==destVector&&(destVector=dest.add(srcVector.getName()));for(var i=0;i<itemCount;i++)destVector.setValue(i,srcVector.getValue(i))}},morpheus.MetadataUtil.addVectorIfNotExists=function(metadataModel,name){var v=metadataModel.getByName(name);return v||(v=metadataModel.add(name)),v},morpheus.MetadataUtil.getMatchingIndices=function(metadataModel,tokens){for(var indices={},itemIndex=0,nitems=metadataModel.getItemCount();itemIndex<nitems;itemIndex++){for(var matches=!1,metadataIndex=0,metadataCount=metadataModel.getMetadataCount();metadataIndex<metadataCount&&!matches;metadataIndex++)for(var value=metadataModel.get(metadataModel.getColumnName(metadataIndex)).getValue(itemIndex),i=0,length=tokens.length;i<length;i++)if(tokens[i]==value){matches=!0;break}matches&&(indices[itemIndex]=1)}return indices},morpheus.MolarConcentration=function(){},morpheus.MolarConcentration.getMicroMolarConcentration=function(text){text=text.toLowerCase();for(var i=0;i<morpheus.MolarConcentration.CONCENTRATIONS.length;i++){var pair=morpheus.MolarConcentration.CONCENTRATIONS[i],key=pair[0],factorToMolar=pair[1],index=text.indexOf(key);if(-1!=index){var value=text.substring(0,index).trim(),factor=factorToMolar/1e7;return parseFloat(value)/factor}}},morpheus.MolarConcentration.CONCENTRATIONS=[["mm",1e4],["um",1e7],["m",1e7],["nm",1e10],["pm",1e13],["fm",1e16],["am",1e19],["zm",1e22],["ym",1e25],["m",1]],morpheus.Positions=function(){this.spaces=void 0,this.defaultPositionFunction=function(index){return this.size*index},this.squishedPositionFunction=function(index){return this.positions[index]},this.positionFunction=this.defaultPositionFunction,this.squishedIndices={},this.isSquished=!1},morpheus.Positions.getBottom=function(rect,rowPositions){var bottom=rowPositions.getLength();return null!=rect&&(bottom=1+rowPositions.getIndex(rect.y+rect.height,!1),bottom=Math.max(0,bottom),bottom=Math.min(rowPositions.getLength(),bottom)),bottom},morpheus.Positions.getTop=function(rect,rowPositions){var top=0;return null!=rect&&(top=rowPositions.getIndex(rect.y,!1)-1,top=Math.max(0,top),top=Math.min(rowPositions.getLength(),top)),top},morpheus.Positions.getLeft=function(rect,columnPositions){var left=0;return null!=rect&&(left=columnPositions.getIndex(rect.x,!1)-1,left=Math.max(0,left),left=Math.min(columnPositions.getLength(),left)),left},morpheus.Positions.getRight=function(rect,columnPositions){var right=columnPositions.getLength();return null!=rect&&(right=1+columnPositions.getIndex(rect.x+rect.width,!1),right=Math.min(columnPositions.getLength(),right)),right},morpheus.Positions.prototype={length:0,size:13,squishFactor:.1,compress:!0,copy:function(){var copy=new morpheus.Positions;return this.spaces&&(copy.spaces=this.spaces.slice()),copy.compress=this.compress,copy.squishFactor=this.squishFactor,copy.size=this.size,copy.length=this.length,this.isSquished&&(copy.positionFunction=copy.squishedPositionFunction,copy.squishedIndices=_.clone(this.squishedIndices),copy.isSquished=!0),copy},getIndex:function(position,exact){return 0===this.getLength()?-1:exact?this.binaryExactSearch(position):this.binaryInExactSearch(position)},getLength:function(){return this.length},getPosition:function(index){return this.positionFunction(index)+(void 0!==this.spaces?this.spaces[index]:0)},getItemSize:function(index){return!0===this.squishedIndices[index]?this.size*this.squishFactor:this.size},getSize:function(){return this.size},setSpaces:function(spaces){this.spaces=spaces},setLength:function(length){this.length=length,this.trigger("change",{source:this,value:"length"})},setSize:function(size){this.size=size,this.isSquished&&this.setSquishedIndices(this.squishedIndices),this.trigger("change",{source:this,value:"size"})},setSquishedIndices:function(squishedIndices){if(null!=squishedIndices){var compress=this.compress;this.squishedIndices=squishedIndices;for(var positions=[],squishFactor=this.squishFactor,size=this.size,position=0,i=0,length=this.getLength();i<length;i++){!0===squishedIndices[i]?(positions.push(position),position+=size*squishFactor):(compress||(position=size*i),positions.push(position),position+=size)}this.isSquished=!0,this.positions=positions,this.positionFunction=this.squishedPositionFunction}else this.squishedIndices={},this.isSquished=!1,this.positionFunction=this.defaultPositionFunction;this.trigger("change",{source:this,value:"squishedIndices"})},setSquishFactor:function(f){this.squishFactor!==f&&(this.squishFactor=f,this.isSquished&&this.setSquishedIndices(this.squishedIndices),this.trigger("change",{source:this,value:"squishFactor"}))},getSquishFactor:function(){return this.squishFactor},binaryExactSearch:function(position){for(var low=0,high=this.length-1;low<=high;){var mid=low+high>>1,midVal=this.getPosition(mid),size=this.getItemSize(mid);if(midVal<=position&&position<midVal+size)return mid;if(midVal<position)low=mid+1;else{if(!(midVal>position))return mid;high=mid-1}}return-1},binaryInExactSearch:function(position){var low=0,high=this.getLength()-1,maxIndex=this.getLength()-1;if(position<=this.getPosition(0))return 0;for(;low<=high;){var mid=low+high>>1,midVal=this.getPosition(mid),size=this.getItemSize(mid),nextStart=maxIndex===mid?midVal+size:this.getPosition(mid+1);if(midVal<=position&&position<nextStart)return mid;if(midVal<position)low=mid+1;else{if(!(midVal>position))return mid;high=mid-1}}return low-1}},morpheus.Util.extend(morpheus.Positions,morpheus.Events),morpheus.Project=function(dataset){this.originalDataset=dataset,this.rowIndexMapper=new morpheus.IndexMapper(this,!0),this.columnIndexMapper=new morpheus.IndexMapper(this,!1),this.groupRows=[],this.groupColumns=[],this.rowColorModel=new morpheus.VectorColorModel,this.columnColorModel=new morpheus.VectorColorModel,this.rowShapeModel=new morpheus.VectorShapeModel,this.columnShapeModel=new morpheus.VectorShapeModel,this.rowFontModel=new morpheus.VectorFontModel,this.columnFontModel=new morpheus.VectorFontModel,this.hoverColumnIndex=-1,this.hoverRowIndex=-1,this.columnSelectionModel=new morpheus.SelectionModel(this,!0),this.rowSelectionModel=new morpheus.SelectionModel(this,!1),this.elementSelectionModel=new morpheus.ElementSelectionModel(this),this.symmetricProjectListener=null,morpheus.Project._recomputeCalculatedColumnFields(this.originalDataset,morpheus.VectorKeys.RECOMPUTE_FUNCTION_NEW_HEAT_MAP),morpheus.Project._recomputeCalculatedColumnFields(new morpheus.TransposedDatasetView(this.originalDataset),morpheus.VectorKeys.RECOMPUTE_FUNCTION_NEW_HEAT_MAP)},morpheus.Project.Events={DATASET_CHANGED:"datasetChanged",ROW_GROUP_BY_CHANGED:"rowGroupByChanged",COLUMN_GROUP_BY_CHANGED:"columnGroupByChanged",ROW_FILTER_CHANGED:"rowFilterChanged",COLUMN_FILTER_CHANGED:"columnFilterChanged",ROW_SORT_ORDER_CHANGED:"rowSortOrderChanged",COLUMN_SORT_ORDER_CHANGED:"columnSortOrderChanged",ROW_TRACK_REMOVED:"rowTrackRemoved",COLUMN_TRACK_REMOVED:"columnTrackRemoved"},morpheus.Project._recomputeCalculatedColumnFields=function(dataset,key){for(var metadata=dataset.getColumnMetadata(),view=new morpheus.DatasetColumnView(dataset),nfound=0,metadataIndex=0,count=metadata.getMetadataCount();metadataIndex<count;metadataIndex++){var vector=metadata.get(metadataIndex);if(null!=vector.getProperties().get(morpheus.VectorKeys.FUNCTION)&&vector.getProperties().get(key)){for(var f=morpheus.VectorUtil.jsonToFunction(vector,morpheus.VectorKeys.FUNCTION),j=0,size=vector.size();j<size;j++)view.setIndex(j),vector.setValue(j,f(view,dataset,j));nfound++}}return nfound},morpheus.Project.prototype={isSymmetric:function(){return null!=this.symmetricProjectListener},setSymmetric:function(heatMap){null!=heatMap?null==this.symmetricProjectListener&&(this.symmetricProjectListener=new morpheus.SymmetricProjectListener(heatMap.getProject(),heatMap.vscroll,heatMap.hscroll)):(null!=this.symmetricProjectListener&&this.symmetricProjectListener.dispose(),this.symmetricProjectListener=null)},getHoverColumnIndex:function(){return this.hoverColumnIndex},setHoverColumnIndex:function(index){this.hoverColumnIndex=index},getHoverRowIndex:function(){return this.hoverRowIndex},setHoverRowIndex:function(index){this.hoverRowIndex=index},getRowColorModel:function(){return this.rowColorModel},getRowShapeModel:function(){return this.rowShapeModel},getColumnShapeModel:function(){return this.columnShapeModel},getRowFontModel:function(){return this.rowFontModel},getColumnFontModel:function(){return this.columnFontModel},getGroupRows:function(){return this.groupRows},getGroupColumns:function(){return this.groupColumns},getFullDataset:function(){return this.originalDataset},getColumnSelectionModel:function(){return this.columnSelectionModel},getRowSelectionModel:function(){return this.rowSelectionModel},getFilteredSortedRowIndices:function(){return this.rowIndexMapper.convertToView()},getFilteredSortedColumnIndices:function(){return this.columnIndexMapper.convertToView()},getElementSelectionModel:function(){return this.elementSelectionModel},setFullDataset:function(dataset,notify){this.originalDataset=dataset,this.rowIndexMapper.setFilter(this.rowIndexMapper.getFilter()),this.columnIndexMapper.setFilter(this.columnIndexMapper.getFilter()),this.columnSelectionModel.clear(),this.rowSelectionModel.clear(),this.elementSelectionModel.clear(),notify&&this.trigger(morpheus.Project.Events.DATASET_CHANGED)},setGroupRows:function(keys,notify){this.groupRows=keys;for(var i=0,nkeys=keys.length;i<nkeys;i++)void 0===keys[i].isColumns()&&keys[i].setColumns(!1);notify&&this.trigger(morpheus.Project.Events.ROW_GROUP_BY_CHANGED)},setGroupColumns:function(keys,notify){this.groupColumns=keys;for(var i=0,nkeys=keys.length;i<nkeys;i++)void 0===keys[i].isColumns()&&keys[i].setColumns(!0);notify&&this.trigger(morpheus.Project.Events.COLUMN_GROUP_BY_CHANGED)},setRowFilter:function(filter,notify){this._saveSelection(!1),this.rowIndexMapper.setFilter(filter),this._restoreSelection(!1),notify&&this.trigger(morpheus.Project.Events.ROW_FILTER_CHANGED)},getRowFilter:function(){return this.rowIndexMapper.getFilter()},getColumnFilter:function(){return this.columnIndexMapper.getFilter()},setColumnFilter:function(filter,notify){this._saveSelection(!0),this.columnIndexMapper.setFilter(filter),this._restoreSelection(!0),notify&&this.trigger(morpheus.Project.Events.COLUMN_FILTER_CHANGED)},getColumnColorModel:function(){return this.columnColorModel},getSortedFilteredDataset:function(){return new morpheus.SlicedDatasetView(this.getFullDataset(),this.rowIndexMapper.convertToView(),this.columnIndexMapper.convertToView())},getSelectedDataset:function(options){options=$.extend({},{selectedRows:!0,selectedColumns:!0,emptyToAll:!0},options);var dataset=this.getSortedFilteredDataset(),rows=null;options.selectedRows&&0===(rows=this.rowSelectionModel.getViewIndices().values().sort(function(a,b){return a===b?0:a<b?-1:1})).length&&options.emptyToAll&&(rows=null);var columns=null;return options.selectedColumns&&0===(columns=this.columnSelectionModel.getViewIndices().values().sort(function(a,b){return a===b?0:a<b?-1:1})).length&&options.emptyToAll&&(columns=null),null==rows&&null==columns?dataset:new morpheus.SlicedDatasetView(dataset,rows,columns)},_saveSelection:function(isColumns){this.elementSelectionModel.save(),isColumns?this.columnSelectionModel.save():this.rowSelectionModel.save()},_restoreSelection:function(isColumns){isColumns?this.columnSelectionModel.restore():this.rowSelectionModel.restore(),this.elementSelectionModel.restore()},setRowSortKeys:function(keys,notify){this._saveSelection(!1);for(var i=0,nkeys=keys.length;i<nkeys;i++)void 0===keys[i].isColumns()&&keys[i].setColumns(!1);this.rowIndexMapper.setSortKeys(keys),this._restoreSelection(!1),notify&&this.trigger(morpheus.Project.Events.ROW_SORT_ORDER_CHANGED)},setColumnSortKeys:function(keys,notify){this._saveSelection(!0);for(var i=0,nkeys=keys.length;i<nkeys;i++)void 0===keys[i].isColumns()&&keys[i].setColumns(!0);this.columnIndexMapper.setSortKeys(keys),this._restoreSelection(!0),notify&&this.trigger(morpheus.Project.Events.COLUMN_SORT_ORDER_CHANGED)},getRowSortKeys:function(){return this.rowIndexMapper.sortKeys},getColumnSortKeys:function(){return this.columnIndexMapper.sortKeys},convertViewColumnIndexToModel:function(viewIndex){return this.columnIndexMapper.convertViewIndexToModel(viewIndex)},convertViewRowIndexToModel:function(viewIndex){return this.rowIndexMapper.convertViewIndexToModel(viewIndex)},convertModelRowIndexToView:function(modelIndex){return this.rowIndexMapper.convertModelIndexToView(modelIndex)},convertModelColumnIndexToView:function(modelIndex){return this.columnIndexMapper.convertModelIndexToView(modelIndex)},isColumnViewIndexSelected:function(index){return this.columnSelectionModel.isViewIndexSelected(index)},isRowViewIndexSelected:function(index){return this.rowSelectionModel.isViewIndexSelected(index)}},morpheus.Util.extend(morpheus.Project,morpheus.Events),morpheus.QNorm=function(){},morpheus.QNorm.execute=function(data){var i,j,ind,dimat,rows=data.getRowCount(),cols=data.getColumnCount(),row_mean=new Float32Array(rows),ranks=new Float32Array(rows);for(dimat=morpheus.QNorm.get_di_matrix(data),j=0;j<cols;j++)dimat[j].sort(function(s1,s2){return s1.data<s2.data?-1:s1.data>s2.data?1:0});for(i=0;i<rows;i++){var sum=0,numNonMissing=0;for(j=0;j<cols;j++){var f=dimat[j][i].data;isNaN(f)||(sum+=f,numNonMissing++)}row_mean[i]=sum/numNonMissing}for(j=0;j<cols;j++)for(morpheus.QNorm.get_ranks(ranks,dimat[j],rows),i=0;i<rows;i++)ind=dimat[j][i].rank,ranks[i]-Math.floor(ranks[i])>.4?data.setValue(ind,j,.5*(row_mean[Math.floor(ranks[i])-1]+row_mean[Math.floor(ranks[i])])):data.setValue(ind,j,row_mean[Math.floor(ranks[i])-1])},morpheus.QNorm.get_di_matrix=function(data){var i,j,rows=data.getRowCount(),cols=data.getColumnCount(),dimat=[];for(j=0;j<cols;j++)for(dimat.push([]),i=0;i<rows;i++)dimat[j][i]={},dimat[j][i].data=data.getValue(i,j),dimat[j][i].rank=i;return dimat},morpheus.QNorm.get_ranks=function(rank,x,n){var i,j,k;for(i=0;i<n;){for(j=i;j<n-1&&x[j].data==x[j+1].data;)j++;if(i!=j)for(k=i;k<=j;k++)rank[k]=(i+j+2)/2;else rank[i]=i+1;i=j+1}},morpheus.SelectionModel=function(project,isColumns){this.viewIndices=new morpheus.Set,this.project=project,this.isColumns=isColumns},morpheus.SelectionModel.prototype={setViewIndices:function(indices,notify){this.viewIndices=indices,notify&&this.trigger("selectionChanged")},isViewIndexSelected:function(index){return this.viewIndices.has(index)},clear:function(){this.viewIndices=new morpheus.Set},getViewIndices:function(){return this.viewIndices},count:function(){return this.viewIndices.size()},toModelIndices:function(){var project=this.project,f=this.isColumns?project.convertViewColumnIndexToModel:project.convertViewRowIndexToModel;f=_.bind(f,project);var modelIndices=[];return this.viewIndices.forEach(function(index){var m=f(index);modelIndices.push(m)}),modelIndices},save:function(){this.modelIndices=this.toModelIndices()},restore:function(){var project=this.project;this.viewIndices=new morpheus.Set;var f=this.isColumns?project.convertModelColumnIndexToView:project.convertModelRowIndexToView;f=_.bind(f,project);for(var i=0,length=this.modelIndices.length;i<length;i++){var index=f(this.modelIndices[i]);-1!==index&&this.viewIndices.add(index)}}},morpheus.Util.extend(morpheus.SelectionModel,morpheus.Events),morpheus.SlicedDatasetView=function(dataset,rowIndices,columnIndices){morpheus.DatasetAdapter.call(this,dataset),null==rowIndices&&(rowIndices=null),null==columnIndices&&(columnIndices=null),this.rowIndices=rowIndices,this.columnIndices=columnIndices},morpheus.SlicedDatasetView.prototype={getRowCount:function(){return null!==this.rowIndices?this.rowIndices.length:this.dataset.getRowCount()},getColumnCount:function(){return null!==this.columnIndices?this.columnIndices.length:this.dataset.getColumnCount()},getValue:function(i,j,seriesIndex){return this.dataset.getValue(null!==this.rowIndices?this.rowIndices[i]:i,null!==this.columnIndices?this.columnIndices[j]:j,seriesIndex)},setValue:function(i,j,value,seriesIndex){this.dataset.setValue(null!==this.rowIndices?this.rowIndices[i]:i,null!==this.columnIndices?this.columnIndices[j]:j,value,seriesIndex)},getRowMetadata:function(){return null!==this.rowIndices?new morpheus.MetadataModelItemView(this.dataset.getRowMetadata(),this.rowIndices):this.dataset.getRowMetadata()},getColumnMetadata:function(){return null!==this.columnIndices?new morpheus.MetadataModelItemView(this.dataset.getColumnMetadata(),this.columnIndices):this.dataset.getColumnMetadata()},toString:function(){return this.getName()}},morpheus.Util.extend(morpheus.SlicedDatasetView,morpheus.DatasetAdapter),morpheus.SlicedVector=function(v,indices){morpheus.VectorAdapter.call(this,v),this.indices=indices},morpheus.SlicedVector.prototype={setValue:function(i,value){this.v.setValue(this.indices[i],value)},getValue:function(i){return this.v.getValue(this.indices[i])},size:function(){return this.indices.length}},morpheus.Util.extend(morpheus.SlicedVector,morpheus.VectorAdapter),morpheus.AbstractSortKey=function(name,columns){this.name=name,this.columns=columns},morpheus.AbstractSortKey.prototype={lockOrder:0,columns:!0,preservesDendrogram:!1,unlockable:!0,isColumns:function(){return this.columns},setColumns:function(columns){this.columns=columns},isPreservesDendrogram:function(){return this.preservesDendrogram},setPreservesDendrogram:function(preservesDendrogram){this.preservesDendrogram=preservesDendrogram},getLockOrder:function(){return this.lockOrder},isUnlockable:function(){return this.unlockable},setUnlockable:function(unlockable){this.unlockable=unlockable},setLockOrder:function(lockOrder){this.lockOrder=lockOrder},setSortOrder:function(sortOrder){this.sortOrder=sortOrder},getSortOrder:function(){return this.sortOrder},init:function(){}},morpheus.MatchesOnTopSortKey=function(project,modelIndices,name,columns){morpheus.AbstractSortKey.call(this,name,columns);for(var highlightedModelIndices={},viewIndices=[],i=0,j=modelIndices.length,length=modelIndices.length;i<length;i++,j--)highlightedModelIndices[modelIndices[i]]=-1,viewIndices.push(i);this.comparator=function(i1,i2){var a=highlightedModelIndices[i1];void 0===a&&(a=0);var b=highlightedModelIndices[i2];return void 0===b&&(b=0),a===b?0:a<b?-1:1},this.modelIndices=modelIndices,this.indices=viewIndices},morpheus.MatchesOnTopSortKey.prototype={toString:function(){return this.name},getSortOrder:function(){return 2},getComparator:function(){return this.comparator},getValue:function(i){return i}},morpheus.Util.extend(morpheus.MatchesOnTopSortKey,morpheus.AbstractSortKey),morpheus.SortKey=function(field,sortOrder,columns){morpheus.AbstractSortKey.call(this,field,columns),"string"==typeof sortOrder&&void 0===(sortOrder=morpheus.SortKey.SortOrder[sortOrder.toUpperCase()])&&(sortOrder=0),this.v=null,this.c=null,this.setSortOrder(sortOrder)},morpheus.SortKey.prototype={toString:function(){return this.name},init:function(dataset,visibleModelIndices){if(this.v=dataset.getRowMetadata().getByName(this.name),this.v){var dataType=morpheus.VectorUtil.getDataType(this.v);if("number"===dataType)this.c=this.sortOrder===morpheus.SortKey.SortOrder.ASCENDING?morpheus.SortKey.NUMBER_ASCENDING_COMPARATOR:morpheus.SortKey.NUMBER_DESCENDING_COMPARATOR;else if("[number]"===dataType){var summary=this.v.getProperties().get(morpheus.VectorKeys.ARRAY_SUMMARY_FUNCTION)||morpheus.SortKey.ARRAY_MAX_SUMMARY_FUNCTION;this.c=this.sortOrder===morpheus.SortKey.SortOrder.ASCENDING?morpheus.SortKey.ARRAY_ASCENDING_COMPARATOR(summary):morpheus.SortKey.ARRAY_DESCENDING_COMPARATOR(summary)}else this.c=this.sortOrder===morpheus.SortKey.SortOrder.ASCENDING?morpheus.SortKey.ASCENDING_COMPARATOR:morpheus.SortKey.DESCENDING_COMPARATOR;if(null!=this.customComparator){var oldC=this.c,customComparator=this.customComparator;this.sortOrder===morpheus.SortKey.SortOrder.ASCENDING?this.c=function(a,b){var val=customComparator(a,b);return 0===val?oldC(a,b):val}:this.c=function(a,b){var val=customComparator(b,a);return 0===val?oldC(a,b):val}}}else this.v={},this.v.getValue=function(){return 0},this.c=this.sortOrder===morpheus.SortKey.SortOrder.ASCENDING?morpheus.SortKey.ASCENDING_COMPARATOR:morpheus.SortKey.DESCENDING_COMPARATOR;if(this.sortOrder===morpheus.SortKey.SortOrder.TOP_N){for(var pairs=[],missingIndices=[],i=0,nrows=visibleModelIndices.length;i<nrows;i++){var index=visibleModelIndices[i],value=this.v.getValue(index);isNaN(value)?missingIndices.push(index):pairs.push({index:index,value:value})}var c=this.c;this.c=morpheus.SortKey.NUMBER_ASCENDING_COMPARATOR,pairs.sort(function(pair1,pair2){return c(pair1.value,pair2.value)});for(var modelIndexToValue=[],nInGroup=Math.min(pairs.length,10),counter=0,topIndex=0,half=Math.floor(pairs.length/2),topPairs=pairs.slice(0,half),bottomPairs=pairs.slice(half),bottomIndex=bottomPairs.length-1,ntop=topPairs.length,npairs=pairs.length;counter<npairs;){for(i=0;i<nInGroup&&topIndex<ntop;i++,topIndex++,counter++)modelIndexToValue[topPairs[topIndex].index]=counter;var indexCounterPairs=[];for(i=0;i<nInGroup&&bottomIndex>=0;i++,bottomIndex--,counter++)indexCounterPairs.push([bottomPairs[bottomIndex].index,counter]);i=indexCounterPairs.length-1;for(var j=0;i>=0;i--,j++){var item_i=indexCounterPairs[i],item_j=indexCounterPairs[j];modelIndexToValue[item_i[0]]=item_j[1]}}i=0;for(var length=missingIndices.length;i<length;i++,counter++)modelIndexToValue[missingIndices[i]]=counter;this.modelIndexToValue=modelIndexToValue}else delete this.modelIndexToValue},getComparator:function(){return this.c},getValue:function(i){return this.modelIndexToValue?this.modelIndexToValue[i]:this.v.getValue(i)}},morpheus.Util.extend(morpheus.SortKey,morpheus.AbstractSortKey),morpheus.SortByValuesKey=function(modelIndices,sortOrder,isColumnSort){morpheus.AbstractSortKey.call(this,"values",isColumnSort),this.bothCount=10,this.modelIndices=modelIndices,this.sortOrder=sortOrder,this.setSortOrder(sortOrder)},morpheus.SortByValuesKey.prototype={toString:function(){return this.name},init:function(dataset,visibleModelIndices){if(this.dataset=new morpheus.SlicedDatasetView(dataset,null,this.modelIndices),this.rowView=new morpheus.DatasetRowView(this.dataset),this.summaryFunction=this.modelIndices.length>1?morpheus.Median:function(row){return row.getValue(0)},this.sortOrder===morpheus.SortKey.SortOrder.TOP_N){for(var pairs=[],missingIndices=[],i=0,nrows=visibleModelIndices.length;i<nrows;i++){var index=visibleModelIndices[i],value=this.summaryFunction(this.rowView.setIndex(index));isNaN(value)?missingIndices.push(index):pairs.push({index:index,value:value})}pairs.sort(function(a,b){return a.value<b.value?1:a.value===b.value?0:-1});for(var modelIndexToValue=[],nInGroup=Math.min(pairs.length,this.bothCount),counter=0,topIndex=0,half=Math.floor(pairs.length/2),topPairs=pairs.slice(0,half),bottomPairs=pairs.slice(half),bottomIndex=bottomPairs.length-1,ntop=topPairs.length,npairs=pairs.length;counter<npairs;){for(i=0;i<nInGroup&&topIndex<ntop;i++,topIndex++,counter++)modelIndexToValue[topPairs[topIndex].index]=counter;var indexCounterPairs=[];for(i=0;i<nInGroup&&bottomIndex>=0;i++,bottomIndex--,counter++)indexCounterPairs.push([bottomPairs[bottomIndex].index,counter]);i=indexCounterPairs.length-1;for(var j=0;i>=0;i--,j++){var item_i=indexCounterPairs[i],item_j=indexCounterPairs[j];modelIndexToValue[item_i[0]]=item_j[1]}}i=0;for(var length=missingIndices.length;i<length;i++,counter++)modelIndexToValue[missingIndices[i]]=counter;this.modelIndexToValue=modelIndexToValue}else delete this.modelIndexToValue},getComparator:function(){return this.c},getValue:function(i){return this.modelIndexToValue?this.modelIndexToValue[i]:this.summaryFunction(this.rowView.setIndex(i))},setSortOrder:function(sortOrder){"string"==typeof sortOrder&&(sortOrder=morpheus.SortKey.SortOrder[sortOrder.toUpperCase()]),this.sortOrder=sortOrder,this.sortOrder===morpheus.SortKey.SortOrder.ASCENDING?this.c=morpheus.SortKey.ELEMENT_ASCENDING_COMPARATOR:this.sortOrder===morpheus.SortKey.SortOrder.DESCENDING?this.c=morpheus.SortKey.ELEMENT_DESCENDING_COMPARATOR:this.c=morpheus.SortKey.NUMBER_ASCENDING_COMPARATOR}},morpheus.Util.extend(morpheus.SortByValuesKey,morpheus.AbstractSortKey),morpheus.SpecifiedModelSortOrder=function(modelIndices,nvisible,name,columns){morpheus.AbstractSortKey.call(this,name,columns),this.nvisible=nvisible;for(var modelIndexToValue=[],i=0,length=modelIndices.length;i<length;i++)modelIndexToValue[modelIndices[i]]=i;this.modelIndices=modelIndices,this.modelIndexToValue=modelIndexToValue,this.c=morpheus.SortKey.NUMBER_ASCENDING_COMPARATOR},morpheus.SpecifiedModelSortOrder.prototype={toString:function(){return this.name},getComparator:function(a,b){return this.c},getValue:function(i){return this.modelIndexToValue[i]},setSortOrder:function(sortOrder){this.sortOrder=sortOrder,this.c=this.sortOrder===morpheus.SortKey.SortOrder.ASCENDING?morpheus.SortKey.NUMBER_ASCENDING_COMPARATOR:morpheus.SortKey.NUMBER_DESCENDING_COMPARATOR}},morpheus.Util.extend(morpheus.SpecifiedModelSortOrder,morpheus.AbstractSortKey),morpheus.SpecifiedGroupByKey=function(clusterIds,columns){morpheus.AbstractSortKey.call(this,"Dendrogram Cut",columns),this.clusterIds=clusterIds,this.c=function(a,b){return a===b?0:a<b?-1:1}},morpheus.SpecifiedGroupByKey.prototype={toString:function(){return this.name},getComparator:function(a,b){return this.c},getValue:function(i){return this.clusterIds[i]}},morpheus.Util.extend(morpheus.SpecifiedGroupByKey,morpheus.AbstractSortKey),morpheus.SortKey.SortOrder={ASCENDING:0,DESCENDING:1,UNSORTED:2,CUSTOM:3,TOP_N:4},morpheus.SortKey.ASCENDING_COMPARATOR=function(a,b){var aNaN=null==a,bNaN=null==b;return aNaN&&bNaN?0:aNaN?1:bNaN?-1:(a=(""+a).toLowerCase())===(b=(""+b).toLowerCase())?0:a<b?-1:1},morpheus.SortKey.DESCENDING_COMPARATOR=function(a,b){var aNaN=null==a,bNaN=null==b;return aNaN&&bNaN?0:aNaN?1:bNaN?-1:(a=(""+a).toLowerCase())===(b=(""+b).toLowerCase())?0:a<b?1:-1},morpheus.SortKey.NUMBER_ASCENDING_COMPARATOR=function(a,b){var aNaN=null==a||isNaN(a),bNaN=null==b||isNaN(b);return aNaN&&bNaN?0:aNaN?1:bNaN?-1:a===b?0:a<b?-1:1},morpheus.SortKey.NUMBER_DESCENDING_COMPARATOR=function(a,b){var aNaN=null==a||isNaN(a),bNaN=null==b||isNaN(b);return aNaN&&bNaN?0:aNaN?1:bNaN?-1:a===b?0:a<b?1:-1},morpheus.SortKey.STRING_ASCENDING_COMPARATOR=function(a,b){return(a=null==a||void 0===a.toLowerCase?null:a.toLowerCase())===(b=null==b||void 0===b.toLowerCase?null:b.toLowerCase())?0:a<b?-1:1},morpheus.SortKey.STRING_DESCENDING_COMPARATOR=function(a,b){return(a=null==a||void 0===a.toLowerCase?null:a.toLowerCase())===(b=null==b||void 0===b.toLowerCase?null:b.toLowerCase())?0:a<b?1:-1},morpheus.SortKey.ELEMENT_ASCENDING_COMPARATOR=function(obj1,obj2){var a=+obj1,b=+obj2,aNaN=isNaN(a),bNaN=isNaN(b);if(aNaN&&bNaN)return 0;if(aNaN)return 1;if(bNaN)return-1;if(a===b&&null!=obj1&&obj1.toObject&&null!=obj2&&obj2.toObject){var a1=obj1.toObject(),b1=obj2.toObject();for(var name in a1){var c=(a=a1[name])===(b=b1[name])?0:a<b?-1:1;if(0!==c)return c}}return a===b?0:a<b?-1:1},morpheus.SortKey.ELEMENT_DESCENDING_COMPARATOR=function(obj1,obj2){var a=+obj1,b=+obj2,aNaN=isNaN(a),bNaN=isNaN(b);if(aNaN&&bNaN)return 0;if(aNaN)return 1;if(bNaN)return-1;if(a===b&&null!=obj1&&obj1.toObject&&null!=obj2&&obj2.toObject){var a1=obj1.toObject(),b1=obj2.toObject();for(var name in a1){var c=(a=a1[name])===(b=b1[name])?0:a<b?1:-1;if(0!==c)return c}}return a===b?0:a<b?1:-1},morpheus.SortKey.BOX_PLOT_SUMMARY_FUNCTION=function(array){var box=array.box;if(null==box){var v=morpheus.VectorUtil.arrayAsVector(array);box=morpheus.BoxPlotItem(null!=this.indices?new morpheus.SlicedVector(v,this.indices):v),array.box=box}return box.q3},morpheus.SortKey.ARRAY_MAX_SUMMARY_FUNCTION=function(array){var a=0;if(null!=array){for(var aPosMax=-Number.MAX_VALUE,aNegMax=Number.MAX_VALUE,i=0,length=array.length;i<length;i++){var value=array[i];isNaN(value)||(value>=0?aPosMax=value>aPosMax?value:aPosMax:aNegMax=value<aNegMax?value:aNegMax)}aPosMax!==-Number.MAX_VALUE&&(a=aPosMax),aNegMax!==Number.MAX_VALUE&&(a=Math.abs(aNegMax)>a?aNegMax:a)}return a},morpheus.SortKey.ARRAY_ASCENDING_COMPARATOR=function(summary){return function(a,b){var aNaN=null==a,bNaN=null==b;return aNaN&&bNaN?0:aNaN?1:bNaN?-1:(a=summary(a),b=summary(b),aNaN=isNaN(a),bNaN=isNaN(b),aNaN&&bNaN?0:aNaN?1:bNaN?-1:a===b?0:a<b?-1:1)}},morpheus.SortKey.ARRAY_DESCENDING_COMPARATOR=function(summary){return function(a,b){var aNaN=null==a,bNaN=null==b;return aNaN&&bNaN?0:aNaN?1:bNaN?-1:(a=summary(a),b=summary(b),aNaN=isNaN(a),bNaN=isNaN(b),aNaN&&bNaN?0:aNaN?1:bNaN?-1:a===b?0:a<b?1:-1)}},morpheus.SortKey.reverseComparator=function(c){return function(a,b){return c(b,a)}},morpheus.SortKey.keepExistingSortKeys=function(newSortKeys,existingSortKeys){for(var i=0,length=existingSortKeys.length;i<length;i++){var key=existingSortKeys[i];if(key.getLockOrder()>0){for(var existingIndex=-1,j=0;j<newSortKeys.length;j++)if(newSortKeys[j]===key){existingIndex=j;break}-1!==existingIndex&&newSortKeys.splice(existingIndex,1),newSortKeys.splice(1===key.getLockOrder()?0:newSortKeys.length,0,key)}}return newSortKeys},morpheus.SortKey.fromJSON=function(project,json){var sortKeys=[];return json.forEach(function(key){var sortKey=null;if("annotation"===key.type){if(sortKey=new morpheus.SortKey(key.field,key.order,key.isColumns),null!=key.customSortOrder){for(var customSortOrderMap=new morpheus.Map,i=0,size=key.customSortOrder.length;i<size;i++)customSortOrderMap.set(key.customSortOrder[i],i);sortKey.customComparator=function(a,b){var v1=customSortOrderMap.get(a),v2=customSortOrderMap.get(b);return void 0===v1&&void 0===v2?0:(void 0===v1&&(v1=1/0),void 0===v2&&(v2=1/0),v1<v2?-1:1)},key.preservesDendrogram&&(sortKey.nvisible=key.customSortOrder.length)}}else"byValues"===key.type?sortKey=new morpheus.SortByValuesKey(key.modelIndices,key.order,key.isColumns):"specified"===key.type?sortKey=new morpheus.SpecifiedModelSortOrder(key.modelIndices,key.nvisible,key.name,key.isColumns):"matchesOnTop"===key.type?sortKey=new morpheus.MatchesOnTopSortKey(project,key.modelIndices,key.name,key.isColumns):null!=key.field?sortKey=new morpheus.SortKey(key.field,key.order):console.log("Unknown key: "+key);null!=sortKey&&(null!=key.preservesDendrogram&&sortKey.setPreservesDendrogram(key.preservesDendrogram),null!=key.lockOrder&&0!==key.lockOrder&&(sortKey.setLockOrder(key.lockOrder),sortKey.setUnlockable(key.unlockable)),sortKeys.push(sortKey))}),sortKeys},morpheus.SortKey.toJSON=function(sortKeys){var json=[];return sortKeys.forEach(function(key){var sortKey=null;key instanceof morpheus.SortKey?sortKey={isColumns:key.isColumns(),order:key.getSortOrder(),type:"annotation",field:""+key}:key instanceof morpheus.SortByValuesKey?sortKey={isColumns:key.isColumns(),order:key.getSortOrder(),type:"byValues",modelIndices:key.modelIndices}:key instanceof morpheus.SpecifiedModelSortOrder?sortKey={isColumns:key.isColumns(),order:key.getSortOrder(),type:"specified",modelIndices:key.modelIndices,name:key.name,nvisible:key.nvisible}:key instanceof morpheus.MatchesOnTopSortKey?sortKey={isColumns:key.isColumns(),order:key.getSortOrder(),type:"matchesOnTop",modelIndices:key.modelIndices,name:key.name}:console.log("Unknown sort key type "+sortKey),null!=sortKey?(sortKey.preservesDendrogram=key.isPreservesDendrogram(),key.getLockOrder&&0!==key.getLockOrder()&&(sortKey.lockOrder=key.getLockOrder(),sortKey.unlockable=!!key.isUnlockable&&key.isUnlockable()),json.push(sortKey)):console.log("Unknown sort key type")}),json},morpheus.SymmetricProjectListener=function(project,vscroll,hscroll){var rowGroupBy,columnGroupBy,rowFilter,columnFilter,rowSortOrder,columnSortOrder,columnSelection,rowSelection,vscrollFunction,hscrollFunction,ignoreEvent=!1;project.on(morpheus.Project.Events.ROW_GROUP_BY_CHANGED,rowGroupBy=function(){ignoreEvent||(ignoreEvent=!0,project.setGroupColumns(project.getGroupRows(),!0),ignoreEvent=!1)}),project.on(morpheus.Project.Events.COLUMN_GROUP_BY_CHANGED,columnGroupBy=function(){ignoreEvent||(ignoreEvent=!0,project.setGroupRows(project.getGroupColumns(),!0),ignoreEvent=!1)}),project.on(morpheus.Project.Events.ROW_FILTER_CHANGED,rowFilter=function(){ignoreEvent||(ignoreEvent=!0,project.setColumnFilter(project.getRowFilter(),!0),ignoreEvent=!1)}),project.on(morpheus.Project.Events.COLUMN_FILTER_CHANGED,columnFilter=function(){ignoreEvent||(ignoreEvent=!0,project.setRowFilter(project.getColumnFilter(),!0),ignoreEvent=!1)}),project.on(morpheus.Project.Events.ROW_SORT_ORDER_CHANGED,rowSortOrder=function(){ignoreEvent||(ignoreEvent=!0,project.setColumnSortKeys(project.getRowSortKeys(),!0),ignoreEvent=!1)}),project.on(morpheus.Project.Events.COLUMN_SORT_ORDER_CHANGED,columnSortOrder=function(){ignoreEvent||(ignoreEvent=!0,project.setRowSortKeys(project.getColumnSortKeys(),!0),ignoreEvent=!1)}),project.getColumnSelectionModel().on("selectionChanged",columnSelection=function(){ignoreEvent||(ignoreEvent=!0,project.getRowSelectionModel().setViewIndices(project.getColumnSelectionModel().getViewIndices(),!0),ignoreEvent=!1)}),project.getRowSelectionModel().on("selectionChanged",rowSelection=function(){ignoreEvent||(ignoreEvent=!0,project.getColumnSelectionModel().setViewIndices(project.getRowSelectionModel().getViewIndices(),!0),ignoreEvent=!1)}),vscroll.on("scroll",vscrollFunction=function(){if(!ignoreEvent){ignoreEvent=!0;var f=0===vscroll.getMaxValue()?0:vscroll.getValue()/vscroll.getMaxValue();hscroll.setValue(f*hscroll.getMaxValue(),!0),ignoreEvent=!1}}),hscroll.on("scroll",hscrollFunction=function(){if(!ignoreEvent){ignoreEvent=!0;var f=0===hscroll.getMaxValue()?0:hscroll.getValue()/hscroll.getMaxValue();vscroll.setValue(f*vscroll.getMaxValue(),!0),ignoreEvent=!1}}),this.dispose=function(){project.off(morpheus.Project.Events.ROW_GROUP_BY_CHANGED,rowGroupBy),project.off(morpheus.Project.Events.COLUMN_GROUP_BY_CHANGED,columnGroupBy),project.off(morpheus.Project.Events.ROW_FILTER_CHANGED,rowFilter),project.off(morpheus.Project.Events.COLUMN_FILTER_CHANGED,columnFilter),project.off(morpheus.Project.Events.ROW_SORT_ORDER_CHANGED,rowSortOrder),project.off(morpheus.Project.Events.COLUMN_SORT_ORDER_CHANGED,columnSortOrder),project.getColumnSelectionModel().off("selectionChanged",columnSelection),project.getRowSelectionModel().off("selectionChanged",rowSelection),vscroll.off("scroll",vscrollFunction),hscroll.off("scroll",hscrollFunction)}},morpheus.TransposedDatasetView=function(dataset){morpheus.DatasetAdapter.call(this,dataset)},morpheus.TransposedDatasetView.prototype={getRowCount:function(){return this.dataset.getColumnCount()},getColumnCount:function(){return this.dataset.getRowCount()},getValue:function(i,j,seriesIndex){return this.dataset.getValue(j,i,seriesIndex)},setValue:function(i,j,value,seriesIndex){this.dataset.setValue(j,i,value,seriesIndex)},getRowMetadata:function(){return this.dataset.getColumnMetadata()},getColumnMetadata:function(){return this.dataset.getRowMetadata()}},morpheus.Util.extend(morpheus.TransposedDatasetView,morpheus.DatasetAdapter),morpheus.Percentile=function(vector,p,isSorted){return morpheus.ArrayPercentile(morpheus.RemoveNaN(vector),p,isSorted)},morpheus.Percentile.toString=function(){return"Percentile"},morpheus.RemoveNaN=function(values){for(var array=[],i=0,size=values.size();i<size;i++){var value=values.getValue(i);isNaN(value)||array.push(value)}return array},morpheus.Median=function(vector){return morpheus.ArrayPercentile(morpheus.RemoveNaN(vector),50,!1)},morpheus.Median.toString=function(){return"Median"},morpheus.ArrayPercentile=function(values,p,isSorted){return isSorted||values.sort(function(a,b){return a<b?-1:a===b?0:1}),d3.quantile(values,p/100)},morpheus.MaxPercentiles=function(percentiles){var f=function(vector){for(var values=[],i=0,size=vector.size();i<size;i++){var value=vector.getValue(i);isNaN(value)||values.push(value)}if(0===values.length)return NaN;values.sort(function(a,b){return a<b?-1:a===b?0:1});var max=0;for(i=0;i<percentiles.length;i++){var p=morpheus.ArrayPercentile(values,percentiles[i],!0);Math.abs(p)>Math.abs(max)&&(max=p)}return max};return f.toString=function(){for(var s=["Maximum of "],i=0,length=percentiles.length;i<length;i++)i>0&&length>2&&s.push(", "),i===length-1&&s.push(2==length?" and ":"and "),s.push(percentiles[i]);return s.push(" percentiles"),s.join("")},f},morpheus.CountIf=function(vector,criteria){/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var matches=0,i=0,size=vector.size();i<size;i++){var value=vector.getValue(i);eval(value+criteria)&&matches++}return matches},morpheus.Mean=function(vector){for(var sum=0,count=0,i=0,length=vector.size();i<length;i++){var val=vector.getValue(i);isNaN(val)||(sum+=val,count++)}return 0===count?NaN:sum/count},morpheus.Mean.toString=function(){return"Mean"},morpheus.Sum=function(vector){for(var sum=0,found=!1,i=0,length=vector.size();i<length;i++){var val=vector.getValue(i);isNaN(val)||(found=!0,sum+=val)}return found?sum:NaN},morpheus.Sum.toString=function(){return"Sum"},morpheus.CountNonNaN=function(vector){for(var count=0,i=0,length=vector.size();i<length;i++){var val=vector.getValue(i);isNaN(val)||count++}return count},morpheus.CountNonNaN.toString=function(){return"Count non-NaN"},morpheus.Max=function(vector){for(var max=-Number.MAX_VALUE,found=!1,i=0,length=vector.size();i<length;i++){var val=vector.getValue(i);isNaN(val)||(found=!0,max=Math.max(max,val))}return found?max:NaN},morpheus.Max.toString=function(){return"Max"},morpheus.Min=function(vector){for(var min=Number.MAX_VALUE,found=!1,i=0,length=vector.size();i<length;i++){var val=vector.getValue(i);isNaN(val)||(found=!0,min=Math.min(min,val))}return found?min:NaN},morpheus.Min.toString=function(){return"Min"},morpheus.Variance=function(list,mean){void 0==mean&&(mean=morpheus.Mean(list));for(var sum=0,n=0,j=0,size=list.size();j<size;j++){var x=list.getValue(j);if(!isNaN(x)){var diff=x-mean;sum+=diff*=diff,n++}}return n<=1?NaN:((n-=1)<1&&(n=1),sum/n)},morpheus.Variance.toString=function(){return"Variance"},morpheus.StandardDeviation=function(list,mean){return Math.sqrt(morpheus.Variance(list,mean))},morpheus.StandardDeviation.toString=function(){return"Standard deviation"};var LOG_10=Math.log(10);morpheus.Log10=function(x){return x<=0?0:Math.log(x)/LOG_10};var LOG_2=Math.log(2);morpheus.Log2=function(x){return x<=0?0:Math.log(x)/LOG_2},morpheus.FDR_BH=function(nominalPValues){for(var size=nominalPValues.length,i=0;i<size;i++){var value=nominalPValues[i];(value>1||isNaN(value))&&(nominalPValues[i]=1)}var pValueIndices=morpheus.Util.indexSort(nominalPValues,!0),ranks=morpheus.Util.rankIndexArray(pValueIndices);for(i=pValueIndices.length-1;i>0;i--){nominalPValues[pValueIndices[i]]==nominalPValues[pValueIndices[i-1]]&&(ranks[pValueIndices[i-1]]=ranks[pValueIndices[i]])}var fdr=new Float32Array(size);for(i=0;i<size;i++){var rank=ranks[i],p=nominalPValues[i];fdr[i]=p*size/rank}var pIndices=morpheus.Util.indexSort(nominalPValues,!1);for(i=0;i<pIndices.length-1;i++){var highIndex=pIndices[i],lowIndex=pIndices[i+1];fdr[lowIndex]=Math.min(fdr[lowIndex],fdr[highIndex])}for(i=0;i<size;i++)fdr[i]=Math.min(fdr[i],1);return fdr},morpheus.FDR_BH.tString=function(){return"FDR(BH)"},morpheus.MAD=function(list,median){null==median&&(median=morpheus.Percentile(list,50));for(var temp=[],j=0,size=list.size();j<size;j++){var value=list.getValue(j);isNaN(value)||temp.push(Math.abs(value-median))}return 1.4826*morpheus.Percentile(new morpheus.Vector("",temp.length).setArray(temp),50)},morpheus.MAD.toString=function(){return"Median absolute deviation"},morpheus.CV=function(list){var mean=morpheus.Mean(list);return Math.sqrt(morpheus.Variance(list,mean))/mean},morpheus.CV.toString=function(){return"Coefficient of variation"},morpheus.BoxPlotItem=function(list){var values=morpheus.RemoveNaN(list);return values.sort(function(a,b){return a===b?0:a<b?-1:1}),0===values.length?{median:NaN,q1:NaN,q3:NaN,lowerAdjacentValue:NaN,upperAdjacentValue:NaN}:morpheus.BoxPlotArrayItem(values)},morpheus.BoxPlotArrayItem=function(values){for(var median=morpheus.ArrayPercentile(values,50,!0),q1=morpheus.ArrayPercentile(values,25,!0),q3=morpheus.ArrayPercentile(values,75,!0),upperAdjacentValue=-Number.MAX_VALUE,lowerAdjacentValue=Number.MAX_VALUE,upperOutlier=q3+1.5*(q3-q1),lowerOutlier=q1-1.5*(q3-q1),sum=0,i=0,length=values.length;i<length;i++){var value=values[i];value<=upperOutlier&&(upperAdjacentValue=Math.max(upperAdjacentValue,value)),value>=lowerOutlier&&(lowerAdjacentValue=Math.min(lowerAdjacentValue,value)),sum+=value}var mean=sum/values.length;return lowerAdjacentValue>q1&&(lowerAdjacentValue=q1),upperAdjacentValue<q3&&(upperAdjacentValue=q3),{mean:mean,median:median,q1:q1,q3:q3,lowerAdjacentValue:lowerAdjacentValue,upperAdjacentValue:upperAdjacentValue}},morpheus.VectorColorModel=function(){this.vectorNameToColorMap=new morpheus.Map,this.vectorNameToColorScheme=new morpheus.Map,this.colors=morpheus.VectorColorModel.TWENTY_COLORS},morpheus.VectorColorModel.YES_COLOR="#d8b365",morpheus.VectorColorModel.FEMALE="#ff99ff",morpheus.VectorColorModel.MALE="#66ccff",morpheus.VectorColorModel.TWENTY_COLORS=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],morpheus.VectorColorModel.CATEGORY_20A=morpheus.VectorColorModel.TWENTY_COLORS,morpheus.VectorColorModel.CATEGORY_20B=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],morpheus.VectorColorModel.CATEGORY_20C=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"],morpheus.VectorColorModel.CATEGORY_ALL=[].concat(morpheus.VectorColorModel.CATEGORY_20A,morpheus.VectorColorModel.CATEGORY_20B,morpheus.VectorColorModel.CATEGORY_20C),morpheus.VectorColorModel.TABLEAU10=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],morpheus.VectorColorModel.STANDARD_COLORS={na:"#c0c0c0",nan:"#c0c0c0","":"#ffffff",wt:"#ffffff",n:"#ffffff",0:"#ffffff",y:morpheus.VectorColorModel.YES_COLOR,1:morpheus.VectorColorModel.YES_COLOR,male:morpheus.VectorColorModel.MALE,m:morpheus.VectorColorModel.MALE,female:morpheus.VectorColorModel.FEMALE,f:morpheus.VectorColorModel.FEMALE,kd:"#C675A8",oe:"#56b4e9",cp:"#FF9933",pcl:"#003B4A","trt_sh.cgs":"#C675A8",trt_oe:"#56b4e9",trt_cp:"#FF9933",a375:"#1490C1",a549:"#AAC8E9",hcc515:"#1C9C2A",hepg2:"#94DC89",ht29:"#946DBE",mcf7:"#C5B2D5",pc3:"#38C697",asc:"#FF8000",cd34:"#FFBB75",ha1e:"#FB4124",neu:"#FF9A94",npc:"#E57AC6",cancer:"#1490C1","immortalized normal":"#FF8000"},morpheus.VectorColorModel.getStandardColor=function(value){if(null==value)return"#ffffff";var stringValue=value.toString().toLowerCase();return morpheus.VectorColorModel.STANDARD_COLORS[stringValue]},morpheus.VectorColorModel.getColorMapForNumber=function(length){return(length<3?colorbrewer.Set1[3]:colorbrewer.Paired[length])||morpheus.VectorColorModel.TWENTY_COLORS},morpheus.VectorColorModel.prototype={toJSON:function(tracks){var _this=this,json={};return tracks.forEach(function(track){if(track.getFullVector().getProperties().get(morpheus.VectorKeys.DISCRETE)){var colorMap=_this.vectorNameToColorMap.get(track.getName());null!=colorMap&&(json[track.getName()]=colorMap)}else{var colorScheme=_this.vectorNameToColorScheme.get(track.getName());if(null!=colorScheme&&void 0!==colorScheme.getCurrentColorSupplier){var colorSchemeJSON=morpheus.AbstractColorSupplier.toJSON(colorScheme.getCurrentColorSupplier());json[track.getName()]=colorSchemeJSON}else console.log("Unknown color scheme")}}),json},fromJSON:function(json){for(var name in json){var obj=json[name];obj.colors?(obj.scalingMode="fixed",this.vectorNameToColorScheme.set(name,morpheus.AbstractColorSupplier.fromJSON(obj))):this.vectorNameToColorMap.set(name,morpheus.Map.fromJSON(obj))}},clear:function(vector){this.vectorNameToColorMap.remove(vector.getName()),this.vectorNameToColorScheme.remove(vector.getName())},copy:function(){var c=new morpheus.VectorColorModel;return c.colors=this.colors.slice(0),this.vectorNameToColorMap.forEach(function(colorMap,name){var newColorMap=new morpheus.Map;newColorMap.setAll(colorMap),c.vectorNameToColorMap.set(name,newColorMap)}),this.vectorNameToColorScheme.forEach(function(colorScheme,name){c.vectorNameToColorScheme.set(name,colorScheme.copy(new morpheus.Project(new morpheus.Dataset({name:"",rows:1,columns:1}))))}),c},clearAll:function(){this.vectorNameToColorMap=new morpheus.Map,this.vectorNameToColorScheme=new morpheus.Map},containsDiscreteColor:function(vector,value){var metadataValueToColorMap=this.vectorNameToColorMap.get(vector.getName());return void 0!==metadataValueToColorMap&&null!=metadataValueToColorMap.get(value)},setDiscreteColorMap:function(colors){this.colors=colors},getContinuousColorScheme:function(vector){return this.vectorNameToColorScheme.get(vector.getName())},getDiscreteColorScheme:function(vector){return this.vectorNameToColorMap.get(vector.getName())},createContinuousColorMap:function(vector){var minMax=morpheus.VectorUtil.getMinMax(vector),min=minMax.min,max=minMax.max,cs=new morpheus.HeatMapColorScheme(new morpheus.Project(new morpheus.Dataset({name:"",rows:1,columns:1})),{type:"fixed",map:[{value:min,color:"white"},{value:(max+min)/2,color:"#feb24c"},{value:max,color:"#f03b20"}]});return this.vectorNameToColorScheme.set(vector.getName(),cs),cs},_getColorForValue:function(value){var color=morpheus.VectorColorModel.getStandardColor(value);if(null==color)for(var existingMetadataValueToColorMap=this.vectorNameToColorMap.values(),i=0,length=existingMetadataValueToColorMap.length;i<length;i++)if(void 0!==(color=existingMetadataValueToColorMap[i].get(value)))return color;return color},getContinuousMappedValue:function(vector,value){var cs=this.vectorNameToColorScheme.get(vector.getName());return void 0===cs&&(cs=this.createContinuousColorMap(vector)),cs.getColor(0,0,value)},getMappedValue:function(vector,value){var metadataValueToColorMap=this.vectorNameToColorMap.get(vector.getName());if(void 0===metadataValueToColorMap){metadataValueToColorMap=new morpheus.Map,this.vectorNameToColorMap.set(vector.getName(),metadataValueToColorMap);var values=morpheus.VectorUtil.getValues(vector),ncolors=0,colors=null;if((colors=values.length<3?colorbrewer.Dark2[3]:colorbrewer.Paired[values.length])||(colors=values.length<=20?d3.scale.category20().range():morpheus.VectorColorModel.CATEGORY_ALL),colors){ncolors=colors.length;for(var i=0,nvalues=values.length;i<nvalues;i++){var color;null==(color=this._getColorForValue(values[i]))&&(color=colors[i%ncolors]),metadataValueToColorMap.set(values[i],color)}}else{var _this=this;_.each(values,function(val){_this.getMappedValue(vector,val)})}}if(null==(color=metadataValueToColorMap.get(value))){if(null==(color=this._getColorForValue(value))){var index=metadataValueToColorMap.size();color=this.colors[index%this.colors.length]}metadataValueToColorMap.set(value,color)}return color},setMappedValue:function(vector,value,color){var metadataValueToColorMap=this.vectorNameToColorMap.get(vector.getName());void 0===metadataValueToColorMap&&(metadataValueToColorMap=new morpheus.Map,this.vectorNameToColorMap.set(vector.getName(),metadataValueToColorMap)),metadataValueToColorMap.set(value,color)}},morpheus.VectorFontModel=function(){this.vectorNameToMappedValue=new morpheus.Map,this.fonts=morpheus.VectorFontModel.FONTS},morpheus.VectorFontModel.FONTS=[{weight:400},{weight:700},{weight:900}],morpheus.VectorFontModel.prototype={toJSON:function(tracks){var _this=this,json={};return tracks.forEach(function(track){if(track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)&&track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)){var map=_this.vectorNameToMappedValue.get(track.getName());null!=map&&(json[track.getName()]=map)}}),json},fromJSON:function(json){for(var name in json){var obj=json[name];this.vectorNameToMappedValue.set(name,morpheus.Map.fromJSON(obj))}},clear:function(vector){this.vectorNameToMappedValue.remove(vector.getName())},copy:function(){var c=new morpheus.VectorFontModel;return c.fonts=this.fonts.slice(0),this.vectorNameToMappedValue.forEach(function(fontMap,name){var newFontMap=new morpheus.Map;newFontMap.setAll(fontMap),c.vectorNameToMappedValue.set(name,newFontMap)}),c},clearAll:function(){this.vectorNameToMappedValue=new morpheus.Map},_getFontForValue:function(value){if(null==value)return morpheus.VectorFontModel.FONTS[0];for(var existingMetadataValueToFontMap=this.vectorNameToMappedValue.values(),i=0,length=existingMetadataValueToFontMap.length;i<length;i++){var font=existingMetadataValueToFontMap[i].get(value);if(void 0!==font)return font}},getMap:function(name){return this.vectorNameToMappedValue.get(name)},getMappedValue:function(vector,value){var metadataValueToFontMap=this.vectorNameToMappedValue.get(vector.getName());if(void 0===metadataValueToFontMap){metadataValueToFontMap=new morpheus.Map,this.vectorNameToMappedValue.set(vector.getName(),metadataValueToFontMap);for(var values=morpheus.VectorUtil.getValues(vector),i=0,nvalues=values.length;i<nvalues;i++){var font;null==(font=this._getFontForValue(values[i]))&&(font=this.fonts[0]),metadataValueToFontMap.set(values[i],font)}}return null==(font=metadataValueToFontMap.get(value))&&(null==(font=this._getFontForValue(value))&&(font=this.fonts[0]),metadataValueToFontMap.set(value,font)),font},setMappedValue:function(vector,value,font){var metadataValueToFontMap=this.vectorNameToMappedValue.get(vector.getName());void 0===metadataValueToFontMap&&(metadataValueToFontMap=new morpheus.Map,this.vectorNameToMappedValue.set(vector.getName(),metadataValueToFontMap)),metadataValueToFontMap.set(value,font)}},morpheus.VectorKeys={},morpheus.VectorKeys.FIELDS="morpheus.fields",morpheus.VectorKeys.VALUE_TO_INDICES="morpheus.valueToIndices",morpheus.VectorKeys.VISIBLE_FIELDS="morpheus.visibleFields",morpheus.VectorKeys.DATA_TYPE="morpheus.dataType",morpheus.VectorKeys.ARRAY_SUMMARY_FUNCTION="morpheus.arraySummaryFunct",morpheus.VectorKeys.HEADER_SUMMARY="morpheus.headerSummary",morpheus.VectorKeys.SHOW_HEADER_SUMMARY="morpheus.showHeaderSummary",morpheus.VectorKeys.TITLE="morpheus.title",morpheus.VectorKeys.FUNCTION="morpheus.funct",morpheus.VectorKeys.SELECTION="morpheus.selection",morpheus.VectorKeys.RECOMPUTE_FUNCTION_NEW_HEAT_MAP="morpheus.recompute.funct.new.heat.map",morpheus.VectorKeys.RECOMPUTE_FUNCTION_SELECTION="morpheus.recompute.funct.selection",morpheus.VectorKeys.FORMATTER="morpheus.formatter",morpheus.VectorKeys.IS_INDEX="morpheus.isIndex",morpheus.VectorKeys.DISCRETE="morpheus.discrete",morpheus.VectorKeys.COPY_IGNORE=new morpheus.Set,morpheus.VectorKeys.COPY_IGNORE.add(morpheus.VectorKeys.HEADER_SUMMARY),morpheus.VectorKeys.COPY_IGNORE.add(morpheus.VectorKeys.DATA_TYPE),morpheus.VectorKeys.COPY_IGNORE.add(morpheus.VectorKeys.VALUE_TO_INDICES),morpheus.VectorKeys.JSON_WHITELIST=new morpheus.Set,morpheus.VectorKeys.JSON_WHITELIST.add(morpheus.VectorKeys.FIELDS),morpheus.VectorKeys.JSON_WHITELIST.add(morpheus.VectorKeys.FORMATTER),morpheus.VectorKeys.JSON_WHITELIST.add(morpheus.VectorKeys.DATA_TYPE),morpheus.VectorKeys.JSON_WHITELIST.add(morpheus.VectorKeys.TITLE),morpheus.VectorShapeModel=function(){this.shapes=morpheus.VectorShapeModel.SHAPES,this.vectorNameToMappedValue=new morpheus.Map},morpheus.VectorShapeModel.SHAPES=["circle","square","plus","x","asterisk","diamond","triangle-up","triangle-down","triangle-left","triangle-right","circle-minus"],morpheus.VectorShapeModel.FILLED_SHAPES=["circle","square","diamond","triangle-up","triangle-down","triangle-left","triangle-right"],morpheus.VectorShapeModel.prototype={toJSON:function(tracks){var _this=this,json={};return tracks.forEach(function(track){if(track.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)){var map=_this.vectorNameToMappedValue.get(track.getName());null!=map&&(json[track.getName()]=map)}}),json},fromJSON:function(json){for(var name in json){var obj=json[name];this.vectorNameToMappedValue.set(name,morpheus.Map.fromJSON(obj))}},clear:function(vector){this.vectorNameToMappedValue.remove(vector.getName())},copy:function(){var c=new morpheus.VectorShapeModel;return c.shapes=this.shapes.slice(0),this.vectorNameToMappedValue.forEach(function(shapeMap,name){var newShapeMap=new morpheus.Map;newShapeMap.setAll(shapeMap),c.vectorNameToMappedValue.set(name,newShapeMap)}),c},clearAll:function(){this.vectorNameToMappedValue=new morpheus.Map},_getShapeForValue:function(value){if(null==value)return"none";for(var existingMetadataValueToShapeMap=this.vectorNameToMappedValue.values(),i=0,length=existingMetadataValueToShapeMap.length;i<length;i++){var shape=existingMetadataValueToShapeMap[i].get(value);if(void 0!==shape)return shape}},getMap:function(name){return this.vectorNameToMappedValue.get(name)},getMappedValue:function(vector,value){var metadataValueToShapeMap=this.vectorNameToMappedValue.get(vector.getName());if(void 0===metadataValueToShapeMap){metadataValueToShapeMap=new morpheus.Map,this.vectorNameToMappedValue.set(vector.getName(),metadataValueToShapeMap);for(var values=morpheus.VectorUtil.getValues(vector),i=0,nvalues=values.length;i<nvalues;i++){var shape;null==(shape=this._getShapeForValue(values[i]))&&(shape=this.shapes[i%this.shapes.length]),metadataValueToShapeMap.set(values[i],shape)}}if(null==(shape=metadataValueToShapeMap.get(value))){if(null==(shape=this._getShapeForValue(value))){var index=metadataValueToShapeMap.size();shape=this.shapes[index%this.shapes.length]}metadataValueToShapeMap.set(value,shape)}return shape},setMappedValue:function(vector,value,shape){var metadataValueToShapeMap=this.vectorNameToMappedValue.get(vector.getName());void 0===metadataValueToShapeMap&&(metadataValueToShapeMap=new morpheus.Map,this.vectorNameToMappedValue.set(vector.getName(),metadataValueToShapeMap)),metadataValueToShapeMap.set(value,shape)}},morpheus.VectorUtil=function(){},morpheus.VectorUtil.jsonToFunction=function(vector,key){var f=vector.getProperties().get(key);if("object"==typeof f){var binSize=f.binSize,min=f.domain[0],max=f.domain[1],numberOfBins=Math.ceil((max-min)/binSize),percent=f.percent,cumulative=f.cumulative,histogramFunction=function(view,selectedDataset,columnIndex){for(var total=0,binNumberToOccurences=new Uint32Array(numberOfBins),i=0,nrows=selectedDataset.getRowCount();i<nrows;i++){var value=selectedDataset.getValue(i,columnIndex);if(!isNaN(value)){if(value>=min&&value<=max){var bin=Math.floor((value-min)/binSize);bin<0?bin=0:bin>=numberOfBins&&(bin=numberOfBins-1),binNumberToOccurences[bin]++}total++}}if(cumulative)for(i=numberOfBins-2;i>=0;i--)binNumberToOccurences[i]+=binNumberToOccurences[i+1];if(percent){var percents=new Float32Array(numberOfBins);for(i=0;i<numberOfBins;i++)percents[i]=binNumberToOccurences[i]/total*100;return percents}return binNumberToOccurences};vector.getProperties().set(key,histogramFunction);var jsonSpec=f;(f=histogramFunction).toJSON=function(){return jsonSpec}}return f},morpheus.VectorUtil.createValueToIndexMap=function(vector,splitArrayValues){for(var map=new morpheus.Map,isArray=splitArrayValues&&"["===morpheus.VectorUtil.getDataType(vector)[0],j=0,size=vector.size();j<size;j++){var val=vector.getValue(j);if(isArray){if(null!=val)for(var k=0;k<val.length;k++)map.set(val[k],j)}else map.set(val,j)}return map},morpheus.VectorUtil.createValueToIndicesMap=function(vector,splitArrayValues){if(!vector)throw"vector is null";for(var isArray=splitArrayValues&&"["===morpheus.VectorUtil.getDataType(vector)[0],map=new morpheus.Map,j=0,size=vector.size();j<size;j++){var val=vector.getValue(j);if(isArray){if(null!=val)for(var k=0;k<val.length;k++){var list;void 0===(list=map.get(val[k]))&&(list=[],map.set(val[k],list)),list.push(j)}}else void 0===(list=map.get(val))&&(list=[],map.set(val,list)),list.push(j)}return map},morpheus.VectorUtil.createValueToCountMap=function(vector){if(!vector)throw"vector is null";for(var map=new morpheus.Map,isArray="["===morpheus.VectorUtil.getDataType(vector)[0],j=0,size=vector.size();j<size;j++){var val=vector.getValue(j);if(null!=val)if(isArray)for(var k=0;k<val.length;k++){var count=map.get(val[k])||0;map.set(val[k],count+1)}else{count=map.get(val)||0;map.set(val,count+1)}}return map},morpheus.VectorUtil.createValuesToIndicesMap=function(vectors){var map=new morpheus.Map,nvectors=vectors.length;if(null==vectors[0])throw"no vectors found";for(var i=0,nitems=vectors[0].size();i<nitems;i++){for(var array=[],j=0;j<nvectors;j++){var val=vectors[j].getValue(i);array.push(val)}var key=new morpheus.Identifier(array),list=map.get(key);void 0===list&&(list=[],map.set(key,list)),list.push(i)}return map},morpheus.VectorUtil.createValuesToIndexMap=function(vectors){var map=new morpheus.Map,nvectors=vectors.length;if(null==vectors[0])throw"no vectors found";for(var i=0,nitems=vectors[0].size();i<nitems;i++){for(var array=[],j=0;j<nvectors;j++){var val=vectors[j].getValue(i);array.push(val)}var key=new morpheus.Identifier(array);map.set(key,i)}return map},morpheus.VectorUtil.createValuesToCountMap=function(vectors){var map=new morpheus.Map,nvectors=vectors.length;if(null==vectors[0])throw"no vectors found";for(var i=0,nitems=vectors[0].size();i<nitems;i++){for(var array=[],j=0;j<nvectors;j++){var val=vectors[j].getValue(i);array.push(val)}var key=new morpheus.Identifier(array),count=map.get(key)||0;map.set(key,count+1)}return map},morpheus.VectorUtil.getValues=function(vector,excludeNull){for(var set=new morpheus.Set,j=0,size=vector.size();j<size;j++){var val=vector.getValue(j);excludeNull&&null==val||set.add(val)}var array=set.values();return array.sort(morpheus.SortKey.ASCENDING_COMPARATOR),array},morpheus.VectorUtil.getSet=function(vector,splitArrayValues){for(var set=new morpheus.Set,isArray=splitArrayValues&&"["===morpheus.VectorUtil.getDataType(vector)[0],j=0,size=vector.size();j<size;j++){var value=vector.getValue(j);if(isArray){if(null!=value)for(var k=0,nvalues=value.length;k<nvalues;k++)set.add(value[k])}else set.add(value)}return set},morpheus.VectorUtil.maybeConvertToStringArray=function(vector,delim){for(var newValues=[],regex=new RegExp(delim),found=!1,i=0,nrows=vector.size();i<nrows;i++){var s=vector.getValue(i);if(null!=s){if(!s.split)return!1;var tokens=s.split(regex);newValues.push(tokens),!found&&tokens.length>1&&(found=!0)}}if(found){for(i=0,nrows=newValues.length;i<nrows;i++)vector.setValue(i,newValues[i]);vector.getProperties().set(morpheus.VectorKeys.DATA_TYPE,"[string]")}return found},morpheus.VectorUtil.maybeConvertStringToNumber=function(vector){for(var newValues=[],found=!1,i=0,nrows=vector.size();i<nrows;i++){var s=vector.getValue(i);if(null!=s&&""!==s&&"NA"!==s&&"NaN"!==s){if(!$.isNumeric(s))return!1;found=!0}newValues.push(parseFloat(s))}if(!found)return!1;for(i=0,nrows=newValues.length;i<nrows;i++)vector.setValue(i,newValues[i]);return vector.getProperties().set(morpheus.VectorKeys.DISCRETE,!1),vector.getProperties().set(morpheus.VectorKeys.DATA_TYPE,"number"),!0},morpheus.VectorUtil.containsMoreThanOneValue=function(vector){return morpheus.VectorUtil.containsMoreThanNValues(vector,1)},morpheus.VectorUtil.containsMoreThanNValues=function(vector,n){for(var s=new morpheus.Set,j=0,size=vector.size();j<size;j++){var val=vector.getValue(j);if(s.add(val),s.size()>n)return!0}return!1},morpheus.VectorUtil.createSpanMap=function(vector){for(var previous=vector.getValue(0),startIndexToEndIndex=new morpheus.Map,start=0,i=1,nrows=vector.size();i<nrows;i++){var val=vector.getValue(i);previous!==val&&(previous=val,startIndexToEndIndex.set(start,i),start=i)}return startIndexToEndIndex.set(start,vector.size()),startIndexToEndIndex},morpheus.VectorUtil.toArray=function(vector){for(var array=[],i=0,length=vector.size();i<length;i++){var val=vector.getValue(i);array.push(val)}return array},morpheus.VectorUtil.arrayAsVector=function(array,name){var v=new morpheus.Vector(name,array.length);return v.array=array,v},morpheus.VectorUtil.toString=function(vector){for(var array=[],i=0,length=vector.size();i<length;i++){var val=vector.getValue(i);array.push(val)}return array.join(", ")},morpheus.VectorUtil.getDataType=function(vector){var dataType=vector.getProperties().get(morpheus.VectorKeys.DATA_TYPE);if(void 0===dataType){var firstNonNull=morpheus.VectorUtil.getFirstNonNull(vector);dataType=morpheus.Util.getDataType(firstNonNull),vector.getProperties().set(morpheus.VectorKeys.DATA_TYPE,dataType)}return dataType},morpheus.VectorUtil.getMinMax=function(vector){var min=Number.MAX_VALUE,max=-Number.MAX_VALUE,fields=vector.getProperties().get(morpheus.VectorKeys.FIELDS),isArray="["===morpheus.VectorUtil.getDataType(vector)[0];if(null!=fields)for(var nvalues=fields.length,i=0,size=vector.size();i<size;i++){if(array=vector.getValue(i))for(var j=0;j<nvalues;j++){var value=array[j];isNaN(value)||(min=value<min?value:min,max=value>max?value:max)}}else if(isArray)for(i=0,size=vector.size();i<size;i++){var array;if(null!=(array=vector.getValue(i)))for(j=0,nvalues=array.length;j<nvalues;j++){value=array[j];isNaN(value)||(min=value<min?value:min,max=value>max?value:max)}}else for(i=0,size=vector.size();i<size;i++){value=vector.getValue(i);isNaN(value)||(min=value<min?value:min,max=value>max?value:max)}return{min:min,max:max}},morpheus.VectorUtil.getFirstNonNull=function(vector){for(var i=0,length=vector.size();i<length;i++){var val=vector.getValue(i);if(null!=val)return val}return null},morpheus.VectorUtil.isNumber=function(vector){return"number"===morpheus.VectorUtil.getDataType(vector)},morpheus.Vector=function(name,size){this.array=[],morpheus.AbstractVector.call(this,name,size)},morpheus.Vector.fromArray=function(name,array,length){var v=new morpheus.Vector(name,null==length?array.length:length);return v.array=array,v},morpheus.Vector.prototype={push:function(value){this.array.push(value)},setValue:function(index,value){this.array[index]=value},getValue:function(index){return this.array[index]},setName:function(name){this.name=name},setArray:function(array){return this.array=array,this}},morpheus.Util.extend(morpheus.Vector,morpheus.AbstractVector),morpheus.LandingPage=function(pageOptions){pageOptions=$.extend({},{el:$("#vis")},pageOptions),this.pageOptions=pageOptions;var _this=this,html=[];html.push('<div style="display:none;" class="container-fluid">'),html.push('<div style="min-height:78vh" class="row">'),html.push('<div class="col-xs-12 col-md-offset-1 col-md-7"><div data-name="input"></div>'),html.push('<div class="clearfix"></div>'),html.push("</div>"),html.push('<div data-name="desc" class="col-xs-12 col-md-3"><div style="margin-top: 16px;" data-name="heatmap"></div></div>'),html.push("</div>"),html.push('<div class="row"><div class="col-xs-12 morpheus-footer"></div></div>'),html.push("</div>");var $el=$(html.join("")),colorScale=morpheus.LandingPage.showHeatMap($el.find("[data-name=heatmap]")[0]);(new morpheus.HelpMenu).$el.appendTo($el.find(".morpheus-footer")),this.$el=$el;var $description=$el.find("[data-name=desc]");morpheus.Util.createMorpheusHeader(function(f){1===f?(d3.selectAll(".morpheus-heatmap-text").remove(),d3.selectAll(".morpheus-heatmap-elem").style("fill",function(d){return colorScale(d.value)})):(d3.selectAll(".morpheus-heatmap-text").style("opacity",function(d){return 1-f}),d3.selectAll(".morpheus-heatmap-elem").style("fill",function(d){return a="#FFFFFF",b=colorScale(d.value),amount=f,ah=parseInt(a.replace(/#/g,""),16),ar=ah>>16,ag=ah>>8&255,ab=255&ah,bh=parseInt(b.replace(/#/g,""),16),"#"+((1<<24)+(ar+amount*((bh>>16)-ar)<<16)+(ag+amount*((bh>>8&255)-ag)<<8)+(ab+amount*((255&bh)-ab))|0).toString(16).slice(1);var a,b,amount,ah,ar,ag,ab,bh}))}).appendTo($description),$('<p>Versatile matrix visualization and analysis software</p><p>View your dataset as a heat map, then explore the interactive tools in Morpheus. Cluster, create new annotations, search, filter, sort, display charts, and more.</p><p style="color:#586069;">30,000+ users <br />100,000+ matrices analyzed.</p><p style="font-size:12px;">If you use Morpheus for published work, please cite:<br />Morpheus, https://software.broadinstitute.org/morpheus</p>').appendTo($description);var $input=$el.find("[data-name=input]");$('<svg width="32px" height="32px"><g><rect x="0" y="0" width="32" height="14" style="fill:#ca0020;stroke:none"/><rect x="0" y="18" width="32" height="14" style="fill:#0571b0;stroke:none"/></g></svg><h2 style="padding-left: 4px; display:inline-block;">Open</h2>').appendTo($input),$('<div style="margin-bottom:20px;"><small>All data is processed on your computer and never sent to any server.</small></div>').appendTo($input),new morpheus.FilePicker({fileCallback:function(files){_this.openFile(files)},optionsCallback:function(opt){_this.open(opt)}}).$el.appendTo($input),pageOptions.tabManager?this.tabManager=pageOptions.tabManager:(this.tabManager=new morpheus.TabManager({landingPage:this}),this.tabManager.on("change rename add remove",function(e){var title=_this.tabManager.getTabText(_this.tabManager.getActiveTabId());null!=title&&""!==title||(title="Morpheus"),document.title=title}),this.tabManager.$nav.appendTo($(this.pageOptions.el)),this.tabManager.$tabContent.appendTo($(this.pageOptions.el)))},morpheus.LandingPage.showHeatMap=function(id){for(var matrix=[[1.34,1.88,.01,.93,-.09,1.13,-.66,-.4,-.91,-1.13,-.75],[1.13,1.84,.89,1.38,-.39,-.13,-.59,-.74,-.42,-.84,-1],[1.1,.29,.83,-.62,-.59,1.78,-1.11,1.24,-1.15,-.39,-.28],[1.04,1.97,-.02,1.46,-.35,.47,-.62,-.96,-.61,-.81,-.54],[-1.2,-.66,-.79,-.91,-.35,-.93,-.25,.75,1.81,1.48,-.15],[-1.41,-1.01,-.59,-.9,-.67,-.95,.44,.87,2.02,.67,.11],[-1.42,-.71,-.51,-1.02,-.8,-.92,-.07,.64,2.1,.76,.53],[-1.47,-1,-.88,-1.26,-.38,-1.02,1.05,.83,.64,1.31,.72]],colorScale=d3.scale.linear().range(["#ca0020","white","#0571b0"]).domain([-1.5,0,1.5]).clamp(!0),margin_top=0,margin_right=0,margin_bottom=0,margin_left=0,width=40*matrix.length-margin_left-margin_right,height=25*matrix[0].length-margin_top-margin_bottom,svg=d3.select(id).append("svg").attr("width",width+margin_left+margin_right).attr("height",height+margin_top+margin_bottom).append("g").attr("transform","translate("+margin_left+","+margin_top+")"),data=[],i=0;i<matrix.length;i++)for(var j=0;j<matrix[0].length;j++)data.push({x:i,y:j,value:matrix[i][j]});svg.selectAll(".morpheus-heatmap-elem").data(data).enter().append("rect").attr("x",function(d,index){return 40*d.x}).attr("y",function(d){return 25*d.y}).attr("class","morpheus-heatmap-elem").attr("width",40).attr("height",25).style("fill","white").style("stroke","#E6E6E6");svg.selectAll(".text").data(data).enter().append("text").text(function(d){return""+d.value}).attr("x",function(d){return 40*d.x+20}).attr("y",function(d){return 25*d.y+12.5+4}).style("text-anchor","middle").attr("class","morpheus-heatmap-text");return colorScale},morpheus.LandingPage.prototype={open:function(openOptions){this.dispose();for(var optionsArray=_.isArray(openOptions)?openOptions:[openOptions],i=0;i<optionsArray.length;i++){var options=optionsArray[i];options.tabManager=this.tabManager,options.focus=0===i,options.standalone=!0,options.landingPage=this,new morpheus.HeatMap(options)}},dispose:function(){this.$el.hide()},show:function(){var _this=this;this.$el.show(),morpheus.Util.isNode()||$(window).on("beforeunload.morpheus",function(){if(_this.tabManager.getTabCount()>0)return"Are you sure you want to close Morpheus?"})},openFile:function(files){if(3!==files.length){var _this=this,file=files[0],fileName=morpheus.Util.getFileName(file);if(fileName.toLowerCase().indexOf(".json")===fileName.length-5)morpheus.Util.getText(file).then(function(text){_this.open(JSON.parse(text))}).catch(function(err){morpheus.FormBuilder.showMessageModal({title:"Error",message:"Unable to load session"})});else{var options={dataset:{file:file,options:{interactive:!0}}};morpheus.OpenDatasetTool.fileExtensionPrompt(fileName,function(readOptions){if(readOptions)for(var key in readOptions)options.dataset.options[key]=readOptions[key];_this.open(options)})}}else{options={dataset:{file:files[0],options:{interactive:!0}}};var geneLines,barcodeLines,genesPromise=morpheus.Util.readLines(files[1]);genesPromise.then(function(lines){geneLines=lines});var barcodesPromise=morpheus.Util.readLines(files[2]);barcodesPromise.then(function(lines){barcodeLines=lines}),options.promises=[genesPromise,barcodesPromise],options.datasetReady=function(dataset){for(var columnIds=dataset.getColumnMetadata().add("id"),tab=/\t/,j=0,size=dataset.getColumnCount();j<size;j++)columnIds.setValue(j,barcodeLines[j].split(tab)[0]);var rowIds=dataset.getRowMetadata().add("id"),geneSymbols=dataset.getRowMetadata().add("symbol"),i=0;for(size=dataset.getRowCount();i<size;i++){var tokens=geneLines[i].split(tab);rowIds.setValue(i,tokens[0]),geneSymbols.setValue(i,tokens[1])}},this.open(options)}}},morpheus.SampleDatasets=function(options){var _this=this,$el=options.$el;this.callback=options.callback,$el.on("click","[name=tcgaLink]",function(e){e.preventDefault();var disease,$this=$(this),type=$this.data("disease-type"),obj={};$this.parents(".collapse").find("input:checked").each(function(i,c){obj[$(c).data("type")]=!0});for(var i=0;i<_this.diseases.length;i++)if(_this.diseases[i].type===type){disease=_this.diseases[i];break}obj.type=type,obj.name=disease.name,_this.openTcga(obj)}),$el.on("click","[data-toggle=dataTypeToggle]",function(e){var $this=$(this),$button=$this.parents(".collapse").find("button"),isDisabled=0===$this.parents(".collapse").find("input:checked").length;$button.prop("disabled",isDisabled)}),fetch("https://software.broadinstitute.org/morpheus/datasets/tcga/tcga_index.txt").then(function(response){if(response.ok)return response.text()}).then(function(text){var exampleHtml=[];exampleHtml.push('<h4>Visit <a target="_blank" href="https://depmap.org/portal/download/">Cancer Dependency Map</a> or <a target="_blank" href="https://www.cbioportal.org/datasets">cBioPortal</a> for additional datasets</h4>'),exampleHtml.push("<hr>"),exampleHtml.push('<div><h4>TCGA <a target="_blank" href="https://confluence.broadinstitute.org/display/GDAC/Dashboard-Stddata">(Broad GDAC 1/28/2016)</a></h4></div>'),exampleHtml.push('<div data-name="tcga"></div>'),$(exampleHtml.join("")).appendTo($el),options.show&&$el.css("display","");for(var lines=text.split("\n"),diseases=[],i=0;i<lines.length;i++){var line=lines[i];if(""!==line){var tokens=line.split("\t"),type=tokens[0],dataTypes=tokens[1].split(","),name=morpheus.TcgaUtil.DISEASE_STUDIES[type];((disease={mrna:-1!==dataTypes.indexOf("mRNAseq_RSEM_normalized_log2.txt"),sig_genes:-1!==dataTypes.indexOf("sig_genes.txt"),gistic:-1!==dataTypes.indexOf("all_lesions.conf_99.txt"),sample_info:-1!==dataTypes.indexOf("All_CDEs.txt"),mutation:-1!==dataTypes.indexOf("mutations_merged.maf.txt"),rppa:-1!==dataTypes.indexOf("rppa.txt"),methylation:-1!==dataTypes.indexOf("meth.by_mean.data.txt"),name:name,type:type,dataTypes:dataTypes}).mrna||disease.gistic||disease.sig_genes||disease.rppa||disease.methylation)&&diseases.push(disease)}}diseases.sort(function(a,b){return(a=a.name.toLowerCase())===(b=b.name.toLowerCase())?0:a<b?-1:1});var tcga=[];_this.diseases=diseases;for(i=0;i<diseases.length;i++){var id=_.uniqueId("morpheus"),disease=diseases[i];tcga.push("<div>"),tcga.push('<a data-toggle="collapse" href="#'+id+'" aria-expanded="false" aria-controls="'+id+'">'+disease.name+" ("+disease.type+")</a>"),tcga.push('<div class="collapse" id="'+id+'">');for(var j=0;j<morpheus.SampleDatasets.TCGA_DISEASE_TYPES_INFO.length;j++){var info=morpheus.SampleDatasets.TCGA_DISEASE_TYPES_INFO[j];j%2==0&&(j>0&&tcga.push("</div>"),tcga.push('<div style="margin: 6px 0 0 20px;display: inline-block;vertical-align:top;">')),tcga.push('<label><input type="checkbox" style="margin-left:4px;" data-toggle="dataTypeToggle" data-type="'+info.type+'"'+(disease[info.id]?"":" disabled")+"> "+info.name+"</label>")}tcga.push("</div>"),tcga.push('<div style="margin: 6px 0 0 20px;display: inline-block;vertical-align:top;">'),tcga.push('<button disabled type="button" class="btn btn-default" name="tcgaLink" data-disease-type="'+disease.type+'">Open</button>'),tcga.push("</div>"),tcga.push("</div>"),tcga.push("</div>")}$(tcga.join("")).appendTo($el.find("[data-name=tcga]"))}).catch(function(error){morpheus.FormBuilder.showInModal({title:"Error",html:"Unable to download data",appendTo:_this.getContentEl(),focus:_this.getFocusEl()}),console.log(error)})},morpheus.SampleDatasets.getTcgaDataset=function(options){var baseUrl="https://software.broadinstitute.org/morpheus/datasets/tcga/"+options.type+"/",datasetOptions={};return options.mrna&&(datasetOptions.mrna=baseUrl+"mRNAseq_RSEM_normalized_log2.txt"),options.methylation&&(datasetOptions.methylation=baseUrl+"meth.by_mean.data.txt"),options.sig_genes&&(datasetOptions.mutation=baseUrl+"mutations_merged.maf.txt",datasetOptions.sigGenes=baseUrl+"sig_genes.txt"),options.rppa&&(datasetOptions.rppa=baseUrl+"rppa.txt"),options.gistic&&(datasetOptions.gistic=baseUrl+"all_lesions.conf_99.txt"),options.gisticGene&&(datasetOptions.gisticGene=baseUrl+"all_data_by_genes.txt"),datasetOptions.mrnaClust=baseUrl+"bestclus.txt",datasetOptions.columnAnnotations=[{file:baseUrl+"All_CDEs.txt",datasetField:"participant_id",fileField:"patient_id",transposed:!1}],morpheus.TcgaUtil.getDataset(datasetOptions)},morpheus.SampleDatasets.getDepMapDataset=function(files){var datasets=[];return files.forEach(function(file){datasets.push("https://software.broadinstitute.org/morpheus/datasets/depmap/"+file)}),new Promise(function(resolve,reject){morpheus.DatasetUtil.readDatasetArray(datasets).then(function(dataset){for(var idVector=dataset.getColumnMetadata().get(0),siteVector=dataset.getColumnMetadata().add("site"),j=0,ncols=siteVector.size();j<ncols;j++){var id=idVector.getValue(j),index=id.indexOf("_");-1!==index&&siteVector.setValue(j,id.substring(index+1))}resolve(dataset)}).catch(function(err){reject(err)})})},morpheus.SampleDatasets.prototype={openTcga:function(options){this.callback({name:options.name,renderReady:function(heatMap){for(var whitelist=["age_at_initial_pathologic_diagnosis","breast_carcinoma_estrogen_receptor_status","breast_carcinoma_progesterone_receptor_status","lab_proc_her2_neu_immunohistochemistry_receptor_status","days_to_death","ethnicity","gender","histological_type","pathologic_stage"],columnMetadata=heatMap.getProject().getFullDataset().getColumnMetadata(),i=0;i<whitelist.length;i++)columnMetadata.getByName(whitelist[i])&&heatMap.addTrack(whitelist[i],!0,"color");options.sig_genes&&-1===heatMap.getTrackIndex("q_value",!1)&&heatMap.addTrack("q_value",!1,"text")},columns:[{field:"participant_id",display:"text"},{field:"sample_type",display:"color"},{field:"mutation_summary",display:"stacked_bar"},{field:"mutation_summary_selection",display:"stacked_bar"},{field:"mRNAseq_cluster",display:"color, highlight"}],dataset:morpheus.SampleDatasets.getTcgaDataset(options)})},openDepMap:function(files){this.callback({rows:[{field:"id",display:"text"},{field:"Description",display:"text, tooltip"},{field:"mutation_summary",display:"stacked_bar"},{field:"Source",display:"color"}],columns:[{field:"id",display:"text,tooltip"},{field:"mutation_summary",display:"stacked_bar"},{field:"site",display:"color, highlight"}],dataset:morpheus.SampleDatasets.getDepMapDataset(files),name:"depmap"})}},morpheus.SampleDatasets.TCGA_DISEASE_TYPES_INFO=[{id:"mrna",name:"GENE EXPRESSION",type:"mrna"},{id:"gistic",name:"GISTIC COPY NUMBER",type:"gistic"},{id:"sig_genes",name:"MUTATION",type:"sig_genes"},{id:"rppa",name:"PROTEOMICS",type:"rppa"},{id:"methylation",name:"METHYLATION",type:"methylation"}],morpheus.AdjustDataTool=function(){},morpheus.AdjustDataTool.log2=function(dataset){for(var i=0,nrows=dataset.getRowCount();i<nrows;i++)for(var j=0,ncols=dataset.getColumnCount();j<ncols;j++)dataset.setValue(i,j,morpheus.Log2(dataset.getValue(i,j)))},morpheus.AdjustDataTool.log2_plus=function(dataset){for(var i=0,nrows=dataset.getRowCount();i<nrows;i++)for(var j=0,ncols=dataset.getColumnCount();j<ncols;j++)dataset.setValue(i,j,morpheus.Log2(dataset.getValue(i,j)+1))},morpheus.AdjustDataTool.zScore=function(dataset){for(var rowView=new morpheus.DatasetRowView(dataset),i=0,nrows=dataset.getRowCount();i<nrows;i++){rowView.setIndex(i);for(var mean=morpheus.Mean(rowView),stdev=Math.sqrt(morpheus.Variance(rowView)),j=0,ncols=dataset.getColumnCount();j<ncols;j++)dataset.setValue(i,j,0===stdev?NaN:(dataset.getValue(i,j)-mean)/stdev)}},morpheus.AdjustDataTool.robustZScore=function(dataset){for(var rowView=new morpheus.DatasetRowView(dataset),i=0,nrows=dataset.getRowCount();i<nrows;i++){rowView.setIndex(i);for(var median=morpheus.Median(rowView),mad=morpheus.MAD(rowView,median),j=0,ncols=dataset.getColumnCount();j<ncols;j++)dataset.setValue(i,j,0===mad?NaN:(dataset.getValue(i,j)-median)/mad)}},morpheus.AdjustDataTool.prototype={toString:function(){return"Adjust"},init:function(project,form){form.$form.find("[name=scale_column_sum]").on("change",function(e){form.setVisible("column_sum",form.getValue("scale_column_sum"))}),form.setVisible("column_sum",!1)},gui:function(){return[{name:"scale_column_sum",type:"checkbox",help:"Whether to scale each column sum to a specified value"},{name:"column_sum",type:"text",style:"max-width:150px;"},{name:"log_2",type:"checkbox"},{name:"one_plus_log_2",type:"checkbox",help:"Take log2(1 + x)"},{name:"inverse_log_2",type:"checkbox"},{name:"quantile_normalize",type:"checkbox"},{name:"z-score",type:"checkbox",help:"Subtract mean, divide by standard deviation"},{name:"robust_z-score",type:"checkbox",help:"Subtract median, divide by median absolute deviation"},{name:"use_selected_rows_and_columns_only",type:"checkbox"}]},execute:function(options){var project=options.project;if(options.input.log_2||options.input.inverse_log_2||options.input["z-score"]||options.input["robust_z-score"]||options.input.quantile_normalize||options.input.scale_column_sum||options.input.one_plus_log_2){var sortedFilteredDataset=morpheus.DatasetUtil.copy(project.getSortedFilteredDataset()),rowIndices=project.getRowSelectionModel().getViewIndices().values().sort(function(a,b){return a===b?0:a<b?-1:1});0===rowIndices.length&&(rowIndices=null);var columnIndices=project.getColumnSelectionModel().getViewIndices().values().sort(function(a,b){return a===b?0:a<b?-1:1});0===columnIndices.length&&(columnIndices=null);var dataset=options.input.use_selected_rows_and_columns_only?new morpheus.Slice:sortedFilteredDataset;new morpheus.DatasetRowView(dataset);if(options.input.scale_column_sum){var scaleToValue=parseFloat(options.input.column_sum);if(!isNaN(scaleToValue))for(var j=0,ncols=dataset.getColumnCount();j<ncols;j++){for(var sum=0,i=0,nrows=dataset.getRowCount();i<nrows;i++){var value=dataset.getValue(i,j);isNaN(value)||(sum+=value)}var ratio=scaleToValue/sum;for(i=0,nrows=dataset.getRowCount();i<nrows;i++){value=dataset.getValue(i,j);dataset.setValue(i,j,value*ratio)}}}if(options.input.log_2&&morpheus.AdjustDataTool.log2(dataset),options.input.one_plus_log_2&&morpheus.AdjustDataTool.log2_plus(dataset),options.input.inverse_log_2)for(i=0,nrows=dataset.getRowCount();i<nrows;i++)for(j=0,ncols=dataset.getColumnCount();j<ncols;j++){(value=dataset.getValue(i,j))>=0&&dataset.setValue(i,j,Math.pow(2,value))}return options.input.quantile_normalize&&morpheus.QNorm.execute(dataset),options.input["z-score"]&&morpheus.AdjustDataTool.zScore(dataset),options.input["robust_z-score"]&&morpheus.AdjustDataTool.robustZScore(dataset),new morpheus.HeatMap({name:options.input.name||options.heatMap.getName(),dataset:dataset,parent:options.heatMap,symmetric:project.isSymmetric()&&dataset.getColumnCount()===dataset.getRowCount()})}}},morpheus.AnnotateDendrogramTool=function(isColumns){this._isColumns=isColumns},morpheus.AnnotateDendrogramTool.prototype={toString:function(){return"Annotate Dendrogram"},gui:function(){return[{name:"file",value:"",type:"file",required:!0,help:"an xlsx file or a tab-delimitted text file"}]},execute:function(options){var fileOrUrl=options.input.file,isColumns=this._isColumns,heatMap=options.heatMap,result=morpheus.Util.readLines(fileOrUrl),dendrogram=(morpheus.Util.getFileName(fileOrUrl),isColumns?heatMap.columnDendrogram:heatMap.rowDendrogram),nameToNode=new morpheus.Map;morpheus.DendrogramUtil.dfs(dendrogram.tree.rootNode,function(node){return nameToNode.set(node.name,node),!0});var tab=/\t/;result.then(function(lines){var header=lines[0].split(tab),promptTool={execute:function(options){for(var nodeIdField=options.input.node_id_field,nodeIdIndex=_.indexOf(header,nodeIdField),i=1;i<lines.length;i++){var array=lines[i].split(tab),nodeName=array[nodeIdIndex],node=nameToNode.get(nodeName);if(void 0!==node){0;for(var info=node.info||(node.info={}),j=0;j<array.length;j++)if(j!==nodeIdIndex){var vals=info[header[j]];void 0===vals&&(vals=[],info[header[j]]=vals),vals.push(array[j])}}}heatMap.trigger("dendrogramAnnotated",{isColumns:isColumns}),dendrogram.setInvalid(!0),dendrogram.repaint()},toString:function(){return"Select Node Id Field"},gui:function(){return[{name:"node_id_field",type:"select",options:_.map(header,function(item){return{name:item,value:item}}),required:!0}]}};morpheus.HeatMap.showTool(promptTool,heatMap)})}},morpheus.ChartTool=function(chartOptions){var _this=this;this.project=chartOptions.project,this.heatmap=chartOptions.heatmap;var project=this.project;this.$el=$('<div class="container-fluid"><div class="row"><div data-name="configPane" class="col-xs-2"></div><div class="col-xs-10"><div style="position:relative;" data-name="chartDiv"></div></div></div><div data-name="legend"></div></div>');var formBuilder=new morpheus.FormBuilder({formStyle:"vertical"});this.formBuilder=formBuilder,formBuilder.append({name:"chart_type",type:"bootstrap-select",options:["boxplot","embedding","row profile","column profile","row scatter matrix","column scatter matrix"]});var rowOptions=[],columnOptions=[],numericRowOptions=[],numericColumnOptions=[],options=[],numericOptions=[],updateOptions=function(){var dataset=project.getFullDataset();rowOptions=[{name:"(None)",value:""}],columnOptions=[{name:"(None)",value:""}],numericRowOptions=[{name:"(None)",value:""}],numericColumnOptions=[{name:"(None)",value:""}],options=[{name:"(None)",value:""}],numericOptions=[{name:"(None)",value:""}],morpheus.MetadataUtil.getMetadataNames(dataset.getRowMetadata()).forEach(function(name){var dataType=morpheus.VectorUtil.getDataType(dataset.getRowMetadata().getByName(name));"number"!==dataType&&"[number]"!==dataType||numericRowOptions.push({name:name+" (row)",value:name+"_r"}),rowOptions.push({name:name+" (row)",value:name+"_r"})}),morpheus.MetadataUtil.getMetadataNames(dataset.getColumnMetadata()).forEach(function(name){var dataType=morpheus.VectorUtil.getDataType(dataset.getColumnMetadata().getByName(name));"number"!==dataType&&"[number]"!==dataType||numericColumnOptions.push({name:name+" (column)",value:name+"_c"}),columnOptions.push({name:name+" (column)",value:name+"_c"})}),options=(options=options.concat(rowOptions.slice(1))).concat(columnOptions.slice(1)),numericOptions=(numericOptions=numericOptions.concat(numericRowOptions.slice(1))).concat(numericColumnOptions.slice(1))};updateOptions(),formBuilder.append({name:"group_by",type:"bootstrap-select",options:options,multiple:!0,search:!0}),formBuilder.append({name:"axis_label",type:"bootstrap-select",options:rowOptions}),formBuilder.append({name:"show_outliers",type:"checkbox",value:!0}),formBuilder.append({name:"color",type:"bootstrap-select",options:options,search:!0}),formBuilder.append({name:"tooltip",type:"bootstrap-select",multiple:!0,search:!0,options:options.slice(1)}),formBuilder.append({name:"x_axis",type:"bootstrap-select",multiple:!1,search:!0,options:numericColumnOptions}),formBuilder.append({name:"y_axis",type:"bootstrap-select",multiple:!1,search:!0,options:numericColumnOptions}),formBuilder.append({name:"transform_values",type:"bootstrap-select",multiple:!0,options:["log2","log2(1+x)","z-score","robust z-score"]});var combinedValues=morpheus.CollapseDatasetTool.Functions;combinedValues.splice(morpheus.CollapseDatasetTool.Functions.indexOf(morpheus.Percentile),1),formBuilder.append({name:"combine_values",type:"bootstrap-select",multiple:!1,options:combinedValues,value:morpheus.Max}),formBuilder.append({name:"symbol_size",type:"text",value:"2",style:"width:50px;"}),this.legend=new morpheus.AbstractCanvas(!1),$(this.legend.getCanvas()).css("position",""),this.legend.setBounds({width:300,height:30}),this.$legend=this.$el.find("[data-name=legend]"),this.$legend.hide(),$(this.legend.getCanvas()).appendTo(this.$legend);var $edit=$('<div><button class="btn btn-default">Edit</button></div>');$edit.appendTo(this.$legend),$edit.find("button").on("click",function(e){var colorSchemeChooser=new morpheus.ColorSchemeChooser({isColumns:!0,heatMap:_this.heatmap}),colorByInfo=morpheus.ChartTool.getVectorInfo(formBuilder.getValue("color"));colorSchemeChooser.setAnnotationName(colorByInfo.field),colorSchemeChooser.on("change",function(){draw()}),morpheus.FormBuilder.showInModal({title:"Edit Colors",html:colorSchemeChooser.$div,close:"Close",draggable:!0,onClose:function(){colorSchemeChooser.off("change")}})}),formBuilder.append({name:"chart_width",type:"range",value:400,min:60,max:800,step:10}),formBuilder.append({name:"chart_height",type:"range",value:400,min:20,max:800,step:10});var chartTypeToParameter={"row profile":{axis_label:"columns",tooltip:"columns",color:"rows"},embedding:{combine_values:!0,color:["Selected Rows","columns"],x_axis:"columns",y_axis:"columns",symbol_size:!0,transform_values:!0},"column profile":{axis_label:"rows",tooltip:"rows",color:"columns"},"row scatter matrix":{axis_label:"rows",color:"columns",tooltip:"columns"},"column scatter matrix":{axis_label:"columns",color:"rows",tooltip:"rows"},boxplot:{group_by:!0,show_outliers:!0,tooltip:"both"}};function setVisibility(){var chartType=formBuilder.getValue("chart_type"),chartOptions=chartTypeToParameter[chartType];null!=chartOptions.axis_label&&formBuilder.setOptions("axis_label","rows"===chartOptions.axis_label?rowOptions:columnOptions,!0),_this.$legend.css("display","embedding"===chartType&&null!=formBuilder.getValue("color")&&"Selected Rows"!==formBuilder.getValue("color")?"":"none"),formBuilder.setVisible("combine_values",chartOptions.combine_values&&"Selected Rows"===formBuilder.getValue("color")),formBuilder.setVisible("transform_values",chartOptions.transform_values&&"Selected Rows"===formBuilder.getValue("color")),formBuilder.setVisible("symbol_size",chartOptions.symbol_size),formBuilder.setVisible("x_axis",null!=chartOptions.x_axis),formBuilder.setVisible("y_axis",null!=chartOptions.y_axis),formBuilder.setVisible("color",null!=chartOptions.color),formBuilder.setVisible("axis_label",null!=chartOptions.axis_label),formBuilder.setVisible("group_by",chartOptions.group_by),formBuilder.setVisible("show_outliers",chartOptions.show_outliers),formBuilder.setVisible("tooltip",null!=chartOptions.tooltip),formBuilder.setOptions("tooltip","rows"===chartOptions.tooltip?rowOptions.slice(1):"columns"===chartOptions.tooltip?columnOptions.slice(1):options),formBuilder.setOptions("x_axis",numericColumnOptions),formBuilder.setOptions("y_axis",numericColumnOptions),null!=chartOptions.color&&("rows"===chartOptions.color?formBuilder.setOptions("color",rowOptions):"columns"===chartOptions.color?formBuilder.setOptions("color",columnOptions):_.isArray(chartOptions.color)&&formBuilder.setOptions("color",columnOptions.concat([chartOptions.color[0]])))}this.tooltip=[];var draw=function(){_.debounce(_this.draw(),100)};formBuilder.$form.on("change","select,input[type=range]",function(e){if("tooltip"===$(this).attr("name")){var tooltipVal=_this.formBuilder.getValue("tooltip");_this.tooltip.length=0,null!=tooltipVal&&tooltipVal.forEach(function(tip){_this.tooltip.push(morpheus.ChartTool.getVectorInfo(tip))})}else setVisibility(),draw()}),formBuilder.$form.on("click","input[type=checkbox]",function(e){draw()}),formBuilder.$form.on("keypress","input[type=text]",function(e){13===e.which&&draw()}),setVisibility();var trackChanged=function(){updateOptions(),setVisibility(),formBuilder.setOptions("group_by",options,!0)};project.getColumnSelectionModel().on("selectionChanged.chart",draw),project.getRowSelectionModel().on("selectionChanged.chart",draw),project.on("trackChanged.chart",trackChanged),this.$chart=this.$el.find("[data-name=chartDiv]");var $dialog=$('<div style="background:white;" title="Chart"></div>'),$configPane=this.$el.find("[data-name=configPane]");formBuilder.$form.appendTo($configPane),this.$el.appendTo($dialog),$dialog.dialog({dialogClass:"morpheus",close:function(event,ui){project.off("trackChanged.chart",trackChanged),project.getRowSelectionModel().off("selectionChanged.chart",draw),project.getColumnSelectionModel().off("selectionChanged.chart",draw),_this.$el.empty()},resizable:!0,height:600,width:900}),this.$dialog=$dialog,this.draw()},morpheus.ChartTool.getVectorInfo=function(value){return{field:value.substring(0,value.length-2),isColumns:"_c"===value.substring(value.length-2)}},morpheus.ChartTool.prototype={_createScatter:function(options){for(var _this=this,dataset=options.dataset,colorByVector=options.colorByVector,colorModel=options.colorModel,chartWidth=(this.heatmap,options.chartWidth),chartHeight=options.chartHeight,axisLabelVector=options.axisLabelVector,transpose=options.transpose,chart={animation:!1,toolbox:{feature:{brush:{title:{rect:"Rectangle selection",polygon:"Polygon selection",clear:"Clear Selection",keep:"Keep previous selection"}}}},brush:{brushLink:"all",xAxisIndex:[],yAxisIndex:[],inBrush:{opacity:1}},tooltip:{trigger:"item"},grid:[],xAxis:[],yAxis:[],series:[]},index=0,rowIndexOne=1,nrows=dataset.getRowCount();rowIndexOne<nrows;rowIndexOne++)for(var rowIndexTwo=0;rowIndexTwo<rowIndexOne;rowIndexTwo++)!function(){for(var data=[],color=[],j=0,ncols=dataset.getColumnCount();j<ncols;j++)data.push([dataset.getValue(rowIndexOne,j),dataset.getValue(rowIndexTwo,j),j]);if(colorByVector)for(j=0,ncols=dataset.getColumnCount();j<ncols;j++){var colorByValue=colorByVector.getValue(j);color.push(colorModel.getMappedValue(colorByVector,colorByValue))}chart.grid.push({left:20+(rowIndexOne-1)*(chartWidth+20),top:40+rowIndexTwo*(chartHeight+20),width:chartWidth,height:chartHeight}),chart.brush.xAxisIndex&&chart.brush.xAxisIndex.push(index),chart.brush.yAxisIndex&&chart.brush.yAxisIndex.push(index),chart.xAxis.push({splitNumber:3,position:"top",name:null!=axisLabelVector&&0===rowIndexTwo?axisLabelVector.getValue(rowIndexOne):"",nameGap:25,nameLocation:"middle",axisLine:{show:!1,onZero:!1},axisTick:{show:0===rowIndexTwo,inside:!0},axisLabel:{show:0===rowIndexTwo},type:"value",gridIndex:index,scale:!0}),chart.yAxis.push({splitNumber:3,nameGap:50,name:null!=axisLabelVector&&rowIndexOne===nrows-1?axisLabelVector.getValue(rowIndexTwo):"",nameLocation:"middle",position:"right",axisLine:{show:!1,onZero:!1},axisTick:{show:rowIndexOne===nrows-1,inside:!0},axisLabel:{show:rowIndexOne===nrows-1},type:"value",gridIndex:index,scale:!0}),chart.series.push({symbolSize:4,tooltip:{formatter:function(obj){var value=obj.value,s=[];return s.push("x: "+_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(value[0])),s.push("<br>"),s.push("y "+_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(value[1])),transpose?morpheus.ChartTool.getTooltip({text:s,tooltip:_this.tooltip,dataset:new morpheus.TransposedDatasetView(dataset),rowIndex:value[2],columnIndex:-1}):morpheus.ChartTool.getTooltip({text:s,tooltip:_this.tooltip,dataset:dataset,rowIndex:-1,columnIndex:value[2]}),s.join("")}},itemStyle:{normal:{color:function(param){return 0===color.length?"#1f78b4":color[param.dataIndex]}}},type:"scatter",xAxisIndex:index,yAxisIndex:index,data:data}),index++}();echarts.init(options.el).setOption(chart)},_createProfile:function(options){for(var _this=this,dataset=options.dataset,colorByVector=options.colorByVector,colorModel=options.colorModel,axisLabelVector=(this.heatmap,options.chartWidth,options.chartHeight,options.axisLabelVector),axisLabel=(options.transpose,[]),j=0,ncols=dataset.getColumnCount();j<ncols;j++)axisLabel.push(null!=axisLabelVector?axisLabelVector.getValue(j):""+j);for(var series=[],colorMap=morpheus.VectorColorModel.getColorMapForNumber(dataset.getRowCount()),i=0,nrows=dataset.getRowCount();i<nrows;i++){var colorByValue=null!=colorByVector?colorByVector.getValue(i):""+i,data=(null!=colorByVector?colorModel.getMappedValue(colorByVector,colorByValue):colorMap[i%colorMap.length],[]);for(j=0,ncols=dataset.getColumnCount();j<ncols;j++)data.push([j,dataset.getValue(i,j),i]);series.push({name:colorByValue,type:"line",data:data,tooltip:{formatter:function(obj){var value=obj.value,s=[];return s.push(_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(value[1])),morpheus.ChartTool.getTooltip({text:s,tooltip:_this.tooltip,dataset:dataset,rowIndex:value[2],columnIndex:value[0]}),s.join("")}}})}var chart={legend:{orient:"vertical",left:"right",top:2,itemWidth:14,height:20*dataset.getRowCount(),data:series.map(function(s){return s.name})},animation:!1,tooltip:{trigger:"item"},xAxis:{type:"category",data:axisLabel},yAxis:{axisLine:{show:!0,onZero:!1},type:"value",name:""},grid:{right:120},series:series};echarts.init(options.el).setOption(chart)},_createEmbedding:function(options){var _this=this,fullDataset=options.fullDataset,selectedDataset=options.dataset,transpose=options.transpose,xVector=options.xVector,yVector=options.yVector,collapseFunction=options.collapseFunction,symbolSize=options.symbolSize,dataTransformations=options.dataTransformations;if(null!=xVector&&null!=yVector){var collapsed,colorByVector=options.colorByVector,colorModel=options.colorModel,visualMap=(this.heatmap,options.chartWidth,options.chartHeight,void 0);if(null!=selectedDataset){collapsed=new Float32Array(selectedDataset.getColumnCount()),dataTransformations.length>0&&(selectedDataset=morpheus.DatasetUtil.copy(selectedDataset),dataTransformations.forEach(function(f){f(selectedDataset)}));for(var view=new morpheus.DatasetColumnView(selectedDataset),j=0,ncols=selectedDataset.getColumnCount();j<ncols;j++)collapsed[j]=collapseFunction(view.setIndex(j));var v=morpheus.Vector.fromArray("",collapsed),stats=morpheus.VectorUtil.getMinMax(v);visualMap={type:"continuous",min:stats.min,max:stats.max,dimension:3,orient:"horizontal",left:0,top:"bottom",text:["",""],calculable:!0,inRange:{color:["#ffeda0","#feb24c","#f03b20"]},outOfRange:{color:["rgb(217,217,217)"],opacity:.5}}}var data=[],colors=[],isContinuous=!1;null!=colorByVector&&(isContinuous=!colorByVector.getProperties().get(morpheus.VectorKeys.DISCRETE));j=0;for(var size=xVector.size();j<size;j++)null!=selectedDataset?data.push([xVector.getValue(j),yVector.getValue(j),j,collapsed[j]]):null!=colorByVector?(isContinuous?colors.push(colorModel.getContinuousMappedValue(colorByVector,colorByVector.getValue(j))):colors.push(colorModel.getMappedValue(colorByVector,colorByVector.getValue(j))),data.push([xVector.getValue(j),yVector.getValue(j),j])):data.push([xVector.getValue(j),yVector.getValue(j),j]);var chart={animation:!1,tooltip:{trigger:"item"},xAxis:[{axisTick:{show:!1},axisLabel:{show:!1},axisLine:{show:!0,onZero:!1},splitLine:{show:!1},boundaryGap:!1,type:"value",name:""}],visualMap:visualMap,yAxis:[{axisTick:{show:!1},axisLabel:{show:!1},axisLine:{show:!0,onZero:!1},splitLine:{show:!1},boundaryGap:!1,type:"value",name:""}],series:[{type:"scatterGL",data:data,large:!1,symbolSize:symbolSize,tooltip:{formatter:function(obj){var value=obj.value,s=[];return transpose?morpheus.ChartTool.getTooltip({text:s,tooltip:_this.tooltip,dataset:new morpheus.TransposedDatasetView(fullDataset),rowIndex:value[2],columnIndex:-1}):morpheus.ChartTool.getTooltip({text:s,tooltip:_this.tooltip,dataset:fullDataset,rowIndex:-1,columnIndex:value[2]}),s.join("")}},itemStyle:{color:function(param){return 0===colors.length?"#1f78b4":colors[param.dataIndex]}}}]};echarts.init(options.el).setOption(chart)}},_createBoxPlot:function(options){for(var _this=this,datasets=options.datasets,ids=options.ids,boxData=(this.heatmap,[]),outliers=[],k=0,ndatasets=datasets.length;k<ndatasets;k++){for(var dataset=datasets[k],id=ids[k],values=new Float32Array(dataset.getRowCount()*dataset.getColumnCount()),counter=0,i=0,nrows=dataset.getRowCount();i<nrows;i++)for(var j=0,ncols=dataset.getColumnCount();j<ncols;j++){var value=dataset.getValue(i,j);isNaN(value)||(values[counter]=value,counter++)}counter!==values.length&&(values=values.slice(0,counter)),values.sort();var item=morpheus.BoxPlotArrayItem(values);if(boxData.push([item.lowerAdjacentValue,item.q1,item.median,item.q3,item.upperAdjacentValue]),options.showOutliers){var upperOutlier=item.q3+1.5*(item.q3-item.q1),lowerOutlier=item.q1-1.5*(item.q3-item.q1);for(i=0,nrows=dataset.getRowCount();i<nrows;i++)for(j=0,ncols=dataset.getColumnCount();j<ncols;j++){((value=dataset.getValue(i,j))>upperOutlier||value<lowerOutlier)&&outliers.push([id,value,i,j])}}}var chart={animation:!1,tooltip:{trigger:"item"},xAxis:{type:"category",data:ids},yAxis:{axisLine:{show:!0,onZero:!1},type:"value",name:""},series:[{animationDuration:0,hoverAnimation:!1,name:"boxplot",type:"boxplot",data:boxData,tooltip:{formatter:function(param){var text=[];return""!==param.name&&text.push(param.name),(text=text.concat(["upper: "+_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(param.data[4]),"Q3: "+_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(param.data[3]),"median: "+_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(param.data[2]),"Q1: "+_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(param.data[1]),"lower: "+_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(param.data[0])])).join("<br/>")}}},{name:"outlier",type:"scatter",data:outliers,symbolSize:5,itemStyle:{normal:{borderWidth:1,borderColor:"black",opacity:.8}},tooltip:{formatter:function(obj){var value=obj.value,s=[];return""!==value[0]&&(s.push(value[0]),s.push("<br>")),s.push(_this.heatmap.getHeatMapElementComponent().getDrawValuesFormat()(value[1])),morpheus.ChartTool.getTooltip({text:s,tooltip:_this.tooltip,dataset:dataset,rowIndex:value[2],columnIndex:value[3]}),s.join("")}}}]};echarts.init(options.el).setOption(chart)},draw:function(){this.$chart.empty();var gridWidth=parseInt(this.formBuilder.getValue("chart_width")),gridHeight=parseInt(this.formBuilder.getValue("chart_height")),showOutliers=this.formBuilder.getValue("show_outliers"),groupBy=this.formBuilder.getValue("group_by"),axisLabel=this.formBuilder.getValue("axis_label"),chartType=this.formBuilder.getValue("chart_type"),dataset="embedding"!==chartType?this.project.getSelectedDataset({emptyToAll:!1}):this.project.getFullDataset();if(this.dataset=dataset,"embedding"!==chartType){if(0===dataset.getRowCount()&&0===dataset.getColumnCount())return void $("<h4>Please select rows and columns in the heat map.</h4>").appendTo(this.$chart);if(0===dataset.getRowCount())return void $("<h4>Please select rows in the heat map.</h4>").appendTo(this.$chart);if(0===dataset.getColumnCount())return void $("<h4>Please select columns in the heat map.</h4>").appendTo(this.$chart)}this.heatmap;var axisLabelInfo=morpheus.ChartTool.getVectorInfo(axisLabel),axisLabelVector=axisLabelInfo.isColumns?dataset.getColumnMetadata().getByName(axisLabelInfo.field):dataset.getRowMetadata().getByName(axisLabelInfo.field),colorBy=this.formBuilder.getValue("color"),colorByVector=null,colorModel=null;if(null!=colorBy&&"Selected Rows"!==colorBy){var colorByInfo=morpheus.ChartTool.getVectorInfo(colorBy);if(colorModel=colorByInfo.isColumns?this.project.getColumnColorModel():this.project.getRowColorModel(),null==(colorByVector=colorByInfo.isColumns?dataset.getColumnMetadata().getByName(colorByInfo.field):dataset.getRowMetadata().getByName(colorByInfo.field))||"embedding"!==chartType||colorByVector.getProperties().get(morpheus.VectorKeys.DISCRETE))this.$legend.hide();else{var legendContext=this.legend.getCanvas().getContext("2d"),scheme=this.heatmap.getProject().getColumnColorModel().getContinuousColorScheme(colorByVector);null==scheme&&(scheme=this.heatmap.getProject().getColumnColorModel().createContinuousColorMap(colorByVector)),morpheus.CanvasUtil.resetTransform(legendContext),legendContext.clearRect(0,0,this.legend.getUnscaledWidth(),this.legend.getUnscaledWidth()),legendContext.translate(15,0),morpheus.HeatMapColorSchemeLegend.drawColorScheme(legendContext,scheme,200),this.$legend.show()}}if("embedding"===chartType){var xaxisInfo=morpheus.ChartTool.getVectorInfo(this.formBuilder.getValue("x_axis")),xVector=xaxisInfo.isColumns?dataset.getColumnMetadata().getByName(xaxisInfo.field):dataset.getRowMetadata().getByName(xaxisInfo.field),yaxisInfo=morpheus.ChartTool.getVectorInfo(this.formBuilder.getValue("y_axis")),yVector=yaxisInfo.isColumns?dataset.getColumnMetadata().getByName(yaxisInfo.field):dataset.getRowMetadata().getByName(yaxisInfo.field),transformValues=this.formBuilder.getValue("transform_values");null==transformValues&&(transformValues=[]);var dataTransformations=[];-1!==transformValues.indexOf("log2")&&dataTransformations.push(morpheus.AdjustDataTool.log2),-1!==transformValues.indexOf("log2(1+x)")&&dataTransformations.push(morpheus.AdjustDataTool.log2_plus),-1!==transformValues.indexOf("z-score")&&dataTransformations.push(morpheus.AdjustDataTool.zScore),-1!==transformValues.indexOf("robust z-score")&&dataTransformations.push(morpheus.AdjustDataTool.robustZScore),($chart=$('<div style="width: '+gridWidth+"px;height:"+(gridHeight+120)+'px;"></div>')).appendTo(this.$chart),this._createEmbedding({xVector:xVector,yVector:yVector,width:gridWidth,collapseFunction:morpheus.CollapseDatasetTool.Functions.fromString(this.formBuilder.getValue("combine_values")),dataTransformations:dataTransformations,symbolSize:parseFloat(this.formBuilder.getValue("symbol_size")),el:$chart[0],fullDataset:dataset,dataset:"Selected Rows"===colorBy?this.project.getSelectedDataset({emptyToAll:!1,selectedColumns:!1}):null,chartWidth:gridWidth,chartHeight:gridHeight,transpose:!1,colorModel:colorModel,colorByVector:colorByVector})}else if("row profile"===chartType||"column profile"===chartType){if((transpose="column profile"===chartType)&&(dataset=new morpheus.TransposedDatasetView(dataset)),dataset.getRowCount()>100)return void $("<h4>Maximum chart size exceeded.</h4>").appendTo(this.$chart);($chart=$('<div style="width: '+(gridWidth+120)+"px;height:"+gridHeight+'px;"></div>')).appendTo(this.$chart),this._createProfile({width:gridWidth,el:$chart[0],dataset:dataset,chartWidth:gridWidth,chartHeight:gridHeight,transpose:transpose,colorModel:colorModel,colorByVector:colorByVector,axisLabelVector:axisLabelVector})}else if("row scatter matrix"===chartType||"column scatter matrix"===chartType){var transpose,$chart;if((transpose="column scatter matrix"===chartType)&&(dataset=new morpheus.TransposedDatasetView(dataset)),dataset.getRowCount()>20)return void $("<h4>Maximum chart size exceeded.</h4>").appendTo(this.$chart);($chart=$('<div style="width:'+(80+(dataset.getRowCount()-1)*(gridWidth+20))+"px;height:"+(80+dataset.getRowCount()*(gridHeight+20))+'px;"></div>')).appendTo(this.$chart),this._createScatter({el:$chart[0],dataset:dataset,chartWidth:gridWidth,chartHeight:gridHeight,transpose:transpose,colorModel:colorModel,colorByVector:colorByVector,axisLabelVector:axisLabelVector})}else if("boxplot"===chartType){var datasets=[],ids=[];if(groupBy&&groupBy.length>0){var columnValueToIndices,rowValueToIndices,columnVectors=[],rowVectors=[];groupBy.forEach(function(name){var vector,groupByInfo=morpheus.ChartTool.getVectorInfo(name);groupByInfo.isColumns?null!=(vector=dataset.getColumnMetadata().getByName(groupByInfo.field))?columnVectors.push(vector):console.log(vector.getName()+" not found"):null!=(vector=dataset.getRowMetadata().getByName(groupByInfo.field))?rowVectors.push(vector):console.log(vector.getName()+" not found")}),0===columnVectors.length?(columnValueToIndices=new morpheus.Map).set("",null):columnValueToIndices=morpheus.VectorUtil.createValuesToIndicesMap(columnVectors),0===rowVectors.length?(rowValueToIndices=new morpheus.Map).set("",null):(console.log(rowVectors),rowValueToIndices=morpheus.VectorUtil.createValuesToIndicesMap(rowVectors)),columnValueToIndices.forEach(function(columnIndices,columnValue){rowValueToIndices.forEach(function(rowIndices,rowValue){datasets.push(new morpheus.SlicedDatasetView(dataset,rowIndices,columnIndices));var id=columnValue;""!==id&&(id+=" "),id+=rowValue,ids.push(id)})})}else datasets.push(dataset),ids.push("");var $chartEl=$('<div style="width: '+gridWidth+"px;height:"+gridHeight+'px;"></div>');$chartEl.appendTo(this.$chart),this._createBoxPlot({showOutliers:showOutliers,el:$chartEl[0],datasets:datasets,ids:ids})}}},morpheus.ChartTool.getTooltip=function(options){for(var tipIndex=0;tipIndex<options.tooltip.length;tipIndex++){var metadata,index,tip=options.tooltip[tipIndex];if(tip.isColumns?(metadata=options.dataset.getColumnMetadata(),index=options.columnIndex):(metadata=options.dataset.getRowMetadata(),index=options.rowIndex),-1!==index){var v=metadata.getByName(tip.field);morpheus.HeatMapTooltipProvider.vectorToString(v,index,options.text,"<br>")}}},morpheus.CollapseDatasetTool=function(){},morpheus.CollapseDatasetTool.Functions=[morpheus.Mean,morpheus.Median,new morpheus.MaxPercentiles([25,75]),morpheus.Min,morpheus.Max,morpheus.Percentile,morpheus.Sum],morpheus.CollapseDatasetTool.Functions.fromString=function(s){for(var i=0;i<morpheus.CollapseDatasetTool.Functions.length;i++)if(morpheus.CollapseDatasetTool.Functions[i].toString()===s)return morpheus.CollapseDatasetTool.Functions[i];throw new Error(s+" not found")},morpheus.CollapseDatasetTool.prototype={toString:function(){return"Collapse"},init:function(project,form){var setValue=function(val){var isRows="Rows"===val,names=morpheus.MetadataUtil.getMetadataNames(isRows?project.getFullDataset().getRowMetadata():project.getFullDataset().getColumnMetadata());form.setOptions("collapse_to_fields",names)};form.$form.find("[name=collapse]").on("change",function(e){setValue($(this).val())}),form.setVisible("percentile",!1),form.$form.find("[name=collapse_method]").on("change",function(e){form.setVisible("percentile",$(this).val()===morpheus.Percentile.toString())}),setValue("Rows"),form.setVisible("percentile",!1),form.$form.find("[name=collapse_method]").on("change",function(e){form.setVisible("percentile",$(this).val()===morpheus.Percentile.toString())}),form.$form.find("[name=compute_percent]").on("change",function(e){form.setVisible("pass_expression",form.getValue("compute_percent")),form.setVisible("pass_value",form.getValue("compute_percent"))}),form.setVisible("pass_expression",!1),form.setVisible("pass_value",!1)},gui:function(project){return[{name:"collapse_method",options:morpheus.CollapseDatasetTool.Functions,value:morpheus.CollapseDatasetTool.Functions[1].toString(),type:"select"},{name:"percentile",value:75,type:"text"},{name:"collapse",options:["Columns","Rows"],value:"Rows",type:"radio"},{name:"collapse_to_fields",options:[],type:"select",multiple:!0},{name:"compute_percent",type:"checkbox",help:"Whether to calculate the percentage of items in a collapsed group that passed an expression"},{name:"pass_expression",options:[">=",">","<","<="],type:"bootstrap-select"},{name:"pass_value",type:"text",help:'The corresponding value for "percent operator"'}]},execute:function(options){var project=options.project,collapseToFunction=morpheus.CollapseDatasetTool.Functions.fromString(options.input.collapse_method);if(collapseToFunction.toString()===morpheus.Percentile.toString()){var p=parseFloat(options.input.percentile);collapseToFunction=function(vector){return morpheus.Percentile(vector,p)}}var collapseToFields=options.input.collapse_to_fields;if(0===collapseToFields.length)throw new Error("Please select one or more fields to collapse to");var dataset=project.getFullDataset(),rows="Rows"==options.input.collapse;rows||(dataset=new morpheus.TransposedDatasetView(dataset));var filterFunction=null;if(options.input.compute_percent){var filterValue=parseFloat(options.input.pass_value);if(!isNaN(filterValue)){var op=options.input.pass_expression;">="===op?filterFunction=function(value){return value>=filterValue}:">"===op?filterFunction=function(value){return value>filterValue}:"<="===op?filterFunction=function(value){return value<=filterValue}:"<"===op&&(filterFunction=function(value){return value<filterValue})}}return dataset=morpheus.CollapseDataset(dataset,collapseToFields,collapseToFunction,!0,filterFunction),rows||(dataset=new morpheus.TransposedDatasetView(dataset)),new morpheus.HeatMap({name:options.input.name||options.heatMap.getName(),dataset:dataset,parent:options.heatMap,symmetric:!1,shape:null!=filterFunction?"circle":null,sizeBy:null!=filterFunction?{seriesName:"percent",min:0,max:75}:null})}},morpheus.CreateAnnotation=function(){},morpheus.CreateAnnotation.prototype={toString:function(){return"Create Calculated Annotation"},gui:function(){return[{name:"annotate",options:["Columns","Rows"],value:"Rows",type:"radio"},{name:"annotation_name",value:"",type:"text",required:!0,autocomplete:"off"},{name:"formula",value:"",type:"textarea",placeholder:"e.g MAD()",required:!0,help:"JavaScript formula. Built-in functions (case-sensitive): COUNTIF(expression), MAD(), MAX(), MEAN(), MEDIAN(), MIN(), PERCENTILE(p), SUM(), VARIANCE(). Refer to a field using FIELD(name)"},{name:"use_selected_rows_and_columns_only",type:"checkbox"}]},execute:function(options){var __project=options.project,isColumns="Columns"==options.input.annotate,__formula=options.input.formula,__dataset=options.input.use_selected_rows_and_columns_only?__project.getSelectedDataset():__project.getSortedFilteredDataset();isColumns&&(__dataset=new morpheus.TransposedDatasetView(__dataset));for(var __rowView=new morpheus.DatasetRowView(__dataset),__vector=__dataset.getRowMetadata().add(options.input.annotation_name),COUNTIF=function(val){return morpheus.CountIf(__rowView,val)},MAD=function(){return morpheus.MAD(__rowView)},MAX=function(){return morpheus.Max(__rowView)},MEAN=function(){return morpheus.Mean(__rowView)},MEDIAN=function(p){return morpheus.Percentile(__rowView,50)},MIN=function(){return morpheus.Min(__rowView)},PERCENTILE=function(p){return morpheus.Percentile(__rowView,p)},SUM=function(){return morpheus.Sum(__rowView)},VARIANCE=function(){return morpheus.Variance(__rowView)},__index=0,FIELD=function(field){var vector=__dataset.getRowMetadata().getByName(field);return vector?vector.getValue(__index):void 0},size=__dataset.getRowCount();__index<size;__index++){__rowView.setIndex(__index);var __val=eval(__formula);"function"==typeof __val&&(__val=""),__vector.setValue(__index,__val)}morpheus.VectorUtil.maybeConvertStringToNumber(__vector),__project.trigger("trackChanged",{vectors:[__vector],display:["text"],columns:isColumns})}},morpheus.DendrogramEnrichmentTool=function(isColumns){this.isColumns=isColumns},morpheus.DendrogramEnrichmentTool.prototype={toString:function(){return"Dendrogram Enrichment"},gui:function(project){var dataset=project.getSortedFilteredDataset();return[{name:"field",options:morpheus.MetadataUtil.getMetadataNames(this.isColumns?dataset.getColumnMetadata():dataset.getRowMetadata()),type:"bootstrap-select",multiple:!1},{name:"min_p-value_for_enrichment",type:"text",value:"0.05"},{name:"minimum_number_of_total_members_in_group",type:"text",value:"5"},{name:"minimum_number_of_members_in_group",type:"text",value:"3"}]},execute:function(options){var project=options.project,heatMap=options.heatMap,pValue=options.input["min_p-value_for_enrichment"],minTotalGroupSize=options.input.minimum_number_of_total_members_in_group,minGroupSize=options.input.minimum_number_of_members_in_group,dataset=project.getSortedFilteredDataset(),dendrogram=this.isColumns?heatMap.columnDendrogram:heatMap.rowDendrogram,vector=this.isColumns?dataset.getColumnMetadata().getByName(options.input.field):dataset.getRowMetadata().getByName(options.input.field),valueToIndices=morpheus.VectorUtil.createValueToIndicesMap(vector),valueToGlobalCount=new morpheus.Map,values=[];valueToIndices.forEach(function(indices,value){valueToGlobalCount.set(value,indices.length),values.push(value)});var nvalues=values.length,N=vector.size();morpheus.DendrogramUtil.dfs(dendrogram.tree.rootNode,function(node){delete node.info;for(var valueToCount=new morpheus.Map,i=0;i<nvalues;i++)valueToCount.set(values[i],0);var min=node.minIndex,max=node.maxIndex,n=max-min+1;if(n>1&&n>=minTotalGroupSize){for(i=min;i<=max;i++){var value=vector.getValue(i);valueToCount.set(value,valueToCount.get(value)+1)}for(i=0;i<nvalues;i++){var K=valueToGlobalCount.get(values[i]),k=valueToCount.get(values[i]);if(k>=minGroupSize){var a=k,b=K-k,c=n-k,d=N+k-n-K,p=morpheus.FisherExact.fisherTest(a,b,c,d);p<=pValue&&(node.info||(node.info={}),node.info[values[i]]=p)}}}return!0}),dendrogram.setInvalid(!0),dendrogram.repaint()}},morpheus.DevAPI=function(){},morpheus.DevAPI.prototype={toString:function(){return"API"},gui:function(){return[{name:"code",value:"",type:"textarea",required:!0,help:"Enter your code"}]},execute:function(options){var heatMap=options.heatMap,code=options.input.code;eval(code),heatMap.getProject().setFullDataset(heatMap.getProject().getFullDataset(),!0)}},morpheus.HClusterTool=function(){},morpheus.HClusterTool.PRECOMPUTED_DIST="Matrix values (for a precomputed distance matrix)",morpheus.HClusterTool.PRECOMPUTED_SIM="Matrix values (for a precomputed similarity matrix)",morpheus.HClusterTool.Functions=[morpheus.Euclidean,morpheus.Jaccard,new morpheus.OneMinusFunction(morpheus.Cosine),new morpheus.OneMinusFunction(morpheus.KendallsCorrelation),new morpheus.OneMinusFunction(morpheus.Pearson),new morpheus.OneMinusFunction(morpheus.Spearman),morpheus.HClusterTool.PRECOMPUTED_DIST,morpheus.HClusterTool.PRECOMPUTED_SIM],morpheus.HClusterTool.Functions.fromString=function(s){for(var i=0;i<morpheus.HClusterTool.Functions.length;i++)if(morpheus.HClusterTool.Functions[i].toString()===s)return morpheus.HClusterTool.Functions[i];throw new Error(s+" not found")},morpheus.HClusterTool.createLinkageMethod=function(linkageString){var linkageMethod;if("Average"===linkageString)linkageMethod=morpheus.AverageLinkage;else if("Complete"===linkageString)linkageMethod=morpheus.CompleteLinkage;else{if("Single"!==linkageString)throw new Error("Unknown linkage method "+linkageString);linkageMethod=morpheus.SingleLinkage}return linkageMethod},morpheus.HClusterTool.execute=function(dataset,input){var linkageMethod=morpheus.HClusterTool.createLinkageMethod(input.linkage_method),f=morpheus.HClusterTool.Functions.fromString(input.metric);f===morpheus.HClusterTool.PRECOMPUTED_DIST?f=0:f===morpheus.HClusterTool.PRECOMPUTED_SIM&&(f=1);var rowsHcl,columnsHcl,rows="Rows"==input.cluster||"Rows and columns"==input.cluster,columns="Columns"==input.cluster||"Rows and columns"==input.cluster,doCluster=function(d,groupByFields){return groupByFields&&groupByFields.length>0?new morpheus.HClusterGroupBy(d,groupByFields,f,linkageMethod):new morpheus.HCluster(morpheus.HCluster.computeDistanceMatrix(d,f),linkageMethod)};return rows&&(rowsHcl=doCluster(input.selectedColumnsToUseForClusteringRows?new morpheus.SlicedDatasetView(dataset,null,input.selectedColumnsToUseForClusteringRows):dataset,input.group_rows_by)),columns&&(columnsHcl=doCluster(new morpheus.TransposedDatasetView(input.selectedRowsToUseForClusteringColumns?new morpheus.SlicedDatasetView(dataset,input.selectedRowsToUseForClusteringColumns,null):dataset),input.group_columns_by)),{rowsHcl:rowsHcl,columnsHcl:columnsHcl}},morpheus.HClusterTool.prototype={toString:function(){return"Hierarchical Clustering"},init:function(project,form){form.setOptions("group_rows_by",morpheus.MetadataUtil.getMetadataNames(project.getFullDataset().getRowMetadata())),form.setOptions("group_columns_by",morpheus.MetadataUtil.getMetadataNames(project.getFullDataset().getColumnMetadata())),form.setVisible("group_rows_by",!1),form.setVisible("cluster_rows_in_space_of_selected_columns_only",!1),form.$form.find("[name=cluster]").on("change",function(e){var val=$(this).val(),showGroupColumns=!1,showGroupRows=!1;"Columns"===val?showGroupColumns=!0:"Rows"===val?showGroupRows=!0:(showGroupColumns=!0,showGroupRows=!0),form.setVisible("group_columns_by",showGroupColumns),form.setVisible("group_rows_by",showGroupRows),form.setVisible("cluster_columns_in_space_of_selected_rows_only",showGroupColumns),form.setVisible("cluster_rows_in_space_of_selected_columns_only",showGroupRows)})},gui:function(){return[{name:"metric",options:morpheus.HClusterTool.Functions,value:morpheus.HClusterTool.Functions[4].toString(),type:"select"},{name:"linkage_method",options:["Average","Complete","Single"],value:"Average",type:"select"},{name:"cluster",options:["Columns","Rows","Rows and columns"],value:"Columns",type:"select"},{name:"group_columns_by",options:[],type:"bootstrap-select",multiple:!0},{name:"group_rows_by",options:[],type:"bootstrap-select",multiple:!0},{name:"cluster_columns_in_space_of_selected_rows_only",type:"checkbox"},{name:"cluster_rows_in_space_of_selected_columns_only",type:"checkbox"}]},execute:function(options){var project=options.project,heatmap=options.heatMap,selectedRowsToUseForClusteringColumns=options.input.cluster_columns_in_space_of_selected_rows_only?project.getRowSelectionModel().getViewIndices().values():null;null!=selectedRowsToUseForClusteringColumns&&0===selectedRowsToUseForClusteringColumns.length&&(selectedRowsToUseForClusteringColumns=null);var selectedColumnsToUseForClusteringRows=options.input.cluster_rows_in_space_of_selected_columns_only?project.getColumnSelectionModel().getViewIndices().values():null;null!=selectedColumnsToUseForClusteringRows&&0===selectedColumnsToUseForClusteringRows.length&&(selectedColumnsToUseForClusteringRows=null);var rows="Rows"==options.input.cluster||"Rows and columns"==options.input.cluster,columns="Columns"==options.input.cluster||"Rows and columns"==options.input.cluster;options.input.selectedRowsToUseForClusteringColumns=selectedRowsToUseForClusteringColumns,options.input.selectedColumnsToUseForClusteringRows=selectedColumnsToUseForClusteringRows;var rowModelOrder,columnModelOrder,dataset=project.getSortedFilteredDataset();if(void 0===options.input.background&&(options.input.background=!0),options.input.background=options.input.background&&"undefined"!=typeof Worker,rows){rowModelOrder=[];for(var i=0;i<dataset.getRowCount();i++)rowModelOrder[i]=project.convertViewRowIndexToModel(i)}if(columns){columnModelOrder=[];for(i=0;i<dataset.getColumnCount();i++)columnModelOrder[i]=project.convertViewColumnIndexToModel(i)}if(!1!==options.input.background){var blob=new Blob(["self.onmessage = function(e) {importScripts(e.data.scripts);self.postMessage(morpheus.HClusterTool.execute(morpheus.Dataset.fromJSON(e.data.dataset), e.data.input));}"]),url=window.URL.createObjectURL(blob),worker=new Worker(url);return worker.postMessage({scripts:morpheus.Util.getScriptPath(),dataset:morpheus.Dataset.toJSON(dataset,{columnFields:options.input.group_columns_by||[],rowFields:options.input.group_rows_by||[],seriesIndices:[0]}),input:options.input}),worker.onmessage=function(e){var result=e.data;if(result.rowsHcl){for(var modelOrder=[],i=0;i<result.rowsHcl.reorderedIndices.length;i++)modelOrder[i]=rowModelOrder[result.rowsHcl.reorderedIndices[i]];heatmap.setDendrogram(result.rowsHcl.tree,!1,modelOrder)}if(result.columnsHcl){for(modelOrder=[],i=0;i<result.columnsHcl.reorderedIndices.length;i++)modelOrder[i]=columnModelOrder[result.columnsHcl.reorderedIndices[i]];heatmap.setDendrogram(result.columnsHcl.tree,!0,modelOrder)}worker.terminate(),window.URL.revokeObjectURL(url)},worker}var result=morpheus.HClusterTool.execute(dataset,options.input);if(result.rowsHcl){var modelOrder=[];for(i=0;i<result.rowsHcl.reorderedIndices.length;i++)modelOrder[i]=rowModelOrder[result.rowsHcl.reorderedIndices[i]];heatmap.setDendrogram(result.rowsHcl.tree,!1,modelOrder)}if(result.columnsHcl){for(modelOrder=[],i=0;i<result.columnsHcl.reorderedIndices.length;i++)modelOrder[i]=columnModelOrder[result.columnsHcl.reorderedIndices[i]];heatmap.setDendrogram(result.columnsHcl.tree,!0,modelOrder)}}},morpheus.KMeansTool=function(){},morpheus.KMeansTool.execute=function(dataset,input){var f=morpheus.HClusterTool.Functions.fromString(input.metric);f===morpheus.HClusterTool.PRECOMPUTED_DIST?f=0:f===morpheus.HClusterTool.PRECOMPUTED_SIM&&(f=1);var rowAssignments,columnAssignments,rows="Rows"==input.cluster||"Rows and columns"==input.cluster,columns="Columns"==input.cluster||"Rows and columns"==input.cluster,doCluster=function(d){for(var kmeans=new morpheus.KMeansPlusPlusClusterer(input.number_of_clusters,input.maximum_iterations,f),vectors=[],i=0;i<d.getRowCount();i++)vectors.push(new morpheus.DatasetRowView(d).setIndex(i));var clusters=kmeans.execute(vectors),assignments=[];for(i=0;i<clusters.length;i++)clusters[i].getPoints().forEach(function(p){assignments[p.i]=i+1});return assignments};return rows&&(rowAssignments=doCluster(input.selectedColumnsToUseForClusteringRows?new morpheus.SlicedDatasetView(dataset,null,input.selectedColumnsToUseForClusteringRows):dataset)),columns&&(columnAssignments=doCluster(new morpheus.TransposedDatasetView(input.selectedRowsToUseForClusteringColumns?new morpheus.SlicedDatasetView(dataset,input.selectedRowsToUseForClusteringColumns,null):dataset))),{rowAssignments:rowAssignments,columnAssignments:columnAssignments}},morpheus.KMeansTool.prototype={toString:function(){return"KMeans Clustering"},init:function(project,form){form.setVisible("cluster_rows_in_space_of_selected_columns_only",!1),form.$form.find("[name=cluster]").on("change",function(e){var val=$(this).val(),showGroupColumns=!1,showGroupRows=!1;"Columns"===(val=$(this).val())?showGroupColumns=!0:"Rows"===val?showGroupRows=!0:(showGroupColumns=!0,showGroupRows=!0),form.setVisible("cluster_columns_in_space_of_selected_rows_only",showGroupColumns),form.setVisible("cluster_rows_in_space_of_selected_columns_only",showGroupRows)})},gui:function(){return[{name:"metric",options:morpheus.HClusterTool.Functions,value:morpheus.HClusterTool.Functions[4].toString(),type:"select"},{name:"cluster",options:["Columns","Rows","Rows and columns"],value:"Columns",type:"select"},{name:"number_of_clusters",value:"2",type:"text"},{name:"cluster_columns_in_space_of_selected_rows_only",type:"checkbox"},{name:"cluster_rows_in_space_of_selected_columns_only",type:"checkbox"},{name:"maximum_iterations",value:"1000",type:"text"}]},execute:function(options){var project=options.project,heatmap=options.heatMap;options.input.number_of_clusters=parseInt(options.input.number_of_clusters),options.input.maximum_iterations=parseInt(options.input.maximum_iterations);var selectedRowsToUseForClusteringColumns=options.input.cluster_columns_in_space_of_selected_rows_only?project.getRowSelectionModel().getViewIndices().values():null;null!=selectedRowsToUseForClusteringColumns&&0===selectedRowsToUseForClusteringColumns.length&&(selectedRowsToUseForClusteringColumns=null);var selectedColumnsToUseForClusteringRows=options.input.cluster_rows_in_space_of_selected_columns_only?project.getColumnSelectionModel().getViewIndices().values():null;null!=selectedColumnsToUseForClusteringRows&&0===selectedColumnsToUseForClusteringRows.length&&(selectedColumnsToUseForClusteringRows=null);"Rows"==options.input.cluster||options.input.cluster,"Columns"==options.input.cluster||options.input.cluster;options.input.selectedRowsToUseForClusteringColumns=selectedRowsToUseForClusteringColumns,options.input.selectedColumnsToUseForClusteringRows=selectedColumnsToUseForClusteringRows;var dataset=project.getSortedFilteredDataset();function addAssignments(d,assignments,k){for(var v=d.getColumnMetadata().add("k_means_"+k),i=0;i<assignments.length;i++)v.setValue(i,assignments[i])}if(options.input.background=options.input.background&&"undefined"!=typeof Worker,!1!==options.input.background){var blob=new Blob(["self.onmessage = function(e) {importScripts(e.data.scripts);self.postMessage(morpheus.KMeansTool.execute(morpheus.Dataset.fromJSON(e.data.dataset), e.data.input));}"]),url=window.URL.createObjectURL(blob),worker=new Worker(url);return worker.postMessage({scripts:morpheus.Util.getScriptPath(),dataset:morpheus.Dataset.toJSON(dataset,{columnFields:[],rowFields:[],seriesIndices:[0]}),input:options.input}),worker.onmessage=function(e){var result=e.data;result.columnAssignments&&(addAssignments(dataset,result.columnAssignments,options.input.number_of_clusters),heatmap.addTrack("k_means_"+options.input.number_of_clusters,!0,{highlightMatchingValues:!0,discrete:!0,display:["color"]})),result.rowAssignments&&(addAssignments(new morpheus.TransposedDatasetView(dataset),result.rowAssignments,options.input.number_of_clusters),heatmap.addTrack("k_means_"+options.input.number_of_clusters,!1,{highlightMatchingValues:!0,discrete:!0,display:["color"]})),heatmap.revalidate(),worker.terminate(),window.URL.revokeObjectURL(url)},worker}var result=morpheus.KMeansTool.execute(dataset,options.input);result.columnAssignments&&(addAssignments(dataset,result.columnAssignments,options.input.number_of_clusters),heatmap.addTrack("k_means_"+options.input.number_of_clusters,!0,{highlightMatchingValues:!0,discreteAutoDetermined:!0,display:["color"]})),result.rowAssignments&&(addAssignments(new morpheus.TransposedDatasetView(dataset),result.rowAssignments,options.input.number_of_clusters),heatmap.addTrack("k_means_"+options.input.number_of_clusters,!1,{highlightMatchingValues:!0,discreteAutoDetermined:!0,display:["color"]})),heatmap.revalidate()}},morpheus.MarkerSelection=function(){},morpheus.MarkerSelection.Functions=[morpheus.FisherExact,morpheus.FoldChange,morpheus.MeanDifference,morpheus.SignalToNoise,morpheus.createSignalToNoiseAdjust(),morpheus.TTest],morpheus.MarkerSelection.Functions.fromString=function(s){for(var i=0;i<morpheus.MarkerSelection.Functions.length;i++)if(morpheus.MarkerSelection.Functions[i].toString()===s)return morpheus.MarkerSelection.Functions[i];throw s+" not found"},morpheus.MarkerSelection.execute=function(dataset,input){for(var aIndices=[],bIndices=[],i=0;i<input.numClassA;i++)aIndices[i]=i;for(i=input.numClassA;i<dataset.getColumnCount();i++)bIndices[i]=i;var f=morpheus.MarkerSelection.Functions.fromString(input.metric),permutations=new morpheus.PermutationPValues(dataset,aIndices,bIndices,input.npermutations,f);return{rowSpecificPValues:permutations.rowSpecificPValues,k:permutations.k,fdr:permutations.fdr,scores:permutations.scores}},morpheus.MarkerSelection.prototype={toString:function(){return"Marker Selection"},init:function(project,form){form.$form.find("[name=field]").on("change",function(e){!function(fieldNames){var ids=[];if(null!=fieldNames&&fieldNames.length>0){var vectors=morpheus.MetadataUtil.getVectors(project.getFullDataset().getColumnMetadata(),fieldNames);morpheus.VectorUtil.createValuesToIndicesMap(vectors).forEach(function(indices,id){ids.push(id)})}ids.sort(),form.setOptions("class_a",ids),form.setOptions("class_b",ids)}($(this).val())}),form.$form.find("[name=metric]").on("change",function(e){var isFishy="Fisher Exact Test"===$(this).val();form.setVisible("grouping_value",isFishy),form.setVisible("permutations",!isFishy),form.setVisible("number_of_markers",!isFishy)}),form.setVisible("grouping_value",!1)},gui:function(project){var dataset=project.getSortedFilteredDataset(),fields=morpheus.MetadataUtil.getMetadataNames(dataset.getColumnMetadata());return[{name:"metric",options:morpheus.MarkerSelection.Functions,value:morpheus.SignalToNoise.toString(),type:"select",help:""},{name:"grouping_value",value:"1",help:"Class values are categorized into two groups based on whether dataset values are greater than or equal to this value"},{name:"field",options:fields,type:"bootstrap-select",search:!0,multiple:!0,selectAll:!0},{name:"class_a",title:"Class A",options:[],type:"bootstrap-select",search:!0,multiple:!0,selectAll:!0},{name:"class_b",title:"Class B",options:[],type:"bootstrap-select",search:!0,multiple:!0,selectAll:!0},{name:"number_of_markers",value:"100",type:"text",help:"The initial number of markers to show in each direction."},{name:"permutations",value:"0",type:"text"}]},execute:function(options){var project=options.project,classA=options.input.class_a,classB=options.input.class_b;if(0===classA.length&&0===classB.length)throw"No samples in class A and class B";if(0===classA.length)throw"No samples in class A";if(0===classB.length)throw"No samples in class B";for(var i=0;i<classA.length;i++){(val=classA[i])instanceof morpheus.Identifier||(classA[i]=new morpheus.Identifier(morpheus.Util.isArray(val)?val:[val]))}for(i=0;i<classB.length;i++){var val;(val=classB[i])instanceof morpheus.Identifier||(classB[i]=new morpheus.Identifier(morpheus.Util.isArray(val)?val:[val]))}var npermutations=parseInt(options.input.permutations),dataset=project.getSortedFilteredDataset(),fieldNames=options.input.field;morpheus.Util.isArray(fieldNames)||(fieldNames=[fieldNames]);var vectors=morpheus.MetadataUtil.getVectors(dataset.getColumnMetadata(),fieldNames),idToIndices=morpheus.VectorUtil.createValuesToIndicesMap(vectors),aIndices=[],bIndices=[];classA.forEach(function(id){var indices=idToIndices.get(id);if(void 0===indices)throw new Error(id+" not found in "+idToIndices.keys());aIndices=aIndices.concat(indices)}),classB.forEach(function(id){var indices=idToIndices.get(id);if(void 0===indices)throw new Error(id+" not found in "+idToIndices.keys());bIndices=bIndices.concat(indices)});var f=morpheus.MarkerSelection.Functions.fromString(options.input.metric),classASet={};for(i=0;i<aIndices.length;i++)classASet[aIndices[i]]=!0;for(i=0;i<bIndices.length;i++)if(classASet[bIndices[i]])throw"The sample was found in class A and class B";var isFishy=f.toString()===morpheus.FisherExact.toString();1!==aIndices.length&&1!==bIndices.length||isFishy||f.toString()===morpheus.MeanDifference.toString()||(f=morpheus.FoldChange);var list1=new morpheus.DatasetRowView(new morpheus.SlicedDatasetView(dataset,null,aIndices)),list2=new morpheus.DatasetRowView(new morpheus.SlicedDatasetView(dataset,null,bIndices));morpheus.MarkerSelection.Functions.map(function(f){return f.toString()}).concat(["odds_ratio","FDR(BH)","p_value"]).forEach(function(name){var index=morpheus.MetadataUtil.indexOf(dataset.getRowMetadata(),name);-1!==index&&(dataset.getRowMetadata().remove(index),options.heatMap.removeTrack(name,!1))});var v=dataset.getRowMetadata().add(f.toString()),comparisonVector=(vectors=[v],dataset.getColumnMetadata().add("Comparison"));for(i=0;i<aIndices.length;i++)comparisonVector.setValue(aIndices[i],"A");for(i=0;i<bIndices.length;i++)comparisonVector.setValue(bIndices[i],"B");function done(result){if(result){for(var pvalueVector=dataset.getRowMetadata().add("p_value"),fdrVector=dataset.getRowMetadata().add("FDR(BH)"),kVector=dataset.getRowMetadata().add("k"),i=0,size=pvalueVector.size();i<size;i++)pvalueVector.setValue(i,result.rowSpecificPValues[i]),fdrVector.setValue(i,result.fdr[i]),kVector.setValue(i,result.k[i]),v.setValue(i,result.scores[i]);kVector.getProperties().set(morpheus.VectorKeys.FORMATTER,{pattern:"i"}),vectors.push(pvalueVector),vectors.push(fdrVector),vectors.push(kVector)}project.getRowFilter().getFilters().length>0&&project.getRowFilter().setAnd(!0,!0);var rowFilters=project.getRowFilter().getFilters();for(i=0;i<rowFilters.length;i++)rowFilters[i]instanceof morpheus.TopNFilter&&(project.getRowFilter().remove(i,!0),i--);isFishy||project.getRowFilter().add(new morpheus.TopNFilter(parseInt(options.input.number_of_markers),morpheus.TopNFilter.TOP_BOTTOM,vectors[0].getName()),!0),project.setRowFilter(project.getRowFilter(),!0),project.setRowSortKeys([new morpheus.SortKey(vectors[0].getName(),isFishy?morpheus.SortKey.SortOrder.ASCENDING:morpheus.SortKey.SortOrder.DESCENDING)],!0);var selectedColumnIndices=new morpheus.Set;aIndices.forEach(function(index){selectedColumnIndices.add(index)}),bIndices.forEach(function(index){selectedColumnIndices.add(index)}),project.getColumnSelectionModel().setViewIndices(selectedColumnIndices,!0),project.setColumnSortKeys([new morpheus.SortKey(comparisonVector.getName(),morpheus.SortKey.SortOrder.ASCENDING)],!0),project.trigger("trackChanged",{vectors:vectors,display:vectors.map(function(){return"text"}),columns:!1}),project.trigger("trackChanged",{vectors:[comparisonVector],display:["color"],columns:!0})}if(isFishy){for(var groupingValue=parseFloat(options.input.grouping_value),oddsRatioVector=dataset.getRowMetadata().add("odds_ratio"),fdrVector=dataset.getRowMetadata().add("FDR(BH)"),contingencyTableVector=dataset.getRowMetadata().add("contingency_table"),pvalues=[],size=(i=0,dataset.getRowCount());i<size;i++){var abcd=morpheus.createContingencyTable(list1.setIndex(i),list2.setIndex(i),groupingValue);contingencyTableVector.setValue(i,"[["+abcd[0]+", "+abcd[1]+"], ["+abcd[2]+", "+abcd[3]+"]]");var ratio=abcd[0]*abcd[3]/(abcd[1]*abcd[2]);(isNaN(ratio)||ratio===Number.POSITIVE_INFINITY)&&(ratio=0),oddsRatioVector.setValue(i,ratio),v.setValue(i,morpheus.FisherExact.fisherTest(abcd[0],abcd[1],abcd[2],abcd[3])),pvalues.push(v.getValue(i))}var fdr=morpheus.FDR_BH(pvalues);for(i=0,size=dataset.getRowCount();i<size;i++)fdrVector.setValue(i,fdr[i]);vectors.push(oddsRatioVector),vectors.push(fdrVector),vectors.push(contingencyTableVector),done()}else if(npermutations>0){var subset=new morpheus.SlicedDatasetView(dataset,null,aIndices.concat(bIndices));if(options.input.background=options.input.background&&"undefined"!=typeof Worker,options.input.numClassA=aIndices.length,options.input.npermutations=npermutations,options.input.background){var blob=new Blob(["self.onmessage = function(e) {importScripts(e.data.scripts);self.postMessage(morpheus.MarkerSelection.execute(morpheus.Dataset.fromJSON(e.data.dataset), e.data.input));}"]),url=window.URL.createObjectURL(blob),worker=new Worker(url);return worker.postMessage({scripts:morpheus.Util.getScriptPath(),dataset:morpheus.Dataset.toJSON(subset,{columnFields:[],rowFields:[],seriesIndices:[0]}),input:options.input}),worker.onmessage=function(e){done(e.data),worker.terminate(),window.URL.revokeObjectURL(url)},worker}done(morpheus.MarkerSelection.execute(subset,options.input))}else{for(i=0,size=dataset.getRowCount();i<size;i++)v.setValue(i,f(list1.setIndex(i),list2.setIndex(i)));if(f.toString()===morpheus.TTest.toString()&&"undefined"!=typeof jStat){var pvalueVector=dataset.getRowMetadata().add("p_value"),rowSpecificPValues=(fdrVector=dataset.getRowMetadata().add("FDR(BH)"),new Float32Array(dataset.getRowCount()));for(i=0,size=dataset.getRowCount();i<size;i++){list1.setIndex(i),list2.setIndex(i);var m1=morpheus.Mean(list1),m2=morpheus.Mean(list2),v1=morpheus.Variance(list1,m1),v2=morpheus.Variance(list2,m2),n1=morpheus.CountNonNaN(list1),n2=morpheus.CountNonNaN(list2),df=morpheus.DegreesOfFreedom(v1,v2,n1,n2),t=v.getValue(i),p=2*(1-jStat.studentt.cdf(Math.abs(t),df));rowSpecificPValues[i]=p,pvalueVector.setValue(i,p)}vectors.push(pvalueVector);for(fdr=morpheus.FDR_BH(rowSpecificPValues),i=0,size=dataset.getRowCount();i<size;i++)fdrVector.setValue(i,fdr[i]);vectors.push(fdrVector)}done()}}},morpheus.NearestNeighbors=function(){},morpheus.NearestNeighbors.Functions=[morpheus.Cosine,morpheus.Euclidean,morpheus.Jaccard,morpheus.KendallsCorrelation,morpheus.Pearson,morpheus.Spearman,morpheus.WeightedMean],morpheus.NearestNeighbors.Functions.fromString=function(s){for(var i=0;i<morpheus.NearestNeighbors.Functions.length;i++)if(morpheus.NearestNeighbors.Functions[i].toString()===s)return morpheus.NearestNeighbors.Functions[i];throw new Error(s+" not found")},morpheus.NearestNeighbors.execute=function(dataset,input){var f=morpheus.NearestNeighbors.Functions.fromString(input.metric),permutations=new morpheus.PermutationPValues(dataset,null,null,input.npermutations,f,morpheus.Vector.fromArray("",input.listValues));return{rowSpecificPValues:permutations.rowSpecificPValues,k:permutations.k,fdr:permutations.fdr,scores:permutations.scores}},morpheus.NearestNeighbors.prototype={toString:function(){return"Nearest Neighbors"},init:function(project,form){var $selectedOnly=form.$form.find("[name=use_selected_only]").parent();form.$form.find("[name=compute_nearest_neighbors_of]").on("change",function(e){var val=$(this).val();if("selected rows"===val||"column annotation"===val?$($selectedOnly.contents()[1]).replaceWith(document.createTextNode(" Use selected columns only")):$($selectedOnly.contents()[1]).replaceWith(document.createTextNode(" Use selected rows only")),form.setVisible("annotation",!1),"column annotation"===val||"row annotation"===val){for(var metadata="column annotation"===val?project.getFullDataset().getColumnMetadata():project.getFullDataset().getRowMetadata(),names=[],i=0;i<metadata.getMetadataCount();i++){var v=metadata.get(i);"number"===morpheus.VectorUtil.getDataType(v)&&names.push(v.getName())}names.sort(function(a,b){return(a=a.toLowerCase())<(b=b.toLowerCase())?-1:a===b?0:1}),form.setOptions("annotation",names),form.setVisible("annotation",!0)}}),$($selectedOnly.contents()[1]).replaceWith(document.createTextNode(" Use selected columns only")),form.setVisible("annotation",!1)},gui:function(){return[{name:"metric",options:morpheus.NearestNeighbors.Functions,value:morpheus.Pearson.toString(),type:"select"},{name:"compute_nearest_neighbors_of",options:["selected rows","selected columns","column annotation","row annotation"],value:"selected rows",type:"radio"},{name:"use_selected_only",type:"checkbox"},{name:"annotation",type:"bootstrap-select"},{name:"permutations",value:"0",type:"text"}]},execute:function(options){var project=options.project,isColumns="selected columns"==options.input.compute_nearest_neighbors_of||"row annotation"==options.input.compute_nearest_neighbors_of,isAnnotation="column annotation"==options.input.compute_nearest_neighbors_of||"row annotation"==options.input.compute_nearest_neighbors_of,f=(options.heatMap,morpheus.NearestNeighbors.Functions.fromString(options.input.metric)),dataset=project.getSortedFilteredDataset();isColumns&&(dataset=new morpheus.TransposedDatasetView(dataset));var selectedIndices=(isColumns?project.getColumnSelectionModel():project.getRowSelectionModel()).getViewIndices().values();if(!isAnnotation&&0===selectedIndices.length)throw new Error("No "+(isColumns?"columns":"rows")+" selected");var spaceIndices=null;options.input.use_selected_only&&(spaceIndices=(isColumns?project.getRowSelectionModel():project.getColumnSelectionModel()).getViewIndices().values(),dataset=new morpheus.SlicedDatasetView(dataset,null,spaceIndices));var nearestNeighborsList,d1=new morpheus.SlicedDatasetView(dataset,selectedIndices,null);if(isAnnotation){if(!(nearestNeighborsList=dataset.getColumnMetadata().getByName(options.input.annotation)))throw new Error("No annotation selected.")}else{if(d1.getRowCount()>1){for(var columnView=new morpheus.DatasetColumnView(d1),newDataset=new morpheus.Dataset({name:"",rows:1,columns:d1.getColumnCount()}),j=0,ncols=d1.getColumnCount();j<ncols;j++){var v=morpheus.Percentile(columnView.setIndex(j),50);newDataset.setValue(0,j,v)}d1=newDataset}nearestNeighborsList=new morpheus.DatasetRowView(d1)}var npermutations=parseInt(options.input.permutations),scoreVector=dataset.getRowMetadata().add(f.toString());if(npermutations>0){void 0===options.input.background&&(options.input.background=!0),options.input.background=options.input.background&&"undefined"!=typeof Worker,options.input.npermutations=npermutations;for(var done=function(result){for(var pvalueVector=dataset.getRowMetadata().add("p_value"),fdrVector=dataset.getRowMetadata().add("FDR(BH)"),kVector=dataset.getRowMetadata().add("k"),i=0,size=pvalueVector.size();i<size;i++)pvalueVector.setValue(i,result.rowSpecificPValues[i]),fdrVector.setValue(i,result.fdr[i]),kVector.setValue(i,result.k[i]),scoreVector.setValue(i,result.scores[i]);kVector.getProperties().set(morpheus.VectorKeys.FORMATTER,{pattern:"i"});var vectors=[pvalueVector,fdrVector,kVector,scoreVector];project.trigger("trackChanged",{vectors:vectors,display:["text"],columns:isColumns})},listValues=new Float32Array(nearestNeighborsList.size()),i=0,size=listValues.length;i<size;i++)listValues[i]=nearestNeighborsList.getValue(i);if(options.input.listValues=listValues,options.input.background){var blob=new Blob(["self.onmessage = function(e) {importScripts(e.data.scripts);self.postMessage(morpheus.NearestNeighbors.execute(morpheus.Dataset.fromJSON(e.data.dataset), e.data.input));}"]),url=window.URL.createObjectURL(blob),worker=new Worker(url);return worker.postMessage({scripts:morpheus.Util.getScriptPath(),dataset:morpheus.Dataset.toJSON(dataset,{columnFields:[],rowFields:[],seriesIndices:[0]}),input:options.input}),worker.onmessage=function(e){done(e.data),worker.terminate(),window.URL.revokeObjectURL(url)},worker}done(morpheus.NearestNeighbors.execute(dataset,options.input))}else{var datasetRowView=new morpheus.DatasetRowView(dataset);for(i=0,size=dataset.getRowCount();i<size;i++)scoreVector.setValue(i,f(nearestNeighborsList,datasetRowView.setIndex(i)));isColumns?project.setColumnSortKeys([new morpheus.SortKey(f.toString(),morpheus.SortKey.SortOrder.DESCENDING)],!0):project.setRowSortKeys([new morpheus.SortKey(f.toString(),morpheus.SortKey.SortOrder.DESCENDING)],!0),project.trigger("trackChanged",{vectors:[scoreVector],display:["text"],columns:isColumns})}}},morpheus.NewHeatMapTool=function(){},morpheus.NewHeatMapTool.prototype={toString:function(){return"New Heat Map"},execute:function(options){var project=options.project,heatMap=options.heatMap,dataset=project.getSelectedDataset({selectedRows:!0,selectedColumns:!0});morpheus.DatasetUtil.shallowCopy(dataset);new morpheus.HeatMap({name:heatMap.getName(),dataset:dataset,parent:heatMap,symmetric:project.isSymmetric()&&dataset.getColumnCount()===dataset.getRowCount()})}},morpheus.OpenDatasetTool=function(){},morpheus.OpenDatasetTool.prototype={toString:function(){return"Open Dataset"},_read:function(options,deferred){var _this=this,project=options.project,heatMap=options.heatMap,file=options.input.file,action=options.input.open_file_action,dataset=project.getSortedFilteredDataset();deferred.catch(function(err){if("Cancel"!==err.message){var message=["Error opening "+morpheus.Util.getFileName(file)+"."];err.message&&(message.push("<br />Cause: "),message.push(err.message)),morpheus.FormBuilder.showInModal({title:"Error",html:message.join(""),focus:document.activeElement})}}),deferred.then(function(newDataset){morpheus.Util.getExtension(morpheus.Util.getFileName(file)),morpheus.Util.getBaseFileName(morpheus.Util.getFileName(file));if("append"===action||"append columns"===action){var appendRows="append"===action;_.each(heatMap.options.rows,function(item){if(item.renameTo){var v=newDataset.getRowMetadata().getByName(item.field);v&&v.setName(item.renameTo)}}),_.each(heatMap.options.columns,function(item){if(item.renameTo){var v=newDataset.getColumnMetadata().getByName(item.field);v&&v.setName(item.renameTo)}}),heatMap.options.datasetReady&&heatMap.options.datasetReady(newDataset);var currentDatasetMetadataNames=morpheus.MetadataUtil.getMetadataNames(appendRows?dataset.getColumnMetadata():dataset.getRowMetadata()),newDatasetMetadataNames=morpheus.MetadataUtil.getMetadataNames(appendRows?newDataset.getColumnMetadata():newDataset.getRowMetadata());if(currentDatasetMetadataNames.length>1||newDatasetMetadataNames.length>1)_this._matchAppend(newDatasetMetadataNames,currentDatasetMetadataNames,heatMap,function(appendOptions){(heatMap.getProject().setFullDataset(appendRows?new morpheus.JoinedDataset(dataset,newDataset,appendOptions.current_dataset_annotation_name,appendOptions.new_dataset_annotation_name):new morpheus.TransposedDatasetView(new morpheus.JoinedDataset(new morpheus.TransposedDatasetView(dataset),new morpheus.TransposedDatasetView(newDataset),appendOptions.current_dataset_annotation_name,appendOptions.new_dataset_annotation_name)),!0),heatMap.options.renderReady&&(heatMap.options.renderReady(heatMap),heatMap.updateDataset()),appendRows)&&(heatMap.getHeatMapElementComponent().getColorScheme().setSeparateColorSchemeForRowMetadataField("Source"),morpheus.VectorUtil.getSet(heatMap.getProject().getFullDataset().getRowMetadata().getByName("Source")).forEach(function(source){heatMap.autoDisplay({extension:morpheus.Util.getExtension(source),filename:source})}));heatMap.tabManager.setTabTitle(heatMap.tabId,heatMap.getProject().getFullDataset().getRowCount()+" row"+morpheus.Util.s(heatMap.getProject().getFullDataset().getRowCount())+" x "+heatMap.getProject().getFullDataset().getColumnCount()+" column"+morpheus.Util.s(heatMap.getProject().getFullDataset().getColumnCount())),heatMap.addTrack("Source",!appendRows),morpheus.FormBuilder.showInModal({title:"Append",html:"Please scroll to the "+(appendRows?"bottom":"right")+" of the heat map to see the appended data.",focus:document.activeElement}),heatMap.revalidate()});else{if(heatMap.getProject().setFullDataset(appendRows?new morpheus.JoinedDataset(dataset,newDataset,currentDatasetMetadataNames[0],newDatasetMetadataNames[0]):new morpheus.TransposedDatasetView(new morpheus.JoinedDataset(new morpheus.TransposedDatasetView(dataset),new morpheus.TransposedDatasetView(newDataset),currentDatasetMetadataNames[0],newDatasetMetadataNames[0])),!0),heatMap.options.renderReady&&(heatMap.options.renderReady(heatMap),heatMap.updateDataset()),appendRows)heatMap.getHeatMapElementComponent().getColorScheme().setSeparateColorSchemeForRowMetadataField("Source"),morpheus.VectorUtil.getSet(heatMap.getProject().getFullDataset().getRowMetadata().getByName("Source")).forEach(function(source){heatMap.autoDisplay({extension:morpheus.Util.getExtension(source),filename:source})});heatMap.tabManager.setTabTitle(heatMap.tabId,heatMap.getProject().getFullDataset().getRowCount()+" row"+morpheus.Util.s(heatMap.getProject().getFullDataset().getRowCount())+" x "+heatMap.getProject().getFullDataset().getColumnCount()+" column"+morpheus.Util.s(heatMap.getProject().getFullDataset().getColumnCount())),heatMap.addTrack("Source",!appendRows),morpheus.FormBuilder.showInModal({title:"Append",html:"Please scroll to the "+(appendRows?"bottom":"right")+" of the heat map to see the appended data.",focus:document.activeElement}),heatMap.revalidate()}}else"overlay"===action?_this._matchOverlay(morpheus.MetadataUtil.getMetadataNames(newDataset.getColumnMetadata()),morpheus.MetadataUtil.getMetadataNames(dataset.getColumnMetadata()),morpheus.MetadataUtil.getMetadataNames(newDataset.getRowMetadata()),morpheus.MetadataUtil.getMetadataNames(dataset.getRowMetadata()),heatMap,function(appendOptions){morpheus.DatasetUtil.overlay({dataset:dataset,newDataset:newDataset,rowAnnotationName:appendOptions.current_dataset_row_annotation_name,newRowAnnotationName:appendOptions.new_dataset_row_annotation_name,columnAnnotationName:appendOptions.current_dataset_column_annotation_name,newColumnAnnotationName:appendOptions.new_dataset_column_annotation_name}),morpheus.FormBuilder.showInModal({title:"Overlay",html:"Select View > Options to change how the overlayed data is displayed.",focus:document.activeElement})}):"open"===action?new morpheus.HeatMap({dataset:newDataset,parent:heatMap,inheritFromParent:!1}):console.log("Unknown action: "+action);"open"!==action&&heatMap.revalidate()})},execute:function(options){var file=options.input.file,_this=this;return new Promise(function(resolve,reject){morpheus.OpenDatasetTool.fileExtensionPrompt(file,function(readOptions){readOptions||(readOptions={}),readOptions.interactive=!0;var deferred=morpheus.DatasetUtil.read(file,readOptions);deferred.finally(function(){resolve()}),_this._read(options,deferred)})})},_matchAppend:function(newDatasetMetadataNames,currentDatasetMetadataNames,heatMap,callback){var tool={execute:function(options){return options.input},toString:function(){return"Select Fields"},gui:function(){var items=[{name:"current_dataset_annotation_name",options:currentDatasetMetadataNames,type:"select",value:"id",required:!0}];return items.push({name:"new_dataset_annotation_name",type:"select",value:"id",options:newDatasetMetadataNames,required:!0}),items}};morpheus.HeatMap.showTool(tool,heatMap,callback)},_matchOverlay:function(newDatasetColumnMetadataNames,currentDatasetColumnMetadataNames,newDatasetRowMetadataNames,currentDatasetRowMetadataNames,heatMap,callback){var tool={execute:function(options){return options.input},toString:function(){return"Select Fields"},gui:function(){var items=[];return items.push({name:"current_dataset_column_annotation_name",options:currentDatasetColumnMetadataNames,type:"select",value:"id",required:!0}),items.push({name:"new_dataset_column_annotation_name",type:"select",value:"id",options:newDatasetColumnMetadataNames,required:!0}),items.push({name:"current_dataset_row_annotation_name",options:currentDatasetRowMetadataNames,type:"select",value:"id",required:!0}),items.push({name:"new_dataset_row_annotation_name",type:"select",value:"id",options:newDatasetRowMetadataNames,required:!0}),items}};morpheus.HeatMap.showTool(tool,heatMap,callback)}},morpheus.OpenDatasetTool.fileExtensionPrompt=function(file,callback){var ext=morpheus.Util.getExtension(morpheus.Util.getFileName(file));"seg"===ext||"segtab"===ext?this._promptSegtab(function(regions){callback(regions)}):callback(null)},morpheus.OpenDatasetTool._promptMaf=function(promptCallback){var formBuilder=new morpheus.FormBuilder;formBuilder.append({name:"MAF_gene_symbols",value:"",type:"textarea",required:!0,help:"Enter one gene symbol per line to filter genes. Leave blank to show all genes."}),morpheus.FormBuilder.showInModal({title:"Gene Symbols",html:formBuilder.$form,close:"OK",onClose:function(){for(var text=formBuilder.getValue("MAF_gene_symbols"),lines=morpheus.Util.splitOnNewLine(text),mafGeneFilter=new morpheus.Map,i=0,nlines=lines.length,counter=0;i<nlines;i++){var line=lines[i];""!==line&&mafGeneFilter.set(line,counter++)}var readOptions=mafGeneFilter.size()>0?{mafGeneFilter:mafGeneFilter}:null;promptCallback(readOptions)}})},morpheus.OpenDatasetTool._promptSegtab=function(promptCallback){var formBuilder=new morpheus.FormBuilder;formBuilder.append({name:"regions",value:"",type:"textarea",required:!0,help:"Define the regions over which you want to define the CNAs. Enter one region per line. Each line should contain region_id, chromosome, start, and end separated by a tab. Leave blank to use all unique segments in the segtab file as regions."}),morpheus.FormBuilder.showInModal({title:"Regions",html:formBuilder.$form,close:"OK",onClose:function(){for(var text=formBuilder.getValue("regions"),lines=morpheus.Util.splitOnNewLine(text),regions=[],tab=/\t/,i=0,nlines=lines.length;i<nlines;i++){var line=lines[i];if(""!==line){var tokens=line.split(tab);tokens.length>=4&&regions.push({id:tokens[0],chromosome:tokens[1],start:parseInt(tokens[2]),end:parseInt(tokens[3])})}}var readOptions=regions.length>0?{regions:regions}:null;promptCallback(readOptions)}})},morpheus.OpenDendrogramTool=function(file){this._file=file},morpheus.OpenDendrogramTool.prototype={toString:function(){return"Open Dendrogram"},init:function(project,form){var setValue=function(val){var isRows="Rows"===val,names=morpheus.MetadataUtil.getMetadataNames(isRows?project.getFullDataset().getRowMetadata():project.getFullDataset().getColumnMetadata());names.unshift("Newick file does not contain node ids"),form.setOptions("match_leaf_node_ids_to",names)};form.$form.find("[name=orientation]").on("change",function(e){setValue($(this).val())}),setValue("Columns")},gui:function(){return[{name:"orientation",options:["Columns","Rows"],value:"Columns",type:"radio"},{name:"match_leaf_node_ids_to",options:[],type:"select"}]},execute:function(options){var fileOrUrl=this._file,isColumns="Columns"===options.input.orientation,dendrogramField=options.input.match_leaf_node_ids_to;""!=dendrogramField&&"Newick file does not contain node ids"!==dendrogramField||(dendrogramField=null);var heatMap=options.heatMap;morpheus.Util.getText(fileOrUrl).then(function(text){var dataset=options.project.getSortedFilteredDataset();isColumns&&(dataset=new morpheus.TransposedDatasetView(dataset));var tree=morpheus.DendrogramUtil.parseNewick(text);if(tree.leafNodes.length!==dataset.getRowCount())throw new Error("# leaf nodes in dendrogram "+tree.leafNodes.length+" != "+dataset.getRowCount());var modelIndices=[];if(null!=dendrogramField)for(var vector=dataset.getRowMetadata().getByName(dendrogramField),valueToIndex=morpheus.VectorUtil.createValueToIndexMap(vector),i=0,length=tree.leafNodes.length;i<length;i++){var newickId=tree.leafNodes[i].name,index=valueToIndex.get(newickId);if(void 0===index)throw new Error("Unable to find dendrogram id "+tree.leafNodes[i].name+" in annotations");modelIndices.push(index)}else{for(i=0,length=tree.leafNodes.length;i<length;i++){newickId=tree.leafNodes[i].name;if(newickId=parseInt(newickId),isNaN(newickId))break;modelIndices.push(newickId)}if(modelIndices.length!==tree.leafNodes.length){modelIndices=[];for(i=0,length=tree.leafNodes.length;i<length;i++)modelIndices.push(i)}}heatMap.setDendrogram(tree,isColumns,modelIndices)})}},morpheus.OpenFileTool=function(options){this.options=options||{}},morpheus.OpenFileTool.OPEN_FILE_ACTION_OPTIONS=[{name:"Open session",value:"Open session"},{name:"Open dataset in new tab",value:"open"},{name:"Append rows to current dataset",value:"append"},{name:"Append columns to current dataset",value:"append columns"},{name:"Overlay onto current dataset",value:"overlay"},{divider:!0},{name:"Annotate columns",value:"Annotate Columns"},{name:"Annotate rows",value:"Annotate Rows"},{divider:!0},{name:"Open dendrogram",value:"Open dendrogram"}],morpheus.OpenFileTool.prototype={toString:function(){var file="";return null!=this.options.file&&null!=this.options.file.name?file=" - "+this.options.file.name:this.options.clipboard&&(file=" - Clipboard"),"Open"+file},gui:function(){var params=[{name:"open_file_action",value:"open",type:"bootstrap-select",options:morpheus.OpenFileTool.OPEN_FILE_ACTION_OPTIONS}];if(null==this.options.file)params.options={size:"modal-lg",cancel:!1,ok:!1};else{var extension=morpheus.Util.getExtension(morpheus.Util.getFileName(this.options.file));"json"===extension?params[0].options=params[0].options.filter(function(opt){return null!=opt.value&&("Open session"===opt.value||"open"===opt.value||"overlay"===opt.value||-1!==opt.value.indexOf("append"))}):"gct"===extension&&(params[0].options=params[0].options.filter(function(opt){return null!=opt.value&&("open"===opt.value||"overlay"===opt.value||-1!==opt.value.indexOf("append"))}))}return params},init:function(project,form,initOptions){var _this=this;if(null==this.options.file){form.setVisible("open_file_action",!1);var $div=$("<div></div>"),$ok=$('<div style="display:none;padding:15px;text-align:right;"><button name="action-selected" type="button" class="btn btn-default">OK</button></div>');$ok.find("[name=action-selected]").on("click",function(){_this.ok()}),new morpheus.FilePicker({fileCallback:function(files){$div.hide(),$ok.show(),_this.options.file=files[0];var extension=morpheus.Util.getExtension(morpheus.Util.getFileName(_this.options.file));"json"===extension?form.setOptions("open_file_action",morpheus.OpenFileTool.OPEN_FILE_ACTION_OPTIONS.filter(function(opt){return null!=opt.value&&("Open session"===opt.value||"open"===opt.value||"overlay"===opt.value||-1!==opt.value.indexOf("append"))})):"gct"===extension&&form.setOptions("open_file_action",morpheus.OpenFileTool.OPEN_FILE_ACTION_OPTIONS.filter(function(opt){return null!=opt.value&&("open"===opt.value||"overlay"===opt.value||-1!==opt.value.indexOf("append"))})),form.setVisible("open_file_action",!0)},optionsCallback:function(heatMapOptions){$div.hide(),$ok.show(),_this.options.file=heatMapOptions.dataset,form.setVisible("open_file_action",!0),form.setOptions("open_file_action",morpheus.OpenFileTool.OPEN_FILE_ACTION_OPTIONS.filter(function(opt){return null!=opt.value&&("open"===opt.value||"overlay"===opt.value||-1!==opt.value.indexOf("append"))}))}}).$el.appendTo($div),$ok.appendTo(form.$form),$div.appendTo(form.$form)}},execute:function(options){var _this=this,isInteractive=null==this.options.file,heatMap=options.heatMap;isInteractive||(options.input.file=this.options.file,options.input.clipboard=this.options.clipboard);var project=options.project;return"Open session"===options.input.open_file_action?morpheus.Util.getText(options.input.file).then(function(text){var options=JSON.parse(text);options.tabManager=heatMap.getTabManager(),options.focus=!0,options.inheritFromParent=!1,options.landingPage=heatMap.options.landingPage,new morpheus.HeatMap(options)}).catch(function(err){morpheus.FormBuilder.showMessageModal({title:"Error",message:"Unable to load session",focus:document.activeElement})}):"append columns"===options.input.open_file_action||"append"===options.input.open_file_action||"open"===options.input.open_file_action||"overlay"===options.input.open_file_action?(new morpheus.OpenDatasetTool).execute(options):"Open dendrogram"!==options.input.open_file_action?new Promise(function(resolve,reject){var isAnnotateColumns="Annotate Columns"==options.input.open_file_action,fileOrUrl=options.input.file,dataset=project.getFullDataset(),fileName=morpheus.Util.getFileName(fileOrUrl);if(morpheus.Util.endsWith(fileName,".cls"))(result=morpheus.Util.readLines(fileOrUrl)).finally(function(){resolve()}),result.then(function(lines){_this.annotateCls(heatMap,dataset,fileName,isAnnotateColumns,lines)});else if(morpheus.Util.endsWith(fileName,".gmt"))morpheus.ArrayBufferReader.getArrayBuffer(fileOrUrl,function(err,buf){if(resolve(),err)throw new Error("Unable to read "+fileOrUrl);var sets=(new morpheus.GmtReader).read(new morpheus.ArrayBufferReader(new Uint8Array(buf)));_this.promptSets(dataset,heatMap,isAnnotateColumns,sets,morpheus.Util.getBaseFileName(morpheus.Util.getFileName(fileOrUrl)))});else{var result;(result=morpheus.Util.readLines(fileOrUrl)).then(function(lines){_this.prompt(lines,dataset,heatMap,isAnnotateColumns)}).finally(function(){resolve()})}}):void morpheus.HeatMap.showTool(new morpheus.OpenDendrogramTool(options.input.file),options.heatMap)},annotateCls:function(heatMap,dataset,fileName,isColumns,lines){isColumns&&(dataset=new morpheus.TransposedDatasetView(dataset));var assignments=(new morpheus.ClsReader).read(lines);if(assignments.length!==dataset.getRowCount())throw new Error("Number of samples in cls file does not match dataset.");for(var vector=dataset.getRowMetadata().add(morpheus.Util.getBaseFileName(fileName)),i=0;i<assignments.length;i++)vector.setValue(i,assignments[i]);heatMap&&heatMap.getProject().trigger("trackChanged",{vectors:[vector],display:["color"],columns:isColumns})},annotateSets:function(dataset,isColumns,sets,datasetMetadataName,setSourceFileName){isColumns&&(dataset=new morpheus.TransposedDatasetView(dataset));var vector=dataset.getRowMetadata().getByName(datasetMetadataName),idToIndices=morpheus.VectorUtil.createValueToIndicesMap(vector),setVector=dataset.getRowMetadata().add(setSourceFileName);return sets.forEach(function(set){var name=set.name;set.ids.forEach(function(id){var indices=idToIndices.get(id);if(void 0!==indices)for(var i=0,nIndices=indices.length;i<nIndices;i++){var array=setVector.getValue(indices[i]);void 0===array&&(array=[]),array.push(name),setVector.setValue(indices[i],array)}})}),setVector},annotate:function(options){var lines=options.lines,dataset=options.dataset,isColumns=options.isColumns,sets=options.sets,metadataName=options.metadataName,fileColumnName=options.fileColumnName,fileColumnNamesToInclude=options.fileColumnNamesToInclude,transposed=options.transposed,separator=options.separator;null==separator&&(separator=/\t/),isColumns&&(dataset=new morpheus.TransposedDatasetView(dataset));var vector=dataset.getRowMetadata().getByName(metadataName);if(!vector)throw new Error("vector "+metadataName+" not found.");var fileColumnNamesToIncludeSet=null;null!=fileColumnNamesToInclude&&(fileColumnNamesToIncludeSet=new morpheus.Set,fileColumnNamesToInclude.forEach(function(name){fileColumnNamesToIncludeSet.add(name)}));var vectors=[],idToIndices=morpheus.VectorUtil.createValueToIndicesMap(vector);if(lines)if(transposed){var matchOnLine,splitLines=[];for(i=0,nrows=lines.length;i<nrows;i++){if(fileColumnName===(name=(line=lines[i].split(separator))[0]))matchOnLine=line;else{if(fileColumnNamesToIncludeSet&&!fileColumnNamesToIncludeSet.has(name))continue;splitLines.push(line),(v=dataset.getRowMetadata().getByName(name))||(v=dataset.getRowMetadata().add(name)),vectors.push(v)}}if(null==matchOnLine)throw new Error(fileColumnName+" not found in header.");for(var fileColumnIndex=1,ncols=matchOnLine.length;fileColumnIndex<ncols;fileColumnIndex++){id=matchOnLine[fileColumnIndex];if(void 0!==(indices=idToIndices.get(id)))for(nIndices=indices.length,j=0;j<splitLines.length;j++)for(token=splitLines[j][fileColumnIndex],v=vectors[j],r=0;r<nIndices;r++)v.setValue(indices[r],token)}}else{var header=lines[0].split(separator),fileMatchOnColumnIndex=_.indexOf(header,fileColumnName);if(-1===fileMatchOnColumnIndex)throw new Error(fileColumnName+" not found in header:"+header);for(var columnIndices=[],nheaders=header.length,j=0;j<nheaders;j++){var name=header[j];if(j!==fileMatchOnColumnIndex)if(!fileColumnNamesToIncludeSet||fileColumnNamesToIncludeSet.has(name))(v=dataset.getRowMetadata().getByName(name))||(v=dataset.getRowMetadata().add(name)),columnIndices.push(j),vectors.push(v)}nheaders=columnIndices.length;for(var i=1,nrows=lines.length;i<nrows;i++){var line,indices,id=(line=lines[i].split(separator))[fileMatchOnColumnIndex];if(void 0!==(indices=idToIndices.get(id)))for(var nIndices=indices.length,j=0;j<nheaders;j++)for(var token=line[columnIndices[j]],v=vectors[j],r=0;r<nIndices;r++)v.setValue(indices[r],token)}}else _.each(sets,function(set){var name=set.name,members=set.ids,v=dataset.getRowMetadata().add(name);vectors.push(v),_.each(members,function(id){var indices=idToIndices.get(id);if(void 0!==indices)for(var i=0,nIndices=indices.length;i<nIndices;i++)v.setValue(indices[i],name)})});for(i=0;i<vectors.length;i++)morpheus.VectorUtil.maybeConvertStringToNumber(vectors[i]);return vectors},promptSets:function(dataset,heatMap,isColumns,sets,setSourceFileName){var promptTool={},_this=this;promptTool.execute=function(options){var metadataName=options.input.dataset_field_name,vector=_this.annotateSets(dataset,isColumns,sets,metadataName,setSourceFileName);heatMap.getProject().trigger("trackChanged",{vectors:[vector],display:["text"],columns:isColumns})},promptTool.toString=function(){return"Select Fields To Match On"},promptTool.gui=function(){return[{name:"dataset_field_name",options:morpheus.MetadataUtil.getMetadataNames(isColumns?dataset.getColumnMetadata():dataset.getRowMetadata()),type:"select",value:"id",required:!0}]},morpheus.HeatMap.showTool(promptTool,heatMap)},prompt:function(lines,dataset,heatMap,isColumns){var promptTool={},_this=this,separator=/\t/;if(null!=lines)for(var separators=["\t",","," "],headerLine=lines[0].trim(),i=0;i<separators.length;i++){var sep=separators[i];if(headerLine.split(new RegExp(sep)).length>1){separator=sep;break}}var header=null!=lines?lines[0].split(separator):null;promptTool.execute=function(options){for(var metadataName=options.input.dataset_field_name,fileColumnName=options.input.file_field_name,vectors=_this.annotate({lines:lines,dataset:dataset,isColumns:isColumns,metadataName:metadataName,fileColumnName:fileColumnName,transposed:!1,separator:separator}),nameToIndex=new morpheus.Map,display=[],i=0;i<vectors.length;i++)display.push(isColumns?"color":"text"),nameToIndex.set(vectors[i].getName(),i);if(lines.colors){var colorModel=isColumns?heatMap.getProject().getColumnColorModel():heatMap.getProject().getRowColorModel();lines.colors.forEach(function(item){var index=nameToIndex.get(item.header),vector=vectors[index];display[index]="color",colorModel.setMappedValue(vector,item.value,item.color)})}heatMap.getProject().trigger("trackChanged",{vectors:vectors,display:display,columns:isColumns})},promptTool.toString=function(){return"Select Fields To Match On"},promptTool.gui=function(){var items=[{name:"dataset_field_name",options:morpheus.MetadataUtil.getMetadataNames(isColumns?dataset.getColumnMetadata():dataset.getRowMetadata()),type:"select",required:!0}];return lines&&items.push({name:"file_field_name",type:"select",options:_.map(header,function(item){return{name:item,value:item}}),required:!0}),items},morpheus.HeatMap.showTool(promptTool,heatMap)}},morpheus.SaveDatasetTool=function(){},morpheus.SaveDatasetTool.prototype={toString:function(){return"Save Dataset"},init:function(project,form){form.find("file_name").prop("autofocus",!0).focus();for(var seriesNames=[],dataset=project.getFullDataset(),i=0,nseries=dataset.getSeriesCount();i<nseries;i++)seriesNames.push(dataset.getName(i));form.setOptions("series",seriesNames.length>1?seriesNames:null),form.setVisible("series",seriesNames.length>1)},gui:function(){return[{name:"file_name",type:"text",help:'<a target="_blank" href="http://support.lincscloud.org/hc/en-us/articles/202105453-GCT-Gene-Cluster-Text-Format-">GCT 1.3</a> or <a target="_blank" href="http://www.broadinstitute.org/cancer/software/genepattern/gp_guides/file-formats/sections/gct">GCT 1.2</a> file name',required:!0},{name:"file_format",type:"radio",options:[{name:"GCT version 1.2",value:"1.2"},{name:"GCT version 1.3",value:"1.3"}],value:"1.3"},{name:"series",type:"select",options:[],required:!0},{name:"save_selection_only",type:"checkbox",required:!0}]},execute:function(options){var project=options.project,format=options.input.file_format,fileName=options.input.file_name;""===fileName&&(fileName="dataset");var writer,series=options.input.series,heatMap=options.heatMap,dataset=options.input.save_selection_only?project.getSelectedDataset():project.getSortedFilteredDataset();if("1.2"===format?writer=new morpheus.GctWriter12:"1.3"===format&&(writer=new morpheus.GctWriter),null!=series){var seriesIndex=morpheus.DatasetUtil.getSeriesIndex(dataset,series);-1===seriesIndex&&(seriesIndex=0),dataset=0===seriesIndex?dataset:new morpheus.DatasetSeriesView(dataset,[seriesIndex])}var ext=writer.getExtension?writer.getExtension():"";""===ext||morpheus.Util.endsWith(fileName.toLowerCase(),"."+ext)||(fileName+="."+ext),writer.setNumberFormat(heatMap.getHeatMapElementComponent().getDrawValuesFormat());var blobs=[],textArray=[],proxy={push:function(text){if(textArray.push(text),1e4===textArray.length){var blob=new Blob([textArray.join("")],{type:"text/plain;charset=charset=utf-8"});textArray=[],blobs.push(blob)}},join:function(){if(textArray.length>0){var blob=new Blob([textArray.join("")],{type:"text/plain;charset=charset=utf-8"});blobs.push(blob),textArray=[]}blob=new Blob(blobs,{type:"text/plain;charset=charset=utf-8"});saveAs(blob,fileName,!0)}};writer.write(dataset,proxy)}},morpheus.SaveImageTool=function(){},morpheus.SaveImageTool.prototype={toString:function(){return"Save Image"},init:function(project,form){form.find("file_name").prop("autofocus",!0).focus()},gui:function(){return[{name:"file_name",type:"text",required:!0},{name:"format",type:"radio",options:["PDF","PNG","SVG"],value:"PNG",required:!0}]},execute:function(options){var fileName=options.input.file_name;""===fileName&&(fileName="image");var format=options.input.format.toLowerCase();morpheus.Util.endsWith(fileName.toLowerCase(),"."+format)||(fileName+="."+format),options.heatMap.saveImage(fileName,format)}},morpheus.SaveSessionTool=function(){},morpheus.SaveSessionTool.prototype={toString:function(){return"Save Session"},init:function(project,form){form.find("file_name").prop("autofocus",!0).focus()},gui:function(){return[{name:"file_name",type:"text",required:!0}]},execute:function(options){var fileName=options.input.file_name;""===fileName&&(fileName="session.json"),morpheus.Util.endsWith(fileName.toLowerCase(),".json")||(fileName+=".json");var heatMap=options.heatMap,json=(options={dataset:!0},heatMap.toJSON(options)),nativeArrayToArray=Array.from||function(typedArray){var normalArray=Array.prototype.slice.call(typedArray);normalArray.length,typedArray.length,normalArray.constructor,Array},blob=new Blob([JSON.stringify(json,function(key,value){return morpheus.Util.isArray(value)?value instanceof Array?value:nativeArrayToArray(value):value})],{type:"application/json;charset=charset=utf-8"});saveAs(blob,fileName,!0)}},morpheus.SimilarityMatrixTool=function(){},morpheus.SimilarityMatrixTool.Functions=[morpheus.Euclidean,morpheus.Jaccard,morpheus.Cosine,morpheus.KendallsCorrelation,morpheus.Pearson,morpheus.Spearman],morpheus.SimilarityMatrixTool.Functions.fromString=function(s){for(var i=0;i<morpheus.SimilarityMatrixTool.Functions.length;i++)if(morpheus.SimilarityMatrixTool.Functions[i].toString()===s)return morpheus.SimilarityMatrixTool.Functions[i];throw new Error(s+" not found")},morpheus.SimilarityMatrixTool.execute=function(dataset,input){var isColumnMatrix="Columns"==input.compute_matrix_for,f=morpheus.SimilarityMatrixTool.Functions.fromString(input.metric);return morpheus.HCluster.computeDistanceMatrix(isColumnMatrix?new morpheus.TransposedDatasetView(dataset):dataset,f)},morpheus.SimilarityMatrixTool.prototype={toString:function(){return"Similarity Matrix"},init:function(project,form){},gui:function(){return[{name:"metric",options:morpheus.SimilarityMatrixTool.Functions,value:morpheus.SimilarityMatrixTool.Functions[4].toString(),type:"select"},{name:"compute_matrix_for",options:["Columns","Rows"],value:"Columns",type:"radio"}]},execute:function(options){var project=options.project,heatMap=options.heatMap,isColumnMatrix="Columns"==options.input.compute_matrix_for,f=morpheus.SimilarityMatrixTool.Functions.fromString(options.input.metric),dataset=project.getSortedFilteredDataset(),blob=new Blob(["self.onmessage = function(e) {importScripts(e.data.scripts);self.postMessage(morpheus.SimilarityMatrixTool.execute(morpheus.Dataset.fromJSON(e.data.dataset), e.data.input));}"]),url=window.URL.createObjectURL(blob),worker=new Worker(url);return worker.postMessage({scripts:morpheus.Util.getScriptPath(),dataset:morpheus.Dataset.toJSON(dataset,{columnFields:[],rowFields:[],seriesIndices:[0]}),input:options.input}),worker.onmessage=function(e){for(var name=heatMap.getName()+" "+options.input.metric,matrix=e.data,n=isColumnMatrix?dataset.getColumnCount():dataset.getRowCount(),d=new morpheus.Dataset({name:name,rows:n,columns:n}),isDistance=f.toString()===morpheus.Euclidean.toString()||f.toString()===morpheus.Jaccard.toString(),i=1;i<n;i++)for(var j=0;j<i;j++){var value=matrix[i][j];d.setValue(i,j,value),d.setValue(j,i,value)}if(!isDistance)for(i=0;i<n;i++)d.setValue(i,i,1);var colorScheme,metadata=isColumnMatrix?dataset.getColumnMetadata():dataset.getRowMetadata();d.rowMetadataModel=morpheus.MetadataUtil.shallowCopy(metadata),d.columnMetadataModel=morpheus.MetadataUtil.shallowCopy(metadata),colorScheme=isDistance?{type:"fixed",map:[{value:0,color:"white"},{value:morpheus.DatasetUtil.max(d),color:"red"}]}:{type:"fixed",map:[{value:-1,color:"blue"},{value:0,color:"white"},{value:1,color:"red"}]},new morpheus.HeatMap({colorScheme:colorScheme,name:name,dataset:d,parent:heatMap,inheritFromParentOptions:{rows:!isColumnMatrix,columns:isColumnMatrix}}),worker.terminate(),window.URL.revokeObjectURL(url)},worker}},morpheus.TransposeTool=function(){},morpheus.TransposeTool.prototype={toString:function(){return"Transpose"},execute:function(options){var project=options.project,heatMap=options.heatMap,dataset=new morpheus.TransposedDatasetView(project.getSortedFilteredDataset()),rowMetadataModel=morpheus.MetadataUtil.shallowCopy(dataset.getRowMetadata()),columnMetadataModel=morpheus.MetadataUtil.shallowCopy(dataset.getColumnMetadata());dataset.getRowMetadata=function(){return rowMetadataModel},dataset.getColumnMetadata=function(){return columnMetadataModel};var name=options.input.name||heatMap.getName();new morpheus.HeatMap({name:name,dataset:dataset,inheritFromParentOptions:{transpose:!0},parent:heatMap})}},morpheus.TsneTool=function(){},morpheus.TsneTool.execute=function(dataset,input){var matrix=[];"Rows"==input.run_on||(dataset=new morpheus.TransposedDatasetView(dataset));var N=dataset.getRowCount(),f=morpheus.HClusterTool.Functions.fromString(input.metric);if(f===morpheus.TsneTool.PRECOMPUTED_DIST)for(var i=0;i<N;i++){matrix.push([]);for(var j=i+1;j<N;j++)matrix[i][j]=dataset.getValue(i,j)}else if(f===morpheus.TsneTool.PRECOMPUTED_SIM){var max=morpheus.DatasetUtil.max(dataset);for(i=0;i<N;i++){matrix.push([]);for(j=i+1;j<N;j++)matrix[i][j]=max-dataset.getValue(i,j)}}else{var list1=new morpheus.DatasetRowView(dataset),list2=new morpheus.DatasetRowView(dataset);for(i=0;i<N;i++){matrix.push([]),list1.setIndex(i);for(j=i+1;j<N;j++){var d=f(list1,list2.setIndex(j));matrix[i][j]=d}}}var opt={};opt.epsilon=input.epsilon,opt.perplexity=input.perplexity,opt.dim=2;var tsne=new tsnejs.tSNE(opt);tsne.initDataDist(matrix);for(var k=0;k<1e3;k++)tsne.step();return{solution:tsne.getSolution()}},morpheus.TsneTool.prototype={toString:function(){return"t-SNE"},init:function(project,form){},gui:function(){return[{name:"metric",options:morpheus.HClusterTool.Functions,value:morpheus.HClusterTool.Functions[4].toString(),type:"select"},{name:"run_on",options:["Columns","Rows"],value:"Columns",type:"select"},{name:"epsilon",value:"10",type:"text",help:"learning rate"},{name:"perplexity",value:"30",type:"text",help:"number of effective nearest neighbors"}]},execute:function(options){var project=options.project,rows=(options.heatMap,"Rows"==options.input.run_on),dataset=project.getSortedFilteredDataset();options.input.epsilon=parseInt(options.input.epsilon),options.input.perplexity=parseInt(options.input.perplexity);var done=function(result){for(var solution=result.solution,t1Vector=rows?dataset.getRowMetadata().add("T1"):dataset.getColumnMetadata().add("T1"),t2Vector=rows?dataset.getRowMetadata().add("T2"):dataset.getColumnMetadata().add("T2"),i=0;i<t1Vector.size();i++)t1Vector.setValue(i,solution[i][0]),t2Vector.setValue(i,solution[i][1]);project.trigger("trackChanged",{vectors:[t1Vector,t2Vector],display:["color","color"],columns:!rows})};done(morpheus.TsneTool.execute(dataset,options.input))}},morpheus.AbstractCanvas=function(offscreen){this.canvas=morpheus.CanvasUtil.createCanvas(),this.lastClip=null,offscreen&&(this.offscreenCanvas=morpheus.CanvasUtil.createCanvas()),this.offset={x:0,y:0}},morpheus.AbstractCanvas.prototype={visible:!0,invalid:!0,scrollX:0,scrollY:0,prefWidth:void 0,prefHeight:void 0,getCanvas:function(){return this.canvas},scrollTop:function(pos){if(void 0===pos)return this.offset.y;this.offset.y=pos},appendTo:function($el){$(this.canvas).appendTo($el)},scrollLeft:function(pos){if(void 0===pos)return this.offset.x;this.offset.x=pos},dispose:function(){$(this.canvas).remove(),this.offscreenCanvas=void 0},getPrefWidth:function(){return this.prefWidth},setInvalid:function(invalid){this.invalid=invalid},setBounds:function(bounds){var backingScale=morpheus.CanvasUtil.BACKING_SCALE,canvases=[this.canvas];this.offscreenCanvas&&canvases.push(this.offscreenCanvas),null!=bounds.height&&_.each(canvases,function(canvas){canvas.height=bounds.height*backingScale,canvas.style.height=bounds.height+"px"}),null!=bounds.width&&_.each(canvases,function(canvas){canvas.width=bounds.width*backingScale,canvas.style.width=bounds.width+"px"}),null!=bounds.left&&_.each(canvases,function(canvas){canvas.style.left=bounds.left+"px"}),null!=bounds.top&&_.each(canvases,function(canvas){canvas.style.top=bounds.top+"px"})},paint:function(clip){var context=this.canvas.getContext("2d");morpheus.CanvasUtil.resetTransform(context);var width=this.getUnscaledWidth(),height=this.getUnscaledHeight();if(context.clearRect(0,0,width,height),this.prePaint&&(morpheus.CanvasUtil.resetTransform(context),context.translate(this.offset.x,this.offset.y),this.prePaint(clip,context)),morpheus.CanvasUtil.resetTransform(context),this.offscreenCanvas){if(this.invalid){var oc=this.offscreenCanvas.getContext("2d");morpheus.CanvasUtil.resetTransform(oc),context.translate(this.offset.x,this.offset.y),oc.clearRect(0,0,width,height),this.draw(clip,oc)}width>0&&height>0&&context.drawImage(this.offscreenCanvas,0,0,width,height)}else this.draw(clip,context);this.postPaint&&(morpheus.CanvasUtil.resetTransform(context),context.translate(this.offset.x,this.offset.y),this.postPaint(clip,context)),this.lastClip=clip,this.invalid=!1},repaint:function(){this.lastClip||(this.lastClip={x:0,y:0,width:this.getUnscaledWidth(),height:this.getUnscaledHeight()}),this.paint(this.lastClip)},draw:function(clip,context){console.log("Not implemented")},getPrefHeight:function(){return this.prefHeight},setPrefWidth:function(prefWidth){this.prefWidth=prefWidth},setPrefHeight:function(prefHeight){this.prefHeight=prefHeight},isVisible:function(){return this.visible},setVisible:function(visible){this.visible!==visible&&(this.visible=visible,this.canvas.style.display=visible?"":"none")},getUnscaledWidth:function(){return this.canvas.width/morpheus.CanvasUtil.BACKING_SCALE},getUnscaledHeight:function(){return this.canvas.height/morpheus.CanvasUtil.BACKING_SCALE},getWidth:function(){return this.canvas.width},getHeight:function(){return this.canvas.height}},morpheus.AbstractColorSupplier=function(){this.fractions=[0,.5,1],this.colors=["#0000ff","#ffffff","#ff0000"],this.names=null,this.min=0,this.max=1,this.missingColor="#c0c0c0",this.scalingMode=morpheus.HeatMapColorScheme.ScalingMode.RELATIVE,this.stepped=!1,this.sizer=new morpheus.HeatMapSizer,this.conditions=new morpheus.HeatMapConditions,this.transformValues=0},morpheus.AbstractColorSupplier.Z_SCORE=1,morpheus.AbstractColorSupplier.ROBUST_Z_SCORE=2,morpheus.AbstractColorSupplier.toJSON=function(cs){var json={fractions:cs.fractions,colors:cs.colors,min:cs.min,max:cs.max,missingColor:cs.missingColor,scalingMode:cs.scalingMode,stepped:cs.stepped,transformValues:cs.transformValues};return cs.names&&(json.names=cs.names),cs.conditions&&cs.conditions.array.length>0&&(json.conditions=cs.conditions.array),cs.sizer&&null!=cs.sizer.seriesName&&(json.size={seriesName:cs.sizer.seriesName,min:cs.sizer.min,max:cs.sizer.max}),json},morpheus.AbstractColorSupplier.fromJSON=function(json){var cs=json.stepped?new morpheus.SteppedColorSupplier:new morpheus.GradientColorSupplier;null==json.scalingMode&&null!=json.type&&(json.scalingMode=json.type),"relative"===json.scalingMode||0===json.scalingMode?json.scalingMode=0:"fixed"===json.scalingMode||1===json.scalingMode?json.scalingMode=1:json.scalingMode=0,cs.setScalingMode(json.scalingMode),null!=json.min&&cs.setMin(json.min),null!=json.max&&cs.setMax(json.max),null!=json.missingColor&&cs.setMissingColor(json.missingColor),morpheus.HeatMapColorScheme.ScalingMode.RELATIVE!==json.scalingMode&&cs.setTransformValues(json.transformValues),json.map&&(json.values=json.map.map(function(item){return item.value}),json.colors=json.map.map(function(item){return item.color}));var fractions=json.fractions;if(json.values){fractions=[];for(var values=json.values,min=Number.MAX_VALUE,max=-Number.MAX_VALUE,i=0;i<values.length;i++){var value=values[i];min=Math.min(min,value),max=Math.max(max,value)}var valueToFraction=d3.scale.linear().domain([min,max]).range([0,1]).clamp(!0);for(i=0;i<values.length;i++)fractions.push(valueToFraction(values[i]));null==json.min&&cs.setMin(min),null==json.max&&cs.setMax(max)}return null!=json.colors&&json.colors.length>0&&cs.setFractions({colors:json.colors,fractions:fractions,names:json.names}),json.size&&(cs.getSizer().setSeriesName(json.size.seriesName),cs.getSizer().setMin(json.size.min),cs.getSizer().setMax(json.size.max)),json.conditions&&_.isArray(json.conditions)&&(json.conditions.forEach(function(condition){var gtf=function(){return!0},ltf=function(){return!0};null==condition.seriesName&&(condition.seriesName=condition.series),null==condition.v1||isNaN(condition.v1)||(gtf="gt"===condition.v1Op?function(val){return val>condition.v1}:function(val){return val>=condition.v1}),null==condition.v2||isNaN(condition.v2)||(ltf="lt"===condition.v2Op?function(val){return val<condition.v2}:function(val){return val<=condition.v2}),condition.accept=function(val){return gtf(val)&&ltf(val)}}),cs.conditions.array=json.conditions),cs},morpheus.AbstractColorSupplier.prototype={getTransformValues:function(){return this.transformValues},setTransformValues:function(transformValues){this.transformValues=transformValues},getSizer:function(){return this.sizer},getConditions:function(){return this.conditions},createInstance:function(){throw"not implemented"},copy:function(){var c=this.createInstance();return c.stepped=this.stepped,c.setFractions({fractions:this.fractions.slice(0),colors:this.colors.slice(0)}),null!=this.names&&(c.names=this.names.slice(0)),this.sizer&&(c.sizer=this.sizer.copy()),this.conditions&&(c.conditions=this.conditions.copy()),c.scalingMode=this.scalingMode,c.min=this.min,c.max=this.max,c.missingColor=this.missingColor,this.scalingMode!==morpheus.HeatMapColorScheme.ScalingMode.RELATIVE&&(c.transformValues=this.transformValues),c},setMissingColor:function(missingColor){this.missingColor=missingColor},getMissingColor:function(){return this.missingColor},getScalingMode:function(){return this.scalingMode},setScalingMode:function(scalingMode){scalingMode!==this.scalingMode&&(scalingMode===morpheus.HeatMapColorScheme.ScalingMode.RELATIVE&&(this.min=0,this.max=1),this.scalingMode=scalingMode)},isStepped:function(){return!1},getColor:function(row,column,value){throw"not implemented"},getColors:function(){return this.colors},getNames:function(){return this.names},getFractions:function(){return this.fractions},getMin:function(){return this.min},getMax:function(){return this.max},setMin:function(min){this.min=min},setMax:function(max){this.max=max},setFractions:function(options){var index=morpheus.Util.indexSort(options.fractions,!0);this.fractions=morpheus.Util.reorderArray(options.fractions,index),this.colors=morpheus.Util.reorderArray(options.colors,index),this.names=options.names?morpheus.Util.reorderArray(options.names,index):null}},morpheus.AbstractComponent=function(){this.lastClip=null;var c=document.createElement("div");c.setAttribute("tabindex","0"),c.style.outline=0,c.style.overflow="hidden",c.style.position="absolute",this.el=c,this.$el=$(c)},morpheus.AbstractComponent.prototype={visible:!0,invalid:!0,prefWidth:void 0,prefHeight:void 0,appendTo:function($el){$(this.el).appendTo($el)},dispose:function(){$(this.el).remove()},getPrefWidth:function(){return this.prefWidth},setInvalid:function(invalid){this.invalid=invalid},setBounds:function(bounds){null!=bounds.left&&this.$el.css("left",bounds.left+"px"),null!=bounds.top&&this.$el.css("top",bounds.top+"px")},paint:function(clip){this.getUnscaledWidth(),this.getUnscaledHeight();this.draw(clip),this.lastClip=clip,this.invalid=!1},repaint:function(){this.lastClip||(this.lastClip={x:0,y:0,width:this.getUnscaledWidth(),height:this.getUnscaledHeight()}),this.paint(this.lastClip)},draw:function(clip){},getPrefHeight:function(){return this.prefHeight},setPrefWidth:function(prefWidth){this.prefWidth=prefWidth},setPrefHeight:function(prefHeight){this.prefHeight=prefHeight},isVisible:function(){return this.visible},setVisible:function(visible){this.visible!==visible&&(this.visible=visible,this.el.style.display=visible?"":"none")},getUnscaledWidth:function(){return this.$el.width()},getUnscaledHeight:function(){return this.$el.height()},getWidth:function(){return this.$el.width()},getHeight:function(){return this.$el.height()}},morpheus.AbstractDendrogram=function(heatMap,tree,positions,project,type){morpheus.AbstractCanvas.call(this,!0),this._overviewHighlightColor="#d8b365",this._searchHighlightColor="#e41a1c",this._selectedNodeColor=type===morpheus.AbstractDendrogram.Type.COLUMN?"#377eb8":"#984ea3",this.tree=tree,this.type=type,this.squishEnabled=!1,this.heatMap=heatMap,this.positions=positions,this.project=project;var $label=$("<span></span>");$label.addClass("label label-info"),$label.css("position","absolute"),this.$label=$label;var $squishedLabel=$("<span></span>");$squishedLabel.addClass("label label-default"),$squishedLabel.css("position","absolute").css("top",18),this.$squishedLabel=$squishedLabel,this.$label=$label,this.cutHeight=this.tree.maxHeight,this.drawLeafNodes=!0,this.lineWidth=.7,this.selectedNodeIds={},this.selectedRootNodeIdToNode={},this.nodeIdToHighlightedPathsToRoot={};var _this=this;this.defaultStroke="rgb(0,0,0)",this.mouseMoveNodes=null;var mouseMove=function(event){if(!morpheus.CanvasUtil.dragging){var position=morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,_this.lastClip.x,_this.lastClip.y);if(_this.isDragHotSpot(position))_this.canvas.style.cursor=_this.getResizeCursor();else{var nodes;if(_this.getNodes)nodes=_this.getNodes(position);else{var node=_this.getNode(position);node&&(nodes=[node])}if(_this.mouseMoveNodes=nodes,null!=nodes){nodes.sort(function(a,b){return a.name<b.name});var tipOptions={event:event};tipOptions[type===morpheus.AbstractDendrogram.Type.COLUMN?"columnNodes":"rowNodes"]=nodes,_this.heatMap.setToolTip(-1,-1,tipOptions),_this.canvas.style.cursor="pointer"}else _this.heatMap.setToolTip(-1,-1),_this.canvas.style.cursor="default"}}};type!==morpheus.AbstractDendrogram.Type.RADIAL&&($(this.canvas).on("contextmenu",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var position=morpheus.CanvasUtil.getMousePosWithScroll(e.target,e,_this.lastClip.x,_this.lastClip.y),selectedNode=_this.getNode(position);return morpheus.Popup.showPopup([{name:"Flip",disabled:null==selectedNode},{name:"Branch Color",disabled:null==selectedNode},{separator:!0},{name:"Annotate..."},{name:"Save"},{separator:!0},{name:"Enrichment..."},{separator:!0},{name:"Squish Singleton Clusters",checked:_this.squishEnabled},{separator:!0},{name:"Delete"}],{x:e.pageX,y:e.pageY},e.target,function(menuItem,item){if("Save"===item)(formBuilder=new morpheus.FormBuilder).append({name:"file_name",type:"text",required:!0}),formBuilder.append({name:"leaf_node_id_field",type:"bootstrap-select",required:!0,options:morpheus.MetadataUtil.getMetadataNames(type===morpheus.AbstractDendrogram.Type.COLUMN?project.getFullDataset().getColumnMetadata():project.getFullDataset().getRowMetadata())}),morpheus.FormBuilder.showOkCancel({title:"Save Dendrogram",content:formBuilder.$form,focus:document.activeElement,okCallback:function(){var fileName=formBuilder.getValue("file_name");""===fileName&&(fileName="dendrogram.txt");var leafNodeIdField=formBuilder.getValue("leaf_node_id_field"),out=[],vector=type===morpheus.AbstractDendrogram.Type.COLUMN?project.getFullDataset().getColumnMetadata().getByName(leafNodeIdField):project.getFullDataset().getRowMetadata().getByName(leafNodeIdField);morpheus.DendrogramUtil.writeNewick(tree.rootNode,out,function(n){return vector.getValue(n.index)});var blob=new Blob([out.join("")],{type:"text/plain;charset=charset=utf-8"});saveAs(blob,fileName,!0)}});else if("Flip"===item){if(null!=selectedNode){for(var isColumns=morpheus.AbstractDendrogram.Type.COLUMN===_this.type,min=selectedNode.minIndex,max=selectedNode.maxIndex,leafNodes=tree.leafNodes,i=min,index=max;i<=max;i++,index--){var n=leafNodes[i];n.index=index,n.maxIndex=index,n.minIndex=index}leafNodes.sort(function(a,b){return a.index<b.index?-1:1});var setIndex=function(n){if(null!=n.children&&n.children.length>0){for(var i=0;i<n.children.length;i++)setIndex(n.children[i]);var sum=0;for(i=0;i<n.children.length;i++)sum+=n.children[i].index;n.index=sum/n.children.length;var maxIndex=-Number.MAX_VALUE,minIndex=Number.MAX_VALUE;for(i=0;i<n.children.length;i++)maxIndex=Math.max(maxIndex,n.children[i].maxIndex),minIndex=Math.min(minIndex,n.children[i].minIndex);n.minIndex=minIndex,n.maxIndex=maxIndex}};setIndex(selectedNode);var currentOrder=[],count=isColumns?heatMap.getProject().getSortedFilteredDataset().getColumnCount():heatMap.getProject().getSortedFilteredDataset().getRowCount();for(i=0;i<count;i++)currentOrder.push(isColumns?project.convertViewColumnIndexToModel(i):project.convertViewRowIndexToModel(i));i=min;for(var j=max;i<j;i++,j--){var tmp=currentOrder[j];currentOrder[j]=currentOrder[i],currentOrder[i]=tmp}var key=new morpheus.SpecifiedModelSortOrder(currentOrder,currentOrder.length,"dendrogram",isColumns);key.setPreservesDendrogram(!0),key.setLockOrder(2),key.setUnlockable(!1),isColumns?heatMap.getProject().setColumnSortKeys([key],!0):heatMap.getProject().setRowSortKeys([key],!0),heatMap.revalidate()}}else if("Branch Color"===item){var formBuilder;if(null!=selectedNode)(formBuilder=new morpheus.FormBuilder).append({name:"color",type:"color",value:selectedNode.color,required:!0,style:"max-width:50px;"}),formBuilder.find("color").on("change",function(){var color=$(this).val();morpheus.DendrogramUtil.dfs(selectedNode,function(n){return n.color=color,!0}),_this.setSelectedNode(null)}),morpheus.FormBuilder.showInModal({title:"Color",close:"Close",html:formBuilder.$form,focus:document.activeElement})}else"Annotate..."===item?morpheus.HeatMap.showTool(new morpheus.AnnotateDendrogramTool(type===morpheus.AbstractDendrogram.Type.COLUMN),_this.heatMap):"Enrichment..."===item?morpheus.HeatMap.showTool(new morpheus.DendrogramEnrichmentTool(type===morpheus.AbstractDendrogram.Type.COLUMN),_this.heatMap):"Squish Singleton Clusters"===item?(_this.squishEnabled=!_this.squishEnabled,_this.squishEnabled||_this.positions.setSquishedIndices(null)):"Delete"===item&&(_this.resetCutHeight(),_this.heatMap.setDendrogram(null,type===morpheus.AbstractDendrogram.Type.COLUMN))}),!1}),$(this.canvas).on("mousemove",_.throttle(mouseMove,100)).on("mouseout",_.throttle(function(e){morpheus.CanvasUtil.dragging||(_this.mouseMoveNodes=null,_this.canvas.style.cursor="default")},100)).on("mouseenter",_.throttle(mouseMove,100)));var dragStartScaledCutHeight=0;this.cutTreeHotSpot=!1,type!==morpheus.AbstractDendrogram.Type.RADIAL&&(this.hammer=morpheus.Util.hammer(this.canvas,["pan","tap"]).on("tap",this.tap=function(event){if(!morpheus.CanvasUtil.dragging){var position=morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,_this.lastClip.x,_this.lastClip.y);if(_this.cutTreeHotSpot=_this.isDragHotSpot(position),_this.cutTreeHotSpot)return;var node=_this.getNode(position);null!=node&&void 0===node.parent&&(node=null);var commandKey=morpheus.Util.IS_MAC?event.srcEvent.metaKey:event.srcEvent.ctrlKey;_this.setSelectedNode(node,event.srcEvent.shiftKey||commandKey)}}).on("panend",this.panend=function(event){morpheus.CanvasUtil.dragging=!1,_this.canvas.style.cursor="default",_this.cutTreeHotSpot=!0}).on("panstart",this.panstart=function(event){var position=morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,_this.lastClip.x,_this.lastClip.y,!0);_this.cutTreeHotSpot=_this.isDragHotSpot(position),_this.cutTreeHotSpot&&(morpheus.CanvasUtil.dragging=!0,_this.canvas.style.cursor=_this.getResizeCursor(),dragStartScaledCutHeight=_this.scale(_this.cutHeight))}).on("panmove",this.panmove=function(event){if(_this.cutTreeHotSpot){var cutHeight;if(_this.type===morpheus.AbstractDendrogram.Type.COLUMN){var delta=event.deltaY;cutHeight=Math.max(0,Math.min(_this.tree.maxHeight,_this.scale.invert(dragStartScaledCutHeight+delta)))}else if(_this.type===morpheus.AbstractDendrogram.Type.ROW){delta=event.deltaX;cutHeight=Math.max(0,Math.min(_this.tree.maxHeight,_this.scale.invert(dragStartScaledCutHeight+delta)))}else{var point=morpheus.CanvasUtil.getMousePos(event.target,event);point.x=_this.radius-point.x,point.y=_this.radius-point.y;var radius=Math.sqrt(point.x*point.x+point.y*point.y);cutHeight=radius<=4?_this.tree.maxHeight:Math.max(0,Math.min(_this.tree.maxHeight,_this.scale.invert(radius)))}cutHeight>=_this.tree.maxHeight?_this.resetCutHeight():_this.setCutHeight(cutHeight),event.preventDefault()}}))},morpheus.AbstractDendrogram.Type={COLUMN:0,ROW:1,RADIAL:2},morpheus.AbstractDendrogram.prototype={setSelectedNode:function(node,add){var viewIndices,_this=this,selectionModel=this.type===morpheus.AbstractDendrogram.Type.COLUMN?this.project.getColumnSelectionModel():this.project.getRowSelectionModel();if(null==node)_this.selectedNodeIds={},_this.selectedRootNodeIdToNode={},viewIndices=new morpheus.Set;else if(add?viewIndices=selectionModel.getViewIndices():(viewIndices=new morpheus.Set,_this.selectedNodeIds={},_this.selectedRootNodeIdToNode={}),null!=node){if(void 0===node.children){var contains=_this.nodeIdToHighlightedPathsToRoot[node.id];add||(_this.nodeIdToHighlightedPathsToRoot={}),contains?delete _this.nodeIdToHighlightedPathsToRoot[node.id]:_this.nodeIdToHighlightedPathsToRoot[node.id]=node}else _this.selectedRootNodeIdToNode[node.id]=node,morpheus.DendrogramUtil.dfs(node,function(d){return _this.selectedNodeIds[d.id]=!0,!0});for(var i=node.minIndex;i<=node.maxIndex;i++)viewIndices.add(i)}_this.trigger("nodeSelectionChanged",_this.selectedRootNodeIdToNode),selectionModel.setViewIndices(viewIndices,!0),_this.repaint()},getPathStroke:function(node){return this.selectedNodeIds[node.id]?this._selectedNodeColor:void 0!==node.color?node.color:this.defaultStroke},getNodeFill:function(node){return this.selectedRootNodeIdToNode[node.id]?this._selectedNodeColor:node.search?this._searchHighlightColor:void 0!==node.info?this._overviewHighlightColor:void 0},resetCutHeight:function(){this.positions.setSquishedIndices(null),this.type===morpheus.AbstractDendrogram.Type.COLUMN?this.project.setGroupColumns([],!0):this.project.setGroupRows([],!0),this.$label.text(""),this.$squishedLabel.text("");var dataset=this.project.getSortedFilteredDataset(),clusterIdVector=this.type===morpheus.AbstractDendrogram.Type.COLUMN?dataset.getColumnMetadata().getByName("dendrogram_cut"):dataset.getRowMetadata().getByName("dendrogram_cut");if(clusterIdVector)for(var i=0,size=clusterIdVector.size();i<size;i++)clusterIdVector.setValue(i,NaN)},setCutHeight:function(height){this.cutHeight=height;for(var squishedIndices={},clusterNumber=0,nsquished=0,squishEnabled=this.squishEnabled,roots=morpheus.DendrogramUtil.cutAtHeight(this.tree.rootNode,this.cutHeight),dataset=this.project.getSortedFilteredDataset(),clusterIdVector=this.type===morpheus.AbstractDendrogram.Type.COLUMN?dataset.getColumnMetadata().add("dendrogram_cut"):dataset.getRowMetadata().add("dendrogram_cut"),i=0,nroots=roots.length;i<nroots;i++){var clusterId,root=roots[i],minChild=morpheus.DendrogramUtil.getDeepestChild(root,!0),maxChild=morpheus.DendrogramUtil.getDeepestChild(root,!1);squishEnabled&&minChild.index===maxChild.index?(squishedIndices[minChild.index]=!0,clusterId=-2,nsquished++):clusterId=++clusterNumber;for(var j=minChild.index;j<=maxChild.index;j++)clusterIdVector.setValue(j,clusterId)}if(this.$label.text(clusterNumber+" cluster"+morpheus.Util.s(clusterNumber)),nsquished>0?this.$squishedLabel.text(nsquished+" squished"):this.$squishedLabel.text(""),squishEnabled&&this.positions.setSquishedIndices(squishedIndices),-1===this.heatMap.getTrackIndex(clusterIdVector.getName(),this.type===morpheus.AbstractDendrogram.Type.COLUMN)){this.heatMap.addTrack(clusterIdVector.getName(),this.type===morpheus.AbstractDendrogram.Type.COLUMN,{discrete:!0,discreteAutoDetermined:!0,display:["color"]})}this.type===morpheus.AbstractDendrogram.Type.COLUMN?this.project.setGroupColumns([new morpheus.SortKey(clusterIdVector.getName(),morpheus.SortKey.SortOrder.UNSORTED)],!0):this.project.setGroupRows([new morpheus.SortKey(clusterIdVector.getName(),morpheus.SortKey.SortOrder.UNSORTED)],!0)},dispose:function(){morpheus.AbstractCanvas.prototype.dispose.call(this),this.$label.remove(),this.$squishedLabel.remove(),this.hammer.off("panend",this.panend).off("panstart",this.panstart).off("panmove",this.panmove).off("tap",this.tap),this.hammer.destroy(),this.$label=null,this.$squishedLabel=null},isCut:function(){return this.cutHeight<this.tree.maxHeight},getMinIndex:function(){return 0},getMaxIndex:function(){return this.positions.getLength()-1},getNode:function(p){if(this.lastNode){var xy=this.toPix(this.lastNode);if(Math.abs(xy[0]-p.x)<4&&Math.abs(xy[1]-p.y)<4)return this.lastNode}return this.lastNode=this._getNode(p),this.lastNode},_getNode:function(p){var _this=this,hit=null;try{morpheus.DendrogramUtil.dfs(this.tree.rootNode,function(node){var xy=_this.toPix(node);if(Math.abs(xy[0]-p.x)<4&&Math.abs(xy[1]-p.y)<4)throw hit=node,"break";return null===hit})}catch(x){}return hit},getResizeCursor:function(){return this.type===morpheus.AbstractDendrogram.Type.COLUMN?"ns-resize":this.type===morpheus.AbstractDendrogram.Type.ROW?"ew-resize":"nesw-resize"},isDragHotSpot:function(p){return!1},preDraw:function(context,clip){},postDraw:function(context,clip){},prePaint:function(clip,context){this.scale=this.createScale();var min=this.getMinIndex(clip),max=this.getMaxIndex(clip);min===this.lastMinIndex&&max===this.lastMinIndex||(this.lastMinIndex=min,this.lastMaxIndex=max),this.invalid=!0},draw:function(clip,context){context.translate(-clip.x,-clip.y),context.strokeStyle="black",context.fillStyle="black",this.scale=this.createScale();var min=this.lastMinIndex,max=this.lastMaxIndex;context.lineWidth=this.lineWidth,this.preDraw(context,clip),context.strokeStyle=this.defaultStroke,context.fillStyle="rgba(166,206,227,0.5)",this.drawDFS(context,this.tree.rootNode,min,max,0),context.strokeStyle="black",context.fillStyle="black",this.postDraw(context,clip)},drawCutSlider:function(){throw new Error},postPaint:function(clip,context){context.strokeStyle="black",this.paintMouseOver(clip,context),this.drawCutSlider(clip,context)},getNodeRadius:function(node){return 4},drawNode:function(context,node){},drawDFS:function(context,node,minIndex,maxIndex){if(this.type===morpheus.AbstractDendrogram.Type.RADIAL||!(node.maxIndex<minIndex||node.minIndex>maxIndex)){var nodeFill=this.getNodeFill(node);void 0!==nodeFill&&(context.fillStyle=nodeFill,this.drawNode(context,node)),context.strokeStyle=this.getPathStroke(node);var children=node.children;if(void 0!==children){this.drawNodePath(context,node,minIndex,maxIndex);for(var i=0,nchildren=children.length;i<nchildren;i++)this.drawDFS(context,children[i],minIndex,maxIndex)}}}},morpheus.Util.extend(morpheus.AbstractDendrogram,morpheus.AbstractCanvas),morpheus.Util.extend(morpheus.AbstractDendrogram,morpheus.Events),morpheus.ActionManager=function(){this.actionNameToAction=new morpheus.Map,this.actions=[],this.add({ellipsis:!0,name:"Sort/Group",cb:function(options){new morpheus.SortDialog(options.heatMap.getProject())},icon:"fa fa-sort-alpha-asc"});var $findModal,$search,$filterModal=null,windowOpen=function(url){morpheus.Util.isNode()||window.open(url)};this.add({name:"Filter",ellipsis:!0,cb:function(options){if(null==$filterModal){var filterModal=[],filterLabelId=_.uniqueId("morpheus");filterModal.push('<div class="modal" tabindex="1" role="dialog" aria-labelledby="'+filterLabelId+'">'),filterModal.push('<div class="modal-dialog" role="document">'),filterModal.push('<div class="modal-content">'),filterModal.push('<div class="modal-header">'),filterModal.push('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'),filterModal.push('<h4 class="modal-title" id="'+filterLabelId+'">Filter</h4>'),filterModal.push("</div>"),filterModal.push('<div class="modal-body"></div>'),filterModal.push('<div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div>'),filterModal.push("</div>"),filterModal.push("</div>"),filterModal.push("</div>"),($filterModal=$(filterModal.join(""))).on("mousewheel",function(e){e.stopPropagation()});var $filter=$('<div style="padding-bottom:30px;"></div>');$filter.appendTo($filterModal.find(".modal-body"));var filterHtml=[];filterHtml.push('<div class="radio"><label><input type="radio" name="rowsOrColumns" value="rows" checked>Rows</label></div> '),filterHtml.push('<div class="radio"><label><input type="radio" name="rowsOrColumns" value="columns">Columns</label></div>');var $filterChooser=$(filterHtml.join(""));$filterChooser.appendTo($filter);var columnFilterUI=new morpheus.FilterUI(options.heatMap.getProject(),!0),rowFilterUI=new morpheus.FilterUI(options.heatMap.getProject(),!1);rowFilterUI.$div.appendTo($filter),columnFilterUI.$div.appendTo($filter),columnFilterUI.$div.css("display","none");var $filterRadio=$filterChooser.find("[name=rowsOrColumns]");$filterRadio.on("change",function(e){"columns"===$filterRadio.filter(":checked").val()?(columnFilterUI.$div.show(),rowFilterUI.$div.hide()):(columnFilterUI.$div.hide(),rowFilterUI.$div.show()),e.preventDefault()}),$filterModal.appendTo(options.heatMap.$content),$filterModal.on("hidden.bs.modal",function(){options.heatMap.focus()})}$filterModal.modal("show")},icon:"fa fa-filter"}),this.add({name:"Options",ellipsis:!0,cb:function(options){options.heatMap.showOptions()},icon:"fa fa-cog"}),this.add({which:[191],commandKey:!0,global:!0,name:"Toggle Search",cb:function(options){options.heatMap.getToolbar().toggleSearch()}}),this.add({name:"Copy Image",icon:"fa fa-clipboard",cb:function(options){var bounds=options.heatMap.getTotalSize(),height=bounds.height,width=bounds.width,canvas=$("<canvas></canvas>")[0],backingScale=morpheus.CanvasUtil.BACKING_SCALE;canvas.height=backingScale*height,canvas.style.height=height+"px",canvas.width=backingScale*width,canvas.style.width=width+"px";var context=canvas.getContext("2d");morpheus.CanvasUtil.resetTransform(context),options.heatMap.snapshot(context);var url=canvas.toDataURL();morpheus.Util.setClipboardData([{format:"text/html",data:'<img src="'+url+'">'}],!0)}}),this.add({name:"Close Tab",cb:function(options){options.heatMap.getTabManager().remove(options.heatMap.tabId)}}),this.add({name:"Rename Tab",ellipsis:!0,cb:function(options){options.heatMap.getTabManager().rename(options.heatMap.tabId)}}),this.add({which:[88],commandKey:!0,name:"New Heat Map",accept:function(options){return!options.isInputField||""===window.getSelection().toString()},cb:function(options){morpheus.HeatMap.showTool(new morpheus.NewHeatMapTool,options.heatMap)}}),this.add({which:[67],commandKey:!0,name:"Copy"}),this.add({which:[86],commandKey:!0,name:"Paste Dataset"}),this.add({global:!0,name:"Open",ellipsis:!0,cb:function(options){morpheus.HeatMap.showTool(new morpheus.OpenFileTool,options.heatMap)},which:[79],commandKey:!0,icon:"fa fa-folder-open-o"}),this.add({ellipsis:!0,name:"Save Image",gui:function(){return new morpheus.SaveImageTool},cb:function(options){morpheus.HeatMap.showTool(this.gui(),options.heatMap)},which:[83],commandKey:!0,global:!0,icon:"fa fa-file-image-o"}),this.add({ellipsis:!0,name:"Save Dataset",gui:function(){return new morpheus.SaveDatasetTool},cb:function(options){morpheus.HeatMap.showTool(this.gui(),options.heatMap)},icon:"fa fa-floppy-o"}),this.add({ellipsis:!0,name:"Save Session",gui:function(){return new morpheus.SaveSessionTool},cb:function(options){morpheus.HeatMap.showTool(this.gui(),options.heatMap)},icon:"fa fa-anchor"}),"undefined"!=typeof echarts&&this.add({name:"Chart",cb:function(options){new morpheus.ChartTool({project:options.heatMap.getProject(),heatmap:options.heatMap,getVisibleTrackNames:_.bind(options.heatMap.getVisibleTrackNames,options.heatMap)})},icon:"fa fa-line-chart"}),this.add({name:"Zoom In",cb:function(options){options.heatMap.zoom(!0)},which:[107,61,187]}),this.add({name:"Zoom Out",cb:function(options){options.heatMap.zoom(!1)},which:[173,189,109]}),this.add({name:"Fit To Window",cb:function(options){options.heatMap.fitToWindow({fitRows:!0,fitColumns:!0,repaint:!0})},which:[48],commandKey:!0,icon:"fa fa-compress"}),this.add({name:"Fit Columns To Window",cb:function(options){options.heatMap.fitToWindow({fitRows:!1,fitColumns:!0,repaint:!0})}}),this.add({name:"Fit Rows To Window",cb:function(options){options.heatMap.fitToWindow({fitRows:!0,fitColumns:!1,repaint:!0})}}),this.add({name:"100%",cb:function(options){options.heatMap.resetZoom()},button:"100%",which:[48],commandKey:!0,shiftKey:!0}),this.add({which:[35],name:"Go To End",cb:function(options){options.heatMap.scrollLeft(options.heatMap.heatmap.getPreferredSize().width),options.heatMap.scrollTop(options.heatMap.heatmap.getPreferredSize().height)}}),this.add({which:[36],name:"Go To Start",cb:function(options){options.heatMap.scrollLeft(0),options.heatMap.scrollTop(0)}}),this.add({which:[34],commandKey:!0,name:"Go To Bottom",cb:function(options){options.heatMap.scrollTop(options.heatMap.heatmap.getPreferredSize().height)}}),this.add({which:[34],commandKey:!1,name:"Scroll Page Down",cb:function(options){var pos=options.heatMap.scrollTop();options.heatMap.scrollTop(pos+options.heatMap.heatmap.getUnscaledHeight()-2)}}),this.add({which:[33],commandKey:!0,name:"Go To Top",cb:function(options){options.heatMap.scrollTop(0)}}),this.add({which:[33],commandKey:!1,name:"Scroll Page Up",cb:function(options){var pos=options.heatMap.scrollTop();options.heatMap.scrollTop(pos-options.heatMap.heatmap.getUnscaledHeight()+2)}}),this.add({which:[38],commandKey:!0,name:"Zoom Out Rows",cb:function(options){options.heatMap.zoom(!1,{columns:!1,rows:!0})}}),this.add({which:[38],commandKey:!1,name:"Scroll Up",cb:function(options){options.heatMap.scrollTop(options.heatMap.scrollTop()-8)}}),this.add({which:[40],commandKey:!0,name:"Zoom In Rows",cb:function(options){options.heatMap.zoom(!0,{columns:!1,rows:!0})}}),this.add({which:[40],commandKey:!1,name:"Scroll Down",cb:function(options){options.heatMap.scrollTop(options.heatMap.scrollTop()+8)}}),this.add({which:[37],commandKey:!0,name:"Zoom Out Columns",cb:function(options){options.heatMap.zoom(!1,{columns:!0,rows:!1})}}),this.add({which:[37],commandKey:!1,name:"Scroll Left",cb:function(options){options.heatMap.scrollLeft(options.heatMap.scrollLeft()-8)}}),this.add({which:[39],commandKey:!0,name:"Zoom In Columns",cb:function(options){options.heatMap.zoom(!0,{columns:!0,rows:!1})}}),this.add({which:[39],commandKey:!1,name:"Scroll Right",cb:function(options){options.heatMap.scrollLeft(options.heatMap.scrollLeft()+8)}}),this.add({name:"Tutorial",cb:function(){windowOpen("https://software.broadinstitute.org/morpheus/tutorial.html")}}),this.add({icon:"fa fa-code",name:"Source Code",cb:function(){windowOpen("https://github.com/cmap/morpheus.js")}}),this.add({which:[65],ellipsis:!0,shiftKey:!0,commandKey:!0,name:"Find Action",cb:function(options){if(null==$findModal){var findModal=[],id=_.uniqueId("morpheus");findModal.push('<div class="modal" tabindex="1" role="dialog" aria-labelledby="'+id+'">'),findModal.push('<div class="modal-dialog" role="document">'),findModal.push('<div class="modal-content">'),findModal.push('<div class="modal-header">'),findModal.push('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'),findModal.push('<h4 class="modal-title" id="'+id+'">Enter action</h4>'),findModal.push("</div>"),findModal.push('<div class="modal-body ui-front"><input class="form-control input-sm"></div>'),findModal.push("</div>"),findModal.push("</div>"),findModal.push("</div>"),($findModal=$(findModal.join(""))).appendTo(options.heatMap.$content);var allActions=options.heatMap.getActionManager().getActions();($search=$findModal.find("input")).on("keyup",function(e){if(13===e.which){var text=$search.val().trim();if(""!==text)_this.getAction(text)&&($findModal.modal("hide"),_this.execute(text,{event:e}))}}),morpheus.Util.autosuggest({$el:$search,multi:!1,suggestWhenEmpty:!1,filter:function(tokens,response){for(var token=tokens[0].trim(),matches=[],replaceRegex=new RegExp("("+morpheus.Util.escapeRegex(token)+")","i"),i=0;i<allActions.length;i++)if(allActions[i].cb){var name=allActions[i].name;replaceRegex.test(name)&&matches.push({clear:!0,value:name,label:'<span style="margin-left: 10px">'+name.replace(replaceRegex,"<b>$1</b>")+"</span>"})}response(matches)},select:function(){setTimeout(function(){var text=$search.val().trim();""!==text&&(_this.getAction(text)&&($findModal.modal("hide"),_this.execute(text)))},20)}}),$findModal.on("hidden.bs.modal",function(){options.heatMap.focus()})}$findModal.modal("show"),$search.focus()}}),this.add({name:"Keyboard Shortcuts",cb:function(options){new morpheus.HeatMapKeyListener(options.heatMap).showKeyMapReference()}}),this.add({name:"Configuration",cb:function(){windowOpen("https://software.broadinstitute.org/morpheus/configuration.html")}}),this.add({name:"Contact",icon:"fa fa-envelope-o",cb:function(options){morpheus.FormBuilder.showInModal({title:"Contact",html:"Please email us at morpheus@broadinstitute.org",focus:options.heatMap.getFocusEl()})}}),this.add({which:[65],commandKey:!0,name:"Select All",accept:function(options){var active=options.heatMap.getActiveComponent();return"rowTrack"===active||"columnTrack"===active},cb:function(options){for(var active=options.heatMap.getActiveComponent(),selectionModel="rowTrack"===active?options.heatMap.getProject().getRowSelectionModel():options.heatMap.getProject().getColumnSelectionModel(),count="rowTrack"===active?options.heatMap.getProject().getSortedFilteredDataset().getRowCount():options.heatMap.getProject().getSortedFilteredDataset().getColumnCount(),indices=new morpheus.Set,i=0;i<count;i++)indices.add(i);selectionModel.setViewIndices(indices,!0)}});var invertAction=function(options,isColumns){for(var model=isColumns?options.heatMap.getProject().getColumnSelectionModel():options.heatMap.getProject().getRowSelectionModel(),viewIndices=model.getViewIndices(),inverse=new morpheus.Set,n=n=isColumns?options.heatMap.getProject().getSortedFilteredDataset().getColumnCount():options.heatMap.getProject().getSortedFilteredDataset().getRowCount(),i=0;i<n;i++)viewIndices.has(i)||inverse.add(i);model.setViewIndices(inverse,!0)};this.add({name:"Invert Selected Rows",cb:function(options){invertAction(options,!1)}}),this.add({name:"Invert Selected Columns",cb:function(options){invertAction(options,!0)}});var clearAction=function(options,isColumns){(isColumns?options.heatMap.getProject().getColumnSelectionModel():options.heatMap.getProject().getRowSelectionModel()).setViewIndices(new morpheus.Set,!0)};this.add({name:"Clear Selected Rows",cb:function(options){clearAction(options,!1)}}),this.add({name:"Clear Selected Columns",cb:function(options){clearAction(options,!0)}});var moveToTop=function(options,isColumns){var project=options.heatMap.getProject(),viewIndices=(isColumns?project.getColumnSelectionModel():project.getRowSelectionModel()).getViewIndices().values();if(0!==viewIndices.length){viewIndices.sort(function(a,b){return a===b?0:a<b?-1:1});var converter=isColumns?project.convertViewColumnIndexToModel:project.convertViewRowIndexToModel;converter=_.bind(converter,project);for(var modelIndices=[],i=0,n=viewIndices.length;i<n;i++)modelIndices.push(converter(viewIndices[i]));var sortKey=new morpheus.MatchesOnTopSortKey(project,modelIndices,"selection on top",isColumns);sortKey.setLockOrder(1),sortKey.setUnlockable(!1),isColumns?project.setColumnSortKeys(morpheus.SortKey.keepExistingSortKeys([sortKey],project.getColumnSortKeys().filter(function(key){return!(key instanceof morpheus.MatchesOnTopSortKey&&key.toString()===sortKey.toString())})),!0):project.setRowSortKeys(morpheus.SortKey.keepExistingSortKeys([sortKey],project.getRowSortKeys().filter(function(key){return!(key instanceof morpheus.MatchesOnTopSortKey&&key.toString()===sortKey.toString())})),!0)}};this.add({name:"Move Selected Rows To Top",cb:function(options){moveToTop(options,!1)}}),this.add({name:"Move Selected Columns To Top",cb:function(options){moveToTop(options,!0)}});var selectAll=function(options,isColumns){for(var project=options.heatMap.getProject(),selectionModel=isColumns?project.getColumnSelectionModel():project.getRowSelectionModel(),count=isColumns?project.getSortedFilteredDataset().getColumnCount():project.getSortedFilteredDataset().getRowCount(),indices=new morpheus.Set,i=0;i<count;i++)indices.add(i);selectionModel.setViewIndices(indices,!0)};this.add({name:"Select All Rows",cb:function(options){selectAll(options,!1)}}),this.add({name:"Select All Columns",cb:function(options){selectAll(options,!0)}});var copySelection=function(options,isColumns){var v,project=options.heatMap.getProject(),dataset=project.getSortedFilteredDataset(),activeTrackName=options.heatMap.getSelectedTrackName(isColumns);v=null==activeTrackName?isColumns?dataset.getColumnMetadata().get(0):dataset.getRowMetadata().get(0):isColumns?dataset.getColumnMetadata().getByName(activeTrackName):dataset.getRowMetadata().getByName(activeTrackName);var selectionModel=isColumns?project.getColumnSelectionModel():project.getRowSelectionModel(),text=[],toStringFunction=morpheus.VectorTrack.vectorToString(v);selectionModel.getViewIndices().forEach(function(index){text.push(toStringFunction(v.getValue(index)))}),morpheus.Util.setClipboardData([{format:"text/plain",data:text.join("\n")}])};this.add({name:"Copy Selected Rows",cb:function(options){copySelection(options,!1)}}),this.add({name:"Copy Selected Columns",cb:function(options){copySelection(options,!0)}});var annotateSelection=function(options,isColumns){var project=options.heatMap.getProject(),selectionModel=isColumns?project.getColumnSelectionModel():project.getRowSelectionModel();if(0!==selectionModel.count()){var formBuilder=new morpheus.FormBuilder;formBuilder.append({name:"annotation_name",type:"text",required:!0}),formBuilder.append({name:"annotation_value",type:"text",required:!0}),morpheus.FormBuilder.showOkCancel({title:"Annotate",content:formBuilder.$form,focus:options.heatMap.getFocusEl(),okCallback:function(){var value=formBuilder.getValue("annotation_value"),annotationName=formBuilder.getValue("annotation_name"),dataset=project.getSortedFilteredDataset(),fullDataset=project.getFullDataset();isColumns&&(dataset=new morpheus.TransposedDatasetView(dataset),fullDataset=new morpheus.TransposedDatasetView(fullDataset));var existingVector=fullDataset.getRowMetadata().getByName(annotationName),v=dataset.getRowMetadata().add(annotationName);selectionModel.getViewIndices().forEach(function(index){v.setValue(index,value)}),morpheus.VectorUtil.maybeConvertStringToNumber(v),project.trigger("trackChanged",{vectors:[v],display:null!=existingVector?[]:[morpheus.VectorTrack.RENDER.TEXT],columns:isColumns})}})}else morpheus.FormBuilder.showMessageModal({title:"Annotate Selection",html:"No "+(isColumns?"columns":"rows")+" selected.",focus:options.heatMap.getFocusEl()})};this.add({ellipsis:!0,name:"Annotate Selected Rows",cb:function(options){annotateSelection(options,!1)}}),this.add({ellipsis:!0,name:"Annotate Selected Columns",cb:function(options){annotateSelection(options,!0)}}),this.add({name:"Copy Selected Dataset",cb:function(options){var dataset=options.heatMap.getProject().getSelectedDataset({emptyToAll:!1}),columnMetadata=dataset.getColumnMetadata(),rowMetadata=dataset.getRowMetadata(),visibleColumnFields=options.heatMap.getVisibleTrackNames(!0),columnFieldIndices=[];_.each(visibleColumnFields,function(name){var index=morpheus.MetadataUtil.indexOf(columnMetadata,name);-1!==index&&columnFieldIndices.push(index)}),columnMetadata=new morpheus.MetadataModelColumnView(columnMetadata,columnFieldIndices);rowMetadata=dataset.getRowMetadata();var visibleRowFields=options.heatMap.getVisibleTrackNames(!1),rowFieldIndices=[];_.each(visibleRowFields,function(name){var index=morpheus.MetadataUtil.indexOf(rowMetadata,name);-1!==index&&rowFieldIndices.push(index)}),rowMetadata=new morpheus.MetadataModelColumnView(rowMetadata,rowFieldIndices);var text=(new morpheus.GctWriter).write(dataset);morpheus.Util.setClipboardData([{format:"text/plain",data:text}])}});var _this=this;[new morpheus.HClusterTool,new morpheus.KMeansTool,new morpheus.MarkerSelection,new morpheus.NearestNeighbors,new morpheus.AdjustDataTool,new morpheus.CollapseDatasetTool,new morpheus.CreateAnnotation,new morpheus.SimilarityMatrixTool,new morpheus.TransposeTool,new morpheus.TsneTool,new morpheus.DevAPI].forEach(function(tool){_this.add({ellipsis:!0,name:tool.toString(),gui:function(){return tool},cb:function(options){morpheus.HeatMap.showTool(tool,options.heatMap)}})}),this.add({name:"Edit Fonts",ellipse:!0,cb:function(options){var trackInfo=options.heatMap.getLastSelectedTrackInfo(),project=options.heatMap.getProject(),model=trackInfo.isColumns?project.getColumnFontModel():project.getRowFontModel(),chooser=new morpheus.FontChooser({fontModel:model,track:options.heatMap.getTrack(trackInfo.name,trackInfo.isColumns),heatMap:options.heatMap});morpheus.FormBuilder.showInModal({title:"Edit Fonts",html:chooser.$div,close:"Close",focus:options.heatMap.getFocusEl()})}})},morpheus.ActionManager.prototype={getActions:function(){return this.actions},getAction:function(name){return this.actionNameToAction.get(name)},execute:function(name,args){var action=this.getAction(name);null==args&&(args={}),args.heatMap=this.heatMap,action.cb(args),morpheus.Util.trackEvent({eventCategory:"Tool",eventAction:name})},add:function(action){this.actions.push(action),this.actionNameToAction.set(action.name,action)}},morpheus.CanvasUtil=function(){},morpheus.CanvasUtil.dragging=!1,morpheus.CanvasUtil.FONT_NAME='"Helvetica Neue",Helvetica,Arial,sans-serif',morpheus.CanvasUtil.FONT_COLOR="rgb(0, 0, 0)",morpheus.CanvasUtil.getFontFamily=function(context){return"undefined"!=typeof C2S&&context instanceof C2S||"undefined"!=typeof canvas2pdf&&context instanceof canvas2pdf.PdfContext?"Helvetica":morpheus.CanvasUtil.FONT_NAME},morpheus.CanvasUtil.getPreferredSize=function(c){var size=c.getPreferredSize(),prefWidth=c.getPrefWidth(),prefHeight=c.getPrefHeight();return void 0!==prefWidth&&(size.widthSet=!0,size.width=prefWidth),void 0!==prefHeight&&(size.heightSet=!0,size.height=prefHeight),size},morpheus.CanvasUtil.BACKING_SCALE=1,"undefined"!=typeof window&&"devicePixelRatio"in window&&window.devicePixelRatio>1&&(morpheus.CanvasUtil.BACKING_SCALE=window.devicePixelRatio),morpheus.CanvasUtil.setBounds=function(canvas,bounds){var backingScale=morpheus.CanvasUtil.BACKING_SCALE;null!=bounds.height&&(canvas.height=bounds.height*backingScale,canvas.style.height=bounds.height+"px"),null!=bounds.width&&(canvas.width=bounds.width*backingScale,canvas.style.width=bounds.width+"px"),null!=bounds.left&&(canvas.style.left=bounds.left+"px"),null!=bounds.top&&(canvas.style.top=bounds.top+"px")},morpheus.CanvasUtil.drawShape=function(context,shape,x,y,size2,isFill){size2<0||(context.beginPath(),"circle-minus"===shape?(context.arc(x,y,size2,0,2*Math.PI,!1),context.moveTo(x-size2,y),context.lineTo(x+size2,y)):"circle"===shape?context.arc(x,y,size2,0,2*Math.PI,!1):"square"===shape?context.rect(x-size2,y-size2,2*size2,2*size2):"plus"===shape?(context.moveTo(x,y-size2),context.lineTo(x,y+size2),context.moveTo(x-size2,y),context.lineTo(x+size2,y)):"x"===shape?(context.moveTo(x-size2,y-size2),context.lineTo(x+size2,y+size2),context.moveTo(x+size2,y-size2),context.lineTo(x-size2,y+size2)):"asterisk"===shape?(context.moveTo(x-size2,y-size2),context.lineTo(x+size2,y+size2),context.moveTo(x+size2,y-size2),context.lineTo(x-size2,y+size2),context.moveTo(x,y-size2),context.lineTo(x,y+size2)):"diamond"===shape?(context.moveTo(x,y-size2),context.lineTo(x+size2,y),context.lineTo(x,y+size2),context.lineTo(x-size2,y),context.lineTo(x,y-size2)):"triangle-up"===shape?(context.moveTo(x,y-size2),context.lineTo(x+size2,y+size2),context.lineTo(x-size2,y+size2),context.lineTo(x,y-size2)):"triangle-down"===shape?(context.moveTo(x,y+size2),context.lineTo(x-size2,y-size2),context.lineTo(x+size2,y-size2),context.lineTo(x,y+size2)):"triangle-left"===shape?(context.moveTo(x-size2,y),context.lineTo(x+size2,y-size2),context.lineTo(x+size2,y+size2),context.lineTo(x-size2,y)):"triangle-right"===shape&&(context.moveTo(x+size2,y),context.lineTo(x-size2,y+size2),context.lineTo(x-size2,y-size2),context.lineTo(x+size2,y)),isFill?context.fill():context.stroke())},morpheus.CanvasUtil.drawLine=function(context,x1,y1,x2,y2){context.beginPath(),context.moveTo(x1,y1),context.lineTo(x2,y2),context.stroke()},morpheus.CanvasUtil.resetTransform=function(context){context.setTransform(1,0,0,1,0,0),1!==morpheus.CanvasUtil.BACKING_SCALE&&context.scale(morpheus.CanvasUtil.BACKING_SCALE,morpheus.CanvasUtil.BACKING_SCALE)},morpheus.CanvasUtil.bezierCurveTo=function(context,start,end){var m1=(start[1]+end[1])/2;context.beginPath(),context.moveTo(start[0],start[1]),context.bezierCurveTo(start[0],m1,end[0],m1,end[0],end[1]),context.stroke()},morpheus.CanvasUtil.createCanvas=function(){var $c=$("<canvas></canvas>");return $c.attr("tabindex","0"),$c.css({cursor:"default",outline:0,overflow:"hidden",position:"absolute","z-index":1}),$c[0]},morpheus.CanvasUtil.getHeaderStringWidth=function(context,s){return context.font="14px "+morpheus.CanvasUtil.getFontFamily(context),context.measureText(s).width+18},morpheus.CanvasUtil.forceSubPixelRendering=function(context){context.getImageData(0,0,1,1)},morpheus.CanvasUtil.getVectorStringWidth=function(context,vector,positions,end){if(positions.getSize()<6)return 0;var fontSize=Math.min(morpheus.VectorTrack.MAX_FONT_SIZE,positions.getSize()-2);if(fontSize<=0)return 0;context.font=fontSize+"px "+morpheus.CanvasUtil.getFontFamily(context);for(var toString=morpheus.VectorTrack.vectorToString(vector),maxWidth=0,n=end<=0?vector.size():Math.min(end,vector.size()),i=0;i<n;i++){var value=vector.getValue(i);if(null!=value&&""!=value){value=toString(value);var width=context.measureText(value).width;width>maxWidth&&(maxWidth=width)}}return 0===maxWidth?maxWidth:maxWidth+2},morpheus.CanvasUtil.clipString=function(context,string,availTextWidth){if(context.measureText(string).width<=availTextWidth)return string;if((availTextWidth-=context.measureText("...").width)<=0)return"...";for(var width=0,nChars=0,stringLength=string.length;nChars<stringLength;nChars++)if((width+=context.measureText(string[nChars]).width)>availTextWidth){string=string.substring(0,nChars);break}return string+"..."},morpheus.CanvasUtil.toSVG=function(drawable,file){var totalSize={width:drawable.getWidth(),height:drawable.getHeight()},context=new C2S(totalSize.width,totalSize.height);context.save(),drawable.draw({x:0,y:0,width:totalSize.width,height:totalSize.height},context),context.restore();var svg=context.getSerializedSvg(),blob=new Blob([svg],{type:"text/plain;charset=utf-8"});saveAs(blob,file)},morpheus.CanvasUtil.getMousePos=function(element,event,useDelta){return morpheus.CanvasUtil.getMousePosWithScroll(element,event,0,0,useDelta)},morpheus.CanvasUtil.getClientXY=function(event,useDelta){var clientX,clientY;return event.pointers?event.pointers.length>0?(clientX=event.pointers[0].clientX-(useDelta?event.deltaX:0),clientY=event.pointers[0].clientY-(useDelta?event.deltaY:0)):(clientX=event.srcEvent.clientX-(useDelta?event.deltaX:0),clientY=event.srcEvent.clientY-(useDelta?event.deltaY:0)):(clientX=event.clientX,clientY=event.clientY),{x:clientX,y:clientY}},morpheus.CanvasUtil.getMousePosWithScroll=function(element,event,scrollX,scrollY,useDelta){return morpheus.CanvasUtil._getMousePosWithScroll(element,scrollX,scrollY,morpheus.CanvasUtil.getClientXY(event,useDelta))},morpheus.CanvasUtil._getMousePosWithScroll=function(element,scrollX,scrollY,clientXY){var rect=element.getBoundingClientRect();return{x:clientXY.x-rect.left+scrollX,y:clientXY.y-rect.top+scrollY}},morpheus.CheckBoxList=function(options){var _this=this,set=options.set||new morpheus.Set;options=$.extend(!0,{},{height:"150px",showHeader:!1,select:!1,search:!0,checkBoxSelectionOnTop:!1,rowHeader:function(item){var header=[];return header.push('<span><input name="toggle" type="checkbox" '+(set.has(_this.getter(item))?" checked":"")+"/> "),header.push("</span>"),header.join("")}},options),1===(options=morpheus.Table.createOptions(options)).columns.length&&(options.maxWidth=583);for(var idColumn=options.columns[0],i=0;i<options.columns.length;i++)if(options.columns[i].idColumn){idColumn=options.columns[i];break}this.getter=idColumn.getter;var html=[],table=new morpheus.Table(options);1===options.columns.length&&options.$el.find(".slick-table-header").find("[name=right]").remove(),this.table=table,(html=[]).push('<div style="display:inline;">'),html.push('<div style="display:inline;" class="dropdown">'),html.push('<button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),html.push('<i data-name="checkbox" class="fa fa-square-o" aria-hidden="true"></i>'),html.push(' <span class="fa fa-caret-down"></span>'),html.push("</button>"),html.push('<ul style="font-size:12px;" class="dropdown-menu">'),html.push('<li><a name="selectAll" href="#">Select All</a></li>'),html.push('<li><a name="selectNone" href="#">Select None</a></li>'),html.push('<li><a name="invertSel" href="#">Invert Selection</a></li>'),html.push("</ul>"),html.push("</div>"),html.push('<span data-name="available" style="font-size:12px;padding-left:6px;"></span>'),html.push("</div>");var $checkBoxEl=$(html.join(""));table.$header.find("[name=left]").html($checkBoxEl);var $selection=$checkBoxEl.find("[data-name=available]"),$selectAll=$checkBoxEl.find("[name=selectAll]"),$selectNone=$checkBoxEl.find("[name=selectNone]"),$cb=$checkBoxEl.find("[data-name=checkbox]"),updateLabel=function(){var label=[];label.push("selected "),label.push(morpheus.Util.intFormat(set.size())),label.push(" of "),label.push(morpheus.Util.intFormat(table.getAllItemCount())),table.getFilteredItemCount()!==table.getAllItemCount()&&(label.push(", "),label.push(morpheus.Util.intFormat(table.getFilteredItemCount())),label.push(1===table.getFilteredItemCount()?" match":" matches")),$selection.html(label.join(""))};table.grid.on("filter",function(e){updateLabel()}),$cb.on("click",function(e){if($cb.hasClass("fa-square-o"))for(var items=table.getItems(),i=0;i<items.length;i++)set.add(_this.getter(items[i]));else for(items=table.getItems(),i=0;i<items.length;i++)set.remove(_this.getter(items[i]));table.trigger("checkBoxSelectionChanged",{source:_this,set:set}),e.preventDefault(),e.stopPropagation()}),$selectAll.on("click",function(e){for(var items=table.getItems(),i=0,nitems=items.length;i<nitems;i++)set.add(_this.getter(items[i]));_this.table.trigger("checkBoxSelectionChanged",{source:_this,set:set}),e.preventDefault(),_this.table.redraw()}),$checkBoxEl.find("[name=invertSel]").on("click",function(e){for(var items=table.getItems(),i=0,nitems=items.length;i<nitems;i++){var val=_this.getter(items[i]);set.has(val)?set.remove(val):set.add(val)}_this.table.trigger("checkBoxSelectionChanged",{source:_this,set:set}),e.preventDefault(),_this.table.redraw()}),$selectNone.on("click",function(e){for(var items=table.getItems(),i=0,nitems=items.length;i<nitems;i++)set.remove(_this.getter(items[i]));_this.table.trigger("checkBoxSelectionChanged",{source:_this,set:set}),e.preventDefault(),_this.table.redraw()}),this.set=set,this.table=table,updateLabel();this.table.on("checkBoxSelectionChanged",function(){if(0===set.size())$cb.attr("class","fa fa-square-o");else{for(var items=table.getItems(),count=0,found=!1,notFound=!1,i=0;i<items.length;i++)if(set.has(_this.getter(items[i]))){if(count++,found=!0,notFound)break}else if(notFound=!0,found)break;0===count?$cb.attr("class","fa fa-square-o"):count===items.length?$cb.attr("class","fa fa-check-square-o"):$cb.attr("class","fa fa-minus-square-o")}updateLabel(),_this.table.redraw()}),table.on("click",function(e){var $target=$(e.target),item=table.getItems()[e.row],value=_this.getter(item);$target.is(".morpheus-hover-show")?(set.clear(),set.add(value),_this.table.trigger("checkBoxSelectionChanged",{source:_this,set:set})):(!options.select||$target.is("[type=checkbox]")&&"toggle"===$target.attr("name"))&&(set.has(value)?set.remove(value):set.add(value),_this.table.trigger("checkBoxSelectionChanged",{source:_this,set:set}))})},morpheus.CheckBoxList.prototype={searchWithPredicates:function(predicates){this.table.searchWithPredicates(predicates)},autocomplete:function(tokens,cb){this.table.autocomplete(tokens,cb)},setHeight:function(height){this.table.setHeight(height)},resize:function(){this.table.resize()},setSearchVisible:function(visible){this.table.setSearchVisible(visible)},getSelectedRows:function(){return this.table.getSelectedRows()},getSelectedItems:function(){return this.table.getSelectedItems()},setSelectedRows:function(rows){this.table.setSelectedRows(rows)},getItems:function(items){return this.table.getItems()},getAllItemCount:function(){return this.table.getAllItemCount()},getFilteredItemCount:function(){return this.table.getFilteredItemCount()},setFilter:function(f){this.table.setFilter(f)},redraw:function(){this.table.redraw()},getSelection:function(){return this.set},clearSelection:function(values){this.set.clear(),this.table.redraw()},setValue:function(values){this.setSelectedValues(values)},setSelectedValues:function(values){if(this.set.clear(),morpheus.Util.isArray(values))for(var i=0;i<values.length;i++)this.set.add(values[i]);else this.set.add(values);this.table.redraw()},val:function(){return this.set.values()},on:function(evtStr,handler){return this.table.on(evtStr,handler),this},off:function(evtStr,handler){this.table.off(evtStr,handler)},setItems:function(items){for(var newItems=new morpheus.Set,getter=this.getter,i=0;i<items.length;i++)newItems.add(getter(items[i]));var selection=this.set;selection.forEach(function(val){newItems.has(val)||selection.remove(val)}),this.table.setItems(items),this.table.trigger("checkBoxSelectionChanged",{source:this,set:selection})}},morpheus.ColorSchemeChooser=function(options){this.options=options,this.init()},morpheus.ColorSchemeChooser.prototype={init:function(){var annotationName,heatMap=this.options.heatMap,isColumns=this.options.isColumns,colorModel=isColumns?heatMap.getProject().getColumnColorModel():heatMap.getProject().getRowColorModel(),metadataModel=isColumns?heatMap.getProject().getFullDataset().getColumnMetadata():heatMap.getProject().getFullDataset().getRowMetadata();this.setAnnotationName=function(name){annotationName=name,updateChooser()};var _this=this,formBuilder=new morpheus.FormBuilder,$chooser=$("<div></div>");$chooser.appendTo(formBuilder.$form),formBuilder.append({name:"discrete",type:"checkbox"});var updateChooser=function(){var colorSchemeChooser,v=metadataModel.getByName(annotationName);if(null!=v){var dataType=morpheus.VectorUtil.getDataType(metadataModel.getByName(annotationName)),isNumber="number"===dataType||"[number]"===dataType;formBuilder.setVisible("discrete",isNumber),formBuilder.setValue("discrete",v.getProperties().get(morpheus.VectorKeys.DISCRETE)),v.getProperties().get(morpheus.VectorKeys.DISCRETE)?(colorModel.getMappedValue(v,v.getValue(0)),(colorSchemeChooser=new morpheus.DiscreteColorSchemeChooser({colorScheme:{scale:colorModel.getDiscreteColorScheme(metadataModel.getByName(annotationName))}})).on("change",function(event){colorModel.setMappedValue(metadataModel.getByName(annotationName),event.value,event.color),_this.trigger("change")})):(colorModel.getContinuousMappedValue(v,v.getValue(0)),(colorSchemeChooser=new morpheus.HeatMapColorSchemeChooser({showRelative:!1})).setColorScheme(colorModel.getContinuousColorScheme(v)),colorSchemeChooser.on("change",function(event){_this.trigger("change")})),$chooser.html(colorSchemeChooser.$div)}else console.log(annotationName+" not found.")};formBuilder.find("discrete").on("change",function(){metadataModel.getByName(annotationName).getProperties().set(morpheus.VectorKeys.DISCRETE,$(this).prop("checked")),updateChooser(),_this.trigger("change")}),this.$div=formBuilder.$form}},morpheus.Util.extend(morpheus.ColorSchemeChooser,morpheus.Events),morpheus.ColumnDendrogram=function(heatMap,tree,positions,project){morpheus.AbstractDendrogram.call(this,heatMap,tree,positions,project,morpheus.AbstractDendrogram.Type.COLUMN)},morpheus.ColumnDendrogram.prototype={drawNode:function(context,node){this.getNodeRadius(node);var pix=this.toPix(node);context.beginPath(),context.arc(pix[0],pix[1],4,2*Math.PI,!1),context.fill()},isDragHotSpot:function(p){return Math.abs(this.scale(this.cutHeight)-p.y)<=2},drawCutSlider:function(clip,context){context.setLineDash&&context.setLineDash([5]),context.strokeStyle="black";var ny=this.scale(this.cutHeight);context.beginPath(),context.moveTo(clip.x,ny),context.lineTo(this.getUnscaledWidth(),ny),context.stroke(),context.setLineDash&&context.setLineDash([])},createScale:function(){return d3.scale.linear().domain([this.tree.maxHeight,0]).range([0,this.getUnscaledHeight()])},paintMouseOver:function(clip,context){-1!==this.project.getHoverColumnIndex()&&(morpheus.CanvasUtil.resetTransform(context),context.translate(-clip.x,0),this.drawColumnBorder(context,this.positions,this.project.getHoverColumnIndex(),this.getUnscaledWidth()))},drawColumnBorder:function(context,positions,index,gridSize){var size=positions.getItemSize(index),pix=positions.getPosition(index);context.beginPath(),context.moveTo(pix+size,0),context.lineTo(pix+size,gridSize),context.stroke(),context.beginPath(),context.moveTo(pix,0),context.lineTo(pix,gridSize),context.stroke()},getMaxIndex:function(clip){return morpheus.Positions.getRight(clip,this.positions)},getMinIndex:function(clip){return morpheus.Positions.getLeft(clip,this.positions)},getPreferredSize:function(context){return{width:Math.ceil(this.positions.getPosition(this.positions.getLength()-1)+this.positions.getItemSize(this.positions.getLength()-1)),height:100}},toPix:function(node){return[(this.positions.getPosition(node.minIndex)+this.positions.getItemSize(node.minIndex)/2+(this.positions.getPosition(node.maxIndex)+this.positions.getItemSize(node.maxIndex)/2))/2,this.scale(node.height)]},drawPathFromNodeToParent:function(context,node){var pix=this.toPix(node),parentPix=this.toPix(node.parent);context.beginPath(),context.moveTo(pix[0],pix[1]),context.lineTo(pix[0],parentPix[1]),context.lineTo(parentPix[0],parentPix[1]),context.stroke()},drawNodePath:function(context,node,minIndex,maxIndex){var x,y,children=node.children,left=children[0],right=children[1],ny=this.scale(node.height),rx=this.toPix(right)[0],ry=this.scale(right.height),lx=this.toPix(left)[0],ly=this.scale(left.height);if(this.drawLeafNodes)x=[rx,rx,lx,lx],y=[ry,ny,ny,ly];else{var leftIsLeaf=void 0!==left.children,rightIsLeaf=void 0!==right.children;leftIsLeaf&&(ly=ny+4),rightIsLeaf&&(ry=ny+4),x=[rx,rx,lx,lx],y=[ry,ny,ny,ly]}context.beginPath(),context.moveTo(x[0],y[0]);for(var i=1,length=x.length;i<length;i++)context.lineTo(x[i],y[i]);context.stroke()}},morpheus.Util.extend(morpheus.ColumnDendrogram,morpheus.AbstractDendrogram),morpheus.ConditionalRenderingUI=function(heatmap){var _this=this;this.heatmap=heatmap;var $div=$('<div class="container-fluid" style="min-width:180px;"></div>');$div.on("click","[data-name=add]",function(e){var $row=$(this).closest(".morpheus-entry"),index=$row.index(),condition={seriesName:null,color:"rgb(0,0,0)",shape:null,inheritColor:!0,accept:function(val){return!1}};heatmap.heatmap.getColorScheme().getConditions().insert(index,condition),$row.after(_this.add(condition)),e.preventDefault()}),$div.on("click","[data-name=delete]",function(e){var $row=$(this).closest(".morpheus-entry"),index=$row.index()-1;heatmap.heatmap.getColorScheme().getConditions().remove(index),heatmap.revalidate(),$row.remove(),e.preventDefault()});var html=[];html.push('<div class="morpheus-entry">'),html.push('<div class="row">'),html.push('<div style="padding-bottom:20px;" class="col-xs-8"><a class="btn btn-default btn-xs" role="button" data-name="add" href="#">Add Condition</a></div>'),html.push("</div>"),html.push("</div>"),$div.append(html.join("")),this.$div=$div,heatmap.heatmap.getColorScheme().getConditions().getConditions().forEach(function(c){_this.add(c).appendTo($div)})},morpheus.ConditionalRenderingUI.prototype={add:function(condition){var _this=this,html=[];html.push('<div style="border-top:1px solid LightGrey;padding-bottom:6px;padding-top:6px;" class="morpheus-entry">'),html.push('<form class="form-horizontal">'),html.push('<div class="form-group">'),html.push('<label class="col-xs-2">Series</label>'),html.push('<div class="col-xs-6">'),html.push('<select class="form-control morpheus-form-control-inline" name="cond_series">'),html.push(morpheus.Util.createOptions(morpheus.DatasetUtil.getSeriesNames(this.heatmap.getProject().getFullDataset()))),html.push("</select>"),html.push("</div>"),html.push("</div>"),html.push('<div class="form-group">'),html.push('<label class="col-xs-2">Condition</label>'),html.push('<div class="col-xs-6">'),html.push('<select class="form-control morpheus-form-control-inline" name="lower"><option value="gte">&gt;=</option><option value="gt">&gt;</option></select>'),html.push('<input class="form-control morpheus-form-control-inline" name="v1" size="5" type="text">'),html.push('<span style="margin-right:1em;">and</span>'),html.push('<select class="form-control morpheus-form-control-inline" name="upper"><option value="lte">&lt;=</option><option value="lt">&lt;</option></select>'),html.push('<input class="form-control morpheus-form-control-inline" name="v2" size="5" type="text">'),html.push("</div>"),html.push("</div>"),html.push('<div class="form-group">'),html.push('<label class="col-xs-2">Shape</label>');var shapeField=new morpheus.ShapeField({shapes:morpheus.VectorShapeModel.FILLED_SHAPES,showNone:!1});html.push('<div class="col-xs-4">'),html.push('<div style="display:inline;" data-name="shapeHolder"></div>'),html.push("</div>"),html.push("</div>"),html.push('<div class="form-group">'),html.push('<label class="col-xs-offset-2 col-xs-4"><input name="inherit_color" type="checkbox" checked> Inherit color</label>'),html.push("</div>"),html.push('<div class="form-group">'),html.push('<label class="col-xs-2">Color</label>'),html.push('<div class="col-xs-4">'),html.push('<input class="form-control" type="color" name="color" style="display:inline; width:6em;" disabled>'),html.push("</div>"),html.push("</div>"),html.push('<div class="row"><div class="col-xs-11">'),html.push('<a class="btn btn-default btn-xs" role="button" data-name="delete" href="#">Delete Condition</a>'),html.push("</div></div>"),html.push("</div>");var $el=$(html.join(""));console.log($el.find("form").length),$el.find("form").on("submit",function(e){e.preventDefault()}),shapeField.$el.appendTo($el.find("[data-name=shapeHolder]"));var $color=$el.find("[name=color]"),$series=$el.find("[name=cond_series]"),$v1=$el.find("[name=v1]"),$v2=$el.find("[name=v2]"),$v1Op=$el.find("[name=lower]"),$v2Op=$el.find("[name=upper]"),$inherit_color=$el.find("[name=inherit_color]");function updateAccept(){var v1=parseFloat($($v1).val()),v2=parseFloat($($v2).val()),v1Op=$v1Op.val(),v2Op=$v2Op.val();condition.v1=v1,condition.v2=v2,condition.v1Op=v1Op,condition.v2Op=v2Op;var gtf=function(){return!0},ltf=function(){return!0};isNaN(v1)||(gtf="gt"===v1Op?function(val){return val>v1}:function(val){return val>=v1}),isNaN(v2)||(ltf="lt"===v2Op?function(val){return val<v2}:function(val){return val<=v2}),condition.accept=function(val){return gtf(val)&&ltf(val)},_this.heatmap.revalidate()}return $color.prop("disabled",condition.inheritColor),$color.val(condition.color),$series.val(condition.seriesName),shapeField.setShapeValue(condition.shape),null==condition.v1||isNaN(condition.v1)||$v1.val(condition.v1),null==condition.v2||isNaN(condition.v2)||$v2.val(condition.v2),$v1Op.val(condition.v1Op),$v2Op.val(condition.v2Op),$v1Op.on("change",function(e){updateAccept()}),$v2Op.on("change",function(e){updateAccept()}),$v1.on("keyup",_.debounce(function(e){updateAccept()},100)),$v2.on("keyup",_.debounce(function(e){updateAccept()},100)),$inherit_color.on("click",function(e){condition.inheritColor=$(this).prop("checked"),$color.prop("disabled",condition.inheritColor),_this.heatmap.revalidate()}),$color.on("change",function(e){condition.color=$(this).val(),_this.heatmap.revalidate()}),shapeField.on("change",function(e){condition.shape=e.shape,_this.heatmap.revalidate()}),$series.on("change",function(e){condition.seriesName=$(this).val(),_this.heatmap.revalidate()}),condition.seriesName=$series.val(),$el}},morpheus.DendrogramUtil={},morpheus.DendrogramUtil.setIndices=function(root,counter){counter=counter||0;var visit=function(node,callback){var n,children=node.children;if(children&&(n=children.length))for(var i=-1;++i<n;)visit(children[i],callback);callback(node)};visit(root,function(n){return void 0===n.children?(n.minIndex=counter,n.maxIndex=counter,n.index=counter,counter++):function(node){for(var children=node.children,maxIndex=children[0].maxIndex,minIndex=children[0].minIndex,sum=children[0].index,i=1,length=children.length;i<length;i++){var child=children[i];sum+=child.index,minIndex=Math.min(minIndex,child.minIndex),maxIndex=Math.max(maxIndex,child.maxIndex)}node.minIndex=minIndex,node.maxIndex=maxIndex,node.index=sum/children.length,node.children.sort(function(a,b){return a.index===b.index?0:a.index<b.index?-1:1})}(n),!0})},morpheus.DendrogramUtil.convertEdgeLengthsToHeights=function(rootNode){var maxHeight=0;!function setHeights(node,height){var newHeight=height;void 0!==node.length&&(newHeight+=node.length),node.height=newHeight,maxHeight=Math.max(maxHeight,node.height),null!=node.children&&node.children.forEach(function(child){setHeights(child,newHeight)})}(rootNode,0);var counter=0;return morpheus.DendrogramUtil.dfs(rootNode,function(node){return node.id=counter,counter++,node.height=maxHeight-node.height,!0}),{maxHeight:maxHeight,n:counter}},morpheus.DendrogramUtil.writeNewick=function(node,out,leafNodeIdFunction){if(null!=node.children&&node.children.length>0){out.push("(");for(var i=0;i<node.children.length;i++)i>0&&out.push(","),morpheus.DendrogramUtil.writeNewick(node.children[i],out,leafNodeIdFunction);out.push(")")}out.push(null!=node.index?leafNodeIdFunction(node):""),out.push(":");var parentHeight=node.parent?node.parent.height:node.height;out.push(parentHeight-node.height)},morpheus.DendrogramUtil.parseNewick=function(text){var rootNode=Newick.parse(text),counter=0,leafNodes=[];!function visit(node){var children=node.children;if(void 0!==children){var left=children[0],right=children[1];left.parent=node,right.parent=node,visit(left),visit(right)}else node.minIndex=counter,node.maxIndex=counter,node.index=counter,leafNodes.push(node),counter++}(rootNode);morpheus.DendrogramUtil.convertEdgeLengthsToHeights(rootNode).maxHeight;return morpheus.DendrogramUtil.setNodeDepths(rootNode),morpheus.DendrogramUtil.setIndices(rootNode),{maxHeight:rootNode.height,rootNode:rootNode,leafNodes:leafNodes,nLeafNodes:leafNodes.length}},morpheus.DendrogramUtil.cutAtHeight=function(rootNode,h){var roots=[];return morpheus.DendrogramUtil.dfs(rootNode,function(node){return!(node.height<h)||(roots.push(node),!1)}),roots.sort(function(a,b){return a.index<b.index?-1:a.index==b.index?0:1}),roots},morpheus.DendrogramUtil.getDeepestChild=function(node,isMin){for(;;){if(void 0===node.children)return node;var index;index=isMin?node.children[0].index<node.children[node.children.length-1].index?0:node.children.length-1:node.children[0].index>node.children[node.children.length-1].index?0:node.children.length-1,node=node.children[index]}},morpheus.DendrogramUtil.dfs=function(node,callback,childrenAccessor){if(void 0===childrenAccessor&&(childrenAccessor=function(n){return n.children}),callback(node)){var n,children=childrenAccessor(node);if(children&&(n=children.length))for(var i=-1;++i<n;)morpheus.DendrogramUtil.dfs(children[i],callback,childrenAccessor)}},morpheus.DendrogramUtil.copyTree=function(tree){var counter=0;var rootNode=$.extend({},tree.rootNode);return rootNode.parent=void 0,function recurse(node){var children=node.children;if(void 0!==children){for(var newChildren=[],i=0,n=children.length;i<n;i++){var copy=$.extend({},children[i]);copy.parent=node,newChildren.push(copy)}for(node.children=newChildren,i=0,n=newChildren.length;i<n;i++)recurse(newChildren[i])}else node.index=counter,node.minIndex=counter,node.maxIndex=counter,counter++}(rootNode),{nLeafNodes:tree.nLeafNodes,maxDepth:tree.maxDepth,rootNode:rootNode}},morpheus.DendrogramUtil.collapseAtDepth=function(rootNode,maxDepth){morpheus.DendrogramUtil.dfs(rootNode,function(d){return d.collapsedChildren&&(d.children=d.collapsedChildren,d.collapsedChildren=void 0),!0}),morpheus.DendrogramUtil.dfs(rootNode,function(d){return!(d.depth>maxDepth)||(d.collapsedChildren=d.children,d.children=void 0,!1)})},morpheus.DendrogramUtil.setNodeDepths=function(rootNode){var max=0;return function recurse(node,depth){var children=node.children;if(node.depth=depth,max=Math.max(depth,max),void 0!==children)for(var i=-1,j=depth+1,n=children.length;++i<n;)recurse(children[i],j);return node}(rootNode,0),max},morpheus.DendrogramUtil.sortDendrogram=function(root,vectorToSortBy,project,summaryFunction){summaryFunction=summaryFunction||function(array){for(var min=Number.MAX_VALUE,i=0;i<array.length;i++)min=Math.min(min,array[i].weight);return min};var setWeights=function(node){if(void 0!==node.children){for(var children=node.children,i=0;i<children.length;i++)setWeights(children[i]);node.weight=summaryFunction(children)}else node.weight=vectorToSortBy.getValue(node.index)};setWeights(root);var nodeIdToModelIndex={},leafNodes=morpheus.DendrogramUtil.getLeafNodes(root);_.each(leafNodes,function(node){nodeIdToModelIndex[node.id]=project.convertViewColumnIndexToModel(node.index)}),morpheus.DendrogramUtil.dfs(root,function(node){return node.children&&node.children.sort(function(a,b){return a.weight===b.weight?0:a.weight<b.weight?-1:1}),!0}),morpheus.DendrogramUtil.setIndices(root);var sortOrder=[];return _.each(leafNodes,function(node){var oldModelIndex=nodeIdToModelIndex[node.id],newIndex=node.index;sortOrder[newIndex]=oldModelIndex}),sortOrder},morpheus.DendrogramUtil.leastCommonAncestor=function(leafNodes){function getPathToRoot(node){for(var path=new morpheus.Map;null!=node;)path.set(node.id,node),node=node.parent;return path}for(var path=getPathToRoot(leafNodes[0]),i=1;i<leafNodes.length;i++){var path2=getPathToRoot(leafNodes[i]);path.forEach(function(node,id){path2.has(id)||path.remove(id)})}var maxNode,max=-Number.MAX_VALUE;return path.forEach(function(n,id){n.depth>max&&(max=n.depth,maxNode=n)}),maxNode},morpheus.DendrogramUtil.search=function(options){var predicates,searchText=options.text,rootNode=options.rootNode,tokens=morpheus.Util.getAutocompleteTokens(searchText),nmatches=0,matchAllPredicates=!0===options.matchAllPredicates;if(null==tokens||0==tokens.length)morpheus.DendrogramUtil.dfs(rootNode,function(node){return node.search=!1,!0}),nmatches=-1;else{var npredicates=(predicates=morpheus.Util.createSearchPredicates({tokens:tokens,defaultMatchMode:options.defaultMatchMode})).length;morpheus.DendrogramUtil.dfs(rootNode,function(node){var matches=!1;if(node.info)searchLabel:if(matchAllPredicates){matches=!0;for(p=0;p<npredicates;p++){if(null!=(filterColumnName=(predicate=predicates[p]).getField())){for(i=0,nvals=(vals=node.info[filterColumnName]).length;i<nvals;i++)if(!predicate.accept(vals[i])){matches=!1;break searchLabel}}else for(var name in node.info)for(i=0,nvals=(vals=node.info[name]).length;i<nvals;i++)if(!predicate.accept(vals[i])){matches=!1;break searchLabel}}}else for(var p=0;p<npredicates;p++){var predicate,filterColumnName;if(null!=(filterColumnName=(predicate=predicates[p]).getField())){for(var i=0,nvals=(vals=node.info[filterColumnName]).length;i<nvals;i++)if(predicate.accept(vals[i])){matches=!0;break searchLabel}}else for(var name in node.info)for(var vals,i=0,nvals=(vals=node.info[name]).length;i<nvals;i++)if(predicate.accept(vals[i])){matches=!0;break searchLabel}}return node.search=matches,matches&&nmatches++,!0})}return nmatches},morpheus.DendrogramUtil.squishNonSearchedNodes=function(heatMap,isColumns){isColumns?heatMap.getHeatMapElementComponent().getColumnPositions().setSize(13):heatMap.getHeatMapElementComponent().getRowPositions().setSize(13);var expandedLeafNodes={},dendrogram=isColumns?heatMap.columnDendrogram:heatMap.rowDendrogram;morpheus.DendrogramUtil.dfs(dendrogram.tree.rootNode,function(node){for(var i=node.minIndex;i<=node.maxIndex;i++)node.search&&(expandedLeafNodes[i]=!0);return!0});var clusterIds=[],previous=expandedLeafNodes[0],squishedIndices={};previous||(squishedIndices[0]=!0);var clusterNumber=0;clusterIds.push(clusterNumber);for(var i=1,nleaves=dendrogram.tree.leafNodes.length;i<nleaves;i++){var expanded=expandedLeafNodes[i];expanded!==previous&&(clusterNumber++,previous=expanded),expanded||(squishedIndices[i]=!0),clusterIds.push(clusterNumber)}isColumns?(heatMap.getHeatMapElementComponent().getColumnPositions().setSquishedIndices(squishedIndices),heatMap.getProject().setGroupColumns([new morpheus.SpecifiedGroupByKey(clusterIds)],!1)):(heatMap.getHeatMapElementComponent().getRowPositions().setSquishedIndices(squishedIndices),heatMap.getProject().setGroupRows([new morpheus.SpecifiedGroupByKey(clusterIds)],!1))},morpheus.DendrogramUtil.getLeafNodes=function(rootNode){var leafNodes=[];return morpheus.DendrogramUtil.dfs(rootNode,function(node){return void 0===node.children&&leafNodes.push(node),!0}),leafNodes},morpheus.DialogUtil=function(){},morpheus.DialogUtil.DIALOGS=[],morpheus.DialogUtil.add=function(d){morpheus.DialogUtil.DIALOGS.push(d)},morpheus.DialogUtil.remove=function(d){for(var found=!1,i=0,n=morpheus.DialogUtil.DIALOGS.length;i<n;i++)if(d===morpheus.DialogUtil.DIALOGS[i]){morpheus.DialogUtil.DIALOGS.splice(i,1),found=!0;break}found||console.log("Dialog not found.")},morpheus.DialogUtil.clear=function(){morpheus.DialogUtil.DIALOGS.forEach(function(d){d.remove()}),morpheus.DialogUtil.DIALOGS=[]},morpheus.DiscreteColorSchemeChooser=function(options){var formBuilder=new morpheus.FormBuilder,map=options.colorScheme.scale;formBuilder.append({name:"selected_value",type:"bootstrap-select",options:map.keys()});var $select=formBuilder.find("selected_value");formBuilder.append({style:"max-width:50px;",name:"selected_color",type:"color"});var selectedVal=$select.val(),_this=this,$color=formBuilder.find("selected_color");$color.val(map.get(selectedVal)),$color.on("change",function(e){var color=$(this).val();map.set(selectedVal,color),_this.trigger("change",{value:selectedVal,color:color})}),$select.on("change",function(){selectedVal=$select.val();var c=map.get(selectedVal);$color.val(c)}),this.$div=formBuilder.$form},morpheus.DiscreteColorSchemeChooser.prototype={},morpheus.Util.extend(morpheus.DiscreteColorSchemeChooser,morpheus.Events),morpheus.DiscreteColorSupplier=function(){this.colorMap=new morpheus.Map,this.hiddenValue=0,this.hiddenValues=new morpheus.Set,morpheus.AbstractColorSupplier.call(this),this.scalingMode=morpheus.HeatMapColorScheme.ScalingMode.FIXED},morpheus.DiscreteColorSupplier.prototype={createInstance:function(){return new morpheus.DiscreteColorSupplier},setColorMap:function(array){this.colorMap=new morpheus.Map,this.colors=[],this.fractions=[],this.names=[],this.min=Number.MAX_VALUE,this.max=-Number.MAX_VALUE;for(var i=0;i<array.length;i++)this.colorMap.set(array[i].value,array[i].color),this.fractions.push(array[i].value),this.names.push(array[i].name),this.colors.push(array[i].color),this.min=Math.min(this.min,array[i].value),this.max=Math.max(this.max,array[i].value)},copy:function(){var c=this.createInstance();return c.names=this.names.slice(0),c.colorMap=new morpheus.Map,this.colorMap.forEach(function(color,value){c.colorMap.set(value,color)}),c.colors=this.colors.slice(0),c.fractions=this.fractions.slice(0),this.hiddenValues.forEach(function(val){c.hiddenValues.add(val)}),c.missingColor=this.missingColor,c},isStepped:function(){return!0},getColor:function(row,column,value){return this.hiddenValues.has(value)&&(value=this.hiddenValue),isNaN(value)?this.missingColor:this.colorMap.get(value)}},morpheus.Util.extend(morpheus.DiscreteColorSupplier,morpheus.AbstractColorSupplier),morpheus.Divider=function(vertical){morpheus.AbstractCanvas.call(this,!1),this.vertical=vertical;var that=this,canvas=this.canvas;canvas.style.cursor=vertical?"ew-resize":"ns-resize",vertical?this.setBounds({height:15,width:4}):this.setBounds({height:4,width:15}),this.hammer=morpheus.Util.hammer(canvas,["pan"]).on("panstart",this.panstart=function(event){that.trigger("resizeStart"),morpheus.CanvasUtil.dragging=!0}).on("panmove",this.panmove=function(event){that.vertical?that.trigger("resize",{delta:event.deltaX}):that.trigger("resize",{delta:event.deltaY})}).on("panend",this.panend=function(event){morpheus.CanvasUtil.dragging=!1,that.trigger("resizeEnd")}),this.paint()},morpheus.Divider.prototype={dispose:function(){morpheus.AbstractCanvas.prototype.dispose.call(this),this.hammer.off("panstart",this.panstart).off("panmove",this.panmove).off("panend",this.panend),this.hammer.destroy()},getPreferredSize:function(){return{width:3,height:this.getUnscaledHeight()}},draw:function(clip,context){var width=this.getUnscaledWidth(),height=this.getUnscaledHeight();context.clearRect(0,0,width,height),context.strokeStyle="#ddd",this.vertical?(context.beginPath(),context.moveTo(0,0),context.lineTo(0,height),context.stroke()):(context.beginPath(),context.moveTo(0,1.5),context.lineTo(width,1.5),context.stroke())}},morpheus.Util.extend(morpheus.Divider,morpheus.AbstractCanvas),morpheus.Util.extend(morpheus.Divider,morpheus.Events),morpheus.DualList=function(leftOptions,rightOptions){var html=[];html.push('<div class="container-fluid">'),html.push('<div class="row">'),html.push('<div class="col-xs-4"><label>Available Fields</label></div>'),html.push('<div class="col-xs-2"></div>'),html.push('<div class="col-xs-4"><label>Selected Fields</label></div>'),html.push("</div>"),html.push('<div class="row">'),html.push('<div class="col-xs-4"><select class="form-control" name="left" multiple></select></div>'),html.push('<div class="col-xs-2"><div class="btn-group-vertical" role="group"><button name="add" type="button" class="btn btn-xs btn-default">Add</button><button name="remove" type="button" class="btn btn-xs btn-default">Remove</button><button name="up" type="button" class="btn btn-xs btn-default">Move Up</button><button name="down" type="button" class="btn btn-xs btn-default">Move Down</button></div></div>'),html.push('<div class="col-xs-4"><select class="form-control" name="right" multiple></select></div>'),html.push("</div>"),html.push("</div>"),this.$el=$(html.join(""));var _this=this;this.$el.find("[name=add]").on("click",function(){_this.addSelected()}),this.$el.find("[name=remove]").on("click",function(){_this.removeSelected()}),this.$el.find("[name=up]").on("click",function(){_this.moveUp()}),this.$el.find("[name=down]").on("click",function(){_this.moveDown()}),this.left=this.$el.find("[name=left]")[0],this.right=this.$el.find("[name=right]")[0];for(var i=0;i<leftOptions.length;i++)this.left.options[i]=leftOptions[i];for(i=0;i<rightOptions.length;i++)this.right.options[i]=rightOptions[i]},morpheus.DualList.prototype={addSelected:function(){for(var left=this.left,right=this.right,i=0;i<left.options.length;i++)if(left.options[i].selected){var opt=left.options[i];right.options[right.options.length]=new Option(opt.innerHTML,opt.value),left.options[i]=null,i--}},addAll:function(){for(var left=this.left,right=this.right,i=0;i<left.options.length;i++){var opt=left.options[i];right.options[right.options.length]=new Option(opt.innerHTML,opt.value)}left.options.length=0},removeSelected:function(){for(var left=this.left,right=this.right,i=0;i<right.options.length;i++)if(right.options[i].selected){var opt=right.options[i];left.options[left.options.length]=new Option(opt.innerHTML,opt.value),right.options[i]=null,i--}},getOptions:function(isLeft){for(var sel=isLeft?this.left:this.right,options=[],i=0;i<sel.options.length;i++)options.push(sel.options[i].value);return options},removeAll:function(){for(var left=this.left,right=this.right,i=0;i<right.options.length;i++){var opt=right.options[i];left.options[left.options.length]=new Option(opt.innerHTML,opt.value)}right.options.length=0},moveUp:function(){for(var right=this.right,selectedOptions=right.selectedOptions,indices=[],i=0;i<selectedOptions.length;i++)indices.push(selectedOptions[i].index);var index=morpheus.Util.indexSort(indices,!1);for(i=0;i<selectedOptions.length;i++){var sel=selectedOptions[index[i]].index,optHTML=right.options[sel].innerHTML,optVal=right.options[sel].value,opt1HTML=right.options[sel-1].innerHTML,opt1Val=right.options[sel-1].value;right.options[sel]=new Option(opt1HTML,opt1Val),right.options[sel-1]=new Option(optHTML,optVal),right.options.selectedIndex=sel-1}},moveDown:function(){for(var right=this.right,selectedOptions=right.selectedOptions,indices=[],i=0;i<selectedOptions.length;i++)indices.push(selectedOptions[i].index);var index=morpheus.Util.indexSort(indices,!1);for(i=0;i<selectedOptions.length;i++){var sel=selectedOptions[index[i]].index,optHTML=right.options[sel].innerHTML,optVal=right.options[sel].value,opt1HTML=right.options[sel+1].innerHTML,opt1Val=right.options[sel+1].value;right.options[sel]=new Option(opt1HTML,opt1Val),right.options[sel+1]=new Option(optHTML,optVal),right.options.selectedIndex=sel+1}}},morpheus.FilePicker=function(options){var html=[];html.push("<div>");var myComputer=_.uniqueId("morpheus"),url=_.uniqueId("morpheus"),googleId=_.uniqueId("morpheus"),dropbox=_.uniqueId("morpheus"),preloaded=_.uniqueId("morpheus");html.push('<ul style="margin-bottom:10px;" class="nav nav-pills morpheus">'),html.push('<li role="presentation" class="active"><a href="#'+myComputer+'" aria-controls="'+myComputer+'" role="tab" data-toggle="tab"><i class="fa fa-desktop"></i> My Computer</a></li>'),html.push('<li role="presentation"><a href="#'+url+'" aria-controls="'+url+'" role="tab" data-toggle="tav"><i class="fa fa-link"></i> URL</a></li>'),"undefined"!=typeof gapi&&html.push('<li role="presentation"><a href="#'+googleId+'" aria-controls="'+googleId+'" role="tab" data-toggle="tab"><i class="fa fa-google"></i> Google</a></li>'),"undefined"!=typeof Dropbox&&html.push('<li role="presentation"><a href="#'+dropbox+'" aria-controls="'+dropbox+'" role="tab" data-toggle="tab"><i class="fa fa-dropbox"></i> Dropbox</a></li>');var $sampleDatasetsEl=$('<div class="morpheus-preloaded"></div>');html.push('<li role="presentation"><a href="#'+preloaded+'" aria-controls="'+preloaded+'" role="tab" data-toggle="tab"><i class="fa fa-database"></i> Preloaded Datasets</a></li>'),new morpheus.SampleDatasets({$el:$sampleDatasetsEl,show:!0,callback:function(heatMapOptions){options.optionsCallback(heatMapOptions)}}),html.push("</ul>"),html.push('<div class="tab-content" style="text-align:center;cursor:pointer;height:300px;">'),html.push('<div role="tabpanel" class="tab-pane active" id="'+myComputer+'">'),html.push('<div data-name="drop" class="morpheus-file-drop morpheus-landing-panel">'),html.push('<button class="btn btn-default"><span class="fa-stack"><i class="fa fa-file-o fa-stack-2x"></i> <i class="fa fa-plus fa-stack-1x"></i></span> Select File</button> <div style="padding-top:10px;">or Copy and Paste Clipboard Data, <span class="morpheus-drag-text">Drag and Drop</span></div>'),html.push('<input name="hiddenFile" style="display:none;" type="file">'),html.push("</div>"),html.push("</div>"),html.push('<div role="tabpanel" class="tab-pane" id="'+url+'">'),html.push('<div class="morpheus-landing-panel">'),html.push('<input name="url" placeholder="Enter a URL" class="form-control" style="display:inline;max-width:400px; type="text"><button name="openUrl" class="btn btn-default" type="button">Go</button>'),html.push("</div>"),html.push("</div>"),"undefined"!=typeof Dropbox&&(html.push('<div role="tabpanel" class="tab-pane" id="'+dropbox+'">'),html.push('<div class="morpheus-landing-panel">'),html.push('<button name="dropbox" class="btn btn-default">Browse Dropbox</button>'),html.push("</div>"),html.push("</div>")),"undefined"!=typeof gapi&&(html.push('<div role="tabpanel" class="tab-pane" id="'+googleId+'">'),html.push('<div class="morpheus-landing-panel">'),html.push('<button name="google" class="btn btn-default">Browse Google Drive</button>'),html.push("</div>"),html.push("</div>")),html.push('<div role="tabpanel" class="tab-pane" id="'+preloaded+'">'),html.push('<div style="height:300px;overflow: auto;" class="morpheus-landing-panel">'),html.push("</div>"),html.push("</div>"),html.push("</div>"),html.push("</div>");var $el=$(html.join(""));$sampleDatasetsEl.appendTo($el.find("#"+preloaded+" > .morpheus-landing-panel")),this.$el=$el;var $file=$el.find("[name=hiddenFile]"),$myComputer=$el.find("[id="+myComputer+"]");this.$el.find(".nav").on("click","li > a",function(e){e.preventDefault(),$(this).tab("show")});var $url=$el.find("[name=url]");$url.on("keyup",function(evt){if(13===evt.which){var text=$.trim($(this).val());""!==text&&options.fileCallback([text])}}),$el.find("[name=openUrl]").on("click",function(evt){var text=$.trim($url.val());""!==text&&options.fileCallback([text])}),$el.find("[name=dropbox]").on("click",function(e){Dropbox.choose({success:function(results){var val=results[0].link;options.fileCallback([val])},linkType:"direct",multiselect:!1})}),$el.find("[name=google]").on("click",function(){var oauthToken,developerKey="AIzaSyBCRqn5xgdUsJZcC6oJnIInQubaaL3aYvI",clientId="936482190815-85k6k06b98ihv272n0b7f7fm33v5mmfa.apps.googleusercontent.com",scope=["https://www.googleapis.com/auth/drive"],pickerApiLoaded=!1;function onAuthApiLoad(){window.gapi.auth.authorize({client_id:clientId,scope:scope,immediate:!1},handleAuthResult)}function onPickerApiLoad(){pickerApiLoaded=!0,createPicker()}function handleAuthResult(authResult){authResult&&!authResult.error&&(oauthToken=authResult.access_token,createPicker())}function createPicker(){pickerApiLoaded&&oauthToken&&((new google.picker.PickerBuilder).addView(google.picker.ViewId.DOCS).setOAuthToken(oauthToken).setDeveloperKey(developerKey).setCallback(pickerCallback).build().setVisible(!0),$(".picker-dialog-bg").css("z-index",1052),$(".picker-dialog").css("z-index",1053))}function pickerCallback(data){if(data.action==google.picker.Action.PICKED){var file=data.docs[0],fileName=file.name,accessToken=gapi.auth.getToken().access_token,url=(new XMLHttpRequest,new String("https://www.googleapis.com/drive/v3/files/"+file.id+"?alt=media"));url.name=fileName,url.headers={Authorization:"Bearer "+accessToken},options.fileCallback([url])}}gapi.load("auth",{callback:onAuthApiLoad}),gapi.load("picker",{callback:onPickerApiLoad})}),$file.on("change",function(evt){for(var files=evt.target.files,i=0;i<files.length;i++)options.fileCallback([files[i]])}),$(window).on("paste.morpheus",this.paste=function(e){if($myComputer.is(":visible")){var text=e.originalEvent.clipboardData.getData("text/plain");if(null!=text&&text.length>0){var url;if(e.preventDefault(),e.stopPropagation(),0===text.indexOf("http"))url=text;else{var blob=new Blob([text]);(url=new String(window.URL.createObjectURL(blob))).name="clipboard"}options.fileCallback([url])}}});var $drop=$el.find("[data-name=drop]"),_this=this;$el.on("remove",function(){$(window).off(_this.paste).off(_this.dragover).off(_this.dragenter).off(_this.dragleave).off(_this.drop)});var clicking=!1;$drop.on("click",function(e){clicking||(clicking=!0,$file.click(),clicking=!1)}),$(window).on("dragover",this.dragover=function(e){$myComputer.is(":visible")&&($drop.addClass("drag"),e.preventDefault(),e.stopPropagation())}).on("dragenter",this.dragenter=function(e){$myComputer.is(":visible")&&($drop.addClass("drag"),e.preventDefault(),e.stopPropagation())}).on("dragleave",this.dragleave=function(e){$myComputer.is(":visible")&&($drop.removeClass("drag"),e.preventDefault(),e.stopPropagation())}).on("drop",this.drop=function(e){if($myComputer.is(":visible")&&($drop.removeClass("drag"),e.originalEvent.dataTransfer))if(e.originalEvent.dataTransfer.files.length){e.preventDefault(),e.stopPropagation();var isMtx=!1,files=e.originalEvent.dataTransfer.files;if(3===files.length){for(var genesFile=null,barcodesFile=null,matrixFile=null,i=0;i<files.length;i++)"genes.tsv"===files[i].name?genesFile=files[i]:"barcodes.tsv"===files[i].name?barcodesFile=files[i]:"matrix.mtx"===files[i].name&&(matrixFile=files[i]);null!=matrixFile&&null!=genesFile&&null!=barcodesFile&&(options.fileCallback([matrixFile,genesFile,barcodesFile]),isMtx=!0)}if(!isMtx)for(i=0;i<files.length;i++)options.fileCallback([files[i]])}else{var url=e.originalEvent.dataTransfer.getData("URL");options.fileCallback([url]),e.preventDefault(),e.stopPropagation()}})},morpheus.FilterUI=function(project,isColumns){var _this=this;this.project=project,this.isColumns=isColumns;var $div=$('<div style="min-width:180px;"></div>');this.$div=$div,$div.append(this.addBase());var $filterMode=$div.find("[name=filterMode]");$filterMode.on("change",function(e){var isAndFilter=$filterMode.prop("checked");(isColumns?project.getColumnFilter():project.getRowFilter()).setAnd(isAndFilter),isColumns?_this.project.setColumnFilter(_this.project.getColumnFilter(),!0):_this.project.setRowFilter(_this.project.getRowFilter(),!0),e.preventDefault()}),$div.on("click","[data-name=add]",function(e){var $row=$(this).closest(".morpheus-entry"),index=$row.index(),newFilter=new morpheus.AlwaysTrueFilter(isColumns);(isColumns?project.getColumnFilter():project.getRowFilter()).insert(index,newFilter),$row.after(_this.add(newFilter)),e.preventDefault()}),$div.on("click","[data-name=delete]",function(e){var $row=$(this).closest(".morpheus-entry"),index=$row.index()-1;(isColumns?project.getColumnFilter():project.getRowFilter()).remove(index),$row.remove(),isColumns?_this.project.setColumnFilter(_this.project.getColumnFilter(),!0):_this.project.setRowFilter(_this.project.getRowFilter(),!0),e.preventDefault()}),$div.on("submit","form",function(e){$(this);e.preventDefault()}),$div.on("change","[name=by]",function(e){var $this=$(this),fieldName=$this.val(),$row=$this.closest(".morpheus-entry"),index=$row.index()-1;(isColumns?project.getColumnFilter():project.getRowFilter()).remove(index),""==fieldName?$row.find("[data-name=ui]").empty():_this.createFilter({fieldName:fieldName,$div:$this}),isColumns?_this.project.setColumnFilter(_this.project.getColumnFilter(),!0):_this.project.setRowFilter(_this.project.getRowFilter(),!0)});for(var combinedFilter=isColumns?project.getColumnFilter():project.getRowFilter(),filters=combinedFilter.getFilters?combinedFilter.getFilters():[],i=0;i<filters.length;i++)this.createFilter({filter:filters[i]});combinedFilter.on&&(combinedFilter.on("add",function(e){_this.createFilter({filter:e.filter})}),combinedFilter.on("remove",function(e){$div.find(".morpheus-entry")[1+e.index].remove()}),combinedFilter.on("and",function(e){$filterMode.prop("checked",e.source.isAnd())}))},morpheus.FilterUI.rangeFilter=function(project,name,isColumns,$ui,filter){$ui.empty();var html=[];html.push("<label>Range of values</label><br />"),html.push('<label>>= </label> <input style="max-width:200px;" class="form-control input-sm" name="min" type="text" />'),html.push('<label> and <= </label> <input style="max-width:200px;" class="form-control input-sm" name="max" type="text" />'),html.push('<br /><a data-name="switch" href="#">Switch to top filter</a>'),$(html.join("")).appendTo($ui),$ui.find("[data-name=switch]").on("click",function(e){e.preventDefault();for(var newFilter=morpheus.FilterUI.topFilter(project,name,isColumns,$ui),index=-1,filters=isColumns?project.getColumnFilter().getFilters():project.getRowFilter().getFilters(),i=0;i<filters.length;i++)if(filters[i]===filter){index=i;break}if(-1===index)throw new Error("Filter not found.");(isColumns?project.getColumnFilter():project.getRowFilter()).set(index,newFilter),isColumns?project.setColumnFilter(project.getColumnFilter(),!0):project.setRowFilter(project.getRowFilter(),!0)});var $min=$ui.find("[name=min]"),$max=$ui.find("[name=max]");return filter?($min.val(filter.min),$max.val(filter.max)):filter=new morpheus.RangeFilter(-Number.MAX_VALUE,Number.MAX_VALUE,name,isColumns),$min.on("keyup",_.debounce(function(e){filter.setMin(parseFloat($.trim($(this).val()))),isColumns?project.setColumnFilter(project.getColumnFilter(),!0):project.setRowFilter(project.getRowFilter(),!0)},500)),$max.on("keyup",_.debounce(function(e){filter.setMax(parseFloat($.trim($(this).val()))),isColumns?project.setColumnFilter(project.getColumnFilter(),!0):project.setRowFilter(project.getRowFilter(),!0)},500)),filter},morpheus.FilterUI.topFilter=function(project,name,isColumns,$ui,filter){$ui.empty();var html=[];html.push("<label>Top</label><br />"),html.push('<select style="width:auto;" class="form-control input-sm" name="direction"><option value="Top">Top</option><option value="Bottom">Bottom</option><option value="TopBottom">Top/Bottom</option></select>'),html.push(' <label>N </label> <input style="max-width:200px;" class="form-control input-sm" name="n" type="text" />'),html.push('<br /><a data-name="switch" href="#">Switch to range filter</a>'),$(html.join("")).appendTo($ui);var dirVal,$n=$ui.find("[name=n]"),$direction=$ui.find("[name=direction]");($ui.find("[data-name=switch]").on("click",function(e){e.preventDefault();for(var newFilter=morpheus.FilterUI.rangeFilter(project,name,isColumns,$ui),index=-1,filters=isColumns?project.getColumnFilter().getFilters():project.getRowFilter().getFilters(),i=0;i<filters.length;i++)if(filters[i]===filter){index=i;break}if(-1===index)throw new Error("Filter not found.");(isColumns?project.getColumnFilter():project.getRowFilter()).set(index,newFilter),isColumns?project.setColumnFilter(project.getColumnFilter(),!0):project.setRowFilter(project.getRowFilter(),!0)}),filter)?(dirVal=filter.direction===morpheus.TopNFilter.TOP?"Top":filter.direction===morpheus.TopNFilter.BOTTOM?"Bottom":"TopBottom",$direction.val(dirVal),$n.val(filter.n)):filter=new morpheus.TopNFilter(NaN,morpheus.TopNFilter.TOP,name,isColumns);return $direction.on("change",function(){var dirVal,dir=$(this).val();dirVal="Top"===dir?morpheus.TopNFilter.TOP:"Bottom"===dir?morpheus.TopNFilter.BOTTOM:morpheus.TopNFilter.TOP_BOTTOM,filter.setDirection(dirVal),isColumns?project.setColumnFilter(project.getColumnFilter(),!0):project.setRowFilter(project.getRowFilter(),!0)}),$n.on("keyup",_.debounce(function(e){filter.setN(parseInt($.trim($(this).val()))),isColumns?project.setColumnFilter(project.getColumnFilter(),!0):project.setRowFilter(project.getRowFilter(),!0)},500)),filter},morpheus.FilterUI.prototype={createFilter:function(options){var $ui,index=-1,$div=options.$div,isColumns=this.isColumns,filter=options.filter,project=this.project,fieldName=filter?filter.name:options.fieldName;if($div){var $row=$div.closest(".morpheus-entry");index=$row.index()-1,$ui=$row.find("[data-name=ui]")}else{var $add=$(this.add(filter));$add.appendTo(this.$div),$ui=$add.find("[data-name=ui]")}$ui.empty();var vector=(isColumns?this.project.getFullDataset().getColumnMetadata():this.project.getFullDataset().getRowMetadata()).getByName(fieldName);if(filter instanceof morpheus.RangeFilter)morpheus.FilterUI.rangeFilter(project,fieldName,isColumns,$ui,filter);else if(filter instanceof morpheus.TopNFilter)morpheus.FilterUI.topFilter(project,fieldName,isColumns,$ui,filter);else if(null==filter&&morpheus.VectorUtil.isNumber(vector)&&morpheus.VectorUtil.containsMoreThanNValues(vector,9))filter=morpheus.FilterUI.rangeFilter(project,fieldName,isColumns,$ui,filter);else{var set=morpheus.VectorUtil.getSet(vector),array=set.values();array.sort(morpheus.SortKey.ASCENDING_COMPARATOR),filter?filter.maxSetSize=array.length:filter=new morpheus.VectorFilter(new morpheus.Set,set.size(),fieldName,isColumns),new morpheus.CheckBoxList({responsive:!1,$el:$ui,items:array,set:filter.set}).on("checkBoxSelectionChanged",function(){isColumns?project.setColumnFilter(project.getColumnFilter(),!0):project.setRowFilter(project.getRowFilter(),!0)})}return-1!==index&&(""!==fieldName?(isColumns?project.getColumnFilter():project.getRowFilter()).set(index,filter):(isColumns?project.getColumnFilter():project.getRowFilter()).set(index,new morpheus.AlwaysTrueFilter(isColumns))),filter},addBase:function(){var html=[];return html.push('<div style="padding-bottom:2px;border-bottom:1px solid #eee" class="morpheus-entry">'),html.push('<div class="row">'),html.push('<div class="col-xs-12"><div class="checkbox"><label><input type="checkbox" name="filterMode">Pass all filters</label></div> </div>'),html.push("</div>"),html.push('<div class="row">'),html.push('<div class="col-xs-8"><a class="btn btn-default btn-xs" role="button" data-name="add" href="#">Add</a></div>'),html.push("</div>"),html.push("</div>"),html.join("")},add:function(filter){var project=this.project,isColumns=this.isColumns,fields=morpheus.MetadataUtil.getMetadataNames(isColumns?project.getFullDataset().getColumnMetadata():project.getFullDataset().getRowMetadata()),html=[];html.push('<div class="morpheus-entry">'),html.push('<div class="form-group">'),html.push("<label>Field</label>"),html.push('<select style="max-width:160px;overflow-x:hidden;" name="by" class="form-control input-sm">'),html.push('<option value=""></option>');var filterField=filter?filter.toString():null;return _.each(fields,function(field){html.push('<option value="'+field+'"'),field===filterField&&html.push(" selected"),html.push(">"),html.push(field),html.push("</option>")}),html.push("</select>"),html.push("</div>"),html.push('<div class="row">'),html.push('<div data-name="ui" class="col-xs-12"></div>'),html.push("</div>"),html.push('<div style="padding-bottom:6px; border-bottom:1px solid #eee" class="row">'),html.push('<div class="col-xs-11">'),html.push('<a class="btn btn-default btn-xs" role="button" data-name="delete" href="#">Remove</a>'),html.push("</div>"),html.push("</div>"),html.push("</div>"),html.join("")}},morpheus.FontChooser=function(options){var fontModel=options.fontModel,track=options.track,heatMap=options.heatMap;fontModel.getMappedValue(track.getVector(track.settings.fontField),track.getVector(track.settings.fontField).getValue(0));var formBuilder=new morpheus.FormBuilder;formBuilder.append({value:null!=track.settings.fontField,type:"checkbox",name:"use_another_annotation_to_determine_font"});var annotationNames=morpheus.MetadataUtil.getMetadataNames(track.isColumns?heatMap.getProject().getFullDataset().getColumnMetadata():heatMap.getProject().getFullDataset().getRowMetadata());annotationNames.splice(annotationNames.indexOf(track.getName()),1),formBuilder.append({name:"annotation_name",type:"bootstrap-select",options:annotationNames,search:annotationNames.length>10,value:track.settings.fontField}),formBuilder.setVisible("annotation_name",null!=track.settings.fontField),formBuilder.append({name:"selected_value",type:"bootstrap-select",search:!0,options:fontModel.getMap(null!=track.settings.fontField?track.settings.fontField:track.getName()).keys()});var $selectedValue=formBuilder.find("selected_value");formBuilder.append({name:"selected_font",type:"bootstrap-select",options:[{name:"normal",value:400},{name:"bold",value:700},{name:"bolder",value:900}]});var repaint=function(){track.setInvalid(!0),track.repaint()};formBuilder.find("use_another_annotation_to_determine_font").on("change",function(){var checked=$(this).prop("checked");formBuilder.setValue("annotation_name",null),formBuilder.setValue("selected_value",null),formBuilder.setVisible("annotation_name",checked),checked||(track.settings.fontField=null),repaint()}),formBuilder.find("annotation_name").on("change",function(){var annotationName=$(this).val();fontModel.getMappedValue(track.getVector(annotationName),track.getVector(annotationName).getValue(0)),track.settings.fontField=annotationName,formBuilder.setOptions("selected_value",fontModel.getMap(null!=track.settings.fontField?track.settings.fontField:track.getName()).keys()),formBuilder.setValue("selected_value",null),repaint()}),formBuilder.find("selected_font").on("change",function(e){fontModel.setMappedValue(track.getVector(track.settings.fontField),$selectedValue.val(),{weight:$(this).val()}),repaint()});var updateMappedValue=function(){var selectedVal=$selectedValue.val(),mappedValue=fontModel.getMappedValue(track.getVector(track.settings.fontField),selectedVal);formBuilder.setValue("selected_font",mappedValue.weight)};$selectedValue.on("change",function(){updateMappedValue()}),updateMappedValue(),this.$div=formBuilder.$form},morpheus.Util.extend(morpheus.FontChooser,morpheus.Events),morpheus.FormBuilder=function(options){var _this=this;this.prefix=_.uniqueId("form"),this.$form=$("<form></form>"),this.$form.attr("role","form").attr("id",this.prefix),this.formStyle=null==options||null==options.formStyle?"horizontal":options.formStyle,this.$form.addClass("morpheus"),"horizontal"===this.formStyle?(this.titleClass="col-xs-12 control-label",this.labelClass="col-xs-4 control-label",this.$form.addClass("form-horizontal")):"vertical"===this.formStyle?(this.labelClass="control-label",this.titleClass="control-label"):"inline"===this.formStyle&&(this.titleClass="",this.labelClass="",this.$form.addClass("form-inline")),this.$form.on("submit",function(e){e.preventDefault()}),this.$form.on("dragover",function(e){var node=$(e.originalEvent.srcElement).parent().parent().prev();node.is("select")&&node.hasClass("file-input")&&($(e.originalEvent.srcElement).parent().css("border","1px solid black"),e.preventDefault(),e.stopPropagation())}).on("dragenter",function(e){var node=$(e.originalEvent.srcElement).parent().parent().prev();node.is("select")&&node.hasClass("file-input")&&($(e.originalEvent.srcElement).parent().css("border","1px solid black"),e.preventDefault(),e.stopPropagation())}).on("dragleave",function(e){var node=$(e.originalEvent.srcElement).parent().parent().prev();node.is("select")&&node.hasClass("file-input")&&($(e.originalEvent.srcElement).parent().css("border",""),e.preventDefault(),e.stopPropagation())}).on("drop",function(e){var node=$(e.originalEvent.srcElement).parent().parent().prev();if(node.is("select")&&node.hasClass("file-input")){var isMultiple=node.data("multiple");$(e.originalEvent.srcElement).parent().css("border","");var name=node.attr("name");if(name=name.substring(0,name.length-"_picker".length),e.originalEvent.dataTransfer)if(e.originalEvent.dataTransfer.files.length){e.preventDefault(),e.stopPropagation();var files=e.originalEvent.dataTransfer.files;_this.setValue(name,isMultiple?files:files[0]),_this.trigger("change",{name:name,value:files[0]})}else{var url=e.originalEvent.dataTransfer.getData("URL");e.preventDefault(),e.stopPropagation(),_this.setValue(name,isMultiple?[url]:url),_this.trigger("change",{name:name,value:url})}}})},morpheus.FormBuilder.showProgressBar=function(options){var content=[];content.push('<div class="container-fluid">'),content.push('<div class="row">'),content.push('<div class="col-xs-8">'),content.push('<div class="progress progress-striped active"><div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div>'),content.push("</div>"),content.push('<div class="col-xs-2">'),content.push('<input class="btn btn-default" type="button" name="stop" value="Cancel">'),content.push("</div>"),content.push("</div>"),options.subtitle&&(content.push('<div class="row"><div class="col-xs-8">'),content.push('<p class="text-muted">'),content.push(options.subtitle),content.push("</p>"),content.push("</div></div>")),content.push("</div>");var $content=$(content.join(""));return $content.find("[name=stop]").on("click",function(e){options.stop(),e.preventDefault()}),morpheus.FormBuilder.showInDraggableDiv({title:options.title,$content:$content})},morpheus.FormBuilder.showInDraggableDiv=function(options){var width=options.width||"300px",html=[];html.push('<div style="z-index: 1050; top: 100px; position:absolute; padding-left:10px; padding-right:10px; width:'+width+' ; background:white; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 1px solid rgba(0,0,0,0.2); border-radius: 6px;">'),null!=options.title&&html.push('<h4 style="cursor:move; border-bottom: 1px solid #e5e5e5;" name="header">'+options.title+"</h4>"),html.push('<div name="content"></div>'),html.push("</div>");var $div=$(html.join("")),$content=$div.find("[name=content]");return $div.find("[name=header]").on("dblclick",function(){"none"===$content.css("display")?$content.css("display",""):$content.css("display","none")}),options.$content.appendTo($content),$div.css("left",$(window).width()/2-$content.outerWidth()/2),$div.draggable({containment:"document"}),$div.appendTo(null!=options.appendTo?options.appendTo:$(document.body)),$div},morpheus.FormBuilder.showMessageModal=function(options){var $div=morpheus.FormBuilder._showInModal({modalClass:options.modalClass,title:options.title,html:options.html,footer:'<button type="button" class="btn btn-default" data-dismiss="modal">OK</button>',backdrop:options.backdrop,size:options.size,focus:options.focus,appendTo:options.appendTo});return $div.find("button").focus(),$div},morpheus.FormBuilder._showInModal=function(options){var html=[];options=$.extend({},{size:"",close:!0,modalClass:""},options),html.push('<div tabindex="-1" class="modal'+(options.modalClass?" "+options.modalClass:"")+'" role="dialog" aria-hidden="false"'),options.z&&html.push(' style="z-index: '+options.z+' !important;"'),html.push(">"),html.push('<div class="modal-dialog '+options.size+'">'),html.push('<div class="modal-content">'),html.push(' <div class="modal-header">'),options.close&&html.push('  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>'),null!=options.title&&html.push('<h4 class="modal-title">'+options.title+"</h4>"),html.push("</div>"),html.push('<div class="modal-body">'),html.push("</div>"),options.footer&&(html.push('<div class="modal-footer">'),html.push(options.footer)),html.push("</div>"),html.push("</div>"),html.push("</div>"),html.push("</div>");var $div=$(html.join(""));return $div.on("mousewheel",function(e){e.stopPropagation()}),$div.find(".modal-body").html(options.html),$div.prependTo(null!=options.appendTo?options.appendTo:$(document.body)),$div.modal({keyboard:!0,backdrop:!0===options.backdrop}).on("hidden.bs.modal",function(e){$div.remove(),options.onClose&&options.onClose(),options.focus&&$(options.focus).focus()}),$div},morpheus.FormBuilder.showInModal=function(options){var $div=morpheus.FormBuilder._showInModal({modalClass:options.modalClass,title:options.title,html:options.html,footer:options.close?'<button type="button" class="btn btn-default" data-dismiss="modal">'+options.close+"</button>":null,onClose:options.onClose,appendTo:options.appendTo,backdrop:options.backdrop,size:options.size,focus:options.focus});options.draggable&&$div.draggable({handle:$div.find(".modal-header")})},morpheus.FormBuilder.showOkCancel=function(options){var footer=[];(options=$.extend({},{ok:!0,cancel:!0},options)).ok&&footer.push('<button name="ok" type="button" class="btn btn-default">OK</button>'),options.apply&&footer.push('<button name="apply" type="button" class="btn btn-default">Apply</button>'),options.cancel&&footer.push('<button name="cancel" type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>');var $div=morpheus.FormBuilder._showInModal({title:options.title,html:options.content,footer:footer.join(""),size:options.size,close:options.close,onClose:options.onClose,focus:options.focus,appendTo:options.appendTo}),$ok=$div.find("[name=ok]");return $ok.on("click",function(e){options.okCallback&&options.okCallback(),$div.modal("hide")}),$div.find("[name=cancel]").on("click",function(e){options.cancelCallback&&options.cancelCallback(),$div.modal("hide")}),options.okFocus&&$ok.focus(),options.draggable&&$div.draggable({handle:".modal-header",containment:"document"}),$div},morpheus.FormBuilder.hasChanged=function(object,keyToUIElement){for(var keys=_.keys(keyToUIElement),i=0;i<keys.length;i++){var key=keys[i],value=object[key],$element=keyToUIElement[key];if(value!==morpheus.FormBuilder.getValue($element))return!0}return!1},morpheus.FormBuilder.getValue=function($element){var list=$element.data("morpheus.checkbox-list");return null!=list?list.val():"radio"===$element.attr("type")?$element.filter(":checked").val():"file"===$element.data("type")?$element.data("files"):"checkbox"===$element.attr("type")?$element.prop("checked"):$element.val()},morpheus.FormBuilder.prototype={appendContent:function($content){this.$form.append($content)},addSeparator:function(){var html=[];html.push('<div class="form-group">'),"horizontal"===this.formStyle&&html.push('<div class="col-xs-12">'),html.push("<hr />"),"horizontal"===this.formStyle&&html.push("</div>"),html.push("</div>"),this.$form.append(html.join(""))},_append:function(html,field,isFieldStart){var _this=this,required=field.required,name=field.name,type=field.type;if("separator"==type)return"horizontal"===this.formStyle?html.push('<div class="col-xs-12">'):html.push('<div class="form-group">'),html.push("<hr />"),void html.push("</div>");var title=field.title,disabled=field.disabled,help=field.help,value=field.value,showLabel=field.showLabel,style=field.style||"",col="";"horizontal"===this.formStyle&&(col=field.col||"col-xs-8"),void 0===showLabel&&(showLabel=(showLabel="checkbox"!==type&&"button"!==type&&"radio"!==type)||void 0!==field.options);var id=_this.prefix+"_"+name;void 0===title&&(title=(title=name.replace(/_/g," "))[0].toUpperCase()+title.substring(1));var endingDiv=!1;if(showLabel?(html.push('<label for="'+id+'" class="'+this.labelClass+'">'),html.push(title),html.push("</label>"),isFieldStart&&"inline"!==this.formStyle&&(html.push('<div class="'+col+'">'),endingDiv=!0)):isFieldStart&&"horizontal"===this.formStyle&&(html.push('<div class="col-xs-offset-4 '+col+'">'),endingDiv=!0),"radio"===type)field.options?_.each(field.options,function(choice){var isChoiceObject=_.isObject(choice)&&void 0!==choice.value,optionValue=isChoiceObject?choice.value:choice,optionText=isChoiceObject?choice.name:choice,selected=value===optionValue;html.push('<div class="radio"><label>'),html.push('<input style="'+style+'" value="'+optionValue+'" name="'+field.name+'" type="radio"'),selected&&html.push(" checked"),html.push("> "),choice.icon&&html.push('<span class="'+choice.icon+'"></span> '),optionText=optionText[0].toUpperCase()+optionText.substring(1),html.push(optionText),html.push("</label></div>")}):(html.push('<div class="radio"><label>'),html.push('<input style="'+style+'" value="'+value+'" name="'+name+'" id="'+id+'" type="radio"'),field.checked&&html.push(" checked"),html.push("> "),html.push(value[0].toUpperCase()+value.substring(1)),html.push("</label></div>"));else if("checkbox"===type)html.push('<div class="checkbox"><label>'),html.push('<input style="'+style+'" name="'+name+'" id="'+id+'" type="checkbox"'),value&&html.push(" checked"),disabled&&html.push(" disabled"),html.push("> "),html.push(title),html.push("</label></div>");else if("checkbox-list"===type)html.push('<div name="'+name+'" class="checkbox-list"><div>');else if("select"==type||"bootstrap-select"==type)"bootstrap-select"==type?html.push('<select style="'+style+'" data-live-search="'+!!field.search+'" data-selected-text-format="count" name="'+name+'" id="'+id+'" data-actions-box="'+!!field.selectAll+'" class="selectpicker'+("inline"!==this.formStyle?" form-control":"")+'"'):html.push('<select style="'+style+'" name="'+name+'" id="'+id+'" class="form-control"'),disabled&&html.push(" disabled"),field.multiple&&html.push(" multiple"),html.push(">"),_.each(field.options,function(choice){if(choice&&choice.divider)html.push('<option data-divider="true"></option>');else{html.push('<option value="');var isChoiceObject=_.isObject(choice)&&void 0!==choice.value,optionValue=isChoiceObject?choice.value:choice,optionText=isChoiceObject?choice.name:choice;html.push(optionValue),html.push('"');(_.isObject(value)?value[optionValue]:_.isArray(value)?-1!==value.indexOf(optionValue):value==optionValue)&&html.push(" selected"),html.push(">"),html.push(optionText),html.push("</option>")}}),html.push("</select>"),"bootstrap-select"==field.type&&field.toggle&&(html.push('<p class="help-block"><a data-name="'+name+'_all" href="#">All</a>&nbsp;|&nbsp;<a data-name="'+name+'_none" href="#">None</a></p>'),_this.$form.on("click","[data-name="+name+"_all]",function(evt){evt.preventDefault();var $select=_this.$form.find("[name="+name+"]");$select.selectpicker("val",$.map($select.find("option"),function(o){return $(o).val()})),$select.trigger("change")}),_this.$form.on("click","[data-name="+name+"_none]",function(evt){evt.preventDefault();var $select=_this.$form.find("[name="+name+"]");$select.selectpicker("val",[]),$select.trigger("change")}));else if("textarea"==type)html.push('<textarea style="'+style+'" id="'+id+'" class="form-control" name="'+name+'"'),required&&html.push(" required"),field.placeholder&&html.push(' placeholder="'+field.placeholder+'"'),disabled&&html.push(" disabled"),html.push(">"),null!=value&&html.push(value),html.push("</textarea>");else if("button"==type)html.push('<button style="'+style+'" id="'+id+'" name="'+name+'" type="button" class="btn btn-default btn-sm">'),field.icon&&html.push('<span class="'+field.icon+'"></span> '),html.push(value||title),html.push("</button>");else if("custom"===type)html.push(value);else if("file"===type){var isMultiple=null!=field.multiple&&field.multiple;html.push('<select data-multiple="'+isMultiple+'" data-type="file" title="'+(field.placeholder||(isMultiple?"Choose one or more files...":"Choose a file..."))+'" name="'+name+'_picker" data-width="35%" class="file-input selectpicker form-control">');var options=[];field.options&&(options=options.concat(field.options)),options.push("My Computer"),options.push("URL"),null!=field.text&&options.push(field.text),_.each(options,function(choice,index){var isChoiceObject=_.isObject(choice)&&void 0!==choice.value,optionValue=isChoiceObject?choice.value:choice,optionText=isChoiceObject?choice.name:choice;html.push('<option value="'),html.push(optionValue),html.push('"'),isChoiceObject&&choice.disabled&&html.push(" disabled"),"Dropbox"===optionValue?html.push(' data-icon="fa fa-dropbox"'):"My Computer"===optionValue?html.push(' data-icon="fa fa-desktop"'):"URL"===optionValue&&html.push(' data-icon="fa fa-external-link"'),html.push(">"),html.push(optionText),html.push("</option>")}),html.push("</select>"),html.push("<div>"),html.push('<input placeholder="'+(isMultiple?"Enter one or more URLs":"Enter a URL")+'" class="form-control" style="width:50%; display:none;" type="text" name="'+name+'_url">'),field.text&&html.push('<input class="form-control" style="width:50%; display:none;" type="text" name="'+name+'_text">'),html.push("</div>"),html.push('<input style="display:none;" type="file" name="'+name+'_file"'+(isMultiple?" multiple":"")+">"),_this.$form.on("change","[name="+name+"_picker]",function(evt){var val=$(this).val(),showUrlInput="URL"===val,showTextInput=val===field.text;if("Dropbox"===val){var options={success:function(results){var val=isMultiple?results.map(function(result){return result.link}):results[0].link;_this.setValue(name,val),_this.trigger("change",{name:name,value:val})},linkType:"direct",multiselect:isMultiple};Dropbox.choose(options),_this.$form.find("[name="+name+"_picker]").selectpicker("val","")}else"My Computer"===val&&(_this.$form.find("[name="+name+"_file]").click(),_this.$form.find("[name="+name+"_picker]").selectpicker("val",""));_this.$form.find("[name="+name+"_url]").css("display",showUrlInput?"":"none"),_this.$form.find("[name="+name+"_text]").css("display",showTextInput?"":"none")}),_this.$form.on("keyup","[name="+name+"_url]",function(evt){var text=$.trim($(this).val());isMultiple&&(text=text.split(",").filter(function(t){return""!==(t=$.trim(t))})),_this.setValue(name,text),13===evt.which&&_this.trigger("change",{name:name,value:text})}),_this.$form.on("keyup","[name="+name+"_text]",function(evt){var text=$.trim($(this).val());_this.setValue(name,text),13===evt.which&&_this.trigger("change",{name:name,value:text})}),_this.$form.on("change","[name="+name+"_file]",function(evt){var files=evt.target.files;_this.setValue(name,isMultiple?files:files[0]),_this.trigger("change",{name:name,value:isMultiple?files:files[0]})})}else"div"===(type=null==type?"text":type)?html.push('<div name="'+name+'" id="'+id+'"'):html.push('<input style="'+style+'" type="'+type+'" class="form-control" name="'+name+'" id="'+id+'"'),null!=value&&html.push(' value="'+value+'"'),field.placeholder&&html.push(' placeholder="'+field.placeholder+'"'),null!=field.min&&html.push(' min="'+field.min+'"'),null!=field.max&&html.push(' max="'+field.max+'"'),field.step&&html.push(' step="'+field.step+'"'),required&&html.push(" required"),disabled&&html.push(" disabled"),null!=field.autocomplete&&html.push(' autocomplete="'+field.autocomplete+'"'),html.push(">"),"div"===type&&html.push("</div>");return void 0!==help&&(html.push('<span data-name="'+name+'_help" class="help-block">'),html.push(help),html.push("</span>")),endingDiv},append:function(fields){var html=[],_this=this;morpheus.Util.isArray(fields)||(fields=[fields]),html.push('<div class="form-group">');_.each(fields,function(field,index){_this._append(html,field,0===index)}),html.push("</div>");var $div=$(html.join(""));this.$form.append($div);var checkBoxLists=$div.find(".checkbox-list");if(checkBoxLists.length>0){var checkBoxIndex=0;_.each(fields,function(field){if("checkbox-list"===field.type){var list=new morpheus.CheckBoxList({responsive:!1,$el:$(checkBoxLists[checkBoxIndex]),items:field.options});$(checkBoxLists[checkBoxIndex]).data("morpheus.checkbox-list",list),checkBoxIndex++}})}$div.find(".selectpicker").selectpicker({iconBase:"fa",tickIcon:"fa-check",style:"btn-default btn-sm"})},clear:function(){this.$form.empty()},getValue:function(name){var $v=this.$form.find("[name="+name+"]");return 0===$v.length&&($v=this.$form.find("[name="+name+"_picker]")),morpheus.FormBuilder.getValue($v)},setOptions:function(name,options,selectFirst){var $select=this.$form.find("[name="+name+"]"),checkBoxList=$select.data("morpheus.checkbox-list");if(checkBoxList)checkBoxList.setItems(options);else{var html=[],selection=$select.val();_.each(options,function(choice){var isChoiceObject=_.isObject(choice)&&void 0!==choice.value;if(choice&&choice.divider)html.push('<option data-divider="true"></option>');else{html.push('<option value="');var optionValue=isChoiceObject?choice.value:choice,optionText=isChoiceObject?choice.name:choice;html.push(optionValue),html.push('"'),html.push(">"),html.push(optionText),html.push("</option>")}}),$select.html(html.join("")),$select.val(selection),selectFirst&&null==$select.val()&&$select[0].options.length>0&&$select.val($select[0].options[0].value),$select.hasClass("selectpicker")&&($select.selectpicker("refresh"),$select.selectpicker("render"))}},find:function(name){return this.$form.find("[name="+name+"]")},setHelpText:function(name,value){this.$form.find("[data-name="+name+"_help]").html(value)},setValue:function(name,value){var v=this.$form.find("[name="+name+"]");if(0===v.length&&"file"===(v=this.$form.find("[name="+name+"_picker]")).data("type"))return v.val(value),v.selectpicker("render"),void v.data("files",value);var type=v.attr("type"),list=v.data("morpheus.checkbox-list");list?list.setValue(value):("radio"===type?v.filter("[value="+value+"]").prop("checked",!0):"checkbox"===type?v.prop("checked",value):v.val(value),v.hasClass("selectpicker")&&v.selectpicker("render"))},setVisible:function(name,visible){var $div=this.$form.find("[name="+name+"]").parents(".form-group");visible?$div.show():$div.hide()},remove:function(name){this.$form.find("[name="+name+"]").parents(".form-group").remove()},setEnabled:function(name,enabled){var $div=this.$form.find("[name="+name+"]");$div.attr("disabled",!enabled),enabled?$div.parents(".form-group").find("label").removeClass("text-muted"):$div.parents(".form-group").find("label").addClass("text-muted")}},morpheus.Util.extend(morpheus.FormBuilder,morpheus.Events),morpheus.GradientColorSupplier=function(){morpheus.AbstractColorSupplier.call(this),this._updateScale()},morpheus.GradientColorSupplier.prototype={createInstance:function(){return new morpheus.GradientColorSupplier},getColor:function(row,column,value){if(isNaN(value))return this.missingColor;var min=this.min,max=this.max,colors=this.colors;if(value<=min)return colors[0];if(value>=max)return colors[colors.length-1];var fraction=morpheus.SteppedColorSupplier.linearScale(value,min,max,0,100)/100;return this.colorScale(fraction)},setFractions:function(options){morpheus.AbstractColorSupplier.prototype.setFractions.call(this,options),this._updateScale()},_updateScale:function(){this.colorScale=d3.scale.linear().domain(this.fractions).range(this.colors).clamp(!0)}},morpheus.Util.extend(morpheus.GradientColorSupplier,morpheus.AbstractColorSupplier),morpheus.Grid=function(options){this.options=options;var grid,_this=this;this.items=options.items,this.modelToView=null,this.viewOrder=null,this.filter=new morpheus.CombinedGridFilter;var model={getLength:function(){return null!=_this.viewOrder?_this.viewOrder.length:_this.items.length},getItem:function(index){return _this.items[null!=_this.viewOrder?_this.viewOrder[index]:index]}};this.$el=options.$el;var gridOptions=$.extend({},{select:!0,headerRowHeight:0,showHeaderRow:!1,multiColumnSort:!0,multiSelect:!1,topPanelHeight:0,enableColumnReorder:!1,enableTextSelectionOnCells:!0,forceFitColumns:!0,dataItemColumnValueExtractor:function(item,column){return column.getter(item)},defaultFormatter:function(row,cell,value,columnDef,dataContext){if(_.isNumber(value))return morpheus.Util.nf(value);if(morpheus.Util.isArray(value)){for(var s=[],i=0,length=value.length;i<length;i++){i>0&&s.push(", ");value[i];s.push(value[i])}return s.join("")}return value}},options.gridOptions||{});if(grid=new Slick.Grid(options.$el,model,options.columns,gridOptions),this.grid=grid,grid.registerPlugin(new morpheus.AutoTooltips2),grid.onCellChange.subscribe(function(e,args){_this.trigger("edit",args)}),gridOptions.select&&(grid.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:!0,multiSelect:gridOptions.multiSelect})),grid.getSelectionModel().onSelectedRangesChanged.subscribe(function(e){var nitems=grid.getDataLength();_this.trigger("selectionChanged",{selectedRows:grid.getSelectedRows().filter(function(row){return row>=0&&row<=nitems})})})),grid.onSort.subscribe(function(e,args){_this.sortCols=args.sortCols,_this._updateMappings(),grid.invalidate()}),options.$el.on("click",function(e){var cell=grid.getCellFromEvent(e);cell&&_this.trigger("click",{row:cell.row,target:e.target})}),options.$el.on("dblclick",function(e){var cell=grid.getCellFromEvent(e);cell&&_this.trigger("dblclick",{row:cell.row,target:e.target})}),options.sort){var gridSortColumns=[],gridColumns=grid.getColumns();options.sort.forEach(function(c){for(var column=null,i=0;i<gridColumns.length;i++)if(gridColumns[i].name===c.name){column=gridColumns[i];break}null!=column?gridSortColumns.push({columnId:column.id,sortAsc:c.sortAsc}):console.log(c.name+" not found.")}),this.setSortColumns(gridSortColumns)}this.grid.invalidate()},morpheus.Grid.prototype={columnsAutosized:!1,setSortColumns:function(gridSortColumns){this.grid.setSortColumns(gridSortColumns),this.sortCols=[];for(var i=0;i<gridSortColumns.length;i++){var column=this.grid.getColumns()[this.grid.getColumnIndex(gridSortColumns[i].columnId)];if(null==column)throw"Unable to find column "+gridSortColumns[i];this.sortCols.push({sortCol:column,sortAsc:gridSortColumns[i].sortAsc})}this._updateMappings(),this.grid.invalidate()},setColumns:function(columns){this.grid.setColumns(columns),this.grid.resizeCanvas(),this.grid.invalidate()},getColumns:function(){return this.grid.getColumns()},getSelectedRows:function(){var nitems=this.grid.getDataLength();return this.grid.getSelectedRows().filter(function(row){return row>=0&&row<=nitems})},getSelectedItems:function(){for(var rows=this.grid.getSelectedRows(),selection=[],i=0,nrows=rows.length;i<nrows;i++)selection.push(this.items[this.convertViewIndexToModel(rows[i])]);return selection},getSelectedItem:function(){var rows=this.grid.getSelectedRows();return 1===rows.length?this.items[this.convertViewIndexToModel(rows[0])]:null},getItems:function(){for(var items=[],i=0,length=this.getFilteredItemCount();i<length;i++)items.push(this.items[this.convertViewIndexToModel(i)]);return items},getAllItemCount:function(){return this.items.length},getAllItems:function(){return this.items},getFilteredItemCount:function(){return this.viewOrder?this.viewOrder.length:this.items.length},redraw:function(){this.grid.invalidate()},redrawRows:function(rows){this.grid.invalidateRows(rows),this.grid.render()},setItems:function(items){this.items=items,this.grid.getSelectionModel()&&this.grid.setSelectedRows([]),this.setFilter(this.filter),this.maybeAutoResizeColumns()},maybeAutoResizeColumns:function(){this.columnsAutosized||this.autosizeColumns()},convertModelIndexToView:function(modelIndex){if(null!==this.modelToView){var index=this.modelToView.get(modelIndex);return void 0!==index?index:-1}return modelIndex},convertViewIndexToModel:function(viewIndex){return null!=this.viewOrder?viewIndex<this.viewOrder.length&&viewIndex>=0?this.viewOrder[viewIndex]:-1:viewIndex},_updateMappings:function(){var selectedViewIndices=null!=this.grid.getSelectionModel()?this.grid.getSelectedRows():null,selectedModelIndices=[];if(selectedViewIndices)for(var i=0,length=selectedViewIndices.length;i<length;i++)selectedModelIndices.push(this.convertViewIndexToModel(selectedViewIndices[i]));if(this.viewOrder=null,null!=this.filter&&(this.filter.init(),!this.filter.isEmpty())){this.viewOrder=[];for(i=0,length=this.items.length;i<length;i++)this.filter.accept(this.items[i])&&this.viewOrder.push(i)}var cols=this.sortCols;if(cols&&cols.length>0){if(null==this.viewOrder){this.viewOrder=[];for(i=0,length=this.items.length;i<length;i++)this.viewOrder.push(i)}var ncols=cols.length,items=this.items;this.viewOrder.sort(function(index1,index2){for(var i=0;i<ncols;i++){var getter=cols[i].sortCol.getter,result=(cols[i].sortAsc?morpheus.SortKey.ASCENDING_COMPARATOR:morpheus.SortKey.DESCENDING_COMPARATOR)(getter(items[index1]),getter(items[index2]));if(0!==result)return result}return 0})}if(null!=this.viewOrder){this.modelToView=new morpheus.Map;for(i=0,length=this.viewOrder.length;i<length;i++)this.modelToView.set(this.viewOrder[i],i)}else this.modelToView=null;if(null!=this.grid.getSelectionModel()){var newSelectedViewIndices=[];for(i=0,length=selectedModelIndices.length;i<length;i++){var index=this.convertModelIndexToView(selectedModelIndices[i]);void 0!==index&&newSelectedViewIndices.push(index)}this.grid.setSelectedRows(newSelectedViewIndices)}},setSelectedRows:function(rows){this.grid.setSelectedRows(rows)},setFilter:function(filter){this.filter=filter,this._updateMappings(),this.grid.invalidate(),this.trigger("filter")},getFilter:function(){return this.filter},autosizeColumns:function(){var columns=this.grid.getColumns(),items=this.getItems();if(items&&0!==items.length&&columns&&0!==columns.length){var gridWidth=this.options.$el.width()-30;if(!(gridWidth<=0)&&(this.columnsAutosized=!0,columns.length>-1)){var div=document.createElement("div");document.body.appendChild(div);var $d=$(div);$d.css({position:"absolute",left:-1e3,top:-1e3});var $row=$('<div class="slick-table"><div class="ui-state-default slick-header-column slick-header-sortable ui-sortable-handle"></div><div class="ui-widget-content slick-row"><div class="slick-cell selected"></div></div></div>'),$cell=$row.find(".slick-cell"),$header=$row.find(".slick-header-column");$row.appendTo($d);for(var maxWidth=Math.min(parseInt(gridWidth/2),400),getColumnWidth=function(column){var w=$header.html(column.name).outerWidth()+13;if(column.prototypeValue)$cell.html(column.prototypeValue),w=Math.max($cell.outerWidth(),w);else for(var i=0,nrows=Math.min(items.length,10);i<nrows;i++){var html=column.formatter(i,null,column.getter(items[i]),column,items[i]),$html=$(html);$html.find(".slick-cell-wrapper").attr("class",""),$cell.html($html),w=Math.max($cell.outerWidth(),w)}column.width=parseInt(Math.min(maxWidth,w))},i=0;i<columns.length;i++)getColumnWidth(columns[i]),columns[i].width;$d.remove(),this.grid.resizeCanvas()}}}},morpheus.Util.extend(morpheus.Grid,morpheus.Events),morpheus.AutoTooltips2=function(options){var _grid;function hideToolTip(e){var cell=_grid.getCellFromEvent(e);if(cell){var $node=$(_grid.getCellNode(cell.row,cell.cell));$node.data("bs.tooltip")&&$node.tooltip("hide")}}function hideAll(){$(_grid.getCanvasNode()).find("[data-original-title]").attr("data-original-title","").tooltip("hide")}function showToolTip(e){var cell=_grid.getCellFromEvent(e);if(cell){var $node=$(_grid.getCellNode(cell.row,cell.cell)),text="",c=_grid.getColumns()[cell.cell],show=!1,$checkNode=$node.find(".slick-cell-wrapper");if(c.alwaysShowTooltip||$checkNode[0].scrollWidth>$checkNode[0].offsetWidth){var item=_grid.getDataItem(cell.row);text=c.tooltip(item,c.getter(item)),show=!0}$node.attr("data-original-title",text);var hasTip=$node.data("bs.tooltip");hasTip||$node.tooltip({placement:"auto",html:!0,container:"body",trigger:"manual"}),show?$node.tooltip("show"):hasTip&&$node.tooltip("hide")}}$.extend(this,{init:function(grid){_grid=grid,$(_grid.getCanvasNode()).on("mouseover",".slick-row",showToolTip),$(_grid.getCanvasNode()).on("mouseout",".slick-row",hideToolTip),$(_grid.getCanvasNode()).on("mouseup",hideAll)},destroy:function(){$(_grid.getCanvasNode()).off("mouseover",showToolTip),$(_grid.getCanvasNode()).off("mouseout",hideToolTip),$(_grid.getCanvasNode()).off("mouseup",hideAll)}})},morpheus.CombinedGridFilter=function(){this.filters=[]},morpheus.CombinedGridFilter.prototype={add:function(filter){this.filters.push(filter)},getFilters:function(){return this.filters},get:function(index){return this.filters[index]},set:function(index,f){this.filters[index]=f},init:function(){for(var i=0;i<this.filters.length;i++)this.filters[i].init();this.activeFilters=this.filters.filter(function(f){return!f.isEmpty()}),this.nActiveFilters=this.activeFilters.length},accept:function(item){for(var i=0;i<this.nActiveFilters;i++)if(!this.activeFilters[i].accept(item))return!1;return!0},isEmpty:function(){return 0===this.activeFilters.length}},morpheus.HeatMapColorSchemeChooser=function(options){var _this=this;this.$div=$("<div></div>"),this.currentValue=null,this.legend=new morpheus.LegendWithStops,this.colorScheme=options.colorScheme||new morpheus.HeatMapColorScheme(new morpheus.Project(new morpheus.Dataset({rows:0,columns:0}))),this.legend.on("added",function(e){var fractions=_this.colorScheme.getFractions();fractions.push(e.fraction);var colors=_this.colorScheme.getColors();colors.push("black"),_this.colorScheme.setFractions({fractions:fractions,colors:colors});var newIndex=_this.getFractionIndex(e.fraction,"black");_this.setSelectedIndex(newIndex),_this.fireChanged()}).on("selectedIndex",function(e){_this.setSelectedIndex(e.selectedIndex)}).on("delete",function(index){_this.deleteSelectedStop()}).on("moved",function(e){var fraction=e.fraction,fractions=_this.colorScheme.getFractions();fractions[_this.legend.selectedIndex]=fraction;var color=_this.colorScheme.getColors()[_this.legend.selectedIndex];_this.colorScheme.setFractions({fractions:fractions,colors:_this.colorScheme.getColors()}),_this.legend.selectedIndex=_this.getFractionIndex(e.fraction,color);var fractionToValue=d3.scale.linear().domain([0,1]).range([_this.colorScheme.getMin(),_this.colorScheme.getMax()]).clamp(!0);_this.formBuilder.setValue("selected_value",fractionToValue(fractions[_this.legend.selectedIndex])),_this.fireChanged()});var $row=$("<div></div>");$row.css("height","50px").css("width","300px").css("margin-left","auto").css("margin-right","auto"),$row.appendTo(this.$div),$(this.legend.canvas).appendTo($row);var formBuilder=new morpheus.FormBuilder,items=[];items=items.concat({name:"selected_color",type:"color",style:"max-width: 50px;"},{name:"selected_value",type:"text",style:"max-width: 100px;"},[{name:"delete",type:"button",value:"Delete Selected Color Stop"},{name:"add",type:"button",value:"Add Color Stop"}],{name:"minimum",type:"text",style:"max-width: 100px;"},{name:"maximum",type:"text",style:"max-width: 100px;"}),options.showRelative&&(items=(items=items.concat({name:"relative_color_scheme",type:"checkbox",help:"A relative color scheme uses the minimum and maximum values in each row to convert values to colors"})).concat({name:"transform_values",type:"select",value:0,options:[{name:"None",value:0},{name:"Subtract row mean, divide by row standard deviation",value:morpheus.AbstractColorSupplier.Z_SCORE},{name:"Subtract row median, divide by row median absolute deviation",value:morpheus.AbstractColorSupplier.ROBUST_Z_SCORE}]})),(items=items.concat({name:"missing_color",type:"color",style:"max-width: 50px;"})).push({name:"stepped_colors",type:"checkbox",value:!1,help:"Intervals include left end point and exclude right end point, except for the highest interval"}),_.each(items,function(item){formBuilder.append(item)}),this.getFractionIndex=function(fraction,color){for(var fractions=_this.colorScheme.getFractions(),colors=_this.colorScheme.getColors(),i=0,len=fractions.length;i<len;i++)if(fractions[i]===fraction&&colors[i]===color)return i;return-1},formBuilder.$form.appendTo(this.$div),formBuilder.$form.find("[name^=selected],[name=delete]").prop("disabled",!0),formBuilder.$form.find("[name=add]").on("click",function(e){for(var fractions=_this.colorScheme.getFractions(),val=.5;val>=0&&-1!==_.indexOf(fractions,val);)val-=.1;val=Math.max(0,val),fractions.push(val);var colors=_this.colorScheme.getColors();colors.push("black"),_this.colorScheme.setFractions({fractions:fractions,colors:colors});var newIndex=_this.getFractionIndex(e.fraction,"black");_this.setSelectedIndex(newIndex),_this.fireChanged()}),formBuilder.$form.find("[name=delete]").on("click",function(e){_this.deleteSelectedStop()}),formBuilder.$form.find("[name=transform_values]").on("change",function(e){_this.colorScheme.setTransformValues(parseInt(formBuilder.getValue("transform_values"))),_this.fireChanged()}),formBuilder.$form.on("keyup","[name=selected_value]",_.debounce(function(e){var val=parseFloat($(this).val());isNaN(val)||(_this.setSelectedValue(val),_this.fireChanged())},100)),formBuilder.$form.on("change","[name=selected_color]",function(e){var colors=_this.colorScheme.getColors();colors[_this.legend.selectedIndex]=$(this).val(),_this.colorScheme.setFractions({fractions:_this.colorScheme.getFractions(),colors:colors}),_this.fireChanged()}),formBuilder.$form.on("change","[name=missing_color]",function(e){var color=$(this).val();_this.colorScheme.setMissingColor(color),_this.fireChanged(!1)}),formBuilder.$form.on("change","[name=stepped_colors]",function(e){_this.colorScheme.setStepped($(this).prop("checked")),_this.fireChanged()}),formBuilder.$form.on("keyup","[name=minimum]",_.debounce(function(e){var val=parseFloat($(this).val());isNaN(val)||(_this.colorScheme.setMin(val),_this.setSelectedIndex(_this.legend.selectedIndex),_this.fireChanged(!1))},100)),formBuilder.$form.on("keyup","[name=maximum]",_.debounce(function(e){var val=parseFloat($(this).val());isNaN(val)||(_this.colorScheme.setMax(val),_this.setSelectedIndex(_this.legend.selectedIndex),_this.fireChanged(!1))},100)),formBuilder.$form.on("change","[name=relative_color_scheme]",_.throttle(function(e){_this.legend.selectedIndex=-1;var scalingMode=$(this).prop("checked")?morpheus.HeatMapColorScheme.ScalingMode.RELATIVE:morpheus.HeatMapColorScheme.ScalingMode.FIXED;_this.colorScheme.setScalingMode(scalingMode),_this.setColorScheme(_this.colorScheme),_this.fireChanged()},100)),this.formBuilder=formBuilder},morpheus.HeatMapColorSchemeChooser.prototype={deleteSelectedStop:function(){var fractions=this.colorScheme.getFractions();fractions.splice(this.legend.selectedIndex,1);var colors=this.colorScheme.getColors();colors.splice(this.legend.selectedIndex,1),this.colorScheme.setFractions({fractions:fractions,colors:colors}),this.formBuilder.$form.find("[name^=selected],[name=delete]").prop("disabled",!0),this.legend.setSelectedIndex(-1),this.fireChanged()},setSelectedValue:function(val){var valueToFraction=d3.scale.linear().domain([this.colorScheme.getMin(),this.colorScheme.getMax()]).range([0,1]).clamp(!0),fractions=this.colorScheme.getFractions(),fraction=valueToFraction(val);fractions[this.legend.selectedIndex]=fraction;var color=this.colorScheme.getColors()[this.legend.selectedIndex];this.colorScheme.setFractions({fractions:fractions,colors:this.colorScheme.getColors()}),this.legend.selectedIndex=this.getFractionIndex(fraction,color)},setSelectedIndex:function(index){var fractions=this.colorScheme.getFractions();index>=fractions.length&&(index=-1),this.legend.setSelectedIndex(index);var formBuilder=this.formBuilder;if(formBuilder.$form.find("[name^=selected],[name=delete]").prop("disabled",-1===this.legend.selectedIndex),-1!==this.legend.selectedIndex){var fractionToValue=d3.scale.linear().domain([0,1]).range([this.colorScheme.getMin(),this.colorScheme.getMax()]).clamp(!0);formBuilder.setValue("selected_value",fractionToValue(fractions[this.legend.selectedIndex]));var context=this.legend.canvas.getContext("2d"),colors=this.colorScheme.getColors();context.fillStyle=colors[this.legend.selectedIndex],formBuilder.setValue("selected_color",context.fillStyle)}else formBuilder.setValue("selected_value","");this.draw()},setMinMax:function(){this.colorScheme.getScalingMode()===morpheus.HeatMapColorScheme.ScalingMode.RELATIVE&&(this.colorScheme.setMin(0),this.colorScheme.setMax(1))},dispose:function(){this.off("change"),this.legend.destroy(),this.formBuilder.$form.off("keyup","input"),this.formBuilder.$form.off("change","[name=relative_color_scheme]")},restoreCurrentValue:function(){this.colorScheme.setCurrentValue&&this.colorScheme.setCurrentValue(this.currentValue)},setCurrentValue:function(value){this.currentValue=value,this.colorScheme&&this.colorScheme.setCurrentValue&&this.colorScheme.setCurrentValue(this.currentValue),this.setColorScheme(this.colorScheme)},setColorScheme:function(colorScheme){this.colorScheme=colorScheme,this.setMinMax(),colorScheme.setCurrentValue&&colorScheme.setCurrentValue(this.currentValue),this.formBuilder.setValue("relative_color_scheme",colorScheme.getScalingMode()===morpheus.HeatMapColorScheme.ScalingMode.RELATIVE),this.formBuilder.setValue("transform_values",colorScheme.getTransformValues()),this.formBuilder.setEnabled("transform_values",colorScheme.getScalingMode()!==morpheus.HeatMapColorScheme.ScalingMode.RELATIVE),this.formBuilder.$form.find("[name=minimum],[name=maximum]").prop("disabled",colorScheme.getScalingMode()===morpheus.HeatMapColorScheme.ScalingMode.RELATIVE),this.formBuilder.setValue("minimum",this.colorScheme.getMin()),this.formBuilder.setValue("maximum",this.colorScheme.getMax()),this.formBuilder.setValue("stepped_colors",this.colorScheme.isStepped()),this.formBuilder.setValue("missing_color",this.colorScheme.getMissingColor()),this.draw()},getFractionToStopPix:function(){return d3.scale.linear().clamp(!0).domain([0,1]).range([this.legend.border,this.legend.getUnscaledWidth()-this.legend.border])},fireChanged:function(noreset){this.trigger("change"),!1!==noreset&&this.setColorScheme(this.colorScheme)},draw:function(){var colorScheme=this.colorScheme;colorScheme.getScalingMode()===morpheus.HeatMapColorScheme.ScalingMode.RELATIVE&&(colorScheme.setMin(0),colorScheme.setMax(1));var fractions=colorScheme.getFractions(),colors=colorScheme.getColors(),fractionToStopPix=this.getFractionToStopPix();this.legend.draw(fractions,colors,colorScheme.isStepped(),fractionToStopPix)}},morpheus.Util.extend(morpheus.HeatMapColorSchemeChooser,morpheus.Events),morpheus.HeatMapColorSchemeLegend=function(heatMap,$keyContent){var totalHeight,colorScheme=heatMap.heatmap.getColorScheme(),colorByValues=colorScheme.getColorByValues();$keyContent.empty();var ntracks=colorByValues.length;colorByValues.forEach(function(value){if(null!=value||1===ntracks){if("null"!=value){var $label=$('<div style="overflow:hidden;text-overflow: ellipsis;width:250px;max-width:250px;">'+value+"</div>");$keyContent.append($label),totalHeight+=$label.height()}var trackLegend=new morpheus.ColorSupplierLegend(colorScheme,value);$(trackLegend.canvas).css("position",""),trackLegend.repaint(),trackLegend.on("selectionChanged",function(){heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint()}),$keyContent.append($(trackLegend.canvas)),totalHeight+=trackLegend.getUnscaledHeight()}}),heatMap.options.$key&&($keyContent.append(heatMap.options.$key),totalHeight+=heatMap.options.$key.height());var $edit=$('<div style="padding-left:4px; display:inline;"><a data-name="options" href="#">Edit</a></div>');$edit.find("[data-name=options]").on("click",function(e){e.preventDefault(),heatMap.showOptions(),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"options"})}),totalHeight+=$edit.height(),$keyContent.append($edit),$keyContent.css({"text-overflow":"ellipsis",overflow:"hidden",width:"250px",height:totalHeight+"px"})},morpheus.HeatMapColorSchemeLegend.drawColorScheme=function(context,colorScheme,width,printing,hideText,legendHeight){legendHeight||(legendHeight=12),context.font="11px "+morpheus.CanvasUtil.getFontFamily(context);var names=colorScheme.getNames(),hasNames=null!=names;if(hasNames)morpheus.HeatMapColorSchemeLegend.drawColorSchemeVertically(context,colorScheme,colorScheme.getHiddenValues(),printing);else{if(morpheus.HeatMapColorSchemeLegend.draw(context,colorScheme.getFractions(),colorScheme.getColors(),width,legendHeight,colorScheme.isStepped()),context.strokeStyle="LightGrey",context.strokeRect(0,0,width,legendHeight),hideText)return;var map=d3.scale.linear().domain([0,1]).range([0,width]).clamp(!0),fractionToValue=d3.scale.linear().domain([0,1]).range([colorScheme.getMin(),colorScheme.getMax()]).clamp(!0);if(context.textAlign="center",context.textBaseline="top",context.fillStyle="black",colorScheme.getScalingMode()===morpheus.HeatMapColorScheme.ScalingMode.RELATIVE)context.fillText("row min",0,14),context.fillText("row max",width,legendHeight+2);else{for(var fractions=colorScheme.getFractions(),lastTextPixEnd=-1,halfway=parseInt(fractions.length/2),i=0;i<halfway;i++){var pix=map(fractions[i]),text="";text=hasNames?""!=names[i]?names[i]+" ("+fractionToValue(fractions[i])+")":names[i]:morpheus.Util.nf(fractionToValue(fractions[i]));var textWidth=context.measureText(text).width;pix>lastTextPixEnd&&context.fillText(text,pix,legendHeight+2),lastTextPixEnd=pix+textWidth/2}var lastTextPixStart=1e4;for(i=fractions.length-1;i>=halfway;i--){pix=map(fractions[i]),text="";text=hasNames?""!=names[i]?names[i]+" ("+fractionToValue(fractions[i])+")":names[i]:morpheus.Util.nf(fractionToValue(fractions[i])),pix+(textWidth=context.measureText(text).width)/2<lastTextPixStart&&(context.fillText(text,pix,legendHeight+2),lastTextPixStart=pix-textWidth/2)}}}},morpheus.HeatMapColorSchemeLegend.drawColorSchemeVertically=function(context,colorScheme,hiddenValues,printing){var fractionToValue=d3.scale.linear().domain([0,1]).range([colorScheme.getMin(),colorScheme.getMax()]).clamp(!0);context.textAlign="left",context.textBaseline="top",context.fillStyle="black";var fractions=colorScheme.getFractions(),colors=colorScheme.getColors(),names=colorScheme.getNames();context.strokeStyle="LightGrey";var ypix=0;context.font="12px "+morpheus.CanvasUtil.getFontFamily(context);for(var i=0;i<colors.length;i++){var name=names[i];if(null!=name){if(context.fillStyle=colors[i],context.fillRect(0,ypix,12,12),context.strokeRect(0,ypix,12,12),context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,hiddenValues&&!printing){var value=fractionToValue(fractions[i]);try{context.font="12px FontAwesome",hiddenValues.has(value)||context.fillText("",-14,ypix)}catch(x){}context.font="12px "+morpheus.CanvasUtil.getFontFamily(context)}context.fillText(name,16,ypix)}ypix+=14}},morpheus.HeatMapColorSchemeLegend.draw=function(context,fractions,colors,width,height,stepped){if(stepped){var map=d3.scale.linear().domain([0,1]).range([0,width]).clamp(!0);for(i=0,length=fractions.length;i<length;i++){context.fillStyle=colors[i];var x1=map(fractions[i]),x2=i===length-1?width:map(fractions[i+1]);context.fillRect(Math.min(x1,x2),0,Math.abs(x2-x1),height)}}else{for(var gradient=context.createLinearGradient(0,0,width,height),i=0,length=fractions.length;i<length;i++)gradient.addColorStop(fractions[i],colors[i]);context.fillStyle=gradient,context.fillRect(0,0,width,height)}},morpheus.ColorSupplierLegend=function(colorScheme,value){morpheus.AbstractCanvas.call(this,!1);var _this=this;this.value=value,this.colorScheme=colorScheme,colorScheme.setCurrentValue(value);var hiddenValues=colorScheme.getHiddenValues(),names=colorScheme.getNames(),hasNames=null!=names,bounds={width:250,height:hasNames?14*names.length:30};this.hasNames=hasNames,this.setBounds(bounds),hasNames&&hiddenValues&&$(this.canvas).on("click",function(e){e.preventDefault(),e.stopPropagation();var clickedRow=Math.floor((e.clientY-_this.canvas.getBoundingClientRect().top)/14),value=d3.scale.linear().domain([0,1]).range([colorScheme.getMin(),colorScheme.getMax()]).clamp(!0)(colorScheme.getFractions()[clickedRow]);hiddenValues.has(value)?hiddenValues.remove(value):hiddenValues.add(value),_this.trigger("selectionChanged"),_this.repaint()})},morpheus.ColorSupplierLegend.prototype={draw:function(clip,context){var colorScheme=this.colorScheme;colorScheme.setCurrentValue(this.value),context.translate(this.hasNames?14:(this.getUnscaledWidth()-200)/2,0),morpheus.HeatMapColorSchemeLegend.drawColorScheme(context,colorScheme,200)}},morpheus.Util.extend(morpheus.ColorSupplierLegend,morpheus.Events),morpheus.Util.extend(morpheus.ColorSupplierLegend,morpheus.AbstractCanvas),morpheus.HeatMapColorScheme=function(project,scheme){this.project=project;var _this=this;this.separateColorSchemeForRowMetadataField=null,this.rowValueToColorSupplier={},this.value=null,scheme&&(scheme.valueToColorScheme?this.fromJSON(scheme):(this.rowValueToColorSupplier.null=this.fromJSON(scheme),this.currentColorSupplier=this.rowValueToColorSupplier[this.value])),project.on("rowFilterChanged columnFilterChanged rowSortOrderChanged columnSortOrderChanged datasetChanged",function(){_this.projectUpdated()}),this.projectUpdated()},morpheus.HeatMapColorScheme.Predefined={},morpheus.HeatMapColorScheme.Predefined.CN=function(){return{scalingMode:"fixed",values:[-2,-.1,.1,2],colors:["#0000ff","#ffffff","#ffffff","#ff0000"]}},morpheus.HeatMapColorScheme.Predefined.BINARY=function(){return{scalingMode:"fixed",values:[0,1],colors:["#ffffff","black"]}},morpheus.HeatMapColorScheme.Predefined.RELATIVE=function(){return{scalingMode:"relative"}},morpheus.HeatMapColorScheme.Predefined.MAF=function(){return{scalingMode:"fixed",stepped:!0,values:[0,1,2,3,4,5,6,7],names:["","Synonymous","In Frame Indel","Other Non-Synonymous","Missense","Splice Site","Frame Shift","Nonsense"],colors:["#ffffff","#4daf4a","#ffff33","#a65628","#377eb8","#984ea3","#ff7f00","#e41a1c"]}},morpheus.HeatMapColorScheme.Predefined.ZS=function(){return{scalingMode:"fixed",values:[-10,-2,2,10],colors:["#0000ff","#ffffff","#ffffff","#ff0000"]}},morpheus.HeatMapColorScheme.ScalingMode={RELATIVE:0,FIXED:1},morpheus.HeatMapConditions=function(){this.array=[]},morpheus.HeatMapConditions.prototype={insert:function(index,c){this.array.splice(index,0,c)},add:function(c){this.array.push(c)},getConditions:function(){return this.array},remove:function(index){this.array.splice(index,1)},copy:function(){var c=new morpheus.HeatMapConditions;return this.array.forEach(function(cond){c.array.push(_.clone(cond))}),c}},morpheus.HeatMapColorScheme.prototype={getColors:function(){return this.currentColorSupplier.getColors()},setMissingColor:function(color){this.currentColorSupplier.setMissingColor(color)},getHiddenValues:function(){return this.currentColorSupplier.getHiddenValues?this.currentColorSupplier.getHiddenValues():null},getMissingColor:function(){return this.currentColorSupplier.getMissingColor()},getScalingMode:function(){return this.currentColorSupplier.getScalingMode()},getSizer:function(){return this.currentColorSupplier.getSizer()},getConditions:function(){return this.currentColorSupplier.getConditions()},setScalingMode:function(scalingMode){this.currentColorSupplier.setScalingMode(scalingMode)},getFractions:function(){return this.currentColorSupplier.getFractions()},getNames:function(){return this.currentColorSupplier.getNames()},getMin:function(){return this.currentColorSupplier.getMin()},getMax:function(){return this.currentColorSupplier.getMax()},setMin:function(min){this.currentColorSupplier.setMin(min)},setMax:function(max){this.currentColorSupplier.setMax(max)},isStepped:function(){return this.currentColorSupplier.isStepped()},setFractions:function(options){this.currentColorSupplier.setFractions(options)},setTransformValues:function(options){this.currentColorSupplier.setTransformValues(options),this.cachedRowStats.cachedRow=-1},getTransformValues:function(){return this.currentColorSupplier.getTransformValues()},setStepped:function(stepped){var oldColorSupplier=this.currentColorSupplier,newColorSupplier=stepped?new morpheus.SteppedColorSupplier:new morpheus.GradientColorSupplier;newColorSupplier.sizer=oldColorSupplier.getSizer(),newColorSupplier.array=oldColorSupplier.getConditions(),newColorSupplier.setScalingMode(oldColorSupplier.getScalingMode()),newColorSupplier.setMin(oldColorSupplier.getMin()),newColorSupplier.setMax(oldColorSupplier.getMax()),newColorSupplier.setFractions({fractions:oldColorSupplier.getFractions(),colors:oldColorSupplier.getColors()}),this.currentColorSupplier=newColorSupplier,this.rowValueToColorSupplier[this.value]=this.currentColorSupplier},toJSON:function(){var json={},_this=this;return null!=this.separateColorSchemeForRowMetadataField&&(json.separateColorSchemeForRowMetadataField=this.separateColorSchemeForRowMetadataField),json.valueToColorScheme={},_.each(_.keys(this.rowValueToColorSupplier),function(key){json.valueToColorScheme[key]=morpheus.AbstractColorSupplier.toJSON(_this.rowValueToColorSupplier[key])}),json},fromJSON:function(json){var _this=this;json.separateColorSchemeForRowMetadataField&&(this.separateColorSchemeForRowMetadataField=json.separateColorSchemeForRowMetadataField,this.vector=this.project.getSortedFilteredDataset().getRowMetadata().getByName(this.separateColorSchemeForRowMetadataField)),this.rowValueToColorSupplier={};var obj=json.valueToColorScheme||json.colorSchemes;if(null==obj){var colorSupplier=morpheus.AbstractColorSupplier.fromJSON(json);_this.rowValueToColorSupplier.null=colorSupplier}else _.each(_.keys(obj),function(key){var colorSupplier=morpheus.AbstractColorSupplier.fromJSON(obj[key]);_this.rowValueToColorSupplier[key]=colorSupplier});this._ensureColorSupplierExists()},copy:function(project){var _this=this,c=new morpheus.HeatMapColorScheme(project);return c.separateColorSchemeForRowMetadataField=this.separateColorSchemeForRowMetadataField,null!=c.separateColorSchemeForRowMetadataField&&(c.vector=project.getSortedFilteredDataset().getRowMetadata().getByName(c.separateColorSchemeForRowMetadataField)),null==c.vector&&(c.separateColorSchemeForRowMetadataField=null),_.each(_.keys(this.rowValueToColorSupplier),function(key){c.rowValueToColorSupplier[key]=_this.rowValueToColorSupplier[key].copy()}),c.value=this.value,c.currentColorSupplier=c.rowValueToColorSupplier[c.value],c},setSeparateColorSchemeForRowMetadataField:function(separateColorSchemeForRowMetadataField){if(separateColorSchemeForRowMetadataField!=this.separateColorSchemeForRowMetadataField){this.separateColorSchemeForRowMetadataField=separateColorSchemeForRowMetadataField,this.vector=this.project.getSortedFilteredDataset().getRowMetadata().getByName(separateColorSchemeForRowMetadataField);var _this=this;_.each(_.keys(this.rowValueToColorSupplier),function(key){delete _this.rowValueToColorSupplier[key]})}},getProject:function(){return this.project},getSeparateColorSchemeForRowMetadataField:function(){return this.separateColorSchemeForRowMetadataField},getColorByValues:function(){return _.keys(this.rowValueToColorSupplier)},projectUpdated:function(){var dataset=this.project.getSortedFilteredDataset();null!=this.separateColorSchemeForRowMetadataField&&(this.vector=this.project.getSortedFilteredDataset().getRowMetadata().getByName(this.separateColorSchemeForRowMetadataField)),this.cachedRowStats=new morpheus.RowStats(dataset)},setColorSupplierForCurrentValue:function(colorSupplier){this.rowValueToColorSupplier[this.value]=colorSupplier,this.currentColorSupplier=colorSupplier},setCurrentValue:function(value){this.value=value,this._ensureColorSupplierExists()},isSizeBy:function(){this.currentColorSupplier.isSizeBy()},getCurrentColorSupplier:function(){return this.currentColorSupplier},getColor:function(row,column,val){if(void 0!==this.vector){var tmp=this.vector.getValue(row);this.value!==tmp&&(this.value=tmp,this._ensureColorSupplierExists())}return this.currentColorSupplier.getScalingMode()===morpheus.HeatMapColorScheme.ScalingMode.RELATIVE?this.cachedRowStats.maybeUpdateRelative(row)&&(this.currentColorSupplier.setMin(this.cachedRowStats.rowCachedMin),this.currentColorSupplier.setMax(this.cachedRowStats.rowCachedMax)):this.currentColorSupplier.getTransformValues()&&this.cachedRowStats.cachedRow!==row&&(this.cachedRowStats.cacheTransformValues(row,this.currentColorSupplier.getTransformValues()),val=(val-this.cachedRowStats.rowCachedMean)/this.cachedRowStats.rowCachedStandardDeviation),this.currentColorSupplier.getColor(row,column,val)},_ensureColorSupplierExists:function(){if(this.currentColorSupplier=this.rowValueToColorSupplier[this.value],void 0===this.currentColorSupplier){var cs=morpheus.AbstractColorSupplier.fromJSON({scalingMode:"relative"});this.rowValueToColorSupplier[this.value]=cs,this.currentColorSupplier=cs}}},morpheus.RowStats=function(dataset){this.datasetRowView=new morpheus.DatasetRowView(dataset),this.cachedRow=-1,this.rowCachedMax=0,this.rowCachedMin=0,this.rowCachedStandardDeviation=NaN,this.rowCachedMean=-1},morpheus.RowStats.prototype={cacheTransformValues:function(row,transform){var meanFunction=transform===morpheus.AbstractColorSupplier.Z_SCORE?morpheus.Mean:morpheus.Median,stdevFunction=transform===morpheus.AbstractColorSupplier.Z_SCORE?morpheus.StandardDeviation:morpheus.MAD;this.datasetRowView.setIndex(row),this.rowCachedMean=meanFunction(this.datasetRowView),this.rowCachedStandardDeviation=stdevFunction(this.datasetRowView,this.rowCachedMean),0===this.rowCachedStandardDeviation&&(this.rowCachedStandardDeviation=NaN)},maybeUpdateRelative:function(row){if(this.cachedRow!==row){this.cachedRow=row,this.datasetRowView.setIndex(row),this.rowCachedMax=-Number.MAX_VALUE,this.rowCachedMin=Number.MAX_VALUE;for(var j=0,ncols=this.datasetRowView.size();j<ncols;j++){var d=this.datasetRowView.getValue(j);isNaN(d)||(this.rowCachedMax=d>this.rowCachedMax?d:this.rowCachedMax,this.rowCachedMin=d<this.rowCachedMin?d:this.rowCachedMin)}return this.rowCachedMin===this.rowCachedMax&&this.rowCachedMin--,!0}return!1}},morpheus.HeatMapSynchronizer=function(){this.controllers=[]},morpheus.HeatMapSynchronizer.prototype={firing:!1,getProject:function(){return this.controllers[0].getProject()},zoom:function(){this.controllers[0].zoom.apply(this.controllers[0],arguments)},setTrackVisible:function(){this.controllers[0].setTrackVisible.apply(this.controllers[0],arguments)},revalidate:function(){this.controllers[0].revalidate.apply(this.controllers[0],arguments)},add:function(heatMap){var that=this;this.controllers.push(heatMap),heatMap.on("change",function(event){if(!that.firing){var source=event.source,method=event.name;that.firing=!0,_.each(that.controllers,function(c){c!==source&&c[method].apply(c,event.arguments)}),that.firing=!1}})}},morpheus.HeatMapElementCanvas=function(project){morpheus.AbstractCanvas.call(this,!0);var _this=this;this.colorScheme=null,this.project=project,this.dataset=null,this.columnPositions=new morpheus.Positions,this.rowPositions=new morpheus.Positions,this.lastPosition={left:-1,right:-1,top:-1,bottom:-1},this.selectionBox=null,this.selectedRowElements=[],this.selectedColumnElements=[],project.getElementSelectionModel().on("selectionChanged",function(e){_this.repaint()}),this.gridColor=morpheus.HeatMapElementCanvas.GRID_COLOR,this.gridThickness=.5,this.elementDrawCallback=null,this.drawCallback=null,this.drawValuesFormat=morpheus.Util.createNumberFormat(".2f"),this.shape="square"},morpheus.HeatMapElementCanvas.GRID_COLOR="#808080",morpheus.HeatMapElementCanvas.prototype={drawGrid:!0,drawValues:!1,setPropertiesFromParent:function(parentHeatMapElementCanvas){this.drawGrid=parentHeatMapElementCanvas.drawGrid,this.gridThickness=parentHeatMapElementCanvas.gridThickness,this.gridColor=parentHeatMapElementCanvas.gridColor,this.drawValues=parentHeatMapElementCanvas.drawValues,this.shape=parentHeatMapElementCanvas.shape},updateRowSelectionCache:function(repaint){this.selectedRowElements=morpheus.HeatMapElementCanvas.getSelectedSpans(this.project.getRowSelectionModel().getViewIndices()),repaint&&this.repaint()},updateColumnSelectionCache:function(repaint){this.selectedColumnElements=morpheus.HeatMapElementCanvas.getSelectedSpans(this.project.getColumnSelectionModel().getViewIndices()),repaint&&this.repaint()},getShape:function(){return this.shape},setShape:function(shape){this.shape=shape},setGridColor:function(gridColor){this.gridColor=gridColor},getGridColor:function(){return this.gridColor},setGridThickness:function(gridThickness){this.gridThickness=gridThickness},getGridThickness:function(){return this.gridThickness},getColorScheme:function(){return this.colorScheme},isDrawGrid:function(){return this.drawGrid},setDrawGrid:function(drawGrid){this.drawGrid=drawGrid},getDrawValuesFormat:function(){return this.drawValuesFormat},setDrawValuesFormat:function(f){"object"==typeof f&&(f=morpheus.Util.createNumberFormat(f.pattern)),this.drawValuesFormat=f},setDrawValues:function(drawValues){this.drawValues=drawValues},isDrawValues:function(){return this.drawValues},setColorScheme:function(colorScheme){this.colorScheme=colorScheme},setDataset:function(dataset){this.dataset=dataset,this.columnPositions.setLength(this.dataset.getColumnCount()),this.rowPositions.setLength(this.dataset.getRowCount()),this.updateRowSelectionCache(!1),this.updateColumnSelectionCache(!1)},getColumnPositions:function(){return this.columnPositions},getRowPositions:function(){return this.rowPositions},getPreferredSize:function(context){return{width:Math.ceil(this.columnPositions.getPosition(this.columnPositions.getLength()-1)+this.columnPositions.getItemSize(this.columnPositions.getLength()-1)),height:Math.ceil(this.rowPositions.getPosition(this.rowPositions.getLength()-1)+this.rowPositions.getItemSize(this.rowPositions.getLength()-1))}},prePaint:function(clip,context){var lastPosition=this.lastPosition,columnPositions=this.columnPositions,rowPositions=this.rowPositions,left=morpheus.Positions.getLeft(clip,columnPositions),right=morpheus.Positions.getRight(clip,columnPositions),top=morpheus.Positions.getTop(clip,rowPositions),bottom=morpheus.Positions.getBottom(clip,rowPositions);(this.invalid||left!==lastPosition.left||right!==lastPosition.right||top!==lastPosition.top||bottom!==lastPosition.bottom)&&(lastPosition.right=right,lastPosition.left=left,lastPosition.top=top,lastPosition.bottom=bottom,this.invalid=!0)},postPaint:function(clip,context){morpheus.CanvasUtil.resetTransform(context);var project=this.project;context.strokeStyle="Grey",context.lineWidth=1;var rowPositions=this.getRowPositions(),columnPositions=this.getColumnPositions();if(project.getHoverColumnIndex()>=0||project.getHoverRowIndex()>=0){var height=rowPositions.getItemSize(project.getHoverColumnIndex()),width=columnPositions.getItemSize(project.getHoverColumnIndex()),y=-1===project.getHoverRowIndex()?rowPositions.getPosition(rowPositions.getLength()-1):rowPositions.getPosition(project.getHoverRowIndex()),x=-1===project.getHoverColumnIndex()?columnPositions.getPosition(0):columnPositions.getPosition(project.getHoverColumnIndex());if(-1!==project.getHoverColumnIndex()&&context.strokeRect(x-clip.x,0,width,this.getUnscaledHeight()),-1!==project.getHoverRowIndex()&&context.strokeRect(0,y-clip.y,this.getUnscaledWidth(),height),-1!==project.getHoverColumnIndex()&&-1!==project.getHoverRowIndex()&&(context.strokeStyle="black",context.lineWidth=3,context.strokeRect(x-clip.x+1.5,y-clip.y+1.5,width-1.5,height-1.5),project.isSymmetric())){var y2=rowPositions.getPosition(project.getHoverColumnIndex()),x2=columnPositions.getPosition(project.getHoverRowIndex());context.strokeRect(x2-clip.x+1.5,y2-clip.y+1.5,width-1.5,height-1.5)}}var left=morpheus.Positions.getLeft(clip,columnPositions),right=morpheus.Positions.getRight(clip,columnPositions),top=morpheus.Positions.getTop(clip,rowPositions),bottom=morpheus.Positions.getBottom(clip,rowPositions);context.strokeStyle="rgb(0,0,0)",context.lineWidth=2,context.translate(-clip.x,-clip.y);var selectedElements=project.getElementSelectionModel().getViewIndices();null!=selectedElements&&selectedElements.forEach(function(id){var rowIndex=id.getArray()[0],columnIndex=id.getArray()[1];if(rowIndex>=top&&rowIndex<bottom&&columnIndex>=left&&columnIndex<right){var rowSize=rowPositions.getItemSize(rowIndex),py=rowPositions.getPosition(rowIndex),columnSize=columnPositions.getItemSize(columnIndex),px=columnPositions.getPosition(columnIndex);context.strokeRect(px+1.5,py+1.5,columnSize-1.5,rowSize-1.5)}}),context.strokeStyle="rgb(182,213,253)";var selectedRowElements=this.selectedRowElements,selectedColumnElements=this.selectedColumnElements;0===selectedRowElements.length&&0===selectedColumnElements.length||(0===selectedRowElements.length&&(selectedRowElements=[[top,bottom-1]]),0===selectedColumnElements.length&&(selectedColumnElements=[[left,right-1]]));var nrows=selectedRowElements.length,ncols=selectedColumnElements.length;if(0!==nrows||0!==ncols)for(var i=0;i<nrows;i++)for(var r=selectedRowElements[i],y1=rowPositions.getPosition(r[0]),j=(y2=rowPositions.getPosition(r[1])+rowPositions.getItemSize(i),0);j<ncols;j++){var c=selectedColumnElements[j],x1=columnPositions.getPosition(c[0]);x2=columnPositions.getPosition(c[1])+columnPositions.getItemSize(j);context.strokeRect(x1,y1,x2-x1,y2-y1)}if(this.selectionBox){context.strokeStyle="rgb(0,0,0)",context.lineWidth=2,context.setLineDash&&context.setLineDash([5]);x1=columnPositions.getPosition(this.selectionBox.x[0]);if((x2=columnPositions.getPosition(this.selectionBox.x[1]))<x1){var tmp=x1;x1=x2,x2=tmp+columnPositions.getItemSize(this.selectionBox.x[0])}else x2+=columnPositions.getItemSize(this.selectionBox.x[1]);y1=rowPositions.getPosition(this.selectionBox.y[0]);if((y2=rowPositions.getPosition(this.selectionBox.y[1]))<y1){tmp=y1;y1=y2,y2=tmp+rowPositions.getItemSize(this.selectionBox.y[0])}else y2+=rowPositions.getItemSize(this.selectionBox.y[1]);context.strokeRect(x1,y1,x2-x1,y2-y1),context.setLineDash&&context.setLineDash([]),context.lineWidth=1}},setElementDrawCallback:function(elementDrawCallback){this.elementDrawCallback=elementDrawCallback},setSelectionBox:function(selectionBox){this.selectionBox=selectionBox},setDrawCallback:function(drawCallback){this.drawCallback=drawCallback},draw:function(clip,context){var columnPositions=this.columnPositions,rowPositions=this.rowPositions,left=morpheus.Positions.getLeft(clip,columnPositions),right=morpheus.Positions.getRight(clip,columnPositions),top=morpheus.Positions.getTop(clip,rowPositions),bottom=morpheus.Positions.getBottom(clip,rowPositions);context.translate(-clip.x,-clip.y),this._draw({left:left,right:right,top:top,bottom:bottom,context:context}),context.translate(clip.x,clip.y),this.drawCallback&&this.drawCallback({clip:clip,context:context})},_draw:function(options){var left=options.left,right=options.right,top=options.top,bottom=options.bottom,context=options.context,fontFamily=morpheus.CanvasUtil.getFontFamily(context),columnPositions=this.columnPositions,rowPositions=this.rowPositions;morpheus.CanvasUtil.forceSubPixelRendering(context),context.textAlign="center",context.textBaseline="middle";var nf,dataset=this.dataset,colorScheme=this.colorScheme,drawGrid=this.drawGrid,elementDrawCallback=this.elementDrawCallback,hasElementDrawCallback=null!=elementDrawCallback,drawValues=this.drawValues&&columnPositions.getSize()>7&&rowPositions.getSize()>7;if(drawValues){nf=this.drawValuesFormat;var fontSize=columnPositions.getSize();context.font=fontSize+"px "+fontFamily;var textWidth=context.measureText("-99.9").width;fontSize=(columnPositions.getSize()-1)/textWidth*fontSize,fontSize=Math.min(fontSize,17),context.font=fontSize+"px "+morpheus.CanvasUtil.getFontFamily(context)}for(var sizer,sizeBySeriesName,sizeBySeriesIndex,conditions,conditionSeriesIndices,seriesNameToIndex={},i=0;i<dataset.getSeriesCount();i++)seriesNameToIndex[dataset.getName(i)]=i;var drawFunction,sizeFractionRemapper=d3.scale.linear().domain([0,1]).range([.2,1]);drawFunction="circle"===this.shape?function(x,y,w,h){context.beginPath(),context.arc(x+w/2,y+h/2,Math.min(w,h)/2,0,2*Math.PI,!1),context.fill()}:function(x,y,w,h){context.fillRect(x,y,w,h)};for(var row=top;row<bottom;row++)for(var rowSize=rowPositions.getItemSize(row),py=rowPositions.getPosition(row),column=left;column<right;column++){var columnSize=columnPositions.getItemSize(column),px=columnPositions.getPosition(column),value=dataset.getValue(row,column);if(context.fillStyle=colorScheme.getColor(row,column,value),column===left){sizeBySeriesIndex=null!=(sizeBySeriesName=(sizer=colorScheme.getSizer()).getSeriesName())?seriesNameToIndex[sizeBySeriesName]:void 0,conditionSeriesIndices=[];for(var ci=0,nconditions=(conditions=colorScheme.getConditions().getConditions()).length;ci<nconditions;ci++)conditionSeriesIndices.push(seriesNameToIndex[conditions[ci].seriesName])}var yoffset=0,xoffset=0,cellRowSize=rowSize,cellColumnSize=columnSize;if(void 0!==sizeBySeriesIndex){var sizeByValue=dataset.getValue(row,column,sizeBySeriesIndex);if(!isNaN(sizeByValue)){var sizeFraction=sizeFractionRemapper(sizer.valueToFraction(sizeByValue));yoffset=(rowSize-(cellRowSize*=sizeFraction))/2,xoffset=(columnSize-(cellColumnSize*=sizeFraction))/2}}if(conditions.length>0){var condition=null;for(ci=0,nconditions=conditions.length;ci<nconditions;ci++){var cond=conditions[ci],condValue=dataset.getValue(row,column,conditionSeriesIndices[ci]);if(!isNaN(condValue)&&cond.accept(condValue)){condition=cond;break}}if(null!==condition)if(null!=condition.shape)if(condition.inheritColor){void 0===sizeBySeriesIndex&&(xoffset=1,yoffset=1,cellRowSize-=2,cellColumnSize-=2);var x=px+xoffset+cellRowSize/2,y=py+yoffset+cellColumnSize/2;morpheus.CanvasUtil.drawShape(context,condition.shape,x,y,Math.min(cellColumnSize,cellRowSize)/2,!0)}else{drawFunction(px+xoffset,py+yoffset,cellColumnSize,cellRowSize);x=px+xoffset+cellRowSize/2,y=py+yoffset+cellColumnSize/2;context.fillStyle=condition.color,morpheus.CanvasUtil.drawShape(context,condition.shape,x,y,Math.min(cellColumnSize,cellRowSize)/4,!0)}else drawFunction(px+xoffset,py+yoffset,cellColumnSize,cellRowSize);else drawFunction(px+xoffset,py+yoffset,cellColumnSize,cellRowSize)}else drawFunction(px+xoffset,py+yoffset,cellColumnSize,cellRowSize);drawValues&&cellColumnSize>7&&cellRowSize>7&&!isNaN(value)&&(context.fillStyle="rgb(0,0,0)",context.fillText(nf(value),px+xoffset+cellColumnSize/2,py+yoffset+cellRowSize/2,cellColumnSize)),hasElementDrawCallback&&elementDrawCallback(context,dataset,row,column,px,py,columnSize,rowSize)}if(drawGrid&&rowPositions.getSize()>10&&columnPositions.getSize()>10){context.strokeStyle=this.gridColor,context.lineWidth=this.gridThickness,context.beginPath();for(row=top;row<bottom;row++)for(rowSize=rowPositions.getItemSize(row),py=rowPositions.getPosition(row),column=left;column<right;column++){columnSize=columnPositions.getItemSize(column),px=columnPositions.getPosition(column);columnSize>10&&rowSize>10&&context.rect(px,py,columnSize,rowSize)}context.stroke()}context.lineWidth=1}},morpheus.Util.extend(morpheus.HeatMapElementCanvas,morpheus.AbstractCanvas),morpheus.HeatMapElementCanvas.getSelectedSpans=function(set){var array=[];if(set.size()>0){var index=0,start=index,viewIndices=set.values();viewIndices.sort(function(a,b){return a===b?0:a<b?-1:1});for(var length=viewIndices.length;index<length;){var prior=0===index?viewIndices[0]:viewIndices[index-1];viewIndices[index]-prior>1&&(array.push([viewIndices[start],viewIndices[index-1]]),start=index),index++}0==start?array.push([viewIndices[0],viewIndices[viewIndices.length-1]]):array.push([viewIndices[start],viewIndices[index-1]])}return array},morpheus.KeyboardCharMap=["","","","CANCEL","","","HELP","","BACKSPACE","TAB","","","CLEAR","ENTER","ENTER_SPECIAL","","SHIFT","CONTROL","ALT","PAUSE","CAPS_LOCK","KANA","EISU","JUNJA","FINAL","HANJA","","Escape","CONVERT","NONCONVERT","ACCEPT","MODECHANGE","Space","Page Up","Page Down","End","Home","Left","Up","Right","Down","SELECT","PRINT","EXECUTE","PRINTSCREEN","INSERT","Delete","","0","1","2","3","4","5","6","7","8","9","COLON","SEMICOLON","LESS_THAN","Equals","GREATER_THAN","QUESTION_MARK","AT","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","OS_KEY","","CONTEXT_MENU","","SLEEP","0","1","2","3","4","5","6","7","8","9","MULTIPLY","+","SEPARATOR","SUBTRACT","DECIMAL","DIVIDE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","","","","","","","","","NUM_LOCK","SCROLL_LOCK","WIN_OEM_FJ_JISHO","WIN_OEM_FJ_MASSHOU","WIN_OEM_FJ_TOUROKU","WIN_OEM_FJ_LOYA","WIN_OEM_FJ_ROYA","","","","","","","","","","CIRCUMFLEX","EXCLAMATION","DOUBLE_QUOTE","HASH","DOLLAR","PERCENT","AMPERSAND","UNDERSCORE","OPEN_PAREN","CLOSE_PAREN","ASTERISK","Plus","PIPE","-","OPEN_CURLY_BRACKET","CLOSE_CURLY_BRACKET","TILDE","","","","","VOLUME_MUTE","VOLUME_DOWN","VOLUME_UP","","","SEMICOLON","EQUALS","COMMA","MINUS","PERIOD","/","BACK_QUOTE","","","","","","","","","","","","","","","","","","","","","","","","","","","OPEN_BRACKET","BACK_SLASH","CLOSE_BRACKET","QUOTE","","META","ALTGR","","WIN_ICO_HELP","WIN_ICO_00","","WIN_ICO_CLEAR","","","WIN_OEM_RESET","WIN_OEM_JUMP","WIN_OEM_PA1","WIN_OEM_PA2","WIN_OEM_PA3","WIN_OEM_WSCTRL","WIN_OEM_CUSEL","WIN_OEM_ATTN","WIN_OEM_FINISH","WIN_OEM_COPY","WIN_OEM_AUTO","WIN_OEM_ENLW","WIN_OEM_BACKTAB","ATTN","CRSEL","EXSEL","EREOF","PLAY","ZOOM","","PA1","WIN_OEM_CLEAR",""],morpheus.HeatMapKeyListener=function(heatMap){var allActions=heatMap.getActionManager().getActions(),actions=allActions.filter(function(a){return null!=a.cb&&null!=a.which});allActions.sort(function(a,b){return(a=a.name.toLowerCase())===(b=b.name.toLowerCase())?0:a<b?-1:1});var $keyelement=heatMap.$tabPanel;$keyelement.on("keydown",function(e){var tagName=e.target.tagName,found=!1,commandKey=morpheus.Util.IS_MAC?e.metaKey:e.ctrlKey,shiftKey=(e.altKey,e.shiftKey),which=e.which,isInputField="INPUT"===tagName||"SELECT"===tagName||"TEXTAREA"===tagName,acceptOptions={isInputField:isInputField,heatMap:heatMap},shortcutMatches=function(sc){var scShift=sc.shiftKey||!1;if(-1!==sc.which.indexOf(which)&&(void 0===sc.commandKey||commandKey===sc.commandKey)&&shiftKey==scShift&&(void 0==sc.accept||sc.accept(acceptOptions)))return sc.cb({heatMap:heatMap}),!0};if(isInputField){for(i=0,n=actions.length;i<n;i++)if((sc=actions[i]).global&&shortcutMatches(sc)){found=!0;break}}else for(var i=0,n=actions.length;i<n;i++){var sc;if(shortcutMatches(sc=actions[i])){found=!0;break}}if(found)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}),$keyelement.on("dragover.morpheus dragenter.morpheus",function(e){e.preventDefault(),e.stopPropagation()}).on("drop.morpheus",function(e){if(heatMap.options.menu.File&&-1!==heatMap.options.menu.File.indexOf("Open")&&e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length){e.preventDefault(),e.stopPropagation();for(var files=e.originalEvent.dataTransfer.files,i=0;i<files.length;i++)morpheus.HeatMap.showTool(new morpheus.OpenFileTool({file:files[i]}),heatMap)}}),$keyelement.on("mousewheel",function(e){var scrolly=e.deltaY*e.deltaFactor,scrollx=e.deltaX*e.deltaFactor,stop=!1;if(e.altKey)heatMap.zoom(scrolly>0,{rows:!0,columns:!0}),stop=!0;else{if(0!==scrolly){var scrollTop=heatMap.scrollTop();heatMap.scrollTop(scrollTop-scrolly)!==scrollTop&&(stop=!0)}if(0!==scrollx){var scrollLeft=heatMap.scrollLeft();heatMap.scrollLeft(scrollLeft+scrollx)!==scrollLeft&&(stop=!0)}}stop&&heatMap.options.standalone&&(e.preventDefault(),e.stopPropagation())}),this.showKeyMapReference=function(){var html=[];html.push('<table class="table table-condensed">'),allActions.forEach(function(sc){html.push("<tr><td>"),html.push(function(sc){var s=["<b>"];return sc.commandKey&&s.push(morpheus.Util.COMMAND_KEY),sc.shiftKey&&s.push("Shift+"),sc.which&&s.push(morpheus.KeyboardCharMap[sc.which[0]]),s.push("</b>"),s.join("")}(sc)),html.push("</td><td>"),sc.icon&&html.push('<span class="'+sc.icon+'"></span> '),html.push(sc.name),html.push("</td></tr>")}),html.push("</table>"),morpheus.FormBuilder.showInModal({title:"Keyboard Shortcuts",html:html.join(""),focus:document.activeElement})}},morpheus.HeatMapOptions=function(heatMap){var items=[{name:"color_by",required:!0,help:"Use a different color scheme for distinct row annotation values",type:"select",options:["(None)"].concat(morpheus.MetadataUtil.getMetadataNames(heatMap.getProject().getFullDataset().getRowMetadata())),value:heatMap.heatmap.getColorScheme().getSeparateColorSchemeForRowMetadataField()},{name:"color_by_value",required:!0,type:"select",options:[]}];items.push({name:"shape",required:!0,type:"select",options:["square","circle"],value:heatMap.heatmap.getShape()}),items.push({type:"separator"}),items.push({name:"size_by",required:!0,type:"select",options:["(None)"].concat(morpheus.DatasetUtil.getSeriesNames(heatMap.getProject().getFullDataset()))}),items.push({name:"size_by_minimum",title:"Size by minimum",required:!0,type:"text",style:"max-width: 100px;"}),items.push({name:"size_by_maximum",title:"Size by maximum",required:!0,type:"text",style:"max-width: 100px;"}),items.push({type:"separator"}),items.push({name:"conditional_rendering",required:!0,type:"button"}),items.push({type:"separator"});var createColorSchemeOptions=function(){var colorSchemeOptions=[{name:"relative",value:"relative"},{name:"binary",value:"binary"},{name:"MAF",value:"MAF"},{name:"fixed (-1.5, -0.1, 0.1, 1.5)",value:"cn"}],savedColorSchemeKeys=[];return"undefined"!=typeof localStorage&&null!=localStorage.getItem("morpheus-colorScheme")&&(savedColorSchemeKeys=_.keys(JSON.parse(localStorage.getItem("morpheus-colorScheme")))),savedColorSchemeKeys.length>0&&(colorSchemeOptions.push({divider:!0}),colorSchemeOptions=colorSchemeOptions.concat(savedColorSchemeKeys)),colorSchemeOptions.push({divider:!0}),colorSchemeOptions.push("My Computer..."),colorSchemeOptions};items.push([{name:"saved_color_scheme",required:!0,type:"bootstrap-select",options:createColorSchemeOptions()},{name:"load_color_scheme",type:"button"},{name:"delete_color_scheme",type:"button"}]),items.push({name:"save_color_scheme",type:"button"});var displayItems=[{disabled:heatMap.getProject().getFullDataset().getColumnCount()!==heatMap.getProject().getFullDataset().getRowCount(),name:"link_rows_and_columns",help:"For square matrices",required:!0,type:"checkbox",style:"max-width: 100px;",value:heatMap.getProject().isSymmetric()},{name:"show_row_number",required:!0,type:"checkbox",value:heatMap.isShowRowNumber()},{name:"show_grid",required:!0,type:"checkbox",value:heatMap.heatmap.isDrawGrid()},{name:"grid_thickness",required:!0,type:"text",style:"max-width: 100px;",value:morpheus.Util.nf(heatMap.heatmap.getGridThickness())},{name:"grid_color",required:!0,type:"color",style:"max-width: 50px;",value:heatMap.heatmap.getGridColor()},{name:"row_size",required:!0,type:"text",style:"max-width: 100px;",value:morpheus.Util.nf(heatMap.heatmap.getRowPositions().getSize())},{name:"column_size",required:!0,type:"text",style:"max-width: 100px;",value:morpheus.Util.nf(heatMap.heatmap.getColumnPositions().getSize())},{name:"show_values",required:!0,type:"checkbox",value:heatMap.heatmap.isDrawValues()},{name:"number_of_fraction_digits",required:!0,type:"number",min:0,step:1,style:"max-width: 100px;",value:morpheus.Util.getNumberFormatPatternFractionDigits(heatMap.heatmap.getDrawValuesFormat().toJSON().pattern)}];heatMap.rowDendrogram&&displayItems.push({name:"row_dendrogram_line_thickness",required:!0,type:"text",style:"max-width: 100px;",value:morpheus.Util.nf(heatMap.rowDendrogram?heatMap.rowDendrogram.lineWidth:1)}),heatMap.columnDendrogram&&displayItems.push({name:"column_dendrogram_line_thickness",required:!0,type:"text",style:"max-width: 100px;",value:morpheus.Util.nf(heatMap.columnDendrogram?heatMap.columnDendrogram.lineWidth:1)}),displayItems.push({name:"info_window",required:!0,type:"select",style:"max-width:130px;",options:[{name:"Fixed To Top",value:0},{name:"New Window",value:1}],value:heatMap.tooltipMode}),displayItems.push({name:"inline_tooltip",required:!0,type:"checkbox",value:heatMap.options.inlineTooltip});var colorSchemeFormBuilder=new morpheus.FormBuilder;_.each(items,function(item){colorSchemeFormBuilder.append(item)});var displayFormBuilder=new morpheus.FormBuilder;_.each(displayItems,function(item){displayFormBuilder.append(item)});var colorSchemeChooser=new morpheus.HeatMapColorSchemeChooser({showRelative:!0,colorScheme:heatMap.heatmap.getColorScheme()}),updatingSizer=!1;function colorSchemeChooserUpdated(){heatMap.heatmap.getColorScheme().getSizer&&null!=heatMap.heatmap.getColorScheme().getSizer()&&(colorSchemeFormBuilder.setValue("size_by",heatMap.heatmap.getColorScheme().getSizer().getSeriesName()),colorSchemeFormBuilder.setEnabled("size_by_minimum",null!=heatMap.heatmap.getColorScheme().getSizer().getSeriesName()),colorSchemeFormBuilder.setEnabled("size_by_maximum",null!=heatMap.heatmap.getColorScheme().getSizer().getSeriesName()),updatingSizer||(colorSchemeFormBuilder.setValue("size_by_minimum",heatMap.heatmap.getColorScheme().getSizer().getMin()),colorSchemeFormBuilder.setValue("size_by_maximum",heatMap.heatmap.getColorScheme().getSizer().getMax())))}function createMetadataField(isColumns){var options=[],value={};return _.each(heatMap.getVisibleTrackNames(isColumns),function(name){value[name]=!0}),_.each(morpheus.MetadataUtil.getMetadataNames(isColumns?heatMap.getProject().getFullDataset().getColumnMetadata():heatMap.getProject().getFullDataset().getRowMetadata()),function(name){options.push(name)}),{type:"bootstrap-select",search:options.length>10,name:isColumns?"column_annotations":"row_annotations",multiple:!0,value:value,options:options,toggle:!0}}colorSchemeChooser.on("change",function(){colorSchemeChooserUpdated(),heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint(),colorSchemeChooser.restoreCurrentValue()});var annotationsBuilder=new morpheus.FormBuilder;function annotationsListener($select,isColumns){var names=[];_.each(heatMap.getVisibleTrackNames(isColumns),function(name){names.push(name)});var values=$select.val(),selectedNow=_.difference(values,names),unselectedNow=_.difference(names,values),tracks=[];_.each(selectedNow,function(name){tracks.push({name:name,isColumns:isColumns,visible:!0})}),_.each(unselectedNow,function(name){tracks.push({name:name,isColumns:isColumns,visible:!1})}),heatMap.setTrackVisibility(tracks),colorSchemeChooser.restoreCurrentValue()}annotationsBuilder.append(createMetadataField(!1)),annotationsBuilder.append(createMetadataField(!0));var $ca=annotationsBuilder.$form.find("[name=column_annotations]");$ca.on("change",function(e){annotationsListener($(this),!0)});var $ra=annotationsBuilder.$form.find("[name=row_annotations]");$ra.on("change",function(e){annotationsListener($(this),!1)});var annotationOptionsTabId=_.uniqueId("morpheus"),heatMapOptionsTabId=_.uniqueId("morpheus"),displayOptionsTabId=_.uniqueId("morpheus"),$metadataDiv=$('<div class="tab-pane" id="'+annotationOptionsTabId+'"></div>');$metadataDiv.append($(annotationsBuilder.$form));var $heatMapDiv=$('<div class="tab-pane active" id="'+heatMapOptionsTabId+'"></div>');$heatMapDiv.append(colorSchemeChooser.$div),$heatMapDiv.append($(colorSchemeFormBuilder.$form));var $displayDiv=$('<div class="tab-pane" id="'+displayOptionsTabId+'"></div>');$displayDiv.append($(displayFormBuilder.$form)),displayFormBuilder.setEnabled("grid_thickness",heatMap.heatmap.isDrawGrid()),displayFormBuilder.setEnabled("grid_color",heatMap.heatmap.isDrawGrid()),displayFormBuilder.$form.find("[name=show_grid]").on("click",function(e){var grid=$(this).prop("checked");displayFormBuilder.setEnabled("grid_thickness",grid),displayFormBuilder.setEnabled("grid_color",grid),heatMap.heatmap.setDrawGrid(grid),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue()});var $fractionDigits=displayFormBuilder.$form.find("[name=number_of_fraction_digits]");displayFormBuilder.$form.find("[name=show_values]").on("click",function(e){var drawValues=$(this).prop("checked");heatMap.heatmap.setDrawValues(drawValues),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue()}),$fractionDigits.on("keyup input",_.debounce(function(){var n=parseInt($(this).val());n>=0&&(heatMap.heatmap.setDrawValuesFormat(morpheus.Util.createNumberFormat("."+n+"f")),heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint())},100)),displayFormBuilder.$form.find("[name=inline_tooltip]").on("click",function(e){heatMap.options.inlineTooltip=$(this).prop("checked")}),displayFormBuilder.$form.find("[name=grid_color]").on("change",function(e){var value=$(this).val();heatMap.heatmap.setGridColor(value),heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint()}),displayFormBuilder.$form.find("[name=grid_thickness]").on("keyup",_.debounce(function(e){var value=parseFloat($(this).val());isNaN(value)||(heatMap.heatmap.setGridThickness(value),heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint())},100)),displayFormBuilder.$form.find("[name=row_size]").on("keyup",_.debounce(function(e){var value=parseFloat($(this).val());isNaN(value)||(heatMap.heatmap.getRowPositions().setSize(value),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue())},100)),displayFormBuilder.$form.find("[name=info_window]").on("change",function(e){heatMap.setTooltipMode(parseInt($(this).val()))}),displayFormBuilder.find("link_rows_and_columns").on("click",function(e){$(this).prop("checked")?heatMap.getProject().setSymmetric(heatMap):heatMap.getProject().setSymmetric(null)}),displayFormBuilder.find("show_row_number").on("click",function(e){var checked=$(this).prop("checked");heatMap.setShowRowNumber(checked),heatMap.revalidate()});var $colorByValue=colorSchemeFormBuilder.$form.find("[name=color_by_value]"),separateSchemesField=heatMap.heatmap.getColorScheme().getSeparateColorSchemeForRowMetadataField();if(null!=separateSchemesField){var v=heatMap.project.getFullDataset().getRowMetadata().getByName(separateSchemesField);null!=v&&$colorByValue.html(morpheus.Util.createOptions(morpheus.VectorUtil.createValueToIndexMap(v).keys()))}null!=separateSchemesField&&colorSchemeChooser.setCurrentValue($colorByValue.val()),heatMap.heatmap.getColorScheme().getSizer&&null!=heatMap.heatmap.getColorScheme().getSizer()&&heatMap.heatmap.getColorScheme().getSizer().getSeriesName()&&colorSchemeFormBuilder.setValue("size_by",heatMap.heatmap.getColorScheme().getSizer().getSeriesName()),colorSchemeFormBuilder.$form.find("[name=size_by]").on("change",function(e){var series=$(this).val();"(None)"==series&&(series=null),colorSchemeChooser.colorScheme.getSizer().setSeriesName(series),colorSchemeChooser.fireChanged()}),colorSchemeFormBuilder.$form.find("[name=size_by_minimum]").on("keyup",_.debounce(function(e){updatingSizer=!0,colorSchemeChooser.colorScheme.getSizer().setMin(parseFloat($(this).val())),colorSchemeChooser.fireChanged(!0),updatingSizer=!1},100)),colorSchemeFormBuilder.$form.find("[name=size_by_maximum]").on("keyup",_.debounce(function(e){updatingSizer=!0,colorSchemeChooser.colorScheme.getSizer().setMax(parseFloat($(this).val())),colorSchemeChooser.fireChanged(!0),updatingSizer=!1},100)),colorSchemeFormBuilder.$form.find("[name=conditional_rendering]").on("click",function(e){e.preventDefault();var conditionalRenderingUI=new morpheus.ConditionalRenderingUI(heatMap);morpheus.FormBuilder.showInModal({title:"Conditional Rendering",html:conditionalRenderingUI.$div,close:"Close",modalClass:"morpheus-sub-modal"})}),colorSchemeFormBuilder.find("save_color_scheme").on("click",function(e){e.preventDefault();var saveColorSchemeFormBuilder=new morpheus.FormBuilder;saveColorSchemeFormBuilder.append({name:"save_to",type:"radio",value:"Browser Storage",options:["Browser Storage","File"]}),saveColorSchemeFormBuilder.append({name:"color_scheme_name",type:"text"}),saveColorSchemeFormBuilder.append({name:"file_name",type:"text"}),saveColorSchemeFormBuilder.setVisible("file_name",!1),saveColorSchemeFormBuilder.find("save_to").on("change",function(){var isBrowser="Browser Storage"===$(this).val();saveColorSchemeFormBuilder.setVisible("file_name",!isBrowser),saveColorSchemeFormBuilder.setVisible("color_scheme_name",isBrowser)}),morpheus.FormBuilder.showOkCancel({title:"Save Color Scheme",ok:!0,cancel:!0,draggable:!0,content:saveColorSchemeFormBuilder.$form,appendTo:heatMap.getContentEl(),align:"right",okCallback:function(){var colorSchemeText=JSON.stringify(heatMap.heatmap.getColorScheme().toJSON());if("Browser Storage"===saveColorSchemeFormBuilder.getValue("save_to")){""===(name=saveColorSchemeFormBuilder.getValue("color_scheme_name").trim())&&(name="my color scheme");var colorSchemeObject=localStorage.getItem("morpheus-colorScheme");(colorSchemeObject=null==colorSchemeObject?{}:JSON.parse(colorSchemeObject))[name]=colorSchemeText,localStorage.setItem("morpheus-colorScheme",JSON.stringify(colorSchemeObject)),colorSchemeFormBuilder.setOptions("saved_color_scheme",createColorSchemeOptions())}else{var name;""===(name=saveColorSchemeFormBuilder.getValue("file_name").trim())&&(name="color_scheme.json");var blob=new Blob([colorSchemeText],{type:"application/json"});saveAs(blob,name)}},focus:heatMap.getFocusEl()})}),colorSchemeFormBuilder.setEnabled("delete_color_scheme",!1),colorSchemeFormBuilder.find("delete_color_scheme").on("click",function(){var key=colorSchemeFormBuilder.getValue("saved_color_scheme"),savedColorSchemes=JSON.parse(localStorage.getItem("morpheus-colorScheme"));delete savedColorSchemes[key],localStorage.setItem("morpheus-colorScheme",JSON.stringify(savedColorSchemes)),colorSchemeFormBuilder.setOptions("saved_color_scheme",createColorSchemeOptions())}),colorSchemeFormBuilder.find("saved_color_scheme").on("change",function(){colorSchemeFormBuilder.setEnabled("delete_color_scheme",-1===["relative","cn","MAF","binary","My Computer..."].indexOf(colorSchemeFormBuilder.getValue("saved_color_scheme")))}),colorSchemeFormBuilder.find("load_color_scheme").on("click",function(e){var val=colorSchemeFormBuilder.getValue("saved_color_scheme"),repaint=!0;if("relative"===val)heatMap.heatmap.getColorScheme().setColorSupplierForCurrentValue(morpheus.AbstractColorSupplier.fromJSON(morpheus.HeatMapColorScheme.Predefined.RELATIVE()));else if("cn"===val)heatMap.heatmap.getColorScheme().setColorSupplierForCurrentValue(morpheus.AbstractColorSupplier.fromJSON(morpheus.HeatMapColorScheme.Predefined.CN()));else if("MAF"===val)heatMap.heatmap.getColorScheme().setColorSupplierForCurrentValue(morpheus.AbstractColorSupplier.fromJSON(morpheus.HeatMapColorScheme.Predefined.MAF()));else if("binary"===val)heatMap.heatmap.getColorScheme().setColorSupplierForCurrentValue(morpheus.AbstractColorSupplier.fromJSON(morpheus.HeatMapColorScheme.Predefined.BINARY()));else if("My Computer..."===val){repaint=!1;var $file=$('<input style="display:none;" type="file">');$file.appendTo(heatMap.getContentEl()),$file.click(),$file.on("change",function(evt){evt.target.files;morpheus.Util.getText(evt.target.files[0]).then(function(text){var json=JSON.parse($.trim(text));heatMap.heatmap.getColorScheme().fromJSON(json),colorSchemeChooser.setColorScheme(heatMap.heatmap.getColorScheme()),heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint()}).catch(function(){morpheus.FormBuilder.showInModal({title:"Error",html:"Unable to read color scheme."})}).finally(function(){$file.remove()})})}else{var savedColorSchemes=JSON.parse(localStorage.getItem("morpheus-colorScheme")),scheme=JSON.parse(savedColorSchemes[val]);heatMap.heatmap.getColorScheme().fromJSON(scheme)}repaint&&(colorSchemeChooser.setColorScheme(heatMap.heatmap.getColorScheme()),heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint()),colorSchemeChooser.restoreCurrentValue()}),colorSchemeFormBuilder.$form.find("[name=color_by]").on("change",function(e){var colorByField=$(this).val();"(None)"==colorByField&&(colorByField=null);var colorByValue=null;heatMap.heatmap.getColorScheme().setSeparateColorSchemeForRowMetadataField(colorByField),null!=colorByField?($colorByValue.html(morpheus.Util.createOptions(morpheus.VectorUtil.createValueToIndexMap(heatMap.project.getFullDataset().getRowMetadata().getByName(colorByField)).keys())),colorByValue=$colorByValue.val()):$colorByValue.html(""),heatMap.heatmap.getColorScheme().setCurrentValue(colorByValue),colorSchemeChooser.setCurrentValue(colorByValue),heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint(),colorSchemeChooser.setColorScheme(heatMap.heatmap.getColorScheme())}),colorSchemeFormBuilder.$form.find("[name=shape]").on("change",function(e){heatMap.heatmap.setShape($(this).val()),heatMap.heatmap.setInvalid(!0),heatMap.heatmap.repaint()}),$colorByValue.on("change",function(e){null==heatMap.heatmap.getColorScheme().getSeparateColorSchemeForRowMetadataField()?(colorSchemeChooser.setCurrentValue(null),heatMap.heatmap.getColorScheme().setCurrentValue(null),colorSchemeChooser.setColorScheme(heatMap.heatmap.getColorScheme())):(colorSchemeChooser.setCurrentValue($colorByValue.val()),colorSchemeChooser.setColorScheme(heatMap.heatmap.getColorScheme()))}),displayFormBuilder.$form.find("[name=column_size]").on("keyup",_.debounce(function(e){heatMap.heatmap.getColumnPositions().setSize(parseFloat($(this).val())),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue()},100)),displayFormBuilder.$form.find("[name=row_gap_size]").on("keyup",_.debounce(function(e){heatMap.rowGapSize=parseFloat($(this).val()),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue()},100)),displayFormBuilder.$form.find("[name=column_gap_size]").on("keyup",_.debounce(function(e){heatMap.columnGapSize=parseFloat($(this).val()),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue()},100)),displayFormBuilder.$form.find("[name=squish_factor]").on("keyup",_.debounce(function(e){var f=parseFloat($(this).val());heatMap.heatmap.getColumnPositions().setSquishFactor(f),heatMap.heatmap.getRowPositions().setSquishFactor(f),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue()},100)),displayFormBuilder.$form.find("[name=row_dendrogram_line_thickness]").on("keyup",_.debounce(function(e){heatMap.rowDendrogram.lineWidth=parseFloat($(this).val()),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue()},100)),displayFormBuilder.$form.find("[name=column_dendrogram_line_thickness]").on("keyup",_.debounce(function(e){heatMap.columnDendrogram.lineWidth=parseFloat($(this).val()),heatMap.revalidate(),colorSchemeChooser.restoreCurrentValue()},100));var $tab=$('<div class="tab-content"></div>');$metadataDiv.appendTo($tab),$heatMapDiv.appendTo($tab),$displayDiv.appendTo($tab);var $div=$("<div></div>"),$ul=$('<ul class="nav nav-tabs" role="tablist"><li><a href="#'+annotationOptionsTabId+'" role="tab" data-toggle="tab">Annotations</a></li><li><a href="#'+heatMapOptionsTabId+'" role="tab" data-toggle="tab">Color Scheme</a></li><li><a href="#'+displayOptionsTabId+'" role="tab" data-toggle="tab">Display</a></li></ul>');$ul.appendTo($div),$tab.appendTo($div),colorSchemeChooser.setColorScheme(heatMap.heatmap.getColorScheme()),colorSchemeChooserUpdated(),$ul.find("[role=tab]:eq(1)").tab("show"),morpheus.FormBuilder.showInModal({title:"Options",html:$div,close:"Close",focus:heatMap.getFocusEl(),onClose:function(){$div.find("input").off("keyup"),$ca.off("change"),$ra.off("change"),$div.remove(),colorSchemeChooser.dispose()}})},morpheus.HeatMapSizer=function(){this.seriesName=null,this.sizeByScale=d3.scale.linear().domain([this.min,this.max]).range([0,1]).clamp(!0)},morpheus.HeatMapSizer.prototype={min:0,max:1,copy:function(){var sizer=new morpheus.HeatMapSizer;return sizer.seriesName=this.seriesName,sizer.min=this.min,sizer.max=this.max,sizer.sizeByScale=this.sizeByScale.copy(),sizer},valueToFraction:function(value){return this.sizeByScale(value)},setMin:function(min){this.min=min,this.sizeByScale=d3.scale.linear().domain([this.min,this.max]).range([0,1]).clamp(!0)},setMax:function(max){this.max=max,this.sizeByScale=d3.scale.linear().domain([this.min,this.max]).range([0,1]).clamp(!0)},getMin:function(){return this.min},getMax:function(){return this.max},getSeriesName:function(){return this.seriesName},setSeriesName:function(name){this.seriesName=name}},morpheus.HeatMapToolBar=function(heatMap){this.heatMap=heatMap,this.rowSearchResultModelIndices=[],this.columnSearchResultModelIndices=[];var _this=this,layout=['<div class="hidden-print">'];layout.push('<div data-name="toolbar"></div>'),layout.push('<div data-name="tip" style="white-space:nowrap; border-top: thin solid #e7e7e7;margin-bottom:2px;height: 14px; font-size: 10px;overflow:hidden;"></div>'),layout.push("</div>");var $el=$(layout.join("")),searchHtml=[],$searchForm=$('<form style="display:inline-block;margin-right:14px;" name="searchForm" class="form form-inline morpheus-form-compact" role="search"></form>');function createSearchMenu(dataName,navigation){searchHtml.push('<div style="display:inline-block;" data-name="'+dataName+'">'),searchHtml.push('<div class="form-group">'),searchHtml.push('<input type="text" class="form-control input-sm" autocomplete="off" name="search">'),searchHtml.push("</div>"),searchHtml.push('<div class="form-group">'),searchHtml.push('<span data-name="searchResultsWrapper" style="display:none;">'),searchHtml.push('<span style="font-size:12px;" data-name="searchResults"></span>'),navigation&&(searchHtml.push('<button name="previousMatch" type="button" class="btn btn-default btn-xxs" data-toggle="tooltip" title="Previous"><i class="fa fa-chevron-up"></i></button>'),searchHtml.push('<button name="nextMatch" type="button" class="btn btn-default btn-xxs" data-toggle="tooltip" title="Next"><i class="fa fa-chevron-down"></i></button>'),searchHtml.push('<button name="matchesToTop" type="button" class="btn btn-default btn-xxs" data-toggle="tooltip" title="Matches To Top"><i class="fa fa-level-up"></i></button>')),searchHtml.push("</span>"),searchHtml.push("</div>"),searchHtml.push("</div>"),searchHtml.push("</div>")}$searchForm.on("submit",function(e){e.preventDefault()}),searchHtml.push('<div title="Toggle Search ('+morpheus.Util.COMMAND_KEY+'/)" class="btn-group" data-toggle="buttons">'),searchHtml.push('<label class="btn btn-default btn-xxs">'),searchHtml.push('<input data-search="rows" type="radio" autocomplete="off" name="searchToggle" type="button"> Rows'),searchHtml.push("</label>"),searchHtml.push('<label class="btn btn-default btn-xxs">'),searchHtml.push('<input data-search="columns" type="radio" autocomplete="off" name="searchToggle"> Columns'),searchHtml.push("</label>"),searchHtml.push('<label class="btn btn-default btn-xxs">'),searchHtml.push('<input data-search="values" type="radio" autocomplete="off" name="searchToggle"> Values'),searchHtml.push("</label>"),searchHtml.push('<label class="btn btn-default btn-xxs">'),searchHtml.push('<input data-search="rowDendrogram" type="radio" autocomplete="off" name="searchToggle"> Row Dendrogram'),searchHtml.push("</label>"),searchHtml.push('<label class="btn btn-default btn-xxs">'),searchHtml.push('<input data-search="columnDendrogram" type="radio" autocomplete="off" name="searchToggle"> Column Dendrogram'),searchHtml.push("</label>"),searchHtml.push("</div>"),void 0===heatMap.options.toolbar.indexOf&&(heatMap.options.toolbar.indexOf=function(){return-1});var searchRows=-1!==heatMap.options.toolbar.indexOf("Search Rows"),searchColumns=-1!==heatMap.options.toolbar.indexOf("Search Columns"),searchValues=-1!==heatMap.options.toolbar.indexOf("Search Values");(searchRows||searchColumns||searchValues)&&(searchHtml.push('<div style="display:inline-block;" class="dropdown">'),searchHtml.push('<button type="button" class="btn btn-default btn-xxs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="fa fa-caret-down"></span></button>'),searchHtml.push('<ul data-name="searchOptions" class="dropdown-menu">'),searchHtml.push('<li><a data-group="matchMode" data-name="exact" href="#"><span data-type="toggle"></span>Exact Match</a></li>'),searchHtml.push('<li><a data-group="matchMode" data-name="contains" href="#"><span data-type="toggle" class="dropdown-checkbox fa fa-check"></span>Contains</a></li>'),searchHtml.push('<li role="separator" class="divider"></li>'),searchHtml.push('<li><a data-group="searchMode" data-name="matchAny" href="#"><span data-type="toggle" class="dropdown-checkbox fa fa-check"></span>Match Any Search Term</a></li>'),searchHtml.push('<li><a data-group="searchMode" data-name="matchAll" href="#"><span data-type="toggle"></span>Match All Search Terms</a></li>'),searchHtml.push('<li role="separator" class="divider"></li>'),searchHtml.push('<li><a data-name="searchHelp" href="#">Help</a></li>'),searchHtml.push("</ul>"),searchHtml.push("</div>")),searchRows&&createSearchMenu("searchRowsGroup",!0),searchColumns&&createSearchMenu("searchColumnsGroup",!0),searchValues&&createSearchMenu("searchValuesGroup",!1),createSearchMenu("searchRowDendrogramGroup",!1),createSearchMenu("searchColumnDendrogramGroup",!1),-1!==heatMap.options.toolbar.indexOf("Dimensions")&&(searchHtml.push('<div class="form-group">'),searchHtml.push('<h6 style="display: inline; margin-left:10px;" data-name="dim"></h6>'),searchHtml.push('<h6 style="display: inline; margin-left:10px;" data-name="selection"></h6>'),searchHtml.push("</div>")),$(searchHtml.join("")).appendTo($searchForm);var $lineOneColumn=$el.find("[data-name=toolbar]");morpheus.Util.isNode()||heatMap.menu.applicationMenu.appendTo($lineOneColumn),$searchForm.appendTo($lineOneColumn);var toolbarHtml=['<div style="display: inline;">'];if(toolbarHtml.push('<div class="morpheus-button-divider"></div>'),-1!==heatMap.options.toolbar.indexOf("Zoom")){var dropdownId=_.uniqueId("morpheus");toolbarHtml.push('<div style="display:inline-block;" class="dropdown">'),toolbarHtml.push('<a class="dropdown-toggle morpheus-black-link" type="button" id="'+dropdownId+'" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">'),toolbarHtml.push('<button type="button" class="btn btn-default btn-xxs"><span class="fa fa-search-plus"></span>'),toolbarHtml.push(' <span style="font-size: .8em;" class="fa fa-caret-down"></span>'),toolbarHtml.push("</button>"),toolbarHtml.push('<ul style="width:200px;" class="dropdown-menu" aria-labelledby="'+dropdownId+'">'),toolbarHtml.push('<li><a class="morpheus-menu-item" href="#" data-action="Zoom In">Zoom In<span class="pull-right">+</span></a></li>'),toolbarHtml.push('<li><a class="morpheus-menu-item" href="#" data-action="Zoom Out">Zoom Out<span class="pull-right">-</span></a></li>'),toolbarHtml.push('<li role="separator" class="divider"></li>'),toolbarHtml.push('<li><a class="morpheus-menu-item" href="#" data-action="Fit To Window">Fit To Window<span class="fa fa-compress morpheus-menu-item-icon"></span><span class="pull-right">'+morpheus.Util.COMMAND_KEY+morpheus.KeyboardCharMap[heatMap.getActionManager().getAction("Fit To Window").which[0]]+"</span> </a></li>"),toolbarHtml.push('<li><a class="morpheus-menu-item" href="#" data-action="Fit Rows To Window">Fit Rows To Window</a></li>'),toolbarHtml.push('<li><a class="morpheus-menu-item" href="#" data-action="Fit Columns To Window">Fit Columns To Window</a></li>'),toolbarHtml.push('<li role="separator" class="divider"></li>'),toolbarHtml.push('<li><a class="morpheus-menu-item" href="#" data-action="100%">100%<span class="fa fa-compress morpheus-menu-item-icon"></span><span class="pull-right">'+morpheus.Util.SHIFT_KEY+morpheus.Util.COMMAND_KEY+morpheus.KeyboardCharMap[heatMap.getActionManager().getAction("100%").which[0]]+"</span> </a></li>"),toolbarHtml.push("</ul>"),toolbarHtml.push("</div>")}toolbarHtml.push('<div class="morpheus-button-divider"></div>'),-1!==heatMap.options.toolbar.indexOf("Options")&&toolbarHtml.push('<button data-action="Options" data-toggle="tooltip" title="Options" type="button" class="btn btn-default btn-xxs"><span class="fa fa-cog"></span></button>'),toolbarHtml.push('<div class="morpheus-button-divider"></div>'),-1!==heatMap.options.toolbar.indexOf("Save Image")&&toolbarHtml.push('<button data-action="Save Image" data-toggle="tooltip" title="Save Image ('+morpheus.Util.COMMAND_KEY+'S)" type="button" class="btn btn-default btn-xxs"><span class="fa fa-file-image-o"></span></button>'),toolbarHtml.push('<div class="morpheus-button-divider"></div>'),-1!==heatMap.options.toolbar.indexOf("Filter")&&toolbarHtml.push('<button data-action="Filter" data-toggle="tooltip" title="Filter" type="button" class="btn btn-default btn-xxs"><span class="fa fa-filter"></span></button>'),-1!==heatMap.options.toolbar.indexOf("Color Key")&&(toolbarHtml.push('<div class="morpheus-button-divider"></div>'),toolbarHtml.push('<div class="btn-group">'),toolbarHtml.push('<button type="button" class="btn btn-default btn-xxs" data-toggle="dropdown"><span title="Color Key" data-toggle="tooltip" class="fa fa-key"></span></button>'),toolbarHtml.push('<ul data-name="key" class="dropdown-menu" role="menu">'),toolbarHtml.push('<li data-name="keyContent"></li>'),toolbarHtml.push("</ul>"),toolbarHtml.push("</div>")),toolbarHtml.push("</div>");var $toolbar=$(toolbarHtml.join(""));$toolbar.find("[data-action]").on("click",function(e){e.preventDefault(),heatMap.getActionManager().execute($(this).data("action"))}).on("blur",function(e){document.activeElement===document.body&&heatMap.focus()}),morpheus.Util.isNode()||heatMap.menu.applicationMenu.on("click","li > a",function(e){e.preventDefault(),heatMap.getActionManager().execute($(this).data("action"))}).on("blur",function(e){document.activeElement===document.body&&heatMap.focus()}),heatMap.options.toolbar.$customButtons&&heatMap.options.toolbar.$customButtons.appendTo($toolbar),$toolbar.appendTo($lineOneColumn),$el.prependTo(heatMap.$content),this.$tip=$el.find("[data-name=tip]"),$el.find('[data-toggle="tooltip"]').tooltip({placement:"bottom",container:"body",trigger:"hover"}).on("click",function(){$(this).tooltip("hide")});var $key=$el.find("[data-name=key]"),$keyContent=$el.find("[data-name=keyContent]");$key.dropdown().parent().on("show.bs.dropdown",function(){new morpheus.HeatMapColorSchemeLegend(heatMap,$keyContent),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"colorKey"})});var searchHelpHtml=[];searchHelpHtml.push("<h4>Symbols</h4>"),searchHelpHtml.push('<table class="table table-bordered">'),searchHelpHtml.push("<tr><th>Term</th><th>Description</th></tr>"),searchHelpHtml.push('<tr><td><code><strong>*</strong></code></td><td>Quote a search term for an exact match. <br />Example: <code><strong>"root beer"</strong></code></td></tr>'),searchHelpHtml.push("<tr><td><code><strong>-</strong></code></td><td>Exclude matches using - modifier.</td></tr>"),searchHelpHtml.push("<tr><td><code><strong>..</strong></code></td><td>Separate numbers by two periods without spaces to see numbers that fall within a range.. <br />Example: <code><strong>1..10</strong></code></td></tr>"),searchHelpHtml.push("<tr><td><code><strong><= < > >= =</strong></code></td><td>Perform a numeric search. <br />Example: <code><strong>>4</strong></code></td></tr>"),searchHelpHtml.push("</table>"),searchHelpHtml.push("<h4>Search fields</h4>"),searchHelpHtml.push('<p>You can restrict your search to any field by typing the field name followed by a colon ":" and then the term you are looking for. For example, to search for matches containing "beer" in the beverage field, you can enter: <code><strong>beverage:beer</strong></code>'),searchHelpHtml.push("Note that searches only include metadata fields that are displayed. You can search a hidden field by performing a field search."),searchHelpHtml.push("<p>You can search for an exact list of values by enclosing the list of values in parentheses. For example: <code><strong>pet:(cat dog)</strong></code> searches all pets that are either cats or dogs.</p>");var $searchHelp=$(searchHelpHtml.join(""));$el.find("[data-name=searchHelp]").on("click",function(e){e.preventDefault(),morpheus.FormBuilder.showInModal({title:"Search Help",html:$searchHelp,appendTo:heatMap.getContentEl(),focus:heatMap.getFocusEl()})});var $searchRowsGroup=$searchForm.find("[data-name=searchRowsGroup]"),$searchColumnsGroup=$searchForm.find("[data-name=searchColumnsGroup]"),$searchValuesGroup=$searchForm.find("[data-name=searchValuesGroup]"),$searchRowDendrogramGroup=$searchForm.find("[data-name=searchRowDendrogramGroup]"),$searchColumnDendrogramGroup=$searchForm.find("[data-name=searchColumnDendrogramGroup]");this.$searchRowDendrogramGroup=$searchRowDendrogramGroup,this.$searchColumnDendrogramGroup=$searchColumnDendrogramGroup,this.matchMode="contains",this.matchAllPredicates=!1;var $searchToggle=$searchForm.find("[name=searchToggle]"),nameToSearchObject={};function getSearchElements($group,searchName,cb){var obj={$group:$group,$search:$group.find("[name=search]"),$searchResultsWrapper:$group.find("[data-name=searchResultsWrapper]"),$searchResults:$group.find("[data-name=searchResults]"),$previousMatch:$group.find("[name=previousMatch]"),$nextMatch:$group.find("[name=nextMatch]"),$matchesToTop:$group.find("[name=matchesToTop]"),$toggleButton:$searchToggle.filter("[data-search="+searchName+"]").parent()};return nameToSearchObject[searchName]=obj,obj}var $searchOptions=$el.find("[data-name=searchOptions]");$searchOptions.on("click","li > a",function(e){e.preventDefault();var $searchField,$this=$(this),group=$this.data("group");"matchMode"===group?_this.matchMode=$this.data("name"):_this.matchAllPredicates="matchAll"===$this.data("name"),_this.rowSearchObject.$search.is(":visible")?$searchField=_this.rowSearchObject.$search:_this.columnSearchObject.$search.is(":visible")?$searchField=_this.rowSearchObject.$search:_this.rowDendrogramSearchObject.$search.is(":visible")?$searchField=_this.rowSearchObject.$search:_this.columnDendrogramSearchObject.$search.is(":visible")?$searchField=_this.rowSearchObject.$search:_this.valueSearchObject.$search.is(":visible")&&($searchField=_this.rowSearchObject.$search),$searchField&&$searchField.trigger($.Event("keyup",{keyCode:13,which:13}));var $span=$(this).find("span");"toggle"===$span.data("type")&&($searchOptions.find("[data-group="+group+"] > [data-type=toggle]").removeClass("dropdown-checkbox fa fa-check"),$span.addClass("dropdown-checkbox fa fa-check")),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"searchMatchMode"})}),this.rowSearchObject=getSearchElements($searchRowsGroup,"rows"),this.columnSearchObject=getSearchElements($searchColumnsGroup,"columns"),this.rowDendrogramSearchObject=getSearchElements($searchRowDendrogramGroup,"rowDendrogram"),this.columnDendrogramSearchObject=getSearchElements($searchColumnDendrogramGroup,"columnDendrogram"),this.valueSearchObject=getSearchElements($searchValuesGroup,"values"),searchRows||(this.rowSearchObject.$toggleButton.hide(),this.rowSearchObject.$group.css("display","none")),searchColumns||(this.columnSearchObject.$toggleButton.hide(),this.columnSearchObject.$group.css("display","none")),searchValues||(this.valueSearchObject.$toggleButton.hide(),this.valueSearchObject.$group.css("display","none")),this.rowDendrogramSearchObject.$toggleButton.hide(),this.rowDendrogramSearchObject.$group.hide(),this.columnDendrogramSearchObject.$toggleButton.hide(),this.columnDendrogramSearchObject.$group.hide(),this.rowDendrogramSearchObject.$searchResultsWrapper.show(),this.columnDendrogramSearchObject.$searchResultsWrapper.show(),this.valueSearchObject.$searchResultsWrapper.show(),this.rowSearchObject.$search.css({"border-top":"3.8px solid #e6e6e6","border-bottom":"3.8px solid #e6e6e6",width:"240px"}),this.columnSearchObject.$search.css({"border-right":"3.8px solid #e6e6e6","border-left":"3.8px solid #e6e6e6",width:"240px"}),this.$valueSearchResults=$searchValuesGroup.find("[name=searchResults]"),this.$valueTextField=$searchValuesGroup.find("[name=search]"),this.$dimensionsLabel=$el.find("[data-name=dim]"),this.$selectionLabel=$el.find("[data-name=selection]"),$searchToggle.on("change",function(e){var search=$(this).data("search");for(var name in nameToSearchObject){var searchObject=nameToSearchObject[name];name===search?(searchObject.$group.css("display","inline-block"),searchObject.$search.focus()):searchObject.$group.css("display","none")}}),this.toggleSearch=function(){var $visible=$searchToggle.filter(":visible"),$checked=$searchToggle.filter(":checked"),$next=$visible.eq($visible.index($checked)+1);$next.length||($next=$visible.first()),$next.click()};for(var i=0;i<$searchToggle.length;i++){var $button=$($searchToggle[i]);if("block"===$button.parent().css("display")){$button.click();break}}heatMap.on("dendrogramAnnotated",function(e){e.isColumns?_this.rowDendrogramSearchObject.$toggleButton.show():_this.columnDendrogramSearchObject.$toggleButton.show()}),heatMap.on("dendrogramChanged",function(e){e.isColumns?(_this.rowDendrogramSearchObject.$group.hide(),_this.rowDendrogramSearchObject.$toggleButton.hide()):(_this.columnDendrogramSearchObject.$group.hide(),_this.columnDendrogramSearchObject.$toggleButton.hide())});var project=heatMap.getProject();function searchValues(){var $searchResultsLabel=_this.$valueSearchResults,text=$.trim(_this.$valueTextField.val());if(""===text)$searchResultsLabel.html(""),project.getElementSelectionModel().setViewIndices(null);else{var viewIndices=morpheus.DatasetUtil.searchValues({dataset:project.getSortedFilteredDataset(),text:text,matchAllPredicates:_this.matchAllPredicates,defaultMatchMode:_this.matchMode});project.getElementSelectionModel().setViewIndices(viewIndices),$searchResultsLabel.html(viewIndices.size()+" match"+(1===viewIndices.size()?"":"es"))}}morpheus.Util.autosuggest({$el:this.rowSearchObject.$search,filter:function(terms,cb){var indices=[],meta=project.getSortedFilteredDataset().getRowMetadata();heatMap.getVisibleTrackNames(!1).forEach(function(name){var index=morpheus.MetadataUtil.indexOf(meta,name);-1!==index&&indices.push(index)}),meta=new morpheus.MetadataModelColumnView(meta,indices),morpheus.MetadataUtil.autocomplete(meta)(terms,cb)},select:function(){_this.search(!0)}}),this.rowSearchObject.$search.on("keyup",_.debounce(function(e){13===e.which&&e.preventDefault(),_this.search(!0),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"searchRows"})},500)),morpheus.Util.autosuggest({$el:this.columnSearchObject.$search,filter:function(terms,cb){var indices=[],meta=project.getSortedFilteredDataset().getColumnMetadata();heatMap.getVisibleTrackNames(!0).forEach(function(name){var index=morpheus.MetadataUtil.indexOf(meta,name);-1!==index&&indices.push(index)}),meta=new morpheus.MetadataModelColumnView(meta,indices),morpheus.MetadataUtil.autocomplete(meta)(terms,cb)},select:function(){_this.search(!1)}}),this.columnSearchObject.$search.on("keyup",_.debounce(function(e){13===e.which&&e.preventDefault(),_this.search(!1),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"searchColumns"})},500)),morpheus.Util.autosuggest({$el:this.rowDendrogramSearchObject.$search,filter:function(tokens,cb){var d=heatMap.getDendrogram(!1);if(d.searchTerms){var token=null!=tokens&&tokens.length>0?tokens[tokens.selectionStartIndex]:"";""===(token=$.trim(token))?cb([]):morpheus.Util.autocompleteArrayMatcher(token,cb,d.searchTerms,null,10)}else cb([])},select:function(){_this.searchDendrogram(!1)}}),this.rowDendrogramSearchObject.$search.on("keyup",_.debounce(function(e){13===e.which&&e.preventDefault(),_this.searchDendrogram(!1),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"searchRowDendrogram"})},500)),morpheus.Util.autosuggest({$el:this.columnDendrogramSearchObject.$search,filter:function(tokens,cb){var d=heatMap.getDendrogram(!0);if(d.searchTerms){var token=null!=tokens&&tokens.length>0?tokens[tokens.selectionStartIndex]:"";""===(token=$.trim(token))?cb([]):morpheus.Util.autocompleteArrayMatcher(token,cb,d.searchTerms,null,10)}else cb([])},select:function(){_this.searchDendrogram(!0)}}),this.columnDendrogramSearchObject.$search.on("keyup",_.debounce(function(e){13===e.which&&e.preventDefault(),_this.searchDendrogram(!0),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"searchColumnDendrogram"})},500)),morpheus.Util.autosuggest({$el:this.$valueTextField,filter:function(terms,cb){morpheus.DatasetUtil.autocompleteValues(project.getSortedFilteredDataset())(terms,cb)},select:function(){searchValues()}}),this.$valueTextField.on("keyup",_.debounce(function(e){13===e.which&&(_this.$valueTextField.autocomplete("close"),e.preventDefault()),searchValues()},500)),this.toggleControls=function(){"none"===$lineOneColumn.css("display")?($lineOneColumn.css("display",""),_this.rowSearchObject.$search.focus()):($lineOneColumn.css("display","none"),$(_this.heatMap.heatmap.canvas).focus())},this.$el=$el;var updateFilterStatus=function(){heatMap.getProject().getRowFilter().isEnabled()||heatMap.getProject().getColumnFilter().isEnabled()?_this.$el.find("[name=filterButton]").addClass("btn-primary"):_this.$el.find("[name=filterButton]").removeClass("btn-primary")};updateFilterStatus(),this.columnSearchObject.$matchesToTop.on("click",function(e){e.preventDefault();var $this=$(this);$this.toggleClass("btn-primary"),_this.setSelectionOnTop({isColumns:!0,isOnTop:$this.hasClass("btn-primary"),updateButtonStatus:!1}),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"columnMatchesToTop"})}),this.rowSearchObject.$matchesToTop.on("click",function(e){e.preventDefault();var $this=$(this);$this.toggleClass("btn-primary"),_this.setSelectionOnTop({isColumns:!1,isOnTop:$this.hasClass("btn-primary"),updateButtonStatus:!1}),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"rowMatchesToTop"})}),project.on("rowSortOrderChanged.morpheus",function(e){_this.searching||(_this._updateSearchIndices(!1),_this.rowSearchObject.$matchesToTop.removeClass("btn-primary"))}),project.on("columnSortOrderChanged.morpheus",function(e){_this.searching||(_this._updateSearchIndices(!0),_this.columnSearchObject.$matchesToTop.removeClass("btn-primary"))}),heatMap.getProject().on("rowFilterChanged.morpheus",function(e){_this.search(!0),updateFilterStatus()}),heatMap.getProject().on("columnFilterChanged.morpheus",function(e){_this.search(!1),updateFilterStatus()}),heatMap.getProject().on("datasetChanged.morpheus",function(){_this.search(!0),_this.search(!1),updateFilterStatus()}),heatMap.getProject().getRowSelectionModel().on("selectionChanged.morpheus",function(){_this.updateSelectionLabel()}),heatMap.getProject().getColumnSelectionModel().on("selectionChanged.morpheus",function(){_this.updateSelectionLabel()}),this.rowSearchResultViewIndicesSorted=null,this.currentRowSearchIndex=0,this.columnSearchResultViewIndicesSorted=null,this.currentColumnSearchIndex=-1,this.columnSearchObject.$previousMatch.on("click",function(){_this.currentColumnSearchIndex--,_this.currentColumnSearchIndex<0&&(_this.currentColumnSearchIndex=_this.columnSearchResultViewIndicesSorted.length-1),heatMap.scrollLeft(heatMap.getHeatMapElementComponent().getColumnPositions().getPosition(_this.columnSearchResultViewIndicesSorted[_this.currentColumnSearchIndex])),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"previousColumnMatch"})}),this.rowSearchObject.$previousMatch.on("click",function(){_this.currentRowSearchIndex--,_this.currentRowSearchIndex<0&&(_this.currentRowSearchIndex=_this.rowSearchResultViewIndicesSorted.length-1),heatMap.scrollTop(heatMap.getHeatMapElementComponent().getRowPositions().getPosition(_this.rowSearchResultViewIndicesSorted[_this.currentRowSearchIndex])),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"previousRowMatch"})}),this.columnSearchObject.$nextMatch.on("click",function(){_this.next(!0),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"nextColumnMatch"})}),this.rowSearchObject.$nextMatch.on("click",function(){_this.next(!1),morpheus.Util.trackEvent({eventCategory:"ToolBar",eventAction:"nextRowMatch"})}),this.updateDimensionsLabel(),this.updateSelectionLabel()},morpheus.HeatMapToolBar.HIGHLIGHT_SEARCH_MODE=0,morpheus.HeatMapToolBar.FILTER_SEARCH_MODE=1,morpheus.HeatMapToolBar.MATCHES_TO_TOP_SEARCH_MODE=2,morpheus.HeatMapToolBar.SELECT_MATCHES_SEARCH_MODE=3,morpheus.HeatMapToolBar.prototype={quickColumnFilter:!1,searching:!1,rowSearchMode:morpheus.HeatMapToolBar.SELECT_MATCHES_SEARCH_MODE,columnSearchMode:morpheus.HeatMapToolBar.SELECT_MATCHES_SEARCH_MODE,_updateSearchIndices:function(isColumns){var project=this.heatMap.getProject();if(isColumns){for(var viewIndices=[],i=0,length=(modelIndices=this.columnSearchResultModelIndices).length;i<length;i++){-1!==(index=project.convertModelColumnIndexToView(modelIndices[i]))&&viewIndices.push(index)}viewIndices.sort(function(a,b){return a<b?-1:1}),this.columnSearchResultViewIndicesSorted=viewIndices,this.currentColumnSearchIndex=-1}else{var modelIndices;for(viewIndices=[],i=0,length=(modelIndices=this.rowSearchResultModelIndices).length;i<length;i++){var index;-1!==(index=project.convertModelRowIndexToView(modelIndices[i]))&&viewIndices.push(index)}viewIndices.sort(function(a,b){return a<b?-1:1}),this.rowSearchResultViewIndicesSorted=viewIndices,this.currentRowSearchIndex=-1}},next:function(isColumns){var heatMap=this.heatMap;isColumns?(this.currentColumnSearchIndex++,this.currentColumnSearchIndex>=this.columnSearchResultViewIndicesSorted.length&&(this.currentColumnSearchIndex=0),heatMap.scrollLeft(heatMap.getHeatMapElementComponent().getColumnPositions().getPosition(this.columnSearchResultViewIndicesSorted[this.currentColumnSearchIndex]))):(this.currentRowSearchIndex++,this.currentRowSearchIndex>=this.rowSearchResultViewIndicesSorted.length&&(this.currentRowSearchIndex=0),heatMap.scrollTop(heatMap.getHeatMapElementComponent().getRowPositions().getPosition(this.rowSearchResultViewIndicesSorted[this.currentRowSearchIndex])))},getSearchField:function(type){return type===morpheus.HeatMapToolBar.COLUMN_SEARCH_FIELD?this.columnSearchObject.$search:type===morpheus.HeatMapToolBar.ROW_SEARCH_FIELD?this.rowSearchObject.$search:type===morpheus.HeatMapToolBar.COLUMN_DENDROGRAM_SEARCH_FIELD?this.columnDendrogramSearchObject.$search:type===morpheus.HeatMapToolBar.ROW_DENDROGRAM_SEARCH_FIELD?this.rowDendrogramSearchObject.$search:void console.log("Unknown field")},setSearchText:function(options){var $tf=options.isColumns?this.columnSearchObject.$search:this.rowSearchObject.$search,existing=options.append?$.trim($tf.val()):"";""!==existing&&(existing+=" "),options.onTop&&(options.isColumns?this.columnSearchObject.$matchesToTop.addClass("btn-primary"):this.rowSearchObject.$matchesToTop.addClass("btn-primary")),$tf.val(existing+options.text),this.search(!options.isColumns),options.scrollTo&&this.next(options.isColumns)},updateDimensionsLabel:function(){var p=this.heatMap.getProject(),d=p.getFullDataset(),f=p.getSortedFilteredDataset(),text=[];f.getRowCount()!==d.getRowCount()?(text.push("<b>"),text.push(morpheus.Util.intFormat(f.getRowCount())),text.push("/"),text.push(morpheus.Util.intFormat(d.getRowCount())),text.push("</b>")):text.push(morpheus.Util.intFormat(f.getRowCount())),text.push(" rows by "),f.getColumnCount()!==d.getColumnCount()?(text.push("<b>"),text.push(morpheus.Util.intFormat(f.getColumnCount())),text.push("/"),text.push(morpheus.Util.intFormat(d.getColumnCount())),text.push("</b>")):text.push(morpheus.Util.intFormat(f.getColumnCount())),text.push(" columns"),this.$dimensionsLabel.html(text.join(""))},updateSelectionLabel:function(){var nc=this.heatMap.getProject().getColumnSelectionModel().count(),nr=this.heatMap.getProject().getRowSelectionModel().count(),text=[];text.push(morpheus.Util.intFormat(nr)+" row"),1!==nr&&text.push("s"),text.push(", "),text.push(morpheus.Util.intFormat(nc)+" column"),1!==nc&&text.push("s"),text.push(" selected"),this.$selectionLabel.html(text.join(""))},searchDendrogram:function(isColumns){var searchObject=isColumns?this.columnDendrogramSearchObject:this.rowDendrogramSearchObject,text=$.trim(searchObject.$search.val()),dendrogram=isColumns?this.heatMap.columnDendrogram:this.heatMap.rowDendrogram,$searchResults=searchObject.$searchResults,matches=morpheus.DendrogramUtil.search({rootNode:dendrogram.tree.rootNode,text:text,matchAllPredicates:this.matchAllPredicates,defaultMatchMode:this.matchMode});if(-1===matches?$searchResults.html(""):$searchResults.html(matches+" match"+(1===matches?"":"es")),matches<=0){var positions=isColumns?this.heatMap.getHeatMapElementComponent().getColumnPositions():this.heatMap.getHeatMapElementComponent().getRowPositions();positions.setSquishedIndices(null),isColumns?this.heatMap.getProject().setGroupColumns([],!0):this.heatMap.getProject().setGroupRows([],!0),positions.setSize(isColumns?this.heatMap.getFitColumnSize():this.heatMap.getFitRowSize())}else morpheus.DendrogramUtil.squishNonSearchedNodes(this.heatMap,isColumns);this.heatMap.updateDataset(),this.heatMap.revalidate()},search:function(isRows){this.searching=!0;var isMatchesOnTop=isRows?this.rowSearchObject.$matchesToTop.hasClass("btn-primary"):this.columnSearchObject.$matchesToTop.hasClass("btn-primary"),heatMap=this.heatMap,project=heatMap.getProject(),sortKeys=isRows?project.getRowSortKeys():project.getColumnSortKeys();sortKeys=sortKeys.filter(function(key){return!(key instanceof morpheus.MatchesOnTopSortKey&&"matches on top"===key.toString())});var dataset=project.getSortedFilteredDataset(),$searchResultsLabel=isRows?this.rowSearchObject.$searchResults:this.columnSearchObject.$searchResults,searchText=isRows?$.trim(this.rowSearchObject.$search.val()):$.trim(this.columnSearchObject.$search.val()),metadata=isRows?dataset.getRowMetadata():dataset.getColumnMetadata(),visibleIndices=[];heatMap.getVisibleTrackNames(!isRows).forEach(function(name){var index=morpheus.MetadataUtil.indexOf(metadata,name);-1!==index&&visibleIndices.push(index)});var fullModel=metadata;metadata=new morpheus.MetadataModelColumnView(metadata,visibleIndices);var searchResultViewIndices=morpheus.MetadataUtil.search({model:metadata,fullModel:fullModel,text:searchText,isColumns:!isRows,matchAllPredicates:this.matchAllPredicates,defaultMatchMode:this.matchMode});""===searchText?($searchResultsLabel.html(""),isRows?this.rowSearchObject.$searchResultsWrapper.hide():this.columnSearchObject.$searchResultsWrapper.hide()):($searchResultsLabel.html(searchResultViewIndices.length+" match"+(1===searchResultViewIndices.length?"":"es")),isRows?this.rowSearchObject.$searchResultsWrapper.show():this.columnSearchObject.$searchResultsWrapper.show());var searchResultsModelIndices=[];if(null!=searchResultViewIndices)for(var i=0,length=searchResultViewIndices.length;i<length;i++){var viewIndex=searchResultViewIndices[i];searchResultsModelIndices.push(isRows?project.convertViewRowIndexToModel(viewIndex):project.convertViewColumnIndexToModel(viewIndex))}if(null!==searchResultViewIndices&&isMatchesOnTop){var key=new morpheus.MatchesOnTopSortKey(project,searchResultsModelIndices,"matches on top",!isRows);searchResultViewIndices=key.indices,sortKeys.splice(0,0,key),isRows?project.setRowSortKeys(sortKeys,!1):project.setColumnSortKeys(sortKeys,!1)}var searchResultsViewIndicesSet=new morpheus.Set;if(null!=searchResultViewIndices)for(i=0,length=searchResultViewIndices.length;i<length;i++){viewIndex=searchResultViewIndices[i];searchResultsViewIndicesSet.add(viewIndex)}null==searchResultViewIndices&&(searchResultViewIndices=[]),isRows?(this.rowSearchResultModelIndices=searchResultsModelIndices,this.rowSearchResultViewIndicesSorted=searchResultViewIndices.sort(function(a,b){return a<b?-1:1}),this.currentRowSearchIndex=-1):(this.columnSearchResultModelIndices=searchResultsModelIndices,this.columnSearchResultViewIndicesSorted=searchResultViewIndices.sort(function(a,b){return a<b?-1:1}),this.currentColumnSearchIndex=-1),(isRows?project.getRowSelectionModel():project.getColumnSelectionModel()).setViewIndices(searchResultsViewIndicesSet,!0),isMatchesOnTop&&(isRows?project.setRowSortKeys(morpheus.SortKey.keepExistingSortKeys(sortKeys,project.getRowSortKeys()),!0):project.setColumnSortKeys(morpheus.SortKey.keepExistingSortKeys(sortKeys,project.getColumnSortKeys()),!0)),this.updateDimensionsLabel(),this.updateSelectionLabel(),this.searching=!1},isSelectionOnTop:function(isColumns){return(isColumns?this.columnSearchObject.$matchesToTop:this.rowSearchObject.$matchesToTop).hasClass("btn-primary")},setSelectionOnTop:function(options){if(options.updateButtonStatus){var $btn=options.isColumns?this.columnSearchObject.$matchesToTop:this.rowSearchObject.$matchesToTop;options.isOnTop?$btn.addClass("btn-primary"):$btn.removeClass("btn-primary")}var project=this.heatMap.getProject(),sortKeys=options.isColumns?project.getColumnSortKeys():project.getRowSortKeys();if(sortKeys=sortKeys.filter(function(key){return!(key instanceof morpheus.MatchesOnTopSortKey&&"matches on top"===key.name)}),options.isOnTop){var key=new morpheus.MatchesOnTopSortKey(project,options.isColumns?this.columnSearchResultModelIndices:this.rowSearchResultModelIndices,"matches on top");sortKeys.splice(0,0,key),options.isColumns?this.heatMap.scrollLeft(0):this.heatMap.scrollTop(0)}this.searching=!0,options.isColumns?project.setColumnSortKeys(sortKeys,!0):project.setRowSortKeys(sortKeys,!0),this._updateSearchIndices(options.isColumns),this.searching=!1}},morpheus.HeatMapToolBar.COLUMN_SEARCH_FIELD="column",morpheus.HeatMapToolBar.ROW_SEARCH_FIELD="row",morpheus.HeatMapToolBar.COLUMN_DENDROGRAM_SEARCH_FIELD="column_dendrogram",morpheus.HeatMapToolBar.ROW_DENDROGRAM_SEARCH_FIELD="row_dendrogram",morpheus.HeatMapTooltipProvider=function(heatMap,rowIndex,columnIndex,options,separator,quick,tipText){var dataset=heatMap.project.getSortedFilteredDataset();if(quick||options.value&&_.each(options.value,function(pair){if(tipText.length>0&&tipText.push(separator),tipText.push(pair.name),tipText.push(": <b>"),_.isArray(pair.value))for(var i=0;i<pair.value.length;i++)i>0&&tipText.push(", "),tipText.push(pair.value[i]);else tipText.push(pair.value);tipText.push("</b>")}),-1!==rowIndex&&-1!==columnIndex){for(var tooltipSeriesIndices=options.tooltipSeriesIndices?options.tooltipSeriesIndices:morpheus.Util.sequ32(dataset.getSeriesCount()),i=0,nseries=tooltipSeriesIndices.length;i<nseries;i++)morpheus.HeatMapTooltipProvider._matrixValueToString(heatMap,dataset,rowIndex,columnIndex,tooltipSeriesIndices[i],tipText,separator,options.showSeriesNameInTooltip||i>0),heatMap.options.symmetric&&dataset.getValue(rowIndex,columnIndex,tooltipSeriesIndices[i])!==dataset.getValue(columnIndex,rowIndex,tooltipSeriesIndices[i])&&morpheus.HeatMapTooltipProvider._matrixValueToString(heatMap,dataset,columnIndex,rowIndex,tooltipSeriesIndices[i],tipText,separator,!1);if(quick){var quickRowTracks=heatMap.rowTracks.filter(function(t){return t.settings.inlineTooltip});morpheus.HeatMapTooltipProvider._tracksToString(quickRowTracks,dataset.getRowMetadata(),rowIndex,tipText,separator),morpheus.HeatMapTooltipProvider._tracksToString(heatMap.columnTracks.filter(function(t){return t.settings.inlineTooltip}),dataset.getColumnMetadata(),columnIndex,tipText,separator)}}else quick&&(-1!==rowIndex&&morpheus.HeatMapTooltipProvider._tracksToString(heatMap.rowTracks.filter(function(t){return t.settings.inlineTooltip&&options.name!==t.getName()}),dataset.getRowMetadata(),rowIndex,tipText,separator),-1!==columnIndex&&morpheus.HeatMapTooltipProvider._tracksToString(heatMap.columnTracks.filter(function(t){return t.settings.inlineTooltip&&options.name!==t.getName()}),dataset.getColumnMetadata(),columnIndex,tipText,separator));if(quick){if(null!=options.name){var metadata=-1!==rowIndex?dataset.getRowMetadata():dataset.getColumnMetadata(),vector=metadata.getByName(options.name),track=heatMap.getTrack(options.name,-1!==columnIndex),colorByName=null!=track?track.settings.colorByField:null,additionalVector=null!=colorByName?metadata.getByName(colorByName):null;morpheus.HeatMapTooltipProvider.vectorToString(vector,-1!==rowIndex?rowIndex:columnIndex,tipText,separator,additionalVector)}}else-1!==rowIndex&&morpheus.HeatMapTooltipProvider._metadataToString(options,heatMap.rowTracks,dataset.getRowMetadata(),rowIndex,tipText,separator),-1!==columnIndex&&morpheus.HeatMapTooltipProvider._metadataToString(options,heatMap.columnTracks,dataset.getColumnMetadata(),columnIndex,tipText,separator);var rowNodes=[],columnNodes=[],selectedRowNodes=[],selectedColumnNodes=[];if(options.rowNodes&&(rowNodes=options.rowNodes),options.columnNodes&&(columnNodes=options.columnNodes),!quick){if(heatMap.rowDendrogram&&(selectedRowNodes=_.values(heatMap.rowDendrogram.selectedRootNodeIdToNode)),heatMap.columnDendrogram&&(selectedColumnNodes=_.values(heatMap.columnDendrogram.selectedRootNodeIdToNode)),selectedRowNodes.length>0&&rowNodes.length>0){var nodeIds={};_.each(selectedRowNodes,function(n){nodeIds[n.id]=!0}),rowNodes=_.filter(rowNodes,function(n){return void 0===nodeIds[n.id]})}if(selectedColumnNodes.length>0&&columnNodes.length>0){nodeIds={};_.each(selectedColumnNodes,function(n){nodeIds[n.id]=!0}),columnNodes=_.filter(columnNodes,function(n){return void 0===nodeIds[n.id]})}}morpheus.HeatMapTooltipProvider._nodesToString(tipText,rowNodes,null,separator),morpheus.HeatMapTooltipProvider._nodesToString(tipText,columnNodes,null,separator),quick||(selectedRowNodes.length>0&&morpheus.HeatMapTooltipProvider._nodesToString(tipText,selectedRowNodes,heatMap.rowDendrogram._selectedNodeColor,separator),selectedColumnNodes.length>0&&morpheus.HeatMapTooltipProvider._nodesToString(tipText,selectedColumnNodes,heatMap.columnDendrogram._selectedNodeColor,separator))},morpheus.HeatMapTooltipProvider._matrixValueToString=function(heatMap,dataset,rowIndex,columnIndex,seriesIndex,tipText,separator,showSeriesNameInTooltip){var val=dataset.getValue(rowIndex,columnIndex,seriesIndex);if(null!=val){var nf=heatMap.getHeatMapElementComponent().getDrawValuesFormat();if(val.toObject||!_.isNumber(val)){var obj=val.toObject?val.toObject():val;if(morpheus.Util.isArray(obj)){var v=morpheus.Util.toString(obj);tipText.length>0&&tipText.push(separator),showSeriesNameInTooltip&&(tipText.push(dataset.getName(seriesIndex)),tipText.push(": ")),tipText.push("<b>"),tipText.push(v),tipText.push("</b>")}else{var keys=_.keys(obj);if(0===keys.length){v=morpheus.Util.toString(obj);tipText.length>0&&tipText.push(separator),showSeriesNameInTooltip&&(tipText.push(dataset.getName(seriesIndex)),tipText.push(": ")),tipText.push("<b>"),tipText.push(v),tipText.push("</b>")}else{for(var i=0,nkeys=keys.length;i<nkeys;i++){var key=keys[i];if("__v"!==key){var objVal=obj[key];v=morpheus.Util.isArray(objVal)?morpheus.Util.arrayToString(objVal,", "):morpheus.Util.toString(objVal),tipText.length>0&&tipText.push(separator),tipText.push(key),tipText.push(": <b>"),tipText.push(v),tipText.push("</b>")}}_.isNumber(val)&&(tipText.push(separator),tipText.push("Value: <b>"),tipText.push(nf(val)),tipText.push("</b>"))}}}else tipText.length>0&&tipText.push(separator),showSeriesNameInTooltip&&(tipText.push(dataset.getName(seriesIndex)),tipText.push(": ")),tipText.push("<b>"),tipText.push(nf(val)),tipText.push("</b>")}},morpheus.HeatMapTooltipProvider.vectorToString=function(vector,index,tipText,separator,additionalVector){var arrayValueToString=function(arrayFieldName,arrayVal){if(null!=arrayVal)if(null!=arrayFieldName&&(tipText.length>0&&tipText.push(separator),tipText.push(arrayFieldName)),arrayVal.toObject){tipText.push(" ");var obj=arrayVal.toObject(),keys=_.keys(obj);_.each(keys,function(key){var subVal=obj[key];null!=subVal&&""!=subVal&&(tipText.length>0&&tipText.push(separator),tipText.push(key),tipText.push(": <b>"),tipText.push(morpheus.Util.toString(subVal)),tipText.push("</b>"))})}else tipText.push(": <b>"),tipText.push(morpheus.Util.toString(arrayVal)),tipText.push("</b>")};if(null!=vector){var primaryVal=vector.getValue(index);if(null!=primaryVal&&""!=primaryVal){var primaryFields=vector.getProperties().get(morpheus.VectorKeys.FIELDS);if(null!=primaryFields){var visibleFieldIndices=vector.getProperties().get(morpheus.VectorKeys.VISIBLE_FIELDS);void 0===visibleFieldIndices&&(visibleFieldIndices=morpheus.Util.seq(primaryFields.length));var additionalFieldNames=null!=additionalVector?additionalVector.getProperties().get(morpheus.VectorKeys.FIELDS):null,additionalVal=null!=additionalFieldNames?additionalVector.getValue(index):null;tipText.length>0&&tipText.push(separator),tipText.push(vector.getName());for(var j=0;j<visibleFieldIndices.length;j++)arrayValueToString(primaryFields[visibleFieldIndices[j]],primaryVal[visibleFieldIndices[j]]);if(null!=additionalVal){tipText.length>0&&tipText.push(separator),tipText.push(additionalVector.getName());for(j=0;j<visibleFieldIndices.length;j++)arrayValueToString(additionalFieldNames[visibleFieldIndices[j]],additionalVal[visibleFieldIndices[j]])}}else if(primaryVal.summary){tipText.length>0&&tipText.push(separator),tipText.push(vector.getName()),tipText.push(": ");for(var obj=primaryVal.summary,keys=_.keys(obj),i=0,nkeys=keys.length;i<nkeys;i++){var key=keys[i];if("__v"!==key){var v,objVal=obj[key];v=morpheus.Util.isArray(objVal)?morpheus.Util.arrayToString(objVal,", "):morpheus.Util.toString(objVal),tipText.length>0&&tipText.push(separator),tipText.push(key),tipText.push(": <b>"),tipText.push(v),tipText.push("</b>")}}}else tipText.length>0&&tipText.push(separator),tipText.push(vector.getName()),tipText.push(": <b>"),tipText.push(morpheus.Util.toString(primaryVal)),tipText.push("</b>")}}},morpheus.HeatMapTooltipProvider._tracksToString=function(tracks,metadata,index,tipText,separator){for(var i=0;i<tracks.length;i++)morpheus.HeatMapTooltipProvider.vectorToString(metadata.getByName(tracks[i].name),index,tipText,separator)},morpheus.HeatMapTooltipProvider._metadataToString=function(options,tracks,metadata,index,tipText,separator){for(var filtered=[],i=0,ntracks=tracks.length;i<ntracks;i++){var track=tracks[i];track.isVisible()&&track.isShowTooltip()&&(tracks[i].name===options.name?filtered.splice(0,0,track):filtered.push(track))}morpheus.HeatMapTooltipProvider._tracksToString(filtered,metadata,index,tipText,separator)},morpheus.HeatMapTooltipProvider._nodesToString=function(tipText,nodes,color,separator){var renderField=function(name,value){if(null!=value){if(tipText.length>0&&tipText.push(separator),color&&tipText.push('<span style="color:'+color+'">'),tipText.push(name),tipText.push(": <b>"),_.isArray(value))for(var i=0;i<value.length;i++)i>0&&tipText.push(", "),tipText.push(morpheus.Util.toString(value[i]));else tipText.push(morpheus.Util.toString(value));tipText.push("</b>"),color&&tipText.push("</span>")}};_.each(nodes,function(node){if(node.info)for(var name in node.info){var value=node.info[name];renderField(name,value)}renderField("height",node.height),renderField("depth",node.depth);var nLeafNodes=1+Math.abs(node.maxIndex-node.minIndex);nLeafNodes>0&&renderField("# of leaf nodes",nLeafNodes)})},morpheus.HeatMapTrackColorLegend=function(tracks,colorModel){morpheus.AbstractCanvas.call(this,!1),this.tracks=tracks,this.colorModel=colorModel,this.canvas.style.position=""},morpheus.HeatMapTrackColorLegend.prototype={getPreferredSize:function(){var tracks=this.tracks,colorModel=this.colorModel,xpix=0,ypix=0,maxYPix=0,context=this.canvas.getContext("2d");context.font="12px "+morpheus.CanvasUtil.getFontFamily(context);for(var i=0;i<tracks.length;i++){ypix=0;var maxWidth=0,vector=tracks[i].getVector(tracks[i].settings.colorByField);if(vector.getProperties().get(morpheus.VectorKeys.DISCRETE))colorModel.getDiscreteColorScheme(vector).forEach(function(color,key){var width=context.measureText(key).width;isNaN(width)||(maxWidth=Math.max(maxWidth,width)),ypix+=14});else maxWidth=220,ypix+=40;xpix+=(maxWidth=Math.max(maxWidth,context.measureText(vector.getName()).width))+10+14,maxYPix=Math.max(maxYPix,ypix)}return{width:xpix,height:maxYPix>0?maxYPix+12:0}},draw:function(clip,context){for(var tracks=this.tracks,colorModel=this.colorModel,xpix=0,i=0;i<tracks.length;i++){var ypix=0,vector=tracks[i].getVector(tracks[i].settings.colorByField);context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,context.font="12px "+morpheus.CanvasUtil.getFontFamily(context),context.textAlign="left",context.textBaseline="top",context.fillText(vector.getName(),xpix,ypix),context.strokeStyle="LightGrey";var maxWidth=0,textWidth=context.measureText(vector.getName()).width;if(isNaN(textWidth)||(maxWidth=Math.max(0,textWidth)),ypix+=14,vector.getProperties().get(morpheus.VectorKeys.DISCRETE)){var toStringFunction=morpheus.VectorTrack.vectorToString(vector);colorModel.getDiscreteColorScheme(vector).keys().sort(morpheus.SortKey.ASCENDING_COMPARATOR).forEach(function(key){if(null!=key){key=toStringFunction(key);var color=colorModel.getMappedValue(vector,key),textWidth=context.measureText(key).width;isNaN(textWidth)||(maxWidth=Math.max(maxWidth,textWidth)),context.fillStyle=color;var xoffset=0;tracks[i].isRenderAs(morpheus.VectorTrack.RENDER.COLOR)&&(context.fillRect(xpix,ypix,12,12),context.strokeRect(xpix,ypix,12,12),context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,xoffset=16),context.fillText(key,xpix+xoffset,ypix),ypix+=14}})}else{var scheme=colorModel.getContinuousColorScheme(vector);context.save(),context.translate(xpix,ypix),morpheus.HeatMapColorSchemeLegend.drawColorScheme(context,scheme,200),context.restore(),maxWidth=Math.max(maxWidth,220),ypix+=40}xpix+=maxWidth+10+14}}},morpheus.Util.extend(morpheus.HeatMapTrackColorLegend,morpheus.AbstractCanvas),morpheus.HeatMapTrackFontLegend=function(tracks,model){morpheus.AbstractCanvas.call(this,!1),this.tracks=tracks,this.model=model,this.canvas.style.position=""},morpheus.HeatMapTrackFontLegend.prototype={getPreferredSize:function(){var tracks=this.tracks,model=this.model,context=this.canvas.getContext("2d");context.font="900 12px "+morpheus.CanvasUtil.getFontFamily(context);for(var xpix=0,ypix=0,maxYPix=0,i=0;i<tracks.length;i++){ypix=0;var maxWidth=0,vector=tracks[i].getVector(tracks[i].settings.fontField);model.getMap(vector.getName()).forEach(function(font,key){if(null!=font&&"400"!=font.weight){var width=context.measureText(key).width;isNaN(width)||(maxWidth=Math.max(maxWidth,width)),ypix+=14}}),xpix+=maxWidth+6,maxYPix=Math.max(maxYPix,ypix)}return{width:xpix,height:maxYPix>0?maxYPix+30:0}},draw:function(clip,context){var tracks=this.tracks,model=this.model,xpix=0,ypix=0;context.textAlign="left",context.textBaseline="top",context.font="12px "+morpheus.CanvasUtil.getFontFamily(context),context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,context.strokeStyle="black";for(var font=context.font,i=0;i<tracks.length;i++){ypix=0;var maxWidth=0,textVector=tracks[i].getVector(),fontVector=tracks[i].getVector(tracks[i].settings.fontField);context.font=font,context.fillText(textVector.getName(),xpix,ypix),maxWidth=Math.max(maxWidth,context.measureText(textVector.getName()).width),ypix+=14,model.getMap(fontVector.getName()).keys().sort(morpheus.SortKey.ASCENDING_COMPARATOR).forEach(function(key){var mappedFont=model.getMappedValue(fontVector,key);if(null!=mappedFont&&"400"!=mappedFont.weight){context.font=mappedFont.weight+" "+font;var width=context.measureText(key).width;isNaN(width)||(maxWidth=Math.max(maxWidth,width)),context.fillText(key,xpix,ypix),ypix+=14}}),xpix+=maxWidth+6}}},morpheus.Util.extend(morpheus.HeatMapTrackFontLegend,morpheus.AbstractCanvas),morpheus.HeatMapTrackShapeLegend=function(tracks,shapeModel){morpheus.AbstractCanvas.call(this,!1),this.tracks=tracks,this.shapeModel=shapeModel,this.canvas.style.position=""},morpheus.HeatMapTrackShapeLegend.prototype={getPreferredSize:function(){for(var tracks=this.tracks,shapeModel=this.shapeModel,context=this.canvas.getContext("2d"),xpix=0,ypix=0,maxYPix=0,i=0;i<tracks.length;i++){ypix=0;var maxWidth=0,vector=tracks[i].getVector();shapeModel.getMap(vector.getName()).forEach(function(color,key){var width=context.measureText(key).width;isNaN(width)||(maxWidth=Math.max(maxWidth,width)),ypix+=14}),xpix+=maxWidth+24,maxYPix=Math.max(maxYPix,ypix)}return{width:xpix,height:maxYPix>0?maxYPix+30:0}},draw:function(clip,context){var tracks=this.tracks,shapeModel=this.shapeModel,xpix=0,ypix=0;context.textAlign="left",context.textBaseline="top",context.font="12px "+morpheus.CanvasUtil.getFontFamily(context),context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,context.strokeStyle="black";for(var i=0;i<tracks.length;i++){ypix=0;var maxWidth=0,vector=tracks[i].getVector();context.fillText(vector.getName(),xpix,ypix),maxWidth=Math.max(maxWidth,context.measureText(vector.getName()).width),ypix+=14,shapeModel.getMap(vector.getName()).keys().sort(morpheus.SortKey.ASCENDING_COMPARATOR).forEach(function(key){var shape=shapeModel.getMappedValue(vector,key),width=context.measureText(key).width;isNaN(width)||(maxWidth=Math.max(maxWidth,width)),morpheus.CanvasUtil.drawShape(context,shape,xpix+8,ypix+6,6),context.fillText(key,xpix+16,ypix),ypix+=14}),xpix+=maxWidth+24}}},morpheus.Util.extend(morpheus.HeatMapTrackShapeLegend,morpheus.AbstractCanvas),morpheus.HeatMap=function(options){morpheus.Util.loadTrackingCode();for(var resolveFunction,_this=this,dontExtend=["parent","columnDendrogram","rowDendrogram"],cache=[],i=0;i<dontExtend.length;i++){var field=dontExtend[i];cache[i]=options[field],options[field]=null}options=$.extend(!0,{},{el:null,dataset:void 0,rowAnnotations:void 0,columnAnnotations:void 0,columnGroupBy:void 0,rowGroupBy:void 0,colorScheme:void 0,rowSortBy:void 0,columnSortBy:void 0,rowDendrogram:void 0,columnDendrogram:void 0,columnDendrogramField:null,rowDendrogramField:null,rows:[],columns:[],tools:void 0,rowFilter:void 0,columnFilter:void 0,autohideTabBar:!1,closeable:!0,rename:!0,rowSize:14,columnSize:14,rowGapSize:10,columnGapSize:10,drawGrid:!0,gridColor:"#808080",showRowNumber:!1,gridThickness:.1,rowDendrogramLineWidth:.7,columnDendrogramLineWidth:.7,height:"window",width:void 0,focus:!0,tooltipMode:0,inheritFromParent:!0,inheritFromParentOptions:{transpose:!1},tooltip:void 0,structureUrlProvider:void 0,promises:void 0,renderReady:void 0,datasetReady:void 0,tabOpened:void 0,loadedCallback:void 0,name:void 0,rowsSortable:!0,columnsSortable:!0,popupEnabled:!0,symmetric:!1,keyboard:!0,inlineTooltip:!0,standalone:!1,$loadingImage:morpheus.Util.createLoadingEl()},options),this.promise=new Promise(function(resolve,reject){resolveFunction=resolve});for(i=0;i<dontExtend.length;i++){options[field=dontExtend[i]]=cache[i]}if(null==options.menu&&(options.menu={File:["Open",null,"Save Image","Save Dataset","Save Session",null,"Close Tab",null,"Rename Tab"],Tools:["New Heat Map",null,"Hierarchical Clustering","KMeans Clustering",null,"Marker Selection","Nearest Neighbors","Create Calculated Annotation",null,"Adjust","Collapse","Similarity Matrix","Transpose",null,"Chart",null,"t-SNE",null,"Sort/Group","Filter",null,"API"],View:["Zoom In","Zoom Out",null,"Fit To Window","Fit Rows To Window","Fit Columns To Window",null,"100%",null,"Options"],Edit:["Copy Image","Copy Selected Dataset",null,"Move Selected Rows To Top","Annotate Selected Rows","Copy Selected Rows","Invert Selected Rows","Select All Rows","Clear Selected Rows",null,"Move Selected Columns To Top","Annotate Selected Columns","Copy Selected Columns","Invert Selected Columns","Select All Columns","Clear Selected Columns"],Help:["Find Action",null,"Contact","Configuration","Tutorial","Source Code",null,"Keyboard Shortcuts"]}),null==options.toolbar&&(options.toolbar=["Search Rows","Search Columns","Dimensions","Zoom","Options","Save Image","Filter","Sort/Group","Color Key"]),this.options=options,this.tooltipProvider=morpheus.HeatMapTooltipProvider,options.el?this.$el=$(options.el):this.$el=$("<div></div>"),this.rowGapSize=options.rowGapSize,this.columnGapSize=options.columnGapSize,this.actionManager=new morpheus.ActionManager,this.actionManager.heatMap=this,this.$el.addClass("morpheus"),null==this.options.dataset){var datasetFormBuilder=new morpheus.FormBuilder;datasetFormBuilder.append({name:"file",type:"file"}),this.options.dataset=new Promise(function(resolve,reject){morpheus.FormBuilder.showOkCancel({title:"Dataset",appendTo:_this.getContentEl(),focus:_this.getFocusEl(),content:datasetFormBuilder.$form,okCallback:function(){var file=datasetFormBuilder.getValue("file");morpheus.DatasetUtil.read(file).then(function(dataset){resolve(dataset)}).catch(function(err){reject(err)})},cancelCallback:function(){reject("Session cancelled.")}})})}null==this.options.name&&(this.options.name=morpheus.Util.getBaseFileName(morpheus.Util.getFileName(this.options.dataset.file?this.options.dataset.file:this.options.dataset)));this.options.parent;if(null==this.options.parent?morpheus.Util.isHeadless()||(null==this.options.tabManager?this.tabManager=new morpheus.TabManager({landingPage:function(){return null==_this.options.landingPage&&(_this.options.landingPage=new morpheus.LandingPage({tabManager:_this.tabManager}),_this.options.landingPage.$el.prependTo(_this.$el)),_this.options.landingPage},autohideTabBar:this.options.autohideTabBar}):this.tabManager=this.options.tabManager,null==this.options.tabManager&&this.tabManager.appendTo(this.$el)):(this.options.inheritFromParent&&(this.popupItems=this.options.parent.popupItems,this.options.tabOpened||(this.options.tabOpened=this.options.parent.options.tabOpened),this.options.drawCallback=this.options.parent.options.drawCallback),this.tabManager=this.options.parent.tabManager),this.$content=$("<div></div>"),this.$content.css({width:"100%","user-select":"none","-webkit-user-select":"none","-webkit-user-drag":"none","-webkit-tap-highlight-color":"rgba(0, 0, 0, 0)","-moz-user-select":"none","-moz-user-drag":"none","-moz-tap-highlight-color":"rgba(0, 0, 0, 0)","-ms-user-select":"none","-ms-user-drag":"none","-ms-tap-highlight-color":"rgba(0, 0, 0, 0)","-o-user-select":"none","-o-user-drag":"none","-o-tap-highlight-color":"rgba(0, 0, 0, 0)","overflow-x":"visible","overflow-y":"visible"}),this.$content.on("remove.morpheus",function(){_this.$content.off("remove.morpheus"),_this.dispose()}),!morpheus.Util.isHeadless()){this.menu=new morpheus.HeatMapMenu(this);var tab=this.tabManager.add({$el:this.$content,closeable:this.options.closeable,rename:this.options.rename,title:this.options.name,object:this,focus:this.options.focus});this.tabId=tab.id,this.$tabPanel=tab.$panel}options.$loadingImage&&options.$loadingImage.appendTo(this.$content),this.options.dataSource=options.dataset?options.dataset.file?options.dataset.file:options.dataset:"",this._togglingInfoWindow=!1;var promises=[];if(options.promises)for(i=0;i<options.promises.length;i++)promises.push(options.promises[i]);if(this.whenLoaded=[],options.rowAnnotations){var rowDef=morpheus.DatasetUtil.annotate({annotations:options.rowAnnotations,isColumns:!1});rowDef.then(function(callbacks){_this.whenLoaded=_this.whenLoaded.concat(callbacks)}),promises.push(rowDef)}if(options.columnAnnotations){var columnDef=morpheus.DatasetUtil.annotate({annotations:options.columnAnnotations,isColumns:!0});columnDef.then(function(callbacks){_this.whenLoaded=_this.whenLoaded.concat(callbacks)}),promises.push(columnDef)}if(null!=options.rowDendrogram&&_.isString(options.rowDendrogram))if("("===options.rowDendrogram[0])_this.options.rowDendrogram=morpheus.DendrogramUtil.parseNewick(options.rowDendrogram);else{var rowDendrogramDeferred=morpheus.Util.getText(options.rowDendrogram);rowDendrogramDeferred.then(function(text){_this.options.rowDendrogram=morpheus.DendrogramUtil.parseNewick(text)}),promises.push(rowDendrogramDeferred)}if(null!=options.columnDendrogram&&_.isString(options.columnDendrogram))if("("===options.columnDendrogram[0])_this.options.columnDendrogram=morpheus.DendrogramUtil.parseNewick(options.columnDendrogram);else{var columnDendrogramDeferred=morpheus.Util.getText(options.columnDendrogram);columnDendrogramDeferred.then(function(text){_this.options.columnDendrogram=morpheus.DendrogramUtil.parseNewick(text)}),promises.push(columnDendrogramDeferred)}var heatMapLoaded=function(){"undefined"!=typeof window&&$(window).on("orientationchange.morpheus resize.morpheus",_this.resizeListener=function(){_this.revalidate()}),_this.revalidate(),options.loadedCallback&&options.loadedCallback(_this),resolveFunction(),_this.tabManager&&(_this.options.focus?(_this.tabManager.setActiveTab(tab.id),_this.focus()):1===_this.tabManager.getTabCount()&&_this.tabManager.setActiveTab(tab.id)),_this.$el.trigger("heatMapLoaded",_this)};if(morpheus.Util.isArray(options.dataset)){(d=morpheus.DatasetUtil.readDatasetArray(options.dataset)).catch(function(message){_this.options.$loadingImage&&_this.options.$loadingImage.remove(),_this.options.error&&_this.options.error(message),morpheus.FormBuilder.showInModal({title:"Error",html:message,appendTo:_this.getContentEl(),focus:_this.getFocusEl()})}).then(function(joined){_this.options.$loadingImage&&_this.options.$loadingImage.remove(),_this.options.dataset=joined,_this._init(),null==joined.getRowMetadata().getByName("Source")||_this.options.colorScheme||_this.heatmap.getColorScheme().setSeparateColorSchemeForRowMetadataField("Source"),_.each(options.dataset,function(option){if(option.colorScheme)_this.heatmap.getColorScheme().setCurrentValue(morpheus.Util.getBaseFileName(morpheus.Util.getFileName(option.dataset))),_this.heatmap.getColorScheme().setColorSupplierForCurrentValue(morpheus.AbstractColorSupplier.fromJSON(option.colorScheme));else try{_this.autoDisplay({extension:morpheus.Util.getExtension(morpheus.Util.getFileName(option.dataset)),filename:morpheus.Util.getBaseFileName(morpheus.Util.getFileName(option.dataset))})}catch(x){console.log("Autodisplay errror")}}),console.log("1"),heatMapLoaded()})}else{var dsPromise=options.dataset.file?morpheus.DatasetUtil.read(options.dataset.file,options.dataset.options):morpheus.DatasetUtil.read(options.dataset);dsPromise.then(function(dataset){_this.options.dataset=dataset}).catch(function(err){_this.options.$loadingImage.remove();var message=["Error opening "+(options.dataset.file?morpheus.Util.getFileName(options.dataset.file):morpheus.Util.getFileName(options.dataset))+"."];err.message&&(message.push("<br />Cause: "),message.push(err.message)),_this.options.error&&_this.options.error(message),morpheus.FormBuilder.showInModal({title:"Error",html:message.join(""),appendTo:_this.getContentEl(),focus:_this.getFocusEl()})}),promises.push(dsPromise);var d,datasetOverlay=null;if(options.datasetOverlay)(d=options.datasetOverlay.file?morpheus.DatasetUtil.read(options.datasetOverlay.file,options.datasetOverlay.options):morpheus.DatasetUtil.read(options.datasetOverlay)).then(function(dataset){datasetOverlay=dataset}),promises.push(d);Promise.all(promises).then(function(){_this.options.$loadingImage&&_this.options.$loadingImage.remove(),null!=_this.options.dataset?(_this._init(),datasetOverlay&&morpheus.DatasetUtil.overlay({dataset:_this.options.dataset,newDataset:datasetOverlay,rowAnnotationName:"id",newRowAnnotationName:"id",columnAnnotationName:"id",newColumnAnnotationName:"id"}),heatMapLoaded()):_this.tabManager.remove(_this.tabId)})}},morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS=6,morpheus.HeatMap.showTool=function(tool,heatMap,callback){if(tool.gui){var gui=tool.gui(heatMap.getProject()),formBuilder=new morpheus.FormBuilder;_.each(gui,function(item){formBuilder.append(item)});heatMap.getTabManager().getActiveTabId();tool.init&&tool.init(heatMap.getProject(),formBuilder,{heatMap:heatMap}),heatMap.trigger("beforeToolShown",{tool:tool,formBuilder:formBuilder});var $formDiv,okCallback=function(){var $dialogContent=$("<div><span>"+tool.toString()+'...</span><div><progress></progress></div><button class="btn btn-xs btn-default" style="margin-left:6px;display: none;">Cancel</button></div>'),value=null,$dialog=morpheus.FormBuilder.showInDraggableDiv({$content:$dialogContent,appendTo:heatMap.getContentEl(),width:"auto"});morpheus.DialogUtil.add($dialog);var input={};_.each(gui,function(item){input[item.name]=formBuilder.getValue(item.name)}),setTimeout(function(){if((value=tool.execute({heatMap:heatMap,project:heatMap.getProject(),input:input}))instanceof Worker){morpheus.DialogUtil.remove($dialog),$dialogContent.find("button").css("display","").on("click",function(){value.terminate()}),value.onerror=function(e){value.terminate(),morpheus.FormBuilder.showInModal({title:"Error",html:e,close:"Close",focus:heatMap.getFocusEl(),appendTo:heatMap.getContentEl()}),e.stack&&console.log(e.stack)};var terminate=_.bind(value.terminate,value);value.terminate=function(){terminate(),$dialog.remove(),callback&&callback(input)}}else null!=value&&"function"==typeof value.then?value.finally(function(){callback&&callback(input),$dialog.remove(),morpheus.DialogUtil.remove($dialog)}):(callback&&callback(input),$dialog.remove(),morpheus.DialogUtil.remove($dialog))},20)};tool.ok=function(){$formDiv.modal("hide"),okCallback()};var guiOptions=$.extend({},{ok:!0},gui.options);$formDiv=morpheus.FormBuilder.showOkCancel({title:tool.toString(),apply:tool.apply,ok:guiOptions.ok,cancel:guiOptions.cancel,size:guiOptions.size,draggable:!0,content:formBuilder.$form,appendTo:heatMap.getContentEl(),align:"right",okCallback:okCallback,focus:heatMap.getFocusEl()})}else tool.execute({heatMap:heatMap,project:heatMap.getProject(),input:{}}),callback&&callback({})},morpheus.HeatMap.getSpaces=function(groupByKeys,length,gapSize){for(var previousArray=[],nkeys=groupByKeys.length,keyIndex=0;keyIndex<nkeys;keyIndex++){var key=groupByKeys[keyIndex];previousArray.push(key.getValue(0))}var spaces=[],sum=0;spaces.push(sum);for(var i=1;i<length;i++){var isEqual=!0;for(keyIndex=0;keyIndex<nkeys;keyIndex++){if(0!==(key=groupByKeys[keyIndex]).getComparator()(key.getValue(i),previousArray[keyIndex])){isEqual=!1;for(var keyIndex2=0;keyIndex2<nkeys;keyIndex2++)previousArray[keyIndex2]=groupByKeys[keyIndex2].getValue(i);break}}isEqual||(sum+=gapSize),spaces.push(sum)}return spaces},morpheus.HeatMap.createGroupBySpaces=function(dataset,groupByKeys,gapSize,isColumns){if(groupByKeys.length>0){for(var nkeys=groupByKeys.length,keyIndex=0;keyIndex<nkeys;keyIndex++)groupByKeys[keyIndex].init(groupByKeys[keyIndex].isColumns()?new morpheus.TransposedDatasetView(dataset):dataset);return morpheus.HeatMap.getSpaces(groupByKeys,isColumns?dataset.getColumnCount():dataset.getRowCount(),gapSize)}},morpheus.HeatMap.isDendrogramVisible=function(project,isColumns){var sortKeys=isColumns?project.getColumnSortKeys():project.getRowSortKeys();if(0===sortKeys.length)return!0;for(var size=isColumns?project.getSortedFilteredDataset().getColumnCount():project.getSortedFilteredDataset().getRowCount(),i=0;i<sortKeys.length;i++)if(!sortKeys[i].isPreservesDendrogram()||sortKeys[i].nvisible!==size)return!1;return!0},morpheus.HeatMap.prototype={updatingScroll:!1,getWhitespaceEl:function(){return this.$whitespace},getActionManager:function(){return this.actionManager},autoDisplay:function(options){var colorScheme;if(null==options.filename&&(options.filename=""),"segtab"===options.extension||"seg"===options.extension)colorScheme={scalingMode:"fixed",values:morpheus.HeatMapColorScheme.Predefined.CN().values.map(function(value){return Math.pow(2,1+value)}),colors:morpheus.HeatMapColorScheme.Predefined.CN().colors};else if("maf"===options.extension){colorScheme=morpheus.HeatMapColorScheme.Predefined.MAF();var rowMutProfile=this.project.getFullDataset().getRowMetadata().getByName("mutation_summary"),fieldNames=rowMutProfile.getProperties().get(morpheus.VectorKeys.FIELDS);null==fieldNames&&(fieldNames=morpheus.MafFileReader.FIELD_NAMES,rowMutProfile.getProperties().set(morpheus.VectorKeys.FIELDS,fieldNames));var useMafColorMap=!0;if(fieldNames.length!==morpheus.MafFileReader.FIELD_NAMES.length)useMafColorMap=!1;else for(var i=0;i<fieldNames.length;i++)if(fieldNames[i]!==morpheus.MafFileReader.FIELD_NAMES[i]){useMafColorMap=!1;break}if(!useMafColorMap){colorScheme={scalingMode:"fixed",stepped:!0,values:[0],colors:["rgb(255,255,255)"]};for(i=0;i<fieldNames.length;i++)colorScheme.values.push(i+1),colorScheme.colors.push(morpheus.VectorColorModel.TWENTY_COLORS[i%morpheus.VectorColorModel.TWENTY_COLORS.length]),colorScheme.names.push(fieldNames[i])}var columnMutationSummaryVectors=[],columnMutationSummaryNames=["mutation_summary","mutation_summary_selection"];for(i=0;i<columnMutationSummaryNames.length;i++){var name=columnMutationSummaryNames[i];this.project.getFullDataset().getColumnMetadata().getByName(name)&&(columnMutationSummaryVectors.push(this.project.getFullDataset().getColumnMetadata().getByName(name)),(track=this.getTrack(name,!0))&&(track.settingFromConfig("stacked_bar"),"mutation_summary_selection"===name&&(track.settings.autoscaleAlways=!0)))}var track=this.getTrack("mutation_summary",!1);track&&track.settingFromConfig("stacked_bar");for(i=1;i<colorScheme.colors.length;i++){rowMutProfile&&this.getProject().getRowColorModel().setMappedValue(rowMutProfile,i-1,colorScheme.colors[i]);for(var j=0;j<columnMutationSummaryVectors.length;j++)this.getProject().getColumnColorModel().setMappedValue(columnMutationSummaryVectors[j],i-1,colorScheme.colors[i])}}else"gmt"===options.extension?colorScheme=morpheus.HeatMapColorScheme.Predefined.BINARY():"all_lesions.conf_99"===options.filename||"all_data_by_genes.txt"===options.filename||-1!==options.filename.toLowerCase().indexOf("gistic")?colorScheme={scalingMode:"fixed",values:[-.5,0,.5],colors:["blue","white","red"]}:-1!==options.filename.toLowerCase().indexOf("copynumber")||-1!==options.filename.toLowerCase().indexOf("copy number")?colorScheme={scalingMode:"fixed",values:[-1.5,0,1.5],colors:["blue","white","red"]}:-1!==options.filename.toLowerCase().indexOf("achilles")&&(colorScheme={scalingMode:"fixed",values:[-3,-1,1,3],colors:["blue","white","white","red"]});return colorScheme&&options.filename&&this.heatmap.getColorScheme()&&(this.heatmap.getColorScheme().setCurrentValue(options.filename),this.heatmap.getColorScheme().setColorSupplierForCurrentValue(morpheus.AbstractColorSupplier.fromJSON(colorScheme))),colorScheme},sortBasedOnSelection:function(sortOrder,isColumns,append){var project=this.project,modelIndices=(isColumns?project.getColumnSelectionModel():project.getRowSelectionModel()).toModelIndices();if(0!==modelIndices.length){var sortKeys,priorSortKeyIndex=-1;if(null==sortOrder)for(var existingSortKeys=isColumns?project.getRowSortKeys():project.getColumnSortKeys(),i=0,length=existingSortKeys.length;i<length;i++){var key=existingSortKeys[i];if(key instanceof morpheus.SortByValuesKey&&morpheus.Util.arrayEquals(key.modelIndices,modelIndices)){priorSortKeyIndex=i,key.getSortOrder()===morpheus.SortKey.SortOrder.UNSORTED?sortOrder=morpheus.SortKey.SortOrder.DESCENDING:key.getSortOrder()===morpheus.SortKey.SortOrder.DESCENDING?sortOrder=morpheus.SortKey.SortOrder.ASCENDING:key.getSortOrder()===morpheus.SortKey.SortOrder.ASCENDING?sortOrder=morpheus.SortKey.SortOrder.TOP_N:key.getSortOrder()===morpheus.SortKey.SortOrder.TOP_N&&(sortOrder=morpheus.SortKey.SortOrder.UNSORTED);break}}if(null==sortOrder&&(sortOrder=morpheus.SortKey.SortOrder.DESCENDING),append)sortKeys=isColumns?project.getRowSortKeys():project.getColumnSortKeys(),-1!==priorSortKeyIndex?sortOrder===morpheus.SortKey.SortOrder.UNSORTED?sortKeys.splice(priorSortKeyIndex,1):sortKeys[priorSortKeyIndex].setSortOrder(sortOrder):sortOrder!==morpheus.SortKey.SortOrder.UNSORTED&&sortKeys.push(new morpheus.SortByValuesKey(modelIndices,sortOrder,!isColumns)),sortKeys=morpheus.SortKey.keepExistingSortKeys(sortKeys,isColumns?project.getRowSortKeys():project.getColumnSortKeys());else{var newSortKeys=sortOrder===morpheus.SortKey.SortOrder.UNSORTED?[]:[new morpheus.SortByValuesKey(modelIndices,sortOrder,!isColumns)];sortKeys=morpheus.SortKey.keepExistingSortKeys(newSortKeys,isColumns?project.getRowSortKeys():project.getColumnSortKeys())}isColumns?(project.setRowSortKeys(sortKeys,!0),this.scrollTop(0)):(project.setColumnSortKeys(sortKeys,!0),this.scrollLeft(0)),morpheus.Util.trackEvent({eventCategory:"Tool",eventAction:isColumns?"sortRowsBasedOnSelection":"sortColumnsBasedOnSelection"})}},getToolbarElement:function(){return this.toolbar.$el},getToolbar:function(){return this.toolbar},setName:function(name){this.options.name=name},getName:function(){return this.options.name},showOptions:function(){new morpheus.HeatMapOptions(this)},getProject:function(){return this.project},getDendrogram:function(isColumns){return isColumns?this.columnDendrogram:this.rowDendrogram},toJSON:function(options){var _this=this,json={};if(json.colorScheme=this.heatmap.getColorScheme().toJSON(),json.name=this.options.name,json.showRowNumber=this.isShowRowNumber(),json.rowShapeModel=this.getProject().getRowShapeModel().toJSON(this.getVisibleTracks(!1)),json.columnShapeModel=this.getProject().getColumnShapeModel().toJSON(this.getVisibleTracks(!0)),json.rowFontModel=this.getProject().getRowFontModel().toJSON(this.getVisibleTracks(!1)),json.columnFontModel=this.getProject().getColumnFontModel().toJSON(this.getVisibleTracks(!0)),json.rowColorModel=this.getProject().getRowColorModel().toJSON(this.getVisibleTracks(!1)),json.columnColorModel=this.getProject().getColumnColorModel().toJSON(this.getVisibleTracks(!0)),json.rows=this.getVisibleTracks(!1).map(function(track){var size=morpheus.CanvasUtil.getPreferredSize(_this.getTrackHeaderByIndex(_this.getTrackIndex(track.getName(),!1),!1)),obj=track.settings;return obj.field=track.getName(),obj.size={width:size.widthSet?size.width:void 0},obj}),json.columns=this.getVisibleTracks(!0).map(function(track){var size=morpheus.CanvasUtil.getPreferredSize(_this.getTrackHeaderByIndex(_this.getTrackIndex(track.getName(),!0),!0)),obj=track.settings;return obj.field=track.getName(),obj.size={width:size.widthSet?size.width:void 0,height:size.heightSet?size.height:void 0},obj}),json.rowSortBy=morpheus.SortKey.toJSON(this.getProject().getRowSortKeys()),json.columnSortBy=morpheus.SortKey.toJSON(this.getProject().getColumnSortKeys()),json.rowGroupBy=morpheus.SortKey.toJSON(this.getProject().getGroupRows()),json.columnGroupBy=morpheus.SortKey.toJSON(this.getProject().getGroupColumns()),json.rowFilter=morpheus.CombinedFilter.toJSON(this.getProject().getRowFilter()),json.columnFilter=morpheus.CombinedFilter.toJSON(this.getProject().getColumnFilter()),json.symmetric=this.options.symmetric,json.rowSize=this.heatmap.getRowPositions().getSize(),json.columnSize=this.heatmap.getColumnPositions().getSize(),json.rowGapSize=this.heatmap.rowGapSize,json.columnGapSize=this.heatmap.columnGapSize,json.drawGrid=this.heatmap.isDrawGrid(),json.gridColor=this.heatmap.getGridColor(),json.gridThickness=this.heatmap.getGridThickness(),json.drawValues=this.heatmap.isDrawValues(),json.shape=this.heatmap.getShape(),json.rowSelection=this.getProject().getRowSelectionModel().toModelIndices(),json.columnSelection=this.getProject().getColumnSelectionModel().toModelIndices(),json.rowSearchTerm=this.toolbar.getSearchField(morpheus.HeatMapToolBar.ROW_SEARCH_FIELD).val(),json.columnSearchTerm=this.toolbar.getSearchField(morpheus.HeatMapToolBar.COLUMN_SEARCH_FIELD).val(),null!=this.rowDendrogram){var out=[];morpheus.DendrogramUtil.writeNewick(this.rowDendrogram.tree.rootNode,out,function(n){return n.index}),json.rowDendrogram=out.join(""),json.rowDendrogramField=null,json.rowDendrogramLineWidth=this.rowDendrogram.lineWidth}if(null!=this.columnDendrogram){out=[];morpheus.DendrogramUtil.writeNewick(this.columnDendrogram.tree.rootNode,out,function(n){return n.index}),json.columnDendrogram=out.join(""),json.columnDendrogramField=null,json.columnDendrogramLineWidth=this.columnDendrogram.lineWidth}return options.dataset&&(json.dataset=morpheus.Dataset.toJSON(this.getProject().getFullDataset())),json},setDendrogram:function(tree,isColumns,modelOrder){var dendrogram=isColumns?this.columnDendrogram:this.rowDendrogram;if(dendrogram&&(dendrogram.dispose(),dendrogram=null),null!=tree){var sortKey;isColumns?this.project.getFullDataset().getColumnCount():this.project.getFullDataset().getRowCount();if(isColumns)(dendrogram=new morpheus.ColumnDendrogram(this,tree,this.heatmap.getColumnPositions(),this.project)).filter=this.project.getColumnFilter().shallowClone(),this.columnDendrogram=dendrogram,(sortKey=new morpheus.SpecifiedModelSortOrder(modelOrder,modelOrder.length,"dendrogram",!0)).setPreservesDendrogram(!0),sortKey.setLockOrder(2),sortKey.setUnlockable(!1),this.project.setColumnSortKeys([sortKey],!0);else(dendrogram=new morpheus.RowDendrogram(this,tree,this.heatmap.getRowPositions(),this.project)).filter=this.project.getRowFilter().shallowClone(),this.rowDendrogram=dendrogram,(sortKey=new morpheus.SpecifiedModelSortOrder(modelOrder,modelOrder.length,"dendrogram",!1)).setPreservesDendrogram(!0),sortKey.setLockOrder(2),sortKey.setUnlockable(!1),this.project.setRowSortKeys([sortKey],!0);dendrogram.appendTo(this.$parent),dendrogram.$label.appendTo(this.$parent),dendrogram.$squishedLabel.appendTo(this.$parent)}else{for(var sortKeys=isColumns?this.project.getColumnSortKeys():this.project.getRowSortKeys(),i=0;i<sortKeys.length;i++)sortKeys[i].isPreservesDendrogram()&&(sortKeys.splice(i,1),i--);isColumns?(this.heatmap.getColumnPositions().setSquishedIndices(null),delete this.columnDendrogram,this.project.setColumnSortKeys(sortKeys,!0)):(delete this.rowDendrogram,this.project.setRowSortKeys(sortKeys,!0),this.heatmap.getRowPositions().setSquishedIndices(null))}this.trigger("dendrogramChanged",{isColumns:isColumns})},getTabManager:function(){return this.tabManager},getSelectedElementsText:function(){var project=this.project,selectedViewIndices=project.getElementSelectionModel().getViewIndices();if(selectedViewIndices.size()>0){var tipText=[],dataset=project.getSortedFilteredDataset(),rowTracks=this.rowTracks.filter(function(t){return t.settings.inlineTooltip}),columnTracks=this.columnTracks.filter(function(t){return t.settings.inlineTooltip});return selectedViewIndices.forEach(function(id){var rowIndex=id.getArray()[0],columnIndex=id.getArray()[1];tipText.push(morpheus.Util.nf(dataset.getValue(rowIndex,columnIndex))),rowTracks.forEach(function(track){tipText.push("\t"),tipText.push(morpheus.Util.toString(dataset.getRowMetadata().getByName(track.name).getValue(rowIndex)))}),columnTracks.forEach(function(track){tipText.push("\t"),tipText.push(morpheus.Util.toString(dataset.getColumnMetadata().getByName(track.name).getValue(columnIndex)))}),tipText.push("\n")}),tipText.join("")}},_init:function(){var _this=this;morpheus.MetadataUtil.renameFields(this.options.dataset,this.options);var dataset=this.options.dataset,rowDendrogram=this.options.rowDendrogram,columnDendrogram=this.options.columnDendrogram;if(_.each(this.whenLoaded,function(f){f(_this.options.dataset)}),this.options.datasetReady){var updatedDataset=this.options.datasetReady(dataset);updatedDataset&&(dataset=updatedDataset)}this.project=new morpheus.Project(dataset),this.tabManager&&this.tabManager.setTabTitle(this.tabId,this.project.getFullDataset().getRowCount()+" row"+morpheus.Util.s(this.project.getFullDataset().getRowCount())+" x "+this.project.getFullDataset().getColumnCount()+" column"+morpheus.Util.s(this.project.getFullDataset().getColumnCount())),this.options.inheritFromParent&&null!=this.options.parent&&morpheus.HeatMap.copyFromParent(this.project,this.options),this.options.rowFilter&&(morpheus.CombinedFilter.fromJSON(_this.project.getRowFilter(),this.options.rowFilter),_this.project.setRowFilter(_this.project.getRowFilter(),!0)),this.options.columnFilter&&(this.options.columnFilter.filters.forEach(function(filter){filter.isColumns=!0}),morpheus.CombinedFilter.fromJSON(_this.project.getColumnFilter(),this.options.columnFilter),_this.project.setColumnFilter(_this.project.getColumnFilter(),!0)),this.whenLoaded=null,this.$parent=$("<div></div>").css("position","relative"),this.$parent.appendTo(this.$content),morpheus.Util.isHeadless()||(this.toolbar=new morpheus.HeatMapToolBar(this)),this.vscroll=new morpheus.ScrollBar(!0),this.vscroll.appendTo(this.$parent),this.vscroll.on("scroll",function(){_this.updatingScroll||_this.paintAll({paintRows:!0,paintColumns:!1,invalidateRows:!0,invalidateColumns:!1})}),this.beforeColumnTrackDivider=new morpheus.Divider(!1),this.beforeColumnTrackDivider.appendTo(this.$parent);var dragStartHeight=0;this.beforeColumnTrackDivider.on("resizeStart",function(e){dragStartHeight=_this.columnDendrogram.getUnscaledHeight()}).on("resize",function(e){var newHeight=Math.max(8,dragStartHeight+e.delta);_this.columnDendrogram.setPrefHeight(newHeight),_this.revalidate()}).on("resizeEnd",function(){dragStartHeight=0}),this.afterRowDendrogramDivider=new morpheus.Divider(!0),this.afterRowDendrogramDivider.appendTo(this.$parent);var rowDendrogramStartWidth=0;this.afterRowDendrogramDivider.on("resizeStart",function(e){rowDendrogramStartWidth=_this.rowDendrogram.getUnscaledWidth()}).on("resize",function(e){var newWidth=Math.max(8,rowDendrogramStartWidth+e.delta);_this.rowDendrogram.setPrefWidth(newWidth),_this.revalidate()}).on("resizeEnd",function(){rowDendrogramStartWidth=0}),this.afterVerticalScrollBarDivider=new morpheus.Divider(!0),this.afterVerticalScrollBarDivider.appendTo(this.$parent);var resizeStartHeatMapWidth=0;this.afterVerticalScrollBarDivider.on("resizeStart",function(e){resizeStartHeatMapWidth=_this.heatmap.getUnscaledWidth()}).on("resize",function(e){_this.heatmap.prefWidth=resizeStartHeatMapWidth+e.delta,_this.revalidate()}),this.hscroll=new morpheus.ScrollBar(!1),this.hscroll.appendTo(this.$parent),this.hscroll.on("scroll",function(){_this.updatingScroll||_this.paintAll({paintRows:!1,paintColumns:!0,invalidateRows:!1,invalidateColumns:!0})}),this.$whitespace=$('<div style="position: absolute;"></div>'),this.$whitespace.appendTo(this.$parent);var heatmap=new morpheus.HeatMapElementCanvas(this.project);this.options.drawCallback&&heatmap.setDrawCallback(this.options.drawCallback),$(heatmap.canvas).on("contextmenu",function(e){morpheus.Popup.showPopup([{name:"Copy Image",class:"copy"},{name:"Save Image ("+morpheus.Util.COMMAND_KEY+"S)"},{separator:!0},{name:"Show Inline Tooltip",checked:_this.options.inlineTooltip}],{x:e.pageX,y:e.pageY},e.target,function(event,item){if("Show Inline Tooltip"===item)_this.options.inlineTooltip=!_this.options.inlineTooltip;else if(item==="Save Image ("+morpheus.Util.COMMAND_KEY+"S)")_this.getActionManager().execute("Save Image");else if("Copy Selection"===item){var text=_this.getSelectedElementsText();""!==text&&event.clipboardData.setData("text/plain",text)}else"Copy Image"===item?_this.getActionManager().execute("Copy Image",{event:event}):console.log(item+" unknown.")}),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),heatmap.appendTo(this.$parent),this.heatmap=heatmap;var rowDendrogramSortKey=null;if(null!=rowDendrogram)if((tree=rowDendrogram).leafNodes.length!==this.project.getSortedFilteredDataset().getRowCount())console.log("# leaf nodes in row dendrogram "+tree.leafNodes.length+" != "+this.project.getSortedFilteredDataset().getRowCount());else{var rowIndices=null;if(null!=this.options.rowDendrogramField){if(null==(vector=dataset.getRowMetadata().getByName(this.options.rowDendrogramField)))throw console.log(this.options.rowDendrogramField+" not found in "+morpheus.MetadataUtil.getMetadataNames(dataset.getRowMetadata())),new Error(this.options.rowDendrogramField+" not found");rowIndices=[];for(var map=new morpheus.Map,re=/[,:]/g,isString="string"===morpheus.VectorUtil.getDataType(vector),j=0,size=vector.size();j<size;j++){var key=vector.getValue(j);isString&&(key=key.replace(re,"")),map.set(key,j)}for(var i=0,length=tree.leafNodes.length;i<length;i++){if(void 0===(index=map.get(tree.leafNodes[i].name)))throw console.log("Unable to find row dendrogram id "+tree.leafNodes[i].name+" in row annotations"),new Error("Unable to find row dendrogram id "+tree.leafNodes[i].name+" in row annotations");rowIndices.push(index)}}this.rowDendrogram=new morpheus.RowDendrogram(this,tree,heatmap.getRowPositions(),this.project,!0),this.rowDendrogram.lineWidth=this.options.rowDendrogramLineWidth,this.rowDendrogram.appendTo(this.$parent),this.rowDendrogram.$label.appendTo(this.$parent),this.rowDendrogram.$squishedLabel.appendTo(this.$parent),null!=rowIndices&&((rowDendrogramSortKey=new morpheus.SpecifiedModelSortOrder(rowIndices,rowIndices.length,"dendrogram")).setLockOrder(2),rowDendrogramSortKey.setUnlockable(!1),rowDendrogramSortKey.setPreservesDendrogram(!0))}var tree,columnDendrogramSortKey=null;if(null!=columnDendrogram)if((tree=columnDendrogram).leafNodes.length!==this.project.getSortedFilteredDataset().getColumnCount())console.log("# leaf nodes "+tree.leafNodes.length+" != "+this.project.getSortedFilteredDataset().getColumnCount());else{var columnIndices=null;if(null!=this.options.columnDendrogramField){var vector;if(columnIndices=[],null==(vector=dataset.getColumnMetadata().getByName(this.options.columnDendrogramField)))throw console.log(this.options.columnDendrogramField+" not found in "+morpheus.MetadataUtil.getMetadataNames(dataset.getRowMetadata())),new Error(this.options.columnDendrogramField+" not found");for(map=new morpheus.Map,re=/[,:]/g,isString="string"===morpheus.VectorUtil.getDataType(vector),j=0,size=vector.size();j<size;j++){key=vector.getValue(j);isString&&(key=key.replace(re,"")),map.set(key,j)}for(i=0,length=tree.leafNodes.length;i<length;i++){var index;if(void 0===(index=map.get(tree.leafNodes[i].name)))throw"Unable to find column dendrogram id "+tree.leafNodes[i].name+" in column annotations";columnIndices.push(index)}}this.columnDendrogram=new morpheus.ColumnDendrogram(this,tree,heatmap.getColumnPositions(),this.project,!0),this.columnDendrogram.lineWidth=this.options.columnDendrogramLineWidth,this.columnDendrogram.appendTo(this.$parent),this.columnDendrogram.$label.appendTo(this.$parent),this.columnDendrogram.$squishedLabel.appendTo(this.$parent),null!=columnIndices&&((columnDendrogramSortKey=new morpheus.SpecifiedModelSortOrder(columnIndices,columnIndices.length,"dendrogram")).setLockOrder(2),columnDendrogramSortKey.setUnlockable(!1),columnDendrogramSortKey.setPreservesDendrogram(!0))}if(null!=this.options.drawGrid&&this.heatmap.setDrawGrid(this.options.drawGrid),null!=this.options.gridColor&&this.heatmap.setGridColor(this.options.gridColor),null!=this.options.gridThickness&&this.heatmap.setGridThickness(this.options.gridThickness),null!=this.options.drawValues&&this.heatmap.setDrawValues(this.options.drawValues),null!=rowDendrogramSortKey&&this.project.setRowSortKeys([rowDendrogramSortKey]),null!=columnDendrogramSortKey&&this.project.setColumnSortKeys([columnDendrogramSortKey]),this.options.rowSortBy&&this.options.rowSortBy.length>0&&this.project.setRowSortKeys(morpheus.SortKey.fromJSON(this.project,this.options.rowSortBy),!1),this.options.columnSortBy&&this.options.columnSortBy.length>0&&this.project.setColumnSortKeys(morpheus.SortKey.fromJSON(this.project,this.options.columnSortBy),!1),null!=this.options.rowGroupBy&&this.options.rowGroupBy.length>0){var keys=morpheus.SortKey.fromJSON(this.project,this.options.rowGroupBy);for(i=0;i<keys.length;i++)this.project.groupRows.push(keys[i])}if(null!=this.options.columnGroupBy&&this.options.columnGroupBy.length>0)for(keys=morpheus.SortKey.fromJSON(this.project,this.options.columnGroupBy),i=0;i<keys.length;i++)this.project.groupColumns.push(keys[i]);if(null!=this.options.rowSelection&&this.options.rowSelection.length>0){var indices=new morpheus.Set;for(i=0,length=this.options.rowSelection.length;i<length;i++)indices.add(this.project.convertModelRowIndexToView(this.options.rowSelection[i]));this.project.getRowSelectionModel().setViewIndices(indices,!1)}if(null!=this.options.columnSelection&&this.options.columnSelection.length>0){for(indices=new morpheus.Set,i=0,length=this.options.columnSelection.length;i<length;i++)indices.add(this.project.convertModelColumnIndexToView(this.options.columnSelection[i]));this.project.getColumnSelectionModel().setViewIndices(indices,!1)}null!=this.options.rowSearchTerm&&""!==this.options.rowSearchTerm&&this.toolbar.getSearchField(morpheus.HeatMapToolBar.ROW_SEARCH_FIELD).val(this.options.rowSearchTerm),null!=this.options.columnSearchTerm&&""!==this.options.columnSearchTerm&&this.toolbar.getSearchField(morpheus.HeatMapToolBar.COLUMN_SEARCH_FIELD).val(this.options.columnSearchTerm),this.vSortByValuesIndicator=new morpheus.SortByValuesIndicator(this.project,!0,heatmap.getRowPositions()),this.vSortByValuesIndicator.appendTo(this.$parent),this.hSortByValuesIndicator=new morpheus.SortByValuesIndicator(this.project,!1,heatmap.getColumnPositions()),this.hSortByValuesIndicator.appendTo(this.$parent),this.verticalSearchBar=new morpheus.ScentedSearch(this.project.getRowSelectionModel(),heatmap.getRowPositions(),!0,this.vscroll,this),this.horizontalSearchBar=new morpheus.ScentedSearch(this.project.getColumnSelectionModel(),heatmap.getColumnPositions(),!1,this.hscroll,this),this.rowTracks=[],this.rowTrackHeaders=[],this.columnTracks=[],this.columnTrackHeaders=[],null!=this.options.rowSize&&"fit"!==this.options.rowSize&&this.heatmap.getRowPositions().setSize(this.options.rowSize),null!=this.options.columnSize&&"fit"!==this.options.columnSize&&this.heatmap.getColumnPositions().setSize(this.options.columnSize);var setInitialDisplay=function(isColumns,options){var nameToOption=new morpheus.Map,displaySpecified=null!=_this.options.parent&&_this.options.inheritFromParent;if(null!=options&&options.length>0){displaySpecified=!0;for(var i=0;i<options.length;i++)nameToOption.set(null!=options[i].renameTo?options[i].renameTo:options[i].field,options[i])}var displayMetadata=isColumns?dataset.getColumnMetadata():dataset.getRowMetadata();if(!displaySpecified){var defaultFieldsToShow=new morpheus.Set;["id","name","description"].forEach(function(field){defaultFieldsToShow.add(field)});i=0;for(var metadataCount=displayMetadata.getMetadataCount();i<metadataCount;i++){var v=displayMetadata.get(i);defaultFieldsToShow.has(v.getName())&&!nameToOption.has(v.getName())&&(nameToOption.set(v.getName(),{display:["text"]}),displaySpecified=!0)}}var isFirst=!0;for(i=0,metadataCount=displayMetadata.getMetadataCount();i<metadataCount;i++){var name=(v=displayMetadata.get(i)).getName(),option=nameToOption.get(name);if(!displaySpecified||null!=option){var count=isColumns?dataset.getColumnCount():dataset.getRowCount();if(null!=option||displaySpecified||!(count>1)||morpheus.VectorUtil.containsMoreThanOneValue(v)){null==option&&(option={}),option.title&&v.getProperties().set(morpheus.VectorKeys.TITLE,option.title),null==option.display&&("name"===name||"id"===name||isFirst?(option.inlineTooltip=!0,option.display=["text"]):option.display=isColumns?"color,highlight":"text"),isFirst=!1;var track=_this.addTrack(name,isColumns,option);if(option.size)if(isColumns||null==option.size.width){if(isColumns&&(null!=option.size.width||null!=option.size.height)){var header=_this.getTrackHeaderByIndex(_this.getTrackIndex(name,isColumns),isColumns);option.size.height&&(track.setPrefHeight(option.size.height),header.setPrefHeight(option.size.height)),option.size.width&&(track.setPrefWidth(option.size.width),header.setPrefWidth(option.size.width))}}else{var header=_this.getTrackHeaderByIndex(_this.getTrackIndex(name,isColumns),isColumns);track.setPrefWidth(option.size.width),header.setPrefWidth(option.size.width)}if(option.header&&option.header.font)(header=_this.getTrackHeaderByIndex(_this.getTrackIndex(name,isColumns),isColumns)).font=option.header.font;if(option.formatter&&v.getProperties().set(morpheus.VectorKeys.FORMATTER,morpheus.Util.createNumberFormat(option.formatter)),track.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)&&option.color){var m=isColumns?_this.project.getColumnColorModel():_this.project.getRowColorModel();if(track.getFullVector().getProperties.get(morpheus.VectorKeys.DISCRETE))_.each(options.color,function(p){m.setMappedValue(v,p.value,p.color)});else{var cs=m.createContinuousColorMap(v),min=Number.MAX_VALUE,max=-Number.MAX_VALUE;_.each(options.color,function(p){min=Math.min(min,p.value),max=Math.max(max,p.value)}),cs.setMin(min),cs.setMax(max);var valueToFraction=d3.scale.linear().domain([cs.getMin(),cs.getMax()]).range([0,1]).clamp(!0),fractions=[],colors=[];_.each(options.color,function(p){fractions.push(valueToFraction(p.value)),colors.push(p.color)}),cs.setFractions({fractions:fractions,colors:colors})}if(track.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)&&option.shape){m=isColumns?_this.project.getColumnShapeModel():_this.project.getRowShapeModel();_.each(options.shape,function(p){m.setMappedValue(v,p.value,p.shape)})}}}}}};function reorderTracks(array,isColumns){if(!(null==array||array.length<=1)){var nameOrderPairs=[],found=!1;array.forEach(function(item,index){var name=item.renameTo||item.field,order=index;null!=item.order&&(order=item.order,found=!0),nameOrderPairs.push({name:name,order:order})}),found||array.forEach(function(item,index){var name=item.renameTo||item.field;nameOrderPairs.push({name:name,order:index})}),nameOrderPairs.sort(function(a,b){return a.order===b.order?0:a.order<b.order?-1:1});for(var i=0,counter=0;i<nameOrderPairs.length;i++){var index=_this.getTrackIndex(nameOrderPairs[i].name,isColumns);-1!==index&&(_this.moveTrack(index,counter,isColumns),counter++)}}}setInitialDisplay(!1,this.options.rows),setInitialDisplay(!0,this.options.columns),reorderTracks(this.options.rows,!1),reorderTracks(this.options.columns,!0),this.options.showRowNumber&&this.setShowRowNumber(!0);var dragStartScrollTop,dragStartScrollLeft,panstartMousePosition,colorSchemeSpecified=null!=this.options.colorScheme;if(null==this.options.colorScheme){var ext="";this.options.dataSource&&(ext=morpheus.Util.getExtension(morpheus.Util.getFileName(this.options.dataSource)));var colorScheme=this.autoDisplay({filename:morpheus.Util.getBaseFileName(morpheus.Util.getFileName(this.options.dataset)),extension:ext});null==colorScheme&&(colorScheme={type:"relative"}),this.options.colorScheme=colorScheme;this.project.getFullDataset().getName();if("maf"===ext&&!this.options.rowSortBy){var sortKeys=[];this.project.getFullDataset().getRowMetadata().getByName("order")&&sortKeys.push(new morpheus.SortKey("order",morpheus.SortKey.SortOrder.ASCENDING)),sortKeys.push(new morpheus.SortKey("id",morpheus.SortKey.SortOrder.ASCENDING)),this.project.setRowSortKeys(sortKeys,!1)}-1!==morpheus.DatasetUtil.getSeriesIndex(this.project.getFullDataset(),"allelic_fraction")&&(this.options.sizeBy={seriesName:"allelic_fraction",min:0,max:1})}if(this.options.parent&&this.options.inheritFromParent&&this.heatmap.setPropertiesFromParent(this.options.parent.heatmap),null!=this.options.shape&&this.heatmap.setShape(this.options.shape),this.options.parent&&this.options.inheritFromParent&&!colorSchemeSpecified)heatmap.setColorScheme(this.options.parent.heatmap.getColorScheme().copy(this.project));else if(heatmap.setColorScheme(new morpheus.HeatMapColorScheme(this.project,this.options.colorScheme)),null!=this.options.dataset.getRowMetadata().getByName("Source")){var sourcesSet=morpheus.VectorUtil.getSet(this.options.dataset.getRowMetadata().getByName("Source"));this.heatmap.getColorScheme().setSeparateColorSchemeForRowMetadataField("Source"),sourcesSet.forEach(function(source){_this.autoDisplay({extension:morpheus.Util.getExtension(source),filename:""+source})})}this.options.sizeBy&&(heatmap.getColorScheme().getSizer().setSeriesName(this.options.sizeBy.seriesName),heatmap.getColorScheme().getSizer().setMin(this.options.sizeBy.min),heatmap.getColorScheme().getSizer().setMax(this.options.sizeBy.max)),this.updateDataset(),this.options.tabOpened&&(this.options.tabOpened(this),this.updateDataset()),this.options.renderReady&&(this.options.renderReady(this),this.updateDataset()),"fit"===this.options.rowSize&&(this.heatmap.getRowPositions().setSize(this.getFitRowSize()),this.revalidate({paint:!1})),"fit"===this.options.columnSize&&(this.heatmap.getColumnPositions().setSize(this.getFitColumnSize()),this.revalidate({paint:!1})),this.options.rowColorModel&&this.getProject().getRowColorModel().fromJSON(this.options.rowColorModel),this.options.columnColorModel&&this.getProject().getColumnColorModel().fromJSON(this.options.columnColorModel),this.options.rowShapeModel&&this.getProject().getRowShapeModel().fromJSON(this.options.rowShapeModel),this.options.columnShapeModel&&this.getProject().getColumnShapeModel().fromJSON(this.options.columnShapeModel),this.options.rowFontModel&&this.getProject().getRowFontModel().fromJSON(this.options.rowFontModel),this.options.columnFontModel&&this.getProject().getColumnFontModel().fromJSON(this.options.columnFontModel),"fit"!==this.options.rowSize&&"fit"!==this.options.columnSize||("fit"===this.options.columnSize&&(this.heatmap.getColumnPositions().setSize(this.getFitColumnSize()),this.revalidate({paint:!1})),"fit"===this.options.rowSize&&(this.heatmap.getRowPositions().setSize(this.getFitRowSize()),this.revalidate({paint:!1})),this.paintAll({paintRows:!0,paintColumns:!0,invalidateRows:!0,invalidateColumns:!0})),this.options.parent=null,this.$tipFollow=$('<div style="display:none;" class="morpheus-tip-inline"></div>'),this.$tipFollow.appendTo(this.$parent),this.$tipInfoWindow=$('<div class="morpheus-tip-dialog"></div>'),this.$tipInfoWindow.appendTo(this.$parent),morpheus.Util.isHeadless()||(this.$tipInfoWindow.dialog({close:function(event,ui){_this._togglingInfoWindow||_this.toggleInfoWindow()},autoOpen:!1,width:220,height:280,minHeight:38,minWidth:10,collision:"fit",position:{my:"right-30 bottom",at:"right top",of:this.$parent},title:"Info"}),this.setTooltipMode(this.options.tooltipMode)),this.getProject().on("rowFilterChanged columnFilterChanged rowGroupByChanged columnGroupByChanged rowSortOrderChanged columnSortOrderChanged datasetChanged",function(e){if("datasetChanged"===e.type){for(var dataset=_this.getProject().getFullDataset(),i=0;i<_this.rowTracks.length;i++){var track=_this.rowTracks[i];dataset.getRowMetadata().getByName(track.getName())||(_this.removeTrack(track.getName(),!1),i--)}for(i=0;i<_this.columnTracks.length;i++){track=_this.columnTracks[i];dataset.getColumnMetadata().getByName(track.getName())||(_this.removeTrack(track.getName(),!0),i--)}}_this.updateDataset(),_this.revalidate()}),this.getProject().on("trackChanged",function(e){var columns=e.columns;_.each(e.vectors,function(v,i){var index=_this.getTrackIndex(v.getName(),columns);if(-1===index)_this.addTrack(v.getName(),columns,e.display[i]);else{var track=_this.getTrackByIndex(index,columns),display=e.display[i];display&&track.settingFromConfig(display),track.setInvalid(!0)}}),_this.revalidate()}),this.getProject().on("rowTrackRemoved",function(e){_this.removeTrack(e.vector.getName(),!1),_this.revalidate()}),this.getProject().on("columnTrackRemoved",function(e){_this.removeTrack(e.vector.getName(),!0),_this.revalidate()}),this.getProject().getRowSelectionModel().on("selectionChanged",function(){for(var i=0;i<_this.columnTracks.length;i++){var track=_this.columnTracks[i];if(track.getFullVector().getProperties().get(morpheus.VectorKeys.RECOMPUTE_FUNCTION_SELECTION)){var selectedDataset=_this.getProject().getSelectedDataset({selectedRows:!0,selectedColumns:!1,emptyToAll:!1}),vector=selectedDataset.getColumnMetadata().getByName(track.getName()),f=morpheus.VectorUtil.jsonToFunction(vector,morpheus.VectorKeys.FUNCTION);if("function"==typeof f){for(var view=new morpheus.DatasetColumnView(selectedDataset),j=0,size=vector.size();j<size;j++)view.setIndex(j),vector.setValue(j,f(view,selectedDataset,j));track.setInvalid(!0),track.repaint()}}}_this.verticalSearchBar.update(),_this.heatmap.updateRowSelectionCache(),_this.paintAll({paintRows:!0,paintColumns:!1,invalidateRows:!1,invalidateColumns:!1})}),this.getProject().getColumnSelectionModel().on("selectionChanged",function(){_this.horizontalSearchBar.update(),_this.heatmap.updateColumnSelectionCache(),_this.paintAll({paintRows:!1,paintColumns:!0,invalidateRows:!1,invalidateColumns:!1})}),this.pasteListener=function(e){if(_this.isActiveComponent()){var text=e.originalEvent.clipboardData.getData("text/plain");if(null!=text&&text.length>0){var url;if(e.preventDefault(),e.stopPropagation(),0===text.indexOf("http"))url=text;else{var blob=new Blob([text],{type:"text/plain"});url=URL.createObjectURL(blob)}morpheus.HeatMap.showTool(new morpheus.OpenFileTool({clipboard:!0,file:url}),_this)}}},this.beforeCopyListener=function(e){_this.isActiveComponent()&&e.preventDefault()},this.copyListener=function(ev){if(_this.isActiveComponent()){var activeComponent=_this.getActiveComponent(),project=_this.project;if("heatMap"===activeComponent||ev.shiftKey){var bounds=_this.getTotalSize(),height=bounds.height,width=bounds.width,canvas=$("<canvas></canvas>")[0];canvas.height=height,canvas.width=width;var context=canvas.getContext("2d");_this.snapshot(context);var url=canvas.toDataURL();return ev.originalEvent.clipboardData.setData("text/html",'<img src="'+url+'">'),ev.preventDefault(),void ev.stopImmediatePropagation()}var dataset=project.getSelectedDataset({emptyToAll:!1}),rowsSelected=dataset.getRowCount()>0,columnsSelected=dataset.getColumnCount()>0,columnMetadata=dataset.getColumnMetadata(),rowMetadata=dataset.getRowMetadata(),visibleColumnFields=_this.getVisibleTrackNames(!0),columnFieldIndices=[];_.each(visibleColumnFields,function(name){var index=morpheus.MetadataUtil.indexOf(columnMetadata,name);-1!==index&&columnFieldIndices.push(index)}),columnMetadata=new morpheus.MetadataModelColumnView(columnMetadata,columnFieldIndices);rowMetadata=dataset.getRowMetadata();var visibleRowFields=_this.getVisibleTrackNames(!1),rowFieldIndices=[];_.each(visibleRowFields,function(name){var index=morpheus.MetadataUtil.indexOf(rowMetadata,name);-1!==index&&rowFieldIndices.push(index)}),rowMetadata=new morpheus.MetadataModelColumnView(rowMetadata,rowFieldIndices);var text=[];if(rowsSelected&&columnsSelected)text=(new morpheus.GctWriter).write(dataset);else{text=[];for(var model=rowsSelected?rowMetadata:columnMetadata,i=0,count=model.getItemCount();i<count;i++){for(var j=0,nfields=model.getMetadataCount();j<nfields;j++){var v=model.get(j);j>0&&text.push("\t"),text.push(morpheus.Util.toString(v.getValue(i)))}text.push("\n")}text=text.join("")}ev.originalEvent.clipboardData.setData("text/plain",text),ev.preventDefault(),ev.stopImmediatePropagation()}},"undefined"!=typeof window&&$(window).on("paste.morpheus",this.pasteListener).on("beforecopy.morpheus",this.beforeCopyListener).on("copy.morpheus",this.copyListener),this.options.keyboard&&!morpheus.Util.isHeadless()&&new morpheus.HeatMapKeyListener(this),this.options.symmetric&&this.getProject().setSymmetric(this),this.hammer=morpheus.Util.hammer(_this.heatmap.canvas,["pan","pinch","tap","swipe"]).on("swipe",this.swipe=function(event){event.preventDefault()}).on("panend",this.panend=function(event){_this.panning=!1,panstartMousePosition&&(panstartMousePosition=null,_this.heatmap.setSelectionBox(null),_this.heatmap.repaint()),event.preventDefault()}).on("panmove",this.panmove=function(event){if(panstartMousePosition){var pos=morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,_this.scrollLeft(),_this.scrollTop()),rowIndex=_this.heatmap.getRowPositions().getIndex(pos.y,!1),columnIndex=_this.heatmap.getColumnPositions().getIndex(pos.x,!1);_this.updatingScroll=!1,_this.heatmap.setSelectionBox({y:[panstartMousePosition.rowIndex,rowIndex],x:[panstartMousePosition.columnIndex,columnIndex]});for(var rowIndices=new morpheus.Set,i=Math.min(panstartMousePosition.rowIndex,rowIndex),end=Math.max(panstartMousePosition.rowIndex,rowIndex);i<=end;i++)rowIndices.add(i);var columnIndices=new morpheus.Set;for(i=Math.min(panstartMousePosition.columnIndex,columnIndex),end=Math.max(panstartMousePosition.columnIndex,columnIndex);i<=end;i++)columnIndices.add(i);_this.project.getRowSelectionModel().setViewIndices(rowIndices,!0),_this.project.getColumnSelectionModel().setViewIndices(columnIndices,!0)}else{_this.updatingScroll=!0;var rows=!1,columns=!1;if(0!==event.deltaY){pos=dragStartScrollTop+event.deltaY;_this.scrollTop(pos),rows=!0}if(0!==event.deltaX){pos=dragStartScrollLeft+event.deltaX;_this.scrollLeft(pos),columns=!0}_this.updatingScroll=!1,(rows||columns)&&_this.paintAll({paintRows:rows,paintColumns:rows,invalidateRows:rows,invalidateColumns:columns})}event.preventDefault()}).on("panstart",this.panstart=function(event){if(_this.panning=!0,_this.project.setHoverRowIndex(-1),_this.project.setHoverColumnIndex(-1),event.srcEvent.shiftKey){var pos=morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,_this.scrollLeft(),_this.scrollTop());panstartMousePosition={rowIndex:_this.heatmap.getRowPositions().getIndex(pos.y,!1),columnIndex:_this.heatmap.getColumnPositions().getIndex(pos.x,!1)}}else panstartMousePosition=null,dragStartScrollTop=_this.scrollTop(),dragStartScrollLeft=_this.scrollLeft();event.preventDefault()}).on("tap",this.tap=function(event){morpheus.Util.IS_MAC&&event.srcEvent.ctrlKey||(_this.project.getRowSelectionModel().setViewIndices(new morpheus.Set,!0),_this.project.getColumnSelectionModel().setViewIndices(new morpheus.Set,!0))}).on("pinch",this.pinch=function(event){var scale=event.scale;_this.heatmap.getRowPositions().setSize(14*scale),_this.heatmap.getColumnPositions().setSize(14*scale);var reval={};-1!==_this.project.getHoverRowIndex()&&(reval.scrollTop=this.heatmap.getRowPositions().getPosition(this.project.getHoverRowIndex())),-1!==_this.project.getHoverColumnIndex()&&(reval.scrollLeft=this.heatmap.getColumnPositions().getPosition(this.project.getHoverColumnIndex())),_this.revalidate(reval),event.preventDefault()});var heatMapMouseMoved=function(event){var mouseI,mouseJ;if("mouseout"===event.type)mouseI=-1,mouseJ=-1;else{var position=morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,_this.scrollLeft(),_this.scrollTop());mouseI=_this.heatmap.getRowPositions().getIndex(position.y,!1),mouseJ=_this.heatmap.getColumnPositions().getIndex(position.x,!1)}_this.setMousePosition(mouseI,mouseJ,{event:event})};$(_this.heatmap.canvas).on("mouseout",heatMapMouseMoved).on("mousemove",heatMapMouseMoved),_.each(this.options.tools,function(item){var action=_this.getActionManager().getAction(item.name);if(null==action)console.log(item.name+" not found.");else{var actionGui=action.gui(),gui=actionGui.gui(_this.getProject()),formBuilder=new morpheus.FormBuilder;_.each(gui,function(item){formBuilder.append(item)});var input={};if(_.each(gui,function(item){input[item.name]=formBuilder.getValue(item.name)}),item.params)for(var key in item.params)input[key]=item.params[key];actionGui.execute({heatMap:_this,project:_this.getProject(),input:input})}})},setMousePosition:function(i,j,options){this.mousePositionOptions=options;var updateColumns=this.project.getHoverColumnIndex()!==j,updateRows=this.project.getHoverRowIndex()!==i;updateColumns||updateRows?(this.panning||(this.project.setHoverRowIndex(i),this.project.setHoverColumnIndex(j)),this.setToolTip(i,j,options),this.paintAll({paintRows:updateRows,paintColumns:updateColumns,invalidateRows:!1,invalidateColumns:!1})):this._updateTipFollowPosition(options),this.trigger("change",{name:"setMousePosition",source:this,arguments:arguments})},getContentEl:function(){return this.$content},focus:function(){var scrollTop=document.body.scrollTop;this.$tabPanel.focus(),document.body.scrollTop=scrollTop},getFocusEl:function(){return this.$tabPanel},setTooltipMode:function(mode){this._togglingInfoWindow=!0,this.options.tooltipMode=mode,this.$tipInfoWindow.html(""),this.toolbar.$tip.html(""),this.$tipFollow.html("").css({display:"none"}),this.toolbar.$tip.css("display",0===mode?"":"none"),this.setToolTip(-1,-1),1===this.options.tooltipMode?this.$tipInfoWindow.dialog("open"):this.$tipInfoWindow.dialog("close"),this._togglingInfoWindow=!1},toggleInfoWindow:function(){this.setTooltipMode(1==this.options.tooltipMode?0:1)},_setTipText:function(tipText,tipFollowText,options){0===this.options.tooltipMode?this.toolbar.$tip.html(tipText.join("")):1===this.options.tooltipMode&&this.$tipInfoWindow.html(tipText.join("")),null!=tipFollowText?(this.tipFollowHidden=!1,this.$tipFollow.html(tipFollowText),this._updateTipFollowPosition(options)):(this.tipFollowHidden=!0,this.$tipFollow.empty().css({display:"none"})),this.trigger("change",{name:"setToolTip",source:this,arguments:arguments})},setToolTip:function(rowIndex,columnIndex,options){if(options=options||{},this.options.showSeriesNameInTooltip&&(options.showSeriesNameInTooltip=!0),this.options.tooltipSeriesIndices&&(options.tooltipSeriesIndices=this.options.tooltipSeriesIndices),options.heatMapLens){var $wrapper=$("<div></div>"),wrapperHeight=0,wrapperWidth=0,inline=[],indicesForLens=[];if(null!=rowIndex&&rowIndex.length>0){for(var hoverIndex=0;hoverIndex<rowIndex.length;hoverIndex++){(row=rowIndex[hoverIndex])>=0&&(row>=this.heatmap.lastPosition.bottom||row<this.heatmap.lastPosition.top)?indicesForLens.push(row):inline.push(row)}if(indicesForLens.length<20)for(hoverIndex=0;hoverIndex<indicesForLens.length;hoverIndex++){for(var row=indicesForLens[hoverIndex],heatMapWidth=this.heatmap.getUnscaledWidth(),top=row,bottom=row+1,heatMapHeight=(startPix=this.heatmap.rowPositions.getPosition(top))+this.heatmap.rowPositions.getItemSize(top)-startPix,canvas=morpheus.CanvasUtil.createCanvas(),trackWidth=0,i=0,ntracks=this.rowTracks.length;i<ntracks;i++){(track=this.rowTracks[i]).isVisible()&&(trackWidth+=track.getUnscaledWidth())}var canvasWidth=trackWidth+heatMapWidth+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS;canvas.width=canvasWidth*morpheus.CanvasUtil.BACKING_SCALE,canvas.style.width=canvasWidth+"px",canvas.height=heatMapHeight*morpheus.CanvasUtil.BACKING_SCALE,canvas.style.height=heatMapHeight+"px";var context=canvas.getContext("2d");morpheus.CanvasUtil.resetTransform(context),context.save(),context.translate(-this.heatmap.lastClip.x,-startPix),context.rect(this.heatmap.lastClip.x,startPix,this.heatmap.lastClip.width,this.heatmap.lastClip.height),context.clip(),this.heatmap._draw({left:this.heatmap.lastPosition.left,right:this.heatmap.lastPosition.right,top:top,bottom:bottom,context:context}),context.restore(),context.translate(heatMapWidth+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS,-startPix),trackWidth=0;for(i=0,ntracks=this.rowTracks.length;i<ntracks;i++){(track=this.rowTracks[i]).isVisible()&&(context.save(),context.translate(trackWidth,0),context.rect(0,startPix,track.getUnscaledWidth(),track.lastClip.height),context.clip(),track._draw({start:top,end:bottom,vector:track.getVector(),context:context,availableSpace:track.getUnscaledWidth()}),context.restore(),trackWidth+=track.getUnscaledWidth())}$(canvas).appendTo($wrapper),canvas.style.top=wrapperHeight+"px",wrapperHeight+=parseFloat(canvas.style.height),wrapperWidth=parseFloat(canvas.style.width)}if(indicesForLens.length>0){if(indicesForLens.length<20){$wrapper.css({height:wrapperHeight,width:wrapperWidth});var rect=this.$parent[0].getBoundingClientRect();this.$tipFollow.html($wrapper).css({display:"",left:Math.round(parseFloat(this.heatmap.canvas.style.left)-1)+"px",top:options.event.clientY-rect.top-wrapperHeight/2+"px"})}else this.$tipFollow.html("");return}var tipText=[],tipFollowText=[];if(inline.length<20)for(hoverIndex=0;hoverIndex<inline.length;hoverIndex++)this.tooltipProvider(this,inline[hoverIndex],-1,options,0===this.options.tooltipMode?"&nbsp;&nbsp;&nbsp;":"<br />",!1,tipText),this.options.inlineTooltip&&this.tooltipProvider(this,inline[hoverIndex],-1,options,"<br />",!0,tipFollowText);var text=tipFollowText.join("");this._setTipText(tipText,0===text.length?null:'<span style="max-width:400px;">'+text+"</span>",options)}if(null!=columnIndex&&columnIndex.length>0){for(hoverIndex=0;hoverIndex<columnIndex.length;hoverIndex++){(column=columnIndex[hoverIndex])>=0&&(column>=this.heatmap.lastPosition.right||column<this.heatmap.lastPosition.left)?indicesForLens.push(column):inline.push(column)}if(indicesForLens.length<20)for(hoverIndex=0;hoverIndex<indicesForLens.length;hoverIndex++){var startPix,column=indicesForLens[hoverIndex],left=(heatMapHeight=this.heatmap.getUnscaledHeight(),column),right=column+1,trackHeight=(heatMapWidth=(startPix=this.heatmap.columnPositions.getPosition(left))+this.heatmap.columnPositions.getItemSize(left)-startPix,canvas=morpheus.CanvasUtil.createCanvas(),0);for(i=0,ntracks=this.columnTracks.length;i<ntracks;i++){(track=this.columnTracks[i]).isVisible()&&(trackHeight+=track.getUnscaledHeight())}var canvasHeight=trackHeight+heatMapHeight+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS;canvas.width=heatMapWidth*morpheus.CanvasUtil.BACKING_SCALE,canvas.style.width=heatMapWidth+"px",canvas.height=canvasHeight*morpheus.CanvasUtil.BACKING_SCALE,canvas.style.height=canvasHeight+"px";context=canvas.getContext("2d");morpheus.CanvasUtil.resetTransform(context),context.translate(-startPix,0),context.save(),context.rect(startPix,trackHeight+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS,this.heatmap.lastClip.width,this.heatmap.lastClip.height+trackHeight+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS),context.clip(),context.translate(0,trackHeight+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS-this.heatmap.lastClip.y),this.heatmap._draw({top:this.heatmap.lastPosition.top,bottom:this.heatmap.lastPosition.bottom,left:left,right:right,context:context}),context.restore(),trackHeight=0;for(i=0,ntracks=this.columnTracks.length;i<ntracks;i++){var track;(track=this.columnTracks[i]).isVisible()&&(context.save(),context.translate(0,trackHeight),context.rect(startPix,0,track.lastClip.width,track.getUnscaledHeight()),context.clip(),track._draw({start:left,end:right,vector:track.getVector(),context:context,availableSpace:track.getUnscaledHeight(),clip:{x:track.lastClip.x,y:track.lastClip.y}}),context.restore(),trackHeight+=track.getUnscaledHeight())}canvas.style.left=wrapperWidth+"px",wrapperWidth+=parseFloat(canvas.style.width),wrapperHeight=parseFloat(canvas.style.height),$(canvas).appendTo($wrapper)}if(indicesForLens.length>0){if(indicesForLens.length<20){$wrapper.css({height:wrapperHeight,width:wrapperWidth});rect=this.$parent[0].getBoundingClientRect();this.$tipFollow.html($wrapper).css({top:parseFloat(this.heatmap.canvas.style.top)-trackHeight-morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS-1,left:options.event.clientX-rect.left-wrapperWidth/2,display:""})}else this.$tipFollow.html("");return}tipText=[],tipFollowText=[];if(inline.length<20)for(hoverIndex=0;hoverIndex<inline.length;hoverIndex++)this.tooltipProvider(this,-1,inline[hoverIndex],options,0===this.options.tooltipMode?"&nbsp;&nbsp;&nbsp;":"<br />",!1,tipText),this.options.inlineTooltip&&this.tooltipProvider(this,-1,inline[hoverIndex],options,"<br />",!0,tipFollowText);text=tipFollowText.join("");this._setTipText(tipText,""===text?null:'<span style="max-width:400px;">'+text+"</span>",options)}}tipText=[];this.tooltipProvider(this,rowIndex,columnIndex,options,0===this.options.tooltipMode?"&nbsp;&nbsp;&nbsp;":"<br />",!1,tipText);text=[];var $tipFollowText,customToolTip=!1;if(!this.panning){tipFollowText=[];this.options.inlineTooltip&&(this.tooltipProvider(this,rowIndex,columnIndex,options,"<br />",!0,tipFollowText),this.options.tooltip&&-1!==rowIndex&&-1!==columnIndex&&tipFollowText.push('<div data-name="tip"></div>')),text=tipFollowText.join(""),$tipFollowText=$('<span style="max-width:400px;">'+text+"</span>"),this.options.tooltip&&-1!==rowIndex&&-1!==columnIndex&&(this.options.tooltip(this,rowIndex,columnIndex,$tipFollowText.find("[data-name=tip]")),customToolTip=!0)}this._setTipText(tipText,text.length>0||customToolTip?$tipFollowText:null,options)},_updateTipFollowPosition:function(options){if(!this.tipFollowHidden){var parentRect=this.$parent[0].getBoundingClientRect(),tipRect=this.$tipFollow[0].getBoundingClientRect(),tipWidth=tipRect.width,tipHeight=tipRect.height,left=options.event.clientX-parentRect.left+10,top=options.event.clientY-parentRect.top+10;left+tipWidth>=parentRect.right-parentRect.left-18&&(left=options.event.clientX-parentRect.left-10-tipWidth),top+tipHeight>=parentRect.bottom-parentRect.top-18&&(top=options.event.clientY-parentRect.top-10-tipHeight),this.$tipFollow.css({left:left+"px",top:top+"px",display:""})}},setTrackVisibility:function(tracks){var _this=this;_.each(tracks,function(track){var existingTrack=_this.getTrack(track.name,track.isColumns);track.visible&&null!=existingTrack&&0===_.keys(existingTrack.settings).length&&existingTrack.settingFromConfig("Text"),_this.setTrackVisible(track.name,track.visible,track.isColumns)}),this.revalidate(),this.trigger("change",{name:"setTrackVisibility",source:this,arguments:arguments})},setTrackVisible:function(name,visible,isColumns){var trackIndex=this.getTrackIndex(name,isColumns);if(-1===trackIndex){if(!visible)return;this.addTrack(name,isColumns)}else{var track=isColumns?this.columnTracks[trackIndex]:this.rowTracks[trackIndex],header=isColumns?this.columnTrackHeaders[trackIndex]:this.rowTrackHeaders[trackIndex];if(track.isVisible()===visible)return;track.setVisible(visible),header.setVisible(visible)}this.trigger("change",{name:"setTrackVisible",source:this,arguments:arguments})},addTrack:function(name,isColumns,renderSettings,trackIndex){if(void 0===name)throw"Name not specified";var tracks=isColumns?this.columnTracks:this.rowTracks,headers=isColumns?this.columnTrackHeaders:this.rowTrackHeaders,existingIndex=this.getTrackIndex(name,isColumns);if(-1!==existingIndex)return tracks[existingIndex];if(null==renderSettings){var metadata=isColumns?this.project.getFullDataset().getColumnMetadata():this.project.getFullDataset().getRowMetadata();renderSettings="[number]"===morpheus.VectorUtil.getDataType(metadata.getByName(name))?{display:["bar"]}:{display:["text"]}}var positions=isColumns?this.heatmap.getColumnPositions():this.heatmap.getRowPositions(),track=new morpheus.VectorTrack(this.project,name,positions,isColumns,this);track.settingFromConfig(renderSettings),track.appendTo(this.$parent);var header=new morpheus.VectorTrackHeader(this.project,name,isColumns,this);return header.appendTo(this.$parent),track._selection=new morpheus.TrackSelection(track,positions,isColumns?this.project.getColumnSelectionModel():this.project.getRowSelectionModel(),isColumns,this),null!=trackIndex&&trackIndex>=0?(tracks.splice(trackIndex,0,track),headers.splice(trackIndex,0,header)):(tracks.push(track),headers.push(header)),track},addPopup:function(item){this.popupItems||(this.popupItems=[]),this.popupItems.push(item)},getPopupItems:function(){return this.popupItems||[]},removeTrack:function(name,isColumns){var index=this.getTrackIndex(name,isColumns),tracks=isColumns?this.columnTracks:this.rowTracks;if(isNaN(index)||index<0||index>=tracks.length)console.log("removeTrack: "+name+" not found.");else{var headers=isColumns?this.columnTrackHeaders:this.rowTrackHeaders,track=tracks[index],header=headers[index];track.dispose(),header.dispose(),tracks.splice(index,1),headers.splice(index,1),this.trigger("change",{name:"removeTrack",source:this,arguments:arguments})}},updateDataset:function(){var dataset=this.project.getSortedFilteredDataset();this.verticalSearchBar.update(),this.horizontalSearchBar.update(),this.heatmap.setDataset(dataset),this.heatmap.getRowPositions().setSpaces(morpheus.HeatMap.createGroupBySpaces(dataset,this.project.getGroupRows(),this.rowGapSize,!1)),this.heatmap.getColumnPositions().setSpaces(morpheus.HeatMap.createGroupBySpaces(dataset,this.project.getGroupColumns(),this.columnGapSize,!0)),this.trigger("change",{name:"updateDataset",source:this,arguments:arguments})},zoom:function(isZoomIn,options){options=$.extend({},{rows:!0,columns:!0},options),isZoomIn?(options.rows&&this.heatmap.getRowPositions().setSize(1.5*this.heatmap.getRowPositions().getSize()),options.columns&&this.heatmap.getColumnPositions().setSize(1.5*this.heatmap.getColumnPositions().getSize())):(options.rows&&this.heatmap.getRowPositions().setSize(this.heatmap.getRowPositions().getSize()/1.5),options.columns&&this.heatmap.getColumnPositions().setSize(this.heatmap.getColumnPositions().getSize()/1.5));var reval={};options.rows&&-1!==this.project.getHoverRowIndex()&&(reval.scrollTop=this.heatmap.getRowPositions().getPosition(this.project.getHoverRowIndex())),options.columns&&-1!==this.project.getHoverColumnIndex()&&(reval.scrollLeft=this.heatmap.getColumnPositions().getPosition(this.project.getHoverColumnIndex())),this.revalidate(reval),this.trigger("change",{name:"zoom",source:this,arguments:arguments})},getTrackIndex:function(name,isColumns){for(var tracks=isColumns?this.columnTracks:this.rowTracks,i=0,length=tracks.length;i<length;i++)if(void 0!==tracks[i].name&&tracks[i].name===name)return i;return-1},getNumTracks:function(isColumns){return isColumns?this.columnTracks.length:this.rowTracks.length},moveTrack:function(index,newIndex,isColumns){var tracks=isColumns?this.columnTracks:this.rowTracks,headers=isColumns?this.columnTrackHeaders:this.rowTrackHeaders,track=tracks[index];tracks.splice(index,1);var header=headers[index];headers.splice(index,1),tracks.splice(newIndex,0,track),headers.splice(newIndex,0,header),this.trigger("change",{name:"moveTrack",source:this,arguments:arguments})},getTrackByIndex:function(index,isColumns){return isColumns?this.columnTracks[index]:this.rowTracks[index]},getTrackHeaderByIndex:function(index,isColumns){return isColumns?this.columnTrackHeaders[index]:this.rowTrackHeaders[index]},getTrack:function(name,isColumns){var index=this.getTrackIndex(name,isColumns);if(-1!==index)return isColumns?this.columnTracks[index]:this.rowTracks[index]},isActiveComponent:function(){var active=document.activeElement,tagName=active.tagName;return"INPUT"!=tagName&&"SELECT"!=tagName&&"TEXTAREA"!=tagName&&this.$tabPanel[0].contains(active)},getActiveComponent:function(){var active=document.activeElement;if("CANVAS"===active.tagName){for(var i=0,ntracks=this.columnTracks.length;i<ntracks;i++)if(this.columnTracks[i].canvas===active)return"columnTrack";for(i=0,ntracks=this.rowTracks.length;i<ntracks;i++)if(this.rowTracks[i].canvas===active)return"rowTrack";if(this.heatmap.canvas===active)return"heatMap"}return""},dispose:function(){null!=this.project&&(this.project.off(),this.$tipInfoWindow.dialog("destroy"),this.rowTrackHeaders.forEach(function(header){header.dispose()}),this.columnTrackHeaders.forEach(function(header){header.dispose()}),this.rowTracks.forEach(function(track){track.dispose()}),this.columnTracks.forEach(function(track){track.dispose()}),null!=this.rowDendrogram&&this.rowDendrogram.dispose(),null!=this.columnDendrogram&&this.columnDendrogram.dispose(),this.beforeColumnTrackDivider.dispose(),this.afterRowDendrogramDivider.dispose(),this.afterVerticalScrollBarDivider.dispose(),this.hscroll.dispose(),this.vscroll.dispose(),this.hammer.off("swipe",this.swipe).off("panmove",this.panmove).off("panstart",this.panstart).off("tap",this.tap).off("pinch",this.pinch).off("panend",this.panend),this.hammer.destroy(),"undefined"!=typeof window&&$(window).off("paste.morpheus",this.pasteListener).off("beforecopy.morpheus",this.beforeCopyListener).off("copy.morpheus",this.copyListener).off("orientationchange.morpheus resize.morpheus",this.resizeListener))},getVisibleTrackNames:function(isColumns){return this.getVisibleTracks(isColumns).map(function(track){return track.name})},getVisibleTracks:function(isColumns){var tracks=isColumns?this.columnTracks:this.rowTracks;return null==tracks&&(tracks=[]),tracks.filter(function(track){return track.isVisible()&&!track.getFullVector().getProperties().has(morpheus.VectorKeys.IS_INDEX)})},isShowRowNumber:function(){return this.options.showRowNumber},setShowRowNumber:function(visible){if(this.options.showRowNumber=visible,visible){var track=this.addTrack("#",!1,{popupEnabled:!1,display:["text"]},0);track.getVector=function(name){var v=new morpheus.AbstractVector("#",this.project.getSortedFilteredDataset().getRowCount());return v.getProperties().set(morpheus.VectorKeys.FORMATTER,{pattern:"i"}),v.getValue=function(index){return index+1},v},track.getFullVector=function(){var v=new morpheus.AbstractVector("#",this.project.getFullDataset().getRowCount());return v.getProperties().set(morpheus.VectorKeys.FORMATTER,{pattern:"i"}),v.getValue=function(index){return index+1},v},track.showPopup=function(e,isHeader){e.preventDefault&&e.preventDefault()}}else this.removeTrack("#",!1)},resizeTrack:function(name,width,height,isColumns){var index=this.getTrackIndex(name,isColumns);if(-1===index)throw name+" not found in resize track";if(isColumns){track=this.columnTracks[index],header=this.columnTrackHeaders[index];if(height&&(track.setPrefHeight(height),header.setPrefHeight(height)),width)for(var i=0;i<this.columnTracks.length;i++)this.columnTracks[i].setPrefWidth(width),this.columnTrackHeaders[i].setPrefWidth(width)}else{var track=this.rowTracks[index],header=this.rowTrackHeaders[index];track.setPrefWidth(width),header.setPrefWidth(width)}this.revalidate(),this.trigger("change",{name:"resizeTrack",source:this,arguments:arguments})},isDendrogramVisible:function(isColumns){if(void 0!==(isColumns?this.columnDendrogram:this.rowDendrogram))return morpheus.HeatMap.isDendrogramVisible(this.project,isColumns)},paintAll:function(options){var unscaledHeight=this.heatmap.getUnscaledHeight(),unscaledWidth=this.heatmap.getUnscaledWidth(),y=this.scrollTop(),x=this.scrollLeft();this.hscroll.paint(),this.vscroll.paint();var rows=options.paintRows,columns=options.paintColumns,invalidateRows=options.invalidateRows,invalidateColumns=options.invalidateColumns;if(this.hSortByValuesIndicator.setInvalid(invalidateRows||invalidateColumns),this.hSortByValuesIndicator.paint({x:x,y:0,width:unscaledWidth,height:this.hSortByValuesIndicator.getUnscaledHeight()}),this.vSortByValuesIndicator.setInvalid(invalidateRows||invalidateColumns),this.vSortByValuesIndicator.paint({x:0,y:y,width:this.vSortByValuesIndicator.getUnscaledWidth(),height:unscaledHeight}),rows){for(var i=0,length=this.rowTracks.length;i<length;i++){(track=this.rowTracks[i]).setInvalid(invalidateRows),track.isVisible()&&(track.paint({x:0,y:y,height:unscaledHeight,width:unscaledWidth}),this.rowTrackHeaders[i].paint())}null!=this.rowDendrogram&&(this.rowDendrogram.setInvalid(invalidateRows),this.isDendrogramVisible(!1)?(this.rowDendrogram.setVisible(!0),this.rowDendrogram.paint({x:0,y:y,height:unscaledHeight,width:this.rowDendrogram.getUnscaledWidth()})):this.rowDendrogram.setVisible(!1))}if(columns){for(i=0,length=this.columnTracks.length;i<length;i++){var track;(track=this.columnTracks[i]).setInvalid(invalidateColumns),track.paint({x:x,y:0,width:unscaledWidth,height:track.getUnscaledHeight()}),this.columnTrackHeaders[i].paint()}null!=this.columnDendrogram&&(this.columnDendrogram.setInvalid(invalidateColumns),this.isDendrogramVisible(!0)?(this.columnDendrogram.setVisible(!0),this.columnDendrogram.paint({x:x,y:0,width:unscaledWidth,height:this.columnDendrogram.getUnscaledHeight()})):this.columnDendrogram.setVisible(!1))}(invalidateRows||invalidateColumns)&&this.heatmap.setInvalid(!0),this.heatmap.paint({x:x,y:y,width:unscaledWidth,height:unscaledHeight}),this.trigger("change",{name:"paintAll",source:this,arguments:arguments})},scrollTop:function(pos){return void 0===pos?this.vscroll.getValue():(isNaN(pos)&&(pos=0),this.vscroll.getVisibleExtent()===this.vscroll.getTotalExtent()&&(pos=0),pos=Math.max(pos,0),(pos=Math.min(this.vscroll.getMaxValue(),pos))!==this.vscroll.getValue()&&(this.vscroll.setValue(pos,!0),this.trigger("change",{name:"scrollTop",source:this,arguments:arguments})),pos)},scrollLeft:function(pos){return void 0===pos?this.hscroll.getValue():(isNaN(pos)&&(pos=0),this.hscroll.getVisibleExtent()===this.hscroll.getTotalExtent()&&(pos=0),pos=Math.max(pos,0),(pos=Math.min(this.hscroll.getMaxValue(),pos))!==this.hscroll.getValue()&&(this.trigger("change",{name:"scrollLeft",source:this,arguments:arguments}),this.hscroll.setValue(pos,!0)),pos)},getSelectedTrackName:function(isColumns){return isColumns?this.selectedColumnTrackName:this.selectedRowTrackName},getLastSelectedTrackInfo:function(){return this.selectedTrackInfo},setSelectedTrack:function(name,isColumns){var index,previousName=isColumns?this.selectedColumnTrackName:this.selectedRowTrackName;name!==previousName&&(-1!==(index=this.getTrackIndex(previousName,isColumns))&&this.getTrackHeaderByIndex(index,isColumns).setSelected(!1),isColumns?(this.selectedColumnTrackName=name,this.selectedTrackInfo={name:name,isColumns:!0}):(this.selectedRowTrackName=name,this.selectedTrackInfo={name:name,isColumns:!1}),-1!==(index=this.getTrackIndex(name,isColumns))&&this.getTrackHeaderByIndex(index,isColumns).setSelected(!0),this.trigger("change",{name:"setSelected",source:this,arguments:arguments}))},saveImage:function(file,format){var _this=this,bounds=this.getTotalSize();if("pdf"===format){var context=new canvas2pdf.PdfContext(blobStream(),{size:[bounds.width,bounds.height]});this.snapshot(context),context.stream.on("finish",function(){var blob=context.stream.toBlob("application/pdf");saveAs(blob,file,!0)}),context.end()}else if("svg"===format){context=new C2S(bounds.width,bounds.height);this.snapshot(context);var svg=context.getSerializedSvg(),prefix=[];prefix.push('<?xml version="1.0" encoding="utf-8"?>\n'),prefix.push('<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'),svg=prefix.join("")+svg;var blob=new Blob([svg],{type:"text/plain;charset=utf-8"});saveAs(blob,file,!0)}else{var canvas=$("<canvas></canvas>")[0],height=bounds.height,width=bounds.width,backingScale=morpheus.CanvasUtil.BACKING_SCALE;canvas.height=backingScale*height,canvas.style.height=height+"px",canvas.width=backingScale*width,canvas.style.width=width+"px";context=canvas.getContext("2d");morpheus.CanvasUtil.resetTransform(context),this.snapshot(context),canvas[canvas.toBlobHD?["toBlobHD"]:"toBlob"](function(blob){null!=blob&&0!==blob.size?saveAs(blob,file,!0):morpheus.FormBuilder.showInModal({title:"Save Image",html:"Image is too large to save.",appendTo:_this.getContentEl(),focus:_this.getFocusEl()})})}},getTotalSize:function(options){options=$.extend({},{legend:!0},options);var heatmapPrefSize=this.heatmap.getPreferredSize(),totalSize={width:heatmapPrefSize.width,height:heatmapPrefSize.height};this.isDendrogramVisible(!1)&&(totalSize.width+=this.rowDendrogram.getUnscaledWidth()+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS),this.isDendrogramVisible(!0)&&(totalSize.height+=this.columnDendrogram.getUnscaledHeight()+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS);for(var maxRowHeaderHeight=0,i=0,length=this.rowTracks.length;i<length;i++){if(this.rowTracks[i].isVisible()){var headerSize=this.rowTrackHeaders[i].getPrintSize();totalSize.width+=headerSize.width,maxRowHeaderHeight=Math.max(maxRowHeaderHeight,headerSize.height)}}var maxColumnHeaderWidth=0,columnTrackHeightSum=0;for(i=0,length=this.columnTracks.length;i<length;i++){if(this.columnTracks[i].isVisible()){var size=this.columnTrackHeaders[i].getPrintSize();columnTrackHeightSum+=size.height,maxColumnHeaderWidth=Math.max(maxColumnHeaderWidth,size.width)}}if(totalSize.height+=Math.max(columnTrackHeightSum,maxRowHeaderHeight)+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS,totalSize.width+=maxColumnHeaderWidth+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS,options.legend){var totalLegendWidth=15,maxLegendHeight=0,colorByValues=this.heatmap.getColorScheme().getColorByValues(),ntracks=colorByValues.length;for(i=0;i<ntracks;i++){var value=colorByValues[i];if(null!=value||1===ntracks){this.heatmap.getColorScheme().setCurrentValue(value);var names=this.heatmap.getColorScheme().getNames();maxLegendHeight=Math.max(maxLegendHeight,null!=names?14*names.length:30),totalLegendWidth+=250}}maxLegendHeight+=10,totalSize.height=totalSize.height+maxLegendHeight,totalSize.width=Math.max(totalSize.width,totalLegendWidth)}var trackLegendSize=new morpheus.HeatMapTrackColorLegend(_.filter(this.columnTracks,function(track){return track.isVisible()&&(track.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)||track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR))}),this.getProject().getColumnColorModel()).getPreferredSize();return totalSize.height+=trackLegendSize.height,totalSize.width=Math.max(totalSize.width,trackLegendSize.width),trackLegendSize=new morpheus.HeatMapTrackColorLegend(_.filter(this.rowTracks,function(track){return track.isVisible()&&(track.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)||track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR))}),this.getProject().getRowColorModel()).getPreferredSize(),totalSize.height+=trackLegendSize.height,totalSize.width=Math.max(totalSize.width,trackLegendSize.width),trackLegendSize=new morpheus.HeatMapTrackShapeLegend(_.filter(this.columnTracks,function(track){return track.isVisible()&&track.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)}),this.getProject().getColumnShapeModel()).getPreferredSize(),totalSize.height+=trackLegendSize.height,totalSize.width=Math.max(totalSize.width,trackLegendSize.width),trackLegendSize=new morpheus.HeatMapTrackShapeLegend(_.filter(this.rowTracks,function(track){return track.isVisible()&&track.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)}),this.getProject().getRowShapeModel()).getPreferredSize(),totalSize.height+=trackLegendSize.height,totalSize.width=Math.max(totalSize.width,trackLegendSize.width),trackLegendSize=new morpheus.HeatMapTrackShapeLegend(_.filter(this.columnTracks,function(track){return track.isVisible()&&track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)}),this.getProject().getColumnFontModel()).getPreferredSize(),totalSize.height+=trackLegendSize.height,totalSize.width=Math.max(totalSize.width,trackLegendSize.width),trackLegendSize=new morpheus.HeatMapTrackShapeLegend(_.filter(this.rowTracks,function(track){return track.isVisible()&&track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)}),this.getProject().getRowFontModel()).getPreferredSize(),totalSize.height+=trackLegendSize.height,totalSize.width=Math.max(totalSize.width,trackLegendSize.width),totalSize},getHeatMapElementComponent:function(){return this.heatmap},snapshot:function(context,options){options=$.extend({},{legend:!0},options);var heatmapPrefSize=this.heatmap.getPreferredSize(),legendHeight=(this.getTotalSize(options),0);if(options.legend){var colorByValues=this.heatmap.getColorScheme().getColorByValues();context.save(),context.translate(15,0);var ntracks=colorByValues.length,i=0;for(ntracks=colorByValues.length;i<ntracks;i++){var value=colorByValues[i];if(null!=value||1===ntracks){(trackLegend=new morpheus.ColorSupplierLegend(this.heatmap.getColorScheme(),value)).draw({},context),legendHeight=Math.max(legendHeight,trackLegend.getUnscaledHeight());var legendWidth=trackLegend.getUnscaledWidth();context.translate(legendWidth,0)}}legendHeight+=10,context.restore()}var trackLegend,legendOffset=15,maxLegendHeight=0;context.save(),context.translate(legendOffset,legendHeight),(trackLegend=new morpheus.HeatMapTrackColorLegend(_.filter(this.columnTracks,function(track){return track.isVisible()&&(track.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)||track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR))}),this.getProject().getColumnColorModel())).draw({},context);var legendSize=trackLegend.getPreferredSize();legendOffset+=legendSize.width,maxLegendHeight=Math.max(maxLegendHeight,legendSize.height),context.restore(),context.save(),context.translate(legendOffset,legendHeight),(trackLegend=new morpheus.HeatMapTrackShapeLegend(_.filter(this.columnTracks,function(track){return track.isVisible()&&track.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)}),this.getProject().getColumnShapeModel())).draw({},context),legendOffset+=(legendSize=trackLegend.getPreferredSize()).width,maxLegendHeight=Math.max(maxLegendHeight,legendSize.height),context.restore(),context.save(),context.translate(legendOffset,legendHeight),(trackLegend=new morpheus.HeatMapTrackFontLegend(_.filter(this.columnTracks,function(track){return track.isVisible()&&track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)}),this.getProject().getColumnFontModel())).draw({},context),legendOffset+=(legendSize=trackLegend.getPreferredSize()).width,maxLegendHeight=Math.max(maxLegendHeight,legendSize.height),context.restore(),context.save(),context.translate(legendOffset,legendHeight),(trackLegend=new morpheus.HeatMapTrackColorLegend(_.filter(this.rowTracks,function(track){return track.isVisible()&&(track.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)||track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR))}),this.getProject().getRowColorModel())).draw({},context),legendOffset+=(legendSize=trackLegend.getPreferredSize()).width,maxLegendHeight=Math.max(maxLegendHeight,legendSize.height),context.restore(),context.save(),context.translate(legendOffset,legendHeight),(trackLegend=new morpheus.HeatMapTrackShapeLegend(_.filter(this.rowTracks,function(track){return track.isVisible()&&track.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)}),this.getProject().getRowShapeModel())).draw({},context),legendOffset+=(legendSize=trackLegend.getPreferredSize()).width,maxLegendHeight=Math.max(maxLegendHeight,legendSize.height),context.restore(),context.save(),context.translate(legendOffset,legendHeight),(trackLegend=new morpheus.HeatMapTrackFontLegend(_.filter(this.rowTracks,function(track){return track.isVisible()&&track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)}),this.getProject().getRowFontModel())).draw({},context),legendOffset+=(legendSize=trackLegend.getPreferredSize()).width,maxLegendHeight=Math.max(maxLegendHeight,legendSize.height),context.restore(),legendHeight+=maxLegendHeight;for(var heatmapY=this.isDendrogramVisible(!0)?this.columnDendrogram.getUnscaledHeight()+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS:0,columnTrackY=heatmapY+=legendHeight,heatmapX=this.isDendrogramVisible(!1)?this.rowDendrogram.getUnscaledWidth()+morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS:0,isColumnTrackVisible=!1,length=(i=0,this.columnTracks.length);i<length;i++){if((track=this.columnTracks[i]).isVisible()){var size=(header=this.columnTrackHeaders[i]).getPrintSize();heatmapX=Math.max(heatmapX,size.width),heatmapY+=size.height,isColumnTrackVisible=!0}}isColumnTrackVisible&&(heatmapY+=morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS);for(i=0,length=this.rowTracks.length;i<length;i++){if((track=this.rowTracks[i]).isVisible()){var header=this.rowTrackHeaders[i];heatmapY=Math.max(heatmapY,header.getPrintSize().height)}}if(this.isDendrogramVisible(!0)){var columnDendrogramClip={x:0,y:0,height:this.columnDendrogram.getUnscaledHeight(),width:heatmapPrefSize.width};context.save(),context.translate(heatmapX,legendHeight),this.columnDendrogram.prePaint(columnDendrogramClip,context),this.columnDendrogram.draw(columnDendrogramClip,context),context.restore()}if(this.isDendrogramVisible(!1)){var rowDendrogramClip={x:0,y:0,width:this.rowDendrogram.getUnscaledWidth(),height:heatmapPrefSize.height};context.save(),context.translate(0,heatmapY),this.rowDendrogram.prePaint(rowDendrogramClip,context),this.rowDendrogram.draw(rowDendrogramClip,context),context.restore()}for(i=0,length=this.columnTracks.length;i<length;i++){if((track=this.columnTracks[i]).isVisible()){context.save();var headerSize=(header=this.columnTrackHeaders[i]).getPrintSize();context.translate(heatmapX,columnTrackY);var trackClip={x:0,y:0,width:heatmapPrefSize.width,height:headerSize.height};track.print(trackClip,context),context.restore(),context.save();var headerClip={x:0,y:0,width:headerSize.width,height:trackClip.height};context.translate(heatmapX-2,columnTrackY+trackClip.height),header.print(headerClip,context),context.restore(),columnTrackY+=Math.max(headerClip.height,trackClip.height)}}context.save(),context.translate(heatmapX,heatmapY),this.heatmap.draw({x:0,y:0,width:heatmapPrefSize.width,height:heatmapPrefSize.height},context),context.restore();var rowTrackWidthSum=0;for(i=0,length=this.rowTracks.length;i<length;i++){var track;if((track=this.rowTracks[i]).isVisible()){context.save();var tx=morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS+heatmapX+heatmapPrefSize.width+rowTrackWidthSum,ty=heatmapY;trackClip={x:0,y:0,width:(headerSize=(header=this.rowTrackHeaders[i]).getPrintSize()).width,height:heatmapPrefSize.height};context.translate(tx,ty),context.strokeStyle="white",context.rect(0,0,trackClip.width,trackClip.height),context.stroke(),context.clip(),track.print(trackClip,context),context.restore(),context.save();headerClip={x:0,y:0,width:headerSize.width,height:headerSize.height};context.translate(tx,ty-4),header.print(headerClip,context),context.restore(),rowTrackWidthSum+=Math.max(headerSize.width,trackClip.width)}}},resetZoom:function(){var heatmap=this.heatmap,rowSizes=heatmap.getRowPositions(),columnSizes=heatmap.getColumnPositions();rowSizes.setSize(14),columnSizes.setSize(14);var reval={};-1!==this.project.getHoverRowIndex()&&(reval.scrollTop=this.heatmap.getRowPositions().getPosition(this.project.getHoverRowIndex())),-1!==this.project.getHoverColumnIndex()&&(reval.scrollLeft=this.heatmap.getColumnPositions().getPosition(this.project.getHoverColumnIndex())),this.revalidate(reval)},getFitColumnSize:function(){var heatmap=this.heatmap,availablePixels=this.getAvailableWidth();if(-1===availablePixels)return 14;this.rowDendrogram&&(availablePixels-=this.rowDendrogram.getUnscaledWidth());for(var trackPixels=12,i=0,length=this.rowTracks.length;i<length;i++){(track=this.rowTracks[i]).isVisible()&&(trackPixels+=track.getUnscaledWidth())}for(i=0,length=this.columnTracks.length;i<length;i++){var track;if((track=this.columnTracks[i]).isVisible()){trackPixels+=this.columnTrackHeaders[i].getUnscaledWidth();break}}availablePixels-=trackPixels;var positions=heatmap.getColumnPositions(),totalCurrent=positions.getItemSize(positions.getLength()-1)+positions.getPosition(positions.getLength()-1),size=positions.getSize();return size*=availablePixels/totalCurrent,size=Math.min(14,size)},getFitRowSize:function(){var heatmap=this.heatmap,availablePixels=this.getAvailableHeight();if(-1===availablePixels)return 14;this.columnDendrogram&&(availablePixels-=this.columnDendrogram.getUnscaledHeight());for(var trackPixels=12,i=0,length=this.columnTracks.length;i<length;i++){var track=this.columnTracks[i];track.isVisible()&&(trackPixels+=track.getUnscaledHeight())}availablePixels-=trackPixels;var positions=heatmap.getRowPositions(),totalCurrent=positions.getItemSize(positions.getLength()-1)+positions.getPosition(positions.getLength()-1),size=positions.getSize();return size*=availablePixels/totalCurrent,size=Math.min(14,size)},fitToWindow:function(options){if(options.fitRows&&this.heatmap.getRowPositions().setSize(this.getFitRowSize()),options.fitColumns&&this.heatmap.getColumnPositions().setSize(this.getFitColumnSize()),options.repaint){var revalOptions={};options.fitRows&&-1!==this.project.getHoverRowIndex()&&(revalOptions.scrollTop=this.heatmap.getRowPositions().getPosition(this.project.getHoverRowIndex())),options.fitColumns&&-1!==this.project.getHoverColumnIndex()&&(revalOptions.scrollLeft=this.heatmap.getColumnPositions().getPosition(this.project.getHoverColumnIndex())),this.revalidate(revalOptions)}},getAvailableHeight:function(){if(_.isNumber(this.options.height))return this.options.height;var height=$(window).height()-this.$parent.offset().top-24;return"window"===this.options.height?height:Math.max(Math.round(.7*screen.height),height)},getAvailableWidth:function(){return this.options.width?this.options.width:this.tabManager.getWidth()-30},revalidate:function(options){if(morpheus.Util.isHeadless()){for(var i=0,length=this.rowTracks.length;i<length;i++){(track=this.rowTracks[i]).setInvalid(!0),track.isVisible()&&track.paint({x:0,y:0,height:10,width:10})}for(i=0,length=this.columnTracks.length;i<length;i++){(track=this.columnTracks[i]).setInvalid(!0),track.isVisible()&&track.paint({x:0,y:0,height:10,width:10})}}else{options=$.extend({},{paint:!0},options),this.updatingScroll=!0;var availableHeight=this.getAvailableHeight(),availableWidth=this.getAvailableWidth(),heatmapPrefSize=this.heatmap.getPreferredSize(),columnDendrogramHeight=0,rowDendrogramWidth=0;this.columnDendrogram&&(columnDendrogramHeight=morpheus.CanvasUtil.getPreferredSize(this.columnDendrogram).height),this.rowDendrogram&&(rowDendrogramWidth=morpheus.CanvasUtil.getPreferredSize(this.rowDendrogram).width);var rowTrackWidthSum=0;for(i=0,length=this.rowTracks.length;i<length;i++)this.rowTracks[i].isVisible()&&(void 0!==this.rowTracks[i].getPrefWidth()&&this.rowTrackHeaders[i].setPrefWidth(this.rowTracks[i].getPrefWidth()),rowTrackWidthSum+=Math.max(morpheus.CanvasUtil.getPreferredSize(this.rowTrackHeaders[i]).width,morpheus.CanvasUtil.getPreferredSize(this.rowTracks[i]).width));if(-1!==availableWidth&&rowTrackWidthSum+rowDendrogramWidth+heatmapPrefSize.width>availableWidth){rowTrackWidthSum=0;for(i=0,length=this.rowTracks.length;i<length;i++)if(this.rowTracks[i].isVisible()){var rowTrackHeaderSize=morpheus.CanvasUtil.getPreferredSize(this.rowTrackHeaders[i]),width=Math.max(rowTrackHeaderSize.width,morpheus.CanvasUtil.getPreferredSize(this.rowTracks[i]).width);rowTrackHeaderSize.widthSet||(width=Math.min(400,width),this.rowTracks[i].setPrefWidth(width),this.rowTrackHeaders[i].setPrefWidth(width)),rowTrackWidthSum+=width}}var ypos=columnDendrogramHeight,maxHeaderWidth=0;for(i=0,length=this.columnTracks.length;i<length;i++)if(this.columnTracks[i].isVisible()){void 0!==this.columnTracks[i].getPrefHeight()&&this.columnTrackHeaders[i].setPrefHeight(this.columnTracks[i].getPrefHeight());width=morpheus.CanvasUtil.getPreferredSize(this.columnTrackHeaders[i]).width;maxHeaderWidth=Math.max(maxHeaderWidth,width)}var xpos=Math.max(rowDendrogramWidth,maxHeaderWidth),heatMapWidth=heatmapPrefSize.width,maxHeatMapWidth=Math.max(50,-1===availableWidth?Number.MAX_VALUE:availableWidth-rowTrackWidthSum-xpos-morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS);maxHeatMapWidth>0&&heatMapWidth>maxHeatMapWidth&&(heatMapWidth=maxHeatMapWidth,heatMapWidth=Math.min(heatMapWidth,heatmapPrefSize.width)),void 0!==this.heatmap.prefWidth&&(heatMapWidth=Math.min(heatmapPrefSize.width,this.heatmap.prefWidth)),void 0!==this.columnDendrogram?(this.columnDendrogram.setBounds({width:heatMapWidth,height:columnDendrogramHeight,left:xpos,top:0}),this.columnDendrogram.$label.css("left",xpos+this.columnDendrogram.getUnscaledWidth()+10).css("top",2),this.columnDendrogram.$squishedLabel.css("left",xpos+this.columnDendrogram.getUnscaledWidth()+10).css("top",18),this.beforeColumnTrackDivider.setVisible(!0),this.beforeColumnTrackDivider.setBounds({left:xpos-maxHeaderWidth,top:ypos,width:maxHeaderWidth}),ypos++):this.beforeColumnTrackDivider.setVisible(!1);for(i=0,length=this.columnTracks.length;i<length;i++){if((track=this.columnTracks[i]).isVisible()){var size=morpheus.CanvasUtil.getPreferredSize(track),headerSize=morpheus.CanvasUtil.getPreferredSize(this.columnTrackHeaders[i]);size.height=Math.max(size.height,headerSize.height),track.setBounds({width:heatMapWidth,height:size.height,left:xpos,top:ypos}),this.columnTrackHeaders[i].setBounds({width:maxHeaderWidth,height:size.height,left:xpos-maxHeaderWidth,top:ypos}),ypos+=size.height}}this.$whitespace[0].style.left=Math.ceil(xpos+heatMapWidth+10)+"px",this.$whitespace[0].style.top="0px",ypos+=morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS;var heatMapHeight=heatmapPrefSize.height;-1!==availableHeight&&heatMapHeight>availableHeight-ypos&&(heatMapHeight=Math.max(100,Math.min(heatmapPrefSize.height,availableHeight-ypos))),ypos<0&&(ypos=0),this.rowDendrogram?(this.rowDendrogram.setBounds({width:Math.max(rowDendrogramWidth,maxHeaderWidth),height:heatMapHeight,left:0,top:ypos}),this.rowDendrogram.$label.css("left",0).css("top",2),this.afterRowDendrogramDivider.setVisible(!0),this.afterRowDendrogramDivider.setBounds({height:heatMapHeight,left:this.rowDendrogram.getUnscaledWidth(),top:ypos}),xpos++):this.afterRowDendrogramDivider.setVisible(!1),this.heatmap.setBounds({width:heatMapWidth,height:heatMapHeight,left:xpos,top:ypos}),this.hSortByValuesIndicator.setBounds({height:4,width:heatMapWidth,left:xpos,top:ypos-4}),this.hscroll.setVisible(heatMapWidth<heatmapPrefSize.width),this.hscroll.setExtent(heatMapWidth,heatmapPrefSize.width,void 0!==options.scrollLeft?options.scrollLeft:heatmapPrefSize.width===this.hscroll.getTotalExtent()?this.hscroll.getValue():heatmapPrefSize.width*this.hscroll.getValue()/this.hscroll.getMaxValue()),this.hscroll.setBounds({left:xpos,top:ypos+heatMapHeight+2}),xpos+=heatMapWidth;var nvisibleRowTracks=0;for(i=0,length=this.rowTracks.length;i<length;i++){if((track=this.rowTracks[i]).isVisible()){nvisibleRowTracks++;break}}this.vSortByValuesIndicator.setBounds({width:4,height:heatMapHeight,left:xpos,top:ypos}),nvisibleRowTracks>0&&(xpos+=morpheus.HeatMap.SPACE_BETWEEN_HEAT_MAP_AND_ANNOTATIONS);var rowAnnotationXStart=xpos;for(i=0,length=this.rowTracks.length;i<length;i++){var track;if((track=this.rowTracks[i]).isVisible()){size=morpheus.CanvasUtil.getPreferredSize(track),headerSize=morpheus.CanvasUtil.getPreferredSize(this.rowTrackHeaders[i]);size.width=Math.max(headerSize.width,size.width),size.height=heatMapHeight,track.setBounds({width:size.width,height:size.height,left:xpos,top:ypos}),this.rowTrackHeaders[i].setBounds({width:size.width,left:xpos,top:ypos-headerSize.height-5,height:headerSize.height}),xpos+=size.width}}this.afterVerticalScrollBarDivider.setVisible(nvisibleRowTracks>0),this.afterVerticalScrollBarDivider.setBounds({left:rowAnnotationXStart-2,top:ypos-18}),this.vscroll.setVisible(heatMapHeight<heatmapPrefSize.height),this.vscroll.setExtent(heatMapHeight,heatmapPrefSize.height,void 0!==options.scrollTop?options.scrollTop:heatmapPrefSize.height===this.vscroll.getTotalExtent()?this.vscroll.getValue():heatmapPrefSize.height*this.vscroll.getValue()/this.vscroll.getMaxValue()),xpos+=2,this.vscroll.setBounds({left:xpos,top:ypos}),xpos+=this.vscroll.getUnscaledWidth(),this.hscroll.isVisible()&&(ypos+=this.hscroll.getUnscaledHeight()+2);var totalHeight=2+ypos+heatMapHeight;options.paint&&this.paintAll({paintRows:!0,paintColumns:!0,invalidateRows:!0,invalidateColumns:!0}),this.$parent.css({height:Math.ceil(totalHeight)+"px",width:-1===availableWidth?Math.ceil(xpos+2)+"px":""}),this.updatingScroll=!1,this.trigger("change",{name:"revalidate",source:this,arguments:arguments})}}},morpheus.HeatMap.copyFromParent=function(project,options){project.rowColorModel=options.parent.getProject().getRowColorModel().copy(),project.columnColorModel=options.parent.getProject().getColumnColorModel().copy(),project.rowShapeModel=options.parent.getProject().getRowShapeModel().copy(),project.columnShapeModel=options.parent.getProject().getColumnShapeModel().copy(),project.rowFontModel=options.parent.getProject().getRowFontModel().copy(),project.columnFontModel=options.parent.getProject().getColumnFontModel().copy();var parentRowTracks=options.parent.rowTracks||[],parentColumnTracks=options.parent.columnTracks||[];if(options.inheritFromParentOptions.rows&&(project.columnShapeModel=project.rowShapeModel,project.columnColorModel=project.rowColorModel,project.columnFontModel=project.rowFontModel,parentColumnTracks=parentRowTracks.slice().reverse()),options.inheritFromParentOptions.columns&&(project.rowShapeModel=project.columnShapeModel,project.rowColorModel=project.columnColorModel,project.rowFontModel=project.columnFontModel,parentRowTracks=parentColumnTracks.slice().reverse()),options.inheritFromParentOptions.transpose){var tmp=project.rowShapeModel;project.rowShapeModel=project.columnShapeModel,project.columnShapeModel=tmp,tmp=project.rowColorModel,project.rowColorModel=project.columnColorModel,project.columnColorModel=tmp,tmp=project.rowFontModel,project.rowFontModel=project.columnFontModel,project.columnFontModel=tmp,tmp=parentRowTracks.slice().reverse(),parentRowTracks=parentColumnTracks.slice().reverse(),parentColumnTracks=tmp}options.rows=options.rows||[];for(var i=0;i<parentRowTracks.length;i++){(track=parentRowTracks[i]).isVisible()&&options.rows.push({order:options.rows.length,field:track.getName(),display:$.extend(!0,{},track.settings),force:!0})}options.columns=options.columns||[];for(i=0;i<parentColumnTracks.length;i++){var track;(track=parentColumnTracks[i]).isVisible()&&options.columns.push({order:options.columns.length,field:track.getName(),display:$.extend(!0,{},track.settings),force:!0})}},morpheus.Util.extend(morpheus.HeatMap,morpheus.Events),morpheus.HelpMenu=function(){var html=[];html.push('<ul class="morpheus-footer-links">'),html.push('<li><a data-name="contact" href="#">Contact</a></li>'),html.push('<li><a target="_blank" href="documentation.html">Documentation</a></li>'),html.push('<li><a target="_blank" href="tutorial.html">Tutorial</a></li>'),html.push('<li><a href="configuration.html">Configuration</a></li>'),html.push('<li><a target="_blank" href="https://github.com/cmap/morpheus.R">R Interface</a></li>'),html.push('<li><a target="_blank" href="https://github.com/cmap/morpheus-export">Command Line</a></li>'),html.push('<li><a target="_blank" href="https://github.com/cmap/morpheus.js">Source Code</a></li>'),html.push("</ul>"),this.$el=$(html.join("")),this.$el.find("[data-name=contact]").on("click",function(e){morpheus.FormBuilder.showInModal({title:"Contact",html:"Please email us at morpheus@broadinstitute.org",focus:document.activeElement}),e.preventDefault()})},morpheus.HistogramLegend=function(dataset,colorScheme,metadataValue){morpheus.AbstractCanvas.call(this,!0),this.colorScheme=colorScheme,this.metadataValue=metadataValue,this.dataset=dataset,this.binNumberToOccurences=null,this.setBounds({width:250,height:70}),this.name=null,this.canvas.style.position="",this.canvas.style.border="1px solid LightGrey"},morpheus.HistogramLegend.prototype={binSize:0,maxCount:0,total:0,setName:function(name){this.name=name},setBinSize:function(binSize){this.binSize=binSize},buildHistogram:function(){var binSize=this.binSize,dataset=this.dataset,metadataValue=this.metadataValue,colorScheme=this.colorScheme,min=colorScheme.getMin(),max=colorScheme.getMax();min===max&&(min-=.5,max+=.5);var vector=dataset.getRowMetadata().getByName(colorScheme.getSeparateColorSchemeForRowMetadataField()),numberOfBins=Math.ceil((max-min)/binSize),binNumberToOccurences=new Uint32Array(numberOfBins);this.binNumberToOccurences=binNumberToOccurences;for(var i=0,nrows=dataset.getRowCount();i<nrows;i++)if(null==vector||vector.getValue(i)===metadataValue)for(var j=0,ncols=dataset.getColumnCount();j<ncols;j++){var value=dataset.getValue(i,j);if(!isNaN(value)){var bin=Math.floor((value-min)/binSize);bin<0?bin=0:bin>=numberOfBins&&(bin=numberOfBins-1),binNumberToOccurences[bin]++}}var maxCount=0,total=0;for(i=0;i<numberOfBins;i++){var count=binNumberToOccurences[i];maxCount=count>=maxCount?count:maxCount,total+=count}this.maxCount=maxCount,this.total=total},draw:function(clip,context){this.buildHistogram();var colorScheme=this.colorScheme,canvasWidth=this.getUnscaledWidth()-50,valueToPosition=d3.scale.linear().domain([colorScheme.getMin(),colorScheme.getMax()]).range([0,canvasWidth]).clamp(!0),countToPosition=d3.scale.linear().domain([0,this.maxCount/this.total]).range([30,0]).clamp(!0),binNumberToOccurences=this.binNumberToOccurences,min=colorScheme.getMin(),binSize=this.binSize,y0=countToPosition(0);null!=this.name&&(context.font="11px "+morpheus.CanvasUtil.getFontFamily(context),context.fillStyle="black",context.lineWidth=1,context.fillText(this.name,.5,12),context.translate(0,14)),context.lineWidth=.2,context.strokeStyle="#D3D2C2",context.fillStyle="#D3D2C2",context.translate(25,0),context.beginPath(),context.moveTo(0,y0),context.lineTo(canvasWidth,y0),context.stroke(),context.lineWidth=1,context.strokeStyle="white";for(var i=0,numberOfBins=binNumberToOccurences.length;i<numberOfBins;i++){var count=binNumberToOccurences[i];if(count>0){count/=this.total;var start=min+i*binSize,end=start+binSize,x=valueToPosition(start),width=valueToPosition(end)-x,y=countToPosition(count);context.rect(x,y0,width,y-y0),context.fill(),context.stroke()}}context.translate(0,31),context.fillStyle="black",morpheus.HeatMapColorSchemeLegend.drawColorScheme(context,this.colorScheme,canvasWidth,!1,!1,6)}},morpheus.Util.extend(morpheus.HistogramLegend,morpheus.AbstractCanvas),morpheus.LegendWithStops=function(){var _this=this;morpheus.AbstractCanvas.call(this,!1),this.setBounds({width:300,height:40}),$(this.canvas).on("mousedown",function(event){var position=morpheus.CanvasUtil.getMousePos(event.target,event);_this.selectedIndex=_this.findIndexForPosition(position),_this.trigger("selectedIndex",{selectedIndex:_this.selectedIndex})}),this.hammer=morpheus.Util.hammer(this.canvas,["pan"]).on("panmove",this.panmove=function(event){if(-1!==_this.selectedIndex){var position=morpheus.CanvasUtil.getMousePos(event.target,event),fraction=_this.fractionToStopPix.invert(position.x);fraction=Math.max(0,fraction),fraction=Math.min(1,fraction),_this.trigger("moved",{fraction:fraction})}}).on("panstart",this.panstart=function(event){}).on("panend",this.panend=function(event){_this.selectedIndex=-1}),$(this.canvas).on("keydown",function(e){8!=e.which&&46!=e.which||-1===_this.selectedIndex||(_this.trigger("delete"),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())})},morpheus.LegendWithStops.prototype={border:7,stopHalfSize:5,selectedIndex:-1,destroy:function(){$(this.canvas).off("keyup").off("mousedown"),this.hammer.off("panstart",this.panstart).off("panmove",this.panmove),this.hammer.destroy()},setSelectedIndex:function(index){this.selectedIndex=index},findIndexForPosition:function(position){if(position.y>=22)for(var i=0,length=this.fractions.length;i<length;i++){var pix=this.fractionToStopPix(this.fractions[i]),start=pix-this.stopHalfSize,end=pix+this.stopHalfSize;if(position.x>=start&&position.x<=end)return i}return-1},draw:function(fractions,colors,stepped,fractionToStopPix){this.fractions=fractions,this.colors=colors,this.stepped=stepped,this.fractionToStopPix=fractionToStopPix;var context=this.canvas.getContext("2d");morpheus.CanvasUtil.resetTransform(context),context.clearRect(0,0,this.getUnscaledWidth(),this.getUnscaledHeight()),context.translate(this.border,0),morpheus.HeatMapColorSchemeLegend.draw(context,fractions,colors,this.getUnscaledWidth()-2*this.border,this.getUnscaledHeight()-20,stepped),context.translate(-this.border,0),context.lineWidth=1,context.strokeStyle="Grey",context.strokeRect(this.border,0,this.getUnscaledWidth()-2*this.border,this.getUnscaledHeight()-20);for(var i=0;i<fractions.length;i++)if(!(i>0&&fractions[i]===fractions[i-1])){context.fillStyle=colors[i];var pix=fractionToStopPix(fractions[i]);context.fillRect(pix-this.stopHalfSize,22,2*this.stopHalfSize,2*this.stopHalfSize),this.selectedIndex===i?(context.lineWidth=2,context.strokeStyle="black"):(context.lineWidth=1,context.strokeStyle="Grey"),context.strokeRect(pix-this.stopHalfSize,22,2*this.stopHalfSize,2*this.stopHalfSize)}}},morpheus.Util.extend(morpheus.LegendWithStops,morpheus.AbstractCanvas),morpheus.Util.extend(morpheus.LegendWithStops,morpheus.Events),morpheus.HeatMapMenu=function(heatMap){var menuTemplate,isNode=morpheus.Util.isNode(),$menus=$('<div style="display: inline-block;margin-right:14px;"></div>');function createMenu(menuName,actions,minWidth){if(isNode){var submenu=[];actions.forEach(function(name){if(null==name)submenu.push({type:"separator"});else{var action=heatMap.getActionManager().getAction(name);if(null!=action){name=action.name;action.ellipsis&&(name+="...");var accel=null;if(action.which){accel="",action.commandKey&&(accel+="CmdOrCtrl"),action.shiftKey&&(accel.length>0&&(accel+="+"),accel+="Shift"),accel.length>0&&(accel+="+");var key=morpheus.KeyboardCharMap[action.which[0]];"+"===key&&(key="Plus"),accel+=key}submenu.push({accelerator:accel,label:name,click:function(menuItem,browserWindow,event){}})}}}),menuTemplate.push({label:menuName,submenu:submenu})}else{minWidth||(minWidth="0px");var menu=[],dropdownId=_.uniqueId("morpheus");menu.push('<div class="dropdown morpheus-menu">'),menu.push('<a class="dropdown-toggle morpheus-black-link morpheus-black-link-background" type="button" id="'+dropdownId+'" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">'),menu.push(menuName),menu.push("</a>"),menu.push('<ul style="min-width:'+minWidth+';" class="dropdown-menu" aria-labelledby="'+dropdownId+'">'),actions.forEach(function(name){if(null==name)menu.push('<li role="separator" class="divider"></li>');else{var action=heatMap.getActionManager().getAction(name);null!=action&&(menu.push("<li>"),menu.push('<a class="morpheus-menu-item" data-action="'+action.name+'" href="#">'),menu.push(action.name),action.ellipsis&&menu.push("..."),action.icon&&menu.push('<span class="'+action.icon+' morpheus-menu-item-icon"></span> '),action.which&&(menu.push('<span class="pull-right">'),action.commandKey&&menu.push(morpheus.Util.COMMAND_KEY),action.shiftKey&&menu.push("Shift+"),menu.push(morpheus.KeyboardCharMap[action.which[0]]),menu.push("</span>")),menu.push("</a>"),menu.push("</li>"))}}),menu.push("</ul>"),menu.push("</div>"),$(menu.join("")).appendTo($menus)}}heatMap.options.menu&&(heatMap.options.menu.File&&createMenu("File",heatMap.options.menu.File,"240px"),heatMap.options.menu.View&&createMenu("Edit",heatMap.options.menu.Edit),heatMap.options.menu.View&&createMenu("View",heatMap.options.menu.View,"170px"),heatMap.options.menu.Tools&&createMenu("Tools",heatMap.options.menu.Tools),heatMap.options.menu.Help&&createMenu("Help",heatMap.options.menu.Help,"220px")),isNode?("darwin"===global.process.platform&&menuTemplate.unshift({label:"Morpheus",submenu:[{role:"about"},{type:"separator"},{role:"services",submenu:[]},{type:"separator"},{role:"hide"},{role:"hideothers"},{role:"unhide"},{type:"separator"},{role:"quit"}]}),this.applicationMenu=Menu.buildFromTemplate(menuTemplate),morpheus.HeatMapMenu.TAB_MANAGER_LISTENER_ADDED||(morpheus.HeatMapMenu.TAB_MANAGER_LISTENER_ADDED=!0,heatMap.tabManager.on("add change remove",function(e){var activeTab=heatMap.tabManager.getTabObject(heatMap.tabManager.getActiveTabId());if(null==activeTab){var template=[];"darwin"===process.platform&&template.unshift({label:"Morpheus",submenu:[{role:"about"},{role:"quit"}]}),Menu.setApplicationMenu(Menu.buildFromTemplate(template))}else if(null!=activeTab.menu)Menu.setApplicationMenu(activeTab.menu.applicationMenu);else{template=[];"darwin"===process.platform&&template.unshift({label:"Morpheus",submenu:[{role:"about"},{role:"quit"}]}),Menu.setApplicationMenu(Menu.buildFromTemplate(template))}}))):this.applicationMenu=$menus},morpheus.HeatMapMenu.TAB_MANAGER_LISTENER_ADDED=!1,morpheus.Popup={},morpheus.Popup.initted=!1,morpheus.Popup.init=function(){morpheus.Popup.initted||(morpheus.Popup.initted=!0,morpheus.Popup.$popupDiv=$(document.createElement("div")),morpheus.Popup.$popupDiv.css("position","absolute").css("zIndex",1050).css("overflow","auto").addClass("dropdown clearfix"),morpheus.Popup.$contextMenu=$(document.createElement("ul")),morpheus.Popup.$contextMenu.addClass("dropdown-menu").css("display","block").css("position","static").css("margin-bottom","5px"),morpheus.Popup.$contextMenu.appendTo(morpheus.Popup.$popupDiv),morpheus.Popup.$contextMenu.on("click","a",function(e){e.preventDefault();var $this=$(this);morpheus.Popup.popupCallback(e,$this.data("name")),morpheus.Popup.hide()}))},morpheus.Popup.popupInDom=!1,morpheus.Popup.hidePopupMenu=function(e){morpheus.Popup.component==e.target&&(e.preventDefault(),e.stopPropagation()),morpheus.Popup.hide()},morpheus.Popup.hide=function(){morpheus.Popup.$popupDiv.hide(),$(document.body).off("mousedown",morpheus.Popup.hidePopupMenu),morpheus.Popup.popupCallback=null,morpheus.Popup.component=null},morpheus.Popup.showPopup=function(menuItems,position,component,callback){if(morpheus.Popup.init(),morpheus.Popup.component!=component){morpheus.Popup.popupCallback=callback,morpheus.Popup.component=component;for(var html=[],i=0,length=menuItems.length;i<length;i++){var item=menuItems[i];item.header?html.push('<li role="presentation" class="dropdown-header">'+item.name+"</li>"):item.separator?html.push('<li class="divider"></li>'):(html.push('<li role="presentation"'),item.disabled&&html.push('class="disabled"'),html.push('><a data-name="'+item.name+'" data-type="popup-item" tabindex="-1" href="#"'),item.class&&html.push(' class="'+item.class+'"'),html.push(">"),item.checked&&html.push('<span class="dropdown-checkbox fa fa-check"></span>'),html.push(item.name),item.icon&&html.push('<span class="pull-right '+item.icon+'"></span>'),html.push("</a>"),html.push("</li>"))}morpheus.Popup.$contextMenu.html(html.join("")),morpheus.Popup.popupInDom||(morpheus.Popup.popupInDom=!0,morpheus.Popup.$popupDiv.appendTo($(document.body)));var $body=$(document.body),$window=$(window),windowWidth=$window.width(),windowHeight=$window.height(),popupWidth=morpheus.Popup.$popupDiv.width(),popupHeight=morpheus.Popup.$popupDiv.height(),left=position.x,top=position.y;left+popupWidth>=windowWidth&&(left-=popupWidth,left=Math.max(4,left)),top+popupHeight>=windowHeight&&(top-=popupHeight,top=Math.max(4,top)),morpheus.Popup.$popupDiv.css({display:"block",left:left,top:top}),morpheus.Popup.$popupDiv.show(),$body.off("mousedown",morpheus.Popup.hidePopupMenu),window.setTimeout(function(){$body.on("mousedown",function(e){var $target=$(e.target);$target[0]!==morpheus.Popup.$popupDiv[0]&&"popup-item"!==$target.data("type")&&morpheus.Popup.hidePopupMenu(e)})},1)}else morpheus.Popup.hide()},morpheus.RowDendrogram=function(heatMap,tree,positions,project){morpheus.AbstractDendrogram.call(this,heatMap,tree,positions,project,morpheus.AbstractDendrogram.Type.ROW)},morpheus.RowDendrogram.prototype={drawNode:function(context,node){var radius=this.getNodeRadius(node),pix=this.toPix(node);context.beginPath(),context.arc(pix[0],pix[1],radius,2*Math.PI,!1),context.fill()},isDragHotSpot:function(p){return Math.abs(this.scale(this.cutHeight)-p.x)<=2},drawCutSlider:function(clip,context){context.setLineDash&&context.setLineDash([5]),context.strokeStyle="black";var nx=this.scale(this.cutHeight);context.beginPath(),context.moveTo(nx,clip.y),context.lineTo(nx,this.getUnscaledHeight()),context.stroke(),context.setLineDash&&context.setLineDash([])},getPreferredSize:function(){return{width:100,height:Math.ceil(this.positions.getPosition(this.positions.getLength()-1)+this.positions.getItemSize(this.positions.getLength()-1))}},paintMouseOver:function(clip,context){-1!==this.project.getHoverRowIndex()&&(morpheus.CanvasUtil.resetTransform(context),context.translate(0,-clip.y),this.drawRowBorder(context,this.positions,this.project.getHoverRowIndex(),this.getUnscaledWidth()))},drawRowBorder:function(context,positions,index,gridSize){var size=positions.getItemSize(index),pix=positions.getPosition(index);context.beginPath(),context.moveTo(0,pix+size),context.lineTo(gridSize,pix+size),context.stroke(),context.beginPath(),context.moveTo(0,pix),context.lineTo(gridSize,pix),context.stroke()},createScale:function(){return d3.scale.linear().domain([0,this.tree.maxHeight]).range([this.getUnscaledWidth(),0])},getMaxIndex:function(clip){return morpheus.Positions.getBottom(clip,this.positions)},getMinIndex:function(clip){return morpheus.Positions.getTop(clip,this.positions)},toPix:function(node){var min=this.positions.getPosition(node.minIndex)+this.positions.getItemSize(node.minIndex)/2,max=this.positions.getPosition(node.maxIndex)+this.positions.getItemSize(node.maxIndex)/2;return[this.scale(node.height),(min+max)/2]},drawPathFromNodeToParent:function(context,node){var pix=this.toPix(node),parentPix=this.toPix(node.parent);context.beginPath(),context.moveTo(pix[0],pix[1]),context.lineTo(parentPix[0],pix[1]),context.lineTo(parentPix[0],parentPix[1]),context.stroke()},drawNodePath:function(context,node,minIndex,maxIndex){var x,y,children=node.children,left=children[0],right=children[1],ry=this.toPix(right)[1],rx=this.scale(right.height),ly=this.toPix(left)[1],lx=this.scale(left.height),nx=this.scale(node.height);if(this.drawLeafNodes)x=[rx,nx,nx,lx],y=[ry,ry,ly,ly];else{var leftIsLeaf=void 0!==left.children,rightIsLeaf=void 0!==right.children;leftIsLeaf&&(lx=nx+4),rightIsLeaf&&(rx=nx+4),x=[rx,nx,nx,lx],y=[ry,ry,ly,ly]}context.beginPath(),context.moveTo(x[0],y[0]);for(var i=1,length=x.length;i<length;i++)context.lineTo(x[i],y[i]);context.stroke()}},morpheus.Util.extend(morpheus.RowDendrogram,morpheus.AbstractDendrogram),morpheus.ScentedSearch=function(model,positions,isVertical,scrollbar,heatMap){morpheus.AbstractCanvas.call(this,!1),this.model=model,this.positions=positions,this.isVertical=isVertical,this.scrollbar=scrollbar,this.heatMap=heatMap,this.searchIndices=[],scrollbar.decorator=this;var _this=this;$(scrollbar.canvas).on("mousemove.morpheus",function(e){var indices=_this.getSearchIndices(e);document.body.style.cursor=0===indices.length?"default":"pointer",scrollbar.canvas.style.cursor=0===indices.length?"default":"pointer";var tipOptions={event:e,heatMapLens:indices.length>=0};isVertical?heatMap.setToolTip(indices.length>=0?indices:null,-1,tipOptions):heatMap.setToolTip(-1,indices.length>=0?indices:null,tipOptions)}).on("mouseout.morpheus",function(e){document.body.style.cursor="default",scrollbar.canvas.style.cursor="default",heatMap.setToolTip(-1,-1,{event:e})})},morpheus.ScentedSearch.LINE_HEIGHT=3.5,morpheus.ScentedSearch.prototype={mouseMovedIndex:-1,getIndex:function(event){var val=morpheus.CanvasUtil.getMousePos(event.target,event)[this.isVertical?"y":"x"];return this.getIndexForPix(val)},getSearchIndices:function(event){var val=morpheus.CanvasUtil.getMousePos(event.target,event)[this.isVertical?"y":"x"];return this.getSearchIndicesForPix(val)},getSearchIndicesForPix:function(pix){var indices=this.searchIndices;if(null==indices)return[];for(var scale=this.scale,tolerance=morpheus.ScentedSearch.LINE_HEIGHT,matches=[],i=0,length=indices.length;i<length;i++){var midVal=this.positions.getPosition(indices[i])*scale;Math.abs(midVal-pix)<=tolerance&&matches.push(indices[i])}return matches},getIndexForPix:function(pix){var indices=this.searchIndices;if(null==indices)return-1;var tolerance=morpheus.ScentedSearch.LINE_HEIGHT;if(this.mouseMovedIndex>0){var midVal=this.positions.getPosition(indices[this.mouseMovedIndex])*scale;if(Math.abs(midVal-pix)<=tolerance)return this.mouseMovedIndex}for(var low=0,scale=this.scale,high=indices.length-1;low<=high;){var mid=low+high>>1,cmp=(midVal=this.positions.getPosition(indices[mid])*scale,0);if(Math.abs(midVal-pix)<=tolerance?cmp=0:midVal<pix?cmp=-1:midVal>pix&&(cmp=1),cmp<0)low=mid+1;else{if(!(cmp>0))return mid;high=mid-1}}return-1},tap:function(position){var val=position[this.isVertical?"y":"x"],index=this.getIndexForPix(val);return this.scrollbar.canvas.style.cursor=index<0?"default":"pointer",index>=0&&(this.isVertical?this.heatMap.scrollTop(this.positions.getPosition(this.searchIndices[index])):this.heatMap.scrollLeft(this.positions.getPosition(this.searchIndices[index])),!0)},update:function(){this.searchIndices=this.model.getViewIndices().values().sort(function(a,b){return a<b?-1:1})},draw:function(clip,context){var width=this.scrollbar.getUnscaledWidth(),height=this.scrollbar.getUnscaledHeight(),availableLength=(this.isVertical?height:width)-morpheus.ScentedSearch.LINE_HEIGHT;this.scale=availableLength/(this.positions.getPosition(this.positions.getLength()-1)+this.positions.getItemSize(this.positions.getLength()-1)),context.fillStyle=morpheus.ScentedSearch.TICK_COLOR,context.lineWidth=1,this.drawIndices(context,this.searchIndices),this.drawHoverMatchingValues(context)},drawHoverMatchingValues:function(context){var heatmap=this.heatMap;if(context.fillStyle=morpheus.ScentedSearch.MATCHING_VALUES_TICK_COLOR,heatmap.mousePositionOptions&&null!=heatmap.mousePositionOptions.name){var isColumns=!this.isVertical,track=heatmap.getTrack(heatmap.mousePositionOptions.name,isColumns);if(null==track)return;if(track.settings.highlightMatchingValues){var hoverIndex=isColumns?heatmap.getProject().getHoverColumnIndex():heatmap.getProject().getHoverRowIndex();if(-1===hoverIndex)return;var value=track.getVector().getValue(hoverIndex),valueToModelIndices=track.getFullVector().getProperties().get(morpheus.VectorKeys.VALUE_TO_INDICES);if(!valueToModelIndices){var fullVector=track.getFullVector();valueToModelIndices=morpheus.VectorUtil.createValueToIndicesMap(fullVector),fullVector.getProperties().set(morpheus.VectorKeys.VALUE_TO_INDICES,valueToModelIndices)}var modelIndices=valueToModelIndices.get(value);if(null==modelIndices)return void console.log("valueToModelIndices error");for(var scale=this.scale,lineLength=this.isVertical?this.scrollbar.getUnscaledWidth():this.scrollbar.getUnscaledHeight(),isVertical=this.isVertical,positions=this.positions,project=heatmap.getProject(),i=0,length=modelIndices.length;i<length;i++){var modelIndex=modelIndices[i],index=isVertical?project.convertModelRowIndexToView(modelIndex):project.convertModelColumnIndexToView(modelIndex);if(-1!==index){var pix=positions.getPosition(index)*scale;isVertical?context.fillRect(0,pix,lineLength,morpheus.ScentedSearch.LINE_HEIGHT):context.fillRect(pix,0,morpheus.ScentedSearch.LINE_HEIGHT,lineLength)}}}}},drawIndices:function(context,highlightedIndices){for(var scale=this.scale,lineLength=this.isVertical?this.scrollbar.getUnscaledWidth():this.scrollbar.getUnscaledHeight(),isVertical=this.isVertical,positions=this.positions,i=0,length=highlightedIndices.length;i<length;i++){var index=highlightedIndices[i],pix=positions.getPosition(index)*scale;isVertical?(context.beginPath(),context.rect(0,pix,lineLength,morpheus.ScentedSearch.LINE_HEIGHT),context.fill()):(context.beginPath(),context.rect(pix,0,morpheus.ScentedSearch.LINE_HEIGHT,lineLength),context.fill())}}},morpheus.Util.extend(morpheus.ScentedSearch,morpheus.AbstractCanvas),morpheus.ScentedSearch.MATCHING_VALUES_TICK_COLOR="black",morpheus.ScentedSearch.TICK_COLOR="#3182bd",morpheus.ScrollBar=function(isVertical){morpheus.AbstractCanvas.call(this),this.isVertical=isVertical,$(this.canvas).css("border","1px solid #d8d8d8"),isVertical?this.setBounds({width:12}):this.setBounds({height:12}),this.field=this.isVertical?"y":"x";var that=this,mouseMove=function(event){if(!morpheus.CanvasUtil.dragging){var position=morpheus.CanvasUtil.getMousePos(event.target,event,!0),mouseOver=position[that.field]>=that.thumbPos&&position[that.field]<=that.thumbPos+that.thumbExtent;that.thumbMouseOver!==mouseOver&&(that.thumbMouseOver=mouseOver,that.repaint())}};$(this.canvas).on("mousemove",mouseMove).on("mouseout",function(e){!morpheus.CanvasUtil.dragging&&that.thumbMouseOver&&(that.thumbMouseOver=!1,that.repaint())}).on("mouseenter",mouseMove),this.hammer=morpheus.Util.hammer(this.canvas,[this.isVertical?"panv":"panh","tap"]).on("panstart",this.panstart=function(event){var position=morpheus.CanvasUtil.getMousePos(event.target,event,!0);position[that.field]>=that.thumbPos&&position[that.field]<=that.thumbPos+that.thumbExtent?(that.draggingThumb=!0,that.dragStartThumbPos=that.thumbPos):that.draggingThumb=!1}).on("panend",this.panend=function(event){that.draggingThumb=!1}).on("panmove",this.panmove=function(event){if(that.draggingThumb){morpheus.CanvasUtil.getMousePos(event.target,event);var value=(that.dragStartThumbPos+(that.isVertical?event.deltaY:event.deltaX))/(that.visibleExtent-that.thumbExtent)*that.maxValue;that.setValue(value,!0),event.preventDefault(),event.srcEvent.stopPropagation(),event.srcEvent.stopImmediatePropagation()}}).on("tap doubletap",this.tap=function(event){if(!that.draggingThumb){var position=morpheus.CanvasUtil.getMousePos(event.target,event);if(!that.decorator.tap(position)){var thumbExtentToValue=that.thumbExtent/that.totalExtent*that.totalExtent;that.scrollToTop=position[that.field]<that.thumbPos,that.setValue(that.scrollToTop?that.value-thumbExtentToValue:that.value+thumbExtentToValue,!0)}}})},morpheus.ScrollBar.prototype={thumbPos:0,thumbExtent:0,extent:0,value:0,maxValue:0,totalExtent:0,visibleExtent:0,dragStartThumbPos:0,draggingThumb:!1,thumbMouseOver:!1,dispose:function(){morpheus.AbstractCanvas.prototype.dispose.call(this),this.hammer.off("panend",this.panend).off("panstart",this.panstart).off("panmove",this.panmove).off("tap",this.tap).off("doubletap",this.tap),this.hammer.destroy()},draw:function(clip,context){var width=this.getUnscaledWidth(),height=this.getUnscaledHeight();this.visibleExtent===this.totalExtent?context.clearRect(0,0,width,height):(context.fillStyle="rgb(241,241,241)",context.fillRect(0,0,width,height),context.fillStyle=this.thumbMouseOver?"rgb(100,100,100)":"rgb(137,137,137)",this.isVertical?context.fillRect(0,this.thumbPos,width,this.thumbExtent):context.fillRect(this.thumbPos,0,this.thumbExtent,height)),this.decorator.draw(clip,context)},setThumbPosFromValue:function(){var f=0==this.maxValue?0:this.value/this.maxValue;this.thumbPos=f*(this.visibleExtent-this.thumbExtent),this.thumbPos=Math.max(0,this.thumbPos)},getValue:function(){return this.value},getMaxValue:function(){return this.maxValue},setValue:function(value,trigger){return isNaN(value)&&(value=0),this.visibleExtent===this.totalExtent&&(value=0),value=Math.max(value,0),value=Math.min(this.maxValue,value),this.value=value,this.setThumbPosFromValue(),trigger&&(this.trigger("scroll",{value:this.value}),this.repaint()),this.value},setTotalExtent:function(totalExtent){this.totalExtent=totalExtent,this._setRange()},getTotalExtent:function(){return this.totalExtent},getVisibleExtent:function(){return this.visibleExtent},_setRange:function(){this.thumbExtent=Math.max(10,this.visibleExtent*(this.visibleExtent/this.totalExtent)),this.maxValue=this.totalExtent-this.visibleExtent,this.maxValue=Math.max(0,this.maxValue),this.isVertical?this.setBounds({height:this.visibleExtent}):this.setBounds({width:this.visibleExtent})},setExtent:function(visibleExtent,totalExtent,value){this.visibleExtent=visibleExtent,this.totalExtent=totalExtent,this._setRange(),this.setValue(value,!1)}},morpheus.Util.extend(morpheus.ScrollBar,morpheus.AbstractCanvas),morpheus.Util.extend(morpheus.ScrollBar,morpheus.Events),morpheus.ShapeChooser=function(options){var formBuilder=new morpheus.FormBuilder,map=options.map,html=['<select name="valuePicker" class="selectpicker" data-live-search="true">'];map.forEach(function(val,key){html.push("<option"),html.push(' value="'),html.push(key),html.push('">'),html.push(key),html.push("</option>")}),html.push("</select>"),formBuilder.append({name:"selected_value",type:"custom",value:html.join("")});var shapeField=new morpheus.ShapeField({showNone:!0});formBuilder.append({style:"max-width:50px;",name:"selected_shape",type:"custom",value:'<div data-name="shape"></div>'}),shapeField.$el.appendTo(formBuilder.$form.find("[data-name=shape]"));var $valuePicker=formBuilder.$form.find("[name=valuePicker]"),selectedVal=$valuePicker.val(),_this=this;shapeField.setShapeValue(map.get(selectedVal)),shapeField.on("change",function(e){map.set(selectedVal,e.shape),_this.trigger("change",{value:selectedVal,shape:e.shape})}),$valuePicker.selectpicker().change(function(){selectedVal=$valuePicker.val(),shapeField.setShapeValue(map.get(selectedVal))}),this.$div=formBuilder.$form},morpheus.ShapeChooser.prototype={},morpheus.Util.extend(morpheus.ShapeChooser,morpheus.Events),morpheus.ShapeField=function(options){var shapes=options.shapes||morpheus.VectorShapeModel.SHAPES,_this=this,html=[];html.push('<div style="margin-bottom:1em;" class="btn-group">'),html.push('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><span data-name="selection"></span> <span class="fa fa-caret-down"></span></button>'),html.push('<ul class="dropdown-menu" role="menu">'),options.showNone&&html.push('<li><a data-name="none" href="#">(None)</a></li>');for(var i=0;i<shapes.length;i++){var context=new C2S(16,16);context.translate(4,4),morpheus.CanvasUtil.drawShape(context,shapes[i],4,4,8);var svg=context.getSerializedSvg();html.push('<li><a data-name="'+shapes[i]+'" href="#">'+svg+"</a></li>")}html.push("</ul></div>");var $el=$(html.join("")),$header=$el.find("[data-name=selection]");$el.on("click","li > a",function(e){e.preventDefault();var shape=$(this).data("name");setShapeValue(shape),_this.trigger("change",{shape:shape})});var setShapeValue=function(val){if("none"===val)$header.html("(None)");else{var context=new C2S(16,16);context.translate(4,4),morpheus.CanvasUtil.drawShape(context,val,4,4,8),$header.html(context.getSerializedSvg())}};this.setShapeValue=setShapeValue,this.$el=$el},morpheus.ShapeField.prototype={},morpheus.Util.extend(morpheus.ShapeField,morpheus.Events),morpheus.SortByValuesIndicator=function(project,isVertical,positions){morpheus.AbstractCanvas.call(this,!0),this.project=project,this.isVertical=isVertical,this.positions=positions,this.lastPosition={start:-1,end:-1}},morpheus.SortByValuesIndicator.prototype={prePaint:function(clip,context){var positions=this.positions,start=0,end=positions.getLength();this.isVertical?(start=morpheus.Positions.getTop(clip,positions),end=morpheus.Positions.getBottom(clip,positions)):(start=morpheus.Positions.getLeft(clip,positions),end=morpheus.Positions.getRight(clip,positions)),(this.invalid||start!==this.lastPosition.start||end!==this.lastPosition.end)&&(this.lastPosition.start=start,this.lastPosition.end=end,this.invalid=!0)},draw:function(clip,context){var project=this.project,isVertical=this.isVertical,positions=this.positions,sortKeys=isVertical?project.getColumnSortKeys():project.getRowSortKeys();context.translate(-clip.x,-clip.y),context.fillStyle="black",context.textBaseline="top",context.textAlign="left",context.font="8px "+morpheus.CanvasUtil.getFontFamily(context);var start=0,end=positions.getLength();isVertical?(start=morpheus.Positions.getTop(clip,positions),end=morpheus.Positions.getBottom(clip,positions)):(start=morpheus.Positions.getLeft(clip,positions),end=morpheus.Positions.getRight(clip,positions));for(var i=0;i<sortKeys.length;i++){var key=sortKeys[i];if(key instanceof morpheus.SortByValuesKey)for(var modelIndices=key.modelIndices,j=0;j<modelIndices.length;j++){var modelIndex=modelIndices[j],view=isVertical?project.convertModelRowIndexToView(modelIndex):project.convertModelColumnIndexToView(modelIndex);if(-1!==view&&view>=start&&view<end){context.save();var pix=positions.getPosition(view),size=positions.getItemSize(view);isVertical?context.translate(2,pix+size/2):context.translate(pix+size/2,0),context.beginPath(),key.getSortOrder()===morpheus.SortKey.SortOrder.ASCENDING?(context.moveTo(0,0),context.lineTo(3,4),context.lineTo(-3,4)):key.getSortOrder()===morpheus.SortKey.SortOrder.DESCENDING?(context.moveTo(0,4),context.lineTo(3,0),context.lineTo(-3,0)):(context.moveTo(0,0),context.lineTo(3,2),context.lineTo(0,4),context.lineTo(-3,2)),context.fill(),context.restore()}}}}},morpheus.Util.extend(morpheus.SortByValuesIndicator,morpheus.AbstractCanvas),morpheus.SortDialog=function(project){var _this=this,$chooserDiv=$('<div class="container-fluid"></div>'),$div=$('<div class="container-fluid"></div>'),html=[];function toggle(isColumns){_this.isColumns=isColumns;var $element=_this.build(project,isColumns);$div.empty().html($element),$div.on("click","[data-name=delete]",function(e){var $this=$(this);e.preventDefault(),$this.closest("div.row").remove()}),$div.on("click","[data-name=add]",function(e){var level=[],$sibling=$(this).closest("div.row");_this.createLevel(level,new morpheus.SortKey("",morpheus.SortKey.SortOrder.ASCENDING),_this.fields),$sibling.after($(level.join(""))),e.preventDefault()})}html.push('<div style="border-bottom:1px solid LightGrey;margin-bottom:20px;" class="row">'),html.push('<form class="form-horizontal" role="form">'),html.push('<div class="col-xs-2"><label class="control-label">Sort</label></div>'),html.push('<div class="col-xs-5">'),html.push('<div class="radio"><label><input type="radio" name="rowsOrColumns" value="rows" checked>Rows</label></div>'),html.push('<div class="radio"><label><input type="radio" name="rowsOrColumns" value="columns">Columns</label></div>'),html.push("</div>"),html.push("</form>"),html.push("</div>"),$chooserDiv.html(html.join("")),$chooserDiv.on("change","[name=rowsOrColumns]",function(e){toggle("columns"===$(this).val())}),toggle(!1);var $outer=$("<div></div>");$chooserDiv.appendTo($outer),$div.appendTo($outer),morpheus.FormBuilder.showOkCancel({title:"Sort",content:$outer,okCallback:function(){for(var $forms=$div.find("form"),sortBy=$forms.find("[name=sortBy]").map(function(){return $(this).val()}),lockOrder=$forms.find("[name=lockOrder]").map(function(){return $(this).prop("checked")}),sortOrder=$forms.find("[name=sortOrder]:checked").map(function(){return $(this).val()}),groupBy=$div.find("[name=groupBy]").val(),newSortKeys=[],modelIndices=_this.isColumns?project.getRowSelectionModel().toModelIndices():project.getColumnSelectionModel().toModelIndices(),existingSortKeys=_this.isColumns?project.getColumnSortKeys():project.getRowSortKeys(),i=0;i<existingSortKeys.length;i++)existingSortKeys[i].isUnlockable()&&(existingSortKeys.splice(i,1),i--);var newSortKeyFields=new morpheus.Set;for(i=0;i<sortBy.length;i++)if(!newSortKeyFields.has(sortBy[i])){newSortKeyFields.add(sortBy[i]);var key=null;"selection"===sortBy[i]?key=new morpheus.SortByValuesKey(modelIndices,sortOrder[i],_this.isColumns):""!==sortBy[i]&&(key=new morpheus.SortKey(sortBy[i],sortOrder[i])),null!=key&&(newSortKeys.push(key),lockOrder[i]&&key.setLockOrder(1))}var newGroupKeys=[];if(null!=groupBy)for(i=0;i<groupBy.length;i++)newGroupKeys.push(new morpheus.SortKey(groupBy[i],morpheus.SortKey.SortOrder.UNSORTED));_this.isColumns?(project.setGroupColumns(newGroupKeys,!0),project.setColumnSortKeys(morpheus.SortKey.keepExistingSortKeys(newSortKeys,existingSortKeys),!0)):(project.setGroupRows(newGroupKeys,!0),project.setRowSortKeys(morpheus.SortKey.keepExistingSortKeys(newSortKeys,existingSortKeys),!0))}})},morpheus.SortDialog.prototype={isColumns:!1,build:function(project,isColumns){var fields=morpheus.MetadataUtil.getMetadataNames(isColumns?project.getFullDataset().getColumnMetadata():project.getFullDataset().getRowMetadata());this.fields=fields;var html=[],sortKeys=isColumns?project.getColumnSortKeys():project.getRowSortKeys();this.createLevel0(html);for(var i=0;i<sortKeys.length;i++)sortKeys[i].isUnlockable()&&this.createLevel(html,sortKeys[i],fields);html.push('<div class="row">'),html.push('<form class="form-horizontal" role="form">'),html.push('<div class="col-xs-2"><label>Group by</label></div>'),html.push('<div class="col-xs-4">');var groupByKeys=(isColumns?project.getGroupColumns():project.getGroupRows()).map(function(key){return key.field});html.push('<select multiple name="groupBy" class="selectpicker form-control">'),_.each(fields,function(field){html.push('<option value="'+field+'"'),-1!==_.indexOf(groupByKeys,field)&&html.push(" selected"),html.push(">"),html.push(field),html.push("</option>")}),html.push("</select>"),html.push("</div>"),html.push("</div>");var $div=$(html.join(""));return $div.find(".selectpicker").selectpicker({iconBase:"fa",tickIcon:"fa-check",style:"btn-default btn-sm"}),$div},createLevel0:function(html){html.push('<div style="border-bottom:1px solid LightGrey;margin-bottom:20px;" class="row">'),html.push('<form class="form-horizontal" role="form">'),html.push('<div class="col-xs-8">'),html.push('<a data-name="add" href="#">Add sort level</a>'),html.push("</div>"),html.push("</form>"),html.push("</div>")},createLevel:function(html,key,fields){html.push('<div style="border-bottom:1px solid LightGrey;margin-bottom:20px;" class="row">'),html.push('<form class="form-horizontal" role="form">'),html.push('<div class="col-xs-2"><label class="control-label">Sort by</label></div>'),html.push('<div class="col-xs-4">'),html.push('<select name="sortBy" class="form-control">'),html.push('<option value=""></option>'),html.push('<option value="selection"'+(key instanceof morpheus.SortByValuesKey?" selected":"")+">selection</option>"),_.each(fields,function(field){html.push('<option value="'+field+'"'),field==key.toString()&&html.push(" selected"),html.push(">"),html.push(field),html.push("</option>")}),html.push("</select>"),html.push("</div>"),html.push('<div class="col-xs-5">'),html.push('<div class="radio"><label><input type="radio" name="sortOrder" value="ascending"'+(morpheus.SortKey.SortOrder.ASCENDING==key.getSortOrder()?" checked":"")+">Ascending</label></div>"),html.push('<div class="radio"><label><input type="radio" name="sortOrder" value="descending"'+(morpheus.SortKey.SortOrder.DESCENDING==key.getSortOrder()?" checked":"")+">Descending</label></div>"),html.push("</div>"),html.push('<div class="col-xs-1">'),html.push('<a data-name="delete">Delete</a>'),html.push("</div>"),html.push('<div class="col-xs-12">'),html.push('<div class="checkbox"><label><input name="lockOrder" type="checkbox"'+(0!==key.getLockOrder()?" checked":"")+"> Lock sort level</label></div>"),html.push("</div>"),html.push('<div class="col-xs-12">'),html.push("<br />"),html.push('<a data-name="add" href="#">Add sort level</a>'),html.push("</div>"),html.push("</form>"),html.push("</div>")}},morpheus.SteppedColorSupplier=function(){morpheus.AbstractColorSupplier.call(this),this.hiddenValue=0,this.hiddenValues=new morpheus.Set,this.stepped=!0},morpheus.SteppedColorSupplier.linearScale=function(value,input0,input1,pix0,pix1){return(value-input0)/(input1-input0)*(pix1-pix0)+pix0},morpheus.SteppedColorSupplier.prototype={createInstance:function(){return new morpheus.SteppedColorSupplier},isStepped:function(){return!0},getHiddenValues:function(){return this.hiddenValues},getIndexForFraction:function(f){var fractions=this.fractions;if(f<=fractions[0])return 0;if(f>=fractions[fractions.length-1])return fractions.length-1;for(var i=0;i<fractions.length-1;i++){var left=fractions[i],right=fractions[i+1];if(f>=left&&f<right)return i}return fractions.length-1},getColor:function(row,column,value){if(this.hiddenValues.has(value)&&(value=this.hiddenValue),isNaN(value))return this.missingColor;var min=this.min,max=this.max,colors=this.colors;if(value<=min)return colors[0];if(value>=max)return colors[colors.length-1];var fraction=morpheus.SteppedColorSupplier.linearScale(value,min,max,0,100)/100;return colors[this.getIndexForFraction(fraction)]}},morpheus.Util.extend(morpheus.SteppedColorSupplier,morpheus.AbstractColorSupplier),morpheus.TabManager=function(options){this.options=$.extend({},{autohideTabBar:!1,rename:!0},options);var _this=this;if(this.activeTabObject=null,this.activeTabId=null,this.idToTabObject=new morpheus.Map,this.$nav=$('<ul class="nav nav-tabs compact morpheus-nav"></ul>'),this.$nav.sortable({containment:"parent",axis:"x",helper:"clone",cancel:"li:not(.morpheus-sortable)",items:"li.morpheus-sortable"}),this.$nav.sortable("disable"),this.$nav.on("click","li > a",function(e){var tabId=$(this).data("link");null!=tabId&&(e.preventDefault(),_this.activeTabId!==tabId&&$(this).tab("show"))}),this.options.autohideTabBar&&this.$nav.css("display","none"),options.dropTab){var html=[];html.push('<li class="morpheus-tab-addon dropdown pull-right tabdrop">'),html.push('<div class="btn-group">'),html.push('<button type="button" class="morpheus-drop-tab-toggle btn btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),html.push(' <span class="fa fa-angle-double-down"></span>'),html.push("</button>"),html.push('<ul class="dropdown-menu dropdown-menu-right" role="menu">'),html.push("</ul>"),html.push("</div>"),html.push("</li>");var $tabDrop=$(html.join("")),$tabDropMenu=$tabDrop.find(".dropdown-menu");$tabDrop.appendTo(this.$nav);var updateDropTab=function(){var totalWith=_this.$nav.width()-17,sum=0,tabDropItems=[];_this.$nav.find("> li").each(function(){var $li=$(this),$a=$li.find("a");if(!$li.hasClass("morpheus-tab-addon")){var title=$a.contents().first().text(),isActive=$li.hasClass("active"),href=$a.attr("href");tabDropItems.push('<li class="'+(isActive?"active":"")+'"><a data-link="'+href.substring(1)+'" data-toggle="tab" href="'+href+'">'+title+"</a></li>"),(sum+=$li.outerWidth())>=totalWith?$li.css("display","none"):$li.css("display","")}}),$tabDrop.css("display",tabDropItems.length>0?"":"none"),$tabDropMenu.html(tabDropItems.join(""))};$tabDrop.css("display","none"),this.$nav.on("sortstop",function(event,ui){updateDropTab()}),$(window).on("resize",updateDropTab),this.$nav.on("remove",function(){$(window).off("resize",updateDropTab)}),this.on("add remove rename reorder change",function(){updateDropTab()})}this.$nav.on("dblclick","li > a",function(e){e.preventDefault();var $a=$(this);$a.parent("li").hasClass("morpheus-tab-addon")||_this.rename($a.data("link"))}),this.$nav.on("contextmenu.morpheus","li > a",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var $a=$(this),$li=$a.parent("li");if(!$li.hasClass("morpheus-tab-addon")){var menuItems=[];return $a.data("morpheus-rename")&&_this.options.rename&&menuItems.push({name:"Rename"}),$a.data("morpheus-pin")?menuItems.push({name:"Unpin tab"}):menuItems.push({name:"Pin tab"}),menuItems.length>0&&morpheus.Popup.showPopup(menuItems,{x:e.pageX,y:e.pageY},e.target,function(event,item){"Rename"===item?_this.rename($a.data("link")):"Pin tab"===item?($a.data("morpheus-pin",!0),$li.removeClass("morpheus-sortable"),$li.detach(),_this.$nav.prepend($li),$a.find(".close").hide(),_this.$nav.sortable("option","items","li.morpheus-sortable"),_this.$nav.sortable("refresh")):"Unpin tab"===item&&($a.data("morpheus-pin",!1),$li.addClass("morpheus-sortable"),$a.find(".close").show(),_this.$nav.sortable("option","items","li.morpheus-sortable"),_this.$nav.sortable("refresh"))}),!1}}),this.$nav.on("click","button",function(e){e.preventDefault();var target=$(this).attr("data-target");null!=target&&(target=target.substring(1),_this.remove(target))}),this.$tabContent=$('<div class="tab-content"></div>'),this.$nav.on("shown.bs.tab",'a[data-toggle="tab"]',function(e){var previous=_this.activeTabId;_this.activeTabId=$(e.target).data("link"),_this.activeTabObject=_this.idToTabObject.get(_this.activeTabId),_this.$nav.find("li").removeClass("active"),_this.$nav.find("[data-link="+_this.activeTabId+"]").each(function(){$(this).parent().addClass("active")});var scrollTop=document.body.scrollTop;$("#"+_this.activeTabId).focus(),document.body.scrollTop=scrollTop,_this.adding||_this.trigger("change",{tab:_this.activeTabId,previous:previous})})},morpheus.TabManager.prototype={getTabText:function(id){return this.$nav.find("> li > a").filter("a[data-link="+id+"]").contents().first().text().trim()},getTabItems:function(){var items=[];this.$nav.find("> li > a").each(function(){var $this=$(this),text=$this.contents().first().text().trim(),id=$this.data("link"),title=$this.attr("title");items.push({id:id,text:text,title:title})});return items},getTabCount:function(){return this.idToTabObject.size()},setTabText:function(id,text){this.$nav.find("> li > a").filter("[data-link="+id+"]").contents().first().replaceWith(text+"&nbsp;"),this.idToTabObject.get(id).setName(name)},addTask:function(task){},removeTask:function(task){},getWidth:function(){return this.$tabContent.outerWidth()||$(window).width()},getActiveTab:function(){return this.activeTabObject},getActiveTabId:function(){return this.activeTabId},add:function(options){this.adding=!0;var id=_.uniqueId("morpheus-tab");this.idToTabObject.set(id,options.object);var li=[];li.push('<li class="morpheus-sortable" role="presentation">'),li.push('<a data-morpheus-rename="'+options.rename+'" data-toggle="tab" data-link="'+id+'" href="#'+id+'">'),li.push(options.title),li.push('&nbsp;<i style="color:black;"></i>'),options.closeable&&li.push('&nbsp<button style="font-size: 18px;" type="button" class="close" aria-label="Close" data-target="#'+id+'"><span aria-hidden="true"></span></button>'),li.push("</a></li>");var $link=$(li.join(""));$link.appendTo(this.$nav);var $panel=$('<div tabIndex="0" style="outline:0;cursor:default;" role="tabpanel" class="tab-pane" id="'+id+'"></div>');return options.$el.appendTo($panel),$panel.appendTo(this.$tabContent),!1===options.enabled&&($link.addClass("disabled"),$link.find("a").addClass("btn disabled")),options.focus&&(this.$nav.find('> li > a[data-toggle="tab"]:last').tab("show"),this.activeTabId=id,this.activeTabObject=options.object,$panel.focus()),this.options.autohideTabBar&&this.$nav.css("display",this.idToTabObject.size()>1?"":"none"),this.getTabCount()<=1?this.$nav.sortable("disable"):this.$nav.sortable("enable"),this.adding=!1,this.trigger("add"),{$panel:$panel,id:id}},appendTo:function($target){this.$nav.appendTo($target),this.$tabContent.appendTo($target)},remove:function(target){void 0===target&&(target=this.activeTabId);var obj=this.idToTabObject.remove(target);$("#"+target).remove(),this.activeTabObject=null,this._getA(target).parent().remove(),this.$tabContent.find(target).remove();var $a=this.$nav.find('> li > a[data-toggle="tab"]:last');0===$a.length&&this.options.landingPage&&("function"==typeof this.options.landingPage?this.options.landingPage().show():this.options.landingPage.show()),$a.tab("show"),this.options.autohideTabBar&&this.$nav.css("display",this.idToTabObject.size()>1?"":"none"),this.getTabCount()<=1?this.$nav.sortable("disable"):this.$nav.sortable("enable"),this.idToTabObject.size()>0&&$($a.attr("href")).focus(),null!=obj&&obj.onRemove&&obj.onRemove(),this.trigger("remove",{tab:target})},setOptions:function(options){this.options=options,this.options.autohideTabBar&&this.$nav.css("display",this.idToTabObject.size()>1?"":"none")},getOptions:function(){return this.options},setActiveTab:function(id){if(id!==this.activeTabId){var $a=this._getA(id);$a.parent().removeClass("disabled"),$a.removeClass("btn disabled"),$a.tab("show");var previous=this.activeTabId;this.activeTabId=id,this.activeTabObject=this.idToTabObject.get(this.activeTabId),this.trigger("change",{tab:this.activeTabId,previous:previous})}},setTabTitle:function(id,title){this._getA(id).attr("title",title)},_getA:function(id){return"#"===id[0]&&(id=id.substring(1)),this.$nav.find("> li > a[data-link="+id+"]:first")},setTabEnabled:function(id,enabled){var $a=this._getA(id);enabled?($a.parent().removeClass("disabled"),$a.removeClass("btn disabled")):($a.parent().addClass("disabled"),$a.addClass("btn disabled"))},getIdToTabObject:function(){return this.idToTabObject},getTabObject:function(id){return this.idToTabObject.get(id)},rename:function(id){var $a=this._getA(id);if(!$a.parent().hasClass("morpheus-tab-addon")&&$a.data("morpheus-rename")&&this.options.rename){var _this=this,builder=new morpheus.FormBuilder;builder.append({name:"name",type:"text",value:$.trim($a.contents().first().text())}),morpheus.FormBuilder.showOkCancel({title:"Rename Tab",content:builder.$form,focus:document.activeElement,okCallback:function(){var name=$.trim(builder.getValue("name"));""!==name&&(null!=_this.activeTabObject&&_this.activeTabObject.setName&&_this.activeTabObject.setName(name),$a.contents().first().replaceWith(name+"&nbsp;"),_this.trigger("rename"))}})}}},morpheus.Util.extend(morpheus.TabManager,morpheus.Events),morpheus.Table=function(options){options=morpheus.Table.createOptions(options),this.options=options,options.width||(options.width=options.$el.attr("class"));var _this=this,height=options.height,$gridDiv=$('<div class="slick-table'+(options.tableClass?" "+options.tableClass:"")+'" style="width:'+options.fixedWidth+";height:"+height+'"></div>');this.$gridDiv=$gridDiv,$gridDiv.appendTo(options.$el);var columns=options.columns;this.columns=columns;var visibleColumns=columns.filter(function(c){return c.visible}),grid=new morpheus.Grid({gridOptions:{select:options.select,rowHeight:options.rowHeight,autoEdit:!1,editable:!1,autoHeight:"auto"===options.height,enableTextSelectionOnCells:!0},$el:$gridDiv,items:options.items,columns:visibleColumns});this.grid=grid,this.searchFunction=null;var searchFilter={isEmpty:function(){return null==_this.searchFunction},init:function(){},accept:function(item){return _this.searchFunction(item)}};this.grid.getFilter().add(searchFilter);var $header=$('<div class="slick-table-header"><div name="top"></div><div style="display: inline-block;" name="left" class="pad-bottom-8 pad-top-8"></div><div name="right" class="pull-right pad-bottom-8 pad-top-8"></div></div>');this.$header=$header;var $right=$header.find(".pull-right");if(options.search){var tableSearch=new morpheus.TableSearchUI({$el:$header.find("[name=top]"),$right:$right});tableSearch.setTable(this),this.tableSearch=tableSearch}if(options.columnPicker&&visibleColumns.length!==this.columns.length){var select=[];select.push('<select data-width="90px" data-selected-text-format="static" title="Columns..." multiple class="pad-left-4 selectpicker show-tick">');var sortedColumns=this.columns.slice().sort(function(a,b){return(a=a.name.toLowerCase())===(b=b.name.toLowerCase())?0:a<b?-1:1});sortedColumns.forEach(function(c,i){select.push('<option value="'+i+'"'),c.visible&&select.push(" selected"),select.push(">"),select.push(c.name),select.push("</option>")}),select.push("</select>");var $select=$(select.join(""));$select.appendTo($right),$select.selectpicker({iconBase:"fa",tickIcon:"fa-check",style:"btn-default btn-xs"}),$select.on("change",function(){var oldColumns=grid.getColumns().map(function(c){return c.id}),selectedColumnIndices=$select.val();visibleColumns=[];for(var i=0;i<selectedColumnIndices.length;i++)visibleColumns.push(sortedColumns[parseInt(selectedColumnIndices[i])]);var newColumns=visibleColumns.map(function(c){return c.id});if(grid.setColumns(visibleColumns),newColumns.length>oldColumns.length){var set=new morpheus.Set;for(i=0;i<newColumns.length;i++)set.add(newColumns[i]);for(i=0;i<oldColumns.length;i++)set.remove(oldColumns[i]);var added=set.values();grid.setSortColumns([{columnId:added[0],sortAsc:!0}])}_this.resize(),_this.redraw()})}$header.prependTo(options.$el);var collapsed=!1,lastWidth=-1,resize=function(){if(_this.options.responsive){var gridWidth=options.$el.width();gridWidth!==lastWidth&&(lastWidth=gridWidth,$gridDiv.css("width",gridWidth+"px"),!collapsed&&gridWidth<options.collapseBreakpoint&&visibleColumns.length>1?(collapsed=!0,$gridDiv.addClass("slick-stacked"),_this.grid.grid.getOptions().rowHeight=(options.collapsedRowHeight?options.collapsedRowHeight:options.rowHeight)*visibleColumns.length,_this.grid.grid.setColumns([{id:0,tooltip:function(item,value){for(var html=[],i=0;i<visibleColumns.length;i++){var text=visibleColumns[i].tooltip(item,visibleColumns[i].getter(item));null!=text&&""!==text&&html.push(text)}return html.join("<br />")},collapsed:!0,getter:function(item){return item},formatter:function(row,cell,value,columnDef,dataContext){var html=[];html.push('<div class="slick-table-wrapper"><div class="slick-cell-wrapper">'),options.rowHeader&&(html.push(options.rowHeader(dataContext)),html.push('<div style="height:4px;"></div>'));for(var i=0;i<visibleColumns.length;i++){i>0&&html.push('<div style="height:4px;"></div>');var c=visibleColumns[i];html.push(c.name),html.push(":");var s=c.renderer(dataContext,c.getter(dataContext));html.push(s)}return html.push("</div></div>"),html.join("")},sortable:!1,name:""}]),$gridDiv.find(".slick-header").hide(),_this.grid.grid.resizeCanvas(),_this.grid.grid.invalidate()):collapsed&&gridWidth>=options.collapseBreakpoint?($gridDiv.removeClass("slick-stacked"),collapsed=!1,options.showHeader&&$gridDiv.find(".slick-header").show(),_this.grid.grid.getOptions().rowHeight=options.rowHeight,_this.grid.grid.setColumns(visibleColumns),_this.grid.grid.resizeCanvas(),options.select&&_this.grid.grid.setSelectedRows(_this.grid.grid.getSelectedRows()),_this.grid.grid.invalidate()):(_this.grid.grid.resizeCanvas(),_this.grid.grid.invalidate()),_this.grid.maybeAutoResizeColumns())}};if(options.showHeader||$gridDiv.find(".slick-header").hide(),options.responsive&&($(window).on("resize orientationchange",resize),$gridDiv.on("remove",function(){$(window).off("resize",resize)}),resize()),this.resize=resize,visibleColumns.length>1&&null!=options.items&&options.items.length>0&&this.setItems(options.items),!$gridDiv.is(":visible")){for(var $parent=$gridDiv,observer=new MutationObserver(function(mutations){"none"!==window.getComputedStyle($parent[0]).display&&(observer.disconnect(),resize())});$parent.length>0&&"none"!==window.getComputedStyle($parent[0]).display;)$parent=$parent.parent();$parent.length>0&&observer.observe($parent[0],{attributes:!0,childList:!1,characterData:!1})}},morpheus.Table.defaultRenderer=function(item,value){if(null==value)return"";if(_.isNumber(value))return morpheus.Util.nf(value);if(morpheus.Util.isArray(value)){for(var s=[],i=0,length=value.length;i<length;i++){i>0&&s.push(", ");value[i];s.push(value[i])}return s.join("")}return""+value},morpheus.Table.prototype={toText:function(){for(var text=[],items=this.getItems(),columns=this.columns.filter(function(c){return c.visible}),j=0;j<columns.length;j++)j>0&&text.push("\t"),text.push(columns[j].name);text.push("\n");for(var i=0;i<items.length;i++){var item=items[i];for(j=0;j<columns.length;j++){j>0&&text.push("\t");var value=columns[j].getter(item);text.push(morpheus.Util.toString(value))}text.push("\n")}return text.join("")},setHeight:function(height){if(this.options.height=height,"auto"===height?(this.$gridDiv.css("height",""),this.grid.grid.getOptions().autoHeight=!0,this.grid.grid.setOptions(this.grid.grid.getOptions())):this.$gridDiv.css("height",height),this.grid.grid.resizeCanvas(),"auto"===height){height=this.getItems().length*this.options.rowHeight+this.options.rowHeight;this.$gridDiv.find(".slick-viewport").css("height",height+"px")}this.grid.grid.invalidate()},setSearchVisible:function(visible){this.$header.find("[name=search]").css("display",visible?"":"none")},autocomplete:function(tokens,response){var matches=[],token=null!=tokens&&tokens.length>0?tokens[tokens.selectionStartIndex]:"";token=$.trim(token);var columns=this.columns.filter(function(c){return c.searchable&&c.visible||c.alwaysSearch}),ncolumns=columns.length,showField=ncolumns>1;if(""===token){if(ncolumns<=1)return response(matches);for(var i=0;i<ncolumns;i++){var field=columns[i].name;matches.push({value:field+":",label:'<span style="font-weight:300;">'+field+":</span>",show:!0})}return matches.sort(function(a,b){return a.value===b.value?0:a.value<b.value?-1:1}),response(matches)}field=null;var semi=token.indexOf(":"),regex=new RegExp("^"+morpheus.Util.escapeRegex(token),"i");if(semi>0){if(92!==token.charCodeAt(semi-1)){var possibleField=$.trim(token.substring(0,semi));possibleField.length>0&&'"'===possibleField[0]&&'"'===possibleField[token.length-1]&&(possibleField=possibleField.substring(1,possibleField.length-1));var columnNameToColumn=new morpheus.Map,columnNames=columns.map(function(c){return c.name});for(i=0;i<columnNames.length;i++)columnNameToColumn.set(columnNames[i],columns[i]);var c=columnNameToColumn.get(possibleField);void 0!==c&&(token=$.trim(token.substring(semi+1)),columns=[c],ncolumns=1)}}else if(ncolumns>1){regex=new RegExp("^"+morpheus.Util.escapeRegex(token),"i");for(var j=0;j<ncolumns;j++){field=columns[j].name;regex.test(field)&&matches.push({value:field+":",label:'<span style="font-weight:300;">'+field+":</span>",show:!0})}}var set=new morpheus.Set,items=(regex=new RegExp("^"+morpheus.Util.escapeRegex(token),"i"),this.getItems()),dataTypes=[],filteredColumns=[];columns.forEach(function(c){for(var dataType=null,i=0,nitems=items.length;i<nitems;i++){var value=c.getter(items[i]);if(null!=value){dataType=morpheus.Util.getDataType(value);break}}"string"!==dataType&&"[string]"!==dataType||(dataTypes.push(dataType),filteredColumns.push(c))}),ncolumns=(columns=filteredColumns).length;for(var maxSize=matches.length+10,nitems=(i=0,items.length);i<nitems;i++){var item=items[i];for(j=0;j<ncolumns;j++){field=columns[j].name;var value=columns[j].getter(item);if("[string]"===dataTypes[j])for(var nvalues=null==value?0:value.length,k=0;k<nvalues;k++){var val=value[k];if(regex.test(val)&&!set.has(val)&&(set.add(val),matches.push({value:showField?field+":"+val:val,label:showField?'<span style="font-weight:300;">'+field+':</span><span style="font-weight:900;">'+val+"</span>":'<span style="font-weight:900;">'+val+"</span>"})),matches.length===maxSize)return response(matches)}else if(regex.test(value)&&!set.has(value)&&(set.add(value),matches.push({value:showField?field+":"+value:value,label:showField?'<span style="font-weight:300;">'+field+':</span><span style="font-weight:900;">'+value+"</span>":'<span style="font-weight:900;">'+value+"</span>"}),matches.length===maxSize))return response(matches)}}return response(matches)},searchWithPredicates:function(predicates){if(null==predicates||0===predicates.length)return this.searchFunction=null,void this.grid.setFilter(this.grid.getFilter());for(var columns=this.columns.filter(function(c){return c.searchable&&c.visible||c.alwaysSearch}),columnNameToColumn=new morpheus.Map,columnNames=columns.map(function(c){return c.name}),i=0;i<columnNames.length;i++)columnNameToColumn.set(columnNames[i],columns[i]);var filteredPredicates=[],npredicates=predicates.length;for(i=0;i<npredicates;i++){var predicate=predicates[i],filterColumnName=predicate.getField();if(null!=filterColumnName){var column=columnNameToColumn.get(filterColumnName);column&&(predicate.column=column,filteredPredicates.push(predicate))}else filteredPredicates.push(predicate)}npredicates=(predicates=filteredPredicates).length;this.searchFunction=function(item){for(var p=0;p<npredicates;p++)for(var searchColumns,j=0,ncolumns=(searchColumns=(predicate=predicates[p]).column?[predicate.column]:columns).length;j<ncolumns;j++){var predicate,value=searchColumns[j].getter(item);if(morpheus.Util.isArray(value)){for(var nvalues=value.length,i=0;i<nvalues;i++)if(predicate.accept(value[i]))return!0}else if((predicate=predicates[p]).accept(value))return!0}return!1},this.grid.setFilter(this.grid.getFilter())},search:function(text){if(""===text)this.searchFunction=null,this.grid.setFilter(this.grid.getFilter());else{var tokens=morpheus.Util.getAutocompleteTokens(text),columnNames=this.columns.filter(function(c){return c.searchable&&c.visible||c.alwaysSearch}).map(function(c){return c.name}),predicates=morpheus.Util.createSearchPredicates({tokens:tokens,fields:columnNames});this.searchWithPredicates(predicates)}},getSelectedRows:function(){return this.grid.getSelectedRows()},getSelectedItems:function(){return this.grid.getSelectedItems()},getSelectedItem:function(){return this.grid.getSelectedItem()},setSelectedRows:function(rows){this.grid.setSelectedRows(rows)},getItems:function(items){return this.grid.getItems()},getAllItemCount:function(){return this.grid.getAllItemCount()},getFilteredItemCount:function(){return this.grid.getFilteredItemCount()},setFilter:function(f){this.grid.setFilter(f)},getFilter:function(){return this.grid.getFilter()},setItems:function(items){this.grid.setItems(items),this.grid.redraw()},redraw:function(){this.grid.redraw()},on:function(evtStr,handler){return this.grid.on(evtStr,handler),this},off:function(evtStr,handler){return this.grid.off(evtStr,handler),this},trigger:function(evtStr){this.grid.trigger(evtStr)}},morpheus.Table.createOptions=function(options){(options=$.extend(!0,{},{items:[],height:"564px",collapseBreakpoint:400,showHeader:!0,select:!0,rowHeader:null,responsive:!0,fixedWidth:"320px",columnPicker:!0},options)).columns||(options.columns=[{name:""}]);var columns=[];return options.columns.forEach(function(c,i){var column=$.extend(!0,{},{id:i,tooltip:function(dataContext,value){return morpheus.Table.defaultRenderer(dataContext,value)},formatter:function(row,cell,value,columnDef,dataContext){var html=[];return html.push('<div class="slick-table-wrapper"><div class="slick-cell-wrapper">'),options.rowHeader&&0===cell&&html.push(options.rowHeader(dataContext)),html.push(column.renderer(dataContext,value)),html.push("</div></div>"),html.join("")},comparator:function(a,b){var aNaN=null==a||_.isNumber(a)&&isNaN(a),bNaN=null==b||_.isNumber(b)&&isNaN(b);return aNaN&&bNaN?0:aNaN?1:bNaN?-1:(a.toLowerCase&&(a=a.toLowerCase()),b.toLowerCase&&(b=b.toLowerCase()),a===b?0:a<b?-1:1)},sortable:!0,searchable:!0,width:null,name:c.name,renderer:morpheus.Table.defaultRenderer},c);void 0===column.visible&&(column.visible=!0),column.getter||(column.getter=null==column.field?function(item){return item}:function(item){return item[c.field]}),columns.push(column)}),options.columns=columns,1===options.columns.length?options.tableClass="slick-table-compact":options.tableClass="slick-bordered-table",options.rowHeight||(options.rowHeight=22),options},morpheus.TableSearchUI=function(options){var _this=this,$search=$('<input name="search" type="text" class="form-control input-sm" placeholder="Search" autocomplete="off">');$search.appendTo(options.$el),this.$search=$search,this.$searchResults=$('<span class="pad-top-2 tableview-rowcount" name="search"></span>'),this.$showAll=$('<div style="display:inline-block;min-width:60px;" name="search" class="pad-left-8 text-button-copy tableview-rowcount">Show all</div>'),this.$searchResults.appendTo(options.$right),this.$showAll.appendTo(options.$right),this.$showAll.on("click",function(e){e.preventDefault(),$search.val(""),_this.table.search(""),_this.table.trigger("showAll",{table:_this.table})}),$search.on("keyup",_.debounce(function(){_this.table.search($.trim($(this).val()))},100)),morpheus.Util.autosuggest({$el:$search,suggestWhenEmpty:!0,filter:function(tokens,response){_this.table.autocomplete(tokens,response)},select:function(){_this.table.search($.trim($search.val()))}})},morpheus.TableSearchUI.prototype={updateSearchLabel:function(){var text="Showing: "+morpheus.Util.intFormat(this.table.getFilteredItemCount())+" / "+morpheus.Util.intFormat(this.table.getAllItemCount());this.$searchResults.html(text)},setTable:function(table){this.table=table;var _this=this;table.on("filter",function(){_this.updateSearchLabel()})}},morpheus.TrackSelection=function(track,positions,selectionModel,isColumns,heatMap){var canvas=track.canvas,startIndex=-1,coord=isColumns?"x":"y";function getPosition(event,useDelta){if(track.settings.squished){var squishFactor=(positions.getPosition(positions.getLength()-1)+positions.getItemSize(positions.getLength()-1))/(isColumns?track.getUnscaledWidth():track.getUnscaledHeight()),p=(morpheus.CanvasUtil.getClientXY(event,useDelta),morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,0,0,useDelta));return p[coord]*=squishFactor,p}return morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,heatMap.scrollLeft(),heatMap.scrollTop(),useDelta)}var scrollIntervalId,lastScrollTime=(new Date).getTime(),_this=this,throttlePanMove=50;function mouseleave(e){var scroll=function(){(new Date).getTime();var rect=canvas.getBoundingClientRect(),doPan=!1;isColumns?(e.clientX>rect.right||e.clientX<rect.left)&&(doPan=!0):(e.clientY>rect.bottom||e.clientY<rect.top)&&(doPan=!0),doPan&&(_this.panmove(e),scrollIntervalId=setTimeout(scroll,throttlePanMove))};scrollIntervalId=setTimeout(scroll,throttlePanMove),$(canvas).one("mouseover",mouseover)}function mouseover(){clearTimeout(scrollIntervalId),$(canvas).one("mouseleave",mouseleave)}this.hammer=morpheus.Util.hammer(canvas,["pan","tap","longpress"]).on("longpress",this.longpress=function(event){event.preventDefault(),event.srcEvent.stopImmediatePropagation(),event.srcEvent.stopPropagation(),heatMap.setSelectedTrack(track.name,isColumns),track.showPopup(event.srcEvent)}).on("panend",this.panend=function(event){!1,clearInterval(scrollIntervalId),$(canvas).off("mouseover mouseleave")}).on("panmove",this.panmove=function(event){if(!((new Date).getTime()-lastScrollTime<throttlePanMove)){var position=getPosition(event),endIndex=positions.getIndex(position[coord],!1),viewIndices=null!=event.srcEvent&&(morpheus.Util.IS_MAC?event.srcEvent.metaKey:event.srcEvent.ctrlKey)?selectionModel.getViewIndices():new morpheus.Set,_startIndex=startIndex;if(startIndex>endIndex){var tmp=endIndex;endIndex=_startIndex,_startIndex=tmp}for(var i=_startIndex;i<=endIndex;i++)viewIndices.add(i);if(selectionModel.setViewIndices(viewIndices,!0),isColumns){var scrollLeft=heatMap.scrollLeft(),heatMapWidth=heatMap.heatmap.getUnscaledWidth(),scrollRight=scrollLeft+heatMapWidth;position.x>scrollRight?heatMap.scrollLeft(position.x+8-heatMapWidth):position.x<scrollLeft&&heatMap.scrollLeft(position.x-8)}else{var scrollTop=heatMap.scrollTop(),heatMapHeight=heatMap.heatmap.getUnscaledHeight(),scrollBottom=scrollTop+heatMapHeight;position.y>scrollBottom?heatMap.scrollTop(position.y+8-heatMapHeight):position.y<scrollTop&&heatMap.scrollTop(position.y-8)}event.preventDefault(),null!=event.srcEvent&&(event.srcEvent.stopPropagation(),event.srcEvent.stopImmediatePropagation()),lastScrollTime=(new Date).getTime()}}).on("panstart",this.panstart=function(event){heatMap.setSelectedTrack(track.name,isColumns);var position=getPosition(event,!0);startIndex=positions.getIndex(position[coord],!1),!0,$(canvas).one("mouseleave.morpheus",mouseleave)}).on("tap doubletap",this.tap=function(event){var position=getPosition(event),index=positions.getIndex(position[coord],!1);if(event.tapCount>1){if(isColumns&&!heatMap.options.columnsSortable||!isColumns&&!heatMap.options.rowsSortable)return;heatMap.sortBasedOnSelection(null,isColumns,event.srcEvent.shiftKey)}else{heatMap.setSelectedTrack(track.name,isColumns);var viewIndices,commandKey=morpheus.Util.IS_MAC?event.srcEvent.metaKey:event.srcEvent.ctrlKey;if(morpheus.Util.IS_MAC&&event.srcEvent.ctrlKey)return;if(commandKey)(viewIndices=selectionModel.getViewIndices()).has(index)?viewIndices.remove(index):viewIndices.add(index);else if(event.srcEvent.shiftKey){viewIndices=selectionModel.getViewIndices();var min=Number.MAX_VALUE,max=-Number.MAX_VALUE;if(viewIndices.forEach(function(viewIndex){min=Math.min(viewIndex,min),max=Math.max(viewIndex,max)}),index>=max)for(var i=max;i<=index;i++)viewIndices.add(i);else for(i=Math.min(index,min),max=Math.max(index,min);i<=max;i++)viewIndices.add(i)}else(viewIndices=new morpheus.Set).add(index);selectionModel.setViewIndices(viewIndices,!0)}})},morpheus.TrackSelection.prototype={dispose:function(){this.hammer.off("longpress",this.longpress).off("panstart",this.panstart).off("panmove",this.panmove).off("panend",this.panend).off("tap",this.tap).off("doubletap",this.tap),this.hammer.destroy()}},morpheus.VectorTrackHeader=function(project,name,isColumns,heatMap){morpheus.AbstractCanvas.call(this),this.font={weight:"400"},this.project=project,this.name=name,this.isColumns=isColumns;var canvas=this.canvas;this.heatMap=heatMap,this.selectedBackgroundColor="#c8c8c8",this.backgroundColor="rgb(255,255,255)";var vector=(isColumns?project.getFullDataset().getColumnMetadata():project.getFullDataset().getRowMetadata()).getByName(name);vector&&vector.getProperties().has(morpheus.VectorKeys.TITLE)&&(this.canvas.setAttribute("title",vector.getProperties().get(morpheus.VectorKeys.TITLE)),$(this.canvas).tooltip());var _this=this;function getResizeCursor(pos){if(isColumns){if(pos.y<3)return{cursor:"ns-resize",isPrevious:!0};if(pos.y>=_this.getUnscaledHeight()-3)return{cursor:"ns-resize",isPrevious:!1};if(pos.x>=_this.getUnscaledWidth()-3)return{isPrevious:!1,cursor:"ew-resize"}}else{if(pos.x<3&&heatMap.getTrackIndex(name,isColumns)>0)return{cursor:"ew-resize",isPrevious:!0};if(pos.x>=_this.getUnscaledWidth()-3)return{cursor:"ew-resize",isPrevious:!1}}}this.setBounds({height:this.defaultFontHeight+morpheus.VectorTrackHeader.FONT_OFFSET});var resizeCursor,mouseMove=function(event){if(!morpheus.CanvasUtil.dragging){var resizeCursor=getResizeCursor(morpheus.CanvasUtil.getMousePos(event.target,event));canvas.style.cursor=null==resizeCursor?"default":resizeCursor.cursor,_this.isMouseOver=!0,_this.repaint()}};$(this.canvas).css({"background-color":this.backgroundColor}).on("mousemove.morpheus",mouseMove).on("mouseout.morpheus",function(e){morpheus.CanvasUtil.dragging||(canvas.style.cursor="default"),_this.isMouseOver=!1,_this.repaint()}).on("mouseenter.morpheus",mouseMove).on("contextmenu.morpheus",function(e){heatMap.setSelectedTrack(_this.name,isColumns);var track=heatMap.getTrack(_this.name,isColumns);if(!track)throw _this.name+" track not found";return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),track.showPopup(e,!0),!1}).addClass("morpheus-track-header "+(isColumns?"morpheus-columns":"morpheus-rows"));var dragStartPosition,resizeTrackName,dragStartWidth=0,dragStartHeight=0,reorderingTrack=!1;this.hammer=morpheus.Util.hammer(canvas,["pan","tap","longpress"]).on("longpress",this.longpress=function(event){event.preventDefault(),heatMap.setSelectedTrack(_this.name,isColumns),heatMap.getTrack(_this.name,isColumns).showPopup(event.srcEvent,!0)}).on("panend",this.panend=function(event){_this.isMouseOver=!1,morpheus.CanvasUtil.dragging=!1,canvas.style.cursor="default";var index=heatMap.getTrackIndex(_this.name,isColumns),header=heatMap.getTrackHeaderByIndex(index,isColumns),track=heatMap.getTrackByIndex(index,isColumns);$(track.canvas).css("z-index","0"),$(header.canvas).css("z-index","0"),heatMap.revalidate()}).on("panstart",this.panstart=function(event){if(_this.isMouseOver=!1,!morpheus.CanvasUtil.dragging)if(null!=resizeCursor){if(morpheus.CanvasUtil.dragging=!0,canvas.style.cursor=resizeCursor.cursor,resizeCursor.isPrevious){var index=heatMap.getTrackIndex(_this.name,isColumns);-1===--index&&(index=0);var header=heatMap.getTrackHeaderByIndex(index,isColumns);dragStartWidth=header.getUnscaledWidth(),dragStartHeight=header.getUnscaledHeight(),resizeTrackName=header.name}else resizeTrackName=null,dragStartWidth=_this.getUnscaledWidth(),dragStartHeight=_this.getUnscaledHeight();event.preventDefault(),reorderingTrack=!1}else{if(-1==(index=heatMap.getTrackIndex(_this.name,isColumns)))throw _this.name+" not found";header=heatMap.getTrackHeaderByIndex(index,isColumns);var track=heatMap.getTrackByIndex(index,isColumns);heatMap.setSelectedTrack(_this.name,isColumns);var $canvas=$(track.canvas);dragStartPosition=$canvas.position(),$canvas.css("z-index","100"),$(header.canvas).css("z-index","100"),morpheus.CanvasUtil.dragging=!0,resizeCursor=void 0,reorderingTrack=!0}}).on("panmove",this.panmove=function(event){if(_this.isMouseOver=!1,null!=resizeCursor){var width,height;if("ew-resize"===resizeCursor.cursor){var dx=event.deltaX;width=Math.max(8,dragStartWidth+dx)}if("ns-resize"===resizeCursor.cursor){var dy=event.deltaY;height=Math.max(8,dragStartHeight+dy)}heatMap.resizeTrack(null==resizeTrackName?_this.name:resizeTrackName,width,height,isColumns)}else if(reorderingTrack){var index=heatMap.getTrackIndex(_this.name,isColumns),header=heatMap.getTrackHeaderByIndex(index,isColumns),track=heatMap.getTrackByIndex(index,isColumns),ntracks=heatMap.getNumTracks(isColumns),delta=isColumns?event.deltaY:event.deltaX,newIndex=index+(delta>0?1:-1);newIndex=Math.min(Math.max(0,newIndex),ntracks-1);var prop=isColumns?"top":"left",w=isColumns?"getUnscaledHeight":"getUnscaledWidth",trackBounds={};trackBounds[prop]=dragStartPosition[prop]+delta,track.setBounds(trackBounds),header.setBounds(trackBounds);var dragOverTrack=heatMap.getTrackByIndex(newIndex,isColumns),dragOverWidth=dragOverTrack[w](),dragOverLeft=$(dragOverTrack.canvas).position()[prop],dragleft=dragStartPosition[prop]+delta,dragright=dragleft+track[w]();if((delta>0&&dragright>=dragOverLeft+dragOverWidth/2||delta<0&&dragleft<=dragOverLeft+dragOverWidth/2)&&index!==newIndex){heatMap.moveTrack(index,newIndex,isColumns);var otherHeader=heatMap.getTrackHeaderByIndex(index,isColumns),otherTrack=heatMap.getTrackByIndex(index,isColumns),newLeft=$(otherTrack.canvas).position()[prop];delta<0?newLeft+=track[w]():newLeft-=track[w]();var otherBounds={};otherBounds[prop]=newLeft,otherTrack.setBounds(otherBounds),otherHeader.setBounds(otherBounds)}}}).on("tap",this.tap=function(event){if(!morpheus.Util.IS_MAC||!event.srcEvent.ctrlKey){_this.isMouseOver=!1,heatMap.setSelectedTrack(_this.name,isColumns);var vector=(isColumns?project.getFullDataset().getColumnMetadata():project.getFullDataset().getRowMetadata()).getByName(name);if((!isColumns||heatMap.options.columnsSortable)&&null!=vector&&(isColumns||heatMap.options.rowsSortable)&&null!=vector){var sortOrder,sortKey,additionalSort=event.srcEvent.shiftKey,existingSortKeyIndex=_this.getSortKeyIndexForColumnName(_this.getSortKeys(),_this.name),dataType=morpheus.VectorUtil.getDataType(vector);null!=existingSortKeyIndex?sortOrder=(sortKey=_this.getSortKeys()[existingSortKeyIndex.index]).getSortOrder()===morpheus.SortKey.SortOrder.UNSORTED?morpheus.SortKey.SortOrder.ASCENDING:sortKey.getSortOrder()===morpheus.SortKey.SortOrder.ASCENDING?morpheus.SortKey.SortOrder.DESCENDING:sortKey.getSortOrder()===morpheus.SortKey.SortOrder.TOP_N?morpheus.SortKey.SortOrder.UNSORTED:"number"===dataType||"[number]"===dataType?morpheus.SortKey.SortOrder.TOP_N:morpheus.SortKey.SortOrder.UNSORTED:(sortKey=new morpheus.SortKey(_this.name,morpheus.SortKey.SortOrder.ASCENDING),sortOrder=morpheus.SortKey.SortOrder.ASCENDING),null!=sortKey&&(sortKey.setSortOrder(sortOrder),_this.setSortingStatus(_this.getSortKeys(),sortKey,additionalSort,!1))}}}),$(this.canvas).on("mousedown",function(event){resizeCursor=getResizeCursor(morpheus.CanvasUtil.getMousePos(event.target,event,!0))})},morpheus.VectorTrackHeader.FONT_OFFSET=2,morpheus.VectorTrackHeader.prototype={selected:!1,isMouseOver:!1,defaultFontHeight:11,dispose:function(){morpheus.AbstractCanvas.prototype.dispose.call(this),this.hammer.off("longpress",this.longpress).off("panend",this.panend).off("panstart",this.panstart).off("panmove",this.panmove).off("tap",this.tap),this.hammer.destroy()},getPreferredSize:function(){var context=this.canvas.getContext("2d");context.font=this.fontWeight+" "+this.defaultFontHeight+"px "+morpheus.CanvasUtil.getFontFamily(context);var size={width:context.measureText(this.name).width,height:this.defaultFontHeight+morpheus.VectorTrackHeader.FONT_OFFSET};return size.width+=24,this.isColumns||(size.height=this.defaultFontHeight+morpheus.VectorTrackHeader.FONT_OFFSET),size},getPrintSize:function(){var context=this.canvas.getContext("2d");context.font=this.fontWeight+" "+this.defaultFontHeight+"px "+morpheus.CanvasUtil.getFontFamily(context);var track=this.heatMap.getTrack(this.name,this.isColumns),trackSize=track.getPrintSize(),size={width:context.measureText(this.name).width+4,height:this.defaultFontHeight+morpheus.VectorTrackHeader.FONT_OFFSET},border=0;return track.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)&&1===track.settings.display.length&&(border=6),this.isColumns?(size.height=Math.max(size.height,trackSize.height),size.height+=border):(size.width=Math.max(size.width,trackSize.width),size.width+=border),size},getSortKeys:function(){return this.isColumns?this.project.getColumnSortKeys():this.project.getRowSortKeys()},setOrder:function(sortKeys){this.isColumns?this.project.setColumnSortKeys(morpheus.SortKey.keepExistingSortKeys(sortKeys,this.project.getColumnSortKeys()),!1):this.project.setRowSortKeys(morpheus.SortKey.keepExistingSortKeys(sortKeys,this.project.getRowSortKeys()),!1)},setGroupBy:function(groupBy){for(var existingGroupBy=this.isColumns?this.project.groupColumns:this.project.groupRows,index=-1,i=0,length=existingGroupBy.length;i<length;i++)if(existingGroupBy[i].toString()===groupBy.toString()){index=i;break}var newGroupBy=[groupBy];-1!==index&&(newGroupBy=existingGroupBy).splice(index,1),this.isColumns?this.project.setGroupColumns(newGroupBy,!0):this.project.setGroupRows(newGroupBy,!0)},setSelected:function(selected){selected!=this.selected&&(this.selected=selected,$(this.canvas).css({"background-color":this.selected?this.selectedBackgroundColor:this.backgroundColor}))},setSortingStatus:function(sortKeys,sortKey,additionalSort,isGroupBy){if(!isGroupBy)if(sortKey.getSortOrder()!=morpheus.SortKey.SortOrder.UNSORTED||additionalSort){if(additionalSort&&0==sortKeys.length&&(additionalSort=!1),additionalSort){var sortKeyIndex=this.getSortKeyIndexForColumnName(sortKeys,sortKey.toString());null===sortKeyIndex?sortKeys.push(sortKey):sortKeys[sortKeyIndex.index]=sortKey}else sortKeys=[sortKey];this.setOrder(sortKeys)}else this.setOrder([]);isGroupBy?this.setGroupBy(sortKey):this.isColumns?this.project.trigger("columnSortOrderChanged"):this.project.trigger("rowSortOrderChanged")},getSortKeyIndexForColumnName:function(sortKeys,columnName){if(null!=sortKeys)for(var counter=0,i=0,size=sortKeys.length;i<size;i++)if(sortKeys[i].isUnlockable()&&counter++,sortKeys[i]instanceof morpheus.SortKey&&columnName===sortKeys[i].toString())return{index:i,number:counter};return null},print:function(clip,context){clip.height<=6||(context.textBaseline="bottom",this.isColumns?(context.textAlign="right",context.font=this.font.weight+" "+Math.min(this.defaultFontHeight,clip.height-morpheus.VectorTrackHeader.FONT_OFFSET)+"px "+morpheus.CanvasUtil.getFontFamily(context)):(context.textAlign="left",context.font=clip.height-morpheus.VectorTrackHeader.FONT_OFFSET+"px "+morpheus.CanvasUtil.getFontFamily(context)),context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,context.fillText(this.name,0,0))},draw:function(clip,context){var sortKeys=this.getSortKeys(),name=this.name,existingSortKeyIndex=this.getSortKeyIndexForColumnName(sortKeys,name),unlockableSortKeys=sortKeys.filter(function(key){return key.isUnlockable()});if(morpheus.CanvasUtil.resetTransform(context),context.clearRect(0,0,this.getUnscaledWidth(),this.getUnscaledHeight()),!(this.getUnscaledHeight()<5)){context.strokeStyle="#ddd",this.isColumns?(context.beginPath(),context.moveTo(0,this.getUnscaledHeight()),context.lineTo(this.getUnscaledWidth(),this.getUnscaledHeight()),context.stroke(),context.textAlign="right"):(context.beginPath(),context.moveTo(this.getUnscaledWidth(),0),context.lineTo(this.getUnscaledWidth(),this.getUnscaledHeight()),context.stroke(),context.textAlign="left");var textWidth=context.measureText(name).width,isColumns=this.isColumns,xpix=this.isColumns?this.getUnscaledWidth()-2:10;isColumns&&(null!=existingSortKeyIndex&&(xpix-=6,0!==sortKeys[existingSortKeyIndex.index].getLockOrder()&&(xpix-=10)),sortKeys.length>1&&(xpix-=6)),context.fillStyle=morpheus.CanvasUtil.FONT_COLOR;var ypix=this.isColumns?this.getUnscaledHeight()/2:this.getUnscaledHeight()-(this.defaultFontHeight+morpheus.VectorTrackHeader.FONT_OFFSET)/2;if(context.textBaseline="middle",this.isMouseOver)for(var xdot=xpix-(isColumns?textWidth+4:4),ydot=ypix-3,i=0;i<2;i++)for(var j=0;j<3;j++)context.fillRect(xdot-3*i,ydot+3*j,1.5,1.5);var fontHeight=Math.min(this.defaultFontHeight,this.getUnscaledHeight()-morpheus.VectorTrackHeader.FONT_OFFSET);if(fontHeight=Math.min(fontHeight,morpheus.VectorTrack.MAX_FONT_SIZE),context.font=this.font.weight+" "+fontHeight+"px "+morpheus.CanvasUtil.getFontFamily(context),context.fillText(name,xpix,ypix),context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,null!==existingSortKeyIndex){context.beginPath();var x=this.isColumns?xpix+4:xpix+textWidth+6,arrowHeight=Math.min(8,this.getUnscaledHeight()/2-1);if(sortKeys[existingSortKeyIndex.index].getSortOrder()===morpheus.SortKey.SortOrder.ASCENDING?(context.translate(x,ypix-arrowHeight),context.moveTo(0,0),context.lineTo(3,arrowHeight),context.lineTo(-3,arrowHeight)):sortKeys[existingSortKeyIndex.index].getSortOrder()===morpheus.SortKey.SortOrder.DESCENDING?(context.translate(x,ypix),context.moveTo(0,arrowHeight),context.lineTo(3,0),context.lineTo(-3,0)):(context.translate(x,ypix-arrowHeight/2),context.moveTo(0,0),context.lineTo(3,arrowHeight/2),context.lineTo(0,arrowHeight),context.lineTo(-3,arrowHeight/2)),context.fill(),morpheus.CanvasUtil.resetTransform(context),context.textAlign="left",unlockableSortKeys.length>1){context.font="8px "+morpheus.CanvasUtil.getFontFamily(context);var sortIndex=""+existingSortKeyIndex.number;context.fillText(sortIndex,x+4,ypix-2),x+=context.measureText(sortIndex).width}0!==sortKeys[existingSortKeyIndex.index].getLockOrder()&&(context.font=fontHeight+"px FontAwesome",context.fillText("",x+3+2,ypix))}}}},morpheus.Util.extend(morpheus.VectorTrackHeader,morpheus.AbstractCanvas),morpheus.VectorTrack=function(project,name,positions,isColumns,heatmap){morpheus.AbstractCanvas.call(this,!0),this.preferredSize={width:0,height:0},this.project=project,this.positions=positions,this.isColumns=isColumns,this.name=name,this.visible=!0,this.heatmap=heatmap,this.id=_.uniqueId();var _this=this;this.updateSpanMapFunction=function(){_this.spanMap=morpheus.VectorUtil.createSpanMap(_this.getVector())},this.lastPosition={start:-1,end:-1},this.events="rowSortOrderChanged rowFilterChanged datasetChanged";$(this.canvas).on("contextmenu.morpheus",function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),heatmap.setSelectedTrack(_this.name,isColumns),_this.showPopup(e),!1}),this.settings={maxTextWidth:void 0,squished:!1,inlineTooltip:!1,tooltip:!0,highlightMatchingValues:!1,colorBarSize:12,stackedBar:!1,display:[],selectionColor:"rgb(182,213,253)",colorByField:null,fontField:null,barColor:"#bdbdbd",barSize:40,min:void 0,mid:void 0,max:void 0,autoscaleAlways:!1,minMaxReversed:!1},$(this.canvas).on("mousemove.morpheus mouseout.morpheus",function(event){var index=-1;if("mouseout"!==event.type){var position=morpheus.CanvasUtil.getMousePosWithScroll(event.target,event,heatmap.scrollLeft(),heatmap.scrollTop());if(_this.settings.squished){var squishFactor=(positions.getPosition(positions.getLength()-1)+positions.getItemSize(positions.getLength()-1))/(isColumns?_this.getUnscaledWidth():_this.getUnscaledHeight());position[isColumns?"x":"y"]*=squishFactor}index=isColumns?_this.positions.getIndex(position.x,!1):_this.positions.getIndex(position.y,!1)}isColumns?heatmap.setMousePosition(-1,index,{name:_this.name,event:event}):heatmap.setMousePosition(index,-1,{name:_this.name,event:event})})},morpheus.VectorTrack.RENDER={TEXT:"text",COLOR:"color",BAR:"bar",MOLECULE:"molecule",TEXT_AND_COLOR:"text_and_color",TEXT_AND_FONT:"text_and_font",SHAPE:"shape",ARC:"arc",BOX_PLOT:"box_plot",HEAT_MAP:"heat_map"},morpheus.VectorTrack.vectorToString=function(vector){var dataType=morpheus.VectorUtil.getDataType(vector),formatter=vector.getProperties().get(morpheus.VectorKeys.FORMATTER);if(null!=formatter){if("object"==typeof formatter){if(formatter=morpheus.Util.createNumberFormat(formatter.pattern),"[number]"===dataType){var nf=formatter;formatter=function(v){var s=[];if(null!=v)for(var i=0,arrayLength=v.length;i<arrayLength;i++)s.push(nf(v[i]));return s.join(", ")}}vector.getProperties().set(morpheus.VectorKeys.FORMATTER,formatter)}}else formatter="number"===dataType?morpheus.Util.nf:"[number]"===dataType?function(v){var s=[];if(null!=v)for(var i=0,arrayLength=v.length;i<arrayLength;i++)s.push(morpheus.Util.nf(v[i]));return s.join(", ")}:"[string]"===dataType?function(v){var s=[];if(null!=v)for(var i=0,arrayLength=v.length;i<arrayLength;i++)s.push(v[i]);return s.join(", ")}:function(v){return""+v};return formatter},morpheus.VectorTrack.prototype={settingFromConfig:function(conf){var _this=this,settings=this.settings,fromString=function(s){settings.display=[];for(var tokens=s.split(","),i=0,length=tokens.length;i<length;i++){var method=$.trim(tokens[i]);method=method.toUpperCase();var mapped=morpheus.VectorTrack.RENDER[method];void 0!==mapped?settings.display.push(mapped):"DISCRETE"===method?_this.getFullVector().getProperties().get(morpheus.VectorKeys.DISCRETE,!0):"CONTINUOUS"===method?_this.getFullVector().getProperties().set(morpheus.VectorKeys.DISCRETE,!1):"HIGHLIGHT"===method?settings.highlightMatchingValues=!0:"STACKED_BAR"===method?(settings.stackedBar=!0,settings.display.push(morpheus.VectorTrack.RENDER.BAR)):"TOOLTIP"===method?settings.inlineTooltip=!0:console.log(method+" not found.")}};if(null!=conf){if(_.isString(conf))fromString(conf);else if(_.isArray(conf))!function(array){settings.display=[];for(var i=0;i<array.length;i++){var method=array[i].toUpperCase(),mapped=morpheus.VectorTrack.RENDER[method];void 0!==mapped?settings.display.push(mapped):console.log(method+" not found.")}}(conf);else{var userSuppliedSettings=conf;!_.isArray(conf.display)&&_.isObject(conf.display)&&(userSuppliedSettings=conf.display),(settings=$.extend({},settings,userSuppliedSettings)).maxTextWidth=void 0,null!=userSuppliedSettings.discrete&&_this.getFullVector().getProperties().get(morpheus.VectorKeys.DISCRETE,userSuppliedSettings.discrete),_.isArray(userSuppliedSettings.display)?settings.display=userSuppliedSettings.display:_.isString(userSuppliedSettings.display)&&fromString(userSuppliedSettings.display),!_.isArray(settings.render)&&_.isObject(settings.render)&&(!function(obj){for(var key in settings.display=[],obj)if(obj[key]){var method=key.toUpperCase(),mapped=morpheus.VectorTrack.RENDER[method];void 0!==mapped&&settings.display.push(mapped)}}(settings.render),delete settings.render)}this.settings=settings}this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)||!this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)&&!this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)||settings.display.push(morpheus.VectorTrack.RENDER.TEXT),this._update()},setShowTooltip:function(value){this.settings.tooltip=value},isShowTooltip:function(){return this.settings.tooltip},isRenderAs:function(value){return-1!==this.settings.display.indexOf(value)},dispose:function(){morpheus.AbstractCanvas.prototype.dispose.call(this),$(this.canvas).off(),this._selection.dispose(),this.project.off(this.events,this.updateSpanMapFunction)},getName:function(){return this.name},getVector:function(name){name=null==name?this.name:name;var vector=this.isColumns?this.project.getSortedFilteredDataset().getColumnMetadata().getByName(name):this.project.getSortedFilteredDataset().getRowMetadata().getByName(name);return vector||new morpheus.Vector(name,0)},getFullVector:function(){var vector=this.isColumns?this.project.getFullDataset().getColumnMetadata().getByName(this.name):this.project.getFullDataset().getRowMetadata().getByName(this.name);return vector||new morpheus.Vector(this.name,0)},_updatePreferredSize:function(){var size=this._computePreferredSize();this.preferredSize.width=size.width,this.preferredSize.height=size.height},_computePreferredSize:function(forPrint){var width=0;if(this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT))if(this.positions.getSize()>=6){var context=this.canvas.getContext("2d"),textWidth=morpheus.CanvasUtil.getVectorStringWidth(context,this.getVector(),this.positions,forPrint?-1:this.isColumns?120:100);forPrint||(this.settings.maxTextWidth=textWidth),width+=textWidth}else forPrint||(this.settings.maxTextWidth=0);this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)&&(width+=this.settings.barSize),this.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)&&(width+=this.settings.colorBarSize),this.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)&&(width+=this.settings.colorBarSize),this.isRenderAs(morpheus.VectorTrack.RENDER.MOLECULE)&&(width+=300),this.isRenderAs(morpheus.VectorTrack.RENDER.ARC)&&(width+=this.settings.arcSize),this.isRenderAs(morpheus.VectorTrack.RENDER.BOX_PLOT)&&(width+=100),this.isRenderAs(morpheus.VectorTrack.RENDER.HEAT_MAP)&&(width+=100);var nkeys=this.settings.display.length;return nkeys>0&&(width+=2*(nkeys-1)),width=Math.max(0,width),this.isColumns?{width:0,height:width}:{width:width,height:0}},getPreferredSize:function(){return this.preferredSize},getPrintSize:function(){return this._computePreferredSize(!0)},_setChartMinMax:function(){if((this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)||this.isRenderAs(morpheus.VectorTrack.RENDER.BOX_PLOT))&&(this.settings.autoscaleAlways||null==this.settings.min||null==this.settings.max||null==this.settings.mid)){var vector=this.getFullVector(),minMax=morpheus.VectorUtil.getMinMax(vector),min=minMax.min,max=minMax.max;if(this.settings.minMaxReversed){var tmp=max;max=min,min=tmp}(this.settings.autoscaleAlways||null==this.settings.min)&&(this.settings.min=Math.min(0,min)),(this.settings.autoscaleAlways||null==this.settings.max)&&(this.settings.max=Math.max(0,max)),(this.settings.autoscaleAlways||null==this.settings.mid)&&(this.settings.mid=this.settings.min<0?0:this.settings.min)}},_update:function(){if(null==this.getFullVector().getProperties().get(morpheus.VectorKeys.DISCRETE)&&(this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.BAR))&&(null!=(this.isColumns?this.project.getColumnColorModel():this.project.getRowColorModel()).getContinuousColorScheme(this.getFullVector())?(this.getFullVector().getProperties().set(morpheus.VectorKeys.DISCRETE,!1),this.settings.highlightMatchingValues=!1):null!=(this.isColumns?this.project.getColumnColorModel():this.project.getRowColorModel()).getDiscreteColorScheme(this.getFullVector())?(this.getFullVector().getProperties().set(morpheus.VectorKeys.DISCRETE,!0),this.settings.highlightMatchingValues=!0):(this.getFullVector().getProperties().has(morpheus.VectorKeys.FIELDS)||"number"===morpheus.VectorUtil.getDataType(this.getFullVector())||"[number]"===morpheus.VectorUtil.getDataType(this.getFullVector()))&&(this.getFullVector().getProperties().set(morpheus.VectorKeys.DISCRETE,!1),this.settings.highlightMatchingValues=!1)),null==this.getFullVector().getProperties().get(morpheus.VectorKeys.DISCRETE)&&this.getFullVector().getProperties().set(morpheus.VectorKeys.DISCRETE,!0),this.isRenderAs(morpheus.VectorTrack.RENDER.MOLECULE)&&this.project.off(this.events,this.updateSpanMapFunction),this._setChartMinMax(),this.isRenderAs(morpheus.VectorTrack.RENDER.MOLECULE)&&(this.project.on(this.events,this.updateSpanMapFunction),!this.moleculeCache)){this.moleculeCache={};var _this=this,valueToModelIndices=this.getFullVector().getProperties().get(morpheus.VectorKeys.VALUE_TO_INDICES);if(!valueToModelIndices){var fullVector=this.getFullVector();valueToModelIndices=morpheus.VectorUtil.createValueToIndicesMap(fullVector),fullVector.getProperties().set(morpheus.VectorKeys.VALUE_TO_INDICES,valueToModelIndices)}if(void 0!==_this.heatmap.options.structureUrlProvider)valueToModelIndices.forEach(function(indices,value){var url=_this.heatmap.options.structureUrlProvider(value),image=new Image;image.src=url,_this.moleculeCache[value]=image}),setTimeout(function(){_this.setInvalid(!0),_this.repaint()},2e3);else for(var values=valueToModelIndices.keys(),doRequest=function(smile){$.ajax({contentType:"text/plain",context:{smile:smile},data:{string:smile,representation:"sdf"},url:"http://cactus.nci.nih.gov/chemical/structure"}).then(function(text){_this.moleculeCache[this.smile]=text,values.length>0&&doRequest(values.pop()),_this.invalid=!0,_this.repaint()})},i=0;i<6;i++)doRequest(values.pop());this.updateSpanMapFunction()}this._updatePreferredSize()},postPaint:function(clip,context){context.lineWidth=1,context.strokeStyle="Grey";var project=this.project,setup=this._setup(context,clip),vector=setup.vector,start=setup.start,end=setup.end;this.isColumns?-1!==project.getHoverColumnIndex()&&this.drawColumnBorder(context,this.positions,project.getHoverColumnIndex(),this.getUnscaledHeight()):-1!==project.getHoverRowIndex()&&this.drawRowBorder(context,this.positions,project.getHoverRowIndex(),this.getUnscaledWidth()),this._highlightMatchingValues(context,vector,start,end)},_highlightMatchingValues:function(context,viewVector,start,end){var project=this.project,positions=this.positions;context.strokeStyle="black",context.lineWidth=3;var hoverIndex=this.isColumns?project.getHoverColumnIndex():project.getHoverRowIndex(),value=viewVector.getValue(hoverIndex);if(this.settings.highlightMatchingValues&&-1!==hoverIndex&&this.heatmap.mousePositionOptions&&this.heatmap.mousePositionOptions.name===viewVector.getName()){var valueToModelIndices=this.getFullVector().getProperties().get(morpheus.VectorKeys.VALUE_TO_INDICES);if(!valueToModelIndices){var fullVector=this.getFullVector();valueToModelIndices=morpheus.VectorUtil.createValueToIndicesMap(fullVector),fullVector.getProperties().set(morpheus.VectorKeys.VALUE_TO_INDICES,valueToModelIndices)}if(null==(indices=valueToModelIndices.get(value)))return void console.log("valueToModelIndices error");if(indices.length<=1)return;if(this.isColumns){if(-1!==project.getHoverColumnIndex()){var height=this.getUnscaledHeight();context.beginPath();for(var i=0,nindices=indices.length;i<nindices;i++){if((viewIndex=project.convertModelColumnIndexToView(indices[i]))>=start&&viewIndex<end){var size=positions.getItemSize(viewIndex),pix=positions.getPosition(viewIndex);context.rect(pix,0,size,height)}}context.stroke()}}else{context.beginPath();var indices,width=this.getUnscaledWidth();for(i=0,nindices=(indices=valueToModelIndices.get(value)).length;i<nindices;i++){var viewIndex;if((viewIndex=project.convertModelRowIndexToView(indices[i]))>=start&&viewIndex<end){size=positions.getItemSize(viewIndex),pix=positions.getPosition(viewIndex);context.rect(0,pix,width,size)}}context.stroke()}}},drawSelection:function(options){var project=this.project,positions=this.positions,context=options.context,start=options.start,end=options.end;if(context.lineWidth=1,context.fillStyle=this.settings.selectionColor,this.isColumns){var height=this.getUnscaledHeight();project.getColumnSelectionModel().getViewIndices().forEach(function(i){if(i>=start&&i<=end){var size=positions.getItemSize(i),pix=positions.getPosition(i);context.fillRect(pix,0,size,height)}})}else{var width=this.getUnscaledWidth();if(!this.isRenderAs(morpheus.VectorTrack.RENDER.MOLECULE))project.getRowSelectionModel().getViewIndices().forEach(function(i){if(i>=start&&i<=end){var size=positions.getItemSize(i),pix=positions.getPosition(i);context.fillRect(0,pix,width,size)}})}},prePaint:function(clip,context){this.project,this.positions;var setup=this._setup(context,clip),start=setup.start,end=setup.end;this.drawSelection({context:context,start:start,end:end}),(this.invalid||start!==this.lastPosition.start||end!==this.lastPosition.end)&&(this.lastPosition.start=start,this.lastPosition.end=end,this.invalid=!0)},drawRowBorder:function(context,positions,index,gridSize){var size=positions.getItemSize(index),pix=positions.getPosition(index);context.beginPath(),context.moveTo(0,pix+size),context.lineTo(gridSize,pix+size),context.stroke(),context.beginPath(),context.moveTo(0,pix),context.lineTo(gridSize,pix),context.stroke()},drawColumnBorder:function(context,positions,index,gridSize){var size=positions.getItemSize(index),pix=positions.getPosition(index);context.beginPath(),context.moveTo(pix+size,0),context.lineTo(pix+size,gridSize),context.stroke(),context.beginPath(),context.moveTo(pix,0),context.lineTo(pix,gridSize),context.stroke()},isSquished:function(){return this.settings.squished},_setup:function(context,clip){var start=0,vector=this.getVector(),end=vector.size(),settings=this.settings,positions=this.positions,width=clip.width,height=clip.height;if(settings.squished||(this.isColumns?(start=morpheus.Positions.getLeft(clip,positions),end=morpheus.Positions.getRight(clip,positions)):(start=morpheus.Positions.getTop(clip,positions),end=morpheus.Positions.getBottom(clip,positions))),settings.squished){var total=positions.getPosition(positions.getLength()-1)+positions.getItemSize(positions.getLength()-1);if(this.isColumns){squishFactor=width/total;context.scale(squishFactor,1)}else{var squishFactor=height/total;context.scale(1,squishFactor)}}else context.translate(-clip.x,-clip.y);return{start:start,end:end,vector:vector}},draw:function(clip,context){var setup=this._setup(context,clip);this._draw({start:setup.start,end:setup.end,vector:setup.vector,context:context,availableSpace:this.isColumns?this.getUnscaledHeight():this.getUnscaledWidth(),clip:clip})},print:function(clip,context){var vector=this.getVector();this._draw({start:0,end:vector.size(),vector:vector,context:context,availableSpace:this.isColumns?clip.height:clip.width,clip:clip})},_draw:function(options){var context=options.context,vector=options.vector,availableSpace=options.availableSpace,fullAvailableSpace=options.availableSpace,start=options.start,end=options.end,clip=options.clip,positions=this.positions;this.settings.autoscaleAlways&&this._setChartMinMax(),context.textAlign="left",context.fillStyle=morpheus.CanvasUtil.FONT_COLOR;var fontSize=Math.min(morpheus.VectorTrack.MAX_FONT_SIZE,positions.getSize()-2),size=0;if(context.font=fontSize+"px "+morpheus.CanvasUtil.getFontFamily(context),context.strokeStyle=morpheus.HeatMapElementCanvas.GRID_COLOR,context.lineWidth=.1,this.heatmap.heatmap.isDrawGrid()&&!this.settings.squished)if(this.isColumns){var gridSize=availableSpace;context.beginPath();for(var i=start;i<end;i++){size=positions.getItemSize(i);var pix=positions.getPosition(i);size>7&&(context.moveTo(pix+size,0),context.lineTo(pix+size,gridSize))}context.stroke()}else if(!this.isRenderAs(morpheus.VectorTrack.RENDER.MOLECULE)){gridSize=availableSpace;context.beginPath();for(i=start;i<end;i++){size=positions.getItemSize(i),pix=positions.getPosition(i);size>7&&(context.moveTo(0,pix+size),context.lineTo(gridSize,pix+size))}context.stroke()}context.lineWidth=1;var offset=1;if(this.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)&&(this.renderColor(context,vector,start,end,clip,this.isColumns?availableSpace:0,!this.getFullVector().getProperties().get(morpheus.VectorKeys.DISCRETE)),availableSpace-=offset+=this.settings.colorBarSize+2),!this.settings.squished&&this.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)&&(this.renderShape(context,vector,start,end,clip,this.isColumns?availableSpace-offset:offset),availableSpace-=offset+=this.settings.colorBarSize+2),this.isRenderAs(morpheus.VectorTrack.RENDER.ARC)&&(this.renderArc(context,vector,start,end,clip,this.settings.arcSize),availableSpace-=offset+=this.settings.arcSize+2),!this.settings.squished&&this.isRenderAs(morpheus.VectorTrack.RENDER.MOLECULE)&&this.renderMolecule(context,vector,start,end,clip,offset,availableSpace),this.isRenderAs(morpheus.VectorTrack.RENDER.BOX_PLOT)){var barSize=this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)?this.settings.barSize:availableSpace-2;offset++,this.renderBoxPlot(context,vector,start,end,clip,offset,barSize),availableSpace-=offset+=barSize+2}if(this.isRenderAs(morpheus.VectorTrack.RENDER.HEAT_MAP)){barSize=this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)?this.settings.barSize:availableSpace-2;offset++,this.renderHeatMap(context,vector,start,end,clip,barSize),availableSpace-=offset+=barSize+2}if(this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)){barSize=this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)?this.settings.barSize:availableSpace-1;if(this.settings.stackedBar)this.renderStackedBar(context,vector,start,end,clip,offset,barSize);else{var fields=vector.getProperties().get(morpheus.VectorKeys.FIELDS),visibleFieldIndices=vector.getProperties().get(morpheus.VectorKeys.VISIBLE_FIELDS);null!=fields&&null==visibleFieldIndices&&(visibleFieldIndices=morpheus.Util.seq(fields.length)),null!=fields?this.renderUnstackedBar(context,vector,start,end,clip,offset,barSize,visibleFieldIndices):this.renderBar(context,vector,start,end,clip,this.isColumns?fullAvailableSpace-offset-barSize:offset,barSize)}availableSpace-=offset+=barSize+2}(!this.settings.squished&&this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)&&(this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT))&&(context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,this.renderText(context,vector,this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR),this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT),start,end,clip,this.isColumns?fullAvailableSpace-offset:offset),availableSpace-=offset+=this.settings.maxTextWidth+2),this.settings.squished||!this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)||this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT))||(context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,"url"===morpheus.VectorUtil.getDataType(vector)&&(context.fillStyle="blue",this.canvas.style.cursor="pointer"),this.renderText(context,vector,!1,!1,start,end,clip,this.isColumns?fullAvailableSpace-offset:offset))},showPopup:function(e,isHeader){var _this=this,project=this.project,isColumns=this.isColumns,hasSelection=isColumns?project.getColumnSelectionModel().count()>0:project.getRowSelectionModel().count()>0,SORT_SEL_ASC="Sort Heat Map Ascending ",SORT_SEL_DESC="Sort Heat Map Descending ",heatmap=(this.positions,this.heatmap),sectionToItems={Sort:[],Selection:[],Display:[]},customItems=this.heatmap.getPopupItems();customItems&&customItems.length>0&&customItems.forEach(function(item){item.columns===isColumns&&sectionToItems[item.section].push(item)}),sectionToItems.Selection.length>0&&sectionToItems.Selection.push({separator:!0}),sectionToItems.Selection.push({name:"Move To Top"}),this.heatmap.options.menu.Edit&&-1!==this.heatmap.options.menu.Edit.indexOf("Annotate Selected Rows")&&sectionToItems.Selection.push({name:"Annotate Selection"}),sectionToItems.Selection.push({name:"Copy",class:"copy"}),sectionToItems.Selection.push({name:"Invert Selection"}),sectionToItems.Selection.push({name:"Select All"}),sectionToItems.Selection.push({name:"Clear Selection"}),-1!==(isColumns?project.getColumnFilter():project.getRowFilter()).indexOf("Show Selection Only")&&sectionToItems.Selection.push({name:"Show All"}),isHeader||(sectionToItems.Sort.push({name:SORT_SEL_ASC,disabled:!hasSelection}),sectionToItems.Sort.push({name:SORT_SEL_DESC,disabled:!hasSelection}),sectionToItems.Sort.push({name:"Sort Heat Map Descending/Ascending",disabled:!hasSelection}));var dataType=morpheus.VectorUtil.getDataType(this.getFullVector()),arrayFields=this.getFullVector().getProperties().get(morpheus.VectorKeys.FIELDS),isArray=void 0!==arrayFields,isNumber="number"===dataType||"[number]"===dataType;(isNumber||isArray)&&(sectionToItems.Display.push({name:"Format"}),sectionToItems.Display.push({separator:!0}),sectionToItems.Display.push({name:"Show Bar Chart",checked:this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)})),isArray&&(sectionToItems.Display.push({name:"Show Stacked Bar Chart",checked:this.settings.stackedBar}),sectionToItems.Display.push({name:"Show Box Plot",checked:this.isRenderAs(morpheus.VectorTrack.RENDER.BOX_PLOT)}),sectionToItems.Display.push({name:"Choose Fields..."})),"url"!==dataType&&(sectionToItems.Display.push({name:"Show Text",checked:this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT)}),sectionToItems.Display.push({name:"Encode Text Using Color",checked:this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)}),this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)&&sectionToItems.Display.push({name:"Text Color Annotation",checked:null!=this.settings.colorByField}),sectionToItems.Display.push({name:"Encode Text Using Font",checked:this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)}),sectionToItems.Display.push({separator:!0}),sectionToItems.Display.push({name:"Show Color",checked:this.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)}),this.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)&&sectionToItems.Display.push({name:"Color Bar Size..."})),isArray||"url"===dataType||sectionToItems.Display.push({name:"Show Shape",checked:this.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)}),isArray||isNumber||this.isColumns||-1===name.toLowerCase().indexOf("smile")||sectionToItems.Display.push({name:"Show Chemical Structure",checked:this.isRenderAs(morpheus.VectorTrack.RENDER.MOLECULE)}),sectionToItems.Display.push({name:"Show In Tooltip",checked:this.settings.inlineTooltip}),isArray||"url"===dataType||sectionToItems.Display.push({name:"Highlight Matching Values",checked:this.settings.highlightMatchingValues}),(this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)||this.isRenderAs(morpheus.VectorTrack.RENDER.BOX_PLOT))&&(sectionToItems.Display.push({separator:!0}),this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)&&sectionToItems.Display.push({name:"Edit Bar Color..."}),sectionToItems.Display.push({name:"Auto Range"}),sectionToItems.Display.push({name:"Custom Range..."})),(this.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)||this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)||this.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE))&&(sectionToItems.Display.push({separator:!0}),isNumber&&sectionToItems.Display.push({name:"Continuous",checked:!this.getFullVector().getProperties().get(morpheus.VectorKeys.DISCRETE)}),(this.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)&&isArray)&&sectionToItems.Display.push({name:"Edit Colors..."}),this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)&&null!=this.settings.colorByField&&sectionToItems.Display.push({name:"Edit Text Colors..."}),this.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)&&sectionToItems.Display.push({name:"Edit Shapes..."}),this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)&&sectionToItems.Display.push({name:"Edit Fonts..."}),(this.isRenderAs(morpheus.VectorTrack.RENDER.COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_COLOR)||this.isRenderAs(morpheus.VectorTrack.RENDER.BAR)&&isArray)&&sectionToItems.Display.push({name:"Color Key",icon:"fa fa-key"})),this.isRenderAs(morpheus.VectorTrack.RENDER.SHAPE)&&sectionToItems.Display.push({name:"Shape Key",icon:"fa fa-key"}),this.isRenderAs(morpheus.VectorTrack.RENDER.TEXT_AND_FONT)&&sectionToItems.Display.push({name:"Font Key",icon:"fa fa-key"}),sectionToItems.Display.push({separator:!0}),sectionToItems.Display.push({name:"Hide"}),sectionToItems.Display.push({name:"Hide Others",disabled:heatmap.getVisibleTrackNames(this.isColumns).length<=1}),sectionToItems.Display.push({separator:!0}),sectionToItems.Display.push({name:"Delete..."});var items=[];function addSection(name){items.length>0&&items.push({separator:!0}),items=items.concat(sectionToItems[name])}addSection("Sort"),_.each(sectionToItems.Selection,function(item){"Show All"!==item.name&&"Select All"!==item.name&&(item.disabled=!hasSelection)}),isHeader?-1!==this.heatmap.options.toolbar.indexOf("Options")&&addSection("Display"):addSection("Selection"),e.preventDefault&&e.preventDefault(),0!==items.length&&morpheus.Popup.showPopup(items,{x:e.pageX,y:e.pageY},e.target,function(event,item){var customItem;if("Format"===item){var vector=_this.getFullVector(),formatter=vector.getProperties().get(morpheus.VectorKeys.FORMATTER);null!=formatter&&"object"==typeof formatter&&(formatter=morpheus.Util.createNumberFormat(formatter.pattern),vector.getProperties().set(morpheus.VectorKeys.FORMATTER,formatter));var pattern=null!=formatter?formatter.toJSON().pattern:".2f";(formBuilder=new morpheus.FormBuilder).append({name:"number_of_fraction_digits",type:"number",value:morpheus.Util.getNumberFormatPatternFractionDigits(pattern),required:!0,style:"max-width:60px;"}),formBuilder.find("number_of_fraction_digits").on("keyup input",_.debounce(function(){var n=parseInt($(this).val());n>=0&&(vector.getProperties().set(morpheus.VectorKeys.FORMATTER,{pattern:"."+n+"f"}),_this.setInvalid(!0),_this.repaint())},100)),morpheus.FormBuilder.showInModal({title:"Format",close:"Close",html:formBuilder.$form,focus:heatmap.getFocusEl()})}else if("Copy"===item)heatmap.getActionManager().execute(isColumns?"Copy Selected Columns":"Copy Selected Rows");else if("Choose Fields..."===item){var visibleFields,visibleFieldIndices=_this.getFullVector().getProperties().get(morpheus.VectorKeys.VISIBLE_FIELDS);if(null==visibleFieldIndices)visibleFields=arrayFields.slice(0);else{visibleFields=[];for(var i=0;i<visibleFieldIndices.length;i++)visibleFields.push(arrayFields[visibleFieldIndices[i]])}var availableFields=[];for(i=0;i<arrayFields.length;i++)-1===visibleFields.indexOf(arrayFields[i])&&availableFields.push(arrayFields[i]);var leftOptions=[],rightOptions=[];for(i=0;i<availableFields.length;i++)leftOptions.push(new Option(availableFields[i],availableFields[i]));for(i=0;i<visibleFields.length;i++)rightOptions.push(new Option(visibleFields[i],visibleFields[i]));var list=new morpheus.DualList(leftOptions,rightOptions);morpheus.FormBuilder.showOkCancel({title:"Fields",okCallback:function(){for(var visibleFields=list.getOptions(!1),visibleFieldIndices=[],i=0;i<visibleFields.length;i++)visibleFieldIndices.push(arrayFields.indexOf(visibleFields[i]));var fullVector=_this.getFullVector();fullVector.getProperties().set(morpheus.VectorKeys.VISIBLE_FIELDS,visibleFieldIndices);var summaryFunction=fullVector.getProperties().get(morpheus.VectorKeys.ARRAY_SUMMARY_FUNCTION);summaryFunction&&(summaryFunction.indices=visibleFieldIndices);var updatedVector=_this.isColumns?_this.project.getFullDataset().getColumnMetadata().add(_this.name):_this.project.getFullDataset().getRowMetadata().add(_this.name);for(i=0;i<updatedVector.size();i++){var array=fullVector.getValue(i);null!=array&&(array.summary=void 0)}_this.setInvalid(!0),_this.repaint()},content:list.$el})}else if("Text Color Annotation"===item){var formBuilder=new morpheus.FormBuilder,fields=morpheus.MetadataUtil.getMetadataNames(isColumns?_this.project.getFullDataset().getColumnMetadata():_this.project.getFullDataset().getRowMetadata());fields.splice(fields.indexOf(_this.name),1),fields=["(None)"].concat(fields),formBuilder.append({name:"annotation",type:"bootstrap-select",help:"Use another annotation to determine text color",search:!0,options:fields,value:null==_this.settings.colorByField?"(None)":_this.settings.colorByField}),formBuilder.find("annotation").on("change",function(){_this.settings.colorByField=$(this).val(),"(None)"===_this.settings.colorByField&&(_this.settings.colorByField=null),_this.setInvalid(!0),_this.repaint()}),morpheus.FormBuilder.showInModal({title:"Text Color Annotation",close:"Close",html:formBuilder.$form,focus:heatmap.getFocusEl()})}else if("Edit Bar Color..."===item){(formBuilder=new morpheus.FormBuilder).append({name:"bar_color",type:"color",value:_this.settings.barColor,required:!0,style:"max-width:50px;"}),formBuilder.find("bar_color").on("change",function(){_this.settings.barColor=$(this).val(),_this.setInvalid(!0),_this.repaint()}),morpheus.FormBuilder.showInModal({title:"Bar Color",close:"Close",html:formBuilder.$form,focus:heatmap.getFocusEl()})}else if("Color Bar Size..."===item){(formBuilder=new morpheus.FormBuilder).append({name:"size",type:"text",value:_this.settings.colorBarSize,required:!0,style:"max-width:50px;"}),formBuilder.find("size").on("change",function(){var val=parseFloat($(this).val());val>0&&(_this.settings.colorBarSize=val,_this.setInvalid(!0),_this.repaint())}),morpheus.FormBuilder.showInModal({title:"Color Bar Size",close:"Close",html:formBuilder.$form,focus:heatmap.getFocusEl()})}else if("Annotate Selection"===item)heatmap.getActionManager().execute(isColumns?"Annotate Selected Columns":"Annotate Selected Rows");else if("Delete..."===item)morpheus.FormBuilder.showOkCancel({title:"Delete",content:"Are you sure you want to delete "+_this.name+"?",okCallback:function(){var metadata=isColumns?project.getFullDataset().getColumnMetadata():project.getFullDataset().getRowMetadata();metadata.remove(morpheus.MetadataUtil.indexOf(metadata,_this.name));var sortKeys=isColumns?project.getColumnSortKeys():project.getRowSortKeys(),sortKeyIndex=_.indexOf(sortKeys.map(function(key){return key.field}),_this.name);-1!==sortKeyIndex&&(sortKeys.splice(sortKeyIndex,1),isColumns?project.setColumnSortKeys(sortKeys,!0):project.setRowSortKeys(sortKeys,!0));var groupByKeys=isColumns?project.getGroupColumns():project.getGroupRows(),groupByKeyIndex=_.indexOf(groupByKeys.map(function(key){return key.field}),_this.name);-1!==groupByKeyIndex&&(groupByKeys.splice(groupByKeyIndex,1),isColumns?project.setGroupColumns(groupByKeys,!0):project.setGroupRows(groupByKeys,!0)),isColumns?project.trigger("columnTrackRemoved",{vector:_this.getFullVector()}):project.trigger("rowTrackRemoved",{vector:_this.getFullVector()})}});else if("Clear Selection"===item)heatmap.getActionManager().execute(isColumns?"Clear Selected Columns":"Clear Selected Rows");else if("Invert Selection"===item)heatmap.getActionManager().execute(isColumns?"Invert Selected Columns":"Invert Selected Rows");else if("Move To Top"===item)heatmap.getActionManager().execute(isColumns?"Move Selected Columns To Top":"Move Selected Rows To Top");else if("Sort Ascending"===item||"Sort Descending"===item){var sortKey=new morpheus.SortKey(_this.name,"Sort Ascending"===item?morpheus.SortKey.SortOrder.ASCENDING:morpheus.SortKey.SortOrder.DESCENDING);_this.isColumns?_this.project.setColumnSortKeys(morpheus.SortKey.keepExistingSortKeys([sortKey],project.getColumnSortKeys()),!0):_this.project.setRowSortKeys(morpheus.SortKey.keepExistingSortKeys([sortKey],project.getRowSortKeys()),!0)}else if(item==SORT_SEL_ASC||item==SORT_SEL_DESC||"Sort Heat Map Descending/Ascending"===item){var sortOrder;sortOrder=item===SORT_SEL_ASC?morpheus.SortKey.SortOrder.ASCENDING:item===SORT_SEL_DESC?morpheus.SortKey.SortOrder.DESCENDING:morpheus.SortKey.SortOrder.TOP_N,heatmap.sortBasedOnSelection(sortOrder,isColumns,e&&e.shiftKey)}else if("Select All"===item)heatmap.getActionManager().execute(isColumns?"Select All Columns":"Select All Rows");else if("Auto Range"===item)delete _this.settings.min,delete _this.settings.max,delete _this.settings.mid,_this._update(),heatmap.revalidate();else if("Custom Range..."===item){formBuilder=new morpheus.FormBuilder;var items=[{name:"min",required:!0,type:"number",value:_this.settings.min},{name:"mid",required:!0,type:"number",value:_this.settings.mid},{name:"max",required:!0,type:"number",value:_this.settings.max}];_.each(items,function(item){formBuilder.append(item)}),morpheus.FormBuilder.showOkCancel({title:"Range",content:formBuilder.$form,okCallback:function(){_this.settings.min=parseFloat(formBuilder.getValue("min")),_this.settings.mid=parseFloat(formBuilder.getValue("mid")),_this.settings.max=parseFloat(formBuilder.getValue("max")),_this._update(),heatmap.revalidate()}})}else if("Squished"===item)_this.settings.squished=!_this.settings.squished,heatmap.revalidate();else if("Color Key"===item){var size=(legend=new morpheus.HeatMapTrackColorLegend([_this],isColumns?_this.project.getColumnColorModel():_this.project.getRowColorModel())).getPreferredSize();legend.setBounds(size),legend.repaint(),morpheus.FormBuilder.showInModal({title:"Color Key",html:legend.canvas,focus:heatmap.getFocusEl()})}else if("Shape Key"===item){size=(legend=new morpheus.HeatMapTrackShapeLegend([_this],isColumns?_this.project.getColumnShapeModel():_this.project.getRowShapeModel())).getPreferredSize();legend.setBounds(size),legend.repaint(),morpheus.FormBuilder.showInModal({title:"Shape Key",html:legend.canvas,focus:heatmap.getFocusEl()})}else if("Font Key"===item){var legend;size=(legend=new morpheus.HeatMapTrackFontLegend([_this],isColumns?_this.project.getColumnFontModel():_this.project.getRowFontModel())).getPreferredSize();legend.setBounds(size),legend.repaint(),morpheus.FormBuilder.showInModal({title:"Font Key",html:legend.canvas,focus:heatmap.getFocusEl()})}else if("Edit Fonts..."===item)heatmap.getActionManager().execute("Edit Fonts");else if("Edit Shapes..."===item){new morpheus.FormBuilder;var shapeModel=isColumns?_this.project.getColumnShapeModel():_this.project.getRowShapeModel(),chooser=new morpheus.ShapeChooser({map:shapeModel.getMap(_this.name)});chooser.on("change",function(event){shapeModel.setMappedValue(_this.getFullVector(),event.value,event.shape),_this.setInvalid(!0),_this.repaint()}),morpheus.FormBuilder.showInModal({title:"Edit Shapes",html:chooser.$div,close:"Close",focus:heatmap.getFocusEl()})}else if("Edit Text Colors..."===item||"Edit Colors..."===item){var colorModel=isColumns?_this.project.getColumnColorModel():_this.project.getRowColorModel(),colorSchemeChooser=new morpheus.ColorSchemeChooser({isColumns:_this.isColumns,heatMap:_this.heatmap,colorModel:colorModel});colorSchemeChooser.setAnnotationName("Edit Text Colors..."===item?_this.settings.colorByField:_this.getName()),colorSchemeChooser.on("change",function(){_this.setInvalid(!0),_this.repaint()}),morpheus.FormBuilder.showInModal({title:"Edit Colors",html:colorSchemeChooser.$div,close:"Close",focus:heatmap.getFocusEl(),onClose:function(){colorSchemeChooser.off("change")}})}else if("Show In Tooltip"===item)_this.settings.inlineTooltip=!_this.settings.inlineTooltip;else if("Highlight Matching Values"===item)_this.settings.highlightMatchingValues=!_this.settings.highlightMatchingValues;else if(customItem=_.find(customItems,function(customItem){return customItem.name===item&&customItem.columns===isColumns}))if(customItem.task){var task={tabId:_this.heatmap.getTabManager().getActiveTabId()};_this.heatmap.getTabManager().addTask(task),setTimeout(function(){customItem.callback(heatmap),_this.heatmap.getTabManager().removeTask(task)},1)}else customItem.callback(heatmap);else if("Continuous"===item){var discrete=_this.getFullVector().getProperties().get(morpheus.VectorKeys.DISCRETE)||!1;_this.getFullVector().getProperties().set(morpheus.VectorKeys.DISCRETE,!discrete),_this._setChartMinMax(),_this.setInvalid(!0),_this.repaint()}else if("Hide"===item)heatmap.setTrackVisible(_this.name,!1,_this.isColumns),heatmap.revalidate();else if("Hide Others"===item){var names=heatmap.getVisibleTrackNames(_this.isColumns);for(i=0;i<names.length;i++)names[i]!==_this.name&&heatmap.setTrackVisible(names[i],!1,_this.isColumns);heatmap.revalidate()}else if("Show Stacked Bar Chart"===item)_this.settings.stackedBar=!_this.settings.stackedBar,_this._update(),heatmap.revalidate();else{"Show Bar Chart"===item?item=morpheus.VectorTrack.RENDER.BAR:"Show Color"===item?item=morpheus.VectorTrack.RENDER.COLOR:"Show Text"===item?item=morpheus.VectorTrack.RENDER.TEXT:"Encode Text Using Color"===item?item=morpheus.VectorTrack.RENDER.TEXT_AND_COLOR:"Encode Text Using Font"===item?item=morpheus.VectorTrack.RENDER.TEXT_AND_FONT:"Show Chemical Structure"===item?item=morpheus.VectorTrack.RENDER.MOLECULE:"Show Shape"===item?item=morpheus.VectorTrack.RENDER.SHAPE:"Show Arc"===item?item=morpheus.VectorTrack.RENDER.ARC:"Show Box Plot"===item?item=morpheus.VectorTrack.RENDER.BOX_PLOT:console.log("Unknown item "+item);var remove,show=!_this.isRenderAs(item);show?_this.settings.display.push(item):(_this.settings.display.splice(_this.settings.display.indexOf(item),1),item===morpheus.VectorTrack.RENDER.TEXT&&(remove=[morpheus.VectorTrack.RENDER.TEXT_AND_FONT,morpheus.VectorTrack.RENDER.TEXT_AND_COLOR])),remove&&remove.forEach(function(key){var index=_this.settings.display.indexOf(key);-1!==index&&_this.settings.display.splice(index,1)}),_this._update(),heatmap.revalidate(),show&&item===morpheus.VectorTrack.RENDER.TEXT_AND_FONT&&heatmap.getActionManager().execute("Edit Fonts")}})},renderColor:function(context,vector,start,end,clip,offset,continuous){var getColor,isColumns=this.isColumns,positions=this.positions,colorModel=isColumns?this.project.getColumnColorModel():this.project.getRowColorModel(),settings=this.settings,canvasSize=isColumns?this.getUnscaledHeight():this.getUnscaledWidth(),colorBarSize=settings.colorBarSize;if(colorBarSize>canvasSize&&(colorBarSize=canvasSize>=5?canvasSize-1:canvasSize),getColor=continuous?_.bind(colorModel.getContinuousMappedValue,colorModel):_.bind(colorModel.getMappedValue,colorModel),null!=vector.getProperties().get(morpheus.VectorKeys.FIELDS)){var visibleFieldIndices=vector.getProperties().get(morpheus.VectorKeys.VISIBLE_FIELDS);null==visibleFieldIndices&&(visibleFieldIndices=morpheus.Util.seq(vector.getProperties().get(morpheus.VectorKeys.FIELDS).length)),colorBarSize/=visibleFieldIndices.length;for(var nvisibleFieldIndices=visibleFieldIndices.length,i=start;i<end;i++){var array=vector.getValue(i),position=positions.getPosition(i),size=positions.getItemSize(i),_offset=offset;if(null!=array)for(var j=0;j<nvisibleFieldIndices;j++){var color=getColor(vector,value=array[visibleFieldIndices[j]]);context.fillStyle=color,isColumns?(context.beginPath(),context.rect(position,_offset-colorBarSize,size,colorBarSize),context.fill()):(context.beginPath(),context.rect(_offset,position,colorBarSize,size),context.fill()),_offset+=colorBarSize}}}else for(i=start;i<end;i++){var value=vector.getValue(i);position=positions.getPosition(i),size=positions.getItemSize(i),color=getColor(vector,value);context.fillStyle=color,isColumns?(context.beginPath(),context.rect(position,offset-colorBarSize,size,settings.colorBarSize),context.fill()):(context.beginPath(),context.rect(offset,position,colorBarSize,size),context.fill())}},renderShape:function(context,vector,start,end,clip,offset){var isColumns=this.isColumns,positions=this.positions,shapeModel=isColumns?this.project.getColumnShapeModel():this.project.getRowShapeModel(),settings=this.settings,canvasSize=isColumns?this.getUnscaledHeight():this.getUnscaledWidth(),colorBarSize=settings.colorBarSize;colorBarSize>canvasSize&&(colorBarSize=canvasSize>=5?canvasSize-1:canvasSize),context.fillStyle="black",context.strokeStyle="black";var lineWidth=context.lineWidth;context.lineWidth=1;for(var i=start;i<end;i++){var value=vector.getValue(i),position=positions.getPosition(i),itemSize=positions.getItemSize(i),size2=Math.min(colorBarSize,itemSize)/2,shape=shapeModel.getMappedValue(vector,value),x=isColumns?position+itemSize/2:offset+size2,y=isColumns?offset-size2:position+itemSize/2;size2-=.5,morpheus.CanvasUtil.drawShape(context,shape,x,y,size2)}context.lineWidth=lineWidth},renderHeatMap:function(context,vector,start,end,clip,size){this.isColumns;var positions=this.positions;this.project;context.save(),context.lineWidth=1;clip.width,clip.height;for(var colorScheme=this.heatmap.getHeatMapElementComponent().getColorScheme(),drawGrid=this.heatmap.getHeatMapElementComponent().isDrawGrid(),gridColor=this.heatmap.getHeatMapElementComponent().getGridColor(),gridThickness=this.heatmap.getHeatMapElementComponent().getGridThickness(),i=start;i<end;i++){var value=vector.getValue(i);if(null!=value){for(var pix=positions.getPosition(i),itemSize=positions.getItemSize(i),nvalues=value.length,pixPer=size/nvalues,j=0;j<nvalues;j++){var val=value[j];context.fillStyle=colorScheme.getColor(i,-1,val),context.fillRect(j*pixPer,pix,pixPer,itemSize)}if(drawGrid&&itemSize>10){context.strokeStyle=gridColor,context.lineWidth=gridThickness,context.beginPath();for(j=0;j<nvalues;j++){val=value[j];context.rect(j*pixPer,pix,pixPer,itemSize)}context.stroke()}}}context.restore()},renderArc:function(context,vector,start,end,clip,size){var isColumns=this.isColumns,positions=this.positions;this.project;context.save(),context.lineWidth=1;positions.getPosition(positions.getLength()-1),positions.getItemSize(positions.getLength()-1);context.translate(clip.x,clip.y);clip.width,clip.height;for(var i=start;i<end;i++){var value=vector.getValue(i);if(null!=value)for(var startPix=positions.getPosition(i)+positions.getItemSize(i)/2,j=0,nindices=value.length;j<nindices;j++){var viewIndex=value[j],endPix=positions.getPosition(viewIndex)+positions.getItemSize(viewIndex)/2,midPix=(endPix+startPix)/2,arcRadius=(Math.abs(i-viewIndex),size);isColumns?(context.beginPath(),context.moveTo(startPix,arcRadius),context.quadraticCurveTo(midPix,1,endPix,arcRadius)):(console.log(i,viewIndex,startPix,endPix),context.beginPath(),context.moveTo(1,startPix),context.quadraticCurveTo(arcRadius,midPix,1,endPix)),context.stroke()}}context.restore()},sdfToSvg:function(sdf,width,height){this.jsme||"undefined"==typeof JSApplet||(this.jsmeId=_.uniqueId("m"),this.$jsmeDiv=$('<div id="'+this.jsmeId+'" style="position:absolute;left:-10000px;top:-10000px;"></div>').appendTo($(document.body)),this.jsme=new JSApplet.JSME(this.jsmeId,"380px","340px",{})),this.jsme.readMolFile(sdf);var svg=$("#"+this.jsmeId+" > div > div > div:nth-child(2) > svg"),svgWidth=svg.width.baseVal.value,svgHeight=svg.height.baseVal.value;return'<svg><g transform="scale('+Math.min(width/svgWidth,height/svgHeight)+')">'+svg.innerHTML+"</g></svg>"},renderMolecule:function(context,vector,start,end,clip,offset){this.isColumns;var positions=this.positions;context.fillStyle=morpheus.CanvasUtil.FONT_COLOR,context.strokeStyle="black";for(var width=this.getUnscaledWidth(),customUrlProvider=void 0!==this.heatmap.options.structureUrlProvider,dummyTarget={childNodes:[],getContext:function(){return context}},i=start;i<end;i++){var spanEnd=this.spanMap.get(i);if(void 0!==spanEnd){var startPix=positions.getPosition(i),size=positions.getPosition(spanEnd-1)+positions.getSize()-startPix,value=vector.getValue(i),cache=this.moleculeCache[value];if(cache)if(customUrlProvider){if(cache.complete){var scaleFactor=Math.min(size/cache.height,width/cache.width),scaledWidth=cache.width*scaleFactor,scaledHeight=cache.height*scaleFactor;startPix+=(cache.height-scaledHeight)/2;try{context.drawImage(cache,offset,startPix,scaledWidth,scaledHeight)}catch(x){}}}else{var text=this.sdfToSvg(cache,width,size);canvg(dummyTarget,text,{ignoreMouse:!0,ignoreAnimation:!0,offsetY:startPix,ignoreClear:!0,ignoreDimensions:!0})}}}},createChartScale:function(availableSpace){var domain,range;return this.settings.mid!==this.settings.min&&this.settings.mid!==this.settings.max?(domain=[this.settings.min,this.settings.mid,this.settings.max],range=this.isColumns?[availableSpace,availableSpace/2,0]:[0,availableSpace/2,availableSpace]):(domain=[this.settings.min,this.settings.max],range=this.isColumns?[availableSpace,0]:[0,availableSpace]),d3.scale.linear().domain(domain).range(range).clamp(!0)},renderBar:function(context,vector,start,end,clip,offset,availableSpace){var isColumns=this.isColumns,positions=this.positions;context.fillStyle=this.settings.barColor;for(var scale=this.createChartScale(availableSpace),midPix=scale(this.settings.mid),discrete=(this.settings,vector.getProperties().get(morpheus.VectorKeys.DISCRETE)&&null!=this.discreteValueMap),colorByVector=null!=this.settings.colorByField?this.getVector(this.settings.colorByField):null,colorModel=isColumns?this.project.getColumnColorModel():this.project.getRowColorModel(),i=start;i<end;i++){var value=vector.getValue(i);discrete&&(value=this.discreteValueMap.get(value));var position=positions.getPosition(i),size=positions.getItemSize(i),scaledValue=scale(value);null!==colorByVector&&(context.fillStyle=colorModel.getMappedValue(colorByVector,colorByVector.getValue(i))),isColumns?(context.beginPath(),context.rect(position,Math.min(midPix,scaledValue)+offset,size,Math.abs(midPix-scaledValue)),context.fill()):(context.beginPath(),context.rect(offset+Math.min(midPix,scaledValue),position,Math.abs(midPix-scaledValue),size),context.fill())}},renderBoxPlot:function(context,vector,start,end,clip,offset,availableSpace){var isColumns=this.isColumns,positions=this.positions;context.strokeStyle="black",context.save(),context.translate(offset,0);for(var scale=this.createChartScale(availableSpace),visibleFieldIndices=vector.getProperties().get(morpheus.VectorKeys.VISIBLE_FIELDS),i=(null!=this.settings.colorByField&&this.getVector(this.settings.colorByField),isColumns?this.project.getColumnColorModel():this.project.getRowColorModel(),start);i<end;i++){var array=vector.getValue(i);if(null!=array){var itemSize=positions.getItemSize(i);if(itemSize<=3)continue;var pix=positions.getPosition(i),center=((start=pix+1)+(end=pix+itemSize-1))/2,_itemSize=itemSize-2,lineHeight=Math.max(2,_itemSize-8),box=array.summary;if(null==box){var v=morpheus.VectorUtil.arrayAsVector(array);box=morpheus.BoxPlotItem(null!=visibleFieldIndices?new morpheus.SlicedVector(v,visibleFieldIndices):v),array.summary=box}context.fillStyle="#bdbdbd",isColumns||(context.fillRect(Math.min(scale(box.q1),scale(box.q3)),start,Math.abs(scale(box.q1)-scale(box.q3)),_itemSize),context.fillRect(Math.min(scale(box.q1),scale(box.lowerAdjacentValue)),center-lineHeight/2,Math.abs(scale(box.q1)-scale(box.lowerAdjacentValue)),lineHeight),context.fillRect(Math.min(scale(box.q3),scale(box.upperAdjacentValue)),center-lineHeight/2,Math.abs(scale(box.q3)-scale(box.upperAdjacentValue)),lineHeight),context.fillStyle="#31a354",context.fillRect(scale(box.median)-3,start,3,end-start),context.fillStyle="#636363")}}context.restore()},renderStackedBar:function(context,vector,start,end,clip,offset,availableSpace){var isColumns=this.isColumns,positions=this.positions,scale=this.createChartScale(availableSpace),midPix=scale(this.settings.mid),colorModel=(this.settings,isColumns?this.project.getColumnColorModel():this.project.getRowColorModel());context.strokeStyle="black",context.lineWidth=2;for(var i=start;i<end;i++){var array=vector.getValue(i);if(null!=array){for(var position=positions.getPosition(i),size=positions.getItemSize(i),positivePairs=[],negativePairs=[],j=0,length=array.length;j<length;j++){(value=array[j])>=this.settings.mid?positivePairs.push({value:value,index:j}):value<0&&negativePairs.push({value:value,index:j})}var positiveIndices=morpheus.Util.indexSortPairs(positivePairs,!1);for(j=0,length=positiveIndices.length;j<length;j++){var value=array[index=positiveIndices[j]],color=colorModel.getMappedValue(vector,index);context.fillStyle=color;var scaledValue=scale(value),nextScaledValue=j===length-1?midPix:scale(array[positiveIndices[j+1]]);isColumns?(context.beginPath(),context.rect(position,Math.min(nextScaledValue,scaledValue),size,Math.abs(nextScaledValue-scaledValue)),context.fill()):(context.beginPath(),context.rect(offset+Math.min(nextScaledValue,scaledValue),position,Math.abs(nextScaledValue-scaledValue),size),context.fill())}var negativeIndices=morpheus.Util.indexSortPairs(negativePairs,!0);for(j=0,length=negativeIndices.length;j<length;j++){var index;value=array[index=negativeIndices[j]],color=colorModel.getMappedValue(vector,index);context.fillStyle=color;scaledValue=scale(value),nextScaledValue=j===length-1?midPix:scale(array[negativeIndices[j+1]]);isColumns?(context.beginPath(),context.rect(position,Math.min(nextScaledValue,scaledValue),size,Math.abs(nextScaledValue-scaledValue)),context.fill()):(context.beginPath(),context.rect(offset+Math.min(nextScaledValue,scaledValue),position,Math.abs(nextScaledValue-scaledValue),size),context.fill())}}}context.lineWidth=1},renderUnstackedBar:function(context,vector,start,end,clip,offset,availableSpace,fieldIndices){var isColumns=this.isColumns,positions=this.positions,nvalues=fieldIndices.length,colorModel=(this.settings,isColumns?this.project.getColumnColorModel():this.project.getRowColorModel());context.fillStyle=this.settings.barColor;var barWidth=(availableSpace-0*(nvalues-1))/nvalues,colorByVector=null!=this.settings.colorByField?this.getVector(this.settings.colorByField):null;context.strokeStyle="white";for(var i=start;i<end;i++){var array=vector.getValue(i);if(null!=array)for(var position=positions.getPosition(i),itemSize=positions.getItemSize(i),scale=this.createChartScale(itemSize-1),midPix=scale(this.settings.mid),xpix=0,j=0;j<nvalues;j++){var value=array[fieldIndices[j]];if(null!=colorByVector){var colorByArray=colorByVector.getValue(i),color=colorModel.getMappedValue(colorByVector,null!=colorByArray?colorByArray[fieldIndices[j]]:null);context.fillStyle=color}var scaledValue=scale(value);if(isColumns)context.beginPath(),context.rect(Math.min(midPix,scaledValue),offset+xpix,Math.abs(midPix-scaledValue),barWidth),context.fill();else{context.beginPath();var barHeight=Math.abs(midPix-scaledValue),ypix=position+itemSize-Math.max(midPix,scaledValue);context.rect(offset+xpix,ypix,barWidth,barHeight),context.fill()}xpix+=barWidth+0}}},renderText:function(context,vector,isColor,isFont,start,end,clip,offset,canvasSize){context.textBaseline="middle","undefined"!=typeof C2S&&context instanceof C2S&&context.translate(this.isColumns?2:0,this.isColumns?0:2);var positions=this.positions,isColumns=this.isColumns,colorModel=isColumns?this.project.getColumnColorModel():this.project.getRowColorModel(),fontModel=isColumns?this.project.getColumnFontModel():this.project.getRowFontModel();isColumns&&context.translate(clip.x,clip.y);var getColor,colorByVector=null!=this.settings.colorByField?this.getVector(this.settings.colorByField):vector;getColor=colorByVector.getProperties().get(morpheus.VectorKeys.DISCRETE)?_.bind(colorModel.getMappedValue,colorModel):_.bind(colorModel.getContinuousMappedValue,colorModel);for(var fontVector=null!=this.settings.fontField?this.getVector(this.settings.fontField):vector,toStringFunction=morpheus.VectorTrack.vectorToString(vector),font=context.font,i=start;i<end;i++){var size=this.positions.getItemSize(i);if(!(size<6)){var value=vector.getValue(i);if(null!=value){var stringValue=toStringFunction(value),position=positions.getPosition(i);isColor&&(context.fillStyle=getColor(colorByVector,colorByVector.getValue(i))),isFont&&(context.font=fontModel.getMappedValue(fontVector,fontVector.getValue(i)).weight+" "+font),isColumns?(context.save(),context.translate(position+size/2-clip.x,offset-clip.y),context.rotate(-Math.PI/2),context.fillText(stringValue,0,0),context.restore()):context.fillText(stringValue,offset,position+size/2)}}}context.font=font}},morpheus.Util.extend(morpheus.VectorTrack,morpheus.AbstractCanvas),morpheus.VectorTrack.MAX_FONT_SIZE=18,morpheus.AverageLinkage=function(nelements,distmatrix){var j,n,clusterid,number,result;clusterid=[],number=[],result=[];for(var i=0;i<nelements-1;i++)result[i]={left:0,right:0,distance:0};for(j=0;j<nelements;j++)number[j]=1,clusterid[j]=j;var r={};for(n=nelements;n>1;n--){morpheus.HCluster.findClosestPair(n,distmatrix,r),result[nelements-n]={},result[nelements-n].distance=r.distance;var is=r.ip,js=r.jp;result[nelements-n].left=clusterid[is],result[nelements-n].right=clusterid[js];var sum=number[is]+number[js];for(j=0;j<js;j++)distmatrix[js][j]=distmatrix[is][j]*number[is]+distmatrix[js][j]*number[js],distmatrix[js][j]/=sum;for(j=js+1;j<is;j++)distmatrix[j][js]=distmatrix[is][j]*number[is]+distmatrix[j][js]*number[js],distmatrix[j][js]/=sum;for(j=is+1;j<n;j++)distmatrix[j][js]=distmatrix[j][is]*number[is]+distmatrix[j][js]*number[js],distmatrix[j][js]/=sum;for(j=0;j<is;j++)distmatrix[is][j]=distmatrix[n-1][j];for(j=is+1;j<n-1;j++)distmatrix[j][is]=distmatrix[n-1][j];number[js]=sum,number[is]=number[n-1],clusterid[js]=n-nelements-1,clusterid[is]=clusterid[n-1]}return result},morpheus.CollapseDataset=function(dataset,collapseToFields,summarizeFunction,shallowCopy,filterFunction){for(var vectors=[],i=0;i<collapseToFields.length;i++){var v=dataset.getRowMetadata().getByName(collapseToFields[i]);if(!v)throw collapseToFields[i]+" not found. Available fields are "+morpheus.MetadataUtil.getMetadataNames(dataset.getRowMetadata());vectors.push(v)}var percentPassedSeriesIndex,idToIndices=morpheus.VectorUtil.createValuesToIndicesMap(vectors),collapsedDataset=new morpheus.Dataset({name:dataset.getName(),rows:idToIndices.size(),columns:dataset.getColumnCount(),dataType:"Float32"});null!=filterFunction&&(percentPassedSeriesIndex=collapsedDataset.addSeries({name:"percent"})),shallowCopy?collapsedDataset.setColumnMetadata(dataset.getColumnMetadata()):morpheus.MetadataUtil.copy(dataset.getColumnMetadata(),collapsedDataset.getColumnMetadata());var nfields=collapseToFields.length,collapseToVectors=[];for(i=0;i<nfields;i++)collapseToVectors.push(collapsedDataset.getRowMetadata().add(collapseToFields[i]));var counter=0;if(idToIndices.forEach(function(rowIndices,key){for(var slice=new morpheus.SlicedDatasetView(dataset,rowIndices,null),view=new morpheus.DatasetColumnView(slice),j=0,ncols=dataset.getColumnCount();j<ncols;j++){if(view.setIndex(j),null!=filterFunction){for(var npass=0,i=0,size=view.size();i<size;i++)filterFunction(view.getValue(i))&&npass++;collapsedDataset.setValue(counter,j,npass/view.size()*100,percentPassedSeriesIndex)}collapsedDataset.setValue(counter,j,summarizeFunction(view))}for(i=0;i<nfields;i++){var collapsedToVector=collapseToVectors[i],vector=vectors[i];collapsedToVector.setValue(counter,vector.getValue(rowIndices[0]))}counter++}),1===nfields){var newVector=collapseToVectors[0];vectors[0].getProperties().forEach(function(val,key){morpheus.VectorKeys.COPY_IGNORE.has(key)||newVector.properties.set(key,val)})}return collapsedDataset},morpheus.CompleteLinkage=function(nelements,distmatrix){for(var j,n,clusterid=[],result=[],i=0;i<nelements-1;i++)result[i]={left:0,right:0,distance:0};for(j=0;j<nelements;j++)clusterid[j]=j;var r={};for(n=nelements;n>1;n--){morpheus.HCluster.findClosestPair(n,distmatrix,r),result[nelements-n].distance=r.distance;var is=r.ip,js=r.jp;for(j=0;j<js;j++)distmatrix[js][j]=Math.max(distmatrix[is][j],distmatrix[js][j]);for(j=js+1;j<is;j++)distmatrix[j][js]=Math.max(distmatrix[is][j],distmatrix[j][js]);for(j=is+1;j<n;j++)distmatrix[j][js]=Math.max(distmatrix[j][is],distmatrix[j][js]);for(j=0;j<is;j++)distmatrix[is][j]=distmatrix[n-1][j];for(j=is+1;j<n-1;j++)distmatrix[j][is]=distmatrix[n-1][j];result[nelements-n].left=clusterid[is],result[nelements-n].right=clusterid[js],clusterid[js]=n-nelements-1,clusterid[is]=clusterid[n-1]}return result},morpheus.HClusterGroupBy=function(dataset,groupByFieldNames,distanceFunction,linkageMethod){dataset.getRowMetadata();var vectors=morpheus.MetadataUtil.getVectors(dataset.getRowMetadata(),groupByFieldNames),idToIndices=morpheus.VectorUtil.createValuesToIndicesMap(vectors),reorderedIndices=[],offset=0,root={id:-1,children:[],height:0},tree={maxHeight:0,rootNode:root,leafNodes:[],nLeafNodes:0};idToIndices.forEach(function(rowIndices,id){for(var hcl,originalIndicesForGroup=idToIndices.get(id),subset=new morpheus.SlicedDatasetView(dataset,originalIndicesForGroup,null),distanceMatrix=morpheus.HCluster.computeDistanceMatrix(subset,distanceFunction),reorderedGroupIndices=(hcl=new morpheus.HCluster(distanceMatrix,linkageMethod)).reorderedIndices,i=0,rows=subset.getRowCount();i<rows;i++){var originalIndex=originalIndicesForGroup[reorderedGroupIndices[i]];reorderedIndices.push(originalIndex)}morpheus.DendrogramUtil.dfs(hcl.tree.rootNode,function(node){return node.index+=offset,node.minIndex+=offset,node.maxIndex+=offset,node.id+=offset,!0}),0===hcl.tree.leafNodes.length?tree.leafNodes=tree.leafNodes.concat([hcl.tree.rootNode]):tree.leafNodes=tree.leafNodes.concat(hcl.tree.leafNodes),root.children.push(hcl.tree.rootNode),isNaN(hcl.tree.maxHeight)||(tree.maxHeight=Math.max(tree.maxHeight,hcl.tree.maxHeight)),offset+=subset.getRowCount()}),tree.nLeafNodes=tree.leafNodes.length,tree.rootNode.height=tree.maxHeight,this.tree=tree,this.reorderedIndices=reorderedIndices},morpheus.HCluster=function(distmatrix,linkageAlgorithm){var nelements=distmatrix.length,nNodes=nelements-1;if(-1===nNodes){return this.tree={maxHeight:0,rootNode:{id:0,height:0,index:0,minIndex:0,maxIndex:0,depth:0},leafNodes:[],nLeafNodes:0},void(this.reorderedIndices=[0])}for(var tree=linkageAlgorithm(nelements,distmatrix),nodeorder=[],nodecounts=[],order=[],nodeID=[],i=0;i<nelements;i++)order[i]=i;var leftIds=[],rightIds=[];for(i=0;i<nNodes;i++){var order1,order2,counts1,counts2,ID1,ID2,min1=tree[i].left,min2=tree[i].right;if(nodeID[i]=nNodes+(i+2),min1<0){var index1=-min1-1;order1=nodeorder[index1],counts1=nodecounts[index1],ID1=nodeID[index1],tree[i].distance=Math.max(tree[i].distance,tree[index1].distance)}else order1=order[min1],counts1=1,ID1=min1;if(min2<0){var index2=-min2-1;order2=nodeorder[index2],counts2=nodecounts[index2],ID2=nodeID[index2],tree[i].distance=Math.max(tree[i].distance,tree[index2].distance)}else order2=order[min2],counts2=1,ID2=min2;leftIds[i]=ID1,rightIds[i]=ID2,nodecounts[i]=counts1+counts2,nodeorder[i]=(counts1*order1+counts2*order2)/(counts1+counts2)}for(var reorderedIndices=morpheus.HCluster.treeSort(nNodes,order,nodeorder,nodecounts,tree),idToIndex={},length=(i=0,reorderedIndices.length);i<length;i++){idToIndex[index=reorderedIndices[i]]=i}var node,nodeIdToNode={};for(i=0,length=nodeID.length;i<length;i++){var id=nodeID[i],leftId=leftIds[i],lnode=nodeIdToNode[leftId];if(void 0===lnode){lnode={id:leftId};var index=idToIndex[leftId];lnode.index=index,lnode.minIndex=index,lnode.maxIndex=index,nodeIdToNode[lnode.id]=lnode}var rightId=rightIds[i],rnode=nodeIdToNode[rightId];if(void 0===rnode){rnode={id:rightId};index=idToIndex[rightId];rnode.index=index,rnode.minIndex=index,rnode.maxIndex=index,nodeIdToNode[rnode.id]=rnode}(node={id:id,children:lnode.index<rnode.index?[lnode,rnode]:[rnode,lnode],height:tree[i].distance,index:(rnode.index+lnode.index)/2}).minIndex=Math.min(rnode.minIndex,lnode.minIndex),node.maxIndex=Math.max(rnode.maxIndex,lnode.maxIndex),lnode.parent=node,rnode.parent=node,nodeIdToNode[node.id]=node}this.reorderedIndices=reorderedIndices;var leafNodes=[];for(i=0,length=reorderedIndices.length;i<length;i++){var leaf=nodeIdToNode[reorderedIndices[i]];leaf.height=0,leafNodes.push(leaf)}morpheus.DendrogramUtil.setNodeDepths(node),this.tree={maxHeight:node.height,rootNode:node,leafNodes:leafNodes,nLeafNodes:leafNodes.length}},morpheus.HCluster.findClosestPair=function(n,distmatrix,r){var i,j,temp,distance=distmatrix[1][0],ip=1,jp=0;for(i=1;i<n;i++)for(j=0;j<i;j++)(temp=distmatrix[i][j])<distance&&(distance=temp,ip=i,jp=j);r.distance=distance,r.ip=ip,r.jp=jp},morpheus.HCluster.computeDistanceMatrix=function(dataset,distanceFunction){for(var matrix=[],n=dataset.getRowCount(),i=1;i<n;i++)matrix[i]=new Float32Array(i);if(0===distanceFunction)for(i=1;i<n;i++)for(var j=0;j<i;j++)matrix[i][j]=dataset.getValue(i,j);else if(1===distanceFunction){var max=-Number.MAX_VALUE;for(i=1;i<n;i++)for(j=0;j<i;j++){var value=dataset.getValue(i,j);isNaN(value)||(max=Math.max(value,max))}for(i=1;i<n;i++)for(j=0;j<i;j++)matrix[i][j]=max-dataset.getValue(i,j)}else{var list1=new morpheus.DatasetRowView(dataset),list2=new morpheus.DatasetRowView(dataset);for(i=1;i<n;i++){list1.setIndex(i);for(j=0;j<i;j++)matrix[i][j]=distanceFunction(list1,list2.setIndex(j))}}return matrix},morpheus.HCluster.treeSort=function(nNodes,order,nodeorder,nodecounts,tree){var i,nElements=nNodes+1,neworder=[],clusterids=[];for(i=0;i<nElements;i++)clusterids[i]=i,neworder[i]=0;for(i=0;i<nNodes;i++){var i1=tree[i].left,i2=tree[i].right,order1=i1<0?nodeorder[-i1-1]:order[i1],order2=i2<0?nodeorder[-i2-1]:order[i2],count1=i1<0?nodecounts[-i1-1]:1,count2=i2<0?nodecounts[-i2-1]:1;if(i1<i2){var increase=order1<order2?count1:count2;for(j=0;j<nElements;j++){(clusterid=clusterids[j])==i1&&order1>=order2&&(neworder[j]+=increase),clusterid==i2&&order1<order2&&(neworder[j]+=increase),clusterid!=i1&&clusterid!=i2||(clusterids[j]=-i-1)}}else{var j;increase=order1<=order2?count1:count2;for(j=0;j<nElements;j++){var clusterid;(clusterid=clusterids[j])==i1&&order1>order2&&(neworder[j]+=increase),clusterid==i2&&order1<=order2&&(neworder[j]+=increase),clusterid!=i1&&clusterid!=i2||(clusterids[j]=-i-1)}}}return morpheus.Util.indexSort(neworder,!0)},morpheus.KMeansPlusPlusClusterer=function(k,maxIterations,distanceFunction){var distance=function(points1,points2){return distanceFunction(points1.getPoint(),points2.getPoint())};function nextInt(upperBound){return 0|Math.floor(Math.random()*upperBound)}function PointWrapper(point){this.getPoint=function(){return point}}function CentroidCluster(center){var centroidPoints=[];this.addPoint=function(p){centroidPoints.push(p)},this.getPoints=function(){return centroidPoints},this.getCenter=function(){return center}}function cluster(points){if(points.length<k)throw"Too many clusters";var clusters=function(points){for(var pointList=points,numPoints=pointList.length,taken=new Array(numPoints),i=0;i<taken.length;i++)taken[i]=!1;var resultSet=[],firstPointIndex=nextInt(numPoints),firstPoint=pointList[firstPointIndex];resultSet.push(new CentroidCluster(firstPoint)),taken[firstPointIndex]=!0;for(var minDistSquared=new Float32Array(numPoints),i=0;i<numPoints;i++)if(i!==firstPointIndex){var d=distance(firstPoint,pointList[i]);minDistSquared[i]=d*d}for(;resultSet.length<k;){for(var distSqSum=0,i=0;i<numPoints;i++)taken[i]||(distSqSum+=minDistSquared[i]);for(var r=Math.random()*distSqSum,nextPointIndex=-1,sum=0,i=0;i<numPoints;i++)if(!taken[i]&&(sum+=minDistSquared[i])>=r){nextPointIndex=i;break}if(-1===nextPointIndex)for(var i=numPoints-1;i>=0;i--)if(!taken[i]){nextPointIndex=i;break}if(!(nextPointIndex>=0))break;var p=pointList[nextPointIndex];if(resultSet.push(new CentroidCluster(p)),taken[nextPointIndex]=!0,resultSet.length<k)for(var j=0;j<numPoints;j++)if(!taken[j]){var d=distance(p,pointList[j]),d2=d*d;d2<minDistSquared[j]&&(minDistSquared[j]=d2)}}return resultSet}(points),assignments=new Int32Array(points.length);assignPointsToClusters(clusters,points,assignments);for(var max=maxIterations<0?Number.MAX_VALUE:maxIterations,count=0;count<max;count++){for(var emptyCluster=!1,newClusters=[],clusterIndex=0;clusterIndex<clusters.length;clusterIndex++){var newCenter,cluster=clusters[clusterIndex];0===cluster.getPoints().length?(newCenter=getPointFromLargestVarianceCluster(clusters),emptyCluster=!0):newCenter=centroidOf(cluster.getPoints(),cluster.getCenter().getPoint().size()),newClusters.push(new CentroidCluster(newCenter))}if(clusters=newClusters,0===assignPointsToClusters(newClusters,points,assignments)&&!emptyCluster)return clusters}return clusters}function assignPointsToClusters(clusters,points,assignments){for(var assignedDifferently=0,pointIndex=0,i=0;i<points.length;i++){var p=points[i],clusterIndex=getNearestCluster(clusters,p);clusterIndex!=assignments[pointIndex]&&assignedDifferently++,clusters[clusterIndex].addPoint(p),assignments[pointIndex++]=clusterIndex}return assignedDifferently}function getPointFromLargestVarianceCluster(clusters){for(var maxVariance=-Number.MAX_VALUE,selected=null,clusterIndex=0;clusterIndex<clusters.length;clusterIndex++){var cluster=clusters[clusterIndex];if(cluster.getPoints().length>0){for(var center=cluster.getCenter(),points=cluster.getPoints(),distances=new Float32Array(points.length),i=0;i<points.length;i++)distances[i]=distance(points[i],center);var variance=morpheus.Variance(morpheus.VectorUtil.arrayAsVector(distances));variance>maxVariance&&(maxVariance=variance,selected=cluster)}}if(null==selected)throw"All clusters are empty";var selectedPoints=selected.getPoints();return selectedPoints.splice(nextInt(selectedPoints.length),1)}function getNearestCluster(clusters,point){for(var minDistance=Number.MAX_VALUE,clusterIndex=0,minCluster=0,i=0;i<clusters.length;i++){var c=clusters[i],d=distance(point,c.getCenter());d<minDistance&&(minDistance=d,minCluster=clusterIndex),clusterIndex++}return minCluster}function centroidOf(points,dimension){for(var centroid=new Float32Array(dimension),i=0;i<centroid.length;i++){for(var sum=0,count=0,pointIndex=0;pointIndex<points.length;pointIndex++){var val=points[pointIndex].getPoint().getValue(i);isNaN(val)||(sum+=val,count++)}centroid[i]=sum/count}return new PointWrapper(morpheus.VectorUtil.arrayAsVector(centroid))}this.execute=function(vectors){for(var points=[],npoints=vectors.length,i=0;i<npoints;i++){var p=new PointWrapper(vectors[i]);p.i=i,points.push(p)}return cluster(points)},this.cluster=cluster},morpheus.PermutationPValues=function(dataset,aIndices,bIndices,numPermutations,f,continuousList){var permuter,permutationScore,numRows=dataset.getRowCount(),scores=new Float32Array(numRows);if(null!=aIndices){var list1=new morpheus.DatasetRowView(new morpheus.SlicedDatasetView(dataset,null,aIndices)),list2=new morpheus.DatasetRowView(new morpheus.SlicedDatasetView(dataset,null,bIndices));dataset=new morpheus.SlicedDatasetView(dataset,null,aIndices.concat(bIndices)),permuter=new morpheus.UnbalancedPermuter(aIndices.length,bIndices.length),(permutationScore=new morpheus.TwoClassPermutationScore).init(dataset,f);for(var i=0;i<numRows;i++)scores[i]=f(list1.setIndex(i),list2.setIndex(i))}else{permuter=new morpheus.UnbalancedContinuousPermuter(continuousList.size()),(permutationScore=new morpheus.ContinuousPermutationScore(continuousList)).init(dataset,f);var list=new morpheus.DatasetRowView(dataset);for(i=0;i<numRows;i++)scores[i]=f(continuousList,list.setIndex(i))}for(var rowSpecificPValues=new Float32Array(numRows),permutationIndex=0;permutationIndex<numPermutations;permutationIndex++){permutationScore.setPermutation(permuter.next());for(i=0;i<numRows;i++){permutationScore.getScore(i)>=scores[i]&&rowSpecificPValues[i]++}}var N=numPermutations,kArray=new Uint32Array(numRows);for(i=0;i<numRows;i++){var p,k=rowSpecificPValues[i];kArray[i]=k;var oneMinusP=1-(p=(k+1)/(N+2));if(oneMinusP<p&&(p=oneMinusP),0===(p*=2)){for(var val=dataset.getValue(i,0),flat=!0,j=1,cols=dataset.getColumnCount();j<cols&&flat;j++)dataset.getValue(i,j)!=val&&(flat=!1);flat&&(p=1)}rowSpecificPValues[i]=p}this.rowSpecificPValues=rowSpecificPValues,this.k=kArray,this.fdr=morpheus.FDR_BH(rowSpecificPValues),this.scores=scores},morpheus.PermutationPValues.prototype={getBonferroni:function(index){return Math.min(this.rowSpecificPValues[index]*this.numRows,1)}},morpheus.UnbalancedContinuousPermuter=function(size){for(var indices=new Uint32Array(size),i=0;i<indices.length;i++)indices[i]=i;var n=indices.length;this.next=function(){for(var i=n-1;i>=1;i--){var j=(min=0,max=i,Math.floor(Math.random()*(max-min+1))+min),tmp=indices[j];indices[j]=indices[i],indices[i]=tmp}var min,max;return indices}},morpheus.UnbalancedPermuter=function(numClassZero,numClassOne){for(var assignments=new Uint32Array(numClassZero+numClassOne),indices=new Uint32Array(numClassZero+numClassOne),i=0;i<indices.length;i++)indices[i]=i;var n=indices.length;this.next=function(){for(var i=n-1;i>=1;i--){var j=(min=0,max=i,Math.floor(Math.random()*(max-min+1))+min),tmp=indices[j];indices[j]=indices[i],indices[i]=tmp}var min,max;for(i=0;i<n;i++)assignments[i]=0;for(i=0;i<numClassOne;i++)assignments[indices[i]]=1;return assignments}},morpheus.TwoClassPermutationScore=function(){this.classZeroView=null,this.classOneView=null},morpheus.TwoClassPermutationScore.prototype={getScore:function(index){return this.classZeroView.setIndex(index),this.classOneView.setIndex(index),this.f(this.classZeroView,this.classOneView)},init:function(dataset,f){this.dataset=dataset,this.classZeroView=new morpheus.DatasetRowView(dataset),this.classOneView=new morpheus.DatasetRowView(dataset),this.f=f},setPermutation:function(permutedAssignments){for(var zeroIndices=[],oneIndices=[],i=0,length=permutedAssignments.length;i<length;i++)0===permutedAssignments[i]?zeroIndices.push(i):oneIndices.push(i);this.classZeroView.setDataset(new morpheus.SlicedDatasetView(this.dataset,null,zeroIndices)),this.classOneView.setDataset(new morpheus.SlicedDatasetView(this.dataset,null,oneIndices))}},morpheus.ContinuousPermutationScore=function(referenceList){this.referenceList=referenceList},morpheus.ContinuousPermutationScore.prototype={getScore:function(index){return this.datasetRowView.setIndex(index),this.f(this.referenceListView,this.datasetRowView)},init:function(dataset,f){this.dataset=dataset,this.referenceListView=null,this.datasetRowView=new morpheus.DatasetRowView(dataset),this.f=f},setPermutation:function(indices){this.referenceListView=new morpheus.SlicedVector(this.referenceList,indices)}},morpheus.Ranking=function(values){for(var ranks=[],i=0,length=values.length;i<length;i++)ranks.push({value:values[i],position:i});if(0===ranks.length)return[];ranks.sort(function(a,b){return a.value<b.value?-1:a.value===b.value?0:1});var out=[],pos=1;out[ranks[0].position]=pos;var tiesTrace=[];tiesTrace.push(ranks[0].position);for(i=1;i<ranks.length;i++)ranks[i].value>ranks[i-1].value?(pos=i+1,tiesTrace.length>1&&morpheus.Ranking.fillAverage(out,tiesTrace),(tiesTrace=[]).push(ranks[i].position)):tiesTrace.push(ranks[i].position),out[ranks[i].position]=pos;return tiesTrace.length>1&&morpheus.Ranking.fillAverage(out,tiesTrace),out},morpheus.Ranking.fill=function(data,tiesTrace,value){for(var i=0,length=tiesTrace.length;i<length;i++)data[tiesTrace[i]]=value},morpheus.Ranking.fillAverage=function(ranks,tiesTrace){var c=ranks[tiesTrace[0]],length=tiesTrace.length;morpheus.Ranking.fill(ranks,tiesTrace,(2*c+length-1)/2)},morpheus.SingleLinkage=function(nelements,distmatrix){var i,j,k,nnodes=nelements-1,temp=[],index=[],vector=[],result=[];for(i=0;i<nelements;i++)result[i]={left:0,right:0,distance:0};for(i=0;i<nnodes;i++)vector[i]=i;for(i=0;i<nelements;i++){for(result[i].distance=Number.MAX_VALUE,j=0;j<i;j++)temp[j]=distmatrix[i][j];for(j=0;j<i;j++)k=vector[j],result[j].distance>=temp[j]?(result[j].distance<temp[k]&&(temp[k]=result[j].distance),result[j].distance=temp[j],vector[j]=i):temp[j]<temp[k]&&(temp[k]=temp[j]);for(j=0;j<i;j++)result[j].distance>=result[vector[j]].distance&&(vector[j]=i)}for(i=0;i<nnodes;i++)result[i].left=i;for(result.sort(function(node1,node2){var term1=node1.distance,term2=node2.distance;return term1<term2?-1:term1>term2?1:0}),i=0;i<nelements;i++)index[i]=i;for(i=0;i<nnodes;i++)k=vector[j=result[i].left],result[i].left=index[j],result[i].right=index[k],index[k]=-i-1;var result2=[];for(i=0;i<nelements-1;i++)result2[i]=result[i];return result2}}("undefined"!=typeof window?window:this),function($){function EventData(){var isPropagationStopped=!1,isImmediatePropagationStopped=!1;this.stopPropagation=function(){isPropagationStopped=!0},this.isPropagationStopped=function(){return isPropagationStopped},this.stopImmediatePropagation=function(){isImmediatePropagationStopped=!0},this.isImmediatePropagationStopped=function(){return isImmediatePropagationStopped}}function NonDataItem(){this.__nonDataRow=!0}function Group(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}function GroupTotals(){this.__groupTotals=!0,this.group=null,this.initialized=!1}function EditorLock(){var activeEditController=null;this.isActive=function(editController){return editController?activeEditController===editController:null!==activeEditController},this.activate=function(editController){if(editController!==activeEditController){if(null!==activeEditController)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!editController.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!editController.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";activeEditController=editController}},this.deactivate=function(editController){if(activeEditController!==editController)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";activeEditController=null},this.commitCurrentEdit=function(){return!activeEditController||activeEditController.commitCurrentEdit()},this.cancelCurrentEdit=function(){return!activeEditController||activeEditController.cancelCurrentEdit()}}jQuery.extend(!0,window,{Slick:{Event:function(){var handlers=[];this.subscribe=function(fn){handlers.push(fn)},this.unsubscribe=function(fn){for(var i=handlers.length-1;i>=0;i--)handlers[i]===fn&&handlers.splice(i,1)},this.notify=function(args,e,scope){e=e||new EventData,scope=scope||this;for(var returnValue,i=0;i<handlers.length&&!e.isPropagationStopped()&&!e.isImmediatePropagationStopped();i++)returnValue=handlers[i].call(scope,e,args);return returnValue}},EventData:EventData,EventHandler:function(){var handlers=[];this.subscribe=function(event,handler){return handlers.push({event:event,handler:handler}),event.subscribe(handler),this},this.unsubscribe=function(event,handler){for(var i=handlers.length;i--;)if(handlers[i].event===event&&handlers[i].handler===handler)return handlers.splice(i,1),void event.unsubscribe(handler);return this},this.unsubscribeAll=function(){for(var i=handlers.length;i--;)handlers[i].event.unsubscribe(handlers[i].handler);return handlers=[],this}},Range:function(fromRow,fromCell,toRow,toCell){void 0===toRow&&void 0===toCell&&(toRow=fromRow,toCell=fromCell),this.fromRow=Math.min(fromRow,toRow),this.fromCell=Math.min(fromCell,toCell),this.toRow=Math.max(fromRow,toRow),this.toCell=Math.max(fromCell,toCell),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(row,cell){return row>=this.fromRow&&row<=this.toRow&&cell>=this.fromCell&&cell<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}},NonDataRow:NonDataItem,Group:Group,GroupTotals:GroupTotals,EditorLock:EditorLock,GlobalEditorLock:new EditorLock,keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,RIGHT:39,TAB:9,UP:38}}}),Group.prototype=new NonDataItem,Group.prototype.equals=function(group){return this.value===group.value&&this.count===group.count&&this.collapsed===group.collapsed&&this.title===group.title},GroupTotals.prototype=new NonDataItem}(),"undefined"==typeof jQuery)throw"SlickGrid requires jquery module to be loaded";if(!jQuery.fn.drag)throw"SlickGrid requires jquery.event.drag module to be loaded";if("undefined"==typeof Slick)throw"slick.core.js not loaded";!function($){function SlickGrid(container,data,columns,options){function init(){if(($container=$(container)).length<1)throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.");cacheCssForHiddenInit(),maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight(),scrollbarDimensions=scrollbarDimensions||measureScrollbar(),options=$.extend({},defaults,options),validateAndEnforceOptions(),columnDefaults.width=options.defaultColumnWidth,columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i,m.minWidth&&m.width<m.minWidth&&(m.width=m.minWidth),m.maxWidth&&m.width>m.maxWidth&&(m.width=m.maxWidth)}if(options.enableColumnReorder&&!$.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit},$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget"),/relative|absolute|fixed/.test($container.css("position"))||$container.css("position","relative"),$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container),$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),($headers=$("<div class='slick-header-columns' style='left:-1000px' />").appendTo($headerScroller)).width(getHeadersWidth()),$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headerRow=$("<div class='slick-headerrow-columns' />").appendTo($headerRowScroller),$headerRowSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($headerRowScroller),$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller),options.showTopPanel||$topPanelScroller.hide(),options.showHeaderRow||$headerRowScroller.hide(),($viewport=$("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo($container)).css("overflow-y",options.autoHeight?"hidden":"auto"),$canvas=$("<div class='grid-canvas' />").appendTo($viewport),$focusSink2=$focusSink.clone().appendTo($container),options.explicitInitialization||finishInitialization()}function finishInitialization(){initialized||(initialized=!0,viewportW=parseFloat($.css($container[0],"width",!0)),measureCellPaddingAndBorder(),disableSelection($headers),options.enableTextSelectionOnCells||$viewport.bind("selectstart.ui",function(event){return $(event.target).is("input,textarea")}),updateColumnCaches(),createColumnHeaders(),setupColumnSort(),createCssRules(),resizeCanvas(),bindAncestorScrollEvents(),$container.bind("resize.slickgrid",resizeCanvas),$viewport.bind("scroll",handleScroll),$headerScroller.bind("contextmenu",handleHeaderContextMenu).bind("click",handleHeaderClick).delegate(".slick-header-column","mouseenter",handleHeaderMouseEnter).delegate(".slick-header-column","mouseleave",handleHeaderMouseLeave),$headerRowScroller.bind("scroll",handleHeaderRowScroll),$focusSink.add($focusSink2).bind("keydown",handleKeyDown),$canvas.bind("keydown",handleKeyDown).bind("click",handleClick).bind("dblclick",handleDblClick).bind("contextmenu",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",{distance:3},handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave),navigator.userAgent.toLowerCase().match(/webkit/)&&navigator.userAgent.toLowerCase().match(/macintosh/)&&$canvas.bind("mousewheel",handleMouseWheel),restoreCssFromHiddenInit())}function cacheCssForHiddenInit(){($hiddenParents=$container.parents().andSelf().not(":visible")).each(function(){var old={};for(var name in cssShow)old[name]=this.style[name],this.style[name]=cssShow[name];oldProps.push(old)})}function restoreCssFromHiddenInit(){$hiddenParents.each(function(i){var old=oldProps[i];for(var name in cssShow)this.style[name]=old[name]})}function registerPlugin(plugin){plugins.unshift(plugin),plugin.init(self)}function unregisterPlugin(plugin){for(var i=plugins.length;i>=0;i--)if(plugins[i]===plugin){plugins[i].destroy&&plugins[i].destroy(),plugins.splice(i,1);break}}function setSelectionModel(model){selectionModel&&(selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged),selectionModel.destroy&&selectionModel.destroy()),(selectionModel=model)&&(selectionModel.init(self),selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged))}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var $c=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),dim={width:$c.width()-$c[0].clientWidth,height:$c.height()-$c[0].clientHeight};return $c.remove(),dim}function getHeadersWidth(){for(var headersWidth=0,i=0,ii=columns.length;i<ii;i++){headersWidth+=columns[i].width}return headersWidth+=scrollbarDimensions.width,Math.max(headersWidth,viewportW)+1e3}function getCanvasWidth(){for(var availableWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,rowWidth=0,i=columns.length;i--;)rowWidth+=columns[i].width;return options.fullWidthRows?Math.max(rowWidth,availableWidth):rowWidth}function updateCanvasWidth(forceColumnWidthsUpdate){var oldCanvasWidth=canvasWidth;(canvasWidth=getCanvasWidth())!=oldCanvasWidth&&($canvas.width(canvasWidth),$headerRow.width(canvasWidth),$headers.width(getHeadersWidth()),viewportHasHScroll=canvasWidth>viewportW-scrollbarDimensions.width),$headerRowSpacer.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),(canvasWidth!=oldCanvasWidth||forceColumnWidthsUpdate)&&applyColumnWidths()}function disableSelection($target){$target&&$target.jquery&&$target.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})}function getMaxSupportedCssHeight(){for(var supportedHeight=1e6,testUpTo=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,div=$("<div style='display:none' />").appendTo(document.body);;){var test=2*supportedHeight;if(div.css("height",test),test>testUpTo||div.height()!==test)break;supportedHeight=test}return div.remove(),supportedHeight}function bindAncestorScrollEvents(){for(var elem=$canvas[0];(elem=elem.parentNode)!=document.body&&null!=elem;)if(elem==$viewport[0]||elem.scrollWidth!=elem.clientWidth||elem.scrollHeight!=elem.clientHeight){var $elem=$(elem);$boundAncestors=$boundAncestors?$boundAncestors.add($elem):$elem,$elem.bind("scroll."+uid,handleActiveCellPositionChange)}}function unbindAncestorScrollEvents(){$boundAncestors&&($boundAncestors.unbind("scroll."+uid),$boundAncestors=null)}function updateColumnHeader(columnId,title,toolTip){if(initialized){var idx=getColumnIndex(columnId);if(null!=idx){var columnDef=columns[idx],$header=$headers.children().eq(idx);$header&&(void 0!==title&&(columns[idx].name=title),void 0!==toolTip&&(columns[idx].toolTip=toolTip),trigger(self.onBeforeHeaderCellDestroy,{node:$header[0],column:columnDef,grid:self}),$header.attr("title",toolTip||"").children().eq(0).html(title),trigger(self.onHeaderCellRendered,{node:$header[0],column:columnDef,grid:self}))}}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(columnId){var idx=getColumnIndex(columnId),$header=$headerRow.children().eq(idx);return $header&&$header[0]}function createColumnHeaders(){function onMouseEnter(){$(this).addClass("ui-state-hover")}function onMouseLeave(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var columnDef=$(this).data("column");columnDef&&trigger(self.onBeforeHeaderCellDestroy,{node:this,column:columnDef,grid:self})}),$headers.empty(),$headers.width(getHeadersWidth()),$headerRow.find(".slick-headerrow-column").each(function(){var columnDef=$(this).data("column");columnDef&&trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:columnDef,grid:self})}),$headerRow.empty();for(var i=0;i<columns.length;i++){var m=columns[i],header=$("<div class='ui-state-default slick-header-column' />").html("<span class='slick-column-name'>"+m.name+"</span>").width(m.width-headerColumnWidthDiff).attr("id",""+uid+m.id).attr("title",m.toolTip||"").data("column",m).addClass(m.headerCssClass||"").appendTo($headers);if((options.enableColumnReorder||m.sortable)&&header.on("mouseenter",onMouseEnter).on("mouseleave",onMouseLeave),m.sortable&&(header.addClass("slick-header-sortable"),header.append("<span class='slick-sort-indicator' />")),trigger(self.onHeaderCellRendered,{node:header[0],column:m,grid:self}),options.showHeaderRow){var headerRowCell=$("<div class='ui-state-default slick-headerrow-column l"+i+" r"+i+"'></div>").data("column",m).appendTo($headerRow);trigger(self.onHeaderRowCellRendered,{node:headerRowCell[0],column:m,grid:self})}}setSortColumns(sortColumns),setupColumnResize(),options.enableColumnReorder&&setupColumnReorder()}function setupColumnSort(){$headers.click(function(e){if(e.metaKey=e.metaKey||e.ctrlKey,!$(e.target).hasClass("slick-resizable-handle")){var $col=$(e.target).closest(".slick-header-column");if($col.length){var column=$col.data("column");if(column.sortable){if(!getEditorLock().commitCurrentEdit())return;for(var sortOpts=null,i=0;i<sortColumns.length;i++)if(sortColumns[i].columnId==column.id){(sortOpts=sortColumns[i]).sortAsc=!sortOpts.sortAsc;break}e.metaKey&&options.multiColumnSort?sortOpts&&sortColumns.splice(i,1):((e.shiftKey||e.metaKey)&&options.multiColumnSort||(sortColumns=[]),sortOpts?0==sortColumns.length&&sortColumns.push(sortOpts):(sortOpts={columnId:column.id,sortAsc:column.defaultSortAsc},sortColumns.push(sortOpts))),setSortColumns(sortColumns),options.multiColumnSort?trigger(self.onSort,{multiColumnSort:!0,sortCols:$.map(sortColumns,function(col){return{sortCol:columns[getColumnIndex(col.columnId)],sortAsc:col.sortAsc}}),grid:self},e):trigger(self.onSort,{multiColumnSort:!1,sortCol:column,sortAsc:sortOpts.sortAsc,grid:self},e)}}}})}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy"),$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",start:function(e,ui){ui.placeholder.width(ui.helper.outerWidth()-headerColumnWidthDiff),$(ui.helper).addClass("slick-header-column-active")},beforeStop:function(e,ui){$(ui.helper).removeClass("slick-header-column-active")},stop:function(e){if(getEditorLock().commitCurrentEdit()){for(var reorderedIds=$headers.sortable("toArray"),reorderedColumns=[],i=0;i<reorderedIds.length;i++)reorderedColumns.push(columns[getColumnIndex(reorderedIds[i].replace(uid,""))]);setColumns(reorderedColumns),trigger(self.onColumnsReordered,{grid:self}),e.stopPropagation(),setupColumnResize()}else $(this).sortable("cancel")}})}function setupColumnResize(){var j,c,pageX,columnElements,minPageX,maxPageX,firstResizable,lastResizable;(columnElements=$headers.children()).find(".slick-resizable-handle").remove(),columnElements.each(function(i,e){columns[i].resizable&&(void 0===firstResizable&&(firstResizable=i),lastResizable=i)}),void 0!==firstResizable&&columnElements.each(function(i,e){i<firstResizable||options.forceFitColumns&&i>=lastResizable||($(e),$("<div class='slick-resizable-handle' />").appendTo(e).bind("dragstart",function(e,dd){if(!getEditorLock().commitCurrentEdit())return!1;pageX=e.pageX,$(this).parent().addClass("slick-header-column-active");var shrinkLeewayOnRight=null,stretchLeewayOnRight=null;if(columnElements.each(function(i,e){columns[i].previousWidth=$(e).outerWidth()}),options.forceFitColumns)for(shrinkLeewayOnRight=0,stretchLeewayOnRight=0,j=i+1;j<columnElements.length;j++)(c=columns[j]).resizable&&(null!==stretchLeewayOnRight&&(c.maxWidth?stretchLeewayOnRight+=c.maxWidth-c.previousWidth:stretchLeewayOnRight=null),shrinkLeewayOnRight+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth));var shrinkLeewayOnLeft=0,stretchLeewayOnLeft=0;for(j=0;j<=i;j++)(c=columns[j]).resizable&&(null!==stretchLeewayOnLeft&&(c.maxWidth?stretchLeewayOnLeft+=c.maxWidth-c.previousWidth:stretchLeewayOnLeft=null),shrinkLeewayOnLeft+=c.previousWidth-Math.max(c.minWidth||0,absoluteColumnMinWidth));null===shrinkLeewayOnRight&&(shrinkLeewayOnRight=1e5),null===shrinkLeewayOnLeft&&(shrinkLeewayOnLeft=1e5),null===stretchLeewayOnRight&&(stretchLeewayOnRight=1e5),null===stretchLeewayOnLeft&&(stretchLeewayOnLeft=1e5),maxPageX=pageX+Math.min(shrinkLeewayOnRight,stretchLeewayOnLeft),minPageX=pageX-Math.min(shrinkLeewayOnLeft,stretchLeewayOnRight)}).bind("drag",function(e,dd){var actualMinWidth,x,d=Math.min(maxPageX,Math.max(minPageX,e.pageX))-pageX;if(d<0){for(x=d,j=i;j>=0;j--)(c=columns[j]).resizable&&(actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth),x&&c.previousWidth+x<actualMinWidth?(x+=c.previousWidth-actualMinWidth,c.width=actualMinWidth):(c.width=c.previousWidth+x,x=0));if(options.forceFitColumns)for(x=-d,j=i+1;j<columnElements.length;j++)(c=columns[j]).resizable&&(x&&c.maxWidth&&c.maxWidth-c.previousWidth<x?(x-=c.maxWidth-c.previousWidth,c.width=c.maxWidth):(c.width=c.previousWidth+x,x=0))}else{for(x=d,j=i;j>=0;j--)(c=columns[j]).resizable&&(x&&c.maxWidth&&c.maxWidth-c.previousWidth<x?(x-=c.maxWidth-c.previousWidth,c.width=c.maxWidth):(c.width=c.previousWidth+x,x=0));if(options.forceFitColumns)for(x=-d,j=i+1;j<columnElements.length;j++)(c=columns[j]).resizable&&(actualMinWidth=Math.max(c.minWidth||0,absoluteColumnMinWidth),x&&c.previousWidth+x<actualMinWidth?(x+=c.previousWidth-actualMinWidth,c.width=actualMinWidth):(c.width=c.previousWidth+x,x=0))}applyColumnHeaderWidths(),options.syncColumnCellResize&&applyColumnWidths()}).bind("dragend",function(e,dd){var newWidth;for($(this).parent().removeClass("slick-header-column-active"),j=0;j<columnElements.length;j++)c=columns[j],newWidth=$(columnElements[j]).outerWidth(),c.previousWidth!==newWidth&&c.rerenderOnResize&&invalidateAllRows();updateCanvasWidth(!0),render(),trigger(self.onColumnsResized,{grid:self})}))})}function getVBoxDelta($el){var delta=0;return $.each(["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],function(n,val){delta+=parseFloat($el.css(val))||0}),delta}function measureCellPaddingAndBorder(){var el,h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],v=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],verArray=$.fn.jquery.split(".");jQueryNewWidthBehaviour=1==verArray[0]&&verArray[1]>=8||verArray[0]>=2,el=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers),headerColumnWidthDiff=headerColumnHeightDiff=0,"border-box"!=el.css("box-sizing")&&"border-box"!=el.css("-moz-box-sizing")&&"border-box"!=el.css("-webkit-box-sizing")&&($.each(h,function(n,val){headerColumnWidthDiff+=parseFloat(el.css(val))||0}),$.each(v,function(n,val){headerColumnHeightDiff+=parseFloat(el.css(val))||0})),el.remove();var r=$("<div class='slick-row' />").appendTo($canvas);el=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(r),cellWidthDiff=cellHeightDiff=0,"border-box"!=el.css("box-sizing")&&"border-box"!=el.css("-moz-box-sizing")&&"border-box"!=el.css("-webkit-box-sizing")&&($.each(h,function(n,val){cellWidthDiff+=parseFloat(el.css(val))||0}),$.each(v,function(n,val){cellHeightDiff+=parseFloat(el.css(val))||0})),r.remove(),absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));for(var rowHeight=options.rowHeight-cellHeightDiff,rules=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+rowHeight+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"],i=0;i<columns.length;i++)rules.push("."+uid+" .l"+i+" { }"),rules.push("."+uid+" .r"+i+" { }");$style[0].styleSheet?$style[0].styleSheet.cssText=rules.join(" "):$style[0].appendChild(document.createTextNode(rules.join(" ")))}function getColumnCssRules(idx){if(!stylesheet){for(var sheets=document.styleSheets,i=0;i<sheets.length;i++)if((sheets[i].ownerNode||sheets[i].owningElement)==$style[0]){stylesheet=sheets[i];break}if(!stylesheet)throw new Error("Cannot find stylesheet.");columnCssRulesL=[],columnCssRulesR=[];var matches,columnIdx,cssRules=stylesheet.cssRules||stylesheet.rules;for(i=0;i<cssRules.length;i++){var selector=cssRules[i].selectorText;(matches=/\.l\d+/.exec(selector))?(columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10),columnCssRulesL[columnIdx]=cssRules[i]):(matches=/\.r\d+/.exec(selector))&&(columnIdx=parseInt(matches[0].substr(2,matches[0].length-2),10),columnCssRulesR[columnIdx]=cssRules[i])}}return{left:columnCssRulesL[idx],right:columnCssRulesR[idx]}}function removeCssRules(){$style.remove(),stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit(),trigger(self.onBeforeDestroy,{grid:self});for(var i=plugins.length;i--;)unregisterPlugin(plugins[i]);options.enableColumnReorder&&$headers.filter(":ui-sortable").sortable("destroy"),unbindAncestorScrollEvents(),$container.unbind(".slickgrid"),removeCssRules(),$canvas.unbind("draginit dragstart dragend drag"),$container.empty().removeClass(uid)}function trigger(evt,args,e){return e=e||new Slick.EventData,(args=args||{}).grid=self,evt.notify(args,e,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(id){return columnsById[id]}function autosizeColumns(){var i,c,prevTotal,widths=[],shrinkLeeway=0,total=0,availWidth=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(i=0;i<columns.length;i++)c=columns[i],widths.push(c.width),total+=c.width,c.resizable&&(shrinkLeeway+=c.width-Math.max(c.minWidth,absoluteColumnMinWidth));for(prevTotal=total;total>availWidth&&shrinkLeeway;){var shrinkProportion=(total-availWidth)/shrinkLeeway;for(i=0;i<columns.length&&total>availWidth;i++){c=columns[i];var width=widths[i];if(!(!c.resizable||width<=c.minWidth||width<=absoluteColumnMinWidth)){var absMinWidth=Math.max(c.minWidth,absoluteColumnMinWidth),shrinkSize=Math.floor(shrinkProportion*(width-absMinWidth))||1;total-=shrinkSize=Math.min(shrinkSize,width-absMinWidth),shrinkLeeway-=shrinkSize,widths[i]-=shrinkSize}}if(prevTotal<=total)break;prevTotal=total}for(prevTotal=total;total<availWidth;){var growProportion=availWidth/total;for(i=0;i<columns.length&&total<availWidth;i++){c=columns[i];var growSize,currentWidth=widths[i];total+=growSize=!c.resizable||c.maxWidth<=currentWidth?0:Math.min(Math.floor(growProportion*currentWidth)-currentWidth,c.maxWidth-currentWidth||1e6)||1,widths[i]+=total<=availWidth?growSize:0}if(prevTotal>=total)break;prevTotal=total}var reRender=!1;for(i=0;i<columns.length;i++)columns[i].rerenderOnResize&&columns[i].width!=widths[i]&&(reRender=!0),columns[i].width=widths[i];applyColumnHeaderWidths(),updateCanvasWidth(!0),reRender&&(invalidateAllRows(),render())}function applyColumnHeaderWidths(){if(initialized){for(var h,i=0,headers=$headers.children(),ii=headers.length;i<ii;i++)h=$(headers[i]),jQueryNewWidthBehaviour?h.outerWidth()!==columns[i].width&&h.outerWidth(columns[i].width):h.width()!==columns[i].width-headerColumnWidthDiff&&h.width(columns[i].width-headerColumnWidthDiff);updateColumnCaches()}}function applyColumnWidths(){for(var w,rule,x=0,i=0;i<columns.length;i++)w=columns[i].width,(rule=getColumnCssRules(i)).left.style.left=x+"px",rule.right.style.right=canvasWidth-x-w+"px",x+=columns[i].width}function setSortColumn(columnId,ascending){setSortColumns([{columnId:columnId,sortAsc:ascending}])}function setSortColumns(cols){sortColumns=cols;var headerColumnEls=$headers.children();headerColumnEls.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),$.each(sortColumns,function(i,col){null==col.sortAsc&&(col.sortAsc=!0);var columnIndex=getColumnIndex(col.columnId);null!=columnIndex&&headerColumnEls.eq(columnIndex).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(col.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(e,ranges){selectedRows=[];for(var hash={},i=0;i<ranges.length;i++)for(var j=ranges[i].fromRow;j<=ranges[i].toRow;j++){hash[j]||(selectedRows.push(j),hash[j]={});for(var k=ranges[i].fromCell;k<=ranges[i].toCell;k++)canCellBeSelected(j,k)&&(hash[j][columns[k].id]=options.selectedCellCssClass)}setCellCssStyles(options.selectedCellCssClass,hash),trigger(self.onSelectedRowsChanged,{rows:getSelectedRows(),grid:self},e)}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[],columnPosRight=[];for(var x=0,i=0,ii=columns.length;i<ii;i++)columnPosLeft[i]=x,columnPosRight[i]=x+columns[i].width,x+=columns[i].width}function setColumns(columnDefinitions){columns=columnDefinitions,columnsById={};for(var i=0;i<columns.length;i++){var m=columns[i]=$.extend({},columnDefaults,columns[i]);columnsById[m.id]=i,m.minWidth&&m.width<m.minWidth&&(m.width=m.minWidth),m.maxWidth&&m.width>m.maxWidth&&(m.width=m.maxWidth)}updateColumnCaches(),initialized&&(invalidateAllRows(),createColumnHeaders(),removeCssRules(),createCssRules(),resizeCanvas(),applyColumnWidths(),handleScroll())}function getOptions(){return options}function setOptions(args){getEditorLock().commitCurrentEdit()&&(makeActiveCellNormal(),options.enableAddRow!==args.enableAddRow&&invalidateRow(getDataLength()),options=$.extend(options,args),validateAndEnforceOptions(),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),render())}function validateAndEnforceOptions(){options.autoHeight&&(options.leaveSpaceForNewRows=!1)}function setData(newData,scrollToTop){data=newData,invalidateAllRows(),updateRowCount(),scrollToTop&&scrollTo(0)}function getData(){return data}function getDataLength(){return data.getLength?data.getLength():data.length}function getDataLengthIncludingAddNew(){return getDataLength()+(options.enableAddRow?1:0)}function getDataItem(i){return data.getItem?data.getItem(i):data[i]}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(visible){options.showTopPanel!=visible&&(options.showTopPanel=visible,visible?$topPanelScroller.slideDown("fast",resizeCanvas):$topPanelScroller.slideUp("fast",resizeCanvas))}function setHeaderRowVisibility(visible){options.showHeaderRow!=visible&&(options.showHeaderRow=visible,visible?$headerRowScroller.slideDown("fast",resizeCanvas):$headerRowScroller.slideUp("fast",resizeCanvas))}function getContainerNode(){return $container.get(0)}function getRowTop(row){return options.rowHeight*row-offset}function getRowFromPosition(y){return Math.floor((y+offset)/options.rowHeight)}function scrollTo(y){y=Math.max(y,0),y=Math.min(y,th-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0));var oldOffset=offset;page=Math.min(n-1,Math.floor(y/ph));var newScrollTop=y-(offset=Math.round(page*cj));offset!=oldOffset&&(cleanupRows(getVisibleRange(newScrollTop)),updateRowPositions());prevScrollTop!=newScrollTop&&(vScrollDir=prevScrollTop+oldOffset<newScrollTop+offset?1:-1,$viewport[0].scrollTop=lastRenderedScrollTop=scrollTop=prevScrollTop=newScrollTop,trigger(self.onViewportChanged,{grid:self}))}function defaultFormatter(row,cell,value,columnDef,dataContext){return null==value?"":(value+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function getFormatter(row,column){var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row),columnOverrides=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[column.id]||rowMetadata.columns[getColumnIndex(column.id)]);return columnOverrides&&columnOverrides.formatter||rowMetadata&&rowMetadata.formatter||column.formatter||options.formatterFactory&&options.formatterFactory.getFormatter(column)||options.defaultFormatter}function getEditor(row,cell){var column=columns[cell],rowMetadata=data.getItemMetadata&&data.getItemMetadata(row),columnMetadata=rowMetadata&&rowMetadata.columns;return columnMetadata&&columnMetadata[column.id]&&void 0!==columnMetadata[column.id].editor?columnMetadata[column.id].editor:columnMetadata&&columnMetadata[cell]&&void 0!==columnMetadata[cell].editor?columnMetadata[cell].editor:column.editor||options.editorFactory&&options.editorFactory.getEditor(column)}function getDataItemValueForColumn(item,columnDef){return options.dataItemColumnValueExtractor?options.dataItemColumnValueExtractor(item,columnDef):item[columnDef.field]}function appendRowHtml(stringArray,row,range,dataLength){var d=getDataItem(row),rowCss="slick-row"+(row<dataLength&&!d?" loading":"")+(row===activeRow?" active":"")+(row%2==1?" odd":" even");d||(rowCss+=" "+options.addNewRowCssClass);var metadata=data.getItemMetadata&&data.getItemMetadata(row);metadata&&metadata.cssClasses&&(rowCss+=" "+metadata.cssClasses),stringArray.push("<div class='ui-widget-content "+rowCss+"' style='top:"+getRowTop(row)+"px'>");for(var colspan,m,i=0,ii=columns.length;i<ii;i++){if(m=columns[i],colspan=1,metadata&&metadata.columns){var columnData=metadata.columns[m.id]||metadata.columns[i];"*"===(colspan=columnData&&columnData.colspan||1)&&(colspan=ii-i)}if(columnPosRight[Math.min(ii-1,i+colspan-1)]>range.leftPx){if(columnPosLeft[i]>range.rightPx)break;appendCellHtml(stringArray,row,i,colspan,d)}colspan>1&&(i+=colspan-1)}stringArray.push("</div>")}function appendCellHtml(stringArray,row,cell,colspan,item){var m=columns[cell],cellCss="slick-cell l"+cell+" r"+Math.min(columns.length-1,cell+colspan-1)+(m.cssClass?" "+m.cssClass:"");for(var key in row===activeRow&&cell===activeCell&&(cellCss+=" active"),cellCssClasses)cellCssClasses[key][row]&&cellCssClasses[key][row][m.id]&&(cellCss+=" "+cellCssClasses[key][row][m.id]);if(stringArray.push("<div class='"+cellCss+"'>"),item){var value=getDataItemValueForColumn(item,m);stringArray.push(getFormatter(row,m)(row,cell,value,m,item))}stringArray.push("</div>"),rowsCache[row].cellRenderQueue.push(cell),rowsCache[row].cellColSpans[cell]=colspan}function cleanupRows(rangeToKeep){for(var i in rowsCache)(i=parseInt(i,10))!==activeRow&&(i<rangeToKeep.top||i>rangeToKeep.bottom)&&removeRowFromCache(i);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}function invalidate(){updateRowCount(),invalidateAllRows(),render()}function invalidateAllRows(){for(var row in currentEditor&&makeActiveCellNormal(),rowsCache)removeRowFromCache(row);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}function queuePostProcessedRowForCleanup(cacheEntry,postProcessedRow,rowIdx){for(var columnIdx in postProcessgroupId++,postProcessedRow)postProcessedRow.hasOwnProperty(columnIdx)&&postProcessedCleanupQueue.push({actionType:"C",groupId:postProcessgroupId,node:cacheEntry.cellNodesByColumnIdx[0|columnIdx],columnIdx:0|columnIdx,rowIdx:rowIdx});postProcessedCleanupQueue.push({actionType:"R",groupId:postProcessgroupId,node:cacheEntry.rowNode}),$(cacheEntry.rowNode).detach()}function queuePostProcessedCellForCleanup(cellnode,columnIdx,rowIdx){postProcessedCleanupQueue.push({actionType:"C",groupId:postProcessgroupId,node:cellnode,columnIdx:columnIdx,rowIdx:rowIdx}),$(cellnode).detach()}function removeRowFromCache(row){var cacheEntry=rowsCache[row];cacheEntry&&(rowNodeFromLastMouseWheelEvent===cacheEntry.rowNode?(cacheEntry.rowNode.style.display="none",zombieRowNodeFromLastMouseWheelEvent=rowNodeFromLastMouseWheelEvent,zombieRowCacheFromLastMouseWheelEvent=cacheEntry,zombieRowPostProcessedFromLastMouseWheelEvent=postProcessedRows[row]):options.enableAsyncPostRenderCleanup&&postProcessedRows[row]?queuePostProcessedRowForCleanup(cacheEntry,postProcessedRows[row],row):$canvas[0].removeChild(cacheEntry.rowNode),delete rowsCache[row],delete postProcessedRows[row],renderedRows--,counter_rows_removed++)}function invalidateRows(rows){var i,rl;if(rows&&rows.length){for(vScrollDir=0,i=0,rl=rows.length;i<rl;i++)currentEditor&&activeRow===rows[i]&&makeActiveCellNormal(),rowsCache[rows[i]]&&removeRowFromCache(rows[i]);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}}function invalidateRow(row){invalidateRows([row])}function updateCell(row,cell){var cellNode=getCellNode(row,cell);if(cellNode){var m=columns[cell],d=getDataItem(row);currentEditor&&activeRow===row&&activeCell===cell?currentEditor.loadValue(d):(cellNode.innerHTML=d?getFormatter(row,m)(row,cell,getDataItemValueForColumn(d,m),m,d):"",invalidatePostProcessingResults(row))}}function updateRow(row){var cacheEntry=rowsCache[row];if(cacheEntry){ensureCellNodesInRowsCache(row);var d=getDataItem(row);for(var columnIdx in cacheEntry.cellNodesByColumnIdx)if(cacheEntry.cellNodesByColumnIdx.hasOwnProperty(columnIdx)){var m=columns[columnIdx|=0],node=cacheEntry.cellNodesByColumnIdx[columnIdx];row===activeRow&&columnIdx===activeCell&&currentEditor?currentEditor.loadValue(d):node.innerHTML=d?getFormatter(row,m)(row,columnIdx,getDataItemValueForColumn(d,m),m,d):""}invalidatePostProcessingResults(row)}}function getViewportHeight(){return parseFloat($.css($container[0],"height",!0))-parseFloat($.css($container[0],"paddingTop",!0))-parseFloat($.css($container[0],"paddingBottom",!0))-parseFloat($.css($headerScroller[0],"height"))-getVBoxDelta($headerScroller)-(options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0)-(options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0)}function resizeCanvas(){initialized&&(viewportH=options.autoHeight?options.rowHeight*getDataLengthIncludingAddNew():getViewportHeight(),numVisibleRows=Math.ceil(viewportH/options.rowHeight),viewportW=parseFloat($.css($container[0],"width",!0)),options.autoHeight||$viewport.height(viewportH),options.forceFitColumns&&autosizeColumns(),updateRowCount(),handleScroll(),lastRenderedScrollLeft=-1,render())}function updateRowCount(){if(initialized){var dataLengthIncludingAddNew=getDataLengthIncludingAddNew(),numberOfRows=dataLengthIncludingAddNew+(options.leaveSpaceForNewRows?numVisibleRows-1:0),oldViewportHasVScroll=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&numberOfRows*options.rowHeight>viewportH,makeActiveCellNormal();var l=dataLengthIncludingAddNew-1;for(var i in rowsCache)i>=l&&removeRowFromCache(i);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup(),activeCellNode&&activeRow>l&&resetActiveCell();var oldH=h;(th=Math.max(options.rowHeight*numberOfRows,viewportH-scrollbarDimensions.height))<maxSupportedCssHeight?(h=ph=th,n=1,cj=0):(ph=(h=maxSupportedCssHeight)/100,n=Math.floor(th/ph),cj=(th-h)/(n-1)),h!==oldH&&($canvas.css("height",h),scrollTop=$viewport[0].scrollTop);var oldScrollTopInRange=scrollTop+offset<=th-viewportH;0==th||0==scrollTop?page=offset=0:scrollTo(oldScrollTopInRange?scrollTop+offset:th-viewportH),h!=oldH&&options.autoHeight&&resizeCanvas(),options.forceFitColumns&&oldViewportHasVScroll!=viewportHasVScroll&&autosizeColumns(),updateCanvasWidth(!1)}}function getVisibleRange(viewportTop,viewportLeft){return null==viewportTop&&(viewportTop=scrollTop),null==viewportLeft&&(viewportLeft=scrollLeft),{top:getRowFromPosition(viewportTop),bottom:getRowFromPosition(viewportTop+viewportH)+1,leftPx:viewportLeft,rightPx:viewportLeft+viewportW}}function getRenderedRange(viewportTop,viewportLeft){var range=getVisibleRange(viewportTop,viewportLeft),buffer=Math.round(viewportH/options.rowHeight);return-1==vScrollDir?(range.top-=buffer,range.bottom+=3):1==vScrollDir?(range.top-=3,range.bottom+=buffer):(range.top-=3,range.bottom+=3),range.top=Math.max(0,range.top),range.bottom=Math.min(getDataLengthIncludingAddNew()-1,range.bottom),range.leftPx-=viewportW,range.rightPx+=viewportW,range.leftPx=Math.max(0,range.leftPx),range.rightPx=Math.min(canvasWidth,range.rightPx),range}function ensureCellNodesInRowsCache(row){var cacheEntry=rowsCache[row];if(cacheEntry&&cacheEntry.cellRenderQueue.length)for(var lastChild=cacheEntry.rowNode.lastChild;cacheEntry.cellRenderQueue.length;){var columnIdx=cacheEntry.cellRenderQueue.pop();cacheEntry.cellNodesByColumnIdx[columnIdx]=lastChild,lastChild=lastChild.previousSibling}}function cleanUpCells(range,row){var cellToRemove,node,cacheEntry=rowsCache[row],cellsToRemove=[];for(var i in cacheEntry.cellNodesByColumnIdx)if(cacheEntry.cellNodesByColumnIdx.hasOwnProperty(i)){i|=0;var colspan=cacheEntry.cellColSpans[i];(columnPosLeft[i]>range.rightPx||columnPosRight[Math.min(columns.length-1,i+colspan-1)]<range.leftPx)&&(row==activeRow&&i==activeCell||cellsToRemove.push(i))}for(postProcessgroupId++;null!=(cellToRemove=cellsToRemove.pop());)node=cacheEntry.cellNodesByColumnIdx[cellToRemove],options.enableAsyncPostRenderCleanup&&postProcessedRows[row]&&postProcessedRows[row][cellToRemove]?queuePostProcessedCellForCleanup(node,cellToRemove,row):cacheEntry.rowNode.removeChild(node),delete cacheEntry.cellColSpans[cellToRemove],delete cacheEntry.cellNodesByColumnIdx[cellToRemove],postProcessedRows[row]&&delete postProcessedRows[row][cellToRemove],0}function cleanUpAndRenderCells(range){for(var cacheEntry,cellsAdded,colspan,stringArray=[],processedRows=[],row=range.top,btm=range.bottom;row<=btm;row++)if(cacheEntry=rowsCache[row]){ensureCellNodesInRowsCache(row),cleanUpCells(range,row),cellsAdded=0;var metadata=data.getItemMetadata&&data.getItemMetadata(row);metadata=metadata&&metadata.columns;for(var d=getDataItem(row),i=0,ii=columns.length;i<ii&&!(columnPosLeft[i]>range.rightPx);i++)if(null==(colspan=cacheEntry.cellColSpans[i])){if(colspan=1,metadata){var columnData=metadata[columns[i].id]||metadata[i];"*"===(colspan=columnData&&columnData.colspan||1)&&(colspan=ii-i)}columnPosRight[Math.min(ii-1,i+colspan-1)]>range.leftPx&&(appendCellHtml(stringArray,row,i,colspan,d),cellsAdded++),i+=colspan>1?colspan-1:0}else i+=colspan>1?colspan-1:0;cellsAdded&&(cellsAdded,processedRows.push(row))}if(stringArray.length){var processedRow,node,x=document.createElement("div");for(x.innerHTML=stringArray.join("");null!=(processedRow=processedRows.pop());){cacheEntry=rowsCache[processedRow];for(var columnIdx;null!=(columnIdx=cacheEntry.cellRenderQueue.pop());)node=x.lastChild,cacheEntry.rowNode.appendChild(node),cacheEntry.cellNodesByColumnIdx[columnIdx]=node}}}function renderRows(range){for(var parentNode=$canvas[0],stringArray=[],rows=[],needToReselectCell=!1,dataLength=getDataLength(),i=range.top,ii=range.bottom;i<=ii;i++)rowsCache[i]||(renderedRows++,rows.push(i),rowsCache[i]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},appendRowHtml(stringArray,i,range,dataLength),activeCellNode&&activeRow===i&&(needToReselectCell=!0),counter_rows_rendered++);if(rows.length){var x=document.createElement("div");x.innerHTML=stringArray.join("");for(i=0,ii=rows.length;i<ii;i++)rowsCache[rows[i]].rowNode=parentNode.appendChild(x.firstChild);needToReselectCell&&(activeCellNode=getCellNode(activeRow,activeCell))}}function startPostProcessing(){options.enableAsyncPostRender&&(clearTimeout(h_postrender),h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}function startPostProcessingCleanup(){options.enableAsyncPostRenderCleanup&&(clearTimeout(h_postrenderCleanup),h_postrenderCleanup=setTimeout(asyncPostProcessCleanupRows,options.asyncPostRenderCleanupDelay))}function invalidatePostProcessingResults(row){for(var columnIdx in postProcessedRows[row])postProcessedRows[row].hasOwnProperty(columnIdx)&&(postProcessedRows[row][columnIdx]="C");postProcessFromRow=Math.min(postProcessFromRow,row),postProcessToRow=Math.max(postProcessToRow,row),startPostProcessing()}function updateRowPositions(){for(var row in rowsCache)rowsCache[row].rowNode.style.top=getRowTop(row)+"px"}function render(){if(initialized){var visible=getVisibleRange(),rendered=getRenderedRange();cleanupRows(rendered),lastRenderedScrollLeft!=scrollLeft&&cleanUpAndRenderCells(rendered),renderRows(rendered),postProcessFromRow=visible.top,postProcessToRow=Math.min(getDataLengthIncludingAddNew()-1,visible.bottom),startPostProcessing(),lastRenderedScrollTop=scrollTop,lastRenderedScrollLeft=scrollLeft,h_render=null}}function handleHeaderRowScroll(){var scrollLeft=$headerRowScroller[0].scrollLeft;scrollLeft!=$viewport[0].scrollLeft&&($viewport[0].scrollLeft=scrollLeft)}function handleScroll(){scrollTop=$viewport[0].scrollTop,scrollLeft=$viewport[0].scrollLeft;var vScrollDist=Math.abs(scrollTop-prevScrollTop),hScrollDist=Math.abs(scrollLeft-prevScrollLeft);if(hScrollDist&&(prevScrollLeft=scrollLeft,$headerScroller[0].scrollLeft=scrollLeft,$topPanelScroller[0].scrollLeft=scrollLeft,$headerRowScroller[0].scrollLeft=scrollLeft),vScrollDist)if(vScrollDir=prevScrollTop<scrollTop?1:-1,prevScrollTop=scrollTop,vScrollDist<viewportH)scrollTo(scrollTop+offset);else{var oldOffset=offset;page=h==viewportH?0:Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph))),oldOffset!=(offset=Math.round(page*cj))&&invalidateAllRows()}(hScrollDist||vScrollDist)&&(render(),trigger(self.onViewportChanged,{grid:self})),trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop,grid:self})}function asyncPostProcessRows(){for(var dataLength=getDataLength();postProcessFromRow<=postProcessToRow;){var row=vScrollDir>=0?postProcessFromRow++:postProcessToRow--,cacheEntry=rowsCache[row];if(cacheEntry&&!(row>=dataLength)){for(var columnIdx in postProcessedRows[row]||(postProcessedRows[row]={}),ensureCellNodesInRowsCache(row),cacheEntry.cellNodesByColumnIdx)if(cacheEntry.cellNodesByColumnIdx.hasOwnProperty(columnIdx)){var m=columns[columnIdx|=0],processedStatus=postProcessedRows[row][columnIdx];if(m.asyncPostRender&&"R"!==processedStatus){var node=cacheEntry.cellNodesByColumnIdx[columnIdx];node&&m.asyncPostRender(node,row,getDataItem(row),m,"C"===processedStatus),postProcessedRows[row][columnIdx]="R"}}return void(h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}}}function asyncPostProcessCleanupRows(){if(postProcessedCleanupQueue.length>0){for(var groupId=postProcessedCleanupQueue[0].groupId;postProcessedCleanupQueue.length>0&&postProcessedCleanupQueue[0].groupId==groupId;){var entry=postProcessedCleanupQueue.shift();if("R"==entry.actionType&&$(entry.node).remove(),"C"==entry.actionType){var column=columns[entry.columnIdx];column.asyncPostRenderCleanup&&entry.node&&column.asyncPostRenderCleanup(entry.node,entry.rowIdx,column)}}h_postrenderCleanup=setTimeout(asyncPostProcessCleanupRows,options.asyncPostRenderCleanupDelay)}}function updateCellCssStylesOnRenderedRows(addedHash,removedHash){var node,columnId,addedRowHash,removedRowHash;for(var row in rowsCache){if(removedRowHash=removedHash&&removedHash[row],addedRowHash=addedHash&&addedHash[row],removedRowHash)for(columnId in removedRowHash)addedRowHash&&removedRowHash[columnId]==addedRowHash[columnId]||(node=getCellNode(row,getColumnIndex(columnId)))&&$(node).removeClass(removedRowHash[columnId]);if(addedRowHash)for(columnId in addedRowHash)removedRowHash&&removedRowHash[columnId]==addedRowHash[columnId]||(node=getCellNode(row,getColumnIndex(columnId)))&&$(node).addClass(addedRowHash[columnId])}}function addCellCssStyles(key,hash){if(cellCssClasses[key])throw"addCellCssStyles: cell CSS hash with key '"+key+"' already exists.";cellCssClasses[key]=hash,updateCellCssStylesOnRenderedRows(hash,null),trigger(self.onCellCssStylesChanged,{key:key,hash:hash,grid:self})}function removeCellCssStyles(key){cellCssClasses[key]&&(updateCellCssStylesOnRenderedRows(null,cellCssClasses[key]),delete cellCssClasses[key],trigger(self.onCellCssStylesChanged,{key:key,hash:null,grid:self}))}function setCellCssStyles(key,hash){var prevHash=cellCssClasses[key];cellCssClasses[key]=hash,updateCellCssStylesOnRenderedRows(hash,prevHash),trigger(self.onCellCssStylesChanged,{key:key,hash:hash,grid:self})}function getCellCssStyles(key){return cellCssClasses[key]}function flashCell(row,cell,speed){if(speed=speed||100,rowsCache[row]){var $cell=$(getCellNode(row,cell));!function toggleCellClass(times){times&&setTimeout(function(){$cell.queue(function(){$cell.toggleClass(options.cellFlashingCssClass).dequeue(),toggleCellClass(times-1)})},speed)}(4)}}function handleMouseWheel(e){var rowNode=$(e.target).closest(".slick-row")[0];rowNode!=rowNodeFromLastMouseWheelEvent&&(zombieRowNodeFromLastMouseWheelEvent&&zombieRowNodeFromLastMouseWheelEvent!=rowNode&&(options.enableAsyncPostRenderCleanup&&zombieRowPostProcessedFromLastMouseWheelEvent?queuePostProcessedRowForCleanup(zombieRowCacheFromLastMouseWheelEvent,zombieRowPostProcessedFromLastMouseWheelEvent):$canvas[0].removeChild(zombieRowNodeFromLastMouseWheelEvent),zombieRowNodeFromLastMouseWheelEvent=null,zombieRowCacheFromLastMouseWheelEvent=null,zombieRowPostProcessedFromLastMouseWheelEvent=null,options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()),rowNodeFromLastMouseWheelEvent=rowNode)}function handleDragInit(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell))return!1;var retval=trigger(self.onDragInit,dd,e);return!!e.isImmediatePropagationStopped()&&retval}function handleDragStart(e,dd){var cell=getCellFromEvent(e);if(!cell||!cellExists(cell.row,cell.cell))return!1;var retval=trigger(self.onDragStart,dd,e);return!!e.isImmediatePropagationStopped()&&retval}function handleDrag(e,dd){return trigger(self.onDrag,dd,e)}function handleDragEnd(e,dd){trigger(self.onDragEnd,dd,e)}function handleKeyDown(e){trigger(self.onKeyDown,{row:activeRow,cell:activeCell,grid:self},e);var handled=e.isImmediatePropagationStopped(),keyCode=Slick.keyCode;if(!handled)if(e.shiftKey||e.altKey||e.ctrlKey)e.which!=keyCode.TAB||!e.shiftKey||e.ctrlKey||e.altKey||(handled=navigatePrev());else if(e.which==keyCode.ESCAPE){if(!getEditorLock().isActive())return;cancelEditAndSetFocus()}else e.which==keyCode.PAGEDOWN?(navigatePageDown(),handled=!0):e.which==keyCode.PAGEUP?(navigatePageUp(),handled=!0):e.which==keyCode.LEFT?handled=navigateLeft():e.which==keyCode.RIGHT?handled=navigateRight():e.which==keyCode.UP?handled=navigateUp():e.which==keyCode.DOWN?handled=navigateDown():e.which==keyCode.TAB?handled=navigateNext():e.which==keyCode.ENTER&&(options.editable&&(currentEditor?activeRow===getDataLength()?navigateDown():commitEditAndSetFocus():getEditorLock().commitCurrentEdit()&&makeActiveCellEditable()),handled=!0);if(handled){e.stopPropagation(),e.preventDefault();try{e.originalEvent.keyCode=0}catch(error){}}}function handleClick(e){currentEditor||(e.target!=document.activeElement||$(e.target).hasClass("slick-cell"))&&setFocus();var cell=getCellFromEvent(e);!cell||null!==currentEditor&&activeRow==cell.row&&activeCell==cell.cell||(trigger(self.onClick,{row:cell.row,cell:cell.cell,grid:self},e),e.isImmediatePropagationStopped()||activeCell==cell.cell&&activeRow==cell.row||!canCellBeActive(cell.row,cell.cell)||getEditorLock().isActive()&&!getEditorLock().commitCurrentEdit()||(scrollRowIntoView(cell.row,!1),setActiveCellInternal(getCellNode(cell.row,cell.cell))))}function handleContextMenu(e){var $cell=$(e.target).closest(".slick-cell",$canvas);0!==$cell.length&&(activeCellNode===$cell[0]&&null!==currentEditor||trigger(self.onContextMenu,{grid:self},e))}function handleDblClick(e){var cell=getCellFromEvent(e);!cell||null!==currentEditor&&activeRow==cell.row&&activeCell==cell.cell||(trigger(self.onDblClick,{row:cell.row,cell:cell.cell,grid:self},e),e.isImmediatePropagationStopped()||options.editable&&gotoCell(cell.row,cell.cell,!0))}function handleHeaderMouseEnter(e){trigger(self.onHeaderMouseEnter,{column:$(this).data("column"),grid:self},e)}function handleHeaderMouseLeave(e){trigger(self.onHeaderMouseLeave,{column:$(this).data("column"),grid:self},e)}function handleHeaderContextMenu(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns"),column=$header&&$header.data("column");trigger(self.onHeaderContextMenu,{column:column,grid:self},e)}function handleHeaderClick(e){var $header=$(e.target).closest(".slick-header-column",".slick-header-columns"),column=$header&&$header.data("column");column&&trigger(self.onHeaderClick,{column:column,grid:self},e)}function handleMouseEnter(e){trigger(self.onMouseEnter,{grid:self},e)}function handleMouseLeave(e){trigger(self.onMouseLeave,{grid:self},e)}function cellExists(row,cell){return!(row<0||row>=getDataLength()||cell<0||cell>=columns.length)}function getCellFromPoint(x,y){for(var row=getRowFromPosition(y),cell=0,w=0,i=0;i<columns.length&&w<x;i++)w+=columns[i].width,cell++;return cell<0&&(cell=0),{row:row,cell:cell-1}}function getCellFromNode(cellNode){var cls=/l\d+/.exec(cellNode.className);if(!cls)throw"getCellFromNode: cannot get cell - "+cellNode.className;return parseInt(cls[0].substr(1,cls[0].length-1),10)}function getRowFromNode(rowNode){for(var row in rowsCache)if(rowsCache[row].rowNode===rowNode)return 0|row;return null}function getCellFromEvent(e){var $cell=$(e.target).closest(".slick-cell",$canvas);if(!$cell.length)return null;var row=getRowFromNode($cell[0].parentNode),cell=getCellFromNode($cell[0]);return null==row||null==cell?null:{row:row,cell:cell}}function getCellNodeBox(row,cell){if(!cellExists(row,cell))return null;for(var y1=getRowTop(row),y2=y1+options.rowHeight-1,x1=0,i=0;i<cell;i++)x1+=columns[i].width;return{top:y1,left:x1,bottom:y2,right:x1+columns[cell].width}}function resetActiveCell(){setActiveCellInternal(null,!1)}function setFocus(){-1==tabbingDirection?$focusSink[0].focus():$focusSink2[0].focus()}function scrollCellIntoView(row,cell,doPaging){scrollRowIntoView(row,doPaging);var colspan=getColspan(row,cell),left=columnPosLeft[cell],right=columnPosRight[cell+(colspan>1?colspan-1:0)],scrollRight=scrollLeft+viewportW;left<scrollLeft?($viewport.scrollLeft(left),handleScroll(),render()):right>scrollRight&&($viewport.scrollLeft(Math.min(left,right-$viewport[0].clientWidth)),handleScroll(),render())}function setActiveCellInternal(newCell,opt_editMode){null!==activeCellNode&&(makeActiveCellNormal(),$(activeCellNode).removeClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).removeClass("active"));var activeCellChanged=activeCellNode!==newCell;null!=(activeCellNode=newCell)?(activeRow=getRowFromNode(activeCellNode.parentNode),activeCell=activePosX=getCellFromNode(activeCellNode),null==opt_editMode&&(opt_editMode=activeRow==getDataLength()||options.autoEdit),$(activeCellNode).addClass("active"),$(rowsCache[activeRow].rowNode).addClass("active"),options.editable&&opt_editMode&&isCellPotentiallyEditable(activeRow,activeCell)&&(clearTimeout(h_editorLoader),options.asyncEditorLoading?h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay):makeActiveCellEditable())):activeRow=activeCell=null,activeCellChanged&&trigger(self.onActiveCellChanged,getActiveCell())}function clearTextSelection(){if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(e){}else if(window.getSelection){var sel=window.getSelection();sel&&sel.removeAllRanges&&sel.removeAllRanges()}}function isCellPotentiallyEditable(row,cell){var dataLength=getDataLength();return!(row<dataLength&&!getDataItem(row)||columns[cell].cannotTriggerInsert&&row>=dataLength||!getEditor(row,cell))}function makeActiveCellNormal(){if(currentEditor){if(trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor,grid:self}),currentEditor.destroy(),currentEditor=null,activeCellNode){var d=getDataItem(activeRow);if($(activeCellNode).removeClass("editable invalid"),d){var column=columns[activeCell],formatter=getFormatter(activeRow,column);activeCellNode.innerHTML=formatter(activeRow,activeCell,getDataItemValueForColumn(d,column),column,d,self),invalidatePostProcessingResults(activeRow)}}navigator.userAgent.toLowerCase().match(/msie/)&&clearTextSelection(),getEditorLock().deactivate(editController)}}function makeActiveCellEditable(editor){if(activeCellNode){if(!options.editable)throw"Grid : makeActiveCellEditable : should never get called when options.editable is false";if(clearTimeout(h_editorLoader),isCellPotentiallyEditable(activeRow,activeCell)){var columnDef=columns[activeCell],item=getDataItem(activeRow);if(!1===trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:item,column:columnDef,grid:self}))return void setFocus();getEditorLock().activate(editController),$(activeCellNode).addClass("editable");var useEditor=editor||getEditor(activeRow,activeCell);editor||useEditor.suppressClearOnEdit||(activeCellNode.innerHTML=""),currentEditor=new useEditor({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:columnDef,item:item||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus}),item&&currentEditor.loadValue(item),serializedEditorValue=currentEditor.serializeValue(),currentEditor.position&&handleActiveCellPositionChange()}}}function commitEditAndSetFocus(){getEditorLock().commitCurrentEdit()&&(setFocus(),options.autoEdit&&navigateDown())}function cancelEditAndSetFocus(){getEditorLock().cancelCurrentEdit()&&setFocus()}function absBox(elem){var box={top:elem.offsetTop,left:elem.offsetLeft,bottom:0,right:0,width:$(elem).outerWidth(),height:$(elem).outerHeight(),visible:!0};box.bottom=box.top+box.height,box.right=box.left+box.width;for(var offsetParent=elem.offsetParent;(elem=elem.parentNode)!=document.body&&null!=elem;)box.visible&&elem.scrollHeight!=elem.offsetHeight&&"visible"!=$(elem).css("overflowY")&&(box.visible=box.bottom>elem.scrollTop&&box.top<elem.scrollTop+elem.clientHeight),box.visible&&elem.scrollWidth!=elem.offsetWidth&&"visible"!=$(elem).css("overflowX")&&(box.visible=box.right>elem.scrollLeft&&box.left<elem.scrollLeft+elem.clientWidth),box.left-=elem.scrollLeft,box.top-=elem.scrollTop,elem===offsetParent&&(box.left+=elem.offsetLeft,box.top+=elem.offsetTop,offsetParent=elem.offsetParent),box.bottom=box.top+box.height,box.right=box.left+box.width;return box}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(activeCellNode&&(trigger(self.onActiveCellPositionChanged,{grid:self}),currentEditor)){var cellBox=getActiveCellPosition();currentEditor.show&&currentEditor.hide&&(cellBox.visible?currentEditor.show():currentEditor.hide()),currentEditor.position&&currentEditor.position(cellBox)}}function getCellEditor(){return currentEditor}function getActiveCell(){return activeCellNode?{row:activeRow,cell:activeCell,grid:self}:null}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(row,doPaging){var rowAtTop=row*options.rowHeight,rowAtBottom=(row+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);(row+1)*options.rowHeight>scrollTop+viewportH+offset?(scrollTo(doPaging?rowAtTop:rowAtBottom),render()):row*options.rowHeight<scrollTop+offset&&(scrollTo(doPaging?rowAtBottom:rowAtTop),render())}function scrollRowToTop(row){scrollTo(row*options.rowHeight),render()}function scrollPage(dir){var deltaRows=dir*numVisibleRows;if(scrollTo((getRowFromPosition(scrollTop)+deltaRows)*options.rowHeight),render(),options.enableCellNavigation&&null!=activeRow){var row=activeRow+deltaRows,dataLengthIncludingAddNew=getDataLengthIncludingAddNew();row>=dataLengthIncludingAddNew&&(row=dataLengthIncludingAddNew-1),row<0&&(row=0);for(var cell=0,prevCell=null,prevActivePosX=activePosX;cell<=activePosX;)canCellBeActive(row,cell)&&(prevCell=cell),cell+=getColspan(row,cell);null!==prevCell?(setActiveCellInternal(getCellNode(row,prevCell)),activePosX=prevActivePosX):resetActiveCell()}}function navigatePageDown(){scrollPage(1)}function navigatePageUp(){scrollPage(-1)}function getColspan(row,cell){var metadata=data.getItemMetadata&&data.getItemMetadata(row);if(!metadata||!metadata.columns)return 1;var columnData=metadata.columns[columns[cell].id]||metadata.columns[cell],colspan=columnData&&columnData.colspan;return"*"===colspan?columns.length-cell:colspan||1}function findFirstFocusableCell(row){for(var cell=0;cell<columns.length;){if(canCellBeActive(row,cell))return cell;cell+=getColspan(row,cell)}return null}function findLastFocusableCell(row){for(var cell=0,lastFocusableCell=null;cell<columns.length;)canCellBeActive(row,cell)&&(lastFocusableCell=cell),cell+=getColspan(row,cell);return lastFocusableCell}function gotoRight(row,cell,posX){if(cell>=columns.length)return null;do{cell+=getColspan(row,cell)}while(cell<columns.length&&!canCellBeActive(row,cell));return cell<columns.length?{row:row,cell:cell,posX:cell}:null}function gotoLeft(row,cell,posX){if(cell<=0)return null;var firstFocusableCell=findFirstFocusableCell(row);if(null===firstFocusableCell||firstFocusableCell>=cell)return null;for(var pos,prev={row:row,cell:firstFocusableCell,posX:firstFocusableCell};;){if(!(pos=gotoRight(prev.row,prev.cell,prev.posX)))return null;if(pos.cell>=cell)return prev;prev=pos}}function gotoDown(row,cell,posX){for(var prevCell,dataLengthIncludingAddNew=getDataLengthIncludingAddNew();;){if(++row>=dataLengthIncludingAddNew)return null;for(prevCell=cell=0;cell<=posX;)prevCell=cell,cell+=getColspan(row,cell);if(canCellBeActive(row,prevCell))return{row:row,cell:prevCell,posX:posX}}}function gotoUp(row,cell,posX){for(var prevCell;;){if(--row<0)return null;for(prevCell=cell=0;cell<=posX;)prevCell=cell,cell+=getColspan(row,cell);if(canCellBeActive(row,prevCell))return{row:row,cell:prevCell,posX:posX}}}function gotoNext(row,cell,posX){if(null==row&&null==cell&&canCellBeActive(row=cell=posX=0,cell))return{row:row,cell:cell,posX:cell};var pos=gotoRight(row,cell,posX);if(pos)return pos;for(var firstFocusableCell=null,dataLengthIncludingAddNew=getDataLengthIncludingAddNew();++row<dataLengthIncludingAddNew;)if(null!==(firstFocusableCell=findFirstFocusableCell(row)))return{row:row,cell:firstFocusableCell,posX:firstFocusableCell};return null}function gotoPrev(row,cell,posX){if(null==row&&null==cell&&canCellBeActive(row=getDataLengthIncludingAddNew()-1,cell=posX=columns.length-1))return{row:row,cell:cell,posX:cell};for(var pos,lastSelectableCell;!pos&&!(pos=gotoLeft(row,cell,posX));){if(--row<0)return null;cell=0,null!==(lastSelectableCell=findLastFocusableCell(row))&&(pos={row:row,cell:lastSelectableCell,posX:lastSelectableCell})}return pos}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigate(dir){if(!options.enableCellNavigation)return!1;if(!activeCellNode&&"prev"!=dir&&"next"!=dir)return!1;if(!getEditorLock().commitCurrentEdit())return!0;setFocus();tabbingDirection={up:-1,down:1,left:-1,right:1,prev:-1,next:1}[dir];var pos=(0,{up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext}[dir])(activeRow,activeCell,activePosX);if(pos){var isAddNewRow=pos.row==getDataLength();return scrollCellIntoView(pos.row,pos.cell,!isAddNewRow),setActiveCellInternal(getCellNode(pos.row,pos.cell)),activePosX=pos.posX,!0}return setActiveCellInternal(getCellNode(activeRow,activeCell)),!1}function getCellNode(row,cell){return rowsCache[row]?(ensureCellNodesInRowsCache(row),rowsCache[row].cellNodesByColumnIdx[cell]):null}function setActiveCell(row,cell){initialized&&(row>getDataLength()||row<0||cell>=columns.length||cell<0||options.enableCellNavigation&&(scrollCellIntoView(row,cell,!1),setActiveCellInternal(getCellNode(row,cell),!1)))}function canCellBeActive(row,cell){if(!options.enableCellNavigation||row>=getDataLengthIncludingAddNew()||row<0||cell>=columns.length||cell<0)return!1;var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&"boolean"==typeof rowMetadata.focusable)return rowMetadata.focusable;var columnMetadata=rowMetadata&&rowMetadata.columns;return columnMetadata&&columnMetadata[columns[cell].id]&&"boolean"==typeof columnMetadata[columns[cell].id].focusable?columnMetadata[columns[cell].id].focusable:columnMetadata&&columnMetadata[cell]&&"boolean"==typeof columnMetadata[cell].focusable?columnMetadata[cell].focusable:columns[cell].focusable}function canCellBeSelected(row,cell){if(row>=getDataLength()||row<0||cell>=columns.length||cell<0)return!1;var rowMetadata=data.getItemMetadata&&data.getItemMetadata(row);if(rowMetadata&&"boolean"==typeof rowMetadata.selectable)return rowMetadata.selectable;var columnMetadata=rowMetadata&&rowMetadata.columns&&(rowMetadata.columns[columns[cell].id]||rowMetadata.columns[cell]);return columnMetadata&&"boolean"==typeof columnMetadata.selectable?columnMetadata.selectable:columns[cell].selectable}function gotoCell(row,cell,forceEdit){initialized&&canCellBeActive(row,cell)&&getEditorLock().commitCurrentEdit()&&(scrollCellIntoView(row,cell,!1),setActiveCellInternal(getCellNode(row,cell),forceEdit||row===getDataLength()||options.autoEdit),currentEditor||setFocus())}function commitCurrentEdit(){var item=getDataItem(activeRow),column=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var validationResults=currentEditor.validate();if(validationResults.valid){if(activeRow<getDataLength()){var editCommand={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(item,this.serializedValue),updateRow(this.row),trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:item,grid:self})},undo:function(){this.editor.applyValue(item,this.prevSerializedValue),updateRow(this.row),trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:item,grid:self})}};options.editCommandHandler?(makeActiveCellNormal(),options.editCommandHandler(item,column,editCommand)):(editCommand.execute(),makeActiveCellNormal())}else{var newItem={};currentEditor.applyValue(newItem,currentEditor.serializeValue()),makeActiveCellNormal(),trigger(self.onAddNewRow,{item:newItem,column:column,grid:self})}return!getEditorLock().isActive()}return $(activeCellNode).removeClass("invalid"),$(activeCellNode).width(),$(activeCellNode).addClass("invalid"),trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:validationResults,row:activeRow,cell:activeCell,column:column,grid:self}),currentEditor.focus(),!1}makeActiveCellNormal()}return!0}function cancelCurrentEdit(){return makeActiveCellNormal(),!0}function rowsToRanges(rows){for(var ranges=[],lastCell=columns.length-1,i=0;i<rows.length;i++)ranges.push(new Slick.Range(rows[i],0,rows[i],lastCell));return ranges}function getSelectedRows(){if(!selectionModel)throw"Selection model is not set";return selectedRows}function setSelectedRows(rows){if(!selectionModel)throw"Selection model is not set";selectionModel.setSelectedRanges(rowsToRanges(rows))}var defaults={explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,enableAsyncPostRenderCleanup:!1,asyncPostRenderCleanupDelay:40,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showHeaderRow:!1,headerRowHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,fullWidthRows:!1,multiColumnSort:!1,defaultFormatter:defaultFormatter,forceSyncScrolling:!1,addNewRowCssClass:"new-row"},columnDefaults={name:"",resizable:!0,sortable:!1,minWidth:30,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},th,h,ph,n,cj,page=0,offset=0,vScrollDir=1,initialized=!1,$container,uid="slickgrid_"+Math.round(1e6*Math.random()),self=this,$focusSink,$focusSink2,$headerScroller,$headers,$headerRow,$headerRowScroller,$headerRowSpacer,$topPanelScroller,$topPanel,$viewport,$canvas,$style,$boundAncestors,stylesheet,columnCssRulesL,columnCssRulesR,viewportH,viewportW,canvasWidth,viewportHasHScroll,viewportHasVScroll,headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0,jQueryNewWidthBehaviour=!1,absoluteColumnMinWidth,tabbingDirection=1,activePosX,activeRow,activeCell,activeCellNode=null,currentEditor=null,serializedEditorValue,editController,rowsCache={},renderedRows=0,numVisibleRows,prevScrollTop=0,scrollTop=0,lastRenderedScrollTop=0,lastRenderedScrollLeft=0,prevScrollLeft=0,scrollLeft=0,selectionModel,selectedRows=[],plugins=[],cellCssClasses={},columnsById={},sortColumns=[],columnPosLeft=[],columnPosRight=[],h_editorLoader=null,h_render=null,h_postrender=null,h_postrenderCleanup=null,postProcessedRows={},postProcessToRow=null,postProcessFromRow=null,postProcessedCleanupQueue=[],postProcessgroupId=0,counter_rows_rendered=0,counter_rows_removed=0,rowNodeFromLastMouseWheelEvent,zombieRowNodeFromLastMouseWheelEvent,zombieRowCacheFromLastMouseWheelEvent,zombieRowPostProcessedFromLastMouseWheelEvent,cssShow={position:"absolute",visibility:"hidden",display:"block"},$hiddenParents,oldProps=[];this.debug=function(){var s="";s+="\ncounter_rows_rendered:  "+counter_rows_rendered,s+="\ncounter_rows_removed:  "+counter_rows_removed,s+="\nrenderedRows:  "+renderedRows,s+="\nnumVisibleRows:  "+numVisibleRows,s+="\nmaxSupportedCssHeight:  "+maxSupportedCssHeight,s+="\nn(umber of pages):  "+n,s+="\n(current) page:  "+page,s+="\npage height (ph):  "+ph,s+="\nvScrollDir:  "+vScrollDir,alert(s)},this.eval=function(expr){return eval(expr)},$.extend(this,{slickGridVersion:"2.2.4",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onClick:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onAddNewRow:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsResized:new Slick.Event,onCellChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,setSortColumns:setSortColumns,getSortColumns:getSortColumns,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,getContainerNode:getContainerNode,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,getRenderedRange:getRenderedRange,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,scrollRowToTop:scrollRowToTop,scrollCellIntoView:scrollCellIntoView,getCanvasNode:getCanvasNode,focus:setFocus,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,navigatePageUp:navigatePageUp,navigatePageDown:navigatePageDown,gotoCell:gotoCell,getTopPanel:getTopPanel,setTopPanelVisibility:setTopPanelVisibility,setHeaderRowVisibility:setHeaderRowVisibility,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,getCellCssStyles:getCellCssStyles,init:finishInitialization,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController}),init()}var scrollbarDimensions,maxSupportedCssHeight;$.extend(!0,window,{Slick:{Grid:SlickGrid}})}(jQuery),function($){$.extend(!0,window,{Slick:{RowSelectionModel:function(options){var _grid,_inHandler,_options,_ranges=[],_self=this,_handler=new Slick.EventHandler,_defaults={selectActiveRow:!0};function wrapHandler(handler){return function(){_inHandler||(_inHandler=!0,handler.apply(this,arguments),_inHandler=!1)}}function rangesToRows(ranges){for(var rows=[],i=0;i<ranges.length;i++)for(var j=ranges[i].fromRow;j<=ranges[i].toRow;j++)rows.push(j);return rows}function rowsToRanges(rows){for(var ranges=[],lastCell=_grid.getColumns().length-1,i=0;i<rows.length;i++)ranges.push(new Slick.Range(rows[i],0,rows[i],lastCell));return ranges}function getSelectedRows(){return rangesToRows(_ranges)}function setSelectedRanges(ranges){ranges&&0!==ranges.length||_grid.resetActiveCell(),_ranges=ranges,_self.onSelectedRangesChanged.notify(_ranges)}function handleActiveCellChange(e,data){_options.selectActiveRow&&null!=data.row&&setSelectedRanges([new Slick.Range(data.row,0,data.row,_grid.getColumns().length-1)])}function selectAll(){setSelectedRanges(_ranges=[new Slick.Range(0,0,_grid.getDataLength()-1,_grid.getColumns().length-1)])}function handleKeyDown(e){if(65===e.which&&(e.ctrlKey||e.metaKey))return selectAll(),e.preventDefault(),void e.stopImmediatePropagation();var activeRow=_grid.getActiveCell();if(activeRow&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&(38==e.which||40==e.which)){var selectedRows=getSelectedRows();selectedRows.sort(function(x,y){return x-y}),selectedRows.length||(selectedRows=[activeRow.row]);var active,top=selectedRows[0],bottom=selectedRows[selectedRows.length-1];(active=40==e.which?activeRow.row<bottom||top==bottom?++bottom:++top:activeRow.row<bottom?--bottom:--top)>=0&&active<_grid.getDataLength()&&(_grid.scrollRowIntoView(active),setSelectedRanges(_ranges=rowsToRanges(function(from,to){var i,rows=[];for(i=from;i<=to;i++)rows.push(i);for(i=to;i<from;i++)rows.push(i);return rows}(top,bottom)))),e.preventDefault(),e.stopPropagation()}}function handleClick(e){var cell=_grid.getCellFromEvent(e);if(!cell||!_grid.canCellBeActive(cell.row,cell.cell))return!1;if(_grid.getOptions().multiSelect&&1==_ranges.length&&0===_ranges[0].fromRow&&_ranges[0].toRow===_grid.getDataLength()-1)return _grid.setActiveCell(cell.row,cell.cell),setSelectedRanges(_ranges=rowsToRanges([cell.row])),!0;if(!_grid.getOptions().multiSelect||!e.ctrlKey&&!e.shiftKey&&!e.metaKey)return!1;var selection=rangesToRows(_ranges),idx=$.inArray(cell.row,selection);if(-1===idx&&(e.ctrlKey||e.metaKey))selection.push(cell.row),_grid.setActiveCell(cell.row,cell.cell);else if(-1!==idx&&(e.ctrlKey||e.metaKey))selection=$.grep(selection,function(o,i){return o!==cell.row}),_grid.setActiveCell(cell.row,cell.cell);else if(selection.length&&e.shiftKey){var last=selection.pop(),from=Math.min(cell.row,last),to=Math.max(cell.row,last);selection=[];for(var i=from;i<=to;i++)i!==last&&selection.push(i);selection.push(last),_grid.setActiveCell(cell.row,cell.cell)}return setSelectedRanges(_ranges=rowsToRanges(selection)),!0}$.extend(this,{getSelectedRows:getSelectedRows,setSelectedRows:function(rows){setSelectedRanges(rowsToRanges(rows))},getSelectedRanges:function(){return _ranges},setSelectedRanges:setSelectedRanges,init:function(grid){_options=$.extend(!0,{},_defaults,options),_grid=grid,_handler.subscribe(_grid.onActiveCellChanged,wrapHandler(handleActiveCellChange)),_handler.subscribe(_grid.onKeyDown,wrapHandler(handleKeyDown)),_handler.subscribe(_grid.onClick,wrapHandler(handleClick))},destroy:function(){_handler.unsubscribeAll()},selectAll:selectAll,onSelectedRangesChanged:new Slick.Event})}}})}(jQuery),"undefined"==typeof tablelegs&&(tablelegs={}),tablelegs.Grid=function(options){this.options=options;var slickGrid,_this=this;this.items=options.items,this.modelToView=null,this.viewOrder=null,this.rowClassProvider=function(){return""},this.filter=new tablelegs.CombinedGridFilter;var model={getLength:function(){return null!=_this.viewOrder?_this.viewOrder.length:_this.items.length},getItem:function(index){return _this.items[null!=_this.viewOrder?_this.viewOrder[index]:index]},getItemMetadata:function(viewIndex){var c=_this.rowClassProvider(viewIndex);if(null!=c)return{cssClasses:c}}};this.$el=options.$el;var gridOptions=$.extend({},{select:!0,multiColumnSort:!0,forceSyncScrolling:!0,multiSelect:options.multiSelect,enableTextSelectionOnCells:null==options.enableTextSelectionOnCells||options.enableTextSelectionOnCells,forceFitColumns:!0,dataItemColumnValueExtractor:function(item,column){return column.getter(item)},defaultFormatter:function(row,cell,value,columnDef,dataContext){if(_.isNumber(value))return Math.floor(value)===value?value:morpheus.Util.nf(value);if(morpheus.Util.isArray(value)){for(var s=[],i=0,length=value.length;i<length;i++){i>0&&s.push(", ");value[i];s.push(value[i])}return s.join("")}return value}},options.gridOptions||{});slickGrid=new Slick.Grid(options.$el,model,options.columns,gridOptions),this.slickGrid=slickGrid,gridOptions.select&&(slickGrid.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow:!0,multiSelect:gridOptions.multiSelect})),slickGrid.getSelectionModel().onSelectedRangesChanged.subscribe(function(e){_this.trigger("selectionChanged",{selectedRows:slickGrid.getSelectedRows()})})),slickGrid.onSort.subscribe(function(e,args){_this.sortCols=args.sortCols,_this._updateMappings(),slickGrid.invalidate()}),slickGrid.onClick.subscribe(function(e){var cell=slickGrid.getCellFromEvent(e);cell&&_this.trigger("click",{row:cell.row,cell:cell.cell,target:e.target})}),options.$el.on("mouseover",".slick-row",function(e){var cell=slickGrid.getCellFromEvent(e);cell&&_this.trigger("mouseover",{row:cell.row,cell:cell.cell,target:e.target})}),options.$el.on("mouseout",".slick-row",function(e){var cell=slickGrid.getCellFromEvent(e);cell&&_this.trigger("mouseout",{row:cell.row,cell:cell.cell,target:e.target})}),options.$el.on("dblclick",function(e){var cell=slickGrid.getCellFromEvent(e);cell&&_this.trigger("dblclick",{row:cell.row,target:e.target})}),options.sort&&this.setSortColumns(options.sort),this.slickGrid.invalidate()},tablelegs.Grid.prototype={columnsAutosized:!1,setSortColumns:function(columns){var gridSortColumns=[],gridColumns=this.slickGrid.getColumns();this.sortCols=[];var _this=this;columns.forEach(function(c){for(var column=null,i=0;i<gridColumns.length;i++)if(gridColumns[i].name===c.name){column=gridColumns[i];break}null!=column&&gridSortColumns.push({columnId:column.id,sortAsc:c.ascending}),_this.sortCols.push({sortCol:c,sortAsc:c.ascending})}),this.slickGrid.setSortColumns(gridSortColumns),this._updateMappings(),this.slickGrid.invalidate()},setRowClassProvider:function(rowClassProvider){this.rowClassProvider=null==rowClassProvider?function(){return""}:rowClassProvider},setColumns:function(columns){this.slickGrid.setColumns(columns),this.columnsAutosized=!1,this.autosizeColumns(),this.slickGrid.invalidate()},getColumns:function(){return this.slickGrid.getColumns()},getSelectedRows:function(){return this.slickGrid.getSelectedRows()},getSelectedItems:function(){for(var rows=this.slickGrid.getSelectedRows(),selection=[],i=0,nrows=rows.length;i<nrows;i++)selection.push(this.items[this.convertViewIndexToModel(rows[i])]);return selection},getSelectedItem:function(){var rows=this.slickGrid.getSelectedRows();return 1===rows.length?this.items[this.convertViewIndexToModel(rows[0])]:null},setCellCssClass:function(rowIndices,columnIndices,cssClass,clear){var hash=clear?{}:this.slickGrid.getCellCssStyles("user");hash||(hash={});for(var columns=this.slickGrid.getColumns(),i=0;i<rowIndices.length;i++){var row=rowIndices[i];hash[row]||(hash[row]={});for(var j=0;j<columnIndices.length;j++)hash[row][columns[columnIndices[j]].id]=cssClass}this.slickGrid.setCellCssStyles("user",hash)},getItems:function(){for(var items=[],i=0,length=this.getFilteredItemCount();i<length;i++)items.push(this.items[this.convertViewIndexToModel(i)]);return items},getAllItemCount:function(){return this.items.length},getAllItems:function(){return this.items},getFilteredItemCount:function(){return this.viewOrder?this.viewOrder.length:this.items.length},redraw:function(){this.slickGrid.invalidate()},selectAll:function(){this.slickGrid.getSelectionModel().selectAll()},redrawRows:function(rows){this.slickGrid.invalidateRows(rows),this.slickGrid.render()},setItems:function(items){this.items=items,this.slickGrid.getSelectionModel()&&this.slickGrid.setSelectedRows([]),this.setFilter(this.filter),this.maybeAutoResizeColumns()},maybeAutoResizeColumns:function(){this.columnsAutosized||this.autosizeColumns()},convertModelIndexToView:function(modelIndex){if(null!==this.modelToView){var index=this.modelToView.get(modelIndex);return void 0!==index?index:-1}return modelIndex},convertViewIndexToModel:function(viewIndex){return null!=this.viewOrder?viewIndex<this.viewOrder.length&&viewIndex>=0?this.viewOrder[viewIndex]:-1:viewIndex},_updateMappings:function(){var selectedViewIndices=null!=this.slickGrid.getSelectionModel()?this.slickGrid.getSelectedRows():null,selectedModelIndices=[];if(selectedViewIndices)for(var i=0,length=selectedViewIndices.length;i<length;i++)selectedModelIndices.push(this.convertViewIndexToModel(selectedViewIndices[i]));if(this.viewOrder=null,null!=this.filter&&(this.filter.init(),!this.filter.isEmpty())){this.viewOrder=[];for(i=0,length=this.items.length;i<length;i++)this.filter.accept(this.items[i])&&this.viewOrder.push(i)}var cols=this.sortCols;if(cols&&cols.length>0){if(null==this.viewOrder){this.viewOrder=[];for(i=0,length=this.items.length;i<length;i++)this.viewOrder.push(i)}var ncols=cols.length,items=this.items;this.viewOrder.sort(function(index1,index2){for(var i=0;i<ncols;i++){var getter=cols[i].sortCol.sortGetter||cols[i].sortCol.getter,result=(cols[i].sortAsc?tablelegs.ASCENDING_COMPARATOR:tablelegs.DESCENDING_COMPARATOR)(getter(items[index1]),getter(items[index2]));if(0!==result)return result}return 0})}if(null!=this.viewOrder){this.modelToView=new morpheus.Map;for(i=0,length=this.viewOrder.length;i<length;i++)this.modelToView.set(this.viewOrder[i],i)}else this.modelToView=null;if(null!=this.slickGrid.getSelectionModel()){var newSelectedViewIndices=[];for(i=0,length=selectedModelIndices.length;i<length;i++){var index=this.convertModelIndexToView(selectedModelIndices[i]);-1!==index&&newSelectedViewIndices.push(index)}this.slickGrid.setSelectedRows(newSelectedViewIndices)}},setSelectedRows:function(rows){this.slickGrid.setSelectedRows(rows)},setFilter:function(filter){this.filter=filter,this._updateMappings(),this.slickGrid.invalidate(),this.trigger("filter")},getFilter:function(){return this.filter},autosizeColumns:function(){var columns=this.slickGrid.getColumns(),items=this.getItems();if(items&&0!==items.length&&columns&&0!==columns.length){var gridWidth=this.options.$el.width()-30;if(!(gridWidth<=0)){this.columnsAutosized=!0;var div=document.createElement("div");document.body.appendChild(div);var $d=$(div);$d.css({position:"absolute",left:-1e3,top:-1e3});var $row=$('<div class="slick-table"><div class="ui-state-default slick-header-column slick-header-sortable ui-sortable-handle"></div><div class="ui-widget-content slick-row"><div class="slick-cell selected"></div></div></div>'),$cell=$row.find(".slick-cell"),$header=$row.find(".slick-header-column");$row.appendTo($d);for(var maxWidth=Math.min(parseInt(gridWidth/2),400),computeColumnWidth=function(column){var w=0;if(column.resizable)if(w=$header.html(column.name).outerWidth()+12,column.prototypeValue)$cell.html(column.prototypeValue),w=Math.max($cell.outerWidth(),w);else for(var i=0,nrows=Math.min(items.length,10);i<nrows;i++){var html=column.formatter(i,null,column.getter(items[i]),column,items[i]),$html=$(html);$html.find(".slick-cell-wrapper").attr("class",""),$cell.html($html),w=Math.max($cell.outerWidth(),w)}return column.maxWidth&&(w=Math.min(w,column.maxWidth)),column.minWidth&&(w=Math.max(w,column.minWidth)),w},i=0;i<columns.length;i++)columns[i].width=parseInt(Math.min(maxWidth,computeColumnWidth(columns[i]))),columns[i].width;$d.remove(),this.slickGrid.resizeCanvas()}}}},morpheus.Util.extend(tablelegs.Grid,morpheus.Events),tablelegs.AutoTooltips2=function(options){var _grid;function showToolTip(e){var cell=_grid.getCellFromEvent(e);if(cell){var $node=$(_grid.getCellNode(cell.row,cell.cell)),text="",c=_grid.getColumns()[cell.cell],$checkNode=$node.find(".slick-cell-wrapper");if(c.tooltip&&(c.alwaysShowTooltip||$checkNode[0].scrollWidth>$checkNode[0].offsetWidth)){var item=_grid.getDataItem(cell.row);text=c.tooltip(item,c.getter(item)),!0}$node.attr("title",text)}}$.extend(this,{init:function(slickGrid){_grid=slickGrid,$(_grid.getCanvasNode()).on("mouseover",".slick-row",showToolTip)},destroy:function(){$(_grid.getCanvasNode()).off("mouseover",showToolTip)}})},tablelegs.CombinedGridFilter=function(){this.filters=[]},tablelegs.CombinedGridFilter.prototype={add:function(filter){this.filters.push(filter)},getFilters:function(){return this.filters},get:function(index){return this.filters[index]},set:function(index,f){this.filters[index]=f},init:function(){for(var i=0;i<this.filters.length;i++)this.filters[i].init();this.activeFilters=this.filters.filter(function(f){return!f.isEmpty()}),this.nActiveFilters=this.activeFilters.length},accept:function(item){for(var i=0;i<this.nActiveFilters;i++)if(!this.activeFilters[i].accept(item))return!1;return!0},isEmpty:function(){return 0===this.activeFilters.length}},tablelegs.ASCENDING_COMPARATOR=function(a,b){var aNaN=null==a||_.isNumber(a)&&isNaN(a),bNaN=null==b||_.isNumber(b)&&isNaN(b);return aNaN&&bNaN?0:aNaN?1:bNaN?-1:(a.toLowerCase&&(a=a.toLowerCase()),b.toLowerCase&&(b=b.toLowerCase()),a===b?0:a<b?-1:1)},tablelegs.DESCENDING_COMPARATOR=function(a,b){var aNaN=null==a||_.isNumber(a)&&isNaN(a),bNaN=null==b||_.isNumber(b)&&isNaN(b);return aNaN&&bNaN?0:aNaN?1:bNaN?-1:(a.toLowerCase&&(a=a.toLowerCase()),b.toLowerCase&&(b=b.toLowerCase()),a===b?0:a<b?1:-1)},tablelegs.Table=function(options){var _this=this;this.alwaysTrue=function(){return!0},options=tablelegs.Table.createOptions(options),this.options=options;var height=options.height,$gridDiv=$('<div class="slick-table'+(options.tableClass?" "+options.tableClass:"")+'" style="width:'+options.fixedWidth+";height:"+height+'"></div>');this.$gridDiv=$gridDiv;var $header=$('<div class="slick-table-header"><div data-name="top"></div><div style="display: inline-block;" data-name="left" class="pad-top-8"></div><div style="display: inline-block;" data-name="buttons" class="pad-top-8"></div><div data-name="right" class="pull-right pad-top-8"></div></div>');this.$header=$header,$header.appendTo(options.$el),$gridDiv.appendTo(options.$el);var columns=options.columns;this.columns=columns;var visibleColumns=columns.filter(function(c){return c.visible}),grid=new tablelegs.Grid({gridOptions:{select:options.select,rowHeight:options.rowHeight,autoEdit:!1,editable:!1,autoHeight:"auto"===options.height,enableTextSelectionOnCells:!1},$el:$gridDiv,items:options.items,columns:visibleColumns});options.autoTooltips&&grid.slickGrid.registerPlugin(new tablelegs.AutoTooltips2),options.select&&!options.historyCopy&&(this.copy=function(ev){var active=document.activeElement,tagName=active.tagName;if("INPUT"==tagName||"SELECT"==tagName||"TEXTAREA"==tagName)return!1;if($gridDiv[0].contains(active)){var text=_this.itemsToText(_this.getSelectedItems(),!1);ev.originalEvent.clipboardData.setData("text/plain",text),ev.preventDefault(),ev.stopImmediatePropagation()}},this.beforeCopy=function(e){var active=document.activeElement,tagName=active.tagName;if("INPUT"==tagName||"SELECT"==tagName||"TEXTAREA"==tagName)return!1;$gridDiv[0].contains(active)&&e.preventDefault()},$(window).on("copy.tablelegs",this.copy).on("beforecopy.tablelegs",this.beforeCopy)),this.grid=grid,this.searchFunction=this.alwaysTrue;var searchFilter={isEmpty:function(){return _this.searchFunction===_this.alwaysTrue},init:function(){},accept:function(item){return _this.searchFunction(item)}};this.grid.getFilter().add(searchFilter);var $right=$header.find(".pull-right");if(options.export){var $export=$('<button name="export" type="button">Export</button>');$export.appendTo($header.find("[data-name=buttons]")),$export.on("click",function(e){e.preventDefault(),_this.exportTable()})}if(options.search){var tableSearch=new tablelegs.TableSearchUI({autocomplete:options.autocomplete,$el:$header.find("[data-name=top]"),$right:$right});tableSearch.setTable(this),this.tableSearch=tableSearch}if(options.columnPicker){var $btn=$('<div style="position:absolute;top:0;right:0;"><div class="dropdown dropdown-select"><button data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" type="button" class="btn btn-sm"><i class="fa fa-cog"></button><ul class="dropdown-menu column-picker-dropdown dropdown-menu-right"></ul></div></div>');$btn.appendTo(this.$gridDiv),this.$columnSelect=$btn.find(".dropdown-menu");var sortedColumns=this.columns.slice().sort(function(a,b){return(a=a.name.toLowerCase())===(b=b.name.toLowerCase())?0:a<b?-1:1}),li=[];li.push('<li class="dropdown-header">Show/Hide Columns</li>'),sortedColumns.forEach(function(c){!c.hidden&&c.isHideable&&(li.push('<li><a data-value="'+c.id+'" data-checked="'+c.visible+'" href="#">'+c.name),c.visible?li.push(' <span class="fa fa-check check-mark"></span>'):li.push(" <span></span>"),li.push("</a></li>"))}),$(li.join("")).appendTo(this.$columnSelect),this.$columnSelect.on("click","a",function(e){e.preventDefault(),e.stopPropagation();var $a=$(this),checked=$a.data("checked");checked=!checked,$a.data("checked",checked),$a.parent().attr("class",checked?"selected":""),$a.find("span").attr("class",checked?"fa fa-check check-mark":"");for(var $checked=_this.$columnSelect.find("a"),selectedColumnIds=[],i=0;i<$checked.length;i++)$($checked[i]).data("checked")&&selectedColumnIds.push($($checked[i]).data("value"));selectedColumnIds=sortedColumns.filter(function(c){return!c.isHideable}).map(function(c){return c.id}).concat(selectedColumnIds),_this.setVisibleColumnIds(selectedColumnIds)})}var lastWidth=-1,lastHeight=-1,resize=function(){if(_this.options.responsive&&options.$el.is(":visible")){var resizedWidth=!1,resizedHeight=!1;if(options.responsiveHeight){var tableHeight=options.$el[0].getBoundingClientRect().height;lastHeight!==tableHeight&&(lastHeight=tableHeight,$gridDiv.css("height",tableHeight+"px"),resizedHeight=!0)}var gridWidth=options.$el.width();if(gridWidth!==lastWidth&&gridWidth>0){lastWidth=gridWidth;var minWidth=Math.max(gridWidth,options.collapseBreakpoint);$gridDiv.css("width",minWidth+"px"),resizedWidth=!0}(resizedHeight||resizedWidth)&&(_this.grid.slickGrid.resizeCanvas(),_this.grid.slickGrid.invalidate()),resizedWidth&&_this.grid.maybeAutoResizeColumns()}};if(options.showHeader||$gridDiv.find(".slick-header").hide(),(options.responsive||options.responsiveHeight)&&($(window).on("resize orientationchange",resize),resize()),this.resize=resize,$gridDiv.on("remove",function(){$(window).off("resize orientationchange",resize).off("copy.tablelegs",_this.copy).off("beforecopy.tablelegs",_this.beforeCopy)}),options.columns.forEach(function(c){c.renderer&&c.renderer.init&&c.renderer.init({table:_this,column:c})}),visibleColumns.length>1&&null!=options.items&&options.items.length>0&&this.setItems(options.items),!$gridDiv.is(":visible")){for(var $parent=$gridDiv,observer=new MutationObserver(function(mutations){"none"!==window.getComputedStyle($parent[0]).display&&(observer.disconnect(),resize())});$parent.length>0&&"none"!==window.getComputedStyle($parent[0]).display;)$parent=$parent.parent();$parent.length>0&&observer.observe($parent[0],{attributes:!0,childList:!1,characterData:!1})}},tablelegs.Table.defaultRenderer=function(item,value){if(null==value)return"";if(_.isNumber(value))return Math.floor(value)===value?value:morpheus.Util.nf(value);if(morpheus.Util.isArray(value)){for(var s=[],i=0,length=value.length;i<length;i++){i>0&&s.push(", ");value[i];s.push(value[i])}return s.join("")}return""+value},tablelegs.Table.prototype={setVisibleColumnIds:function(ids){for(var oldColumnIdToIndex=new morpheus.Map,oldColumns=this.grid.getColumns(),i=0;i<oldColumns.length;i++)oldColumnIdToIndex.set(oldColumns[i].id,i);var idToColumn=new morpheus.Map;this.columns.forEach(function(c){idToColumn.set(c.id,c)});var visibleColumns=[];for(i=0;i<ids.length;i++){var id=ids[i],c=idToColumn.get(id);null!=c?visibleColumns.push(c):console.log(id+" not found.")}visibleColumns.sort(function(a,b){return void 0===(a=oldColumnIdToIndex.get(a.id))&&(a=Number.MAX_VALUE),void 0===(b=oldColumnIdToIndex.get(b.id))&&(b=Number.MAX_VALUE),a===b?0:a<b?-1:1}),this.columns.forEach(function(c){c.visible=!1}),visibleColumns.forEach(function(c){c.visible=!0}),this.grid.setColumns(visibleColumns),this.resize(),this.redraw()},removeColumns:function(columnIds){var _this=this;columnIds.forEach(function(id){var index=_.findIndex(_this.columns,function(column){return column.id===id});-1!==index&&_this.columns.splice(index,1)}),this.setVisibleColumnIds(this.columns.filter(function(c){return c.visible}).map(function(c){return c.id})),this._rebuildColumnSelector()},_rebuildColumnSelector:function(){if(this.$columnSelect){var $columnSelect=this.$columnSelect;$columnSelect.empty();var sortedColumns=this.columns.slice().sort(function(a,b){return(a=a.name.toLowerCase())===(b=b.name.toLowerCase())?0:a<b?-1:1}),li=[];li.push('<li class="dropdown-header">Show/Hide Columns</li>'),sortedColumns.forEach(function(c){!c.hidden&&c.isHideable&&(li.push('<li><a data-value="'+c.id+'" data-checked="'+c.visible+'" href="#">'+c.name),c.visible?li.push('<span class="fa fa-check check-mark"></span>'):li.push("<span></span>"),li.push("</a></li>"))}),$columnSelect.html($(li.join("")))}},addColumns:function(columns){this.columns=this.columns.concat(columns),this.setVisibleColumnIds(this.columns.filter(function(c){return c.visible}).map(function(c){return c.id})),this._rebuildColumnSelector()},exportTable:function(){var _this=this;if(!this.options.beforeExport||this.options.beforeExport()){var formBuilder=new morpheus.FormBuilder;formBuilder.append({name:"file_name",type:"text",value:this.options.exportFileName}),formBuilder.find("file_name").prop("autofocus",!0).focus(),morpheus.FormBuilder.showOkCancel({title:"Export",draggable:!0,content:formBuilder.$form,align:"right",okCallback:function(){var blob=new Blob([_this.toText()],{type:"text/plain;charset=utf-8"});saveAs(blob,formBuilder.getValue("file_name"),!0),_this.trigger("export",{table:this})}})}},itemsToText:function(items,header){var text=[],columns=this.columns.filter(function(c){return c.visible&&c.export});if(header){for(var j=0;j<columns.length;j++)j>0&&text.push("\t"),text.push(columns[j].name);text.push("\n")}for(var i=0;i<items.length;i++){var item=items[i];for(j=0;j<columns.length;j++){j>0&&text.push("\t");var value=columns[j].getter(item);text.push(morpheus.Util.toString(value))}text.push("\n")}return text.join("")},toText:function(){return this.itemsToText(this.options.getExportItems(this),!0)},getColumnCount:function(){return this.columns.filter(function(c){return c.visible}).length},setCellCssClass:function(rows,columns,cssClass,clear){this.grid.setCellCssClass(rows,columns,cssClass,clear)},setHeight:function(height){this.options.height=height,"auto"===height?(this.grid.slickGrid.getOptions().autoHeight=!0,this.grid.slickGrid.setOptions(this.grid.slickGrid.getOptions()),this.$gridDiv.css({height:"","margin-bottom":"11px"}),this.$gridDiv.find(".slick-viewport").css("height","")):this.$gridDiv.css({height:height,"margin-bottom":""}),this.grid.slickGrid.resizeCanvas(),this.grid.slickGrid.invalidate(),this.grid.slickGrid.render()},autocomplete:function(tokens,response){var _this=this,token=null!=tokens&&tokens.length>0?tokens[tokens.selectionStartIndex]:"";token=$.trim(token);var columns=this.columns.filter(function(c){return c.searchable&&(c.visible||_this.options.searchAllColumns)}),showFieldName=columns.length>1,items=this.getAllItems();columns.forEach(function(c){if(null==c.dataType)for(var i=0,nitems=items.length;i<nitems;i++){var value=c.getter(items[i]);if(null!=value){if(morpheus.Util.isArray(value)&&0===value.length)continue;c.dataType=morpheus.Util.getDataType(value);break}}});var ncolumns=columns.length;if(""===token||token.length<2){var matches=[];if(ncolumns<=1)return response(matches);for(var i=0;i<ncolumns;i++){var quotedField=field=(c=columns[i]).name;-1!==quotedField.indexOf(" ")&&(quotedField='"'+quotedField+'"'),"string"===c.dataType||"[string]"===c.dataType?c.showAll?matches.push({class:"search-qualifier",value:quotedField+":",showAll:quotedField+":*",label:'<span class="search-qualifier-field">'+field+':</span><span data-autocomplete="showAll" class="search-qualifier-show-all">Show all</span>',show:!0}):matches.push({class:"search-qualifier",value:quotedField+":",label:'<span class="search-qualifier-field">'+field+":</span>",show:!0}):matches.push({class:"search-qualifier",value:quotedField+":",label:'<span class="search-qualifier-field">'+field+':</span><span class="search-qualifier-range">min..max</span>',show:!0})}return matches.sort(function(m1,m2){var a=m1.value.replace('"',"").replace(":","").toLowerCase(),b=m2.value.replace('"',"").replace(":","").toLowerCase();return a===b?0:a<b?-1:1}),response(matches)}var field=null,semi=token.indexOf(":"),regex=new RegExp(morpheus.Util.escapeRegex(token),"i"),columnNameToColumn=new morpheus.Map,fieldNameToMatches=new morpheus.Map;for(i=0;i<columns.length;i++)columnNameToColumn.set(columns[i].name.toLowerCase(),columns[i]),fieldNameToMatches.set(columns[i].name,new morpheus.Set);if(semi>0){if(92!==token.charCodeAt(semi-1)){var possibleToken=$.trim(token.substring(semi+1)),possibleField=$.trim(token.substring(0,semi));possibleField.length>0&&'"'===possibleField[0]&&'"'===possibleField[possibleField.length-1]?possibleField=possibleField.substring(1,possibleField.length-1):possibleField.length>0&&'"'===possibleField[0]&&'"'===possibleToken[possibleToken.length-1]&&'"'!==possibleToken[0]&&(possibleField=possibleField.substring(1,possibleField.length),possibleToken='"'+possibleToken),void 0!==(c=columnNameToColumn.get(possibleField.toLowerCase()))&&(token=possibleToken,field=possibleField,!0,columns=[c])}}else if(ncolumns>1)for(var j=0;j<ncolumns;j++){field=columns[j].name;if(regex.test(field))(matchesSet=fieldNameToMatches.get(field)).show=!0}var filteredColumns=[];for(i=0;i<columns.length;i++){var c;"string"!==(c=columns[i]).dataType&&"[string]"!==c.dataType||filteredColumns.push(c)}function formatResponse(){var matches=[],replaceRegex=new RegExp("("+morpheus.Util.escapeRegex(token)+")","i");fieldNameToMatches.forEach(function(matchesSet,field){if(matchesSet.show||matchesSet.size()>0){var column=columnNameToColumn.get(field.toLowerCase()),quotedField=field;-1!==quotedField.indexOf(" ")&&(quotedField='"'+quotedField+'"'),showFieldName&&("string"===column.dataType||"[string]"===column.dataType?(column.showAll,matches.push({class:"search-qualifier",value:quotedField+":",label:'<span class="search-qualifier-field">'+field+":</span>",show:!0})):matches.push({class:"search-qualifier",value:quotedField+":",label:'<span class="search-qualifier-field">'+field+':</span><span class="search-qualifier-range">min..max</span>',show:!0}));var fieldMatches=[];matchesSet.forEach(function(val){var quotedValue=val;null!=quotedValue&&-1!==quotedValue.indexOf(" ")&&(quotedValue='"'+quotedValue+'"'),fieldMatches.push({_v:val,value:showFieldName?quotedField+":"+quotedValue:quotedValue,label:"<span>"+val.replace(replaceRegex,"<b>$1</b>")+"</span>"})}),fieldMatches.sort(function(m1,m2){var a=m1._v.toLowerCase(),b=m2._v.toLowerCase();return a===b?0:a<b?-1:1}),matches=matches.concat(fieldMatches)}}),response(matches)}regex=new RegExp(morpheus.Util.escapeRegex(token),"i");for(var nmatches=0,maxSize=1===(ncolumns=(columns=filteredColumns).length)&&"*"===token?Number.MAX_VALUE:10,nitems=(i=0,items.length);i<nitems;i++){var item=items[i];for(j=0;j<ncolumns;j++){var column=columns[j],matchesSet=(field=column.name,fieldNameToMatches.get(field)),value=column.getter(item);if("[string]"===column.dataType)for(var nvalues=null==value?0:value.length,k=0;k<nvalues;k++){var val=value[k];if(regex.test(val)&&!matchesSet.has(val)&&(matchesSet.add(val),++nmatches===maxSize))return formatResponse()}else if(null!=value&&regex.test(value)&&!matchesSet.has(value)&&(matchesSet.add(value),++nmatches===maxSize))return formatResponse()}}return formatResponse()},searchWithPredicates:function(predicates){var _this=this;if(null==predicates||0===predicates.length)return this.searchFunction=this.alwaysTrue,void this.grid.setFilter(this.grid.getFilter());for(var columns=this.columns.filter(function(c){return c.searchable&&(c.visible||_this.options.searchAllColumns)}),columnNameToColumn=new morpheus.Map,columnNames=columns.map(function(c){return c.name}),i=0;i<columnNames.length;i++)columnNameToColumn.set(columnNames[i].toLowerCase(),columns[i]);var filteredPredicates=[],npredicates=predicates.length;for(i=0;i<npredicates;i++){var predicate=predicates[i],filterColumnName=predicate.getField();if(null!=filterColumnName){var column=columnNameToColumn.get(filterColumnName.toLowerCase());column&&(predicate.column=column,filteredPredicates.push(predicate))}else filteredPredicates.push(predicate)}npredicates=(predicates=filteredPredicates).length;this.searchFunction=function(item){for(var finalResults=[],p=0;p<npredicates;p++){var searchColumns;searchColumns=(predicate=predicates[p]).column?[predicate.column]:columns;for(var results={field:predicate.field,found:"f"},j=0,ncolumns=searchColumns.length;j<ncolumns;j++){var predicate,value=searchColumns[j].getter(item);if(morpheus.Util.isArray(value))for(var nvalues=value.length,i=0;i<nvalues;i++)predicate.accept(value[i])&&(results.found="t");else(predicate=predicates[p]).accept(value)&&(results.found="t");finalResults.push(results)}}for(var columnList=_.uniq(_.pluck(finalResults,"field")),finalResultCheck=new Map,x=0;x<columnList.length;x++)finalResultCheck.set(columnList[x],"f");for(x=0;x<finalResults.length;x++)"t"===(item=finalResults[x]).found&&finalResultCheck.set(item.field,"t");return Array.from(finalResultCheck.values()).indexOf("f")<0},this.grid.setFilter(this.grid.getFilter())},setSortColumns:function(columns){var sort=[],allColumn=this.columns;columns.forEach(function(c){for(var column=null,i=0;i<allColumn.length;i++)if(allColumn[i].name===c.name){column=allColumn[i];break}null!=column&&(column.ascending=c.ascending,sort.push(column))}),this.grid.setSortColumns(sort),this.redraw()},search:function(text){var _this=this;if(""===text)this.searchFunction=this.alwaysTrue,this.grid.setFilter(this.grid.getFilter());else{var tokens=morpheus.Util.getAutocompleteTokens(text),columnNames=this.columns.filter(function(c){return c.searchable&&(c.visible||_this.options.searchAllColumns)}).map(function(c){return c.name}),predicates=morpheus.Util.createSearchPredicates({tokens:tokens,fields:columnNames,caseSensitive:!1});this.searchWithPredicates(predicates)}},getSelectedRows:function(){return this.grid.getSelectedRows()},getSelectedItems:function(){return this.grid.getSelectedItems()},selectAll:function(){this.grid.selectAll()},getSelectedItem:function(){return this.grid.getSelectedItem()},setSelectedRows:function(rows){this.grid.setSelectedRows(rows)},getItems:function(){return this.grid.getItems()},getItem:function(index){return this.grid.getItems()[index]},getAllItems:function(){return this.grid.getAllItems()},getAllItemCount:function(){return this.grid.getAllItemCount()},getFilteredItemCount:function(){return this.grid.getFilteredItemCount()},setFilter:function(f){this.grid.setFilter(f)},refilter:function(){this.grid.setFilter(this.grid.getFilter())},getFilter:function(){return this.grid.getFilter()},setItems:function(items){this.grid.setItems(items),this.grid.redraw()},redraw:function(){this.grid.redraw()},setRowClassProvider:function(rowClassProvider){this.grid.setRowClassProvider(rowClassProvider)},on:function(evtStr,handler){return this.grid.on(evtStr,handler),this},off:function(evtStr,handler){return this.grid.off(evtStr,handler),this},trigger:function(evtStr){this.grid.trigger(evtStr)}},tablelegs.Table.showAllValues=function(table,column,$el){for(var set=new morpheus.Set,dataType=null,items=table.getItems(),i=0,nitems=items.length;i<nitems;i++){if(null!=(value=column.getter(items[i]))){dataType=morpheus.Util.getDataType(value);break}}if(null!=dataType)if("[string]"===dataType||"[number]"===dataType)for(i=0,nitems=items.length;i<nitems;i++){if(null!=(value=column.getter(items[i])))for(var j=0;j<value.length;j++)set.add(value[j])}else for(i=0,nitems=items.length;i<nitems;i++){var value=column.getter(items[i]);set.add(value)}var array=set.values();array.sort(morpheus.SortKey.ASCENDING_COMPARATOR);var $div=$("<div></div>");new tablelegs.Table({$el:$div,items:array,responsive:!1,select:!1,fixedWidth:"550px",showHeader:!1,columns:[{getter:function(item){return item}}]}),morpheus.FormBuilder.showInModal({title:column.name,html:$div})},tablelegs.Table.createOptions=function(options){(options=$.extend(!0,{},{items:[],height:"564px",export:!1,exportFileName:"export.txt",autoTooltips:!0,collapseBreakpoint:330,showHeader:!0,select:!0,responsive:!0,autocomplete:!0,fixedWidth:"320px",columnPicker:!0,getExportItems:function(table){return table.getItems()},searchAllColumns:!0},options)).columns||(options.columns=[{name:""}]);var columns=[];return options.columns.forEach(function(c,i){var column=tablelegs.Table.createColumn(c,i);columns.push(column)}),options.columns=columns,null==options.tableClass&&1===options.columns.length&&(options.tableClass="slick-table-compact"),options.rowHeight||(options.rowHeight=22),options},tablelegs.Table.createColumn=function(c,id){var column=$.extend(!0,{},{id:id,tooltip:function(dataContext,value){return tablelegs.Table.defaultRenderer(dataContext,value)},formatter:function(row,cell,value,columnDef,dataContext){var html=[];return html.push('<div class="slick-table-wrapper"><div class="slick-cell-wrapper">'),html.push(column.renderer(dataContext,value)),html.push("</div></div>"),html.join("")},width:void 0,minWidth:void 0,maxWidth:void 0,export:!0,sortable:!0,searchable:!0,showAll:!1,name:c.name,isHideable:!0,renderer:tablelegs.Table.defaultRenderer},c);return void 0===column.visible&&(column.visible=!0),column.getter||(column.getter=null==column.field?function(item){return item}:function(item){return item[c.field]}),column},tablelegs.TableSearchUI=function(options){var _this=this,$search=$('<input name="searchInput" data-type="search" type="text" class="form-control input-sm search-input" placeholder="Search" autocomplete="off">');$search.appendTo(options.$el),this.$search=$search,this.$searchResults=$('<span data-name="rowcount" class="pad-right-8 pad-top-2 tableview-rowcount" data-type="search"></span>'),this.$showAll=$('<button data-name="showAll" data-type="search" class="pad-left-8 btn btn-primary btn-sm">Show All</button>'),this.$searchResults.appendTo(options.$right),options.showAll&&this.$showAll.appendTo(options.$right),this.$showAll.on("click",function(e){e.preventDefault(),$search.val(""),_this.table.search(""),_this.table.trigger("showAll",{table:_this.table})}),$search.on("keyup",_.debounce(function(){_this.table.search($.trim($(this).val()))},100)),options.autocomplete&&morpheus.Util.autosuggest({$el:$search,minLength:0,suggestWhenEmpty:options.suggestWhenEmpty,filter:function(tokens,response){_this.table.autocomplete(tokens,response)},select:function(){_this.table.search($.trim($search.val()))}})},tablelegs.TableSearchUI.prototype={updateSearchLabel:function(){var text="Viewing: "+morpheus.Util.intFormat(this.table.getFilteredItemCount())+" / "+morpheus.Util.intFormat(this.table.getAllItemCount());this.$searchResults.html(text)},setTable:function(table){this.table=table;var _this=this;table.on("filter",function(){_this.updateSearchLabel()})}},tablelegs.Table.createCheckBoxColumn=function(columnOptions){var table,column,set=new morpheus.Set,renderer=function(item,value){return'<span><input data-tablelegs-toggle="true" type="checkbox" '+(set.has(value)?" checked":"")+"/></span>"};columnOptions.renderer&&(renderer=columnOptions.renderer);var header=[];header.push('<div data-name="select" style="display:inline-block;" class="dropdown">'),header.push('<button class="btn dropdown-toggle row-selector-btn" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'),header.push('<i data-name="checkbox" class="fa fa-square-o checkbox-dropdown" aria-hidden="true"></i>'),header.push('  <span data-name="count"></span> <span class="caret"></span>'),header.push("</button>"),header.push('<ul class="dropdown-menu">'),header.push('<li><a data-name="all" href="#">Select All</a></li>'),header.push('<li><a data-name="none" href="#">Select None</a></li>'),header.push('<li><a data-name="invert" href="#">Invert Selection</a></li>'),header.push("</ul>"),header.push("</div>");var $exportLink,$header=$(header.join("")),$selectedCount=$header.find("[data-name=count]"),$cb=$header.find("[data-name=checkbox]");function updateCheckBox(){if(0===set.size())$cb.attr("class","fa fa-square-o");else{for(var items=table.getItems(),count=0,found=!1,notFound=!1,i=0;i<items.length;i++)if(set.has(column.getter(items[i]))){if(count++,found=!0,notFound)break}else if(notFound=!0,found)break;0===count?$cb.attr("class","fa fa-square-o"):count===items.length?$cb.attr("class","fa fa-check-square-o"):$cb.attr("class","fa fa-minus-square-o")}$exportLink&&(0===set.size()?$exportLink.addClass("disabled"):$exportLink.removeClass("disabled"))}function updateItemCount(){$selectedCount.html("("+morpheus.Util.intFormat(set.size())+")")}function toggleItem(item){var value=column.getter(item);set.has(value)?set.remove(value):set.add(value),table.trigger("checkBoxSelectionChanged",{source:table,set:set,column:column})}$cb.on("click",function(e){if($cb.hasClass("fa-square-o"))for(var items=table.getItems(),i=0;i<items.length;i++)set.add(column.getter(items[i]));else for(items=table.getItems(),i=0;i<items.length;i++)set.remove(column.getter(items[i]));table.trigger("checkBoxSelectionChanged",{source:table,set:set,column:column}),e.preventDefault(),e.stopPropagation()}),$header.on("click","a",function(e){var found=!1;if("none"===$(this).data("name"))set.clear(),found=!0;else if("all"===$(this).data("name")){for(var items=table.getItems(),i=0;i<items.length;i++)set.add(column.getter(items[i]));found=!0}else if("invert"===$(this).data("name")){for(items=table.getItems(),i=0;i<items.length;i++)set.has(column.getter(items[i]))?set.remove(column.getter(items[i])):set.add(column.getter(items[i]));found=!0}found&&(table.trigger("checkBoxSelectionChanged",{source:table,set:set,column:column}),e.preventDefault())}),renderer.init=function(options){(table=options.table,column=options.column,table.options.getExportItems=function(t){return table.getAllItems().filter(function(item){return set.has(column.getter(item))})},column.exportLink)&&($('<li role="separator" class="divider"></li><li data-name="exportLi" class="disabled"><a data-name="export" href="#">Export</a></li>').appendTo($header.find("ul")),$exportLink=$header.find("[data-name=exportLi]"),$header.find("[data-name=export]").on("click",function(e){e.preventDefault(),table.exportTable()}));$header.prependTo(table.$header.find("[data-name=left]")),table.on("filter",updateCheckBox),table.$gridDiv.on("keyup",function(e){if(13===e.which){var item=table.getSelectedItem();null!=item&&toggleItem(item)}}),table.$gridDiv.on("click","input[data-tablelegs-toggle=true]",function(e){var cell=table.grid.slickGrid.getCellFromEvent(e);cell&&toggleItem(table.getItems()[cell.row])}),updateItemCount(),table.on("checkBoxSelectionChanged",function(){updateCheckBox(),updateItemCount(),table.redraw()})};var c=$.extend(!0,{},{set:set,$header:$header,cssClass:"table-legs-align-center check-clmn-cells clmn-nondragabble",headerCssClass:"text-center check-clmn-header clmn-nondragabble",getSelection:function(){return set},getter:function(item){return item[this.field]},name:'<i style="font-size:13px;" class="fa fa-check" aria-hidden="true"></i>',renderer:renderer,width:32,maxWidth:32,minWidth:32,resizable:!1,searchable:!1,hidden:!1,isHideable:!1,visible:!0,export:!1,exportLink:!0,headerCssClass:"check-clmn-header"},columnOptions);return c.sortGetter||(c.sortGetter=function(item){return!set.has(c.getter(item))}),c},function(factory){if("function"==typeof define&&define.amd)define(factory);else if("object"==typeof exports)module.exports=factory();else{var OldCookies=window.Cookies,api=window.Cookies=factory();api.noConflict=function(){return window.Cookies=OldCookies,api}}}(function(){function extend(){for(var i=0,result={};i<arguments.length;i++){var attributes=arguments[i];for(var key in attributes)result[key]=attributes[key]}return result}return function init(converter){function api(key,value,attributes){var result;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(attributes=extend({path:"/"},api.defaults,attributes)).expires){var expires=new Date;expires.setMilliseconds(expires.getMilliseconds()+864e5*attributes.expires),attributes.expires=expires}try{result=JSON.stringify(value),/^[\{\[]/.test(result)&&(value=result)}catch(e){}return value=converter.write?converter.write(value,key):encodeURIComponent(String(value)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),key=(key=(key=encodeURIComponent(String(key))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[key,"=",value,attributes.expires&&"; expires="+attributes.expires.toUTCString(),attributes.path&&"; path="+attributes.path,attributes.domain&&"; domain="+attributes.domain,attributes.secure?"; secure":""].join("")}key||(result={});for(var cookies=document.cookie?document.cookie.split("; "):[],rdecode=/(%[0-9A-Z]{2})+/g,i=0;i<cookies.length;i++){var parts=cookies[i].split("="),name=parts[0].replace(rdecode,decodeURIComponent),cookie=parts.slice(1).join("=");'"'===cookie.charAt(0)&&(cookie=cookie.slice(1,-1));try{if(cookie=converter.read?converter.read(cookie,name):converter(cookie,name)||cookie.replace(rdecode,decodeURIComponent),this.json)try{cookie=JSON.parse(cookie)}catch(e){}if(key===name){result=cookie;break}key||(result[name]=cookie)}catch(e){}}return result}}return api.set=api,api.get=function(key){return api(key)},api.getJSON=function(){return api.apply({json:!0},[].slice.call(arguments))},api.defaults={},api.remove=function(key,attributes){api(key,"",extend(attributes,{expires:-1}))},api.withConverter=init,api}(function(){})}),"undefined"==typeof clue&&(clue={}),"undefined"!=typeof module&&module.exports&&(module.exports=clue),clue.USER_KEY=null,clue.usingTempKey=!1,clue.CORE_CELL_LINES=["A375","A549","HA1E","HCC515","HEPG2","HT29","MCF7","PC3","VCAP"],clue.PROTEOMICS_CELL_LINES=["A375","A549","MCF7","NPC","PC3","YAPC"],clue.CORE_CELL_LINES_LINEAGE={A375:"SKIN",A549:"LUNG",HA1E:"KIDNEY",HCC515:"LUNG",HEPG2:"LIVER",HT29:"LARGE_INTESTINE",MCF7:"BREAST",NPC:"CNS",PC3:"PROSTATE",VCAP:"PROSTATE",YAPC:"PANCREAS"},clue.CORE_CELL_LINES_CCLE=["A375_SKIN","A549_LUNG","HA1E_KIDNEY","HCC515_LUNG","HEPG2_LIVER","HT29_LARGE_INTESTINE","MCF7_BREAST","PC3_PROSTATE","VCAP_PROSTATE"],$.ajaxPrefilter(function(options,originalOptions,jqXHR){null!=clue.USER_KEY&&0===options.url.indexOf(clue.API_URL)&&jqXHR.setRequestHeader("user_key",clue.USER_KEY)}),clue.analytics=function(){var i,s,o,r,a,m;"clue.io"===window.location.hostname&&("undefined"==typeof ga&&(i=window,s=document,o="script",r="ga",i.GoogleAnalyticsObject=r,i.ga=i.ga||function(){(i.ga.q=i.ga.q||[]).push(arguments)},i.ga.l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src="//www.google-analytics.com/analytics.js",m.parentNode.insertBefore(a,m)),ga("create","UA-62656334-1","auto","clue"),null!=clue.getUserName()&&ga("clue.set","clue_user",clue.getUserName()),ga("clue.send","pageview"))},clue.cachedFetch=function(url,options,callback){try{var expiry=300;"number"==typeof options?(expiry=options,options=void 0):"object"==typeof options&&(expiry=options.seconds||expiry);var cacheKey=clue.hashstr(url+clue.USER_KEY);options.ignoreApiKey&&(cacheKey=clue.hashstr(url));var cached=localStorage.getItem(cacheKey),whenCached=localStorage.getItem(cacheKey+":ts");if(null!==cached&&null!==whenCached){if((Date.now()-whenCached)/1e3<expiry)return callback(null,JSON.parse(cached));localStorage.removeItem(cacheKey),localStorage.removeItem(cacheKey+":ts")}}catch(ex){console.log(ex)}var myInit={method:"GET",headers:new Headers({user_key:clue.USER_KEY})};options.ajax?$.ajax({url:url,type:"GET",cache:!0}).done(function(result){return localStorage.setItem(cacheKey,JSON.stringify(result)),localStorage.setItem(cacheKey+":ts",Date.now()),callback(null,result)}).fail(function(err){return callback(err)}):fetch(url,myInit).then(function(response){return response.json().then(function(data){return response.ok?data:Promise.reject({status:response.status,data:data})})}).then(function(result){return localStorage.setItem(cacheKey,JSON.stringify(result)),localStorage.setItem(cacheKey+":ts",Date.now()),callback(null,result)}).catch(function(error){return console.log("error:",error),callback(error,null)})},clue.cachedFetchSession=function(url,options,callback){try{var expiry=300;"number"==typeof options?(expiry=options,options=void 0):"object"==typeof options&&(expiry=options.seconds||expiry);var cacheKey=clue.hashstr(url+clue.USER_KEY);options.ignoreApiKey&&(cacheKey=clue.hashstr(url));var cached=sessionStorage.getItem(cacheKey),whenCached=sessionStorage.getItem(cacheKey+":ts");if(null!==cached&&null!==whenCached){if((Date.now()-whenCached)/1e3<expiry)return callback(null,JSON.parse(cached));sessionStorage.removeItem(cacheKey),sessionStorage.removeItem(cacheKey+":ts")}}catch(ex){console.log(ex)}var myInit={method:"GET",headers:new Headers({user_key:clue.USER_KEY})};options.ajax?$.ajax({url:url,type:"GET",cache:!0}).done(function(result){return sessionStorage.setItem(cacheKey,JSON.stringify(result)),sessionStorage.setItem(cacheKey+":ts",Date.now()),callback(null,result)}).fail(function(err){return callback(err)}):fetch(url,myInit).then(function(response){return response.json().then(function(data){return response.ok?data:Promise.reject({status:response.status,data:data})})}).then(function(result){return sessionStorage.setItem(cacheKey,JSON.stringify(result)),sessionStorage.setItem(cacheKey+":ts",Date.now()),callback(null,result)}).catch(function(error){return console.log("error:",error),callback(error,null)})},clue.hashstr=function(s){var hash=0;if(0===s.length)return hash;for(var i=0;i<s.length;i++){hash=(hash<<5)-hash+s.charCodeAt(i),hash&=hash}return hash},clue.getVersionFromUrl=function(url){var result=null;url&&url.substr(1).split("&").forEach(function(part){var item=part.split("=");"version"===item[0]&&(result=decodeURIComponent(item[1]))});return result},clue.parseApacheListing=function(url){var d=$.Deferred();return $.ajax({url:url}).done(function(html){for(var a=$(html).find("td > a"),files=[],i=1;i<a.length;i++){var text=$(a[i]).text();files.push(text)}files.sort(),d.resolve(files.map(function(file){return url+file}))}).fail(function(err){d.reject(err)}),d},clue.getUserName=function(){return Cookies.get("user_id")},clue.showLoginModal=function(){$loginModal.modal("show")},clue.hideAccountDropDown=function(){$("#header-drop-down").hide()},clue.getUserInfo=function(){var userInfo;return Cookies.get("user_info")&&(userInfo=JSON.parse(Cookies.get("user_info"))),userInfo};var config=Cookies.get("clue_config")||{};if(_.isEmpty(config))console.log("Empty clue config object");else{var co=JSON.parse(config);Object.freeze(co),clue.ENV=JSON.parse(config).env,clue.API_URL=JSON.parse(config).url,clue.whitelist_key=JSON.parse(config).whitelist_key}clue.isDomainOnWhitelist=function(email){return $.ajax({url:clue.API_URL+"/api/whitelists/"+clue.whitelist_key+"/domain/"+email+"/exists",type:"GET"})},clue.isDomainOnBlacklist=function(email){return $.ajax({url:clue.API_URL+"/api/blacklists/"+clue.whitelist_key+"/domain/"+email+"/exists",type:"GET"})},clue.isCMapCore=function(callback){var url=clue.API_URL+"/api/clue-privileges/isCore";clue.cachedFetch(url,{seconds:1800,ajax:!0},callback)},clue.isAdmin=function(callback){var url=clue.API_URL+"/api/clue-privileges/isAdmin";clue.cachedFetch(url,{seconds:1800,ajax:!0},callback)},clue.getSettings=function(callback){try{var cacheKey=clue.hashstr("/settings"+clue.USER_KEY);localStorage.removeItem(cacheKey),localStorage.removeItem(cacheKey+":ts")}catch(ee){}clue.cachedFetchSession("/settings",{seconds:1800,ajax:!0},callback)},clue.getAllEvents=function(callback){return $.ajax({url:"/allEvents",type:"GET",cache:!0})},clue.getRoles=function(callback){clue.cachedFetch(clue.API_URL+"/api/roles",{seconds:86400},callback)},clue.getServerInfo=function(callback){clue.cachedFetch("/server_info",{ignoreApiKey:!0,seconds:604800},callback)},clue.getApiRepurposingDefinitions=function(callback){var url=clue.API_URL+"/public/repurposing-definition";return $.ajax({url:url,type:"GET",cache:!0})},clue.getApiPublicDefinitions=function(callback){var url=clue.API_URL+"/public/definitions";return $.ajax({url:url,type:"GET",cache:!0})},clue.getConnectopediaGlossary=function(callback){var url=clue.API_URL+"/api/glossary/distinct?field=index";clue.cachedFetch(url,{ignoreApiKey:!0,seconds:86400},callback)},clue.getConnectopediaTags=function(callback){var url="https://s3.amazonaws.com/data.clue.io/connectopedia/"+clue.ENV+"/tags.json";clue.cachedFetch(url,{ignoreApiKey:!0,seconds:86400},callback)},clue.getTranscriptionalImpactForAllTouchstonePerts=function(callback){var url=clue.API_URL+'/api/perts?filter={"include":{"pcls":true},"where": {"pert_icollection" : "TS"},"fields" : ["tas","pert_type","pert_id","pert_iname"],"order":"tas DESC"}';return $.ajax({url:url,type:"GET",cache:!0})},clue.getGitInfo=function(callback){clue.cachedFetch("/build-info",{ignoreApiKey:!0,seconds:604800},callback)},clue.getApps=function(callback){clue.cachedFetch(clue.API_URL+"/api/app_list/getApps?server_env="+clue.ENV,{seconds:600},callback)},clue.nominate=function(callback){var url=clue.API_URL+"/api/nominate";return $.ajax({url:url,type:"GET",cache:!0})},clue.getAcademicTraining=function(callback){var url=clue.API_URL+"/api/academic_training";return $.ajax({url:url,type:"GET",cache:!0})},clue.getResearchRoles=function(callback){var url=clue.API_URL+"/api/research_roles";return $.ajax({url:url,type:"GET",cache:!0})},clue.autoCompleteInstituteUrl=function(callback){return clue.API_URL+"/api/institutions/autocomplete"},clue.touchStoneVersion=function(callback){clue.cachedFetch(clue.API_URL+"/api/touchstone-version",{ignoreApiKey:!0,seconds:86400},callback)},clue.nominatePerts=function(type,name){return $.ajax({url:clue.API_URL+"/api/nominate_entity?type="+type+"&name="+name,type:"GET"})},clue.autocomplete=function(options){morpheus.Util.autocomplete(options.$el,function(q,cb){for(var matches=[],regex=new RegExp("^"+q,"i"),max=options.max||3,values={},count=0,fieldNames=options.fieldNames,nfields=fieldNames.length,i=0,nitems=options.nitems;i<nitems&&count<max;i++){options.next();for(var j=0;j<nfields;j++){var str=options.getValue(fieldNames[j]);if(!values[str]&&regex.test(str)&&(values[str]=!0,++count===max))break}}for(var val in values)matches.push({value:val});cb(matches)},null,!1)},clue.search=function(text,options){if(""===(text=$.trim(text)))return null;var tokens=morpheus.Util.getAutocompleteTokens(text);if(0==tokens.length)return null;for(var fieldNames=options.fieldNames,predicates=morpheus.Util.createSearchPredicates({tokens:tokens,fields:fieldNames}),indices=[],npredicates=predicates.length,nfields=model.getMetadataCount(),i=0,nitems=options.nitems;i<nitems;i++){var matches=!1;options.next();for(var p=0;p<npredicates&&!matches;p++){var predicate=predicates[p],filterColumnName=predicate.getField();if(null!=filterColumnName){if(null!=(value=options.getValue(filterColumnName))&&predicate.accept(value)){matches=!0;break}}else for(var j=0;j<nfields;j++){var value;if(null!=(value=options.getValue(fieldNames[j]))&&predicate.accept(value)){matches=!0;break}}}matches&&indices.push(i)}return indices},clue.getCell=function(cell_id){return $.ajax({url:clue.API_URL+'/api/cells?filter={"where":{"cell_id":"'+encodeURIComponent(cell_id)+'"}}',type:"GET"})},clue.getPertInfo=function(pert_id){return $.ajax({url:clue.API_URL+'/api/perts?filter={"include":{"pcls":true},"where":{"pert_id":"'+encodeURIComponent(pert_id)+'"}}',type:"GET"})},clue.getGeneBySymbol=function(gene_symbol){return $.ajax({url:clue.API_URL+'/api/genes/findOne?filter={"where":{"gene_symbol":"'+encodeURIComponent(gene_symbol)+'"}}',type:"GET"})},clue.getPert=function(pert_iname){return $.ajax({url:clue.API_URL+"/api/pert-card/"+pert_iname,type:"GET"})},clue.getMissingCities=function(){return $.ajax({url:clue.API_URL+'/api/institutions?filter={"fields": ["id","institute", "country"], "where": {"city": "-666"}}',type:"GET"})},clue.userExists=function(email){return $.ajax({url:clue.API_URL+'/api/admin/users/exists?filter={"where":{"email":"'+encodeURIComponent(email)+'"}}',type:"GET"})},clue.guessInstitutionFromEmail=function(email){return $.ajax({url:clue.API_URL+"/api/institutions/domain/"+encodeURIComponent(email),type:"GET"})},clue.getTouchStone=function(){return $.ajax({url:clue.API_URL+"/touchstone",type:"GET"})},clue.getDosePoints=function(pert_iname){return $.ajax({url:clue.API_URL+"/api/sigs/doseByCoreCellLines/"+pert_iname,type:"GET"})},clue.searchPerts=function(search){return $.ajax({url:clue.API_URL+"/api/search/perts/"+search,type:"GET"})},clue.getHistory=function(){return $.ajax({url:clue.API_URL+'/api/jobs?filter={"where":{"user_id":"'+clue.getUserName()+'","status":{"inq":["pending","processing","submitted","completed"]}},"limit":10,"order":"created DESC"}',type:"GET"})},clue.autoCompleteInstitute=function(inst){return $.ajax({url:clue.autoCompleteInstituteUrl()+"?q="+inst,type:"GET"})},clue.loadScriptsWhenReady=function(scripts){$(document).one("clueReady",function(){for(var i=0;i<scripts.length;i++){var script=document.createElement("script");script.setAttribute("type","text/javascript"),script.setAttribute("src",scripts[i]),document.head.appendChild(script)}})},clue.setup=function(callback){clue.getUserKey(function(){callback&&callback();var result=clue.getApps();clue.nav(result.cards)},function(){clue.footer()})},clue.getTempApiKey=function(){return clue.usingTempKey=!0,$.ajax({url:clue.API_URL+"/temp_api_key",type:"GET"})},clue.getUserKey=function(callback,errorCallback){null!=clue.USER_KEY?callback(clue.USER_KEY):(clue.usingTempKey=!1,$.ajax({url:"/api_config",cache:!0,success:function(config){null!=config.api_key&&(clue.USER_KEY=config.api_key),callback(clue.USER_KEY),$(document).trigger("clueReady")},error:function(){errorCallback&&errorCallback()}}))},clue.fixUrl=function(url){return 0!==url.indexOf("data.clue.io")&&0!==url.indexOf("macchiato.clue.io")||(url="https://s3.amazonaws.com/"+url),url},clue.BASE_GUTC_DIGESTS_URL="//s3.amazonaws.com/macchiato.clue.io/builds/touchstone/v1.1/arfs/",clue.gutcTopResults=function(options){var deferred=$.Deferred(),d=morpheus.DatasetUtil.read(clue.BASE_GUTC_DIGESTS_URL+options.id+"/pert_id_summary.gct");return d.then(function(dataset){for(var array=[],i=0,nrows=dataset.getRowCount();i<nrows;i++)array.push({index:i,value:dataset.getValue(i,0)});array.sort(function(a,b){return a.value<b.value?1:a.value===b.value?0:-1});for(var idVector=dataset.getRowMetadata().get(0),results=[],n=(i=0,Math.min(array.length,options.top));i<n;i++){var index=array[i];results.push({id:idVector.getValue(index.index),score:dataset.getValue(index.index,0),rank:i+1})}i=0;var j=array.length-1;for(n=Math.min(options.bottom,array.length);i<n;i++,j--){index=array[j];results.push({id:idVector.getValue(index.index),score:dataset.getValue(index.index,0),rank:8796-i})}var filter={where:{pert_id:{inq:results.map(function(r){return r.id})}},fields:{description:!0,pert_id:!0,pert_iname:!0,pert_type:!0}};$.ajax(clue.API_URL+"/api/perts?filter="+JSON.stringify(filter)).fail(function(err){deferred.reject(err)}).done(function(items){for(var idToItem={},i=0,nitems=results.length;i<nitems;i++)idToItem[results[i].id]=results[i];for(i=0,nitems=items.length;i<nitems;i++){var item=items[i],result=idToItem[item.pert_id];void 0!==result&&(result.description=item.description,result.pert_iname=item.pert_iname,result.pert_type=item.pert_type)}deferred.resolve(results)})}),d.catch(function(err){deferred.reject(err)}),deferred},clue.getGutcResult=function(gutcOptions){var gutcUrl=gutcOptions.url;"/"!==gutcUrl[gutcUrl.length-1]&&(gutcUrl+="/");var d=$.Deferred();function unsignedResults(){var options={};gutcOptions.gutcSummary&&(options.pert_id_summary=gutcUrl+"pert_id_summary.gct"),gutcOptions.gutcCell&&(options.pert_id_cell=gutcUrl+"pert_id_cell.gct"),gutcOptions.pclCell&&(options.pcl_cell=gutcUrl+"pcl_cell.gct"),gutcOptions.pclSummary&&(options.pcl_summary=gutcUrl+"pcl_summary.gct"),gutcOptions.overrideColumns&&(options.overrideColumns=gutcOptions.overrideColumns),gutcUrl.lastIndexOf("UPTAG/")===gutcUrl.length-6&&(options.config=gutcUrl.substring(0,gutcUrl.length-6)+"config.yaml");var gutcPromise=clue.getGutcResultByUrl(options);gutcPromise.done(function(result){d.resolve(result)}),gutcPromise.fail(function(result){d.reject(result)})}if(0===gutcUrl.indexOf("https://s3.amazonaws.com/data.clue.io/api/")){var remainder=gutcUrl.substring("https://s3.amazonaws.com/data.clue.io/api/".length),resultsIndex=remainder.indexOf("/results");if(-1!==resultsIndex){var email=remainder.substring(0,resultsIndex);gutcUrl="https://s3.amazonaws.com/data.clue.io/api/"+encodeURIComponent(email)+remainder.substring(resultsIndex)}unsignedResults()}else{var signedPromise=clue.getSignedFolder(gutcUrl);signedPromise.done(function(nameToUrl){var options={};gutcOptions.gutcSummary&&(options.pert_id_summary=nameToUrl["pert_id_summary.gct"],null==options.pert_id_summary&&(options.pert_id_summary=nameToUrl["ps_pert_summary.gct"])),gutcOptions.gutcCell&&(options.pert_id_cell=nameToUrl["pert_id_cell.gct"]),gutcOptions.pclCell&&(options.pcl_cell=nameToUrl["pcl_cell.gct"]),nameToUrl["query_info.txt"]&&(options.columnInfo=nameToUrl["query_info.txt"]),nameToUrl["sig.gct"]&&(options.sig_gct=nameToUrl["sig.gct"]),gutcOptions.pclSummary&&(options.pcl_summary=nameToUrl["pcl_summary.gct"],null==options.pcl_summary&&(options.pcl_summary=nameToUrl["ps_pcl_summary.gct"])),options.config=nameToUrl["config.yaml"],null==options.config&&gutcUrl.lastIndexOf("UPTAG/")===gutcUrl.length-6&&(options.config=gutcUrl.substring(0,gutcUrl.length-6)+"config.yaml"),null!=options.config&&options.config.indexOf("/arfs/")>-1&&(options.config=options.config.replace("/arfs/","/")),options.columnInfo||(options.columnInfo=nameToUrl["column_meta.txt"]),options.rowInfo=gutcOptions.rowMeta?nameToUrl["row_meta.txt"]:null;var gutcPromise=clue.getGutcResultByUrl(options);gutcPromise.done(function(result){d.resolve(result)}),gutcPromise.fail(function(result){d.reject(result)})}),signedPromise.fail(function(nameToUrl){unsignedResults()})}return d},clue.getSigQueryResults=function(options){var datasetName,sigInfoPromise,filter,p,deferred=$.Deferred(),promises=[],datasets=[],sigInfoLines=null,promise=(datasetName=options.datasetName,sigInfoPromise=$.Deferred(),filter={where:{name:datasetName}},(p=$.ajax(clue.API_URL+"/api/data?filter="+JSON.stringify(filter))).done(function(dataModel){if(dataModel&&dataModel.length>0&&dataModel[0].s3_root){var url="https://s3.amazonaws.com/macchiato.clue.io"+dataModel[0].s3_root+"gutc_background/annot/siginfo.txt",signedUrl=clue.getSignedUrlCache(url);signedUrl.done(function(url){var p=morpheus.Util.readLines(url);p.then(function(result){sigInfoPromise.resolve(result)}),p.catch(function(e){console.log("Could not load siginfo file."),sigInfoPromise.reject()})}),signedUrl.fail(function(){console.log("Could not get signed url."),sigInfoPromise.reject()})}else console.log("Could not find a matching dataset "+datasetName+" with s3_root in API."),sigInfoPromise.reject()}),p.fail(function(){console.log("Failure when querying data endpoint in API."),sigInfoPromise.reject()}),sigInfoPromise);return promises.push(promise),promise.done(function(result){sigInfoLines=result}),options.urls.forEach(function(url,idx){url=clue.fixUrl(url);var promise=morpheus.DatasetUtil.read(url+"/sig.gct");promises.push(promise),promise.then(function(dataset){options.overrideColumns&&Object.keys(options.overrideColumns).forEach(function(key){var colMeta=dataset.getColumnMetadata().getByName(key);colMeta||(colMeta=dataset.getColumnMetadata().add(key));var val=options.overrideColumns[key][idx];val.length;for(var i=0;i<colMeta.size();i++)colMeta.setValue(i,val)});datasets.push(dataset)})}),$.when.apply($,promises).then(function(){var dataset;if(1===datasets.length)dataset=datasets[0];else{for(var i=0;i<datasets.length;i++)datasets[i]=new morpheus.TransposedDatasetView(datasets[i]);dataset=new morpheus.JoinedDataset(datasets[0],datasets[1],"id","id","query");for(i=2;i<datasets.length;i++)dataset=new morpheus.JoinedDataset(dataset,datasets[i],"id","id","query");dataset=new morpheus.TransposedDatasetView(dataset)}if(dataset.setName(options.name),sigInfoLines){const opts={};opts.dataset=dataset,opts.fileColumnNamesToInclude=null,opts.lines=sigInfoLines,opts.isColumns=!1,opts.sets=null,opts.metadataName="id",opts.fileColumnName=sigInfoLines[0].split(/\t/)[0],(new morpheus.OpenFileTool).annotate(opts)}dataset.getColumnMetadata().getByName("id").setName("_id"),deferred.resolve(dataset)},function(){deferred.reject("Unable to read results.")}),(promise=deferred.promise()).toString=function(){return"results"},promise},clue.getGutcResults=function(options){var deferred=$.Deferred(),promises=[],datasets=[];(options=$.extend({},{pclCell:!0,gutcCell:!0,pclSummary:!0,gutcSummary:!0},options)).urls.forEach(function(url,idx){var overrideColumns=null;options.overrideColumns&&(overrideColumns={},Object.keys(options.overrideColumns).forEach(function(key){overrideColumns[key]=options.overrideColumns[key][idx]}));url=clue.fixUrl(url);var promise=clue.getGutcResult({url:url,rowMeta:1===options.urls.length,pclCell:options.pclCell,gutcCell:options.gutcCell,pclSummary:options.pclSummary,gutcSummary:options.gutcSummary,overrideColumns:overrideColumns});promises.push(promise),promise.done(function(dataset){datasets.push(dataset)})});var indexLines=null;if(options.index){options.index=clue.fixUrl(options.index);var indexPromise=$.Deferred(),indexSignedUrl=clue.getSignedUrlCache(options.index);indexSignedUrl.done(function(url){morpheus.Util.readLines(url).then(function(result){indexLines=result,indexPromise.resolve()}).catch(function(){indexPromise.resolve()})}),indexSignedUrl.fail(function(){indexPromise.resolve()}),promises.push(indexPromise)}$.when.apply($,promises).then(function(){for(var dataset,i=0;i<datasets.length;i++){var pclSeriesData=[];datasets[i]=morpheus.DatasetUtil.copy(datasets[i]);for(var j=0,ncols=datasets[i].getRowCount();j<ncols;j++)pclSeriesData.push({});datasets[i].addSeries({name:"PCL",dataType:"number",array:pclSeriesData})}if(1===datasets.length)dataset=datasets[0];else{for(i=0;i<datasets.length;i++)datasets[i]=new morpheus.TransposedDatasetView(datasets[i]);dataset=new morpheus.JoinedDataset(datasets[0],datasets[1],"id","id","query");for(i=2;i<datasets.length;i++)dataset=new morpheus.JoinedDataset(dataset,datasets[i],"id","id","query");dataset=new morpheus.TransposedDatasetView(dataset)}if(dataset.setName(options.name),indexLines){const opts={};opts.dataset=dataset,opts.fileColumnNamesToInclude=null,opts.lines=indexLines,opts.isColumns=!0,opts.sets=null,opts.metadataName="_id",opts.fileColumnName=indexLines[0].split(/\t/)[0],(new morpheus.OpenFileTool).annotate(opts)}deferred.resolve(dataset)},function(){deferred.reject("Unable to read results.")});var promise=deferred.promise();return promise.toString=function(){return"results"},promise},clue.createGutcColorScheme=function(){return{name:"(-100, -95, -90, 90, 95, 100)",scalingMode:"fixed",map:[{value:-100,color:"#0000ff"},{value:-95,color:"#abdda4"},{value:-90,color:"#ffffff"},{value:90,color:"#ffffff"},{value:95,color:"#fdae61"},{value:100,color:"#ff0000"}]}},clue.createLoadingEl=function(text,punctuation){return text||(text="Loading"),punctuation||(punctuation="&#8230;"),$('<div id="loading-spinner" class="loading-box"><div class="loading"><img src="//assets.clue.io/clue/public/img/clueLoadingAnimation.gif"><p class="load-message">&nbsp;'+text+punctuation+"</p></div></div>")},clue.getSignedFolder=function(folder){var d=$.Deferred(),p=$.ajax({context:folder,url:clue.API_URL+"/api/s3_resources/signFolder?s3_folder="+folder});return p.done(function(urls){var fileNameToUrl={};urls.forEach(function(url){var questionMarkIndex=url.indexOf("?");if(-1!==questionMarkIndex){var name=url.substring(0,questionMarkIndex),slashIndex=name.lastIndexOf("/");name=name.substring(slashIndex+1),fileNameToUrl[name]=url}else d.reject("No file name found for "+url)}),d.resolve(fileNameToUrl)}),p.fail(function(){d.reject()}),d},clue.postICVSession=function(options,cb){var heatMap=options.heatMap,json=(options={dataset:!0},heatMap.toJSON(options)),nativeArrayToArray=Array.from||function(typedArray){var normalArray=Array.prototype.slice.call(typedArray);normalArray.length,typedArray.length,normalArray.constructor,Array},inputValues={session:[JSON.stringify(json,function(key,value){return morpheus.Util.isArray(value)?value instanceof Array?value:nativeArrayToArray(value):value})],dataset:"foo",user:"bar"};$.ajax({url:"/icv_session",method:"POST",data:inputValues}).done(function(data){cb(null,data)}).fail(function(err){cb(err)})},clue.getSignedUrlCache=function(url,options){var deferred=$.Deferred(),cacheKey=clue.hashstr(url+clue.USER_KEY);try{var expiry=600;"number"==typeof options?(expiry=options,options=void 0):"object"==typeof options&&(expiry=options.seconds||expiry);var cached=sessionStorage.getItem(cacheKey),whenCached=sessionStorage.getItem(cacheKey+":ts");if(null!==cached&&null!==whenCached){if((Date.now()-whenCached)/1e3<expiry){var sanitizedURL=cached.replace(/"/g,"");return deferred.resolve(sanitizedURL),deferred}sessionStorage.removeItem(cacheKey),sessionStorage.removeItem(cacheKey+":ts")}}catch(ex){console.log(ex)}var myInit={method:"GET",headers:new Headers({user_key:clue.USER_KEY})},r=clue.API_URL+"/api/s3_resources/signFile?s3_file="+url;return fetch(r,myInit).then(function(response){return response.text().then(function(data){if(response.ok)return data;deferred.reject()})}).then(function(signedURL){var sanitizedURL=signedURL.replace(/"/g,"");sessionStorage.setItem(cacheKey,sanitizedURL),sessionStorage.setItem(cacheKey+":ts",Date.now()),deferred.resolve(sanitizedURL)}).catch(function(error){console.log("error:",error),deferred.reject()}),deferred},clue.getSignedUrl=function(url){var r=clue.API_URL+"/api/s3_resources/signFile?s3_file="+url;return $.ajax(r)},clue.txtZipFileFromS3=function(s3_url,callback){var idToItem=new morpheus.Map,baseUrlToIndexLines=new morpheus.Map,promises=[],d=$.Deferred();promises.push(d),clue.getSignedUrlCache(s3_url).done(function(url){morpheus.Util.readLines(url).then(function(lines){baseUrlToIndexLines.set(s3_url,lines),d.resolve()}).catch(function(){d.reject()})}).fail(function(){d.reject()}),$.when.apply($,promises).fail(function(){return callback("An unexpected error occurred. Please try again.")}).done(function(){var lines=baseUrlToIndexLines.get(s3_url);if(null!=lines)for(var tab=/\t/,header=lines[0].split(tab),idField=header[0],i=1,nlines=lines.length;i<nlines;i++){for(var tokens=lines[i].split(tab),item={},j=0;j<header.length;j++){var field=header[j],value=tokens[j];"-666"===value&&(value=""),item[field]=value}var existingItem=idToItem.get(item[idField]);null==existingItem?(existingItem=item,idToItem.set(item[idField],existingItem)):_.extend(existingItem,item);var itemUrl=item.url||item.id;itemUrl&&(null==existingItem.baseUrlToUrls&&(existingItem.baseUrlToUrls=new morpheus.Map),existingItem.baseUrlToUrls.set(s3_url,itemUrl))}var items=idToItem.values();return callback(null,items)}).fail(function(err){return callback(err)})},clue.getJobConfig=function(url){var nameDeferred=$.Deferred(),p=$.ajax({url:url,dataType:"text"}),config={};return p.done(function(text){for(var lines=text.split("\n"),i=0;i<lines.length;i++){var line=lines[i].trim(),index=line.indexOf(":");if(-1!==index){var key=line.substring(0,index).trim(),value=line.substring(index+1).trim();config[key]=value}}nameDeferred.resolve(config)}),p.fail(function(){nameDeferred.resolve(config)}),nameDeferred},clue.getQueryResults=function(options){var datasetPromises=[],connectivityDatasets=[],introspectDatasets=[],inputDatasets=[];options.urls.forEach(function(url){var p;url=clue.fixUrl(url),(p="sig_prot_query_tool"===options.tool?clue.getQueryResultByUrl({baseUrl:url,gct:"CONCATED_CONN.gct"}):clue.getQueryResultByUrl({baseUrl:url,gct:"result_WTCS.CUSTOM.COMBINED_n1x4160.gct"})).done(function(result){connectivityDatasets.push(result.conn),null!=result.introspect&&introspectDatasets.push(result.introspect),null!=result.input&&inputDatasets.push(result.input)}),datasetPromises.push(p)});var d=$.Deferred();return $.when.apply($,datasetPromises).then(function(){var connDatasets=connectivityDatasets[0];if(connectivityDatasets.length>1){for(var joined=new morpheus.JoinedDataset(new morpheus.TransposedDatasetView(connectivityDatasets[0]),new morpheus.TransposedDatasetView(connectivityDatasets[1])),i=2;i<connectivityDatasets.length;i++)joined=new morpheus.JoinedDataset(joined,new morpheus.TransposedDatasetView(connectivityDatasets[i]));connDatasets=new morpheus.TransposedDatasetView(joined)}var inputDataset=null;if(1===inputDatasets.length)inputDataset=inputDatasets[0];else if(inputDatasets.length>1){for(joined=new morpheus.JoinedDataset(new morpheus.TransposedDatasetView(inputDatasets[0]),new morpheus.TransposedDatasetView(inputDatasets[1])),i=2;i<inputDatasets.length;i++)joined=new morpheus.JoinedDataset(joined,new morpheus.TransposedDatasetView(connectivityDatasets[i]));inputDataset=new morpheus.TransposedDatasetView(joined)}d.resolve({conn:connDatasets,introspectDatasets:introspectDatasets,inputDataset:inputDataset})}),d},clue.getQueryResultByUrl=function(options){var dataset=null,introspectDataset=null,inputDataset=null,deferred=$.Deferred(),config={},promises=[],introspectPromise=$.Deferred(),inputPromise=$.Deferred();promises.push(introspectPromise),promises.push(inputPromise),promises.push(clue.getJobConfig(options.baseUrl+"/config.yaml").done(function(conf){if(config=conf,"true"===conf.introspect){var p1=morpheus.DatasetUtil.read(options.baseUrl+"/INTROSPECT_CONN.gct");p1.then(function(d){introspectDataset=d,introspectPromise.resolve()}),p1.finally(function(){introspectPromise.resolve()})}else introspectPromise.resolve();if(null!=conf.input_file){var p2=morpheus.DatasetUtil.read(conf.input_file.replace("http://","https://s3.amazonaws.com/"));p2.then(function(d){inputDataset=d}),p2.finally(function(){inputPromise.resolve()})}else inputPromise.resolve()}));var p=morpheus.DatasetUtil.read(options.baseUrl+"/"+options.gct);return p.then(function(d){dataset=d}),promises.push(p),$.when.apply($,promises).then(function(){if(null!=config.rpt){if(null!=introspectDataset&&(null!=config.assay?introspectDataset.setName(0,"Introspect "+config.assay+" - "+config.rpt):introspectDataset.setName(0,"Introspect - "+config.rpt)),null!=inputDataset){for(var nameVector=inputDataset.getColumnMetadata().add("name"),i=0;i<nameVector.size();i++)nameVector.setValue(i,config.rpt);null!=config.assay?inputDataset.setName(0,"Input "+config.assay+" - "+config.rpt):inputDataset.setName(0,"Input - "+config.rpt)}null==(v=dataset.getColumnMetadata().getByName("name"))&&(v=dataset.getColumnMetadata().add("name"));for(var j=0,size=v.size();j<size;j++)v.setValue(j,config.rpt)}if(null!=config.data_type){var v;null==(v=dataset.getColumnMetadata().getByName("data_type"))&&(v=dataset.getColumnMetadata().add("data_type"));for(j=0,size=v.size();j<size;j++)v.setValue(j,config.data_type)}deferred.resolve({conn:dataset,introspect:introspectDataset,input:inputDataset})}),deferred};var pertTypesTasCache=null,pertTypesTasConfig={trt_oe:{xaxisTitle:"All Gene OE",color:"#27AAE0",lineColor:"#8fc7de"},"trt_sh.cgs":{xaxisTitle:"All Gene KD",color:"#B438BE",lineColor:"#c692ca"},trt_cp:{xaxisTitle:"All Compounds",color:"#F5A623",lineColor:"#edca91"}};clue.promptForFile=function(options){var $modal,d=$.Deferred(),formBuilder=new morpheus.FormBuilder;return formBuilder.append({name:"file",value:"",type:"file",required:!0,multiple:options.multiple}),formBuilder.on("change",function(e){var value=e.value;""!==value&&null!=value&&($modal.modal("hide"),$modal.remove(),d.resolve(value))}),$modal=morpheus.FormBuilder.showInModal({title:"File",html:formBuilder.$form,close:!1}),d},clue.loadTasChart=function(pertId,pertType,tasChartId){$(tasChartElt).empty();var showTasChart=function(pertId,tasChartElt){var getTasHoverData=function(pertName,tas,pertsAbove,pertsBelow){var percentBelow=pertsBelow/(pertsAbove+pertsBelow+1)*100;return{pert:pertName,tas:tas,pertsAbove:pertsAbove,pertsBelow:pertsBelow,percentBelow:percentBelow,percentAbove:100-pertsBelow,percentile:Math.floor(percentBelow)}},makeHoverDiv=function(tasHoverInfo,pertTypeConfig){var percentTable=function(tasHoverInfo,pertTypeConfig){return'<div class="metadata-line"></div><table style="font-size:4pt;width:100%;"><tr><td style="width:'+tasHoverInfo.percentBelow+"%;background-color:"+pertTypeConfig.color+'">&nbsp;</td><td style="background-color:lightgrey;width:'+tasHoverInfo.percentAbove+'%">&nbsp;</tr></table></div>'}(tasHoverInfo,pertTypeConfig),scoreText=function(tasHoverInfo){return tasHoverInfo?'<div><div class="metadata-line"><span class="label">Score:</span><span class="value">'+tasHoverInfo.tas+'</span></div><div class="metadata-line"><span class="label">Percentile:</span><span class="value">'+tasHoverInfo.percentile+"</span></div></div>":""}(tasHoverInfo);return'<div class="graph-title">'+tasHoverInfo.pert+"<br/>"+percentTable+scoreText+"</div>"};if(pertTypesTasCache[pertType]){var tasForPert=pertTypesTasCache[pertType].tasForPertId[pertId],xAxisTitle=pertTypesTasConfig[pertType].xaxisTitle+" ("+pertTypesTasCache[pertType].tasX.length+")",lineColor=(tasChartElt=document.getElementById(tasChartId),pertTypesTasConfig[pertType].lineColor);Plotly.newPlot(tasChartElt,[{x:pertTypesTasCache[pertType].tasX,y:pertTypesTasCache[pertType].tasY,text:pertTypesTasCache[pertType].pert_iname,hoverinfo:"none",mode:"lines",type:"scatter",marker:{color:lineColor}}],{margin:{t:10,b:20,l:30,r:0},hovermode:"closest",showlegend:!1,xaxis:{showline:!0,zeroline:!1,showticklabels:!1,ticks:"",fixedrange:!0,range:[0,pertTypesTasCache[pertType].tasX.length],title:xAxisTitle,showgrid:!1,titlefont:{family:"Roboto Condensed, sans-serif"}},yaxis:{range:[0,1],dtick:.25,showline:!0,zeroline:!1,fixedrange:!0,ticksuffix:" ",titlefont:{family:"Roboto Condensed, sans-serif"}}},{displayModeBar:!1}).then(function(){if(tasForPert){var pertsAbove=pertTypesTasCache[pertType].tasX.length;!function(x,y,pertName,pertsAbove,pertsBelow){var pertTypeConfig=pertTypesTasConfig[pertType];$(tasChartElt).find("#tas_point_info").remove(),$(tasChartElt).append('<div id="tas_point_info" style="width:40%;position:relative;top:-90%;right:-50%;"></div>'),Plotly.addTraces(tasChartElt,{mode:"lines+markers",x:[x],y:[y],hoverinfo:"none",name:pertName,marker:{color:pertTypeConfig.color,size:10},hovermode:"closest"}).then(function(){var tasHoverInfoElt=$(tasChartElt).find("#tas_point_info");tasChartElt.on("plotly_hover",function(data){tasHoverInfoElt.empty();var infotext=data.points.map(function(d){var tasHoverInfo=void 0;return d.data.text?(tasHoverInfo=getTasHoverData(d.data.text[d.x],d.y,d.x,d.data.x.length-d.x-1),makeHoverDiv(tasHoverInfo,pertTypeConfig)):""});tasHoverInfoElt.append(infotext)}).on("plotly_unhover",function(data){tasHoverInfoElt.empty();var tasHoverInfo=getTasHoverData(pertName,y,pertsAbove,pertsBelow);tasHoverInfoElt.append(makeHoverDiv(tasHoverInfo,pertTypeConfig))}),tasHoverInfoElt.empty();var tasHoverInfo=getTasHoverData(pertName,y,pertsAbove,pertsBelow);tasHoverInfoElt.append(makeHoverDiv(tasHoverInfo,pertTypeConfig))})}(tasForPert.tasX,tasForPert.tasY,tasForPert.pert_iname,tasForPert.tasX,pertsAbove-tasForPert.tasX-1)}else console.log("No tas data available for "+pertId)})}else console.log("unknown pert type "+pertType+".  Cannot show tas curve.")},tasChartElt=document.getElementById(tasChartId);pertTypesTasCache?showTasChart(pertId,tasChartElt):clue.getTranscriptionalImpactForAllTouchstonePerts(function(error,tasScores){}).done(function(tasScores){for(var pertType in tasCache={},pertTypesTasCache={},pertTypesTasConfig)pertTypesTasCache[pertType]={tasX:[],tasY:[],pert_id:[],pert_iname:[],tasForPertId:{},xIndex:0};tasScores.forEach(function(tas,index){if(tasCache[tas.pert_id]=tas.pert_type,pertTypesTasCache[tas.pert_type]){var tasForPertType=pertTypesTasCache[tas.pert_type];tasForPertType.tasX.push(tasForPertType.xIndex),tasForPertType.tasY.push(tas.tas),tasForPertType.pert_id.push(tas.pert_id),tasForPertType.pert_iname.push(tas.pert_iname),tasForPertType.tasForPertId[tas.pert_id]={tasX:tasForPertType.xIndex,tasY:tas.tas,pert_iname:tas.pert_iname,pert_type:tas.pert_type},tasForPertType.xIndex++}else console.log("No tas cache for "+tas.pert_type)}),showTasChart(pertId,tasChartElt)})},clue.getGutcResultByUrl=function(options){var idSummary,idCellSummary,pclCell,pclSummary,sigGCT,p,deferred=$.Deferred(),promises=[];null!=options.sig_gct&&(p=morpheus.DatasetUtil.read(options.sig_gct),promises.push(p),p.then(function(d){sigGCT=d})),null!=options.pert_id_summary&&(p=morpheus.DatasetUtil.read(options.pert_id_summary),promises.push(p),p.then(function(d){idSummary=d})),null!=options.pert_id_cell&&(p=morpheus.DatasetUtil.read(options.pert_id_cell),promises.push(p),p.then(function(d){idCellSummary=d})),null!=options.pcl_cell&&(p=morpheus.DatasetUtil.read(options.pcl_cell),promises.push(p),p.then(function(d){pclCell=d}),p.catch(function(d){console.log("Error reading PCL cell at "+options.pcl_cell)})),null!=options.pcl_summary&&(p=morpheus.DatasetUtil.read(options.pcl_summary),promises.push(p),p.then(function(d){pclSummary=d}),p.catch(function(d){console.log("Error reading PCL summary at "+options.pcl_summary)}));var annotationLines=null;null!=options.columnInfo&&(p=morpheus.Util.readLines(options.columnInfo)).then(function(lines){annotationLines=lines});var rowAnnotationLines=null;null!=options.rowInfo&&(p=morpheus.Util.readLines(options.rowInfo),promises.push(p),p.then(function(lines){rowAnnotationLines=lines}));var queryName=null;if(null!=options.config){var nameDeferred=$.Deferred();(p=$.ajax({url:options.config})).done(function(text){for(var lines=text.split("\n"),i=0;i<lines.length;i++){var line=lines[i];if(0===line.indexOf("rpt:")){queryName=$.trim(line.substring(4));break}}}),p.always(function(){nameDeferred.resolve()}),promises.push(nameDeferred)}function addUniqueId(d){for(var uniqueIdVector=d.getColumnMetadata().add("_id"),idVector=d.getColumnMetadata().getByName("id"),cellVector=d.getColumnMetadata().getByName("cell_id"),i=0,size=idVector.size();i<size;i++)uniqueIdVector.setValue(i,idVector.getValue(i)+"-"+cellVector.getValue(i));return uniqueIdVector}return Promise.all(promises).then(function(){var counter=0,cellDataset=null;if(idCellSummary){for(var queryIdVectorLong=idCellSummary.getColumnMetadata().getByName("id"),pertIdVectorLong=idCellSummary.getRowMetadata().getByName("id"),cellIdVectorLong=idCellSummary.getRowMetadata().add("cell_id"),uniqueCells=new morpheus.Set,uniquePerts=new morpheus.Set,i=0,nrows=idCellSummary.getRowCount();i<nrows;i++){var index=(id=pertIdVectorLong.getValue(i)).lastIndexOf(":"),cell=id.substring(index+1);id=id.substring(0,index),pertIdVectorLong.setValue(i,id),cellIdVectorLong.setValue(i,cell),uniquePerts.add(id),uniqueCells.add(cell)}idSummary&&uniqueCells.add("summary");var pertIdVector=(cellDataset=new morpheus.Dataset({name:"",rows:uniquePerts.size(),columns:uniqueCells.size()*idCellSummary.getColumnCount()})).getRowMetadata().add("id");counter=0,uniquePerts.forEach(function(id){pertIdVector.setValue(counter++,id)});for(var cellVector=cellDataset.getColumnMetadata().add("cell_id"),queryIdVector=cellDataset.getColumnMetadata().add("id"),nqueries=idCellSummary.getColumnCount(),cells=uniqueCells.values(),ncells=cells.length,j=0;j<nqueries;j++)for(var queryId=queryIdVectorLong.getValue(j),size=(i=0,cellVector.size());i<size;i++)cellVector.setValue(j*ncells+i,cells[i]),queryIdVector.setValue(j*ncells+i,queryId);var pertIdToIndex=morpheus.VectorUtil.createValueToIndexMap(pertIdVector),uniqueIdToIndex=morpheus.VectorUtil.createValueToIndexMap(addUniqueId(cellDataset));morpheus.DatasetUtil.fill(cellDataset,NaN);for(j=0;j<nqueries;j++)for(queryId=queryIdVectorLong.getValue(j),i=0,nrows=idCellSummary.getRowCount();i<nrows;i++){var cellId=cellIdVectorLong.getValue(i),pertId=pertIdVectorLong.getValue(i),rowIndex=pertIdToIndex.get(pertId),columnIndex=uniqueIdToIndex.get(queryId+"-"+cellId);cellDataset.setValue(rowIndex,columnIndex,idCellSummary.getValue(i,j))}if(idSummary){for(i=0,size=(cellIdVectorLong=idSummary.getRowMetadata().add("cell_id")).size();i<size;i++)cellIdVectorLong.setValue(i,"summary");queryIdVectorLong=idSummary.getColumnMetadata().getByName("id"),pertIdVectorLong=idSummary.getRowMetadata().getByName("id");for(j=0;j<nqueries;j++)for(queryId=queryIdVectorLong.getValue(j),i=0,nrows=idSummary.getRowCount();i<nrows;i++){cellId=cellIdVectorLong.getValue(i),pertId=pertIdVectorLong.getValue(i),rowIndex=pertIdToIndex.get(pertId),columnIndex=uniqueIdToIndex.get(queryId+"-"+cellId);if(void 0===rowIndex)throw"error";if(void 0===columnIndex)throw"error";cellDataset.setValue(rowIndex,columnIndex,idSummary.getValue(i,j))}}}else if(idSummary){for(j=0,size=(cellVector=(cellDataset=idSummary).getColumnMetadata().add("cell_id")).size();j<size;j++)cellVector.setValue(j,"summary");addUniqueId(cellDataset)}if(pclSummary){1===pclSummary.getRowCount()&&(pclSummary=new morpheus.TransposedDatasetView(pclSummary));var pclSummaryRowIds=pclSummary.getRowMetadata().getByName("id");for(i=0;i<pclSummaryRowIds.size();i++){-1!==(index=(id=pclSummaryRowIds.getValue(i)).lastIndexOf(":"))&&pclSummaryRowIds.setValue(i,id.substring(0,index))}for(j=0,size=(cellVector=pclSummary.getColumnMetadata().add("cell_id")).size();j<size;j++)cellVector.setValue(j,"summary");addUniqueId(pclSummary)}if(null!=pclCell){var pclIdVector=pclCell.getRowMetadata().getByName("id"),pclCellVector=pclCell.getRowMetadata().add("cell_id");for(i=0,size=pclCellVector.size();i<size;i++){index=(id=pclIdVector.getValue(i)).lastIndexOf(":");pclIdVector.setValue(i,id.substring(0,index)),pclCellVector.setValue(i,id.substring(index+1))}if(1==pclCell.getColumnCount()||"CP_ATPASE_INHIBITOR"!==pclCell.getColumnMetadata().getByName("id").getValue(0)){var uniquePcls=new morpheus.Set;for(uniqueCells=new morpheus.Set,i=0,size=pclCellVector.size();i<size;i++){cell=pclCellVector.getValue(i);var id=pclIdVector.getValue(i);uniqueCells.add(cell);var pcl=pclIdVector.getValue(i);uniquePcls.add(pcl)}nqueries=pclCell.getColumnCount();var pivotedDataset=new morpheus.Dataset({name:"",rows:uniquePcls.size(),columns:uniqueCells.size()*nqueries});morpheus.DatasetUtil.fill(pivotedDataset,NaN);var pivotedRowIdVector=pivotedDataset.getRowMetadata().add("id");counter=0,uniquePcls.forEach(function(pcl){pivotedRowIdVector.setValue(counter++,pcl)});var pclIdToIndex=morpheus.VectorUtil.createValueToIndexMap(pivotedRowIdVector),pivotedColumnIdVector=pivotedDataset.getColumnMetadata().add("id"),pivotedColumnCellIdVector=pivotedDataset.getColumnMetadata().add("cell_id"),cellArray=(queryIdVector=pclCell.getColumnMetadata().getByName("id"),uniqueCells.values());counter=0;for(j=0;j<nqueries;j++)for(queryId=queryIdVector.getValue(j),i=0;i<cellArray.length;i++){cellId=cellArray[i];pivotedColumnIdVector.setValue(counter,queryId),pivotedColumnCellIdVector.setValue(counter,cellId),counter++}for(uniqueIdToIndex=morpheus.VectorUtil.createValueToIndexMap(addUniqueId(pivotedDataset)),j=0;j<nqueries;j++)for(queryId=queryIdVector.getValue(j),i=0,size=pclCellVector.size();i<size;i++){cell=pclCellVector.getValue(i),columnIndex=uniqueIdToIndex.get(queryId+"-"+cell),rowIndex=pclIdToIndex.get(pclIdVector.getValue(i));pivotedDataset.setValue(rowIndex,columnIndex,pclCell.getValue(i,j))}pclCell=pivotedDataset}else addUniqueId(pclCell=new morpheus.TransposedDatasetView(pclCell));null!=pclSummary&&(pclCell=new morpheus.TransposedDatasetView(new morpheus.JoinedDataset(new morpheus.TransposedDatasetView(pclCell),new morpheus.TransposedDatasetView(pclSummary),"id","id")));var pclPertTypeVector=pclCell.getRowMetadata().add("type");for(i=0,size=pclPertTypeVector.size();i<size;i++)pclPertTypeVector.setValue(i,"PCL");cellDataset=cellDataset?new morpheus.JoinedDataset(cellDataset,pclCell,"_id","_id"):pclCell}else null!=pclSummary&&(cellDataset=cellDataset?new morpheus.JoinedDataset(cellDataset,pclSummary,"id","id"):pclSummary);if(cellDataset||(cellDataset=sigGCT),cellDataset.getRowMetadata()){var sourceIndex=morpheus.MetadataUtil.indexOf(cellDataset.getRowMetadata(),"Source");-1!==sourceIndex&&cellDataset.getRowMetadata().remove(sourceIndex)}var opts,tmp,mergedDataset=cellDataset,pertDoseVector=mergedDataset.getColumnMetadata().getByName("pert_idose");if(pertDoseVector)for(i=0,size=pertDoseVector.size();i<size;i++){var value=""+pertDoseVector.getValue(i);pertDoseVector.setValue(i,value.replace("um","m"))}annotationLines&&((opts={}).dataset=mergedDataset,opts.fileColumnNamesToInclude=null,opts.lines=annotationLines,opts.isColumns=!0,opts.sets=null,opts.metadataName="id",opts.fileColumnName=annotationLines[0].split(/\t/)[0],(new morpheus.OpenFileTool).annotate(opts));rowAnnotationLines&&((opts={}).dataset=mergedDataset,opts.fileColumnNamesToInclude=null,opts.lines=rowAnnotationLines,opts.isColumns=!1,opts.sets=null,opts.metadataName="id",opts.fileColumnName=rowAnnotationLines[0].split(/\t/)[0],(new morpheus.OpenFileTool).annotate(opts));if(null!=queryName){var nameVector=mergedDataset.getColumnMetadata().getByName("name");nameVector||(nameVector=mergedDataset.getColumnMetadata().add("name"));for(j=0;j<nameVector.size();j++)nameVector.setValue(j,queryName)}for(var columns=[],ncols=(j=0,mergedDataset.getColumnCount());j<ncols;j++)for(i=0,nrows=mergedDataset.getRowCount();i<nrows;i++)if(!isNaN(mergedDataset.getValue(i,j))){columns.push(j);break}((tmp=(mergedDataset=columns.length!==mergedDataset.getColumnCount()?new morpheus.SlicedDatasetView(mergedDataset,null,columns):mergedDataset).getColumnMetadata().getByName("_id"))&&tmp.setName("id"),(tmp=mergedDataset.getColumnMetadata().getByName("id"))&&tmp.setName("_id"),options.overrideColumns)&&Object.keys(options.overrideColumns).forEach(function(key){var colMeta=mergedDataset.getColumnMetadata().getByName(key);colMeta||(colMeta=mergedDataset.getColumnMetadata().add(key));for(var val=options.overrideColumns[key],i=0;i<colMeta.size();i++)colMeta.setValue(i,val)});deferred.resolve(mergedDataset)},function(err){console.log("Unable to read GUTC results. Error: "+err),deferred.reject("Unable to read GUTC results.")}),deferred.promise()},clue.newPlot=function(myPlot,traces,layout,config){Plotly.newPlot(myPlot,traces,layout,config);var $a=$('<a data-toggle="tooltip" title="Toggle mode bar" href="#" style="fill: rgb(68, 122, 219);position: absolute;top: -2px;right:-6px;z-index: 1002;"><svg height="1em" width="1em" viewBox="0 0 1542 1000"><path d="m0-10h182v-140h-182v140z m228 146h183v-286h-183v286z m225 714h182v-1000h-182v1000z m225-285h182v-715h-182v715z m225 142h183v-857h-183v857z m231-428h182v-429h-182v429z m225-291h183v-138h-183v138z" transform="matrix(1 0 0 -1 0 850)"></path></svg></a>'),$myPlot=$(myPlot);$a.appendTo($myPlot);var $modeBar=$(myPlot).find(".modebar");$modeBar.css("display","none"),$a.on("click",function(e){e.preventDefault(),$modeBar.toggle()})},clue.getPlotlyDefaults2=function(){var plotly=clue.getPlotlyDefaults();return plotly.layout.width=600,plotly.layout.height=600,plotly.layout.margin={l:40,r:10,t:40,b:40,autoexpand:!0},delete plotly.config.displayModeBar,plotly},clue.BUTTONS_TO_REMOVE_FOR_STATIC_CHART=["select2d","lasso2d"],clue.getPlotlyDefaults=function(){return{layout:{hovermode:"closest",autosize:!0,showlegend:!1,margin:{l:80,r:10,t:8,b:14,autoexpand:!0},titlefont:{size:12},xaxis:{zeroline:!1,titlefont:{size:12},showgrid:!0,showticklabels:!0,tickcolor:"rgb(127,127,127)",ticks:"outside"},yaxis:{zeroline:!1,titlefont:{size:12},showgrid:!0,showticklabels:!0,tickcolor:"rgb(127,127,127)",ticks:"outside"}},config:{modeBarButtonsToAdd:[],showLink:!1,displayModeBar:!0,displaylogo:!1,staticPlot:!1,showHints:!0,modeBarButtonsToRemove:["sendDataToCloud","zoomIn2d","zoomOut2d","hoverCompareCartesian","hoverClosestCartesian"]}}},function(a){var c={isMsie:function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return!!a&&parseInt(a[2],10)},isBlankString:function(a){return!a||/^\s*$/.test(a)},escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isArray:a.isArray,isFunction:a.isFunction,isObject:a.isPlainObject,isUndefined:function(a){return void 0===a},bind:a.proxy,bindAll:function(b){var c;for(var d in b)a.isFunction(c=b[d])&&(b[d]=a.proxy(c,b))},indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},each:a.each,map:a.map,filter:a.grep,every:function(b,c){var d=!0;return b?(a.each(b,function(a,e){return!!(d=c.call(null,e,a,b))&&void 0}),!!d):d},some:function(b,c){var d=!1;return b?(a.each(b,function(a,e){return!(d=c.call(null,e,a,b))&&void 0}),!!d):d},mixin:a.extend,getUniqueId:function(){var a=0;return function(){return a++}}(),defer:function(a){setTimeout(a,0)},debounce:function(a,b,c){var d,e;return function(){var f,g,h=this,i=arguments;return f=function(){d=null,c||(e=a.apply(h,i))},g=c&&!d,clearTimeout(d),d=setTimeout(f,b),g&&(e=a.apply(h,i)),e}},throttle:function(a,b){var c,d,e,f,g,h;return g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)},function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},tokenizeQuery:function(b){return a.trim(b).toLowerCase().split(/[\s]+/)},tokenizeText:function(b){return a.trim(b).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}},d=function(){var a=/\s+/;return{on:function(b,c){var d;if(!c)return this;for(this._callbacks=this._callbacks||{},b=b.split(a);d=b.shift();)this._callbacks[d]=this._callbacks[d]||[],this._callbacks[d].push(c);return this},trigger:function(b,c){var d,e;if(!this._callbacks)return this;for(b=b.split(a);d=b.shift();)if(e=this._callbacks[d])for(var f=0;f<e.length;f+=1)e[f].call(this,{type:d,data:c});return this}}}(),e=function(){function b(b){b&&b.el||a.error("EventBus initialized without el"),this.$el=a(b.el)}return c.mixin(b.prototype,{trigger:function(a){var b=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+a,b)}}),b}(),f=function(){function a(a){this.prefix=["__",a,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+this.prefix)}function b(){return(new Date).getTime()}function d(a){return JSON.stringify(c.isUndefined(a)?null:a)}function e(a){return JSON.parse(a)}var f,g;try{(f=window.localStorage).setItem("~~~","!"),f.removeItem("~~~")}catch(h){f=null}return g=f&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){return this.isExpired(a)&&this.remove(a),e(f.getItem(this._prefix(a)))},set:function(a,e,g){return c.isNumber(g)?f.setItem(this._ttlKey(a),d(b()+g)):f.removeItem(this._ttlKey(a)),f.setItem(this._prefix(a),d(e))},remove:function(a){return f.removeItem(this._ttlKey(a)),f.removeItem(this._prefix(a)),this},clear:function(){var a,b,c=[],d=f.length;for(a=0;d>a;a++)(b=f.key(a)).match(this.keyMatcher)&&c.push(b.replace(this.keyMatcher,""));for(a=c.length;a--;)this.remove(c[a]);return this},isExpired:function(a){var d=e(f.getItem(this._ttlKey(a)));return!!(c.isNumber(d)&&b()>d)}}:{get:c.noop,set:c.noop,remove:c.noop,clear:c.noop,isExpired:c.noop},c.mixin(a.prototype,g),a}(),g=function(){function a(a){c.bindAll(this),a=a||{},this.sizeLimit=a.sizeLimit||10,this.cache={},this.cachedKeysByAge=[]}return c.mixin(a.prototype,{get:function(a){return this.cache[a]},set:function(a,b){var c;this.cachedKeysByAge.length===this.sizeLimit&&(c=this.cachedKeysByAge.shift(),delete this.cache[c]),this.cache[a]=b,this.cachedKeysByAge.push(a)}}),a}(),h=function(){function b(a){c.bindAll(this),a=c.isString(a)?{url:a}:a,i=i||new g,h=c.isNumber(a.maxParallelRequests)?a.maxParallelRequests:h||6,this.url=a.url,this.wildcard=a.wildcard||"%QUERY",this.filter=a.filter,this.replace=a.replace,this.ajaxSettings={type:"get",cache:a.cache,timeout:a.timeout,dataType:a.dataType||"json",beforeSend:a.beforeSend},this._get=(/^throttle$/i.test(a.rateLimitFn)?c.throttle:c.debounce)(this._get,a.rateLimitWait||300)}var h,i,j=0,k={};return c.mixin(b.prototype,{_get:function(a,b){var d=this;h>j?this._sendRequest(a).done(function(c){var e=d.filter?d.filter(c):c;b&&b(e),i.set(a,c)}):this.onDeckRequestArgs=[].slice.call(arguments,0)},_sendRequest:function(b){var f=this,g=k[b];return g||(j++,g=k[b]=a.ajax(b,this.ajaxSettings).always(function(){j--,k[b]=null,f.onDeckRequestArgs&&(f._get.apply(f,f.onDeckRequestArgs),f.onDeckRequestArgs=null)})),g},get:function(a,b){var d,e,f=this,g=encodeURIComponent(a||"");return b=b||c.noop,d=this.replace?this.replace(this.url,g):this.url.replace(this.wildcard,g),(e=i.get(d))?c.defer(function(){b(f.filter?f.filter(e):e)}):this._get(d,b),!!e}}),b}(),i=function(){function d(b){c.bindAll(this),c.isString(b.template)&&!b.engine&&a.error("no template engine specified"),b.local||b.prefetch||b.remote||a.error("one of local, prefetch, or remote is required"),this.name=b.name||c.getUniqueId(),this.limit=b.limit||5,this.minLength=b.minLength||1,this.header=b.header,this.footer=b.footer,this.valueKey=b.valueKey||"value",this.template=function(a,b,d){var e,f;return c.isFunction(a)?e=a:c.isString(a)?(f=b.compile(a),e=c.bind(f.render,f)):e=function(a){return"<p>"+a[d]+"</p>"},e}(b.template,b.engine,this.valueKey),this.local=b.local,this.prefetch=b.prefetch,this.remote=b.remote,this.itemHash={},this.adjacencyList={},this.storage=b.name?new f(b.name):null}var g={thumbprint:"thumbprint",protocol:"protocol",itemHash:"itemHash",adjacencyList:"adjacencyList"};return c.mixin(d.prototype,{_processLocalData:function(a){this._mergeProcessedData(this._processData(a))},_loadPrefetchData:function(d){var f,h,i,j,k,l,m=this,n="0.9.3"+(d.thumbprint||"");return this.storage&&(f=this.storage.get(g.thumbprint),h=this.storage.get(g.protocol),i=this.storage.get(g.itemHash),j=this.storage.get(g.adjacencyList)),k=f!==n||h!==c.getProtocol(),(d=c.isString(d)?{url:d}:d).ttl=c.isNumber(d.ttl)?d.ttl:864e5,i&&j&&!k?(this._mergeProcessedData({itemHash:i,adjacencyList:j}),l=a.Deferred().resolve()):l=a.getJSON(d.url).done(function(a){var b=d.filter?d.filter(a):a,e=m._processData(b),f=e.itemHash,h=e.adjacencyList;m.storage&&(m.storage.set(g.itemHash,f,d.ttl),m.storage.set(g.adjacencyList,h,d.ttl),m.storage.set(g.thumbprint,n,d.ttl),m.storage.set(g.protocol,c.getProtocol(),d.ttl)),m._mergeProcessedData(e)}),l},_transformDatum:function(a){var b=c.isString(a)?a:a[this.valueKey],e={value:b,tokens:a.tokens||c.tokenizeText(b)};return c.isString(a)?(e.datum={},e.datum[this.valueKey]=a):e.datum=a,e.tokens=c.filter(e.tokens,function(a){return!c.isBlankString(a)}),e.tokens=c.map(e.tokens,function(a){return a.toLowerCase()}),e},_processData:function(a){var b=this,d={},e={};return c.each(a,function(a,f){var g=b._transformDatum(f),h=c.getUniqueId(g.value);d[h]=g,c.each(g.tokens,function(a,b){var d=b.charAt(0),f=e[d]||(e[d]=[h]);!~c.indexOf(f,h)&&f.push(h)})}),{itemHash:d,adjacencyList:e}},_mergeProcessedData:function(a){var b=this;c.mixin(this.itemHash,a.itemHash),c.each(a.adjacencyList,function(a,c){var d=b.adjacencyList[a];b.adjacencyList[a]=d?d.concat(c):c})},_getLocalSuggestions:function(a){var b,d=this,e=[],f=[],g=[];return c.each(a,function(a,b){var d=b.charAt(0);!~c.indexOf(e,d)&&e.push(d)}),c.each(e,function(a,c){var e=d.adjacencyList[c];return!!e&&(f.push(e),void((!b||e.length<b.length)&&(b=e)))}),f.length<e.length?[]:(c.each(b,function(b,e){var j=d.itemHash[e];c.every(f,function(a){return~c.indexOf(a,e)})&&c.every(a,function(a){return c.some(j.tokens,function(b){return 0===b.indexOf(a)})})&&g.push(j)}),g)},initialize:function(){var b;return this.local&&this._processLocalData(this.local),this.transport=this.remote?new h(this.remote):null,b=this.prefetch?this._loadPrefetchData(this.prefetch):a.Deferred().resolve(),this.local=this.prefetch=this.remote=null,this.initialize=function(){return b},b},getSuggestions:function(a,b){var e,f,g=this,h=!1;a.length<this.minLength||(e=c.tokenizeQuery(a),(f=this._getLocalSuggestions(e).slice(0,this.limit)).length<this.limit&&this.transport&&(h=this.transport.get(a,function(a){f=f.slice(0),c.each(a,function(a,b){var e=g._transformDatum(b);return!c.some(f,function(a){return e.value===a.value})&&f.push(e),f.length<g.limit}),b&&b(f)})),!h&&b&&b(f))}}),d}(),j=function(){function b(b){var d=this;c.bindAll(this),this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},this.$hint=a(b.hint),this.$input=a(b.input).on("blur.tt",this._handleBlur).on("focus.tt",this._handleFocus).on("keydown.tt",this._handleSpecialKeyEvent),c.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){d.specialKeyCodeMap[a.which||a.keyCode]||c.defer(d._compareQueryToInputValue)}):this.$input.on("input.tt",this._compareQueryToInputValue),this.query=this.$input.val(),this.$overflowHelper=function(b){return a("<span></span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:b.css("font-family"),fontSize:b.css("font-size"),fontStyle:b.css("font-style"),fontVariant:b.css("font-variant"),fontWeight:b.css("font-weight"),wordSpacing:b.css("word-spacing"),letterSpacing:b.css("letter-spacing"),textIndent:b.css("text-indent"),textRendering:b.css("text-rendering"),textTransform:b.css("text-transform")}).insertAfter(b)}(this.$input)}return c.mixin(b.prototype,d,{_handleFocus:function(){this.trigger("focused")},_handleBlur:function(){this.trigger("blured")},_handleSpecialKeyEvent:function(a){var b=this.specialKeyCodeMap[a.which||a.keyCode];b&&this.trigger(b+"Keyed",a)},_compareQueryToInputValue:function(){var a=this.getInputValue(),b=function(a,b){return(a=(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "))===(b=(b||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "))}(this.query,a);!!b&&this.query.length!==a.length?this.trigger("whitespaceChanged",{value:this.query}):b||this.trigger("queryChanged",{value:this.query=a})},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,b){this.$input.val(a),!b&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(a){this.$hint.val(a)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var a,b=this.$input.val().length,d=this.$input[0].selectionStart;return c.isNumber(d)?d===b:!document.selection||((a=document.selection.createRange()).moveStart("character",-b),b===a.text.length)}}),b}(),k=function(){function b(b){c.bindAll(this),this.isOpen=!1,this.isEmpty=!0,this.isMouseOverDropdown=!1,this.$menu=a(b.menu).on("mouseenter.tt",this._handleMouseenter).on("mouseleave.tt",this._handleMouseleave).on("click.tt",".tt-suggestion",this._handleSelection).on("mouseover.tt",".tt-suggestion",this._handleMouseover)}function e(a){return a.data("suggestion")}var f_suggestionsList='<span class="tt-suggestions"></span>',g_suggestionsList={display:"block"},g_suggestion={whiteSpace:"nowrap",cursor:"pointer"},g_suggestionChild={whiteSpace:"normal"};return c.mixin(b.prototype,d,{_handleMouseenter:function(){this.isMouseOverDropdown=!0},_handleMouseleave:function(){this.isMouseOverDropdown=!1},_handleMouseover:function(b){var c=a(b.currentTarget);this._getSuggestions().removeClass("tt-is-under-cursor"),c.addClass("tt-is-under-cursor")},_handleSelection:function(b){var c=a(b.currentTarget);this.trigger("suggestionSelected",e(c))},_show:function(){this.$menu.css("display","block")},_hide:function(){this.$menu.hide()},_moveCursor:function(a){var b,c,d,f;if(this.isVisible()){if((c=(b=this._getSuggestions()).filter(".tt-is-under-cursor")).removeClass("tt-is-under-cursor"),-1===(d=((d=b.index(c)+a)+1)%(b.length+1)-1))return void this.trigger("cursorRemoved");-1>d&&(d=b.length-1),f=b.eq(d).addClass("tt-is-under-cursor"),this._ensureVisibility(f),this.trigger("cursorMoved",e(f))}},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},_ensureVisibility:function(a){var b=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),c=this.$menu.scrollTop(),d=a.position().top,e=d+a.outerHeight(!0);0>d?this.$menu.scrollTop(c+d):e>b&&this.$menu.scrollTop(c+(e-b))},destroy:function(){this.$menu.off(".tt"),this.$menu=null},isVisible:function(){return this.isOpen&&!this.isEmpty},closeUnlessMouseIsOverDropdown:function(){this.isMouseOverDropdown||this.close()},close:function(){this.isOpen&&(this.isOpen=!1,this.isMouseOverDropdown=!1,this._hide(),this.$menu.find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor"),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(a){"ltr"===a?this.$menu.css({left:"0",right:"auto"}):this.$menu.css({left:"auto",right:" 0"})},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getSuggestionUnderCursor:function(){var a=this._getSuggestions().filter(".tt-is-under-cursor").first();return a.length>0?e(a):null},getFirstSuggestion:function(){var a=this._getSuggestions().first();return a.length>0?e(a):null},renderSuggestions:function(b,d){var e,h,i,j,k,l="tt-dataset-"+b.name,n=this.$menu.find("."+l);0===n.length&&(h=a(f_suggestionsList).css(g_suggestionsList),n=a("<div></div>").addClass(l).append(b.header).append(h).append(b.footer).appendTo(this.$menu)),d.length>0?(this.isEmpty=!1,this.isOpen&&this._show(),i=document.createElement("div"),j=document.createDocumentFragment(),c.each(d,function(c,d){d.dataset=b.name,e=b.template(d.datum),i.innerHTML='<div class="tt-suggestion">%body</div>'.replace("%body",e),(k=a(i.firstChild).css(g_suggestion).data("suggestion",d)).children().each(function(){a(this).css(g_suggestionChild)}),j.appendChild(k[0])}),n.show().find(".tt-suggestions").html(j)):this.clearSuggestions(b.name),this.trigger("suggestionsRendered")},clearSuggestions:function(a){var b=a?this.$menu.find(".tt-dataset-"+a):this.$menu.find('[class^="tt-dataset-"]'),c=b.find(".tt-suggestions");b.hide(),c.empty(),0===this._getSuggestions().length&&(this.isEmpty=!0,this._hide())}}),b}(),l=function(){function b(a){var b,d,f;c.bindAll(this),this.$node=e(a.input),this.datasets=a.datasets,this.dir=null,this.eventBus=a.eventBus,b=this.$node.find(".tt-dropdown-menu"),d=this.$node.find(".tt-query"),f=this.$node.find(".tt-hint"),this.dropdownView=new k({menu:b}).on("suggestionSelected",this._handleSelection).on("cursorMoved",this._clearHint).on("cursorMoved",this._setInputValueToSuggestionUnderCursor).on("cursorRemoved",this._setInputValueToQuery).on("cursorRemoved",this._updateHint).on("suggestionsRendered",this._updateHint).on("opened",this._updateHint).on("closed",this._clearHint).on("opened closed",this._propagateEvent),this.inputView=new j({input:d,hint:f}).on("focused",this._openDropdown).on("blured",this._closeDropdown).on("blured",this._setInputValueToQuery).on("enterKeyed tabKeyed",this._handleSelection).on("queryChanged",this._clearHint).on("queryChanged",this._clearSuggestions).on("queryChanged",this._getSuggestions).on("whitespaceChanged",this._updateHint).on("queryChanged whitespaceChanged",this._openDropdown).on("queryChanged whitespaceChanged",this._setLanguageDirection).on("escKeyed",this._closeDropdown).on("escKeyed",this._setInputValueToQuery).on("tabKeyed upKeyed downKeyed",this._managePreventDefault).on("upKeyed downKeyed",this._moveDropdownCursor).on("upKeyed downKeyed",this._openDropdown).on("tabKeyed leftKeyed rightKeyed",this._autocomplete)}function e(b){var c=a(g.wrapper),d=a(g.dropdown),e=a(b),f=a(g.hint);c=c.css(h.wrapper),d=d.css(h.dropdown),f.css(h.hint).css({backgroundAttachment:e.css("background-attachment"),backgroundClip:e.css("background-clip"),backgroundColor:e.css("background-color"),backgroundImage:e.css("background-image"),backgroundOrigin:e.css("background-origin"),backgroundPosition:e.css("background-position"),backgroundRepeat:e.css("background-repeat"),backgroundSize:e.css("background-size")}),e.data("ttAttrs",{dir:e.attr("dir"),autocomplete:e.attr("autocomplete"),spellcheck:e.attr("spellcheck"),style:e.attr("style")}),e.addClass("tt-query").attr({autocomplete:"off",spellcheck:!1}).css(h.query);try{!e.attr("dir")&&e.attr("dir","auto")}catch(i){}return e.wrap(c).parent().prepend(f).append(d)}var g={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input class="tt-hint" type="text" autocomplete="off" spellcheck="off" disabled>',dropdown:'<span class="tt-dropdown-menu"></span>'},h={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},query:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"}};return c.isMsie()&&c.mixin(h.query,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),c.isMsie()&&c.isMsie()<=7&&(c.mixin(h.wrapper,{display:"inline",zoom:"1"}),c.mixin(h.query,{marginTop:"-1px"})),c.mixin(b.prototype,d,{_managePreventDefault:function(a){var b,c,d=a.data,e=!1;switch(a.type){case"tabKeyed":b=this.inputView.getHintValue(),c=this.inputView.getInputValue(),e=b&&b!==c;break;case"upKeyed":case"downKeyed":e=!d.shiftKey&&!d.ctrlKey&&!d.metaKey}e&&d.preventDefault()},_setLanguageDirection:function(){var a=this.inputView.getLanguageDirection();a!==this.dir&&(this.dir=a,this.$node.css("direction",a),this.dropdownView.setLanguageDirection(a))},_updateHint:function(){var a,b,d,f,g=this.dropdownView.getFirstSuggestion(),h=g?g.value:null,i=this.dropdownView.isVisible(),j=this.inputView.isOverflow();h&&i&&!j&&(b=(a=this.inputView.getInputValue()).replace(/\s{2,}/g," ").replace(/^\s+/g,""),d=c.escapeRegExChars(b),f=new RegExp("^(?:"+d+")(.*$)","i").exec(h),this.inputView.setHintValue(a+(f?f[1]:"")))},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(a){var b=a.data;this.inputView.setInputValue(b.value,!0)},_openDropdown:function(){this.dropdownView.open()},_closeDropdown:function(a){this.dropdownView["blured"===a.type?"closeUnlessMouseIsOverDropdown":"close"]()},_moveDropdownCursor:function(a){var b=a.data;b.shiftKey||b.ctrlKey||b.metaKey||this.dropdownView["upKeyed"===a.type?"moveCursorUp":"moveCursorDown"]()},_handleSelection:function(a){var b="suggestionSelected"===a.type,d=b?a.data:this.dropdownView.getSuggestionUnderCursor();d&&(this.inputView.setInputValue(d.value),b?this.inputView.focus():a.data.preventDefault(),b&&c.isMsie()?c.defer(this.dropdownView.close):this.dropdownView.close(),this.eventBus.trigger("selected",d.datum,d.dataset))},_getSuggestions:function(){var a=this,b=this.inputView.getQuery();c.isBlankString(b)||c.each(this.datasets,function(c,d){d.getSuggestions(b,function(c){b===a.inputView.getQuery()&&a.dropdownView.renderSuggestions(d,c)})})},_autocomplete:function(a){var b,c,d,e,f;("rightKeyed"!==a.type&&"leftKeyed"!==a.type||(b=this.inputView.isCursorAtEnd(),c="ltr"===this.inputView.getLanguageDirection()?"leftKeyed"===a.type:"rightKeyed"===a.type,b&&!c))&&(d=this.inputView.getQuery(),""!==(e=this.inputView.getHintValue())&&d!==e&&(f=this.dropdownView.getFirstSuggestion(),this.inputView.setInputValue(f.value),this.eventBus.trigger("autocompleted",f.datum,f.dataset)))},_propagateEvent:function(a){this.eventBus.trigger(a.type)},destroy:function(){var a,b;this.inputView.destroy(),this.dropdownView.destroy(),a=this.$node,b=a.find(".tt-query"),c.each(b.data("ttAttrs"),function(a,d){c.isUndefined(d)?b.removeAttr(a):b.attr(a,d)}),b.detach().removeData("ttAttrs").removeClass("tt-query").insertAfter(a),a.remove(),this.$node=null},setQuery:function(a){this.inputView.setQuery(a),this.inputView.setInputValue(a),this._clearHint(),this._clearSuggestions(),this._getSuggestions()}}),b}();!function(){var b,d={},f="ttView";b={initialize:function(b){var h;return 0===(b=c.isArray(b)?b:[b]).length&&a.error("no datasets provided"),h=c.map(b,function(a){var b=d[a.name]?d[a.name]:new i(a);return a.name&&(d[a.name]=b),b}),this.each(function(){var b,d=a(this),g=new e({el:d});b=c.map(h,function(a){return a.initialize()}),d.data(f,new l({input:d,eventBus:g=new e({el:d}),datasets:h})),a.when.apply(a,b).always(function(){c.defer(function(){g.trigger("initialized")})})})},destroy:function(){return this.each(function(){var b=a(this),c=b.data(f);c&&(c.destroy(),b.removeData(f))})},setQuery:function(b){return this.each(function(){var c=a(this).data(f);c&&c.setQuery(b)})}},jQuery.fn.typeahead=function(a){return b[a]?b[a].apply(this,[].slice.call(arguments,1)):b.initialize.apply(this,arguments)}}()}(window.jQuery),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.async=e.async||{})}(this,function(exports){"use strict";function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function overRest$1(e,t,r){return t=nativeMax(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,i=nativeMax(n.length-t,0),a=Array(i);++o<i;)a[o]=n[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=n[o];return s[t]=r(a),apply(e,this,s)}}function identity(e){return e}function rest(e,t){return overRest$1(e,t,identity)}function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function asyncify(e){return initialParams(function(t,r){var n;try{n=e.apply(this,t)}catch(e){return r(e)}isObject(n)&&"function"==typeof n.then?n.then(function(e){r(null,e)},function(e){r(e.message?e:new Error(e))}):r(null,n)})}function supportsAsync(){var supported;try{supported=isAsync(eval("(async function () {})"))}catch(e){supported=!1}return supported}function isAsync(e){return supportsSymbol&&"AsyncFunction"===e[Symbol.toStringTag]}function wrapAsync(e){return isAsync(e)?asyncify(e):e}function applyEach$1(e){return rest(function(t,r){var n=initialParams(function(r,n){var o=this;return e(t,function(e,t){wrapAsync$1(e).apply(o,r.concat(t))},n)});return r.length?n.apply(this,r):n})}function getRawTag(e){var t=hasOwnProperty.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch(e){}var o=nativeObjectToString.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),o}function objectToString(e){return nativeObjectToString$1.call(e)}function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:(e=Object(e),symToStringTag&&symToStringTag in e?getRawTag(e):objectToString(e))}function isFunction(e){if(!isObject(e))return!1;var t=baseGetTag(e);return t==funcTag||t==genTag||t==asyncTag||t==proxyTag}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}function noop(){}function once(e){return function(){if(null!==e){var t=e;e=null,t.apply(this,arguments)}}}function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function isObjectLike(e){return null!=e&&"object"==typeof e}function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag}function stubFalse(){return!1}function isIndex(e,t){return!!(t=null==t?MAX_SAFE_INTEGER$1:t)&&("number"==typeof e||reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}function arrayLikeKeys(e,t){var r=isArray(e),n=!r&&isArguments(e),o=!r&&!n&&isBuffer(e),i=!r&&!n&&!o&&isTypedArray(e),a=r||n||o||i,s=a?baseTimes(e.length,String):[],c=s.length;for(var u in e)!t&&!hasOwnProperty$1.call(e,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex(u,c))||s.push(u);return s}function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$5)}function overArg(e,t){return function(r){return e(t(r))}}function baseKeys(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$3.call(e,r)&&"constructor"!=r&&t.push(r);return t}function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function createArrayIterator(e){var t=-1,r=e.length;return function(){return++t<r?{value:e[t],key:t}:null}}function createES2015Iterator(e){var t=-1;return function(){var r=e.next();return r.done?null:(t++,{value:r.value,key:t})}}function createObjectIterator(e){var t=keys(e),r=-1,n=t.length;return function(){var o=t[++r];return r<n?{value:e[o],key:o}:null}}function iterator(e){if(isArrayLike(e))return createArrayIterator(e);var t=getIterator(e);return t?createES2015Iterator(t):createObjectIterator(e)}function onlyOnce(e){return function(){if(null===e)throw new Error("Callback was already called.");var t=e;e=null,t.apply(this,arguments)}}function _eachOfLimit(e){return function(t,r,n){function o(e,t){if(c-=1,e)s=!0,n(e);else{if(t===breakLoop||s&&c<=0)return s=!0,n(null);i()}}function i(){for(;c<e&&!s;){var t=a();if(null===t)return s=!0,void(c<=0&&n(null));c+=1,r(t.value,t.key,onlyOnce(o))}}if(n=once(n||noop),e<=0||!t)return n(null);var a=iterator(t),s=!1,c=0;i()}}function eachOfLimit(e,t,r,n){_eachOfLimit(t)(e,wrapAsync$1(r),n)}function doLimit(e,t){return function(r,n,o){return e(r,t,n,o)}}function eachOfArrayLike(e,t,r){function n(e,t){e?r(e):++i!==a&&t!==breakLoop||r(null)}r=once(r||noop);var o=0,i=0,a=e.length;for(0===a&&r(null);o<a;o++)t(e[o],o,onlyOnce(n))}function doParallel(e){return function(t,r,n){return e(eachOf,t,wrapAsync$1(r),n)}}function _asyncMap(e,t,r,n){n=n||noop,t=t||[];var o=[],i=0,a=wrapAsync$1(r);e(t,function(e,t,r){var n=i++;a(e,function(e,t){o[n]=t,r(e)})},function(e){n(e,o)})}function doParallelLimit(e){return function(t,r,n,o){return e(_eachOfLimit(r),t,wrapAsync$1(n),o)}}function arrayEach(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function createBaseFor(e){return function(t,r,n){for(var o=-1,i=Object(t),a=n(t),s=a.length;s--;){var c=a[e?s:++o];if(!1===r(i[c],c,i))break}return t}}function baseForOwn(e,t){return e&&baseFor(e,t,keys)}function baseFindIndex(e,t,r,n){for(var o=e.length,i=r+(n?1:-1);n?i--:++i<o;)if(t(e[i],i,e))return i;return-1}function baseIsNaN(e){return e!=e}function strictIndexOf(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}function baseIndexOf(e,t,r){return t==t?strictIndexOf(e,t,r):baseFindIndex(e,baseIsNaN,r)}function arrayMap(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&baseGetTag(e)==symbolTag}function baseToString(e){if("string"==typeof e)return e;if(isArray(e))return arrayMap(e,baseToString)+"";if(isSymbol(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY?"-0":t}function baseSlice(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(o);++n<o;)i[n]=e[n+t];return i}function castSlice(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:baseSlice(e,t,r)}function charsEndIndex(e,t){for(var r=e.length;r--&&baseIndexOf(t,e[r],0)>-1;);return r}function charsStartIndex(e,t){for(var r=-1,n=e.length;++r<n&&baseIndexOf(t,e[r],0)>-1;);return r}function asciiToArray(e){return e.split("")}function hasUnicode(e){return reHasUnicode.test(e)}function unicodeToArray(e){return e.match(reUnicode)||[]}function stringToArray(e){return hasUnicode(e)?unicodeToArray(e):asciiToArray(e)}function toString(e){return null==e?"":baseToString(e)}function trim(e,t,r){if((e=toString(e))&&(r||void 0===t))return e.replace(reTrim,"");if(!e||!(t=baseToString(t)))return e;var n=stringToArray(e),o=stringToArray(t);return castSlice(n,charsStartIndex(n,o),charsEndIndex(n,o)+1).join("")}function parseParams(e){return(e=(e=(e=e.toString().replace(STRIP_COMMENTS,"")).match(FN_ARGS)[2].replace(" ",""))?e.split(FN_ARG_SPLIT):[]).map(function(e){return trim(e.replace(FN_ARG,""))})}function autoInject(e,t){var r={};baseForOwn(e,function(e,t){function n(t,r){var n=arrayMap(o,function(e){return t[e]});n.push(r),wrapAsync$1(e).apply(null,n)}var o,i=isAsync(e),a=!i&&1===e.length||i&&0===e.length;if(isArray(e))o=e.slice(0,-1),e=e[e.length-1],r[t]=o.concat(o.length>0?n:e);else if(a)r[t]=e;else{if(o=parseParams(e),0===e.length&&!i&&0===o.length)throw new Error("autoInject task functions require explicit parameters.");i||o.pop(),r[t]=o.concat(n)}}),auto(r,t)}function fallback(e){setTimeout(e,0)}function wrap(e){return rest(function(t,r){e(function(){t.apply(null,r)})})}function DLL(){this.head=this.tail=null,this.length=0}function setInitial(e,t){e.length=1,e.head=e.tail=t}function queue(e,t,r){function n(e,t,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(u.started=!0,isArray(e)||(e=[e]),0===e.length&&u.idle())return setImmediate$1(function(){u.drain()});for(var n=0,o=e.length;n<o;n++){var i={data:e[n],callback:r||noop};t?u._tasks.unshift(i):u._tasks.push(i)}setImmediate$1(u.process)}function o(e){return rest(function(t){a-=1;for(var r=0,n=e.length;r<n;r++){var o=e[r],i=baseIndexOf(s,o,0);i>=0&&s.splice(i),o.callback.apply(o,t),null!=t[0]&&u.error(t[0],o.data)}a<=u.concurrency-u.buffer&&u.unsaturated(),u.idle()&&u.drain(),u.process()})}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var i=wrapAsync$1(e),a=0,s=[],c=!1,u={_tasks:new DLL,concurrency:t,payload:r,saturated:noop,unsaturated:noop,buffer:t/4,empty:noop,drain:noop,error:noop,started:!1,paused:!1,push:function(e,t){n(e,!1,t)},kill:function(){u.drain=noop,u._tasks.empty()},unshift:function(e,t){n(e,!0,t)},process:function(){if(!c){for(c=!0;!u.paused&&a<u.concurrency&&u._tasks.length;){var e=[],t=[],r=u._tasks.length;u.payload&&(r=Math.min(r,u.payload));for(var n=0;n<r;n++){var l=u._tasks.shift();e.push(l),t.push(l.data)}0===u._tasks.length&&u.empty(),a+=1,s.push(e[0]),a===u.concurrency&&u.saturated();var f=onlyOnce(o(e));i(t,f)}c=!1}},length:function(){return u._tasks.length},running:function(){return a},workersList:function(){return s},idle:function(){return u._tasks.length+a===0},pause:function(){u.paused=!0},resume:function(){!1!==u.paused&&(u.paused=!1,setImmediate$1(u.process))}};return u}function cargo(e,t){return queue(e,1,t)}function reduce(e,t,r,n){n=once(n||noop);var o=wrapAsync$1(r);eachOfSeries(e,function(e,r,n){o(t,e,function(e,r){t=r,n(e)})},function(e){n(e,t)})}function concat$1(e,t,r,n){var o=[];e(t,function(e,t,n){r(e,function(e,t){o=o.concat(t||[]),n(e)})},function(e){n(e,o)})}function doSeries(e){return function(t,r,n){return e(eachOfSeries,t,wrapAsync$1(r),n)}}function _createTester(e,t){return function(r,n,o,i){i=i||noop;var a,s=!1;r(n,function(r,n,i){o(r,function(n,o){n?i(n):e(o)&&!a?(s=!0,a=t(!0,r),i(null,breakLoop)):i()})},function(e){e?i(e):i(null,s?a:t(!1))})}}function _findGetResult(e,t){return t}function consoleFunc(e){return rest(function(t,r){wrapAsync$1(t).apply(null,r.concat(rest(function(t,r){"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&arrayEach(r,function(t){console[e](t)}))})))})}function doDuring(e,t,r){function n(e,t){return e?r(e):t?void o(a):r(null)}r=onlyOnce(r||noop);var o=wrapAsync$1(e),i=wrapAsync$1(t),a=rest(function(e,t){return e?r(e):(t.push(n),void i.apply(this,t))});n(null,!0)}function doWhilst(e,t,r){r=onlyOnce(r||noop);var n=wrapAsync$1(e),o=rest(function(e,i){return e?r(e):t.apply(this,i)?n(o):void r.apply(null,[null].concat(i))});n(o)}function doUntil(e,t,r){doWhilst(e,function(){return!t.apply(this,arguments)},r)}function during(e,t,r){function n(e){return e?r(e):void a(o)}function o(e,t){return e?r(e):t?void i(n):r(null)}r=onlyOnce(r||noop);var i=wrapAsync$1(t),a=wrapAsync$1(e);a(o)}function _withoutIndex(e){return function(t,r,n){return e(t,n)}}function eachLimit(e,t,r){eachOf(e,_withoutIndex(wrapAsync$1(t)),r)}function eachLimit$1(e,t,r,n){_eachOfLimit(t)(e,_withoutIndex(wrapAsync$1(r)),n)}function ensureAsync(e){return isAsync(e)?e:initialParams(function(t,r){var n=!0;t.push(function(){var e=arguments;n?setImmediate$1(function(){r.apply(null,e)}):r.apply(null,e)}),e.apply(this,t),n=!1})}function notId(e){return!e}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function filterArray(e,t,r,n){var o=new Array(t.length);e(t,function(e,t,n){r(e,function(e,r){o[t]=!!r,n(e)})},function(e){if(e)return n(e);for(var r=[],i=0;i<t.length;i++)o[i]&&r.push(t[i]);n(null,r)})}function filterGeneric(e,t,r,n){var o=[];e(t,function(e,t,n){r(e,function(r,i){r?n(r):(i&&o.push({index:t,value:e}),n())})},function(e){e?n(e):n(null,arrayMap(o.sort(function(e,t){return e.index-t.index}),baseProperty("value")))})}function _filter(e,t,r,n){(isArrayLike(t)?filterArray:filterGeneric)(e,t,wrapAsync$1(r),n||noop)}function forever(e,t){var n=onlyOnce(t||noop),o=wrapAsync$1(ensureAsync(e));!function r(e){return e?n(e):void o(r)}()}function mapValuesLimit(e,t,r,n){n=once(n||noop);var o={},i=wrapAsync$1(r);eachOfLimit(e,t,function(e,t,r){i(e,t,function(e,n){return e?r(e):(o[t]=n,void r())})},function(e){n(e,o)})}function has(e,t){return t in e}function memoize(e,t){var r=Object.create(null),n=Object.create(null);t=t||identity;var o=wrapAsync$1(e),i=initialParams(function(e,i){var a=t.apply(null,e);has(r,a)?setImmediate$1(function(){i.apply(null,r[a])}):has(n,a)?n[a].push(i):(n[a]=[i],o.apply(null,e.concat(rest(function(e){r[a]=e;var t=n[a];delete n[a];for(var o=0,i=t.length;o<i;o++)t[o].apply(null,e)}))))});return i.memo=r,i.unmemoized=e,i}function _parallel(e,t,r){r=r||noop;var n=isArrayLike(t)?[]:{};e(t,function(e,t,r){wrapAsync$1(e)(rest(function(e,o){o.length<=1&&(o=o[0]),n[t]=o,r(e)}))},function(e){r(e,n)})}function parallelLimit(e,t){_parallel(eachOf,e,t)}function parallelLimit$1(e,t,r){_parallel(_eachOfLimit(t),e,r)}function race(e,t){if(t=once(t||noop),!isArray(e))return t(new TypeError("First argument to race must be an array of functions"));if(!e.length)return t();for(var r=0,n=e.length;r<n;r++)wrapAsync$1(e[r])(t)}function reduceRight(e,t,r,n){reduce(slice.call(e).reverse(),t,r,n)}function reflect(e){var t=wrapAsync$1(e);return initialParams(function(e,r){return e.push(rest(function(e,t){if(e)r(null,{error:e});else{var n=null;1===t.length?n=t[0]:t.length>1&&(n=t),r(null,{value:n})}})),t.apply(this,e)})}function reject$1(e,t,r,n){_filter(e,t,function(e,t){r(e,function(e,r){t(e,!r)})},n)}function reflectAll(e){var t;return isArray(e)?t=arrayMap(e,reflect):(t={},baseForOwn(e,function(e,r){t[r]=reflect.call(this,e)})),t}function constant$1(e){return function(){return e}}function retry(e,t,r){var i=5,a=0,s={times:i,intervalFunc:constant$1(a)};if(arguments.length<3&&"function"==typeof e?(r=t||noop,t=e):(function(e,t){if("object"==typeof t)e.times=+t.times||i,e.intervalFunc="function"==typeof t.interval?t.interval:constant$1(+t.interval||a),e.errorFilter=t.errorFilter;else{if("number"!=typeof t&&"string"!=typeof t)throw new Error("Invalid arguments for async.retry");e.times=+t||i}}(s,e),r=r||noop),"function"!=typeof t)throw new Error("Invalid arguments for async.retry");var c=wrapAsync$1(t),u=1;!function o(){c(function(e){e&&u++<s.times&&("function"!=typeof s.errorFilter||s.errorFilter(e))?setTimeout(o,s.intervalFunc(u)):r.apply(null,arguments)})}()}function series(e,t){_parallel(eachOfSeries,e,t)}function sortBy(e,t,r){function n(e,t){var r=e.criteria,n=t.criteria;return r<n?-1:r>n?1:0}var o=wrapAsync$1(t);map(e,function(e,t){o(e,function(r,n){return r?t(r):void t(null,{value:e,criteria:n})})},function(e,t){return e?r(e):void r(null,arrayMap(t.sort(n),baseProperty("value")))})}function timeout(e,t,r){function n(){s||(i.apply(null,arguments),clearTimeout(a))}function o(){var t=e.name||"anonymous",n=new Error('Callback function "'+t+'" timed out.');n.code="ETIMEDOUT",r&&(n.info=r),s=!0,i(n)}var i,a,s=!1,c=wrapAsync$1(e);return initialParams(function(e,r){i=r,a=setTimeout(o,t),c.apply(null,e.concat(n))})}function baseRange(e,t,r,n){for(var o=-1,i=nativeMax$1(nativeCeil((t-e)/(r||1)),0),a=Array(i);i--;)a[n?i:++o]=e,e+=r;return a}function timeLimit(e,t,r,n){var o=wrapAsync$1(r);mapLimit(baseRange(0,e,1),t,o,n)}function transform(e,t,r,n){arguments.length<=3&&(n=r,r=t,t=isArray(e)?[]:{}),n=once(n||noop);var o=wrapAsync$1(r);eachOf(e,function(e,r,n){o(t,e,r,n)},function(e){n(e,t)})}function unmemoize(e){return function(){return(e.unmemoized||e).apply(null,arguments)}}function whilst(e,t,r){r=onlyOnce(r||noop);var n=wrapAsync$1(t);if(!e())return r(null);var o=rest(function(t,i){return t?r(t):e()?n(o):void r.apply(null,[null].concat(i))});n(o)}function until(e,t,r){whilst(function(){return!e.apply(this,arguments)},t,r)}var nativeMax=Math.max,initialParams=function(e){return rest(function(t){var r=t.pop();e.call(this,t,r)})},supportsSymbol="function"==typeof Symbol,wrapAsync$1=supportsAsync()?wrapAsync:identity,freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root.Symbol,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0,objectProto$1=Object.prototype,nativeObjectToString$1=objectProto$1.toString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0,asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]",MAX_SAFE_INTEGER=9007199254740991,breakLoop={},iteratorSymbol="function"==typeof Symbol&&Symbol.iterator,getIterator=function(e){return iteratorSymbol&&e[iteratorSymbol]&&e[iteratorSymbol]()},argsTag="[object Arguments]",objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$2.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArray=Array.isArray,freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer=moduleExports?root.Buffer:void 0,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/,argsTag$1="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag$1="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var freeExports$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=function(){try{return freeProcess&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$2=Object.prototype,hasOwnProperty$1=objectProto$2.hasOwnProperty,objectProto$5=Object.prototype,nativeKeys=overArg(Object.keys,Object),objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty,eachOfGeneric=doLimit(eachOfLimit,1/0),eachOf=function(e,t,r){(isArrayLike(e)?eachOfArrayLike:eachOfGeneric)(e,wrapAsync$1(t),r)},map=doParallel(_asyncMap),applyEach=applyEach$1(map),mapLimit=doParallelLimit(_asyncMap),mapSeries=doLimit(mapLimit,1),applyEachSeries=applyEach$1(mapSeries),apply$2=rest(function(e,t){return rest(function(r){return e.apply(null,t.concat(r))})}),baseFor=createBaseFor(),auto=function(e,t,r){function n(e,t){g.push(function(){!function(e,t){if(!m){var n=onlyOnce(rest(function(t,n){if(y--,n.length<=1&&(n=n[0]),t){var o={};baseForOwn(p,function(e,t){o[t]=e}),o[e]=n,m=!0,d=Object.create(null),r(t,o)}else p[e]=n,a(e)}));y++;var o=wrapAsync$1(t[t.length-1]);t.length>1?o(p,n):o(n)}}(e,t)})}function o(){if(0===g.length&&0===y)return r(null,p);for(;g.length&&y<t;){g.shift()()}}function a(e){arrayEach(d[e]||[],function(e){e()}),o()}function u(t){var r=[];return baseForOwn(e,function(e,n){isArray(e)&&baseIndexOf(e,t,0)>=0&&r.push(n)}),r}"function"==typeof t&&(r=t,t=null),r=once(r||noop);var f=keys(e).length;if(!f)return r(null);t||(t=f);var p={},y=0,m=!1,d=Object.create(null),g=[],h=[],b={};baseForOwn(e,function(t,r){if(!isArray(t))return n(r,[t]),void h.push(r);var o=t.slice(0,t.length-1),a=o.length;return 0===a?(n(r,t),void h.push(r)):(b[r]=a,void arrayEach(o,function(s){if(!e[s])throw new Error("async.auto task `"+r+"` has a non-existent dependency `"+s+"` in "+o.join(", "));!function(e,t){var r=d[e];r||(r=d[e]=[]),r.push(t)}(s,function(){0===--a&&n(r,t)})}))}),function(){for(var t=0;h.length;)t++,arrayEach(u(h.pop()),function(e){0==--b[e]&&h.push(e)});if(t!==f)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}(),o()},symbolTag="[object Symbol]",INFINITY=1/0,symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0,rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f\\ufe20-\\ufe23",rsComboSymbolsRange="\\u20d0-\\u20f0",rsVarRange="\\ufe0e\\ufe0f",rsZWJ="\\u200d",reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboMarksRange+rsComboSymbolsRange+rsVarRange+"]"),rsAstralRange$1="\\ud800-\\udfff",rsComboMarksRange$1="\\u0300-\\u036f\\ufe20-\\ufe23",rsComboSymbolsRange$1="\\u20d0-\\u20f0",rsVarRange$1="\\ufe0e\\ufe0f",rsAstral="["+rsAstralRange$1+"]",rsCombo="["+rsComboMarksRange$1+rsComboSymbolsRange$1+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange$1+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsZWJ$1="\\u200d",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange$1+"]?",rsOptJoin="(?:"+rsZWJ$1+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g"),reTrim=/^\s+|\s+$/g,FN_ARGS=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,FN_ARG_SPLIT=/,/,FN_ARG=/(=.+)?(\s*)$/,STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,hasSetImmediate="function"==typeof setImmediate&&setImmediate,hasNextTick="object"==typeof process&&"function"==typeof process.nextTick,_defer;_defer=hasSetImmediate?setImmediate:hasNextTick?process.nextTick:fallback;var setImmediate$1=wrap(_defer);DLL.prototype.removeLink=function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e},DLL.prototype.empty=DLL,DLL.prototype.insertAfter=function(e,t){t.prev=e,t.next=e.next,e.next?e.next.prev=t:this.tail=t,e.next=t,this.length+=1},DLL.prototype.insertBefore=function(e,t){t.prev=e.prev,t.next=e,e.prev?e.prev.next=t:this.head=t,e.prev=t,this.length+=1},DLL.prototype.unshift=function(e){this.head?this.insertBefore(this.head,e):setInitial(this,e)},DLL.prototype.push=function(e){this.tail?this.insertAfter(this.tail,e):setInitial(this,e)},DLL.prototype.shift=function(){return this.head&&this.removeLink(this.head)},DLL.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)};var eachOfSeries=doLimit(eachOfLimit,1),seq$1=rest(function(e){var t=arrayMap(e,wrapAsync$1);return rest(function(e){var r=this,n=e[e.length-1];"function"==typeof n?e.pop():n=noop,reduce(t,e,function(e,t,n){t.apply(r,e.concat(rest(function(e,t){n(e,t)})))},function(e,t){n.apply(r,[e].concat(t))})})}),compose=rest(function(e){return seq$1.apply(null,e.reverse())}),concat=doParallel(concat$1),concatSeries=doSeries(concat$1),constant=rest(function(e){var t=[null].concat(e);return initialParams(function(e,r){return r.apply(this,t)})}),detect=doParallel(_createTester(identity,_findGetResult)),detectLimit=doParallelLimit(_createTester(identity,_findGetResult)),detectSeries=doLimit(detectLimit,1),dir=consoleFunc("dir"),eachSeries=doLimit(eachLimit$1,1),every=doParallel(_createTester(notId,notId)),everyLimit=doParallelLimit(_createTester(notId,notId)),everySeries=doLimit(everyLimit,1),filter=doParallel(_filter),filterLimit=doParallelLimit(_filter),filterSeries=doLimit(filterLimit,1),groupByLimit=function(e,t,r,n){n=n||noop;var o=wrapAsync$1(r);mapLimit(e,t,function(e,t){o(e,function(r,n){return r?t(r):t(null,{key:n,val:e})})},function(e,t){for(var r={},o=Object.prototype.hasOwnProperty,i=0;i<t.length;i++)if(t[i]){var a=t[i].key,s=t[i].val;o.call(r,a)?r[a].push(s):r[a]=[s]}return n(e,r)})},groupBy=doLimit(groupByLimit,1/0),groupBySeries=doLimit(groupByLimit,1),log=consoleFunc("log"),mapValues=doLimit(mapValuesLimit,1/0),mapValuesSeries=doLimit(mapValuesLimit,1),_defer$1;_defer$1=hasNextTick?process.nextTick:hasSetImmediate?setImmediate:fallback;var nextTick=wrap(_defer$1),queue$1=function(e,t){var r=wrapAsync$1(e);return queue(function(e,t){r(e[0],t)},t,1)},priorityQueue=function(e,t){var r=queue$1(e,t);return r.push=function(e,t,n){if(null==n&&(n=noop),"function"!=typeof n)throw new Error("task callback must be a function");if(r.started=!0,isArray(e)||(e=[e]),0===e.length)return setImmediate$1(function(){r.drain()});t=t||0;for(var o=r._tasks.head;o&&t>=o.priority;)o=o.next;for(var i=0,a=e.length;i<a;i++){var s={data:e[i],priority:t,callback:n};o?r._tasks.insertBefore(o,s):r._tasks.push(s)}setImmediate$1(r.process)},delete r.unshift,r},slice=Array.prototype.slice,reject=doParallel(reject$1),rejectLimit=doParallelLimit(reject$1),rejectSeries=doLimit(rejectLimit,1),retryable=function(e,t){t||(t=e,e=null);var r=wrapAsync$1(t);return initialParams(function(t,n){function o(e){r.apply(null,t.concat(e))}e?retry(e,o,n):retry(o,n)})},some=doParallel(_createTester(Boolean,identity)),someLimit=doParallelLimit(_createTester(Boolean,identity)),someSeries=doLimit(someLimit,1),nativeCeil=Math.ceil,nativeMax$1=Math.max,times=doLimit(timeLimit,1/0),timesSeries=doLimit(timeLimit,1),waterfall=function(e,t){if(t=once(t||noop),!isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var n=0;!function r(o){if(n===e.length)return t.apply(null,[null].concat(o));var i=onlyOnce(rest(function(e,n){return e?t.apply(null,[e].concat(n)):void r(n)}));o.push(i),wrapAsync$1(e[n++]).apply(null,o)}([])},index={applyEach:applyEach,applyEachSeries:applyEachSeries,apply:apply$2,asyncify:asyncify,auto:auto,autoInject:autoInject,cargo:cargo,compose:compose,concat:concat,concatSeries:concatSeries,constant:constant,detect:detect,detectLimit:detectLimit,detectSeries:detectSeries,dir:dir,doDuring:doDuring,doUntil:doUntil,doWhilst:doWhilst,during:during,each:eachLimit,eachLimit:eachLimit$1,eachOf:eachOf,eachOfLimit:eachOfLimit,eachOfSeries:eachOfSeries,eachSeries:eachSeries,ensureAsync:ensureAsync,every:every,everyLimit:everyLimit,everySeries:everySeries,filter:filter,filterLimit:filterLimit,filterSeries:filterSeries,forever:forever,groupBy:groupBy,groupByLimit:groupByLimit,groupBySeries:groupBySeries,log:log,map:map,mapLimit:mapLimit,mapSeries:mapSeries,mapValues:mapValues,mapValuesLimit:mapValuesLimit,mapValuesSeries:mapValuesSeries,memoize:memoize,nextTick:nextTick,parallel:parallelLimit,parallelLimit:parallelLimit$1,priorityQueue:priorityQueue,queue:queue$1,race:race,reduce:reduce,reduceRight:reduceRight,reflect:reflect,reflectAll:reflectAll,reject:reject,rejectLimit:rejectLimit,rejectSeries:rejectSeries,retry:retry,retryable:retryable,seq:seq$1,series:series,setImmediate:setImmediate$1,some:some,someLimit:someLimit,someSeries:someSeries,sortBy:sortBy,timeout:timeout,times:times,timesLimit:timeLimit,timesSeries:timesSeries,transform:transform,unmemoize:unmemoize,until:until,waterfall:waterfall,whilst:whilst,all:every,any:some,forEach:eachLimit,forEachSeries:eachSeries,forEachLimit:eachLimit$1,forEachOf:eachOf,forEachOfSeries:eachOfSeries,forEachOfLimit:eachOfLimit,inject:reduce,foldl:reduce,foldr:reduceRight,select:filter,selectLimit:filterLimit,selectSeries:filterSeries,wrapSync:asyncify};exports.default=index,exports.applyEach=applyEach,exports.applyEachSeries=applyEachSeries,exports.apply=apply$2,exports.asyncify=asyncify,exports.auto=auto,exports.autoInject=autoInject,exports.cargo=cargo,exports.compose=compose,exports.concat=concat,exports.concatSeries=concatSeries,exports.constant=constant,exports.detect=detect,exports.detectLimit=detectLimit,exports.detectSeries=detectSeries,exports.dir=dir,exports.doDuring=doDuring,exports.doUntil=doUntil,exports.doWhilst=doWhilst,exports.during=during,exports.each=eachLimit,exports.eachLimit=eachLimit$1,exports.eachOf=eachOf,exports.eachOfLimit=eachOfLimit,exports.eachOfSeries=eachOfSeries,exports.eachSeries=eachSeries,exports.ensureAsync=ensureAsync,exports.every=every,exports.everyLimit=everyLimit,exports.everySeries=everySeries,exports.filter=filter,exports.filterLimit=filterLimit,exports.filterSeries=filterSeries,exports.forever=forever,exports.groupBy=groupBy,exports.groupByLimit=groupByLimit,exports.groupBySeries=groupBySeries,exports.log=log,exports.map=map,exports.mapLimit=mapLimit,exports.mapSeries=mapSeries,exports.mapValues=mapValues,exports.mapValuesLimit=mapValuesLimit,exports.mapValuesSeries=mapValuesSeries,exports.memoize=memoize,exports.nextTick=nextTick,exports.parallel=parallelLimit,exports.parallelLimit=parallelLimit$1,exports.priorityQueue=priorityQueue,exports.queue=queue$1,exports.race=race,exports.reduce=reduce,exports.reduceRight=reduceRight,exports.reflect=reflect,exports.reflectAll=reflectAll,exports.reject=reject,exports.rejectLimit=rejectLimit,exports.rejectSeries=rejectSeries,exports.retry=retry,exports.retryable=retryable,exports.seq=seq$1,exports.series=series,exports.setImmediate=setImmediate$1,exports.some=some,exports.someLimit=someLimit,exports.someSeries=someSeries,exports.sortBy=sortBy,exports.timeout=timeout,exports.times=times,exports.timesLimit=timeLimit,exports.timesSeries=timesSeries,exports.transform=transform,exports.unmemoize=unmemoize,exports.until=until,exports.waterfall=waterfall,exports.whilst=whilst,exports.all=every,exports.allLimit=everyLimit,exports.allSeries=everySeries,exports.any=some,exports.anyLimit=someLimit,exports.anySeries=someSeries,exports.find=detect,exports.findLimit=detectLimit,exports.findSeries=detectSeries,exports.forEach=eachLimit,exports.forEachSeries=eachSeries,exports.forEachLimit=eachLimit$1,exports.forEachOf=eachOf,exports.forEachOfSeries=eachOfSeries,exports.forEachOfLimit=eachOfLimit,exports.inject=reduce,exports.foldl=reduce,exports.foldr=reduceRight,exports.select=filter,exports.selectLimit=filterLimit,exports.selectSeries=filterSeries,exports.wrapSync=asyncify,Object.defineProperty(exports,"__esModule",{value:!0})}),function(e){"use strict";function n(t){this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=_(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new o(t),this._handle.streamer=this,this._config=t}.call(this,t),this.parseChunk=function(t){if(this.isFirstChunk&&m(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(t);void 0!==r&&(t=r)}this.isFirstChunk=!1;var n=this._partialLine+t;this._partialLine="";var i=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var s=i.meta.cursor;this._finished||(this._partialLine=n.substring(s-this._baseIndex),this._baseIndex=s),i&&i.data&&(this._rowCount+=i.data.length);var a=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(y)e.postMessage({results:i,workerId:S.WORKER_ID,finished:a});else if(m(this._config.chunk)){if(this._config.chunk(i,this._handle),this._paused)return;i=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),!a||!m(this._config.complete)||i&&i.meta.aborted||this._config.complete(this._completeResults),a||i&&i.meta.paused||this._nextChunk(),i}},this._sendError=function(t){m(this._config.error)?this._config.error(t):y&&this._config.error&&e.postMessage({workerId:S.WORKER_ID,error:t,finished:!1})}}function i(e){var r;(e=e||{}).chunkSize||(e.chunkSize=S.RemoteChunkSize),n.call(this,e),this._nextChunk=k?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest,k||(r.onload=g(this._chunkLoaded,this),r.onerror=g(this._chunkError,this)),r.open("GET",this._input,!k),this._config.chunkSize){var e=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+e),r.setRequestHeader("If-None-Match","webkit-no-cache")}try{r.send()}catch(t){this._chunkError(t.message)}k&&0==r.status?this._chunkError():this._start+=this._config.chunkSize}},this._chunkLoaded=function(){if(4==r.readyState){if(r.status<200||r.status>=400)return void this._chunkError();this._finished=!this._config.chunkSize||this._start>function(e){var t=e.getResponseHeader("Content-Range");return parseInt(t.substr(t.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)}},this._chunkError=function(e){var t=r.statusText||e;this._sendError(t)}}function s(e){(e=e||{}).chunkSize||(e.chunkSize=S.LocalChunkSize),n.call(this,e);var t,r,i="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,i?((t=new FileReader).onload=g(this._chunkLoaded,this),t.onerror=g(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var n=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,n)}var s=t.readAsText(e,this._config.encoding);i||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function a(e){var r;e=e||{},n.call(this,e),this.stream=function(e){return e,r=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e=this._config.chunkSize,t=e?r.substr(0,e):r;return r=e?r.substr(e):"",this._finished=!r,this.parseChunk(t)}}}function o(e){function t(){if(b&&d&&(h("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+S.DefaultDelimiter+"'"),d=!1),e.skipEmptyLines)for(var t=0;t<b.data.length;t++)1==b.data[t].length&&""==b.data[t][0]&&b.data.splice(t--,1);return r()&&function(){if(b){for(var e=0;r()&&e<b.data.length;e++)for(var t=0;t<b.data[e].length;t++)y.push(b.data[e][t]);b.data.splice(0,1)}}(),function(){if(!b||!e.header&&!e.dynamicTyping)return b;for(var t=0;t<b.data.length;t++){for(var r={},n=0;n<b.data[t].length;n++){if(e.dynamicTyping){var i=b.data[t][n];b.data[t][n]="true"==i||"TRUE"==i||"false"!=i&&"FALSE"!=i&&o(i)}e.header&&(n>=y.length?(r.__parsed_extra||(r.__parsed_extra=[]),r.__parsed_extra.push(b.data[t][n])):r[y[n]]=b.data[t][n])}e.header&&(b.data[t]=r,n>y.length?h("FieldMismatch","TooManyFields","Too many fields: expected "+y.length+" fields but parsed "+n,t):n<y.length&&h("FieldMismatch","TooFewFields","Too few fields: expected "+y.length+" fields but parsed "+n,t))}return e.header&&b.meta&&(b.meta.fields=y),b}()}function r(){return e.header&&0==y.length}function o(e){return l.test(e)?parseFloat(e):e}function h(e,t,r,n){b.errors.push({type:e,code:t,message:r,row:n})}var f,c,d,l=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,p=this,g=0,v=!1,k=!1,y=[],b={data:[],errors:[],meta:{}};if(m(e.step)){var R=e.step;e.step=function(n){if(b=n,r())t();else{if(t(),0==b.data.length)return;g+=n.data.length,e.preview&&g>e.preview?c.abort():R(b,p)}}}this.parse=function(r,n,i){if(e.newline||(e.newline=function(e){var t=(e=e.substr(0,1048576)).split("\r");if(1==t.length)return"\n";for(var r=0,n=0;n<t.length;n++)"\n"==t[n][0]&&r++;return r>=t.length/2?"\r\n":"\r"}(r)),d=!1,!e.delimiter){var o=function(t){for(var r,n,i,s=[",","\t","|",";",S.RECORD_SEP,S.UNIT_SEP],a=0;a<s.length;a++){var o=s[a],h=0,f=0;i=void 0;for(var c=new u({delimiter:o,preview:10}).parse(t),d=0;d<c.data.length;d++){var l=c.data[d].length;f+=l,void 0!==i?l>1&&(h+=Math.abs(l-i),i=l):i=l}c.data.length>0&&(f/=c.data.length),(void 0===n||n>h)&&f>1.99&&(n=h,r=o)}return e.delimiter=r,{successful:!!r,bestDelimiter:r}}(r);o.successful?e.delimiter=o.bestDelimiter:(d=!0,e.delimiter=S.DefaultDelimiter),b.meta.delimiter=e.delimiter}var h=_(e);return e.preview&&e.header&&h.preview++,f=r,c=new u(h),b=c.parse(f,n,i),t(),v?{meta:{paused:!0}}:b||{meta:{paused:!1}}},this.paused=function(){return v},this.pause=function(){v=!0,c.abort(),f=f.substr(c.getCharIndex())},this.resume=function(){v=!1,p.streamer.parseChunk(f)},this.aborted=function(){return k},this.abort=function(){k=!0,c.abort(),b.meta.aborted=!0,m(e.complete)&&e.complete(b),f=""}}function u(e){var t=(e=e||{}).delimiter,r=e.newline,n=e.comments,i=e.step,s=e.preview,a=e.fastMode;if(("string"!=typeof t||S.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),n===t)throw"Comment character same as delimiter";!0===n?n="#":("string"!=typeof n||S.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!=r&&"\r"!=r&&"\r\n"!=r&&(r="\n");var o=0,u=!1;this.parse=function(e,h,f){function c(e){b.push(e),S=o}function d(t){return f?p():(void 0===t&&(t=e.substr(o)),w.push(t),o=g,c(w),y&&_(),p())}function l(t){o=t,c(w),w=[],O=e.indexOf(r,o)}function p(e){return{data:b,errors:R,meta:{delimiter:t,linebreak:r,aborted:u,truncated:!!e,cursor:S+(h||0)}}}function _(){i(p()),b=[],R=[]}if("string"!=typeof e)throw"Input must be a string";var g=e.length,m=t.length,v=r.length,k=n.length,y="function"==typeof i;o=0;var b=[],R=[],w=[],S=0;if(!e)return p();if(a||!1!==a&&-1===e.indexOf('"')){for(var C=e.split(r),E=0;E<C.length;E++){w=C[E];if(o+=w.length,E!==C.length-1)o+=r.length;else if(f)return p();if(!n||w.substr(0,k)!=n){if(y){if(b=[],c(w.split(t)),_(),u)return p()}else c(w.split(t));if(s&&E>=s)return b=b.slice(0,s),p(!0)}}return p()}for(var x=e.indexOf(t,o),O=e.indexOf(r,o);;)if('"'!=e[o])if(n&&0===w.length&&e.substr(o,k)===n){if(-1==O)return p();o=O+v,O=e.indexOf(r,o),x=e.indexOf(t,o)}else if(-1!==x&&(O>x||-1===O))w.push(e.substring(o,x)),o=x+m,x=e.indexOf(t,o);else{if(-1===O)break;if(w.push(e.substring(o,O)),l(O+v),y&&(_(),u))return p();if(s&&b.length>=s)return p(!0)}else{var I=o;for(o++;;){if(-1===(I=e.indexOf('"',I+1)))return f||R.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:b.length,index:o}),d();if(I===g-1)return d(e.substring(o,I).replace(/""/g,'"'));if('"'!=e[I+1]){if(e[I+1]==t){w.push(e.substring(o,I).replace(/""/g,'"')),o=I+1+m,x=e.indexOf(t,o),O=e.indexOf(r,o);break}if(e.substr(I+1,v)===r){if(w.push(e.substring(o,I).replace(/""/g,'"')),l(I+1+v),x=e.indexOf(t,o),y&&(_(),u))return p();if(s&&b.length>=s)return p(!0);break}}else I++}}return d()},this.abort=function(){u=!0},this.getCharIndex=function(){return o}}function c(e){var t=e.data,r=R[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){n=!0,d(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:l,resume:l};if(m(r.userStep)){for(var a=0;a<t.results.data.length&&(r.userStep({data:[t.results.data[a]],errors:t.results.errors,meta:t.results.meta},s),!n);a++);delete t.results}else m(r.userChunk)&&(r.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!n&&d(t.workerId,t.results)}function d(e,t){var r=R[e];m(r.userComplete)&&r.userComplete(t),r.terminate(),delete R[e]}function l(){throw"Not implemented."}function _(e){if("object"!=typeof e)return e;var t=e instanceof Array?[]:{};for(var r in e)t[r]=_(e[r]);return t}function g(e,t){return function(){e.apply(t,arguments)}}function m(e){return"function"==typeof e}var v,k=!e.document&&!!e.postMessage,y=k&&/(\?|&)papaworker(=|&|$)/.test(e.location.search),b=!1,R={},w=0,S={};if(S.parse=function(t,r){if((r=r||{}).worker&&S.WORKERS_SUPPORTED){var n=function(){if(!S.WORKERS_SUPPORTED)return!1;if(!b&&null===S.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var t=S.SCRIPT_PATH||v;t+=(-1!==t.indexOf("?")?"&":"?")+"papaworker";var r=new e.Worker(t);return r.onmessage=c,r.id=w++,R[r.id]=r,r}();return n.userStep=r.step,n.userChunk=r.chunk,n.userComplete=r.complete,n.userError=r.error,r.step=m(r.step),r.chunk=m(r.chunk),r.complete=m(r.complete),r.error=m(r.error),delete r.worker,void n.postMessage({input:t,config:r,workerId:n.id})}var o=null;return"string"==typeof t?o=r.download?new i(r):new a(r):(e.File&&t instanceof File||t instanceof Object)&&(o=new s(r)),o.stream(t)},S.unparse=function(e,t){function n(e){if("object"!=typeof e)return[];var t=[];for(var r in e)t.push(r);return t}function i(e,t){var r="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var n=e instanceof Array&&e.length>0,i=!(t[0]instanceof Array);if(n){for(var a=0;a<e.length;a++)a>0&&(r+=u),r+=s(e[a],a);t.length>0&&(r+=h)}for(var o=0;o<t.length;o++){for(var f=n?e.length:t[o].length,c=0;f>c;c++){c>0&&(r+=u);var d=n&&i?e[c]:c;r+=s(t[o][d],c)}o<t.length-1&&(r+=h)}return r}function s(e,t){return void 0===e||null===e?"":(e=e.toString().replace(/"/g,'""'),"boolean"==typeof o&&o||o instanceof Array&&o[t]||function(e,t){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>-1)return!0;return!1}(e,S.BAD_DELIMITERS)||e.indexOf(u)>-1||" "==e.charAt(0)||" "==e.charAt(e.length-1)?'"'+e+'"':e)}var o=!1,u=",",h="\r\n";if("object"==typeof t&&("string"==typeof t.delimiter&&1==t.delimiter.length&&-1==S.BAD_DELIMITERS.indexOf(t.delimiter)&&(u=t.delimiter),("boolean"==typeof t.quotes||t.quotes instanceof Array)&&(o=t.quotes),"string"==typeof t.newline&&(h=t.newline)),"string"==typeof e&&(e=JSON.parse(e)),e instanceof Array){if(!e.length||e[0]instanceof Array)return i(null,e);if("object"==typeof e[0])return i(n(e[0]),e)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),e.data instanceof Array&&(e.fields||(e.fields=e.data[0]instanceof Array?e.fields:n(e.data[0])),e.data[0]instanceof Array||"object"==typeof e.data[0]||(e.data=[e.data])),i(e.fields||[],e.data||[]);throw"exception: Unable to serialize unrecognized input"},S.RECORD_SEP=String.fromCharCode(30),S.UNIT_SEP=String.fromCharCode(31),S.BYTE_ORDER_MARK="\ufeff",S.BAD_DELIMITERS=["\r","\n",'"',S.BYTE_ORDER_MARK],S.WORKERS_SUPPORTED=!k&&!!e.Worker,S.SCRIPT_PATH=null,S.LocalChunkSize=10485760,S.RemoteChunkSize=5242880,S.DefaultDelimiter=",",S.Parser=u,S.ParserHandle=o,S.NetworkStreamer=i,S.FileStreamer=s,S.StringStreamer=a,"undefined"!=typeof module&&module.exports?module.exports=S:m(e.define)&&e.define.amd?define(function(){return S}):e.Papa=S,e.jQuery){var C=e.jQuery;C.fn.parse=function(t){function r(){if(0!=a.length){var e=a[0];if(m(t.before)){var r=t.before(e.file,e.inputElem);if("object"==typeof r){if("abort"==r.action)return void function(e,r,n,i){m(t.error)&&t.error({name:e},r,n,i)}("AbortError",e.file,e.inputElem,r.reason);if("skip"==r.action)return void i();"object"==typeof r.config&&(e.instanceConfig=C.extend(e.instanceConfig,r.config))}else if("skip"==r)return void i()}var s=e.instanceConfig.complete;e.instanceConfig.complete=function(t){m(s)&&s(t,e.file,e.inputElem),i()},S.parse(e.file,e.instanceConfig)}else m(t.complete)&&t.complete()}function i(){a.splice(0,1),r()}var s=t.config||{},a=[];return this.each(function(){if(!("INPUT"==C(this).prop("tagName").toUpperCase()&&"file"==C(this).attr("type").toLowerCase()&&e.FileReader)||!this.files||0==this.files.length)return!0;for(var r=0;r<this.files.length;r++)a.push({file:this.files[r],inputElem:this,instanceConfig:C.extend({},s)})}),r(),this}}y?e.onmessage=function(t){var r=t.data;if(void 0===S.WORKER_ID&&r&&(S.WORKER_ID=r.workerId),"string"==typeof r.input)e.postMessage({workerId:S.WORKER_ID,results:S.parse(r.input,r.config),finished:!0});else if(e.File&&r.input instanceof File||r.input instanceof Object){var n=S.parse(r.input,r.config);n&&e.postMessage({workerId:S.WORKER_ID,results:n,finished:!0})}}:S.WORKERS_SUPPORTED&&(v=function(){var e=document.getElementsByTagName("script");return e.length?e[e.length-1].src:""}(),document.body?document.addEventListener("DOMContentLoaded",function(){b=!0},!0):b=!0),i.prototype=Object.create(n.prototype),i.prototype.constructor=i,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,a.prototype=Object.create(a.prototype),a.prototype.constructor=a}("undefined"!=typeof window?window:this);